<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lcltokentable.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:42 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>lcltokentable.c</h1><a href="lcltokentable_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** tokentable.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Larch processors token table</font>
00028 <font class="comment">** This table stores predefined tokens for LCL.</font>
00029 <font class="comment">*/</font>
00030 
00031 <font class="preprocessor"># include "lclintMacros.nf"</font>
00032 <font class="preprocessor"># include "llbasic.h"</font>
00033 <font class="preprocessor"># include "lcltokentable.h"</font>
00034 
00035 <font class="keyword">static</font> <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> MaxToken; 
00036 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> o_ltoken *LCLTokenTable = NULL;    
00037 
00038 <font class="keyword">static</font> <font class="keywordtype">void</font> AllocTokenTable (<font class="keywordtype">void</font>) 
00039    <font class="comment">/*@globals LCLTokenTable@*/</font>
00040    <font class="comment">/*@modifies LCLTokenTable, MaxToken@*/</font>;
00041 
00042 ltoken 
<a name="l00043"></a><a class="code" href="lcltokentable_c.html#a3">00043</a>   <a class="code" href="lcltokentable_c.html#a3">LCLInsertToken</a> (ltokenCode cod, lsymbol sym, lsymbol rTxt,
00044                   <font class="keywordtype">bool</font> isPredefined)<font class="keyword"></font>
00045 <font class="keyword"></font>{
00046   <font class="comment">/*</font>
00047 <font class="comment">  ** If the token is already in the token table, it is returned.  Otherwise,</font>
00048 <font class="comment">  ** the token is inserted into the table and then returned.</font>
00049 <font class="comment">  **</font>
00050 <font class="comment">  ** A new TokenTable is allocated when:</font>
00051 <font class="comment">  **   . The TokenTable[] is empty (initial case)</font>
00052 <font class="comment">  **   . The location where to insert the token is not in TokenTable[]</font>
00053 <font class="comment">  */</font>
00054 
00055   setCodePoint ();
00056 
00057   <font class="keywordflow">while</font> (sym &gt;= MaxToken)
00058     {
00059       setCodePoint ();
00060       <font class="comment">/* No more space available.  Allocate more. */</font>
00061       AllocTokenTable ();
00062     }
00063   
00064   llassert (LCLTokenTable != NULL);
00065 
00066   <font class="keywordflow">if</font> (ltoken_isUndefined (LCLTokenTable[sym]))
00067     {
00068       LCLTokenTable[sym] = <a class="code" href="ltoken_c.html#a32">ltoken_create</a> (cod, sym);      
00069       ltoken_setRawText (LCLTokenTable[sym], rTxt);
00070       ltoken_setDefined (LCLTokenTable[sym], isPredefined);
00071             <font class="keywordflow">return</font> LCLTokenTable[sym];
00072     }
00073 
00074     <font class="keywordflow">return</font> LCLTokenTable[sym];
00075 }
00076 
<a name="l00077"></a><a class="code" href="lcltokentable_c.html#a4">00077</a> <font class="keywordtype">void</font> <a class="code" href="lcltokentable_c.html#a4">LCLUpdateToken</a> (ltokenCode cod, lsymbol sym, <font class="keywordtype">bool</font> def)<font class="keyword"></font>
00078 <font class="keyword"></font>{
00079   llassert (LCLTokenTable != NULL);
00080 
00081   <font class="keywordflow">if</font> (!ltoken_isUndefined (LCLTokenTable[sym]))
00082     {
00083       ltoken_setCode (LCLTokenTable[sym], cod);
00084       ltoken_setDefined (LCLTokenTable[sym], def);
00085     }
00086   <font class="keywordflow">else</font>
00087     {
00088       <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"LCLUpdateToken: %s"</font>, 
00089                            cstring_fromChars (lsymbol_toChars (sym))));
00090     }
00091 }
00092 
<a name="l00093"></a><a class="code" href="lcltokentable_c.html#a5">00093</a> <font class="keywordtype">void</font> <a class="code" href="lcltokentable_c.html#a5">LCLSetTokenHasSyn</a> (lsymbol sym, <font class="keywordtype">bool</font> syn)<font class="keyword"></font>
00094 <font class="keyword"></font>{
00095   llassert (LCLTokenTable != NULL);
00096 
00097   <font class="keywordflow">if</font> (!ltoken_isUndefined (LCLTokenTable[sym]))
00098     {
00099       ltoken_setHasSyn (LCLTokenTable[sym], syn);
00100     }
00101   <font class="keywordflow">else</font>
00102     {
00103       <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"LCLSetTokenHasSyn: null token (%d)"</font>, (<font class="keywordtype">int</font>)sym));
00104     }
00105 }
00106 
<a name="l00107"></a><a class="code" href="lcltokentable_c.html#a6">00107</a> ltoken <a class="code" href="lcltokentable_c.html#a6">LCLGetToken</a> (lsymbol sym)<font class="keyword"></font>
00108 <font class="keyword"></font>{
00109   llassert (LCLTokenTable != NULL);
00110   llassert (sym &lt; MaxToken);
00111 
00112   <font class="keywordflow">return</font> LCLTokenTable[sym];
00113 }
00114 
00115 <font class="preprocessor">#if 0</font>
00116 <font class="preprocessor"></font><font class="keywordtype">bool</font> LCLTokenTableContainsToken (ltoken tok)<font class="keyword"></font>
00117 <font class="keyword"></font>{
00118   <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font> i;
00119 
00120   <font class="keywordflow">if</font> (LCLTokenTable != NULL) {
00121     <font class="keywordflow">for</font> (i = 0; i &lt; MaxToken; i++) {
00122       <font class="keywordflow">if</font> (LCLTokenTable[i] == tok) {
00123         <font class="keywordflow">return</font> TRUE;
00124       }
00125     }
00126   }
00127 
00128   <font class="keywordflow">return</font> FALSE;
00129 }
00130 <font class="preprocessor"># endif</font>
00131 <font class="preprocessor"></font>
00132 <font class="comment">/*@exposed@*/</font> ltoken
<a name="l00133"></a><a class="code" href="lcltokentable_c.html#a7">00133</a> <a class="code" href="lcltokentable_c.html#a7">LCLReserveToken</a> (ltokenCode cod, <font class="keywordtype">char</font> *txt)<font class="keyword"></font>
00134 <font class="keyword"></font>{
00135   <font class="comment">/*</font>
00136 <font class="comment">  ** The same context that was active when the string-handle</font>
00137 <font class="comment">  ** was derived by a previous call to lsymbol_fromChars (),</font>
00138 <font class="comment">  ** must be established.</font>
00139 <font class="comment">  */</font>
00140   lsymbol sym;
00141 
00142   setCodePoint ();
00143   sym = <a class="code" href="lsymbol_c.html#a14">lsymbol_fromChars</a> (txt);
00144   
00145   <font class="comment">/* </font>
00146 <font class="comment">  ** Reserved tokens never have raw text like synonyms.</font>
00147 <font class="comment">  */</font>
00148 
00149     <font class="keywordflow">return</font> (<a class="code" href="lcltokentable_c.html#a3">LCLInsertToken</a> (cod, sym, lsymbol_undefined, TRUE));
00150 }
00151 
00152 <font class="keyword">static</font> <font class="keywordtype">void</font>
00153   AllocTokenTable (<font class="keywordtype">void</font>) <font class="comment">/*@globals LCLTokenTable; @*/</font> 
00154 {
00155   <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> oldSize, newSize;
00156   <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i;
00157   
00158   oldSize = MaxToken;
00159 
00160   <font class="keywordflow">if</font> (oldSize == 0)
00161     {
00162       newSize = INITTOKENTABLE;
00163       llassert (LCLTokenTable == NULL);
00164       LCLTokenTable = (ltoken *) dmalloc (newSize * <font class="keyword">sizeof</font> (*LCLTokenTable));
00165     }
00166   <font class="keywordflow">else</font>
00167     {
00168       o_ltoken *oldLCLTokenTable = LCLTokenTable;
00169 
00170       llassert (oldLCLTokenTable != NULL);
00171 
00172       newSize = (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) (DELTATOKENTABLE * oldSize);
00173       LCLTokenTable = (ltoken *) dmalloc (newSize * <font class="keyword">sizeof</font> (*LCLTokenTable));
00174 
00175       <font class="keywordflow">for</font> (i = 0; i &lt; oldSize; i++)
00176         {
00177           LCLTokenTable[i] = oldLCLTokenTable[i];
00178         }
00179       
00180       <a class="code" href="general_c.html#a0">sfree</a> (oldLCLTokenTable);
00181     }
00182 
00183   MaxToken = newSize;
00184   
00185   <font class="comment">/*@+loopexec@*/</font>
00186   <font class="keywordflow">for</font> (i = oldSize; i &lt; newSize; i++)
00187     {
00188       LCLTokenTable[i] = ltoken_undefined;
00189     }
00190   <font class="comment">/*@=loopexec@*/</font>
00191 <font class="comment">/*@-compdef@*/</font> } <font class="comment">/*=compdef@*/</font>
00192 
00193 <font class="keywordtype">void</font>
<a name="l00194"></a><a class="code" href="lcltokentable_c.html#a8">00194</a> <a class="code" href="lcltokentable_c.html#a8">LCLTokenTableInit</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00195 <font class="keyword"></font>{
00196     MaxToken = 0;
00197 }
00198 
00199 <font class="keywordtype">void</font>
<a name="l00200"></a><a class="code" href="lcltokentable_c.html#a9">00200</a> <a class="code" href="lcltokentable_c.html#a9">LCLTokenTableCleanup</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00201 <font class="keyword"></font>{
00202     
00203   <font class="keywordflow">if</font> (LCLTokenTable != NULL)
00204     {
00205       <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> i;
00206       
00207       <font class="keywordflow">for</font> (i = 0; i &lt; MaxToken; i++)
00208         {
00209           ltoken tok = LCLTokenTable[i];
00210           
00211           LCLTokenTable[i] = NULL;
00212           <font class="comment">/*@-dependenttrans@*/</font> <a class="code" href="ltoken_c.html#a43">ltoken_free</a> (tok);
00213           <font class="comment">/*@=dependenttrans@*/</font>
00214         }
00215       
00216       <a class="code" href="general_c.html#a0">sfree</a> (LCLTokenTable); 
00217       LCLTokenTable = NULL;
00218     }
00219 
00220   }
00221 
00222 
00223 
00224 
00225 
00226 
00227 
00228 
00229 
00230 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:42 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
