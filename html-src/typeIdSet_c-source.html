<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>typeIdSet.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:45 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>typeIdSet.c</h1><a href="typeIdSet_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** typeIdSet.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 
00031 <font class="comment">/*@constant int TISTABLEBASESIZE;@*/</font>
<a name="l00032"></a><a class="code" href="typeIdSet_c.html#a0">00032</a> <font class="preprocessor"># define TISTABLEBASESIZE LARGEBASESIZE</font>
00033 <font class="preprocessor"></font>
00034 <font class="keyword">static</font> <font class="keywordtype">int</font> tistableentries = 0;
00035 <font class="keyword">static</font> <font class="keywordtype">int</font> tistablefree = 0;
<a name="l00036"></a><a class="code" href="typeIdSet_c.html#a3">00036</a> <font class="keyword">typedef</font> <font class="comment">/*@only@*/</font> usymIdSet o_usymIdSet;
00037 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> o_usymIdSet *tistable;
00038 <font class="keyword">static</font> <font class="keywordtype">void</font> tistable_addDirectEntry (<font class="comment">/*@only@*/</font> usymIdSet p_s) 
00039    <font class="comment">/*@modifies tistable, tistableentries, tistablefree@*/</font>;
00040 
<a name="l00041"></a><a class="code" href="typeIdSet_c.html#a6">00041</a> <font class="keywordtype">void</font> <a class="code" href="typeIdSet_c.html#a6">typeIdSet_initMod</a> (<font class="keywordtype">void</font>)
00042    <font class="comment">/*@globals undef tistable;@*/</font>
00043    <font class="comment">/*@modifies tistable, tistablefree;@*/</font>
00044 {
00045   llassert (tistableentries == 0 &amp;&amp; tistablefree == 0);
00046 
00047   tistablefree = TISTABLEBASESIZE;
00048   tistable = (usymIdSet *) dmalloc (<font class="keyword">sizeof</font> (tistable) * tistablefree);
00049   tistable[0] = usymIdSet_undefined;
00050   tistableentries = 1;
00051   tistablefree--;
00052 }
00053 
<a name="l00054"></a><a class="code" href="typeIdSet_c.html#a7">00054</a> <font class="keywordtype">void</font> <a class="code" href="typeIdSet_c.html#a7">typeIdSet_destroyMod</a> (<font class="keywordtype">void</font>)
00055    <font class="comment">/*@globals killed tistable, tistableentries@*/</font>
00056 {
00057   <font class="keywordtype">int</font> i;
00058 
00059   <font class="keywordflow">for</font> (i = 0; i &lt; tistableentries; i++)
00060     {
00061       <a class="code" href="usymIdSet_c.html#a11">usymIdSet_free</a> (tistable[i]);
00062     }
00063 
00064   <a class="code" href="general_c.html#a0">sfree</a> (tistable);
00065   tistableentries = 0;
00066 }
00067 
<a name="l00068"></a><a class="code" href="typeIdSet_c.html#a8">00068</a> <font class="keywordtype">void</font> <a class="code" href="typeIdSet_c.html#a8">typeIdSet_dumpTable</a> (FILE *fout)<font class="keyword"></font>
00069 <font class="keyword"></font>{
00070   <font class="keywordtype">int</font> i;
00071 
00072   <font class="comment">/*</font>
00073 <font class="comment">  ** Don't dump 0th entry</font>
00074 <font class="comment">  */</font>
00075 
00076   <font class="keywordflow">for</font> (i = 1; i &lt; tistableentries; i++)
00077     {
00078       cstring s = <a class="code" href="usymIdSet_c.html#a12">usymIdSet_dump</a> (tistable[i]);
00079 
00080       fprintf (fout, <font class="stringliteral">"%s\n"</font>, cstring_toCharsSafe (s));
00081       <a class="code" href="cstring_c.html#a27">cstring_free</a> (s);
00082     }
00083 }
00084 
00085 <font class="keyword">static</font> <font class="comment">/*@unused@*/</font> <font class="keywordtype">void</font> tistable_printOut (<font class="keywordtype">void</font>)<font class="keyword"></font>
00086 <font class="keyword"></font>{
00087   <font class="keywordtype">int</font> i;
00088 
00089   <font class="comment">/*</font>
00090 <font class="comment">  ** Don't dump 0th entry</font>
00091 <font class="comment">  */</font>
00092 
00093   <font class="keywordflow">for</font> (i = 1; i &lt; tistableentries; i++)
00094     {
00095       cstring s = <a class="code" href="usymIdSet_c.html#a14">usymIdSet_unparse</a> (tistable[i]);
00096 
00097       fprintf (g_msgstream, <font class="stringliteral">"%d: %s\n"</font>, i, cstring_toCharsSafe (s));
00098       <a class="code" href="cstring_c.html#a27">cstring_free</a> (s);
00099     }
00100 }
00101 
<a name="l00102"></a><a class="code" href="typeIdSet_c.html#a10">00102</a> <font class="keywordtype">void</font> <a class="code" href="typeIdSet_c.html#a10">typeIdSet_loadTable</a> (FILE *fin)<font class="keyword"></font>
00103 <font class="keyword"></font>{
00104   <font class="keywordtype">char</font> *s = <a class="code" href="general_c.html#a29">mstring_create</a> (MAX_DUMP_LINE_LENGTH);  
00105   <font class="keywordtype">char</font> *os = s;
00106 
00107   llassert (tistableentries == 1);
00108 
00109   s = fgets (s, MAX_DUMP_LINE_LENGTH, fin);
00110 
00111   <font class="keywordflow">while</font> (s != NULL &amp;&amp; *s != <font class="charliteral">';'</font>)
00112     {
00113       usymIdSet u = <a class="code" href="usymIdSet_c.html#a13">usymIdSet_undump</a> (&amp;s);
00114       
00115       llassert (*s == <font class="charliteral">'\0'</font> || *s == <font class="charliteral">'\n'</font>);
00116       
00117       tistable_addDirectEntry (u);
00118       s = fgets (os, MAX_DUMP_LINE_LENGTH, fin);
00119     }
00120 }
00121   
00122 <font class="keyword">static</font> <font class="keywordtype">void</font> tistable_grow (<font class="keywordtype">void</font>)<font class="keyword"></font>
00123 <font class="keyword"></font>{
00124   o_usymIdSet *oldtable = tistable;
00125   <font class="keywordtype">int</font> newsize = tistableentries + TISTABLEBASESIZE;
00126   <font class="keywordtype">int</font> i;
00127 
00128   llassert (tistablefree == 0);
00129 
00130   tistable = (usymIdSet *) dmalloc (<font class="keyword">sizeof</font> (tistable) * newsize);
00131 
00132   <font class="keywordflow">for</font> (i = 0; i &lt; tistableentries; i++)
00133     {
00134       tistable[i] = oldtable[i];
00135     }
00136 
00137   tistablefree = TISTABLEBASESIZE;
00138   <a class="code" href="general_c.html#a0">sfree</a> (oldtable);
00139 } 
00140 
00141 <font class="keyword">static</font> <font class="keywordtype">void</font> tistable_addDirectEntry (<font class="comment">/*@only@*/</font> usymIdSet s)<font class="keyword"></font>
00142 <font class="keyword"></font>{
00143   <font class="keywordflow">if</font> (tistablefree == 0)
00144     {
00145       tistable_grow ();
00146     }
00147 
00148   tistable[tistableentries] = s;
00149   tistableentries++;
00150   tistablefree--;
00151 }
00152 
00153 <font class="keyword">static</font> <font class="keywordtype">int</font> tistable_addEntry (<font class="comment">/*@only@*/</font> usymIdSet s)<font class="keyword"></font>
00154 <font class="keyword"></font>{
00155   <font class="keywordtype">int</font> i;
00156 
00157   
00158   <font class="keywordflow">for</font> (i = 0; i &lt; tistableentries; i++)
00159     {
00160       <font class="keywordflow">if</font> (<a class="code" href="usymIdSet_c.html#a15">usymIdSet_compare</a> (tistable[i], s) == 0)
00161         {
00162           <font class="comment">/*@access usymIdSet@*/</font>
00163           llassert (i == 0 || s != tistable[i]);
00164           <font class="comment">/*@noaccess usymIdSet@*/</font>
00165 
00166           <a class="code" href="usymIdSet_c.html#a11">usymIdSet_free</a> (s);
00167                   <font class="keywordflow">return</font> i;
00168         }
00169     }
00170 
00171   tistable_addDirectEntry (s);
00172   <font class="keywordflow">return</font> (tistableentries - 1);
00173 }
00174   
00175 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> usymIdSet tistable_fetch (typeIdSet t)
00176    <font class="comment">/*@globals tistableentries, tistable@*/</font>
00177    <font class="comment">/*@modifies nothing;@*/</font>
00178 {
00179   llassert (t &gt;= 0 &amp;&amp; t &lt; tistableentries);
00180 
00181   <font class="keywordflow">return</font> tistable[t];
00182 }
00183 
<a name="l00184"></a><a class="code" href="typeIdSet_c.html#a14">00184</a> typeIdSet <a class="code" href="typeIdSet_c.html#a14">typeIdSet_emptySet</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00185 <font class="keyword"></font>{
00186   <font class="keywordflow">if</font> (tistableentries == 0)
00187     {
00188       <font class="keywordtype">int</font> val = tistable_addEntry (usymIdSet_new ());
00189 
00190       llassert (val == 0);
00191     }
00192 
00193   llassert (usymIdSet_isUndefined (tistable[0]));
00194   <font class="keywordflow">return</font> 0;
00195 }
00196     
<a name="l00197"></a><a class="code" href="typeIdSet_c.html#a15">00197</a> <font class="keywordtype">bool</font> <a class="code" href="typeIdSet_c.html#a15">typeIdSet_member</a> (typeIdSet t, typeId el)<font class="keyword"></font>
00198 <font class="keyword"></font>{
00199   usymIdSet u = tistable_fetch (t);
00200 
00201   <font class="keywordflow">return</font> <a class="code" href="usymIdSet_c.html#a10">usymIdSet_member</a> (u, el);
00202 }
00203 
<a name="l00204"></a><a class="code" href="typeIdSet_c.html#a16">00204</a> <font class="keywordtype">bool</font> <a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (typeIdSet t)<font class="keyword"></font>
00205 <font class="keyword"></font>{
00206   <font class="keywordflow">return</font> (t == 0);
00207 }
00208 
<a name="l00209"></a><a class="code" href="typeIdSet_c.html#a17">00209</a> typeIdSet <a class="code" href="typeIdSet_c.html#a17">typeIdSet_single</a> (typeId t)<font class="keyword"></font>
00210 <font class="keyword"></font>{
00211   <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_single (t)));
00212 }
00213 
<a name="l00214"></a><a class="code" href="typeIdSet_c.html#a18">00214</a> typeIdSet <a class="code" href="typeIdSet_c.html#a18">typeIdSet_singleOpt</a> (typeId t)<font class="keyword"></font>
00215 <font class="keyword"></font>{
00216   <font class="keywordflow">if</font> (typeId_isValid (t))
00217     {
00218       <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_single (t)));
00219     }
00220   <font class="keywordflow">else</font>
00221     {
00222       <font class="keywordflow">return</font> typeIdSet_empty;
00223     }
00224 }
00225 
<a name="l00226"></a><a class="code" href="typeIdSet_c.html#a19">00226</a> typeIdSet <a class="code" href="typeIdSet_c.html#a19">typeIdSet_insert</a> (typeIdSet t, typeId el)<font class="keyword"></font>
00227 <font class="keyword"></font>{
00228   usymIdSet u = tistable_fetch (t);
00229 
00230   <font class="keywordflow">if</font> (<a class="code" href="usymIdSet_c.html#a10">usymIdSet_member</a> (u, el))
00231     {
00232       <font class="keywordflow">return</font> t;
00233     }
00234   <font class="keywordflow">else</font>
00235     {
00236       <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_add (u, el)));
00237     }
00238 }
00239 
<a name="l00240"></a><a class="code" href="typeIdSet_c.html#a20">00240</a> typeIdSet <a class="code" href="typeIdSet_c.html#a20">typeIdSet_removeFresh</a> (typeIdSet t, typeId el)<font class="keyword"></font>
00241 <font class="keyword"></font>{
00242   <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_removeFresh (tistable_fetch (t), el)));
00243 }
00244 
<a name="l00245"></a><a class="code" href="typeIdSet_c.html#a21">00245</a> cstring <a class="code" href="typeIdSet_c.html#a21">typeIdSet_unparse</a> (typeIdSet t)<font class="keyword"></font>
00246 <font class="keyword"></font>{
00247   <font class="keywordflow">return</font> (<a class="code" href="usymIdSet_c.html#a14">usymIdSet_unparse</a> (tistable_fetch (t)));
00248 }
00249 
<a name="l00250"></a><a class="code" href="typeIdSet_c.html#a22">00250</a> <font class="keywordtype">int</font> <a class="code" href="typeIdSet_c.html#a22">typeIdSet_compare</a> (typeIdSet t1, typeIdSet t2)<font class="keyword"></font>
00251 <font class="keyword"></font>{
00252   <font class="keywordflow">return</font> (int_compare (t1, t2));
00253 }
00254 
<a name="l00255"></a><a class="code" href="typeIdSet_c.html#a23">00255</a> typeIdSet <a class="code" href="typeIdSet_c.html#a23">typeIdSet_subtract</a> (typeIdSet s, typeIdSet t)<font class="keyword"></font>
00256 <font class="keyword"></font>{
00257   <font class="keywordflow">if</font> (<a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (t))
00258     {
00259       <font class="keywordflow">return</font> s;
00260     }
00261   <font class="keywordflow">else</font>
00262     {
00263       <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_subtract (tistable_fetch (s),
00264                                                      tistable_fetch (t))));
00265     }
00266 }
00267 
<a name="l00268"></a><a class="code" href="typeIdSet_c.html#a24">00268</a> cstring <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (typeIdSet t)<font class="keyword"></font>
00269 <font class="keyword"></font>{
00270   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d"</font>, t));
00271 }
00272 
<a name="l00273"></a><a class="code" href="typeIdSet_c.html#a25">00273</a> typeIdSet <a class="code" href="typeIdSet_c.html#a25">typeIdSet_undump</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00274 <font class="keyword"></font>{
00275   <font class="keywordtype">int</font> i;
00276 
00277   
00278   i = <a class="code" href="general_c.html#a16">getInt</a> (s);
00279 
00280   llassert (i &gt;= 0 &amp;&amp; i &lt; tistableentries);
00281   <font class="keywordflow">return</font> (typeIdSet) i;
00282 }
00283 
<a name="l00284"></a><a class="code" href="typeIdSet_c.html#a26">00284</a> typeIdSet <a class="code" href="typeIdSet_c.html#a26">typeIdSet_union</a> (typeIdSet t1, typeIdSet t2)<font class="keyword"></font>
00285 <font class="keyword"></font>{
00286   <font class="keywordflow">if</font> (t1 == typeIdSet_undefined)
00287     {
00288       <font class="keywordflow">return</font> t2;
00289     }
00290   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (t2 == typeIdSet_undefined)
00291     {
00292       <font class="keywordflow">return</font> t1;
00293     }
00294   <font class="keywordflow">else</font>
00295     {
00296       <font class="keywordflow">return</font> (tistable_addEntry (usymIdSet_newUnion (tistable_fetch (t1),
00297                                                      tistable_fetch (t2))));
00298     }
00299 }
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:45 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
