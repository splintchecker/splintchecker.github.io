<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>llmain.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:42 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>llmain.c</h1><a href="llmain_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** llmain.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Main module for LCLint checker</font>
00028 <font class="comment">*/</font>
00029 
00030 <font class="preprocessor"># include &lt;signal.h&gt;</font>
00031 
00032 <font class="comment">/*</font>
00033 <font class="comment">** Ensure that WIN32 and _WIN32 are both defined or both undefined.</font>
00034 <font class="comment">*/</font>
00035 
00036 <font class="preprocessor"># ifdef WIN32</font>
00037 <font class="preprocessor"></font><font class="preprocessor"># ifndef _WIN32</font>
00038 <font class="preprocessor"></font><font class="preprocessor"># error "Inconsistent definitions."</font>
00039 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00040 <font class="preprocessor"></font><font class="preprocessor"># else</font>
00041 <font class="preprocessor"></font><font class="preprocessor"># ifdef _WIN32</font>
00042 <font class="preprocessor"></font><font class="preprocessor"># error "Inconsistent definitions."</font>
00043 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00044 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00045 <font class="preprocessor"></font>
00046 <font class="preprocessor"># ifdef WIN32</font>
00047 <font class="preprocessor"></font><font class="preprocessor"># include &lt;windows.h&gt;</font>
00048 <font class="preprocessor"># include &lt;process.h&gt;</font>
00049 <font class="preprocessor"># endif</font>
00050 <font class="preprocessor"></font>
00051 <font class="preprocessor"># include "lclintMacros.nf"</font>
00052 <font class="preprocessor"># include "llbasic.h"</font>
00053 <font class="preprocessor"># include "osd.h"</font>
00054 
00055 <font class="preprocessor"># ifndef NOLCL</font>
00056 <font class="preprocessor"></font><font class="preprocessor"># include "gram.h"</font>
00057 <font class="preprocessor"># include "lclscan.h"</font>
00058 <font class="preprocessor"># include "scanline.h"</font>
00059 <font class="preprocessor"># include "lclscanline.h"</font>
00060 <font class="preprocessor"># include "lclsyntable.h"</font>
00061 <font class="preprocessor"># include "lcltokentable.h"</font>
00062 <font class="preprocessor"># include "lslparse.h"</font>
00063 <font class="preprocessor"># include "scan.h"</font>
00064 <font class="preprocessor"># include "syntable.h"</font>
00065 <font class="preprocessor"># include "tokentable.h"</font>
00066 <font class="preprocessor"># include "lslinit.h"</font>
00067 <font class="preprocessor"># include "lclinit.h"</font>
00068 <font class="preprocessor"># include "lh.h"</font>
00069 <font class="preprocessor"># include "imports.h"</font>
00070 <font class="preprocessor"># endif</font>
00071 <font class="preprocessor"></font>
00072 <font class="preprocessor"># include "version.h"</font>
00073 <font class="preprocessor"># include "herald.h"</font>
00074 <font class="preprocessor"># include "fileIdList.h"</font>
00075 <font class="preprocessor"># include "lcllib.h"</font>
00076 <font class="preprocessor"># include "cgrammar.h"</font>
00077 <font class="preprocessor"># include "llmain.h"</font>
00078 <font class="preprocessor"># include "portab.h"</font>
00079 <font class="preprocessor"># include "cpp.h"</font>
00080 <font class="preprocessor"># include &lt;time.h&gt;</font>
00081 
00082 <font class="keyword">extern</font> <font class="comment">/*@external@*/</font> <font class="keywordtype">int</font> yydebug;
00083 
00084 <font class="keyword">static</font> <font class="keywordtype">void</font> printMail (<font class="keywordtype">void</font>);
00085 <font class="keyword">static</font> <font class="keywordtype">void</font> printMaintainer (<font class="keywordtype">void</font>);
00086 <font class="keyword">static</font> <font class="keywordtype">void</font> printReferences (<font class="keywordtype">void</font>);
00087 <font class="keyword">static</font> <font class="keywordtype">void</font> printFlags (<font class="keywordtype">void</font>);
00088 <font class="keyword">static</font> <font class="keywordtype">void</font> printAnnotations (<font class="keywordtype">void</font>);
00089 <font class="keyword">static</font> <font class="keywordtype">void</font> printParseErrors (<font class="keywordtype">void</font>);
00090 <font class="keyword">static</font> <font class="keywordtype">void</font> printComments (<font class="keywordtype">void</font>);
00091 <font class="keyword">static</font> <font class="keywordtype">void</font> describePrefixCodes (<font class="keywordtype">void</font>);
00092 <font class="keyword">static</font> <font class="keywordtype">void</font> cleanupFiles (<font class="keywordtype">void</font>);
00093 <font class="keyword">static</font> <font class="keywordtype">void</font> showHelp (<font class="keywordtype">void</font>);
00094 <font class="keyword">static</font> <font class="keywordtype">void</font> interrupt (<font class="keywordtype">int</font> p_i);
00095 <font class="keyword">static</font> <font class="keywordtype">void</font> loadrc (FILE *p_rcfile, cstringSList *p_passThroughArgs);
00096 <font class="keyword">static</font> <font class="keywordtype">void</font> describeVars (<font class="keywordtype">void</font>);
00097 <font class="keyword">static</font> <font class="keywordtype">bool</font> specialFlagsHelp (<font class="keywordtype">char</font> *p_next);
00098 <font class="keyword">static</font> <font class="keywordtype">bool</font> hasShownHerald = FALSE;
00099 
00100 <font class="keyword">static</font> <font class="keywordtype">bool</font> anylcl = FALSE;
00101 <font class="keyword">static</font> clock_t inittime;
00102 
00103 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> tsource *initFile = (tsource *) 0;
00104 
00105 <font class="keyword">static</font> fileIdList preprocessFiles (fileIdList)
00106   <font class="comment">/*@modifies fileSystem@*/</font> ;
00107 
00108 <font class="preprocessor"># ifndef NOLCL</font>
00109 <font class="preprocessor"></font>
00110 <font class="keyword">static</font>
00111 <font class="keywordtype">void</font> lslCleanup (<font class="keywordtype">void</font>)
00112    <font class="comment">/*@globals killed g_symtab@*/</font>
00113    <font class="comment">/*@modifies internalState, g_symtab@*/</font>
00114 {
00115   <font class="comment">/*</font>
00116 <font class="comment">  ** Cleanup all the LCL/LSL.</font>
00117 <font class="comment">  */</font>
00118 
00119   <font class="keyword">static</font> <font class="keywordtype">bool</font> didCleanup = FALSE;
00120 
00121   llassert (!didCleanup);
00122   llassert (anylcl);
00123 
00124   didCleanup = TRUE;
00125 
00126   <a class="code" href="lsymbol_c.html#a19">lsymbol_destroyMod</a> ();
00127   <a class="code" href="lclsyntable_c.html#a8">LCLSynTableCleanup</a> ();
00128   <a class="code" href="lcltokentable_c.html#a9">LCLTokenTableCleanup</a> ();
00129   <a class="code" href="lclscanline_c.html#a49">LCLScanLineCleanup</a> ();
00130   <a class="code" href="lclscan_c.html#a15">LCLScanCleanup</a> ();
00131 
00132   <font class="comment">/* clean up LSL parsing */</font>
00133 
00134   <a class="code" href="syntable_c.html#a8">lsynTableCleanup</a> ();
00135   <a class="code" href="tokentable_c.html#a7">ltokenTableCleanup</a> ();
00136   <a class="code" href="scanline_c.html#a9">lscanLineCleanup</a> ();
00137   <a class="code" href="scan_c.html#a8">LSLScanCleanup</a> ();
00138 
00139   <a class="code" href="symtable_c.html#a31">symtable_free</a> (g_symtab);
00140   <a class="code" href="sort_c.html#a64">sort_destroyMod</a> (); 
00141 }
00142 
00143 <font class="keyword">static</font>
00144   <font class="keywordtype">void</font> lslInit (<font class="keywordtype">void</font>)
00145   <font class="comment">/*@globals undef g_symtab; @*/</font>
00146   <font class="comment">/*@modifies g_symtab, internalState, fileSystem; @*/</font>
00147 {
00148   <font class="comment">/*</font>
00149 <font class="comment">  ** Open init file provided by user, or use the default LCL init file </font>
00150 <font class="comment">  */</font>
00151   
00152   cstring larchpath = <a class="code" href="context_c.html#a249">context_getLarchPath</a> ();
00153   tsource *LSLinitFile = (tsource *) 0;
00154 
00155   setCodePoint ();
00156 
00157   <font class="keywordflow">if</font> (initFile == (tsource *) 0)
00158     {
00159       initFile = <a class="code" href="source_c.html#a2">tsource_create</a> (INITFILENAME, LCLINIT_SUFFIX, FALSE);
00160       
00161       <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a6">tsource_getPath</a> (cstring_toCharsSafe (larchpath), initFile))
00162         {
00163           <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Continuing without LCL init file: %s"</font>,
00164                               cstring_fromChars (tsource_fileName (initFile))));
00165         }
00166       <font class="keywordflow">else</font> 
00167         {
00168           <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a5">tsource_open</a> (initFile))
00169             {
00170               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Continuing without LCL init file: %s"</font>,
00171                                   cstring_fromChars (tsource_fileName (initFile))));
00172             }
00173         }
00174     }
00175   <font class="keywordflow">else</font> 
00176     {
00177       <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a5">tsource_open</a> (initFile))
00178         {
00179           <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Continuing without LCL init file: %s"</font>,
00180                               cstring_fromChars (tsource_fileName (initFile))));
00181         }
00182     }
00183 
00184   <font class="comment">/* Initialize checker */</font>
00185 
00186   <a class="code" href="lsymbol_c.html#a18">lsymbol_initMod</a> ();
00187   <a class="code" href="lclsyntable_c.html#a6">LCLSynTableInit</a> ();
00188 
00189   setCodePoint ();
00190 
00191   <a class="code" href="lclsyntable_c.html#a7">LCLSynTableReset</a> ();
00192   <a class="code" href="lcltokentable_c.html#a8">LCLTokenTableInit</a> ();
00193 
00194   setCodePoint ();
00195 
00196   <a class="code" href="lclscanline_c.html#a47">LCLScanLineInit</a> ();
00197   setCodePoint ();
00198   <a class="code" href="lclscanline_c.html#a48">LCLScanLineReset</a> ();
00199   setCodePoint ();
00200   <a class="code" href="lclscan_c.html#a13">LCLScanInit</a> ();
00201 
00202   setCodePoint ();
00203 
00204   <font class="comment">/* need this to initialize LCL checker */</font>
00205   llassert (initFile != NULL);
00206       
00207   <font class="keywordflow">if</font> (tsource_isOpen (initFile))
00208     {
00209       setCodePoint ();
00210 
00211       <a class="code" href="lclscan_c.html#a14">LCLScanReset</a> (initFile);
00212       <a class="code" href="lclinit_c.html#a81">LCLProcessInitFileInit</a> ();
00213       <a class="code" href="lclinit_c.html#a82">LCLProcessInitFileReset</a> ();
00214 
00215       setCodePoint ();
00216       <a class="code" href="lclinit_c.html#a80">LCLProcessInitFile</a> ();
00217       <a class="code" href="lclinit_c.html#a83">LCLProcessInitFileCleanup</a> ();
00218 
00219       setCodePoint ();
00220       check (tsource_close (initFile));
00221     }
00222   
00223   <font class="comment">/* Initialize LSL init files, for parsing LSL signatures from LSL */</font>
00224   
00225   LSLinitFile = <a class="code" href="source_c.html#a2">tsource_create</a> (<font class="stringliteral">"lslinit.lsi"</font>, <font class="stringliteral">".lsi"</font>, FALSE);
00226   
00227   <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a6">tsource_getPath</a> (cstring_toCharsSafe (larchpath), LSLinitFile))
00228     {
00229       <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Continuing without LSL init file: %s"</font>,
00230                           cstring_fromChars (tsource_fileName (LSLinitFile))));
00231     }
00232   <font class="keywordflow">else</font> 
00233     {
00234       <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a5">tsource_open</a> (LSLinitFile))
00235         {
00236           <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Continuing without LSL init file: %s"</font>,
00237                               cstring_fromChars (tsource_fileName (LSLinitFile))));
00238         }
00239     }
00240       
00241   setCodePoint ();
00242   <a class="code" href="syntable_c.html#a6">lsynTableInit</a> ();
00243   <a class="code" href="syntable_c.html#a7">lsynTableReset</a> ();
00244 
00245   setCodePoint ();
00246   <a class="code" href="tokentable_c.html#a6">ltokenTableInit</a> ();
00247 
00248   setCodePoint ();
00249   <a class="code" href="scanline_c.html#a7">lscanLineInit</a> ();
00250   <a class="code" href="scanline_c.html#a8">lscanLineReset</a> ();
00251   <a class="code" href="scan_c.html#a6">LSLScanInit</a> ();
00252 
00253   <font class="keywordflow">if</font> (tsource_isOpen (LSLinitFile))
00254     {
00255       setCodePoint ();
00256       <a class="code" href="scan_c.html#a7">LSLScanReset</a> (LSLinitFile);
00257       <a class="code" href="lslinit_c.html#a4">LSLProcessInitFileInit</a> ();
00258       setCodePoint ();
00259       <a class="code" href="lslinit_c.html#a3">LSLProcessInitFile</a> ();
00260       setCodePoint ();
00261       check (tsource_close (LSLinitFile));
00262     }
00263       
00264   <a class="code" href="source_c.html#a1">tsource_free</a> (LSLinitFile);
00265   
00266   <font class="keywordflow">if</font> (<a class="code" href="llerror_c.html#a51">lclHadError</a> ())
00267     {
00268       lclplainerror 
00269         (cstring_makeLiteral (<font class="stringliteral">"LSL init file error.  Attempting to continue."</font>));
00270     }
00271   
00272   setCodePoint ();
00273   g_symtab = <a class="code" href="symtable_c.html#a35">symtable_new</a> ();
00274   
00275   <font class="comment">/* </font>
00276 <font class="comment">  ** sort_init must come after symtab has been initialized </font>
00277 <font class="comment">  */</font>
00278   <a class="code" href="sort_c.html#a91">sort_init</a> ();
00279   <a class="code" href="abstract_c.html#a43">abstract_init</a> ();
00280   setCodePoint ();
00281   
00282   inittime = clock ();
00283   
00284   <font class="comment">/* </font>
00285 <font class="comment">  ** Equivalent to importing old spec_csupport.lcl</font>
00286 <font class="comment">  ** define immutable LCL type "bool" and bool constants TRUE and FALSE</font>
00287 <font class="comment">  ** and initialized them to be equal to LSL's "true" and "false".</font>
00288 <font class="comment">  **</font>
00289 <font class="comment">  ** Reads in CTrait.syms (derived from CTrait.lsl) on LARCH_PATH.</font>
00290 <font class="comment">  */</font>
00291       
00292   <a class="code" href="abstract_c.html#a45">LCLBuiltins</a> (); 
00293   <a class="code" href="lclscanline_c.html#a46">LCLReportEolTokens</a> (FALSE);
00294 }
00295 
00296 <font class="keyword">static</font> <font class="keywordtype">void</font>
00297 lslProcess (fileIdList lclfiles)
00298    <font class="comment">/*@globals undef g_currentSpec, undef g_currentSpecName, g_currentloc,</font>
00299 <font class="comment">              undef killed g_symtab; @*/</font>
00300    <font class="comment">/*@modifies g_currentSpec, g_currentSpecName, g_currentloc, internalState, fileSystem; @*/</font>
00301 {
00302   <font class="keywordtype">char</font> *path = NULL;
00303   <font class="keywordtype">bool</font> parser_status = FALSE;
00304   <font class="keywordtype">bool</font> overallStatus = FALSE;
00305   
00306   lslInit ();
00307   
00308   <a class="code" href="context_c.html#a241">context_resetSpecLines</a> ();
00309 
00310   fileIdList_elements (lclfiles, fid)<font class="keyword"></font>
00311 <font class="keyword">    </font>{
00312       <font class="keywordtype">char</font> *actualName = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*actualName));
00313       <font class="keywordtype">char</font> *oactualName = actualName;
00314       <font class="keywordtype">char</font> *fname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (fileName (fid));
00315       
00316       <font class="keywordflow">if</font> (<a class="code" href="osd_c.html#a7">osd_getPath</a> (g_localSpecPath, fname, &amp;actualName) == OSD_FILENOTFOUND)
00317         {
00318           <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (g_localSpecPath, <font class="stringliteral">"."</font>))
00319             {
00320               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Spec file not found: %s"</font>,
00321                                   cstring_fromChars (fname)));
00322             }
00323           <font class="keywordflow">else</font>
00324             {
00325               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Spec file not found: %s (on %s)"</font>, 
00326                                   cstring_fromChars (fname), 
00327                                   <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (g_localSpecPath)));
00328             }
00329         }
00330       <font class="keywordflow">else</font>
00331         {
00332           tsource *specFile;
00333           
00334           <font class="keywordflow">while</font> (*actualName == <font class="charliteral">'.'</font> &amp;&amp; *(actualName + 1) == CONNECTCHAR) 
00335             {
00336               actualName += 2;
00337             }
00338           
00339           specFile = <a class="code" href="source_c.html#a2">tsource_create</a> (actualName, LCL_SUFFIX, TRUE);
00340           llassert (specFile != (tsource *) 0);
00341           
00342           g_currentSpec = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (mstring_copy (actualName));
00343 
00344           g_currentSpecName = specFullName 
00345             (<a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (g_currentSpec),
00346              &amp;path);
00347 
00348           setSpecFileId (fid);
00349                   
00350           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
00351             {
00352               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"&lt; reading spec %s &gt;"</font>, g_currentSpec));
00353             }
00354           
00355           <font class="comment">/* Open source file */</font>
00356           
00357           <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a5">tsource_open</a> (specFile))
00358             {
00359               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Cannot open file: %s"</font>,
00360                                   cstring_fromChars (tsource_fileName (specFile))));
00361               <a class="code" href="source_c.html#a1">tsource_free</a> (specFile);
00362             }
00363           <font class="keywordflow">else</font>
00364             {
00365               scopeInfo dummy_scope = (scopeInfo) dmalloc (<font class="keyword">sizeof</font> (*dummy_scope));
00366               dummy_scope-&gt;kind = SPE_INVALID;
00367               
00368               <a class="code" href="lh_c.html#a18">lhInit</a> (specFile);
00369               <a class="code" href="lclscan_c.html#a14">LCLScanReset</a> (specFile);
00370               
00371               <font class="comment">/* </font>
00372 <font class="comment">              ** Minor hacks to allow more than one LCL file to</font>
00373 <font class="comment">              ** be scanned, while keeping initializations</font>
00374 <font class="comment">              */</font>
00375               
00376               <a class="code" href="symtable_c.html#a42">symtable_enterScope</a> (g_symtab, dummy_scope);
00377               <a class="code" href="abstract_c.html#a42">resetImports</a> (cstring_fromChars (g_currentSpecName));
00378               <a class="code" href="context_c.html#a48">context_enterLCLfile</a> ();
00379               (<font class="keywordtype">void</font>) <a class="code" href="llerror_c.html#a52">lclHadNewError</a> ();
00380               
00381               parser_status = (ylparse () != 0);
00382               <a class="code" href="context_c.html#a51">context_exitLCLfile</a> ();
00383               <a class="code" href="lh_c.html#a16">lhCleanup</a> ();
00384               overallStatus = parser_status || <a class="code" href="llerror_c.html#a52">lclHadNewError</a> (); 
00385 
00386               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_DOLCS))
00387                 {
00388                   <font class="keywordflow">if</font> (overallStatus)
00389                     {
00390                       <a class="code" href="imports_c.html#a0">outputLCSFile</a> (path, <font class="stringliteral">"%%FAILED Output from "</font>,
00391                                      g_currentSpecName);
00392                     }
00393                   <font class="keywordflow">else</font>
00394                     {
00395                       <a class="code" href="imports_c.html#a0">outputLCSFile</a> (path, <font class="stringliteral">"%%PASSED Output from "</font>, 
00396                                      g_currentSpecName);
00397                     }
00398                 }
00399 
00400               (<font class="keywordtype">void</font>) <a class="code" href="source_c.html#a0">tsource_close</a> (specFile);
00401               <a class="code" href="source_c.html#a1">tsource_free</a> (specFile);
00402 
00403               <a class="code" href="symtable_c.html#a43">symtable_exitScope</a> (g_symtab);
00404             }
00405         }
00406       
00407       <a class="code" href="general_c.html#a0">sfree</a> (oactualName);
00408     } end_fileIdList_elements; 
00409   
00410     <font class="comment">/* Can cleanup lsl stuff right away */</font>
00411 
00412       lslCleanup ();
00413   
00414   g_currentSpec = cstring_undefined;
00415   g_currentSpecName = NULL;
00416 }
00417 <font class="preprocessor"># endif</font>
00418 <font class="preprocessor"></font>
00419 <font class="keyword">static</font> <font class="keywordtype">void</font> handlePassThroughFlag (<font class="keywordtype">char</font> *arg)<font class="keyword"></font>
00420 <font class="keyword"></font>{
00421   <font class="keywordtype">char</font> *curarg = arg;
00422   <font class="keywordtype">char</font> *quotechar = strchr (curarg, <font class="charliteral">'\"'</font>);
00423   <font class="keywordtype">int</font> offset = 0;
00424   <font class="keywordtype">bool</font> open = FALSE;
00425 
00426   <font class="keywordflow">while</font> (quotechar != NULL)
00427     {
00428       <font class="keywordflow">if</font> (*(quotechar - 1) == <font class="charliteral">'\\'</font>)
00429         {
00430           <font class="keywordtype">char</font> *tp = quotechar - 2;
00431           <font class="keywordtype">bool</font> escape = TRUE;
00432 
00433           <font class="keywordflow">while</font> (*tp == <font class="charliteral">'\\'</font>)
00434             {
00435               escape = !escape;
00436               tp--;
00437             }
00438           
00439           <font class="keywordflow">if</font> (escape)
00440             {
00441               curarg = quotechar + 1;
00442               quotechar = strchr (curarg, <font class="charliteral">'\"'</font>);
00443               <font class="keywordflow">continue</font>;
00444             }
00445         }
00446       
00447       *quotechar = <font class="charliteral">'\0'</font>;
00448       offset = (quotechar - arg) + 2;
00449       
00450       <font class="keywordflow">if</font> (open)
00451         {
00452           arg = cstring_toCharsSafe
00453             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s\"\'%s"</font>, 
00454                       cstring_fromChars (arg), 
00455                       <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (quotechar + 1))); 
00456           open = FALSE;
00457         }
00458       <font class="keywordflow">else</font>
00459         {
00460           arg = cstring_toCharsSafe
00461             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s\'\"%s"</font>, 
00462                       cstring_fromChars (arg), 
00463                       <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (quotechar + 1)));
00464           open = TRUE;
00465         }
00466       
00467       curarg = arg + offset;
00468       quotechar = strchr (curarg, <font class="charliteral">'\"'</font>);
00469     }
00470 
00471   <font class="keywordflow">if</font> (open)
00472     {
00473       <a class="code" href="llmain_c.html#a23">showHerald</a> ();
00474       llerror (FLG_BADFLAG,
00475                message (<font class="stringliteral">"Unclosed quote in flag: %s"</font>,
00476                         cstring_fromChars (arg)));
00477     }
00478   <font class="keywordflow">else</font>
00479     {
00480       <font class="keywordflow">if</font> (arg[0] == <font class="charliteral">'D'</font>) {
00481         cstring def;
00482         
00483         <font class="comment">/* </font>
00484 <font class="comment">        ** If the value is surrounded by single quotes ('), remove</font>
00485 <font class="comment">        ** them.  This is an artifact of UNIX command line?</font>
00486 <font class="comment">        */</font>
00487 
00488         def = <a class="code" href="osd_c.html#a17">osd_fixDefine</a> (arg + 1);
00489         DPRINTF ((<font class="stringliteral">"Do define: %s"</font>, def));
00490         <a class="code" href="cppmain_c.html#a5">cppDoDefine</a> (def);
00491         DPRINTF ((<font class="stringliteral">"After define"</font>));
00492         <a class="code" href="cstring_c.html#a27">cstring_free</a> (def);
00493       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (arg[0] == <font class="charliteral">'U'</font>) {
00494         <a class="code" href="cppmain_c.html#a6">cppDoUndefine</a> (cstring_fromChars (arg + 1));
00495       } <font class="keywordflow">else</font> {
00496         BADBRANCH;
00497       }
00498     }
00499 }
00500 
<a name="l00501"></a><a class="code" href="llmain_c.html#a23">00501</a> <font class="keywordtype">void</font> <a class="code" href="llmain_c.html#a23">showHerald</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00502 <font class="keyword"></font>{
00503   <font class="keywordflow">if</font> (hasShownHerald || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_QUIET)) <font class="keywordflow">return</font>;
00504 
00505   <font class="keywordflow">else</font>
00506     {
00507       fprintf (g_msgstream, <font class="stringliteral">"%s\n\n"</font>, LCL_VERSION);
00508       hasShownHerald = TRUE;
00509       <a class="code" href="llerror_c.html#a73">llflush</a> ();
00510     }
00511 }
00512 
00513 <font class="keyword">static</font> <font class="keywordtype">void</font> addFile (fileIdList files, <font class="comment">/*@only@*/</font> cstring s)<font class="keyword"></font>
00514 <font class="keyword"></font>{
00515   <font class="keywordflow">if</font> (<a class="code" href="fileTable_c.html#a26">fileTable_exists</a> (context_fileTable (), s))
00516     {
00517       <a class="code" href="llmain_c.html#a23">showHerald</a> ();
00518       <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"File listed multiple times: %s"</font>, s));
00519       <a class="code" href="cstring_c.html#a27">cstring_free</a> (s);
00520     }
00521   <font class="keywordflow">else</font>
00522     {
00523       fileIdList_add (files, fileTable_addFileOnly (context_fileTable (), s));
00524     }
00525 }
00526 
00527 <font class="comment">/*</font>
00528 <font class="comment">** Disable MSVC++ warning about return value.  Methinks humbly lclint control</font>
00529 <font class="comment">** comments are a mite more legible.</font>
00530 <font class="comment">*/</font>
00531 
00532 <font class="preprocessor"># ifdef WIN32</font>
00533 <font class="preprocessor"></font><font class="preprocessor"># pragma warning (disable:4035) </font>
00534 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00535 <font class="preprocessor"></font>
<a name="l00536"></a><a class="code" href="llmain_c.html#a25">00536</a> <font class="keywordtype">int</font> <a class="code" href="llmain_c.html#a25">main</a> (<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[])
00537 <font class="preprocessor"># ifdef NOLCL</font>
00538 <font class="preprocessor"></font>  <font class="comment">/*@globals killed undef g_currentloc,</font>
00539 <font class="comment">             killed undef yyin,</font>
00540 <font class="comment">                    undef g_msgstream;</font>
00541 <font class="comment">   @*/</font>
00542   <font class="comment">/*@modifies g_currentloc, fileSystem,</font>
00543 <font class="comment">              yyin; </font>
00544 <font class="comment">  @*/</font>
00545 <font class="preprocessor"># else</font>
00546 <font class="preprocessor"></font>  <font class="comment">/*@globals killed undef g_currentloc,</font>
00547 <font class="comment">             killed undef initFile,</font>
00548 <font class="comment">             killed       g_localSpecPath,  </font>
00549 <font class="comment">             killed undef g_currentSpec,</font>
00550 <font class="comment">             killed undef g_currentSpecName,</font>
00551 <font class="comment">             killed undef yyin,</font>
00552 <font class="comment">                    undef g_msgstream;</font>
00553 <font class="comment">   @*/</font>
00554   <font class="comment">/*@modifies g_currentloc, initFile, </font>
00555 <font class="comment">              g_localSpecPath, g_currentSpec, g_currentSpecName, fileSystem,</font>
00556 <font class="comment">              yyin; </font>
00557 <font class="comment">  @*/</font>
00558 <font class="preprocessor"># endif</font>
00559 <font class="preprocessor"></font>{
00560   <font class="keywordtype">bool</font> first_time = TRUE;
00561   <font class="keywordtype">bool</font> showhelp = FALSE;
00562   <font class="keywordtype">bool</font> allhelp = TRUE;
00563   <font class="keywordtype">bool</font> expsuccess;
00564   tsource *sourceFile = (tsource *) 0;
00565  
00566   fileIdList dercfiles;
00567   cstringSList fl = cstringSList_undefined;
00568   cstringSList passThroughArgs = cstringSList_undefined;
00569   fileIdList cfiles;
00570   fileIdList lclfiles;
00571   clock_t before, lcltime, libtime, pptime, cptime, rstime;
00572   <font class="keywordtype">int</font> i = 0;
00573 
00574   g_msgstream = stdout;
00575 
00576   (<font class="keywordtype">void</font>) signal (SIGINT, interrupt);
00577   (<font class="keywordtype">void</font>) signal (SIGSEGV, interrupt); 
00578 
00579   cfiles = fileIdList_create ();
00580   lclfiles = fileIdList_create ();
00581 
00582   <a class="code" href="flags_c.html#a20">flags_initMod</a> ();
00583   <a class="code" href="typeIdSet_c.html#a6">typeIdSet_initMod</a> ();
00584   <a class="code" href="cppmain_c.html#a1">cppReader_initMod</a> ();
00585 
00586   setCodePoint ();
00587 
00588   g_currentloc = <a class="code" href="fileloc_c.html#a31">fileloc_createBuiltin</a> ();
00589 
00590   before = clock ();
00591   <a class="code" href="context_c.html#a159">context_initMod</a> ();
00592   <a class="code" href="context_c.html#a29">context_setInCommandLine</a> ();
00593 
00594   <font class="keywordflow">if</font> (argc &lt;= 1)
00595     {
00596       showHelp ();
00597       <a class="code" href="llmain_c.html#a26">llexit</a> (LLGIVEUP);
00598     }
00599 
00600   setCodePoint ();
00601   yydebug = 0;
00602 
00603   <font class="comment">/*</font>
00604 <font class="comment">  ** Add include directories from environment.</font>
00605 <font class="comment">  */</font>
00606 
00607   {
00608     <font class="keywordtype">char</font> *incval = <a class="code" href="general_c.html#a27">mstring_copy</a> (osd_getEnvironmentVariable (INCLUDE_VAR));
00609 
00610     <font class="keywordflow">if</font> (incval != NULL)
00611       {
00612         <font class="comment">/*</font>
00613 <font class="comment">        ** Each directory on the include path is a system include directory.</font>
00614 <font class="comment">        */</font>
00615 
00616         DPRINTF ((<font class="stringliteral">"include: %s"</font>, incval));
00617         <a class="code" href="context_c.html#a156">context_setString</a> (FLG_SYSTEMDIRS, cstring_fromCharsNew (incval));
00618 
00619         <font class="keywordflow">while</font> (incval != NULL)
00620           {
00621             <font class="keywordtype">char</font> *nextsep = strchr (incval, SEPCHAR);
00622 
00623             <font class="keywordflow">if</font> (nextsep != NULL)
00624               {
00625                 cstring dir;
00626                 *nextsep = <font class="charliteral">'\0'</font>;
00627                 dir = cstring_fromCharsNew (incval);
00628 
00629                 <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a30">cstring_length</a> (dir) == 0
00630                     || !isalpha ((<font class="keywordtype">int</font>) <a class="code" href="cstring_c.html#a1">cstring_firstChar</a> (dir)))
00631                   {
00632                     <font class="comment">/* </font>
00633 <font class="comment">                    ** win32 environment values can have special values,</font>
00634 <font class="comment">                    ** ignore them</font>
00635 <font class="comment">                    */</font>
00636                   }
00637                 <font class="keywordflow">else</font>
00638                   {
00639                     DPRINTF ((<font class="stringliteral">"Add include: %s"</font>, dir));
00640                     <a class="code" href="cppmain_c.html#a4">cppAddIncludeDir</a> (dir);
00641                   }
00642 
00643                 *nextsep = SEPCHAR;
00644                 incval = nextsep + 1;
00645                 <a class="code" href="cstring_c.html#a27">cstring_free</a> (dir);
00646               }
00647             <font class="keywordflow">else</font>
00648               {
00649                 <font class="keywordflow">break</font>;
00650               }
00651           }
00652       }
00653   }
00654 
00655   <font class="comment">/*</font>
00656 <font class="comment">  ** check RCFILE for default flags</font>
00657 <font class="comment">  */</font>
00658 
00659   {
00660     cstring home = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (osd_getHomeDir ());
00661     <font class="keywordtype">char</font> *fname  = NULL;
00662     FILE *rcfile;
00663     <font class="keywordtype">bool</font> defaultf = TRUE;
00664     <font class="keywordtype">bool</font> nof = FALSE;
00665 
00666     <font class="keywordflow">for</font> (i = 1; i &lt; argc; i++)
00667       {
00668         <font class="keywordtype">char</font> *thisarg;
00669         thisarg = argv[i];
00670         
00671         <font class="keywordflow">if</font> (*thisarg == <font class="charliteral">'-'</font> || *thisarg == <font class="charliteral">'+'</font>)
00672           {
00673             thisarg++;
00674 
00675             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"nof"</font>))
00676               {
00677                 nof = TRUE;
00678               }
00679             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"f"</font>))
00680               {
00681                 <font class="keywordflow">if</font> (++i &lt; argc)
00682                   {
00683                     defaultf = FALSE;
00684                     fname = argv[i];
00685                     rcfile = fopen (fname, <font class="stringliteral">"r"</font>);
00686 
00687                     <font class="keywordflow">if</font> (rcfile != NULL)
00688                       {
00689                         fileloc oloc = g_currentloc;
00690                         
00691                         g_currentloc = <a class="code" href="fileloc_c.html#a24">fileloc_createRc</a> (cstring_fromChars (fname));
00692                         loadrc (rcfile, &amp;passThroughArgs);
00693                         <a class="code" href="fileloc_c.html#a9">fileloc_reallyFree</a> (g_currentloc); 
00694                         g_currentloc = oloc;
00695                       }
00696                     <font class="keywordflow">else</font> 
00697                       {
00698                         <a class="code" href="llmain_c.html#a23">showHerald</a> ();
00699                         <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Options file not found: %s"</font>, 
00700                                             cstring_fromChars (fname)));
00701                       }
00702                   }
00703                 <font class="keywordflow">else</font>
00704                   llfatalerror
00705                     (cstring_makeLiteral (<font class="stringliteral">"Flag f to select options file "</font>
00706                                           <font class="stringliteral">"requires an argument"</font>));
00707               }
00708             <font class="keywordflow">else</font>
00709               {
00710                 ; <font class="comment">/* wait to process later */</font>
00711               }
00712           }
00713       }
00714     
00715     <font class="keywordflow">if</font> (fname == NULL)
00716       {
00717         <font class="keywordflow">if</font> (!cstring_isEmpty (home)) {
00718           fname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (message (<font class="stringliteral">"%s%h%s"</font>, home, CONNECTCHAR,
00719                                                 cstring_fromChars (RCFILE)));
00720           <a class="code" href="general_c.html#a13">mstring_markFree</a> (fname);
00721         }
00722       }
00723 
00724     setCodePoint ();
00725 
00726     <font class="keywordflow">if</font> (!nof &amp;&amp; defaultf)
00727       {
00728         <font class="keywordflow">if</font> (!mstring_isEmpty (fname)) {
00729           rcfile = fopen (fname, <font class="stringliteral">"r"</font>);
00730           
00731           <font class="keywordflow">if</font> (rcfile != NULL)
00732             {
00733               fileloc oloc = g_currentloc;
00734               
00735               g_currentloc = <a class="code" href="fileloc_c.html#a24">fileloc_createRc</a> (cstring_fromChars (fname));
00736               loadrc (rcfile, &amp;passThroughArgs);
00737               <a class="code" href="fileloc_c.html#a9">fileloc_reallyFree</a> (g_currentloc);
00738               g_currentloc = oloc;
00739             }
00740         }
00741 
00742 <font class="preprocessor"># if defined(MSDOS) || defined(OS2)</font>
00743 <font class="preprocessor"></font>        fname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (message (<font class="stringliteral">"%s"</font>,
00744                                               cstring_fromChars (RCFILE)));
00745 <font class="preprocessor"># else</font>
00746 <font class="preprocessor"></font>        fname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (message (<font class="stringliteral">"./%s"</font>, 
00747                                               cstring_fromChars (RCFILE)));
00748 <font class="preprocessor"># endif</font>
00749 <font class="preprocessor"></font>
00750         rcfile = fopen (fname, <font class="stringliteral">"r"</font>);
00751 
00752         <font class="keywordflow">if</font> (rcfile != NULL)
00753           {
00754             fileloc oloc = g_currentloc;
00755 
00756             g_currentloc = <a class="code" href="fileloc_c.html#a24">fileloc_createRc</a> (cstring_fromChars (fname));
00757             loadrc (rcfile, &amp;passThroughArgs);
00758             <a class="code" href="fileloc_c.html#a9">fileloc_reallyFree</a> (g_currentloc);
00759             g_currentloc = oloc;
00760           }
00761 
00762         <a class="code" href="general_c.html#a0">sfree</a> (fname); 
00763       }
00764   }
00765   
00766   setCodePoint ();
00767   
00768   <font class="keywordflow">for</font> (i = 1; i &lt; argc; i++)
00769     {
00770       <font class="keywordtype">char</font> *thisarg;
00771       flagcode opt;
00772       
00773       thisarg = argv[i];
00774       
00775       <font class="keywordflow">if</font> (showhelp)
00776         {
00777           <font class="keywordflow">if</font> (allhelp)
00778             {
00779               <a class="code" href="llmain_c.html#a23">showHerald</a> ();
00780             }
00781           
00782           allhelp = FALSE;
00783           
00784           <font class="keywordflow">if</font> (*thisarg == <font class="charliteral">'-'</font> || *thisarg == <font class="charliteral">'+'</font>)
00785             {
00786               thisarg++;        <font class="comment">/* skip '-' */</font>
00787             }
00788           <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"modes"</font>))
00789             {
00790               <a class="code" href="llerror_c.html#a21">llmsg</a> (describeModes ());
00791             }
00792           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"vars"</font>)
00793                    || <a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"env"</font>))
00794             {
00795               describeVars ();
00796             }
00797           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"annotations"</font>))
00798             {
00799               printAnnotations ();
00800             }
00801           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"parseerrors"</font>))
00802             {
00803               printParseErrors ();
00804             }
00805           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"comments"</font>))
00806             {
00807               printComments ();
00808             }
00809           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"prefixcodes"</font>))
00810             {
00811               describePrefixCodes ();
00812             }
00813           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"references"</font>) 
00814                    || <a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"refs"</font>))
00815             {
00816               printReferences ();
00817             }
00818           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"mail"</font>))
00819             {
00820               printMail ();
00821             }
00822           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"maintainer"</font>)
00823                    || <a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"version"</font>))
00824             {
00825               printMaintainer ();
00826             }
00827           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (thisarg, <font class="stringliteral">"flags"</font>))
00828             {
00829               <font class="keywordflow">if</font> (i + 1 &lt; argc)
00830                 {
00831                   <font class="keywordtype">char</font> *next = argv[i + 1];
00832                   
00833                   <font class="keywordflow">if</font> (specialFlagsHelp (next))
00834                     {
00835                       i++;
00836                     }
00837                   <font class="keywordflow">else</font>
00838                     {
00839                       flagkind k = <a class="code" href="flags_c.html#a27">identifyCategory</a> (cstring_fromChars (next));
00840                       
00841                       <font class="keywordflow">if</font> (k != FK_NONE)
00842                         {
00843                           <a class="code" href="flags_c.html#a29">printCategory</a> (k);
00844                           i++;
00845                         }
00846                     }
00847                 }
00848               <font class="keywordflow">else</font>
00849                 {
00850                   printFlags ();
00851                 }
00852             }
00853           <font class="keywordflow">else</font>
00854             {
00855               cstring s = <a class="code" href="flags_c.html#a32">describeFlag</a> (cstring_fromChars (thisarg));
00856               
00857               <font class="keywordflow">if</font> (cstring_isDefined (s))
00858                 {
00859                   <a class="code" href="llerror_c.html#a21">llmsg</a> (s);
00860                 }
00861             }
00862         }
00863       <font class="keywordflow">else</font>
00864         {
00865           <font class="keywordflow">if</font> (*thisarg == <font class="charliteral">'-'</font> || *thisarg == <font class="charliteral">'+'</font>)
00866             {
00867               <font class="keywordtype">bool</font> set = (*thisarg == <font class="charliteral">'+'</font>);
00868               cstring flagname;
00869               
00870               thisarg++;        <font class="comment">/* skip '-' */</font>
00871               flagname = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (thisarg);
00872               
00873               opt = <a class="code" href="flags_c.html#a36">identifyFlag</a> (flagname);
00874               
00875               <font class="keywordflow">if</font> (flagcode_isSkip (opt))
00876                 {
00877                   ;
00878                 }
00879               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (flagcode_isInvalid (opt))
00880                 {
00881                   <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a40">isMode</a> (flagname))
00882                     {
00883                       <a class="code" href="context_c.html#a63">context_setMode</a> (flagname);
00884                     }
00885                   <font class="keywordflow">else</font>
00886                     {
00887                       <a class="code" href="llerror_c.html#a50">llgloberror</a> (message (<font class="stringliteral">"Unrecognized option: %s"</font>, 
00888                                             cstring_fromChars (thisarg)));
00889                     }
00890                 }
00891               <font class="keywordflow">else</font>
00892                 {
00893                   <a class="code" href="context_c.html#a185">context_userSetFlag</a> (opt, set);
00894                   
00895                   <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a41">flagcode_hasArgument</a> (opt))
00896                     {
00897                       <font class="keywordflow">if</font> (opt == FLG_HELP)
00898                         {
00899                           showhelp = TRUE;
00900                         }
00901                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (flagcode_isPassThrough (opt)) <font class="comment">/* -D or -U */</font>
00902                         { 
00903                           passThroughArgs = cstringSList_add 
00904                             (passThroughArgs, <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (thisarg));
00905                         }
00906                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a42">flagcode_hasValue</a> (opt))
00907                         {
00908                           <font class="keywordflow">if</font> (++i &lt; argc)
00909                             {
00910                               <a class="code" href="flags_c.html#a37">setValueFlag</a> (opt, cstring_fromChars (argv[i]));
00911                             }
00912                           <font class="keywordflow">else</font>
00913                             {
00914                               llfatalerror 
00915                                 (message
00916                                  (<font class="stringliteral">"Flag %s must be followed by a number"</font>,
00917                                   flagcode_unparse (opt)));
00918                             }
00919                         } 
00920                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opt == FLG_INCLUDEPATH || opt == FLG_SPECPATH)
00921                         {
00922                           cstring dir = <a class="code" href="cstring_c.html#a3">cstring_suffix</a> (cstring_fromChars (thisarg), 1); <font class="comment">/* skip over I */</font>
00923                           
00924                           <font class="keywordflow">switch</font> (opt)
00925                             {
00926                             <font class="keywordflow">case</font> FLG_INCLUDEPATH:
00927                               <a class="code" href="cppmain_c.html#a4">cppAddIncludeDir</a> (dir);
00928                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00929                             <font class="keywordflow">case</font> FLG_SPECPATH:
00930                               <font class="comment">/*@-mustfree@*/</font>
00931                               g_localSpecPath = cstring_toCharsSafe
00932                                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s%h%s"</font>, 
00933                                           cstring_fromChars (g_localSpecPath), 
00934                                           SEPCHAR,
00935                                           dir));
00936                               <font class="comment">/*@=mustfree@*/</font>
00937                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00938                               BADDEFAULT;
00939                             }
00940                         }
00941                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a43">flagcode_hasString</a> (opt)
00942                                || opt == FLG_INIT || opt == FLG_OPTF)
00943                         {
00944                           <font class="keywordflow">if</font> (++i &lt; argc)
00945                             {
00946                               cstring arg = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (argv[i]);
00947                               
00948                               <font class="keywordflow">if</font> (opt == FLG_OPTF)
00949                                 {
00950                                   ; <font class="comment">/* -f already processed */</font>
00951                                 }
00952                               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opt == FLG_INIT)
00953                                 {
00954 <font class="preprocessor"># ifndef NOLCL</font>
00955 <font class="preprocessor"></font>                                  initFile = tsource_create 
00956                                     (<a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (arg), 
00957                                      LCLINIT_SUFFIX, FALSE);
00958 <font class="preprocessor"># endif</font>
00959 <font class="preprocessor"></font>                                  <font class="keywordflow">break</font>;
00960                                 }
00961                               <font class="keywordflow">else</font>
00962                                 {
00963                                   <a class="code" href="flags_c.html#a38">setStringFlag</a> (opt, arg);
00964                                 }
00965                             }
00966                           <font class="keywordflow">else</font>
00967                             {
00968                               llfatalerror 
00969                                 (message
00970                                  (<font class="stringliteral">"Flag %s must be followed by a string"</font>,
00971                                   flagcode_unparse (opt)));
00972                             }
00973                         }
00974                       <font class="keywordflow">else</font>
00975                         {
00976                           <font class="comment">/* no argument */</font>
00977                         }
00978                     }
00979                 }
00980             }
00981           <font class="keywordflow">else</font> <font class="comment">/* its a filename */</font>
00982             {
00983               fl = <a class="code" href="cstringSList_c.html#a4">cstringSList_add</a> (fl, cstring_fromChars (thisarg));
00984             }
00985         }
00986     }
00987 
00988   setCodePoint ();  
00989 
00990   <font class="comment">/*</font>
00991 <font class="comment">  ** create lists of C and LCL files</font>
00992 <font class="comment">  */</font>
00993 
00994   cstringSList_elements (fl, current)<font class="keyword"></font>
00995 <font class="keyword">    </font>{
00996       <font class="keywordtype">char</font> *fname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (current);
00997       <font class="keywordtype">char</font> *ext = strrchr (fname, <font class="charliteral">'.'</font>);
00998 
00999       <font class="keywordflow">if</font> (ext == NULL)
01000         {
01001           <font class="comment">/* no extension --- both C and LCL with default extensions */</font>
01002           
01003           addFile (cfiles, message (<font class="stringliteral">"%s.c"</font>, cstring_fromChars (fname)));
01004           addFile (lclfiles, message (<font class="stringliteral">"%s.lcl"</font>, cstring_fromChars (fname)));
01005         }
01006       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a7">isCext</a> (ext))
01007         {
01008           addFile (cfiles, cstring_fromCharsNew (fname));
01009         }
01010       <font class="keywordflow">else</font> 
01011         {
01012           <font class="keywordflow">if</font> (!<a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".lcl"</font>))
01013             {
01014               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Unrecognized file extension: %s (assuming lcl)"</font>, 
01015                                   cstring_fromChars (ext)));
01016             }
01017 
01018           addFile (lclfiles, cstring_fromCharsNew (fname));
01019         }
01020     } end_cstringSList_elements;
01021   
01022   
01023   <a class="code" href="llmain_c.html#a23">showHerald</a> ();
01024 
01025   
01026   <font class="keywordflow">if</font> (showhelp)
01027     {
01028       <font class="keywordflow">if</font> (allhelp)
01029         {
01030           showHelp ();
01031         }
01032       fprintf (g_msgstream, <font class="stringliteral">"\n"</font>);
01033 
01034       fileIdList_free (cfiles);
01035       fileIdList_free (lclfiles);
01036       
01037       <a class="code" href="llmain_c.html#a26">llexit</a> (LLSUCCESS);
01038     }
01039 
01040 <font class="preprocessor"># ifdef DOANNOTS</font>
01041 <font class="preprocessor"></font>  initAnnots ();
01042 <font class="preprocessor"># endif</font>
01043 <font class="preprocessor"></font>
01044   inittime = clock ();
01045 
01046   <a class="code" href="context_c.html#a158">context_resetErrors</a> ();
01047   <a class="code" href="context_c.html#a30">context_clearInCommandLine</a> ();
01048 
01049   anylcl = !fileIdList_isEmpty (lclfiles);
01050 
01051   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a228">context_doMerge</a> ())
01052     {
01053       cstring m = <a class="code" href="context_c.html#a230">context_getMerge</a> ();
01054 
01055       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01056         {
01057           fprintf (g_msgstream, <font class="stringliteral">"&lt; loading %s "</font>, cstring_toCharsSafe (m));
01058         }
01059 
01060       <a class="code" href="lcllib_c.html#a11">loadState</a> (m);
01061 
01062       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01063         {
01064           fprintf (g_msgstream, <font class="stringliteral">" &gt;\n"</font>);
01065         }
01066 
01067       <font class="keywordflow">if</font> (!<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (context_getBoolName ()))
01068         {
01069           <a class="code" href="usymtab_c.html#a41">usymtab_initBool</a> (); 
01070         }
01071     }
01072   <font class="keywordflow">else</font>
01073     {
01074       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NOLIB) &amp;&amp; <a class="code" href="lcllib_c.html#a10">loadStandardState</a> ())
01075         {
01076           ;
01077         }
01078       <font class="keywordflow">else</font>
01079         {
01080           <a class="code" href="ctype_c.html#a17">ctype_initTable</a> ();
01081         }
01082 
01083       <font class="comment">/* setup bool type and constants */</font>
01084       <a class="code" href="usymtab_c.html#a41">usymtab_initBool</a> (); 
01085     }
01086 
01087   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (g_currentloc);
01088   g_currentloc = <a class="code" href="fileloc_c.html#a31">fileloc_createBuiltin</a> ();
01089 
01090   libtime = clock ();
01091   
01092   <font class="keywordflow">if</font> (anylcl)
01093     {
01094 <font class="preprocessor"># ifdef NOLCL</font>
01095 <font class="preprocessor"></font>      <a class="code" href="llerror_c.html#a48">llfatalerror</a> (cstring_makeLiteral (<font class="stringliteral">"This version of LCLint does not handle LCL files."</font>));
01096 <font class="preprocessor"># else</font>
01097 <font class="preprocessor"></font>      lslProcess (lclfiles);
01098 <font class="preprocessor"># endif</font>
01099 <font class="preprocessor"></font>    }
01100 
01101   <font class="comment">/*</font>
01102 <font class="comment">  ** pre-processing</font>
01103 <font class="comment">  **</font>
01104 <font class="comment">  ** call the pre-preprocessor and /lib/cpp to generate appropriate</font>
01105 <font class="comment">  ** files</font>
01106 <font class="comment">  **</font>
01107 <font class="comment">  */</font>
01108 
01109   <a class="code" href="context_c.html#a29">context_setInCommandLine</a> ();
01110 
01111   <a class="code" href="cppmain_c.html#a2">cppReader_initialize</a> ();
01112 
01113   DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (passThroughArgs)));
01114   
01115   cstringSList_elements (passThroughArgs, thisarg)<font class="keyword"> </font>{
01116     handlePassThroughFlag (cstring_toCharsSafe (thisarg));
01117   } end_cstringSList_elements;
01118 
01119   <a class="code" href="cstringSList_c.html#a9">cstringSList_free</a> (passThroughArgs);
01120 
01121   <a class="code" href="llerror_c.html#a32">cleanupMessages</a> ();
01122 
01123   <a class="code" href="cppmain_c.html#a7">cppReader_saveDefinitions</a> ();
01124   
01125   <a class="code" href="context_c.html#a30">context_clearInCommandLine</a> ();
01126 
01127   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NOPP))
01128     {
01129       <a class="code" href="llerror_c.html#a73">llflush</a> ();
01130 
01131       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01132         {
01133           fprintf (stderr, <font class="stringliteral">"&lt; preprocessing"</font>); 
01134         }
01135       
01136       lcltime = clock ();
01137 
01138       <a class="code" href="context_c.html#a26">context_setPreprocessing</a> ();
01139       dercfiles = preprocessFiles (cfiles);
01140       <a class="code" href="context_c.html#a27">context_clearPreprocessing</a> ();
01141 
01142       fileIdList_free (cfiles);
01143 
01144       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01145         {
01146           fprintf (stderr, <font class="stringliteral">" &gt;\n"</font>);
01147         }
01148       
01149       pptime = clock ();
01150     }
01151   <font class="keywordflow">else</font>
01152     {
01153       lcltime = clock ();
01154       dercfiles = cfiles;
01155       pptime = clock ();
01156     }
01157   
01158   <font class="comment">/*</font>
01159 <font class="comment">  ** now, check all the corresponding C files</font>
01160 <font class="comment">  **</font>
01161 <font class="comment">  ** (for now these are just &lt;file&gt;.c, but after pre-processing</font>
01162 <font class="comment">  **  will be &lt;tmpprefix&gt;.&lt;file&gt;.c)</font>
01163 <font class="comment">  */</font>
01164 
01165   {
01166 <font class="preprocessor"># ifdef WIN32</font>
01167 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nfiles = <font class="comment">/*@-unrecog@*/</font> _fcloseall (); <font class="comment">/*@=unrecog@*/</font>
01168 
01169     <font class="keywordflow">if</font> (nfiles != 0) 
01170       {
01171         llbug (message (<font class="stringliteral">"Files unclosed: %d"</font>, nfiles));
01172       }
01173 <font class="preprocessor"># endif</font>
01174 <font class="preprocessor"></font>  }
01175 
01176   <a class="code" href="exprNode_c.html#a49">exprNode_initMod</a> ();
01177 
01178   fileIdList_elements (dercfiles, fid)<font class="keyword"></font>
01179 <font class="keyword">    </font>{
01180       sourceFile = <a class="code" href="source_c.html#a2">tsource_create</a> (cstring_toCharsSafe (fileName (fid)),
01181                                    C_SUFFIX, TRUE);
01182       <a class="code" href="context_c.html#a243">context_setFileId</a> (fid);
01183       
01184       <font class="comment">/* Open source file  */</font>
01185       
01186       <font class="keywordflow">if</font> (sourceFile == (tsource *) 0 || (!<a class="code" href="source_c.html#a5">tsource_open</a> (sourceFile)))
01187         {
01188           <font class="comment">/* previously, this was ignored  ?! */</font>
01189           llbug (message (<font class="stringliteral">"Could not open temp file: %s"</font>, fileName (fid)));
01190         }
01191       <font class="keywordflow">else</font>
01192         {
01193           yyin = sourceFile-&gt;file; <font class="comment">/*&lt; shared &lt;- only */</font>
01194         
01195           llassert (yyin != NULL);
01196 
01197           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01198             {
01199                       <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"&lt; checking %s &gt;"</font>, rootFileName (fid)));
01200             }
01201           
01202           <font class="comment">/*</font>
01203 <font class="comment">          ** Every time, except the first time, through the loop,</font>
01204 <font class="comment">          ** need to call yyrestart to clean up the parse buffer.</font>
01205 <font class="comment">          */</font>
01206 
01207           <font class="keywordflow">if</font> (!first_time)
01208             {
01209               (<font class="keywordtype">void</font>) yyrestart (yyin);  
01210             }
01211           <font class="keywordflow">else</font>
01212             {
01213               first_time = FALSE;
01214             }
01215           
01216           <a class="code" href="context_c.html#a172">context_enterFile</a> ();
01217           (<font class="keywordtype">void</font>) <a class="code" href="llgrammar_tab_c.html#a1">yyparse</a> ();
01218           <a class="code" href="context_c.html#a180">context_exitFile</a> ();
01219                     
01220           (<font class="keywordtype">void</font>) <a class="code" href="source_c.html#a0">tsource_close</a> (sourceFile);
01221         }
01222       
01223     } end_fileIdList_elements;
01224 
01225   cptime = clock ();
01226   
01227   <font class="comment">/* process any leftover macros */</font>
01228 
01229   <a class="code" href="context_c.html#a177">context_processAllMacros</a> ();
01230   
01231   <font class="comment">/* check everything that was specified was defined */</font>
01232   
01233   <font class="comment">/* don't check if no c files were processed ?</font>
01234 <font class="comment">  **   is this correct behaviour?</font>
01235 <font class="comment">  */</font>
01236   
01237   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN))
01238     {
01239       <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (cstring_makeLiteral (<font class="stringliteral">"&lt; global checks &gt;"</font>));
01240     }
01241 
01242   <a class="code" href="llerror_c.html#a32">cleanupMessages</a> ();
01243   
01244   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a238">context_getLinesProcessed</a> () &gt; 0)
01245     {
01246       <a class="code" href="usymtab_c.html#a100">usymtab_allDefined</a> ();
01247     }
01248 
01249   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_TOPUNUSED))
01250     {
01251       uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (cstring_makeLiteralTemp (<font class="stringliteral">"main"</font>));
01252 
01253       <font class="keywordflow">if</font> (uentry_isValid (ue))
01254         {
01255           <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ue, fileloc_observeBuiltin ());
01256         }
01257 
01258       <a class="code" href="usymtab_c.html#a103">usymtab_allUsed</a> ();
01259     }
01260 
01261   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EXPORTLOCAL))
01262     {
01263       <a class="code" href="usymtab_c.html#a102">usymtab_exportLocal</a> ();
01264     }
01265 
01266   
01267   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EXPORTHEADER))
01268     {
01269       <a class="code" href="usymtab_c.html#a101">usymtab_exportHeader</a> ();
01270     }
01271 
01272   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWUSES))
01273     {
01274       <a class="code" href="usymtab_c.html#a149">usymtab_displayAllUses</a> ();
01275     }
01276 
01277   <a class="code" href="context_c.html#a45">context_checkSuppressCounts</a> ();
01278 
01279   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a227">context_doDump</a> ())
01280     {
01281       cstring dump = <a class="code" href="context_c.html#a229">context_getDump</a> ();
01282 
01283       <a class="code" href="lcllib_c.html#a9">dumpState</a> (dump);
01284     }
01285 
01286 <font class="preprocessor"># ifdef DOANNOTS</font>
01287 <font class="preprocessor"></font>  printAnnots ();
01288 <font class="preprocessor"># endif</font>
01289 <font class="preprocessor"></font>
01290   cleanupFiles ();
01291 
01292   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSUMMARY))
01293     {
01294       <a class="code" href="flags_c.html#a21">summarizeErrors</a> (); 
01295     }
01296 
01297   
01298   {
01299     <font class="keywordtype">bool</font> isQuiet = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_QUIET);
01300     cstring specErrors = cstring_undefined;
01301 <font class="preprocessor"># ifndef NOLCL</font>
01302 <font class="preprocessor"></font>    <font class="keywordtype">int</font> nspecErrors = <a class="code" href="llerror_c.html#a53">lclNumberErrors</a> ();
01303 <font class="preprocessor"># endif</font>
01304 <font class="preprocessor"></font>    
01305     expsuccess = TRUE;
01306 
01307     <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a208">context_neednl</a> ())
01308       fprintf (g_msgstream, <font class="stringliteral">"\n"</font>);
01309     
01310 <font class="preprocessor"># ifndef NOLCL</font>
01311 <font class="preprocessor"></font>    <font class="keywordflow">if</font> (nspecErrors &gt; 0)
01312       {
01313         <font class="keywordflow">if</font> (nspecErrors == <a class="code" href="context_c.html#a211">context_getLCLExpect</a> ())
01314           {
01315             specErrors = 
01316               <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d spec error%p found, as expected\n       "</font>, 
01317                        nspecErrors);
01318           }
01319         <font class="keywordflow">else</font>
01320           {
01321             <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a211">context_getLCLExpect</a> () &gt; 0)
01322               {
01323                 specErrors = 
01324                   <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d spec error%p found, expected %d\n       "</font>, 
01325                            nspecErrors,
01326                            (<font class="keywordtype">int</font>) <a class="code" href="context_c.html#a211">context_getLCLExpect</a> ());
01327               }
01328             <font class="keywordflow">else</font>
01329               {
01330                 specErrors = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d spec error%p found\n       "</font>,
01331                                       nspecErrors);
01332                 expsuccess = FALSE;
01333               }
01334           }
01335       }
01336     <font class="keywordflow">else</font>
01337         {
01338           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a211">context_getLCLExpect</a> () &gt; 0)
01339             {
01340               specErrors = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"No spec errors found, expected %d\n       "</font>, 
01341                                     (<font class="keywordtype">int</font>) <a class="code" href="context_c.html#a211">context_getLCLExpect</a> ());
01342               expsuccess = FALSE;
01343             }
01344         }
01345 <font class="preprocessor"># endif</font>
01346 <font class="preprocessor"></font>
01347       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a205">context_anyErrors</a> ())
01348         {
01349           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a207">context_numErrors</a> () == <a class="code" href="context_c.html#a210">context_getExpect</a> ())
01350             {
01351               <font class="keywordflow">if</font> (!isQuiet) {
01352                 <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Finished LCLint checking --- "</font>
01353                                 <font class="stringliteral">"%s%d code error%p found, as expected"</font>,
01354                                 specErrors, context_numErrors ()));
01355               }
01356             }
01357           <font class="keywordflow">else</font>
01358             {
01359               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a210">context_getExpect</a> () &gt; 0)
01360                 {
01361                   <font class="keywordflow">if</font> (!isQuiet) {
01362                     <a class="code" href="llerror_c.html#a21">llmsg</a> (message 
01363                            (<font class="stringliteral">"Finished LCLint checking --- "</font>
01364                             <font class="stringliteral">"%s%d code error%p found, expected %d"</font>,
01365                             specErrors, context_numErrors (), 
01366                             (<font class="keywordtype">int</font>) <a class="code" href="context_c.html#a210">context_getExpect</a> ()));
01367                   }
01368 
01369                   expsuccess = FALSE;
01370                 }
01371               <font class="keywordflow">else</font>
01372                 {
01373                   
01374                   <font class="keywordflow">if</font> (!isQuiet) {
01375                     <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Finished LCLint checking --- "</font>
01376                                     <font class="stringliteral">"%s%d code error%p found"</font>, 
01377                                     specErrors, context_numErrors ()));
01378                   }
01379 
01380                   expsuccess = FALSE;
01381                 }
01382             }
01383         }
01384       <font class="keywordflow">else</font>
01385         {
01386           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a210">context_getExpect</a> () &gt; 0)
01387             {
01388               <font class="keywordflow">if</font> (!isQuiet) {
01389                 <a class="code" href="llerror_c.html#a21">llmsg</a> (message
01390                        (<font class="stringliteral">"Finished LCLint checking --- "</font>
01391                         <font class="stringliteral">"%sno code errors found, expected %d"</font>, 
01392                         specErrors,
01393                         (<font class="keywordtype">int</font>) <a class="code" href="context_c.html#a210">context_getExpect</a> ()));
01394               }
01395 
01396               expsuccess = FALSE;
01397             }
01398           <font class="keywordflow">else</font>
01399             {
01400               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a238">context_getLinesProcessed</a> () &gt; 0)
01401                 {
01402                   <font class="keywordflow">if</font> (!isQuiet) {
01403                     <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Finished LCLint checking --- %sno code errors found"</font>, 
01404                                     specErrors));
01405                   }
01406                 }
01407               <font class="keywordflow">else</font>
01408                 {
01409                   <font class="keywordflow">if</font> (!isQuiet) {
01410                     <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Finished LCLint checking --- %sno code processed"</font>, 
01411                                     specErrors));
01412                   }
01413                 }
01414             }
01415         }
01416 
01417       <a class="code" href="cstring_c.html#a27">cstring_free</a> (specErrors);
01418   }
01419   
01420   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STATS))
01421     {
01422       clock_t ttime = clock () - before;
01423       <font class="keywordtype">int</font> specLines = <a class="code" href="context_c.html#a239">context_getSpecLinesProcessed</a> ();
01424       
01425       rstime = clock ();
01426       
01427       <font class="keywordflow">if</font> (specLines &gt; 0)
01428         {
01429           fprintf (g_msgstream, <font class="stringliteral">"%d spec, "</font>, specLines);
01430         }
01431       
01432 <font class="preprocessor"># ifndef CLOCKS_PER_SEC</font>
01433 <font class="preprocessor"></font>      fprintf (g_msgstream, <font class="stringliteral">"%d source lines in %ld time steps (steps/sec unknown)\n"</font>, 
01434                context_getLinesProcessed (), 
01435                (<font class="keywordtype">long</font>) ttime);
01436 <font class="preprocessor"># else</font>
01437 <font class="preprocessor"></font>      fprintf (g_msgstream, <font class="stringliteral">"%d source lines in %.2f s.\n"</font>, 
01438                context_getLinesProcessed (), 
01439                (<font class="keywordtype">double</font>) ttime / CLOCKS_PER_SEC);
01440 <font class="preprocessor"># endif</font>
01441 <font class="preprocessor"></font>    }
01442   <font class="keywordflow">else</font>
01443     {
01444       rstime = clock ();
01445     }
01446   
01447   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_TIMEDIST))
01448     {
01449       clock_t ttime = clock () - before;
01450       
01451       <font class="keywordflow">if</font> (ttime &gt; 0)
01452         {
01453           <font class="keywordtype">char</font> *msg = (<font class="keywordtype">char</font> *) dmalloc (256 * <font class="keyword">sizeof</font> (*msg));
01454           
01455           <font class="keywordflow">if</font> (anylcl)
01456             {
01457               sprintf (msg, 
01458                        <font class="stringliteral">"Time distribution (percent): initialize %.2f / lcl %.2f / "</font>
01459                        <font class="stringliteral">"pre-process %.2f / c check %.2f / finalize %.2f \n"</font>, 
01460                        (100.0 * (<font class="keywordtype">double</font>) (libtime - before) / ttime),
01461                        (100.0 * (<font class="keywordtype">double</font>) (lcltime - libtime) / ttime),
01462                        (100.0 * (<font class="keywordtype">double</font>) (pptime - lcltime) / ttime),
01463                        (100.0 * (<font class="keywordtype">double</font>) (cptime - pptime) / ttime),
01464                        (100.0 * (<font class="keywordtype">double</font>) (rstime - cptime) / ttime));
01465             }
01466           <font class="keywordflow">else</font>
01467             {
01468               sprintf (msg, 
01469                        <font class="stringliteral">"Time distribution (percent): initialize %.2f / "</font>
01470                        <font class="stringliteral">"pre-process %.2f / c check %.2f / finalize %.2f \n"</font>, 
01471                        (100.0 * (<font class="keywordtype">double</font>) (libtime - before) / ttime),
01472                        (100.0 * (<font class="keywordtype">double</font>) (pptime - libtime) / ttime),
01473                        (100.0 * (<font class="keywordtype">double</font>) (cptime - pptime) / ttime),
01474                        (100.0 * (<font class="keywordtype">double</font>) (rstime - cptime) / ttime));
01475             }
01476           
01477           <a class="code" href="llerror_c.html#a35">llgenindentmsgnoloc</a> (cstring_fromCharsO (msg));
01478         }
01479     }
01480 
01481   <a class="code" href="llmain_c.html#a26">llexit</a> (expsuccess ? LLSUCCESS : LLFAILURE);
01482 }
01483 
01484 <font class="comment">/*</font>
01485 <font class="comment">** Reenable return value warnings.</font>
01486 <font class="comment">*/</font>
01487 
01488 <font class="preprocessor">#pragma warning (default:4035)</font>
01489 <font class="preprocessor"></font>
01490 <font class="keywordtype">void</font>
01491 showHelp (<font class="keywordtype">void</font>)<font class="keyword"></font>
01492 <font class="keyword"></font>{
01493   <a class="code" href="llmain_c.html#a23">showHerald</a> ();
01494   
01495   llmsglit (<font class="stringliteral">"Source files are .c, .h and .lcl files.  If there is no suffix,"</font>);
01496   llmsglit (<font class="stringliteral">"   LCLint will look for &lt;file&gt;.c and &lt;file&gt;.lcl."</font>);
01497   llmsglit (<font class="stringliteral">""</font>);
01498   llmsglit (<font class="stringliteral">"Use lclint -help &lt;topic or flag name&gt; for more information"</font>);
01499   llmsglit (<font class="stringliteral">""</font>);
01500   llmsglit (<font class="stringliteral">"Topics:"</font>);
01501   llmsglit (<font class="stringliteral">""</font>);
01502   llmsglit (<font class="stringliteral">"   annotations (describes source-code annotations)"</font>);
01503   llmsglit (<font class="stringliteral">"   comments (describes control comments)"</font>);
01504   llmsglit (<font class="stringliteral">"   flags (describes flag categories)"</font>);
01505   llmsglit (<font class="stringliteral">"   flags &lt;category&gt; (describes flags in category)"</font>);
01506   llmsglit (<font class="stringliteral">"   flags all (short description of all flags)"</font>);
01507   llmsglit (<font class="stringliteral">"   flags alpha (list all flags alphabetically)"</font>);
01508   llmsglit (<font class="stringliteral">"   flags full (full description of all flags)"</font>);
01509   llmsglit (<font class="stringliteral">"   mail (information on mailing lists)"</font>);
01510   llmsglit (<font class="stringliteral">"   modes (show mode settings)"</font>);
01511   llmsglit (<font class="stringliteral">"   parseerrors (help on handling parser errors)"</font>);
01512   llmsglit (<font class="stringliteral">"   prefixcodes (character codes in namespace prefixes)"</font>);
01513   llmsglit (<font class="stringliteral">"   references (sources for more information)"</font>);
01514   llmsglit (<font class="stringliteral">"   vars (environment variables)"</font>); 
01515   llmsglit (<font class="stringliteral">"   version (information on compilation, maintainer)"</font>);
01516   llmsglit (<font class="stringliteral">""</font>);
01517 }
01518 
01519 <font class="keyword">static</font> <font class="keywordtype">bool</font>
01520 specialFlagsHelp (<font class="keywordtype">char</font> *next)<font class="keyword"></font>
01521 <font class="keyword"></font>{
01522   <font class="keywordflow">if</font> ((next != NULL) &amp;&amp; (*next != <font class="charliteral">'-'</font>) &amp;&amp; (*next != <font class="charliteral">'+'</font>))
01523     {
01524       <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (next, <font class="stringliteral">"alpha"</font>))
01525         {
01526           <a class="code" href="flags_c.html#a33">printAlphaFlags</a> ();
01527           <font class="keywordflow">return</font> TRUE;
01528         }
01529       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (next, <font class="stringliteral">"all"</font>))
01530         {
01531           <a class="code" href="flags_c.html#a31">printAllFlags</a> (TRUE, FALSE);
01532           <font class="keywordflow">return</font> TRUE;
01533         }
01534       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (next, <font class="stringliteral">"categories"</font>)
01535                || <a class="code" href="general_c.html#a40">mstring_equal</a> (next, <font class="stringliteral">"cats"</font>))
01536         {
01537           <a class="code" href="flags_c.html#a30">listAllCategories</a> ();
01538           <font class="keywordflow">return</font> TRUE;
01539         }
01540       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (next, <font class="stringliteral">"full"</font>))
01541         {
01542           <a class="code" href="flags_c.html#a31">printAllFlags</a> (FALSE, TRUE);
01543           <font class="keywordflow">return</font> TRUE;
01544         }
01545       <font class="keywordflow">else</font>
01546         {
01547           <font class="keywordflow">return</font> FALSE;
01548         }
01549     }
01550   <font class="keywordflow">else</font>
01551     {
01552       <font class="keywordflow">return</font> FALSE;
01553     }
01554 }
01555 
01556 <font class="keywordtype">void</font>
01557 printParseErrors (<font class="keywordtype">void</font>)<font class="keyword"></font>
01558 <font class="keyword"></font>{
01559   llmsglit (<font class="stringliteral">"Parse Errors"</font>);
01560   llmsglit (<font class="stringliteral">"------------"</font>);
01561   llmsglit (<font class="stringliteral">""</font>);
01562   llmsglit (<font class="stringliteral">"LCLint will sometimes encounter a parse error for code that "</font>
01563             <font class="stringliteral">"can be parsed with a local compiler. There are a few likely "</font>
01564             <font class="stringliteral">"causes for this and a number of techniques that can be used "</font>
01565             <font class="stringliteral">"to work around the problem."</font>);
01566   llmsglit (<font class="stringliteral">""</font>);
01567   llmsglit (<font class="stringliteral">"Compiler extensions --- compilers sometimes extend the C "</font>
01568             <font class="stringliteral">"language with compiler-specific keywords and syntax. While "</font>
01569             <font class="stringliteral">"it is not advisible to use these, oftentimes one has no choice "</font>
01570             <font class="stringliteral">"when the system header files use compiler extensions. "</font>);
01571   llmsglit (<font class="stringliteral">""</font>);
01572   llmsglit (<font class="stringliteral">"LCLint supports some of the GNU (gcc) compiler extensions, "</font>
01573             <font class="stringliteral">"if the +gnuextensions flag is set. You may be able to workaround "</font>
01574             <font class="stringliteral">"other compiler extensions by using a pre-processor define. "</font>
01575             <font class="stringliteral">"Alternately, you can surround the unparseable code with"</font>);
01576   llmsglit (<font class="stringliteral">""</font>);
01577   llmsglit (<font class="stringliteral">"   # ifndef __LCLINT__"</font>);
01578   llmsglit (<font class="stringliteral">"   ..."</font>);
01579   llmsglit (<font class="stringliteral">"   # endif"</font>);
01580   llmsglit (<font class="stringliteral">""</font>);
01581   llmsglit (<font class="stringliteral">"Missing type definitions --- an undefined type name will usually "</font>
01582             <font class="stringliteral">"lead to a parse error. This ofter occurs when a standard header "</font>
01583             <font class="stringliteral">"file defines some type that is not part of the standard library. "</font>);
01584   llmsglit (<font class="stringliteral">"By default, LCLint does not process the local files corresponding "</font>
01585             <font class="stringliteral">"to standard library headers, but uses a library specification "</font>
01586             <font class="stringliteral">"instead so dependencies on local system headers can be detected. "</font>
01587             <font class="stringliteral">"If another system header file that does not correspond to a "</font>
01588             <font class="stringliteral">"standard library header uses one of these superfluous types, "</font>
01589             <font class="stringliteral">"a parse error will result."</font>);
01590   llmsglit (<font class="stringliteral">""</font>);
01591   llmsglit (<font class="stringliteral">"If the parse error is inside a posix standard header file, the "</font>
01592             <font class="stringliteral">"first thing to try is +posixlib. This make LCLint use "</font>
01593             <font class="stringliteral">"the posix library specification instead of reading the posix "</font>
01594             <font class="stringliteral">"header files."</font>);
01595   llmsglit (<font class="stringliteral">""</font>);
01596   llmsglit (<font class="stringliteral">"Otherwise, you may need to either manually define the problematic "</font>
01597             <font class="stringliteral">"type (e.g., add -Dmlink_t=int to your .lclintrc file) or force "</font>
01598             <font class="stringliteral">"lclint to process the header file that defines it. This is done "</font>
01599             <font class="stringliteral">"by setting -skipansiheaders or -skipposixheaders before "</font>
01600             <font class="stringliteral">"the file that defines the type is #include'd."</font>);
01601   llmsglit (<font class="stringliteral">"(See lclint -help "</font>
01602             <font class="stringliteral">"skipansiheaders and lclint -help skipposixheaders for a list of "</font>
01603             <font class="stringliteral">"standard headers.)  For example, if &lt;sys/local.h&gt; uses a type "</font>
01604             <font class="stringliteral">"defined by posix header &lt;sys/types.h&gt; but not defined by the "</font>
01605             <font class="stringliteral">"posix library, we might do: "</font>);
01606   llmsglit (<font class="stringliteral">""</font>);
01607   llmsglit (<font class="stringliteral">"   /*@-skipposixheaders@*/"</font>);
01608   llmsglit (<font class="stringliteral">"   # include &lt;sys/types.h&gt;"</font>);
01609   llmsglit (<font class="stringliteral">"   /*@=skipposixheaders@*/"</font>);
01610   llmsglit (<font class="stringliteral">"   # include &lt;sys/local.h&gt;"</font>);
01611   llmsglit (<font class="stringliteral">""</font>);
01612   llmsglit (<font class="stringliteral">"to force LCLint to process &lt;sys/types.h&gt;."</font>);
01613   llmsglit (<font class="stringliteral">""</font>);
01614   llmsglit (<font class="stringliteral">"At last resort, +trytorecover can be used to make LCLint attempt "</font>
01615             <font class="stringliteral">"to continue after a parse error.  This is usually not successful "</font>
01616             <font class="stringliteral">"and the author does not consider assertion failures when +trytorecover "</font>
01617             <font class="stringliteral">"is used to be bugs."</font>);
01618 }
01619 
01620 <font class="keywordtype">void</font>
01621 printAnnotations (<font class="keywordtype">void</font>)<font class="keyword"></font>
01622 <font class="keyword"></font>{
01623   llmsglit (<font class="stringliteral">"Annotations"</font>);
01624   llmsglit (<font class="stringliteral">"-----------"</font>);
01625   llmsglit (<font class="stringliteral">""</font>);
01626   llmsglit (<font class="stringliteral">"Annotations are stylized comments that document certain "</font>
01627             <font class="stringliteral">"assumptions about functions, variables, parameters, and types. "</font>);
01628   llmsglit (<font class="stringliteral">""</font>);
01629   llmsglit (<font class="stringliteral">"They may be used to indicate where the representation of a "</font>
01630             <font class="stringliteral">"user-defined type is hidden, to limit where a global variable may "</font>
01631             <font class="stringliteral">"be used or modified, to constrain what a function implementation "</font>
01632             <font class="stringliteral">"may do to its parameters, and to express checked assumptions about "</font>
01633             <font class="stringliteral">"variables, types, structure fields, function parameters, and "</font>
01634             <font class="stringliteral">"function results."</font>);
01635   llmsglit (<font class="stringliteral">""</font>);
01636   llmsglit (<font class="stringliteral">"Annotations are introduced by \"/*@\". The role of the @ may be "</font>
01637             <font class="stringliteral">"played by any printable character, selected using -commentchar &lt;char&gt;."</font>);
01638   llmsglit (<font class="stringliteral">""</font>);
01639   llmsglit (<font class="stringliteral">"Consult the User's Guide for descriptions of checking associated with each annotation."</font>);
01640   llmsglit (<font class="stringliteral">""</font>);
01641   llmsglit (<font class="stringliteral">"Globals: (in function declarations)"</font>);
01642   llmsglit (<font class="stringliteral">"   /*@globals &lt;globitem&gt;,+ @*/"</font>);
01643   llmsglit (<font class="stringliteral">"      globitem is an identifier, internalState or fileSystem"</font>);
01644   llmsglit (<font class="stringliteral">""</font>);
01645   llmsglit (<font class="stringliteral">"Modifies: (in function declarations)"</font>);
01646   llmsglit (<font class="stringliteral">"   /*@modifies &lt;moditem&gt;,+ @*/"</font>);
01647   llmsglit (<font class="stringliteral">"      moditem is an lvalue"</font>);
01648   llmsglit (<font class="stringliteral">"   /*@modifies nothing @*/"</font>);
01649   llmsglit (<font class="stringliteral">"   /*@*/   (Abbreviation for no globals and modifies nothing.)"</font>);
01650   llmsglit (<font class="stringliteral">""</font>);
01651   llmsglit (<font class="stringliteral">"Iterators:"</font>);
01652   llmsglit (<font class="stringliteral">"   /*@iter &lt;identifier&gt; (&lt;parameter-type-list&gt;) @*/ - declare an iterator"</font>);
01653   llmsglit (<font class="stringliteral">""</font>);
01654   llmsglit (<font class="stringliteral">"Constants:"</font>);
01655   llmsglit (<font class="stringliteral">"   /*@constant &lt;declaration&gt; @*/ - declares a constant"</font>);
01656   llmsglit (<font class="stringliteral">""</font>);
01657   llmsglit (<font class="stringliteral">"Alternate Types:"</font>);
01658   llmsglit (<font class="stringliteral">"   /*@alt &lt;basic-type&gt;,+ @*/"</font>);
01659   llmsglit (<font class="stringliteral">"   (e.g., int /*@alt char@*/ is a type matching either int or char)"</font>);
01660   llmsglit (<font class="stringliteral">""</font>);
01661   llmsglit (<font class="stringliteral">"Declarator Annotations"</font>);
01662   llmsglit (<font class="stringliteral">""</font>);
01663   llmsglit (<font class="stringliteral">"Type Definitions:"</font>);
01664   llmsglit (<font class="stringliteral">"   /*@abstract@*/ - representation is hidden from clients"</font>);
01665   llmsglit (<font class="stringliteral">"   /*@concrete@*/ - representation is visible to clients"</font>);
01666   llmsglit (<font class="stringliteral">"   /*@immutable@*/ - instances of the type cannot change value"</font>);
01667   llmsglit (<font class="stringliteral">"   /*@mutable@*/ - instances of the type can change value"</font>);
01668   llmsglit (<font class="stringliteral">"   /*@refcounted@*/ - reference counted type"</font>);
01669   llmsglit (<font class="stringliteral">""</font>);
01670   llmsglit (<font class="stringliteral">"Global Variables:"</font>);
01671   llmsglit (<font class="stringliteral">"   /*@unchecked@*/ - weakest checking for global use"</font>);
01672   llmsglit (<font class="stringliteral">"   /*@checkmod@*/ - check modification by not use of global"</font>);
01673   llmsglit (<font class="stringliteral">"   /*@checked@*/ - check use and modification of global"</font>);
01674   llmsglit (<font class="stringliteral">"   /*@checkedstrict@*/ - check use of global strictly"</font>);
01675   llmsglit (<font class="stringliteral">""</font>);
01676   llmsglit (<font class="stringliteral">"Memory Management:"</font>);
01677   llmsglit (<font class="stringliteral">"   /*@dependent@*/ - a reference to externally-owned storage"</font>);
01678   llmsglit (<font class="stringliteral">"   /*@keep@*/ - a parameter that is kept by the called function"</font>);
01679   llmsglit (<font class="stringliteral">"   /*@killref@*/ - a refcounted parameter, killed by the call"</font>);
01680   llmsglit (<font class="stringliteral">"   /*@only@*/ - an unshared reference"</font>);
01681   llmsglit (<font class="stringliteral">"   /*@owned@*/ - owner of storage that may be shared by /*@dependent@*/ references"</font>);
01682   llmsglit (<font class="stringliteral">"   /*@shared@*/ - shared reference that is never deallocated"</font>);
01683   llmsglit (<font class="stringliteral">"   /*@temp@*/ - temporary parameter"</font>);
01684   llmsglit (<font class="stringliteral">""</font>);
01685   llmsglit (<font class="stringliteral">"Aliasing:"</font>);
01686   llmsglit (<font class="stringliteral">"   /*@unique@*/ - may not be aliased by any other visible reference"</font>);
01687   llmsglit (<font class="stringliteral">"   /*@returned@*/ - may be aliased by the return value"</font>);
01688   llmsglit (<font class="stringliteral">""</font>);
01689   llmsglit (<font class="stringliteral">"Exposure:"</font>);
01690   llmsglit (<font class="stringliteral">"   /*@observer@*/ - reference that cannot be modified"</font>);
01691   llmsglit (<font class="stringliteral">"   /*@exposed@*/ - exposed reference to storage in another object"</font>);
01692   llmsglit (<font class="stringliteral">""</font>);
01693   llmsglit (<font class="stringliteral">"Definition State:"</font>);
01694   llmsglit (<font class="stringliteral">"   /*@out@*/ - storage reachable from reference need not be defined"</font>);
01695   llmsglit (<font class="stringliteral">"   /*@in@*/ - all storage reachable from reference must be defined"</font>);
01696   llmsglit (<font class="stringliteral">"   /*@partial@*/ - partially defined, may have undefined fields"</font>);
01697   llmsglit (<font class="stringliteral">"   /*@reldef@*/ - relax definition checking"</font>);
01698   llmsglit (<font class="stringliteral">""</font>);
01699   llmsglit (<font class="stringliteral">"Global State: (for globals lists, no /*@, since list is already in /*@\'s)"</font>);
01700   llmsglit (<font class="stringliteral">"   undef - variable is undefined before the call"</font>);
01701   llmsglit (<font class="stringliteral">"   killed - variable is undefined after the call"</font>);
01702   llmsglit (<font class="stringliteral">""</font>);
01703   llmsglit (<font class="stringliteral">"Null State:"</font>);
01704   llmsglit (<font class="stringliteral">"   /*@null@*/ - possibly null pointer"</font>);
01705   llmsglit (<font class="stringliteral">"   /*@notnull@*/ - non-null pointer"</font>);
01706   llmsglit (<font class="stringliteral">"   /*@relnull@*/ - relax null checking"</font>);
01707   llmsglit (<font class="stringliteral">""</font>);
01708   llmsglit (<font class="stringliteral">"Null Predicates:"</font>);
01709   llmsglit (<font class="stringliteral">"   /*@truenull@*/ - if result is TRUE, first parameter is NULL"</font>);
01710   llmsglit (<font class="stringliteral">"   /*@falsenull@*/ - if result is TRUE, first parameter is not NULL"</font>);
01711   llmsglit (<font class="stringliteral">""</font>);
01712   llmsglit (<font class="stringliteral">"Execution:"</font>);
01713   llmsglit (<font class="stringliteral">"   /*@exits@*/ - function never returns"</font>);
01714   llmsglit (<font class="stringliteral">"   /*@mayexit@*/ - function may or may not return"</font>);
01715   llmsglit (<font class="stringliteral">"   /*@trueexit@*/ - function does not return if first parameter is TRUE"</font>);
01716   llmsglit (<font class="stringliteral">"   /*@falseexit@*/ - function does not return if first parameter if FALSE"</font>);
01717   llmsglit (<font class="stringliteral">"   /*@neverexit@*/ - function always returns"</font>);
01718   llmsglit (<font class="stringliteral">""</font>);
01719   llmsglit (<font class="stringliteral">"Side-Effects:"</font>);
01720   llmsglit (<font class="stringliteral">"   /*@sef@*/ - corresponding actual parameter has no side effects"</font>);
01721   llmsglit (<font class="stringliteral">""</font>);
01722   llmsglit (<font class="stringliteral">"Declaration:"</font>);
01723   llmsglit (<font class="stringliteral">"   /*@unused@*/ - need not be used (no unused errors reported)"</font>);
01724   llmsglit (<font class="stringliteral">"   /*@external@*/ - defined externally (no undefined error reported)"</font>);
01725   llmsglit (<font class="stringliteral">""</font>);
01726   llmsglit (<font class="stringliteral">"Case:"</font>);
01727   llmsglit (<font class="stringliteral">"   /*@fallthrough@*/ - fall-through case"</font>);
01728   llmsglit (<font class="stringliteral">""</font>);
01729   llmsglit (<font class="stringliteral">"Break:"</font>);
01730   llmsglit (<font class="stringliteral">"   /*@innerbreak@*/ - break is breaking an inner loop or switch"</font>);
01731   llmsglit (<font class="stringliteral">"   /*@loopbreak@*/ - break is breaking a loop"</font>);
01732   llmsglit (<font class="stringliteral">"   /*@switchbreak@*/ - break is breaking a switch"</font>);
01733   llmsglit (<font class="stringliteral">"   /*@innercontinue@*/ - continue is continuing an inner loop"</font>);
01734   llmsglit (<font class="stringliteral">""</font>);
01735   llmsglit (<font class="stringliteral">"Unreachable Code:"</font>);
01736   llmsglit (<font class="stringliteral">"   /*@notreached@*/ - statement may be unreachable."</font>);
01737   llmsglit (<font class="stringliteral">""</font>);
01738   llmsglit (<font class="stringliteral">"Special Functions:"</font>);
01739   llmsglit (<font class="stringliteral">"   /*@printflike@*/ - check variable arguments like printf"</font>);
01740   llmsglit (<font class="stringliteral">"   /*@scanflike@*/ - check variable arguments like scanf"</font>);
01741 }
01742 
01743 <font class="keywordtype">void</font>
01744 printComments (<font class="keywordtype">void</font>)<font class="keyword"></font>
01745 <font class="keyword"></font>{
01746   llmsglit (<font class="stringliteral">"Control Comments"</font>);
01747   llmsglit (<font class="stringliteral">"----------------"</font>);
01748   llmsglit (<font class="stringliteral">""</font>);
01749   llmsglit (<font class="stringliteral">"Setting Flags"</font>);
01750   llmsglit (<font class="stringliteral">""</font>);
01751   llmsglit (<font class="stringliteral">"Most flags (all except those characterized as \"globally-settable only\") can be set locally using control comments. A control comment can set flags locally to override the command line settings. The original flag settings are restored before processing the next file."</font>);
01752   llmsglit (<font class="stringliteral">""</font>);
01753   llmsglit (<font class="stringliteral">"The syntax for setting flags in control comments is the same as that of the command line, except that flags may also be preceded by = to restore their setting to the original command-line value. For instance,"</font>);
01754   llmsglit (<font class="stringliteral">"   /*@+boolint -modifies =showfunc@*/"</font>);
01755   llmsglit (<font class="stringliteral">"sets boolint on (this makes bool and int indistinguishable types), sets modifies off (this prevents reporting of modification errors), and sets showfunc to its original setting (this controls  whether or not the name of a function is displayed before a message)."</font>);
01756   llmsglit (<font class="stringliteral">""</font>);
01757   llmsglit (<font class="stringliteral">"Error Suppression"</font>);
01758   llmsglit (<font class="stringliteral">""</font>);
01759   llmsglit (<font class="stringliteral">"Several comments are provided for suppressing messages. In general, it is usually better to use specific flags to suppress a particular error permanently, but the general error suppression flags may be more convenient for quickly suppressing messages for code that will be corrected or documented later."</font>);
01760   llmsglit (<font class="stringliteral">""</font>);
01761   llmsglit (<font class="stringliteral">"/*@ignore@*/ ... /*@end@*/"</font>);
01762   llgenindentmsgnoloc
01763     (cstring_makeLiteral 
01764      (<font class="stringliteral">"No errors will be reported in code regions between /*@ignore@*/ and /*@end@*/. These comments can be used to easily suppress an unlimited number of messages."</font>));
01765   llmsglit (<font class="stringliteral">"/*@i@*/"</font>);
01766     llgenindentmsgnoloc
01767     (cstring_makeLiteral 
01768      (<font class="stringliteral">"No errors will be reported from an /*@i@*/ comment to the end of the line."</font>));
01769   llmsglit (<font class="stringliteral">"/*@i&lt;n&gt;@*/"</font>);
01770   llgenindentmsgnoloc
01771     (cstring_makeLiteral 
01772      (<font class="stringliteral">"No errors will be reported from an /*@i&lt;n&gt;@*/ (e.g., /*@i3@*/) comment to the end of the line. If there are not exactly n errors suppressed from the comment point to the end of the line, LCLint will report an error."</font>));
01773   llmsglit (<font class="stringliteral">"/*@t@*/, /*@t&lt;n&gt;@*/"</font>);
01774   llgenindentmsgnoloc
01775     (cstring_makeLiteral 
01776      (<font class="stringliteral">"Like i and i&lt;n&gt;, except controlled by +tmpcomments flag. These can be used to temporarily suppress certain errors. Then, -tmpcomments can be set to find them again."</font>));
01777   llmsglit (<font class="stringliteral">""</font>);
01778   llmsglit (<font class="stringliteral">"Type Access"</font>);
01779   llmsglit (<font class="stringliteral">""</font>);
01780   llmsglit (<font class="stringliteral">"/*@access &lt;type&gt;@*/"</font>); 
01781   llmsglit (<font class="stringliteral">"   Allows the following code to access the representation of &lt;type&gt;"</font>);
01782   llmsglit (<font class="stringliteral">"/*@noaccess &lt;type&gt;@*/"</font>);
01783   llmsglit (<font class="stringliteral">"   Hides the representation of &lt;type&gt;"</font>);
01784   llmsglit (<font class="stringliteral">""</font>);
01785   llmsglit (<font class="stringliteral">"Macro Expansion"</font>);
01786   llmsglit (<font class="stringliteral">""</font>);
01787   llmsglit (<font class="stringliteral">"/*@notfunction@*/"</font>);
01788   llgenindentmsgnoloc 
01789     (cstring_makeLiteral
01790      (<font class="stringliteral">"Indicates that the next macro definition is not intended to be a "</font>
01791       <font class="stringliteral">"function, and should be expanded in line instead of checked as a "</font>
01792       <font class="stringliteral">"macro function definition."</font>));
01793 }
01794 
01795   
01796 <font class="keywordtype">void</font>
01797 printFlags (<font class="keywordtype">void</font>)<font class="keyword"></font>
01798 <font class="keyword"></font>{
01799   llmsglit (<font class="stringliteral">"Flag Categories"</font>);
01800   llmsglit (<font class="stringliteral">"---------------"</font>);
01801   <a class="code" href="flags_c.html#a30">listAllCategories</a> ();
01802   llmsglit (<font class="stringliteral">"\nTo see the flags in a flag category, do\n   lclint -help flags &lt;category&gt;"</font>);
01803   llmsglit (<font class="stringliteral">"To see a list of all flags in alphabetical order, do\n   lclint -help flags alpha"</font>);
01804   llmsglit (<font class="stringliteral">"To see a full description of all flags, do\n   lclint -help flags full"</font>);
01805 }
01806 
01807 <font class="keywordtype">void</font>
01808 printMaintainer (<font class="keywordtype">void</font>)<font class="keyword"></font>
01809 <font class="keyword"></font>{
01810   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Maintainer: %s"</font>, cstring_makeLiteralTemp (LCLINT_MAINTAINER)));
01811   llmsglit (LCL_COMPILE);
01812 }
01813 
01814 <font class="keywordtype">void</font>
01815 printMail (<font class="keywordtype">void</font>)<font class="keyword"></font>
01816 <font class="keyword"></font>{
01817   llmsglit (<font class="stringliteral">"Mailing Lists"</font>);
01818   llmsglit (<font class="stringliteral">"-------------"</font>);
01819   llmsglit (<font class="stringliteral">""</font>);
01820   llmsglit (<font class="stringliteral">"There are two mailing lists associated with LCLint: "</font>);
01821   llmsglit (<font class="stringliteral">""</font>);
01822   llmsglit (<font class="stringliteral">"   lclint-announce@virginia.edu"</font>);
01823   llmsglit (<font class="stringliteral">""</font>);
01824   llmsglit (<font class="stringliteral">"      Reserved for announcements of new releases and bug fixes."</font>);
01825   llmsglit (<font class="stringliteral">"      To subscribe, send a message to majordomo@virginia.edu with body: "</font>);
01826   llmsglit (<font class="stringliteral">"           subscribe lclint-announce"</font>);
01827   llmsglit (<font class="stringliteral">""</font>);
01828   llmsglit (<font class="stringliteral">"   lclint-interest@virginia.edu"</font>);
01829   llmsglit (<font class="stringliteral">""</font>);
01830   llmsglit (<font class="stringliteral">"      Informal discussions on the use and development of lclint."</font>);
01831   llmsglit (<font class="stringliteral">"      To subscribe, send a message to majordomo@virginia.edu with body: "</font>);
01832   llmsglit (<font class="stringliteral">"           subscribe lclint-interest"</font>);
01833 }
01834 
01835 <font class="keywordtype">void</font>
01836 printReferences (<font class="keywordtype">void</font>)<font class="keyword"></font>
01837 <font class="keyword"></font>{
01838   llmsglit (<font class="stringliteral">"References"</font>);
01839   llmsglit (<font class="stringliteral">"----------"</font>);
01840   llmsglit (<font class="stringliteral">""</font>);
01841   llmsglit (<font class="stringliteral">"The LCLint web site is http://lclint.cs.virginia.edu"</font>);
01842   llmsglit (<font class="stringliteral">""</font>);
01843   llmsglit (<font class="stringliteral">"Technical papers relating to LCLint include:"</font>);
01844   llmsglit (<font class="stringliteral">""</font>);
01845   llmsglit (<font class="stringliteral">"   David Evans. \"Static Detection of Dynamic Memory Errors\"."</font>);  
01846   llmsglit (<font class="stringliteral">"   SIGPLAN Conference on Programming Language Design and "</font>);
01847   llmsglit (<font class="stringliteral">"   Implementation (PLDI '96), Philadelphia, PA, May 1996."</font>);
01848   llmsglit (<font class="stringliteral">""</font>);
01849   llmsglit (<font class="stringliteral">"   David Evans, John Guttag, Jim Horning and Yang Meng Tan. "</font>);
01850   llmsglit (<font class="stringliteral">"   \"LCLint: A Tool for Using Specifications to Check Code\"."</font>);
01851   llmsglit (<font class="stringliteral">"   SIGSOFT Symposium on the Foundations of Software Engineering,"</font>);
01852   llmsglit (<font class="stringliteral">"   December 1994."</font>);
01853   llmsglit (<font class="stringliteral">""</font>);
01854   llmsglit (<font class="stringliteral">"A general book on Larch is:"</font>);
01855   llmsglit (<font class="stringliteral">""</font>);
01856   llmsglit (<font class="stringliteral">"   Guttag, John V., Horning, James J., (with Garland, S. J., Jones, "</font>);
01857   llmsglit (<font class="stringliteral">"   K. D., Modet, A., and Wing, J. M.), \"Larch: Languages and Tools "</font>);
01858   llmsglit (<font class="stringliteral">"   for Formal Specification\", Springer-Verlag, 1993."</font>);
01859 }
01860 
01861 <font class="keywordtype">void</font>
01862 describePrefixCodes (<font class="keywordtype">void</font>)<font class="keyword"></font>
01863 <font class="keyword"></font>{
01864   llmsglit (<font class="stringliteral">"Prefix Codes"</font>);
01865   llmsglit (<font class="stringliteral">"------------"</font>);
01866   llmsglit (<font class="stringliteral">""</font>);
01867   llmsglit (<font class="stringliteral">"These characters have special meaning in name prefixes:"</font>);
01868   llmsglit (<font class="stringliteral">""</font>);
01869   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any uppercase letter [A-Z]"</font>, PFX_UPPERCASE));
01870   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any lowercase letter [a-z]"</font>, PFX_LOWERCASE));
01871   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any character (valid in a C identifier)"</font>, PFX_ANY));
01872   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any digit [0-9]"</font>, PFX_DIGIT));
01873   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any non-uppercase letter [a-z0-9_]"</font>, PFX_NOTUPPER));
01874   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any non-lowercase letter [A-Z0-9_]"</font>, PFX_NOTLOWER));
01875   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any letter [A-Za-z]"</font>, PFX_ANYLETTER));
01876   <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"   %h  Any letter or digit [A-Za-z0-9]"</font>, PFX_ANYLETTERDIGIT));
01877   llmsglit (<font class="stringliteral">"   *  Zero or more repetitions of the previous character class until the end of the name"</font>);
01878 }
01879 
01880 <font class="keywordtype">void</font>
01881 describeVars (<font class="keywordtype">void</font>)<font class="keyword"></font>
01882 <font class="keyword"></font>{
01883   cstring eval;
01884   <font class="keywordtype">char</font> *def;
01885 
01886   eval = <a class="code" href="context_c.html#a249">context_getLarchPath</a> ();
01887   def = <a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (LARCH_PATH);
01888 
01889   <font class="keywordflow">if</font> (def != NULL || 
01890       !<a class="code" href="cstring_c.html#a18">cstring_equal</a> (eval, cstring_fromChars (DEFAULT_LARCHPATH)))
01891     {
01892       <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"LARCH_PATH = %s"</font>, eval));
01893     }
01894   <font class="keywordflow">else</font>
01895     {
01896       <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"LARCH_PATH = &lt;not set&gt; (default = %s)"</font>,
01897                       cstring_fromChars (DEFAULT_LARCHPATH)));
01898     }
01899   
01900   llmsglit (<font class="stringliteral">"   --- path used to find larch initialization files and LSL traits"</font>);
01901 
01902   eval = <a class="code" href="context_c.html#a250">context_getLCLImportDir</a> ();
01903   def = <a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (LCLIMPORTDIR);
01904 
01905   <font class="keywordflow">if</font> (def != NULL ||
01906       !<a class="code" href="cstring_c.html#a18">cstring_equal</a> (eval, cstring_fromChars (DEFAULT_LCLIMPORTDIR)))
01907     {
01908       <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"%q = %s"</font>, cstring_makeLiteral (LCLIMPORTDIR), eval));
01909     }
01910   <font class="keywordflow">else</font>
01911     {
01912       <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"%s = &lt;not set, default: %s&gt;"</font>, cstring_makeLiteralTemp (LCLIMPORTDIR), 
01913                       cstring_makeLiteralTemp (DEFAULT_LCLIMPORTDIR))); 
01914     }
01915   
01916   llmsglit (<font class="stringliteral">"   --- directory containing lcl standard library files "</font>
01917             <font class="stringliteral">"(import with &lt; ... &gt;)"</font>);;
01918 
01919   {
01920     cstring dirs = <a class="code" href="context_c.html#a157">context_getString</a> (FLG_SYSTEMDIRS);
01921     <a class="code" href="llerror_c.html#a21">llmsg</a> (message 
01922            (<font class="stringliteral">"systemdirs = %s (set by include envirnoment variable or -systemdirs)"</font>,
01923             dirs));
01924 
01925   }
01926 }
01927 
01928 <font class="keywordtype">void</font>
01929 interrupt (<font class="keywordtype">int</font> i)<font class="keyword"></font>
01930 <font class="keyword"></font>{
01931   <font class="keywordflow">switch</font> (i)
01932     {
01933     <font class="keywordflow">case</font> SIGINT:
01934       fprintf (stderr, <font class="stringliteral">"*** Interrupt\n"</font>);
01935       <a class="code" href="llmain_c.html#a26">llexit</a> (LLINTERRUPT);
01936     <font class="keywordflow">case</font> SIGSEGV:
01937       {
01938         cstring loc;
01939         
01940         <font class="comment">/* Cheat when there are parse errors */</font>
01941         <a class="code" href="llerror_c.html#a45">checkParseError</a> (); 
01942         
01943         fprintf (stderr, <font class="stringliteral">"*** Segmentation Violation\n"</font>);
01944         
01945         <font class="comment">/* Don't catch it if fileloc_unparse causes a signal */</font>
01946         (<font class="keywordtype">void</font>) signal (SIGSEGV, NULL);
01947 
01948         loc = <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (g_currentloc);
01949         
01950         fprintf (stderr, <font class="stringliteral">"*** Location (not trusted): %s\n"</font>, 
01951                  cstring_toCharsSafe (loc));
01952         <a class="code" href="cstring_c.html#a27">cstring_free</a> (loc);
01953         <a class="code" href="globals_c.html#a11">printCodePoint</a> ();
01954         fprintf (stderr, <font class="stringliteral">"*** Please report bug to %s\n"</font>, LCLINT_MAINTAINER);
01955         exit (LLGIVEUP);
01956       }
01957     <font class="keywordflow">default</font>:
01958       fprintf (stderr, <font class="stringliteral">"*** Signal: %d\n"</font>, i);
01959       <font class="comment">/*@-mustfree@*/</font>
01960       fprintf (stderr, <font class="stringliteral">"*** Location (not trusted): %s\n"</font>, 
01961                cstring_toCharsSafe (fileloc_unparse (g_currentloc)));
01962       <font class="comment">/*@=mustfree@*/</font>
01963       <a class="code" href="globals_c.html#a11">printCodePoint</a> ();
01964       fprintf (stderr, <font class="stringliteral">"*** Please report bug to %s ***\n"</font>, LCLINT_MAINTAINER);
01965       exit (LLGIVEUP);
01966     }
01967 }
01968 
01969 <font class="keywordtype">void</font>
01970 cleanupFiles (<font class="keywordtype">void</font>)<font class="keyword"></font>
01971 <font class="keyword"></font>{
01972   <font class="keyword">static</font> <font class="keywordtype">bool</font> doneCleanup = FALSE;
01973 
01974   <font class="comment">/* make sure this is only called once! */</font>
01975 
01976   <font class="keywordflow">if</font> (doneCleanup) <font class="keywordflow">return</font>;
01977 
01978   setCodePoint ();
01979 
01980   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_KEEP))
01981     {
01982       check (fputs (<font class="stringliteral">"Temporary files kept:\n"</font>, stderr) != EOF);
01983       <a class="code" href="fileTable_c.html#a7">fileTable_printTemps</a> (context_fileTable ());
01984     }
01985   <font class="keywordflow">else</font>
01986     {
01987 <font class="preprocessor"># ifdef WIN32</font>
01988 <font class="preprocessor"></font>      <font class="keywordtype">int</font> nfiles = <font class="comment">/*@-unrecog@*/</font> _fcloseall (); <font class="comment">/*@=unrecog@*/</font>
01989       
01990       <font class="keywordflow">if</font> (nfiles != 0) 
01991         {
01992           llbug (message (<font class="stringliteral">"Files unclosed: %d"</font>, nfiles));
01993         }
01994 <font class="preprocessor"># endif</font>
01995 <font class="preprocessor"></font>      <a class="code" href="fileTable_c.html#a33">fileTable_cleanup</a> (context_fileTable ());
01996     }
01997 
01998   doneCleanup = TRUE;
01999 }
02000 
02001 <font class="comment">/*</font>
02002 <font class="comment">** cleans up temp files (if necessary)</font>
02003 <font class="comment">** exits lclint</font>
02004 <font class="comment">*/</font>
02005 
02006 <font class="comment">/*@exits@*/</font> <font class="keywordtype">void</font>
<a name="l02007"></a><a class="code" href="llmain_c.html#a26">02007</a> <a class="code" href="llmain_c.html#a26">llexit</a> (<font class="keywordtype">int</font> status)<font class="keyword"></font>
02008 <font class="keyword"></font>{
02009   DPRINTF ((<font class="stringliteral">"llexit: %d"</font>, status));
02010 
02011 <font class="preprocessor"># ifdef WIN32</font>
02012 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (status == LLFAILURE) 
02013     {
02014       _fcloseall ();
02015     }
02016 <font class="preprocessor"># endif</font>
02017 <font class="preprocessor"></font>
02018   cleanupFiles ();
02019 
02020   <font class="keywordflow">if</font> (status != LLFAILURE)
02021     {
02022       <a class="code" href="context_c.html#a193">context_destroyMod</a> ();
02023       <a class="code" href="exprNode_c.html#a50">exprNode_destroyMod</a> ();
02024       
02025       <a class="code" href="sRef_c.html#a87">sRef_destroyMod</a> ();
02026       <a class="code" href="uentry_c.html#a129">uentry_destroyMod</a> ();
02027       <a class="code" href="typeIdSet_c.html#a7">typeIdSet_destroyMod</a> ();
02028       
02029 <font class="preprocessor"># ifdef USEDMALLOC</font>
02030 <font class="preprocessor"></font>      dmalloc_shutdown ();
02031 <font class="preprocessor"># endif</font>
02032 <font class="preprocessor"></font>    }
02033 
02034   exit ((status == LLSUCCESS) ? EXIT_SUCCESS : EXIT_FAILURE);
02035 }
02036 
02037 <font class="keywordtype">void</font>
02038 loadrc (FILE *rcfile, cstringSList *passThroughArgs)<font class="keyword"></font>
02039 <font class="keyword"></font>{
02040   <font class="keywordtype">char</font> *s = <a class="code" href="general_c.html#a29">mstring_create</a> (MAX_LINE_LENGTH);
02041   <font class="keywordtype">char</font> *os = s;
02042 
02043   DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02044 
02045   s = os;
02046 
02047   <font class="keywordflow">while</font> (fgets (s, MAX_LINE_LENGTH, rcfile) != NULL)
02048     {
02049       <font class="keywordtype">char</font> c;
02050       <font class="keywordtype">bool</font> set = FALSE;     
02051       <font class="keywordtype">char</font> *thisflag;
02052       flagcode opt;
02053 
02054       DPRINTF ((<font class="stringliteral">"Line: %s"</font>, s));
02055       DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02056       incLine ();
02057             
02058       <font class="keywordflow">while</font> (*s == <font class="charliteral">' '</font> || *s == <font class="charliteral">'\t'</font> || *s == <font class="charliteral">'\n'</font>) 
02059         {
02060           s++;
02061           incColumn ();
02062         }
02063       
02064       <font class="keywordflow">while</font> (*s != <font class="charliteral">'\0'</font>)
02065         {
02066           <font class="keywordtype">bool</font> escaped = FALSE;
02067           <font class="keywordtype">bool</font> quoted = FALSE;
02068           c = *s;
02069 
02070           DPRINTF ((<font class="stringliteral">"Process: %s"</font>, s));
02071           DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02072           <font class="comment">/* comment characters */</font>
02073           <font class="keywordflow">if</font> (c == <font class="charliteral">'#'</font> || c == <font class="charliteral">';'</font> || c == <font class="charliteral">'\n'</font>) 
02074             {
02075               <font class="comment">/*@innerbreak@*/</font>
02076               <font class="keywordflow">break</font>;
02077             }
02078           
02079           <font class="keywordflow">if</font> (c == <font class="charliteral">'-'</font> || c == <font class="charliteral">'+'</font>)
02080             {
02081               set = (c == <font class="charliteral">'+'</font>);
02082             }
02083           <font class="keywordflow">else</font>
02084             {
02085               <a class="code" href="llmain_c.html#a23">showHerald</a> ();
02086               llerror (FLG_SYNTAX, 
02087                        message (<font class="stringliteral">"Bad flag syntax (+ or - expected, "</font>
02088                                 <font class="stringliteral">"+ is assumed): %s"</font>, 
02089                                 cstring_fromChars (s)));
02090               s--;
02091               set = TRUE;
02092             }
02093           
02094           s++;
02095           incColumn ();
02096           
02097           thisflag = s;
02098           
02099           <font class="keywordflow">while</font> ((c = *s) != <font class="charliteral">'\0'</font>)
02100             { <font class="comment">/* remember to handle spaces and quotes in -D and -U ... */</font>
02101               <font class="keywordflow">if</font> (escaped)
02102                 {
02103                   escaped = FALSE;
02104                 }
02105               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (quoted)
02106                 {
02107                   <font class="keywordflow">if</font> (c == <font class="charliteral">'\\'</font>)
02108                     {
02109                       escaped = TRUE;
02110                     }
02111                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (c == <font class="charliteral">'\"'</font>)
02112                     {
02113                       quoted = FALSE;
02114                     }
02115                   <font class="keywordflow">else</font>
02116                     {
02117                       ;
02118                     }
02119                 }
02120               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (c == <font class="charliteral">'\"'</font>)
02121                 {
02122                   quoted = TRUE;
02123                 }
02124               <font class="keywordflow">else</font>
02125                 {
02126                  <font class="keywordflow">if</font> (c == <font class="charliteral">' '</font> || c == <font class="charliteral">'\t'</font> || c == <font class="charliteral">'\n'</font>)
02127                    {
02128                      <font class="comment">/*@innerbreak@*/</font> <font class="keywordflow">break</font>;
02129                    }
02130                }
02131                   
02132               s++; 
02133               incColumn ();
02134             }
02135 
02136           DPRINTF ((<font class="stringliteral">"Nulling: %c"</font>, *s));
02137           *s = <font class="charliteral">'\0'</font>;
02138 
02139           <font class="keywordflow">if</font> (mstring_isEmpty (thisflag))
02140             {
02141               <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"Missing flag: %s"</font>,
02142                                      cstring_fromChars (os)));
02143             }
02144 
02145           DPRINTF ((<font class="stringliteral">"Flag: %s"</font>, thisflag));
02146 
02147           opt = <a class="code" href="flags_c.html#a36">identifyFlag</a> (cstring_fromChars (thisflag));
02148           
02149           <font class="keywordflow">if</font> (flagcode_isSkip (opt))
02150             {
02151               ;
02152             }
02153           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (flagcode_isInvalid (opt))
02154             {
02155               <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a40">isMode</a> (cstring_fromChars (thisflag)))
02156                 {
02157                   <a class="code" href="context_c.html#a63">context_setMode</a> (cstring_fromChars (thisflag));
02158                 }
02159               <font class="keywordflow">else</font>
02160                 {
02161                   llerror (FLG_BADFLAG,
02162                            message (<font class="stringliteral">"Unrecognized option: %s"</font>, 
02163                                     cstring_fromChars (thisflag)));
02164                 }
02165             }
02166           <font class="keywordflow">else</font>
02167             {
02168               <a class="code" href="context_c.html#a185">context_userSetFlag</a> (opt, set);
02169 
02170               <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a41">flagcode_hasArgument</a> (opt))
02171                 {
02172                   <font class="keywordflow">if</font> (opt == FLG_HELP)
02173                     {
02174                       <a class="code" href="llmain_c.html#a23">showHerald</a> ();
02175                       llerror (FLG_BADFLAG,
02176                                message (<font class="stringliteral">"Cannot use help in rc files"</font>));
02177                     }
02178                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (flagcode_isPassThrough (opt)) <font class="comment">/* -D or -U */</font>
02179                     {
02180                       cstring arg = cstring_fromCharsNew (thisflag);
02181                       <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (arg);
02182                       *passThroughArgs = <a class="code" href="cstringSList_c.html#a4">cstringSList_add</a> (*passThroughArgs, arg);
02183                       DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>,
02184                                 cstringSList_unparse (*passThroughArgs)));
02185                     }
02186                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opt == FLG_INCLUDEPATH 
02187                            || opt == FLG_SPECPATH)
02188                     {
02189                       cstring dir = <a class="code" href="cstring_c.html#a3">cstring_suffix</a> (cstring_fromChars (thisflag), 1); <font class="comment">/* skip over I/S */</font>
02190                                       
02191                       <font class="keywordflow">switch</font> (opt)
02192                         {
02193                         <font class="keywordflow">case</font> FLG_INCLUDEPATH:
02194                           <a class="code" href="cppmain_c.html#a4">cppAddIncludeDir</a> (dir);
02195                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
02196                         <font class="keywordflow">case</font> FLG_SPECPATH:
02197                           <font class="comment">/*@-mustfree@*/</font>
02198                           g_localSpecPath = cstring_toCharsSafe
02199                             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s:%s"</font>, cstring_fromChars (g_localSpecPath), dir));
02200                           <font class="comment">/*@=mustfree@*/</font>
02201                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
02202                           BADDEFAULT;
02203                         }
02204                     }
02205                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a43">flagcode_hasString</a> (opt)
02206                            || <a class="code" href="flags_c.html#a42">flagcode_hasValue</a> (opt)
02207                            || opt == FLG_INIT || opt == FLG_OPTF)
02208                     {
02209                       cstring extra = cstring_undefined;
02210                       <font class="keywordtype">char</font> *rest, *orest;
02211                       <font class="keywordtype">char</font> rchar;
02212                       
02213                       *s = c;
02214                       rest = <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
02215                       DPRINTF ((<font class="stringliteral">"Here: rest = %s"</font>, rest));
02216                       orest = rest;
02217                       *s = <font class="charliteral">'\0'</font>;
02218                       
02219                       <font class="keywordflow">while</font> ((rchar = *rest) != <font class="charliteral">'\0'</font>
02220                              &amp;&amp; (isspace ((<font class="keywordtype">int</font>) rchar)))
02221                         {
02222                           rest++;
02223                           s++;
02224                         }
02225                       
02226                       DPRINTF ((<font class="stringliteral">"Yo: %s"</font>, rest));
02227 
02228                       <font class="keywordflow">while</font> ((rchar = *rest) != <font class="charliteral">'\0'</font> 
02229                              &amp;&amp; !isspace ((<font class="keywordtype">int</font>) rchar))
02230                         {
02231                           extra = <a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (extra, rchar);
02232                           rest++; 
02233                           s++;
02234                         }
02235                       
02236                       DPRINTF ((<font class="stringliteral">"Yo: %s"</font>, extra));
02237                       <a class="code" href="general_c.html#a0">sfree</a> (orest);
02238 
02239                       <font class="keywordflow">if</font> (cstring_isUndefined (extra))
02240                         {
02241                           <a class="code" href="llmain_c.html#a23">showHerald</a> ();
02242                           llerror 
02243                             (FLG_BADFLAG,
02244                              message
02245                              (<font class="stringliteral">"Flag %s must be followed by an argument"</font>,
02246                               flagcode_unparse (opt)));
02247                         }
02248                       <font class="keywordflow">else</font>
02249                         {
02250                           s--;
02251                           
02252                           DPRINTF ((<font class="stringliteral">"Here we are: %s"</font>, extra));
02253 
02254                           <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a42">flagcode_hasValue</a> (opt))
02255                             {
02256                               DPRINTF ((<font class="stringliteral">"Set value flag: %s"</font>, extra));
02257                               <a class="code" href="flags_c.html#a37">setValueFlag</a> (opt, extra);
02258                               <a class="code" href="cstring_c.html#a27">cstring_free</a> (extra);
02259                             }
02260                           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opt == FLG_OPTF)
02261                             {
02262                               FILE *innerf = fopen (cstring_toCharsSafe (extra), <font class="stringliteral">"r"</font>);
02263                               <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (extra);
02264                               
02265                               <font class="keywordflow">if</font> (innerf != NULL)
02266                                 {
02267                                   fileloc fc = g_currentloc;
02268                                   g_currentloc = <a class="code" href="fileloc_c.html#a24">fileloc_createRc</a> (extra);
02269                                   loadrc (innerf, passThroughArgs);
02270                                   <a class="code" href="fileloc_c.html#a9">fileloc_reallyFree</a> (g_currentloc);
02271                                   g_currentloc = fc;
02272                                 }
02273                               <font class="keywordflow">else</font> 
02274                                 {
02275                                   <a class="code" href="llmain_c.html#a23">showHerald</a> ();
02276                                   llerror
02277                                     (FLG_SYNTAX, 
02278                                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Options file not found: %s"</font>, 
02279                                               extra));
02280                                 }
02281                             }
02282                           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opt == FLG_INIT)
02283                             {
02284 <font class="preprocessor"># ifndef NOLCL</font>
02285 <font class="preprocessor"></font>                              llassert (initFile == NULL);
02286                               
02287                               initFile = tsource_create 
02288                                 (<a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (extra), 
02289                                  LCLINIT_SUFFIX, FALSE);
02290                               <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (extra);
02291 <font class="preprocessor"># else</font>
02292 <font class="preprocessor"></font>                              <a class="code" href="cstring_c.html#a27">cstring_free</a> (extra);
02293 <font class="preprocessor"># endif</font>
02294 <font class="preprocessor"></font>                            }
02295                           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="flags_c.html#a43">flagcode_hasString</a> (opt))
02296                             {
02297                               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a1">cstring_firstChar</a> (extra) == <font class="charliteral">'"'</font>)
02298                                 {
02299                                   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a8">cstring_lastChar</a> (extra) == <font class="charliteral">'"'</font>)
02300                                     {
02301                                       <font class="keywordtype">char</font> *extras = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (extra);
02302                                       
02303                                       llassert (extras[strlen(extras) - 1] == <font class="charliteral">'"'</font>);
02304                                       extras[strlen(extras) - 1] = <font class="charliteral">'\0'</font>;
02305                                       extra = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (extras + 1); 
02306                                       DPRINTF ((<font class="stringliteral">"Remove quites: %s"</font>, extra));
02307                                     }
02308                                   <font class="keywordflow">else</font>
02309                                     {
02310                                       llerror
02311                                         (FLG_SYNTAX, 
02312                                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unmatched \" in option string: %s"</font>, 
02313                                                   extra));
02314                                     }
02315                                 }
02316                               
02317                               <a class="code" href="flags_c.html#a38">setStringFlag</a> (opt, extra);
02318                             }
02319                           <font class="keywordflow">else</font>
02320                             {
02321                               <a class="code" href="cstring_c.html#a27">cstring_free</a> (extra);
02322                               BADEXIT;
02323                             }
02324                         }
02325                     }
02326                   <font class="keywordflow">else</font>
02327                     {
02328                       BADEXIT;
02329                     }
02330                 }
02331             }
02332           
02333           *s = c;
02334           DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02335           <font class="keywordflow">while</font> ((c == <font class="charliteral">' '</font>) || (c == <font class="charliteral">'\t'</font>))
02336             {
02337               c = *(++s);
02338               incColumn ();
02339             } 
02340         }
02341       DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02342       s = os;
02343     }
02344 
02345   DPRINTF ((<font class="stringliteral">"Pass through: %s"</font>, cstringSList_unparse (*passThroughArgs)));
02346   <a class="code" href="general_c.html#a0">sfree</a> (os); 
02347   check (fclose (rcfile) == 0);
02348 }
02349 
02350 <font class="keyword">static</font> fileIdList preprocessFiles (fileIdList fl)
02351   <font class="comment">/*@modifies fileSystem@*/</font>
02352 {
02353   <font class="keywordtype">bool</font> msg = (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWSCAN) &amp;&amp; fileIdList_size (fl) &gt; 10);
02354   <font class="keywordtype">int</font> skip = (fileIdList_size (fl) / 5);
02355   <font class="keywordtype">int</font> filesprocessed = 0;
02356   fileIdList dfiles = fileIdList_create ();
02357 
02358   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (g_currentloc);
02359   g_currentloc = <a class="code" href="fileloc_c.html#a31">fileloc_createBuiltin</a> ();
02360 
02361   fileIdList_elements (fl, fid)<font class="keyword"></font>
02362 <font class="keyword">    </font>{
02363       <font class="keywordtype">char</font> *ppfname = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (fileName (fid));
02364 
02365       <font class="keywordflow">if</font> (!(<a class="code" href="osd_c.html#a18">osd_fileIsReadable</a> (ppfname)))
02366         {
02367           <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Cannot open file: %s"</font>,
02368                               cstring_fromChars (ppfname)));
02369         }
02370       <font class="keywordflow">else</font>
02371         {
02372           fileId  dfile = <a class="code" href="fileTable_c.html#a24">fileTable_addCTempFile</a> (context_fileTable (), fid);
02373           
02374           llassert (!mstring_isEmpty (ppfname));
02375           
02376           <font class="keywordflow">if</font> (msg)
02377             {
02378               <font class="keywordflow">if</font> ((filesprocessed % skip) == 0) 
02379                 {
02380                   <font class="keywordflow">if</font> (filesprocessed == 0) {
02381                     fprintf (stderr, <font class="stringliteral">" "</font>);
02382                   }
02383                   <font class="keywordflow">else</font> {
02384                     fprintf (stderr, <font class="stringliteral">"."</font>);
02385                   }
02386                   
02387                   (<font class="keywordtype">void</font>) fflush (stderr);
02388                 }
02389               filesprocessed++;
02390             }
02391 
02392           <font class="keywordflow">if</font> (<a class="code" href="cppmain_c.html#a3">cppProcess</a> (cstring_fromChars (ppfname), 
02393                           fileName (dfile)) != 0) 
02394             {
02395               <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"Preprocessing error for file: %s"</font>, 
02396                                      rootFileName (fid)));
02397             }
02398           
02399           fileIdList_add (dfiles, dfile);
02400         }
02401     } end_fileIdList_elements; 
02402     
02403     <font class="keywordflow">return</font> dfiles;
02404 }
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:43 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
