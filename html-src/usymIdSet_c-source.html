<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>usymIdSet.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:45 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>usymIdSet.c</h1><a href="usymIdSet_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** usymIdSet.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** based on set_template.c</font>
00028 <font class="comment">**</font>
00029 <font class="comment">** where T has T_equal (or change this) and T_unparse</font>
00030 <font class="comment">*/</font>
00031 
00032 <font class="preprocessor"># include "lclintMacros.nf"</font>
00033 <font class="preprocessor"># include "basic.h"</font>
00034 
00035 usymIdSet
<a name="l00036"></a><a class="code" href="usymIdSet_c.html#a0">00036</a> <a class="code" href="usymIdSet_c.html#a0">usymIdSet_new</a> ()<font class="keyword"></font>
00037 <font class="keyword"></font>{
00038   <font class="keywordflow">return</font> usymIdSet_undefined;
00039 }
00040 
00041 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> usymIdSet
00042 usymIdSet_newEmpty (<font class="keywordtype">void</font>)<font class="keyword"></font>
00043 <font class="keyword"></font>{
00044   usymIdSet s = (usymIdSet) dmalloc (<font class="keyword">sizeof</font> (*s));
00045   
00046   s-&gt;entries = 0;
00047   s-&gt;nspace = usymIdSetBASESIZE;
00048   s-&gt;elements = (usymId *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;elements) * usymIdSetBASESIZE);
00049 
00050   <font class="keywordflow">return</font> (s);
00051 }
00052 
00053 <font class="keyword">static</font> <font class="keywordtype">void</font>
00054 usymIdSet_grow (<font class="comment">/*@notnull@*/</font> usymIdSet s)<font class="keyword"></font>
00055 <font class="keyword"></font>{
00056   <font class="keywordtype">int</font> i;
00057   usymId *newelements;
00058 
00059   s-&gt;nspace = usymIdSetBASESIZE;
00060   newelements = (usymId *) dmalloc (<font class="keyword">sizeof</font> (*newelements) * (s-&gt;entries + s-&gt;nspace));
00061 
00062   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;entries; i++)
00063     {
00064       newelements[i] = s-&gt;elements[i];
00065     }
00066 
00067   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements);
00068   s-&gt;elements = newelements;
00069 }
00070 
00071 <font class="comment">/*@only@*/</font> usymIdSet
<a name="l00072"></a><a class="code" href="usymIdSet_c.html#a3">00072</a> <a class="code" href="usymIdSet_c.html#a3">usymIdSet_single</a> (usymId t)<font class="keyword"></font>
00073 <font class="keyword"></font>{
00074   usymIdSet s = (usymIdSet) dmalloc (<font class="keyword">sizeof</font> (*s));
00075    
00076   s-&gt;entries = 1;
00077   s-&gt;nspace = usymIdSetBASESIZE - 1;
00078   s-&gt;elements = (usymId *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;elements) * usymIdSetBASESIZE);
00079   s-&gt;elements[0] = t;
00080 
00081   <font class="keywordflow">return</font> (s);
00082 }
00083 
00084 <font class="keyword">static</font> usymIdSet 
00085   usymIdSet_insert (<font class="comment">/*@returned@*/</font> usymIdSet s, usymId el)<font class="keyword"></font>
00086 <font class="keyword"></font>{
00087   <font class="keywordflow">if</font> (usymIdSet_isUndefined (s))
00088     {
00089       s = usymIdSet_newEmpty ();
00090     }
00091 
00092   <font class="keywordflow">if</font> (<a class="code" href="usymIdSet_c.html#a10">usymIdSet_member</a> (s, el))
00093     {
00094       <font class="keywordflow">return</font> s;
00095     }
00096   <font class="keywordflow">else</font>
00097     {
00098       <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0)
00099         usymIdSet_grow (s);
00100       s-&gt;nspace--;
00101       s-&gt;elements[s-&gt;entries] = el;
00102       s-&gt;entries++;
00103       <font class="keywordflow">return</font> s;
00104     }
00105 }
00106 
00107 <font class="keyword">static</font> usymIdSet
00108 usymIdSet_copy (<font class="comment">/*@notnull@*/</font> usymIdSet s)<font class="keyword"></font>
00109 <font class="keyword"></font>{
00110   <font class="keywordtype">int</font> size = s-&gt;entries + 1;
00111   usymIdSet t = (usymIdSet) dmalloc (<font class="keyword">sizeof</font> (*t));
00112   <font class="keywordtype">int</font> i;
00113   
00114   t-&gt;entries = s-&gt;entries;
00115   t-&gt;nspace = 1;
00116   t-&gt;elements = (usymId *) dmalloc (<font class="keyword">sizeof</font> (*t-&gt;elements) * size);
00117   
00118   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;entries; i++)
00119     {
00120       t-&gt;elements[i] = s-&gt;elements[i];
00121     }
00122   
00123   <font class="keywordflow">return</font> t;
00124 }
00125 
00126 usymIdSet
<a name="l00127"></a><a class="code" href="usymIdSet_c.html#a6">00127</a> <a class="code" href="usymIdSet_c.html#a6">usymIdSet_add</a> (usymIdSet s, usymId el)<font class="keyword"></font>
00128 <font class="keyword"></font>{
00129   <font class="keywordflow">if</font> (usymIdSet_isDefined (s))
00130     {
00131       llassert (!usymIdSet_member (s, el));
00132       
00133       <font class="keywordflow">return</font> (usymIdSet_insert (usymIdSet_copy (s), el));
00134     }
00135   <font class="keywordflow">else</font>
00136     {
00137       <font class="keywordflow">return</font> (<a class="code" href="usymIdSet_c.html#a3">usymIdSet_single</a> (el));
00138     }
00139 }
00140 
00141 usymIdSet
<a name="l00142"></a><a class="code" href="usymIdSet_c.html#a7">00142</a> <a class="code" href="usymIdSet_c.html#a7">usymIdSet_removeFresh</a> (<font class="comment">/*@temp@*/</font> usymIdSet s, usymId el)<font class="keyword"></font>
00143 <font class="keyword"></font>{
00144   <font class="keywordflow">if</font> (usymIdSet_isDefined (s))
00145     {
00146       usymIdSet t = usymIdSet_newEmpty ();
00147       <font class="keywordtype">int</font> i;
00148       
00149       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;entries; i++)
00150         {
00151           <font class="keywordflow">if</font> (!usymId_equal (el, s-&gt;elements[i]))
00152             {
00153               t = usymIdSet_insert (t, s-&gt;elements[i]);
00154             }
00155         }
00156       
00157       <font class="keywordflow">return</font> t;
00158     }
00159   <font class="keywordflow">else</font>
00160     {
00161       <font class="keywordflow">return</font> usymIdSet_undefined;
00162     }
00163 }
00164 
00165 usymIdSet
<a name="l00166"></a><a class="code" href="usymIdSet_c.html#a8">00166</a> <a class="code" href="usymIdSet_c.html#a8">usymIdSet_newUnion</a> (usymIdSet s1, usymIdSet s2)<font class="keyword"></font>
00167 <font class="keyword"></font>{
00168   usymIdSet t = <a class="code" href="usymIdSet_c.html#a0">usymIdSet_new</a> ();
00169 
00170   usymIdSet_elements (s1, current)<font class="keyword"></font>
00171 <font class="keyword">    </font>{
00172       t = usymIdSet_insert (t, current);
00173     } end_usymIdSet_elements;
00174 
00175   usymIdSet_elements (s2, current)<font class="keyword"></font>
00176 <font class="keyword">    </font>{
00177       t = usymIdSet_insert (t, current);
00178     } end_usymIdSet_elements;
00179 
00180   <font class="keywordflow">return</font> t;
00181 }
00182 
00183 <font class="comment">/*</font>
00184 <font class="comment">** returns a new usymIdSet comprised of all elements</font>
00185 <font class="comment">** in s which are not in t.</font>
00186 <font class="comment">*/</font>
00187 
00188 usymIdSet
<a name="l00189"></a><a class="code" href="usymIdSet_c.html#a9">00189</a> <a class="code" href="usymIdSet_c.html#a9">usymIdSet_subtract</a> (usymIdSet s, usymIdSet t)<font class="keyword"></font>
00190 <font class="keyword"></font>{
00191   usymIdSet r = <a class="code" href="usymIdSet_c.html#a0">usymIdSet_new</a> ();
00192 
00193   usymIdSet_elements (s, current)<font class="keyword"></font>
00194 <font class="keyword">    </font>{
00195       <font class="keywordflow">if</font> (!<a class="code" href="usymIdSet_c.html#a10">usymIdSet_member</a> (t, current))
00196         {
00197           r = usymIdSet_insert (r, current);
00198         }
00199     } end_usymIdSet_elements;
00200 
00201   <font class="keywordflow">return</font> r;
00202 }
00203 
00204 <font class="keywordtype">bool</font>
<a name="l00205"></a><a class="code" href="usymIdSet_c.html#a10">00205</a> <a class="code" href="usymIdSet_c.html#a10">usymIdSet_member</a> (usymIdSet s, usymId el)<font class="keyword"></font>
00206 <font class="keyword"></font>{
00207   <font class="keywordflow">if</font> (usymIdSet_isUndefined (s))
00208     {
00209       <font class="keywordflow">return</font> FALSE;
00210     }
00211   <font class="keywordflow">else</font>
00212     {
00213       <font class="keywordtype">int</font> i;
00214       
00215       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;entries; i++)
00216         {
00217           <font class="keywordflow">if</font> (usymId_equal (el, s-&gt;elements[i]))
00218             <font class="keywordflow">return</font> TRUE;
00219         }
00220       <font class="keywordflow">return</font> FALSE;
00221     }
00222 }
00223 
00224 <font class="keywordtype">void</font>
<a name="l00225"></a><a class="code" href="usymIdSet_c.html#a11">00225</a> <a class="code" href="usymIdSet_c.html#a11">usymIdSet_free</a> (<font class="comment">/*@only@*/</font> usymIdSet s)<font class="keyword"></font>
00226 <font class="keyword"></font>{
00227   <font class="keywordflow">if</font> (!usymIdSet_isUndefined (s))
00228     {
00229       <font class="keywordtype">int</font> i;
00230       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;entries; i++)
00231         {
00232           <font class="comment">/*      usymId_free (s-&gt;elements[i]); */</font>
00233         }
00234       
00235       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements); 
00236       <a class="code" href="general_c.html#a0">sfree</a> (s);
00237     }
00238 }
00239 
<a name="l00240"></a><a class="code" href="usymIdSet_c.html#a12">00240</a> cstring <a class="code" href="usymIdSet_c.html#a12">usymIdSet_dump</a> (usymIdSet lset)<font class="keyword"></font>
00241 <font class="keyword"></font>{
00242   cstring st = cstring_undefined;
00243   
00244   <font class="keywordflow">if</font> (!usymIdSet_isUndefined (lset))
00245     {
00246       <font class="keywordtype">bool</font> first = TRUE;
00247       <font class="keywordtype">int</font> i;
00248       
00249       <font class="keywordflow">for</font> (i = 0; i &lt; lset-&gt;entries; i++)
00250         {
00251           usymId current = lset-&gt;elements[i];
00252           
00253           <font class="keywordflow">if</font> (!usymId_isInvalid (current))
00254             {
00255               current = <a class="code" href="usymtab_c.html#a78">usymtab_convertId</a> (current);
00256 
00257               <font class="keywordflow">if</font> (first)
00258                 {
00259                   st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d"</font>, current);
00260                   first = FALSE;
00261                 }
00262               <font class="keywordflow">else</font>
00263                 {
00264                   st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q,%d"</font>, st, current);
00265                 }
00266             }
00267         }
00268     }
00269   <font class="keywordflow">return</font> (st);
00270 }
00271 
00272 <font class="comment">/*</font>
00273 <font class="comment">** end of list is '@' or '\0'</font>
00274 <font class="comment">*/</font>
00275 
00276 usymIdSet
<a name="l00277"></a><a class="code" href="usymIdSet_c.html#a13">00277</a> <a class="code" href="usymIdSet_c.html#a13">usymIdSet_undump</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00278 <font class="keyword"></font>{
00279   usymIdSet t = <a class="code" href="usymIdSet_c.html#a0">usymIdSet_new</a> ();
00280   <font class="keywordtype">char</font> *olds = *s;
00281   <font class="keywordtype">char</font> c;
00282 
00283   
00284   <font class="keywordflow">while</font> ((c = **s) != <font class="charliteral">'\0'</font> &amp;&amp; c != <font class="charliteral">'@'</font> &amp;&amp; c != <font class="charliteral">'#'</font> &amp;&amp; c != <font class="charliteral">'\n'</font>)
00285     {
00286       <font class="keywordtype">int</font> tid = 0;
00287 
00288       <font class="keywordflow">while</font> (c != <font class="charliteral">'@'</font> &amp;&amp; c != <font class="charliteral">'#'</font> &amp;&amp; c != <font class="charliteral">','</font> &amp;&amp; c != <font class="charliteral">'\0'</font> &amp;&amp; c != <font class="charliteral">'\n'</font>)
00289         {
00290           <font class="keywordflow">while</font> (c &gt;= <font class="charliteral">'0'</font> &amp;&amp; c &lt;= <font class="charliteral">'9'</font>)
00291             {
00292               tid *= 10;
00293               tid += (<font class="keywordtype">int</font>) (c - <font class="charliteral">'0'</font>);
00294               (*s)++;
00295               c = **s;
00296             }
00297 
00298           <font class="keywordflow">if</font> (*s == olds)
00299             {
00300               llcontbug (message (<font class="stringliteral">"usymIdSet_undump: loop: %s"</font>, 
00301                                   cstring_fromChars (*s)));
00302 
00303               <font class="keywordflow">while</font> (**s != <font class="charliteral">'\0'</font>) 
00304                 {
00305                   (*s)++;
00306                 }
00307 
00308               <font class="comment">/*@innerbreak@*/</font> <font class="keywordflow">break</font>;
00309             }
00310 
00311           olds = *s;
00312           
00313           t = usymIdSet_insert (t, usymId_fromInt (tid));
00314         }
00315 
00316       <font class="keywordflow">if</font> (c == <font class="charliteral">','</font>)
00317         {
00318           (*s)++;
00319         }
00320     }
00321 
00322   <font class="keywordflow">return</font> t;
00323 }
00324 
00325 <font class="comment">/*@only@*/</font> cstring
<a name="l00326"></a><a class="code" href="usymIdSet_c.html#a14">00326</a> <a class="code" href="usymIdSet_c.html#a14">usymIdSet_unparse</a> (usymIdSet ll)<font class="keyword"></font>
00327 <font class="keyword"></font>{
00328   cstring s = cstring_undefined;
00329 
00330   <font class="keywordflow">if</font> (!usymIdSet_isUndefined (ll))
00331     {
00332       <font class="keywordtype">int</font> i;
00333       
00334       <font class="keywordflow">for</font> (i = 0; i &lt; ll-&gt;entries; i++)
00335         {
00336           usymId current = ll-&gt;elements[i];
00337 
00338           <font class="keywordflow">if</font> (i == 0)
00339             s = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (usymtab_getGlobalEntry (current));
00340           <font class="keywordflow">else</font>
00341             s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q, %q"</font>, s, uentry_getName (usymtab_getGlobalEntry (current)));
00342         }
00343     }
00344   
00345   <font class="keywordflow">return</font> s;
00346 }
00347 
00348 <font class="keywordtype">int</font> 
<a name="l00349"></a><a class="code" href="usymIdSet_c.html#a15">00349</a> <a class="code" href="usymIdSet_c.html#a15">usymIdSet_compare</a> (usymIdSet l1, usymIdSet l2)<font class="keyword"></font>
00350 <font class="keyword"></font>{
00351   <font class="keywordflow">if</font> (usymIdSet_isUndefined (l1))
00352     {
00353       <font class="keywordflow">return</font> (usymIdSet_size (l2) == 0 ? 0 : 1);
00354     }
00355   
00356   <font class="keywordflow">if</font> (usymIdSet_isUndefined (l2))
00357     {
00358       <font class="keywordflow">return</font> (usymIdSet_size (l1) == 0 ? 0 : 1);
00359     }
00360   
00361   {
00362     <font class="keywordtype">int</font> li1 = l1-&gt;entries;
00363     <font class="keywordtype">int</font> li2 = l2-&gt;entries;
00364     <font class="keywordtype">int</font> leastelements = (li1 &lt; li2) ? li1 : li2;
00365     <font class="keywordtype">int</font> i = 0;
00366     
00367     <font class="keywordflow">while</font> (i &lt; leastelements)
00368       {
00369         <font class="keywordflow">if</font> (usymId_equal (l1-&gt;elements[i], l2-&gt;elements[i]))
00370           {
00371             i++;
00372           }
00373         <font class="keywordflow">else</font>
00374           {
00375             <font class="keywordflow">if</font> (l1-&gt;elements[i] &gt; l2-&gt;elements[i]) 
00376               {
00377                 <font class="keywordflow">return</font> 1;
00378               }
00379             <font class="keywordflow">else</font>
00380               {
00381                 <font class="keywordflow">return</font> -1;
00382               }
00383           }
00384       }
00385 
00386     <font class="keywordflow">return</font> (int_compare (li1, li2));
00387   }
00388 }
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:46 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
