<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lh.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:42 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>lh.c</h1><a href="lh_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** lh.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">**  MODULE DESCRIPTION:</font>
00028 <font class="comment">**</font>
00029 <font class="comment">**      This module contains the I/O routines for writing out the .lh file</font>
00030 <font class="comment">**      generated from the .lcl file.</font>
00031 <font class="comment">**</font>
00032 <font class="comment">**  AUTHORS:</font>
00033 <font class="comment">**</font>
00034 <font class="comment">**      Gary Feldman, Technical Languages and Environments, DECspec project</font>
00035 <font class="comment">**      Yang Meng Tan, MIT.</font>
00036 <font class="comment">**</font>
00037 <font class="comment">**  CREATION DATE:  9 April 91</font>
00038 <font class="comment">**</font>
00039 <font class="comment">**      The lh.c module controls formatting policy.</font>
00040 <font class="comment">*/</font>
00041 
00042 <font class="preprocessor"># include "lclintMacros.nf"</font>
00043 <font class="preprocessor"># include "llbasic.h"</font>
00044 <font class="preprocessor"># include "osd.h"</font>
00045 <font class="preprocessor"># include "herald.h"</font>
00046 <font class="preprocessor"># include "lh.h"</font>
00047 <font class="preprocessor"># include "llmain.h"</font>
00048 
00049 <font class="comment">/*@constant static char TABCH; @*/</font>
<a name="l00050"></a><a class="code" href="lh_c.html#a0">00050</a> <font class="preprocessor"># define TABCH          '\1'</font>
00051 <font class="preprocessor"></font>
00052 <font class="comment">/*@constant static char TABINCH; @*/</font>
<a name="l00053"></a><a class="code" href="lh_c.html#a1">00053</a> <font class="preprocessor"># define TABINCH        '\2'</font>
00054 <font class="preprocessor"></font>
00055 <font class="comment">/*@constant static char TABOUTCH; @*/</font>
<a name="l00056"></a><a class="code" href="lh_c.html#a2">00056</a> <font class="preprocessor"># define TABOUTCH       '\3'</font>
00057 <font class="preprocessor"></font>
00058 <font class="comment">/*@constant static observer char *LHTMP_SUFFIX; @*/</font>
<a name="l00059"></a><a class="code" href="lh_c.html#a3">00059</a> <font class="preprocessor"># define LHTMP_SUFFIX ".lh_tmp"</font>
00060 <font class="preprocessor"></font>
00061 <font class="comment">/*</font>
00062 <font class="comment">  # define TAB                  fputc (TABCH,   LhFile.f);</font>
00063 <font class="comment">  # define TABIN                fputc (TABINCH,         LhFile.f);</font>
00064 <font class="comment">  # define TABOUT               fputc (TABOUTCH, LhFile.f);</font>
00065 <font class="comment">*/</font>
00066 
<a name="l00067"></a><a class="code" href="struct_outFile.html">00067</a> <font class="keyword">typedef</font> <font class="keyword">struct</font>
00068 <font class="keyword"></font>{
<a name="l00069"></a><a class="code" href="struct_outFile.html#m0">00069</a>   <font class="comment">/*@dependent@*/</font> <font class="comment">/*@null@*/</font> <font class="comment">/*@reldef@*/</font> FILE *f;
<a name="l00070"></a><a class="code" href="struct_outFile.html#m1">00070</a>   <font class="comment">/*@reldef@*/</font> <font class="keywordtype">char</font> *name;
00071 } <a class="code" href="struct_outFile.html">outFile</a>;
00072 
00073 <font class="keyword">static</font> <font class="keywordtype">bool</font> genLh;
00074 <font class="keyword">static</font> <a class="code" href="struct_outFile.html">outFile</a> LhFile;
00075 <font class="keyword">static</font> <font class="keywordtype">bool</font> needIncludeBool = FALSE;
00076 
00077 <font class="comment">/*</font>
00078 <font class="comment">**</font>
00079 <font class="comment">**  FORWARD FUNCTIONS</font>
00080 <font class="comment">**</font>
00081 <font class="comment">*/</font>
00082 
00083 <font class="comment">/* static int colpos (int startcol, cstring line); */</font>
00084 
00085 <font class="keyword">static</font> cstring lhTypeSpecNode (lclTypeSpecNode p_typespec);
00086 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring lhTypeExpr (<font class="comment">/*@null@*/</font> typeExpr p_x);
00087 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring lhDeclaratorNode (declaratorNode p_x);
00088 
00089 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@null@*/</font> FILE *out_open (<font class="keywordtype">char</font> *name, <font class="keywordtype">char</font> *suffix) <font class="comment">/*@modifies fileSystem@*/</font>
00090 {
00091   <font class="keywordtype">char</font> *fullname = (<font class="keywordtype">char</font> *)
00092     <a class="code" href="general_c.html#a29">mstring_create</a> (size_toInt (strlen (name) + strlen (suffix)));
00093   FILE *ret;
00094 
00095   strcpy (fullname, name);
00096   strcat (fullname, suffix);
00097   ret = fopen (fullname, <font class="stringliteral">"w+"</font>);
00098   <a class="code" href="general_c.html#a0">sfree</a> (fullname);
00099   <font class="keywordflow">return</font> ret;
00100 }
00101 
00102 <font class="comment">/*@only@*/</font> cstring 
<a name="l00103"></a><a class="code" href="lh_c.html#a11">00103</a> <a class="code" href="lh_c.html#a11">lhFunction</a> (lclTypeSpecNode lclTypeSpec, declaratorNode declarator)<font class="keyword"></font>
00104 <font class="keyword"></font>{
00105   cstring s;
00106 
00107   <font class="keywordflow">if</font> (!genLh)
00108     <font class="keywordflow">return</font> cstring_undefined;
00109   
00110   s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"extern %q\1%q;"</font>, lhTypeSpecNode (lclTypeSpec),
00111                lhDeclaratorNode (declarator));
00112   
00113   <font class="keywordflow">return</font> s;
00114 }
00115 
00116 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
00117 lhDeclaratorNode (declaratorNode x)<font class="keyword"></font>
00118 <font class="keyword"></font>{
00119   <font class="keywordflow">return</font> (lhTypeExpr (x-&gt;type));
00120 }
00121 
00122 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring lhTypeExpr (<font class="comment">/*@null@*/</font> typeExpr x)<font class="keyword"></font>
00123 <font class="keyword"></font>{
00124   cstring s = cstring_undefined; <font class="comment">/* print out types in order of appearance in source */</font>
00125   paramNodeList params;
00126   <font class="keywordtype">int</font> i;
00127 
00128   <font class="keywordflow">if</font> (x != (typeExpr) 0)
00129     {
00130       cstring front = cstring_undefined;
00131       cstring back  = cstring_undefined;
00132 
00133       <font class="keywordflow">for</font> (i = x-&gt;wrapped; i &gt;= 1; i--)
00134         {
00135           front = <a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (front, <font class="charliteral">'('</font>);
00136           back  = <a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (back, <font class="charliteral">')'</font>);
00137         }
00138 
00139       <font class="keywordflow">switch</font> (x-&gt;kind)
00140         {
00141         <font class="keywordflow">case</font> TEXPR_BASE:
00142           s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%s"</font>, s, ltoken_getRawString (x-&gt;content.base));
00143           <font class="keywordflow">break</font>;
00144         <font class="keywordflow">case</font> TEXPR_PTR:
00145           s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q*%q"</font>, s, lhTypeExpr (x-&gt;content.pointer));
00146           <font class="keywordflow">break</font>;
00147         <font class="keywordflow">case</font> TEXPR_ARRAY:
00148           s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q[%q]"</font>, s, 
00149                        lhTypeExpr (x-&gt;content.array.elementtype),
00150                        <a class="code" href="abstract_c.html#a203">termNode_unparse</a> (x-&gt;content.array.size));
00151           <font class="keywordflow">break</font>;
00152         <font class="keywordflow">case</font> TEXPR_FCN:
00153           s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q ("</font>, s, lhTypeExpr (x-&gt;content.function.returntype));
00154           params = x-&gt;content.function.args;
00155 
00156           <font class="keywordflow">if</font> (!paramNodeList_empty (params))
00157             {
00158               s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q"</font>, s, 
00159                            paramNodeList_unparseComments (x-&gt;content.function.args));
00160             }
00161 
00162           s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q)"</font>, s);
00163           <font class="keywordflow">break</font>;
00164         }
00165       s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q%q"</font>, front, s, back);
00166     }
00167   <font class="keywordflow">else</font>
00168     {
00169       s = cstring_makeLiteral (<font class="stringliteral">"?"</font>);
00170     }
00171 
00172   <font class="keywordflow">return</font> s;
00173 }
00174 
00175 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00176"></a><a class="code" href="lh_c.html#a12">00176</a> <a class="code" href="lh_c.html#a12">lhForwardStruct</a> (ltoken t)<font class="keyword"></font>
00177 <font class="keyword"></font>{
00178   <font class="keywordflow">if</font> (!genLh)
00179     <font class="keywordflow">return</font>;
00180 
00181   <a class="code" href="lh_c.html#a19">lhOutLine</a> (message (<font class="stringliteral">"struct %s;"</font>, ltoken_unparse (t)));
00182 }
00183 
00184 
00185 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00186"></a><a class="code" href="lh_c.html#a13">00186</a> <a class="code" href="lh_c.html#a13">lhForwardUnion</a> (ltoken t)<font class="keyword"></font>
00187 <font class="keyword"></font>{
00188   <font class="keywordflow">if</font> (!genLh)
00189     <font class="keywordflow">return</font>;
00190 
00191   <a class="code" href="lh_c.html#a19">lhOutLine</a> (message (<font class="stringliteral">"union %s;"</font>, ltoken_unparse (t)));
00192 }
00193 
00194 <font class="keyword">extern</font> <font class="comment">/*@only@*/</font> cstring 
<a name="l00195"></a><a class="code" href="lh_c.html#a14">00195</a> <a class="code" href="lh_c.html#a14">lhType</a> (typeNode t)<font class="keyword"></font>
00196 <font class="keyword"></font>{
00197   <font class="keywordflow">if</font> (!genLh)
00198     <font class="keywordflow">return</font> cstring_undefined;
00199 
00200   <font class="keywordflow">if</font> (t-&gt;kind == TK_EXPOSED)
00201     {
00202       exposedNode n = t-&gt;content.exposed;
00203 
00204       <font class="keywordflow">if</font> (n != (exposedNode) 0)
00205         {
00206           <font class="keywordflow">if</font> (declaratorInvNodeList_size (n-&gt;decls) == 0)
00207             {
00208               <font class="comment">/* </font>
00209 <font class="comment">              ** Forward struct or union declaration</font>
00210 <font class="comment">              */</font>
00211 
00212               <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (lhTypeSpecNode (n-&gt;type), <font class="charliteral">';'</font>));
00213             }
00214           <font class="keywordflow">else</font>
00215             {
00216               cstring s = cstring_undefined;
00217 
00218               declaratorInvNodeList_elements (n-&gt;decls, d)<font class="keyword"></font>
00219 <font class="keyword">                </font>{
00220                   cstring name = <a class="code" href="abstract_c.html#a130">declaratorNode_unparse</a> (d-&gt;declarator);
00221                   cstring pname = <a class="code" href="abstract_c.html#a134">declaratorNode_unparseCode</a> (d-&gt;declarator); 
00222                   
00223                   s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q\n# ifndef EXPOSED_TYPE_%q\ntypedef %q %q;\n# endif\n"</font>, 
00224                                s, pname, lhTypeSpecNode (n-&gt;type), name);
00225                 } end_declaratorInvNodeList_elements;
00226               
00227               <font class="keywordflow">return</font> s;
00228             }
00229         }
00230     }
00231 
00232   <font class="keywordflow">return</font> cstring_undefined;
00233 }
00234 
00235 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring 
00236 lhTypeSpecNode (lclTypeSpecNode typespec)<font class="keyword"></font>
00237 <font class="keyword"></font>{
00238   <font class="keywordflow">if</font> (!genLh)
00239     {
00240       <font class="keywordflow">return</font> cstring_undefined;
00241     }
00242 
00243   <font class="keywordflow">return</font> (<a class="code" href="abstract_c.html#a177">lclTypeSpecNode_unparseComments</a> (typespec));
00244 }
00245 
00246 <font class="comment">/*@only@*/</font> cstring
<a name="l00247"></a><a class="code" href="lh_c.html#a15">00247</a> <a class="code" href="lh_c.html#a15">lhVarDecl</a> (lclTypeSpecNode lclTypeSpec, initDeclNodeList initDecls,
00248            qualifierKind qualifier)<font class="keyword"></font>
00249 <font class="keyword"></font>{
00250   <font class="keywordtype">bool</font> first = TRUE;
00251   cstring s;
00252 
00253   <font class="keywordflow">if</font> (!genLh)
00254     <font class="keywordflow">return</font> cstring_undefined;
00255 
00256   s = cstring_makeLiteral (<font class="stringliteral">"extern"</font>);
00257 
00258   <font class="keywordflow">switch</font> (qualifier)
00259     {
00260     <font class="keywordflow">case</font> QLF_NONE:
00261       <font class="keywordflow">break</font>;
00262     <font class="keywordflow">case</font> QLF_CONST:
00263       s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q const"</font>, s);
00264       <font class="keywordflow">break</font>;
00265     <font class="keywordflow">case</font> QLF_VOLATILE:
00266       s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q volatile"</font>, s);
00267       <font class="keywordflow">break</font>;
00268     <font class="keywordflow">default</font>:                    <font class="comment">/* ignore it */</font>
00269       <font class="keywordflow">break</font>;
00270     }
00271   
00272   s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q\1"</font>, s, lhTypeSpecNode (lclTypeSpec));
00273 
00274   initDeclNodeList_elements (initDecls, i)<font class="keyword"></font>
00275 <font class="keyword">  </font>{
00276     <font class="keywordflow">if</font> (first)
00277       {
00278         s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q"</font>, s, declaratorNode_unparse (i-&gt;declarator));
00279         first = FALSE;
00280       }
00281     <font class="keywordflow">else</font>
00282       {
00283         s = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q, %q"</font>, s, declaratorNode_unparse (i-&gt;declarator));
00284       }
00285   } end_initDeclNodeList_elements;
00286   
00287   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q;"</font>, s));
00288 }
00289 
00290 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00291"></a><a class="code" href="lh_c.html#a16">00291</a> <a class="code" href="lh_c.html#a16">lhCleanup</a> (<font class="keywordtype">void</font>)
00292    <font class="comment">/*@modifies fileSystem@*/</font>
00293 {
00294   <font class="keywordflow">if</font> (!genLh)
00295     {
00296       <font class="keywordflow">return</font>;
00297     }
00298   <font class="keywordflow">else</font>
00299     {
00300       FILE *f;
00301       <font class="keywordtype">int</font> c, col = 0, tabcol = 0;
00302       <font class="keywordtype">char</font> *fullname;
00303 
00304       
00305       fullname = mstring_create 
00306         (<a class="code" href="general_c.html#a34">size_toInt</a> (strlen (LhFile.name) + strlen (LHTMP_SUFFIX)));
00307 
00308       f = out_open (LhFile.name, LH_SUFFIX);
00309       llassert (LhFile.f != NULL);
00310 
00311       strcpy (fullname, LhFile.name);
00312       strcat (fullname, LHTMP_SUFFIX);
00313 
00314       <font class="keywordflow">if</font> (f == NULL)
00315         {
00316           <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Cannot open lh file for output: %s"</font>, 
00317                               cstring_fromChars (fullname)));
00318         }
00319       <font class="keywordflow">else</font>
00320         {
00321           fprintf (f, <font class="stringliteral">"/* Output from %s */\n"</font>, LCL_PARSE_VERSION);
00322 
00323           rewind (LhFile.f);
00324 
00325           <font class="keywordflow">while</font> (EOF != (c = getc (LhFile.f)))
00326             {
00327               <font class="keywordflow">switch</font> (c)
00328                 {
00329                 <font class="keywordflow">case</font> TABCH:
00330                   <font class="keywordflow">if</font> (col == 0)
00331                     {
00332                       <font class="keywordflow">if</font> (tabcol &gt; 0)
00333                         fprintf (f, <font class="stringliteral">"%*s"</font>, tabcol, <font class="stringliteral">""</font>);
00334                     }
00335                   <font class="keywordflow">else</font>
00336                     {
00337                       check (fputc (<font class="charliteral">' '</font>, f) == (<font class="keywordtype">int</font>) <font class="charliteral">' '</font>);
00338                     }
00339                   <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00340                   
00341                 <font class="keywordflow">case</font> TABINCH:
00342                   tabcol += 4;
00343                   <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00344                   
00345                 <font class="keywordflow">case</font> TABOUTCH:
00346                   tabcol -= 4;
00347                   <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00348                   
00349                 <font class="keywordflow">case</font> <font class="charliteral">'\n'</font>:
00350                   col = 0;
00351                   check (fputc (c, f) == (<font class="keywordtype">int</font>) c);
00352                   <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00353                   
00354                 <font class="keywordflow">default</font>:
00355                   col++;
00356                   check (fputc (c, f) == (<font class="keywordtype">int</font>) c);
00357                   <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
00358                 }
00359             }
00360 
00361           check (fclose (f) == 0);
00362           check (fclose (LhFile.f) == 0);
00363 
00364           (<font class="keywordtype">void</font>) <a class="code" href="osd_c.html#a15">osd_unlink</a> (fullname);
00365           LhFile.f = NULL;
00366         }
00367       
00368       <a class="code" href="general_c.html#a0">sfree</a> (fullname);
00369     }
00370 }
00371 
00372 <font class="comment">/* Write an #include of bool.h if we have't done so already.  */</font>
00373 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00374"></a><a class="code" href="lh_c.html#a17">00374</a> <a class="code" href="lh_c.html#a17">lhIncludeBool</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00375 <font class="keyword"></font>{
00376   needIncludeBool = TRUE;
00377 }
00378 
00379 <font class="comment">/*</font>
00380 <font class="comment">**++</font>
00381 <font class="comment">**  FUNCTIONAL DESCRIPTION:</font>
00382 <font class="comment">**</font>
00383 <font class="comment">**      Initialize the .lh file processing.</font>
00384 <font class="comment">**</font>
00385 <font class="comment">**  FORMAL PARAMETERS:</font>
00386 <font class="comment">**</font>
00387 <font class="comment">**      source * f: The source file, from which we compute the name of</font>
00388 <font class="comment">**      the .lh file.</font>
00389 <font class="comment">**</font>
00390 <font class="comment">**      bool outputLh: If true, produce a .lh file, otherwise don't.</font>
00391 <font class="comment">**</font>
00392 <font class="comment">**  RETURN VALUE:</font>
00393 <font class="comment">**</font>
00394 <font class="comment">**      None</font>
00395 <font class="comment">**</font>
00396 <font class="comment">**  SIDE EFFECTS:</font>
00397 <font class="comment">**</font>
00398 <font class="comment">**      The .lh file may be opened.</font>
00399 <font class="comment">**</font>
00400 <font class="comment">**</font>
00401 <font class="comment">**--</font>
00402 <font class="comment">*/</font>
00403 
<a name="l00404"></a><a class="code" href="lh_c.html#a18">00404</a> <font class="keywordtype">void</font> <a class="code" href="lh_c.html#a18">lhInit</a> (tsource * f) <font class="comment">/*@globals undef LhFile; @*/</font>
00405 {
00406   <font class="keyword">static</font> <font class="keywordtype">bool</font> lherror = FALSE;
00407   
00408   genLh = <a class="code" href="context_c.html#a199">context_msgLh</a> ();
00409   needIncludeBool = FALSE;
00410 
00411   <font class="keywordflow">if</font> (!genLh)
00412     {
00413       <font class="keywordflow">return</font>;
00414     }
00415   
00416   LhFile.name = <a class="code" href="osd_c.html#a3">LSLRootName</a> (tsource_fileName (f));
00417   LhFile.f = out_open (LhFile.name, LHTMP_SUFFIX);
00418 
00419   <font class="keywordflow">if</font> (LhFile.f == NULL)
00420     {
00421       genLh = FALSE;
00422       <font class="keywordflow">if</font> (!lherror)
00423         {
00424           <a class="code" href="llerror_c.html#a55">lclplainerror</a> (message (<font class="stringliteral">"Cannot write .lh file: %s.lh"</font>, 
00425                                   cstring_fromChars (LhFile.name)));
00426           lherror = TRUE;
00427         }
00428     } 
00429 } 
00430 
<a name="l00431"></a><a class="code" href="lh_c.html#a19">00431</a> <font class="keywordtype">void</font> <a class="code" href="lh_c.html#a19">lhOutLine</a> (<font class="comment">/*@only@*/</font> cstring s)<font class="keyword"></font>
00432 <font class="keyword"></font>{
00433   <font class="keywordflow">if</font> (genLh)
00434     {
00435       llassert (LhFile.f != NULL);
00436 
00437       <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a30">cstring_length</a> (s) &gt; 0) 
00438         {
00439           check (fputs (cstring_toCharsSafe (s), LhFile.f) != EOF); 
00440         }
00441 
00442       check (fputc (<font class="charliteral">'\n'</font>, LhFile.f) == (<font class="keywordtype">int</font>) <font class="charliteral">'\n'</font>); 
00443     }
00444 
00445   <a class="code" href="cstring_c.html#a27">cstring_free</a> (s);
00446 }
00447 
<a name="l00448"></a><a class="code" href="lh_c.html#a20">00448</a> <font class="keywordtype">void</font> <a class="code" href="lh_c.html#a20">lhExternals</a> (interfaceNodeList x)<font class="keyword"></font>
00449 <font class="keyword"></font>{
00450   <font class="keywordflow">if</font> (genLh)
00451     {
00452       llassert (LhFile.f != NULL);
00453 
00454       <font class="comment">/*</font>
00455 <font class="comment">      ** Need to make sure all standard library includes come first.</font>
00456 <font class="comment">      */</font>
00457 
00458       interfaceNodeList_elements (x, el)<font class="keyword"></font>
00459 <font class="keyword">        </font>{
00460           <font class="keywordflow">if</font> (el-&gt;kind == INF_IMPORTS)
00461             {
00462               importNodeList imps = el-&gt;content.imports;
00463 
00464               importNodeList_elements (imps, il)<font class="keyword"></font>
00465 <font class="keyword">                </font>{
00466                   <font class="keywordflow">if</font> (il-&gt;kind == IMPBRACKET)
00467                     {
00468                       <a class="code" href="lh_c.html#a19">lhOutLine</a> (message (<font class="stringliteral">"# include &lt;%s.h&gt;"</font>, 
00469                                           ltoken_getRawString (il-&gt;val)));
00470                     }
00471                 } end_importNodeList_elements ;
00472             }
00473         } end_interfaceNodeList_elements;
00474 
00475       <a class="code" href="lh_c.html#a19">lhOutLine</a> (cstring_makeLiteral (<font class="stringliteral">"# include \"bool.h\""</font>));
00476       
00477       interfaceNodeList_elements (x, el)<font class="keyword"></font>
00478 <font class="keyword">        </font>{
00479           <font class="keywordflow">if</font> (el-&gt;kind == INF_IMPORTS)
00480             {
00481               importNodeList imps = el-&gt;content.imports;
00482 
00483               importNodeList_elements (imps, il)<font class="keyword"></font>
00484 <font class="keyword">                </font>{
00485                   <font class="keywordflow">if</font> (il-&gt;kind != IMPBRACKET)
00486                     {
00487                       <a class="code" href="lh_c.html#a19">lhOutLine</a> (message (<font class="stringliteral">"# include \"%s.h\""</font>, 
00488                                           ltoken_getRawString (il-&gt;val)));
00489                     }
00490                 } end_importNodeList_elements ;
00491             }
00492         } end_interfaceNodeList_elements;
00493 
00494       <a class="code" href="lh_c.html#a19">lhOutLine</a> (cstring_undefined);
00495     }
00496 }
00497 
00498 
00499 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:42 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
