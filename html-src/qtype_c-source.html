<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>qtype.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:43 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>qtype.c</h1><a href="qtype_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** qtype.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Qualified types: a type qualifier list, and a ctype.</font>
00028 <font class="comment">** qtypes are mutable</font>
00029 <font class="comment">*/</font>
00030 
00031 <font class="preprocessor"># include "lclintMacros.nf"</font>
00032 <font class="preprocessor"># include "basic.h"</font>
00033 
<a name="l00034"></a><a class="code" href="qtype_c.html#a0">00034</a> <font class="comment">/*@notnull@*/</font> qtype <a class="code" href="qtype_c.html#a0">qtype_create</a> (ctype c)<font class="keyword"></font>
00035 <font class="keyword"></font>{
00036   qtype q = (qtype) dmalloc (<font class="keyword">sizeof</font> (*q));
00037 
00038   q-&gt;type = c;
00039   q-&gt;quals = <a class="code" href="qualList_c.html#a0">qualList_new</a> ();
00040   <font class="keywordflow">return</font> q;
00041 }
00042 
<a name="l00043"></a><a class="code" href="qtype_c.html#a1">00043</a> <font class="keywordtype">void</font> <a class="code" href="qtype_c.html#a1">qtype_free</a> (<font class="comment">/*@only@*/</font> qtype q)<font class="keyword"></font>
00044 <font class="keyword"></font>{
00045   <font class="keywordflow">if</font> (qtype_isDefined (q))
00046     {
00047       <a class="code" href="qualList_c.html#a11">qualList_free</a> (q-&gt;quals);
00048       <a class="code" href="general_c.html#a0">sfree</a> (q);
00049     }
00050 }
00051 
<a name="l00052"></a><a class="code" href="qtype_c.html#a2">00052</a> qtype <a class="code" href="qtype_c.html#a2">qtype_unknown</a> ()<font class="keyword"></font>
00053 <font class="keyword"></font>{
00054   <font class="keywordflow">return</font> (<a class="code" href="qtype_c.html#a0">qtype_create</a> (ctype_unknown));
00055 }
00056 
<a name="l00057"></a><a class="code" href="qtype_c.html#a3">00057</a> qtype <a class="code" href="qtype_c.html#a3">qtype_addQual</a> (qtype qt, qual q)<font class="keyword"></font>
00058 <font class="keyword"></font>{
00059   <font class="keywordflow">if</font> (qtype_isDefined (qt))
00060     {
00061       qt-&gt;quals = <a class="code" href="qualList_c.html#a4">qualList_add</a> (qt-&gt;quals, q);
00062     }
00063 
00064   <font class="keywordflow">return</font> qt;
00065 }
00066 
00067 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00068"></a><a class="code" href="qtype_c.html#a4">00068</a> <font class="preprocessor"></font>qtype <a class="code" href="qtype_c.html#a4">qtype_addQualList</a> (<font class="comment">/*@returned@*/</font> qtype qt, qualList ql)<font class="keyword"></font>
00069 <font class="keyword"></font>{
00070   <font class="keywordflow">if</font> (qtype_isDefined (qt))
00071     {
00072       qt-&gt;quals = <a class="code" href="qualList_c.html#a5">qualList_appendList</a> (qt-&gt;quals, ql);
00073     }
00074 
00075   <font class="keywordflow">return</font> qt;
00076 }
00077 <font class="preprocessor"># endif</font>
00078 <font class="preprocessor"></font>
00079 <font class="keyword">static</font> <font class="keywordtype">void</font> checkAltQuals (qtype q)<font class="keyword"></font>
00080 <font class="keyword"></font>{
00081   <font class="keywordflow">if</font> (qtype_isDefined (q))
00082     {
00083       qualList badQuals = qualList_undefined;
00084       
00085       qualList_elements (q-&gt;quals, qu)<font class="keyword"></font>
00086 <font class="keyword">        </font>{
00087           <font class="keywordflow">if</font> (!qual_isCQual (qu) &amp;&amp; !qual_isImplied (qu))
00088             {
00089               badQuals = <a class="code" href="qualList_c.html#a4">qualList_add</a> (badQuals, qu);
00090             }
00091         } end_qualList_elements ;
00092       
00093       <font class="keywordflow">if</font> (!qualList_isEmpty (badQuals))
00094         {
00095           voptgenerror (FLG_SYNTAX,
00096                         message 
00097                         (<font class="stringliteral">"Alternate type cannot use annotations %q: %q"</font>,
00098                          qualList_unparse (badQuals),
00099                          <a class="code" href="qtype_c.html#a10">qtype_unparse</a> (q)),
00100                         g_currentloc);
00101         }
00102     }
00103 }
00104 
00105 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00106"></a><a class="code" href="qtype_c.html#a6">00106</a> <font class="preprocessor"></font>qtype <a class="code" href="qtype_c.html#a6">qtype_mergeImplicitAlt</a> (<font class="comment">/*@returned@*/</font> qtype q1, <font class="comment">/*@only@*/</font> qtype q2)<font class="keyword"></font>
00107 <font class="keyword"></font>{
00108   <font class="keywordflow">if</font> (qtype_isDefined (q1) &amp;&amp; qtype_isDefined (q2))
00109     {
00110       q1-&gt;type = <a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (q1-&gt;type, q2-&gt;type);
00111       
00112       <font class="keywordflow">if</font> (!qualList_isEmpty (q2-&gt;quals))
00113         {
00114           checkAltQuals (q2);
00115         }
00116     }
00117 
00118   <a class="code" href="qtype_c.html#a1">qtype_free</a> (q2);
00119   <font class="keywordflow">return</font> q1;
00120 }
00121 <font class="preprocessor"># endif</font>
00122 <font class="preprocessor"></font>
<a name="l00123"></a><a class="code" href="qtype_c.html#a7">00123</a> qtype <a class="code" href="qtype_c.html#a7">qtype_mergeAlt</a> (<font class="comment">/*@returned@*/</font> qtype q1, <font class="comment">/*@only@*/</font> qtype q2)<font class="keyword"></font>
00124 <font class="keyword"></font>{
00125   <font class="keywordflow">if</font> (qtype_isDefined (q1) &amp;&amp; qtype_isDefined (q2))
00126     {
00127       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCONJ))
00128         {
00129           q1-&gt;type = <a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (q1-&gt;type, q2-&gt;type);
00130         }
00131       <font class="keywordflow">else</font>
00132         {
00133           q1-&gt;type = <a class="code" href="ctype_c.html#a84">ctype_makeExplicitConj</a> (q1-&gt;type, q2-&gt;type);
00134         }
00135 
00136       
00137       <font class="keywordflow">if</font> (!qualList_isEmpty (q2-&gt;quals))
00138         {
00139           checkAltQuals (q2);
00140         }
00141     }
00142   
00143   <a class="code" href="qtype_c.html#a1">qtype_free</a> (q2);
00144   <font class="keywordflow">return</font> q1;
00145 }
00146 
<a name="l00147"></a><a class="code" href="qtype_c.html#a8">00147</a> qtype <a class="code" href="qtype_c.html#a8">qtype_combine</a> (<font class="comment">/*@returned@*/</font> qtype q1, ctype ct)<font class="keyword"></font>
00148 <font class="keyword"></font>{
00149   <font class="keywordflow">if</font> (qtype_isDefined (q1))
00150     {
00151       <font class="comment">/* ct is modifier (or q1-&gt;type is unknown) */</font>
00152       q1-&gt;type = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (q1-&gt;type, ct); 
00153     }
00154 
00155   <font class="keywordflow">return</font> q1;
00156 }
00157 
<a name="l00158"></a><a class="code" href="qtype_c.html#a9">00158</a> qtype <a class="code" href="qtype_c.html#a9">qtype_resolve</a> (<font class="comment">/*@returned@*/</font> qtype q)<font class="keyword"></font>
00159 <font class="keyword"></font>{
00160   <font class="keywordflow">if</font> (qtype_isDefined (q))
00161     {
00162       q-&gt;type = <a class="code" href="ctype_c.html#a133">ctype_resolve</a> (q-&gt;type);
00163     }
00164 
00165   <font class="keywordflow">return</font> q;
00166 }
00167 
<a name="l00168"></a><a class="code" href="qtype_c.html#a10">00168</a> cstring <a class="code" href="qtype_c.html#a10">qtype_unparse</a> (qtype q)<font class="keyword"></font>
00169 <font class="keyword"></font>{
00170   <font class="keywordflow">if</font> (qtype_isDefined (q))
00171     {
00172       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%s"</font>, qualList_unparse (q-&gt;quals), 
00173                        <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (q-&gt;type)));
00174     }
00175   <font class="keywordflow">else</font>
00176     {
00177       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;undefined&gt;"</font>));
00178     }
00179 }
00180 
<a name="l00181"></a><a class="code" href="qtype_c.html#a11">00181</a> qtype <a class="code" href="qtype_c.html#a11">qtype_newBase</a> (<font class="comment">/*@returned@*/</font> qtype q, ctype ct)<font class="keyword"></font>
00182 <font class="keyword"></font>{
00183   <font class="keywordflow">if</font> (qtype_isDefined (q))
00184     {
00185       q-&gt;type = <a class="code" href="ctype_c.html#a41">ctype_newBase</a> (ct, q-&gt;type);
00186     }
00187 
00188   <font class="keywordflow">return</font> q;
00189 }
00190 
<a name="l00191"></a><a class="code" href="qtype_c.html#a12">00191</a> qtype <a class="code" href="qtype_c.html#a12">qtype_newQbase</a> (qtype q1, qtype q2)<font class="keyword"></font>
00192 <font class="keyword"></font>{
00193   <font class="keywordflow">if</font> (qtype_isDefined (q1) &amp;&amp; qtype_isDefined (q2))
00194     {
00195       q1-&gt;type = <a class="code" href="ctype_c.html#a41">ctype_newBase</a> (q1-&gt;type, q2-&gt;type);
00196       q1-&gt;quals = <a class="code" href="qualList_c.html#a5">qualList_appendList</a> (q1-&gt;quals, q2-&gt;quals);
00197     }
00198 
00199   <font class="keywordflow">return</font> q1;
00200 }
00201 
<a name="l00202"></a><a class="code" href="qtype_c.html#a13">00202</a> <font class="keywordtype">void</font> <a class="code" href="qtype_c.html#a13">qtype_adjustPointers</a> (<font class="keywordtype">int</font> n, qtype q)<font class="keyword"></font>
00203 <font class="keyword"></font>{
00204   <font class="keywordflow">if</font> (qtype_isDefined (q))
00205     {
00206       q-&gt;type = <a class="code" href="ctype_c.html#a113">ctype_adjustPointers</a> (n, q-&gt;type);
00207     }
00208 }
00209 
00210 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00211"></a><a class="code" href="qtype_c.html#a14">00211</a> <font class="preprocessor"></font>qtype <a class="code" href="qtype_c.html#a14">qtype_copy</a> (qtype q)<font class="keyword"></font>
00212 <font class="keyword"></font>{
00213   <font class="keywordflow">if</font> (qtype_isDefined (q))
00214     {
00215       qtype r = <a class="code" href="qtype_c.html#a0">qtype_create</a> (q-&gt;type);
00216       
00217       <a class="code" href="qualList_c.html#a11">qualList_free</a> (r-&gt;quals);
00218       r-&gt;quals = <a class="code" href="qualList_c.html#a6">qualList_copy</a> (q-&gt;quals);
00219       <font class="keywordflow">return</font> r;
00220     }
00221   <font class="keywordflow">else</font>
00222     {
00223       <font class="keywordflow">return</font> qtype_undefined;
00224     }
00225 }
00226 <font class="preprocessor"># endif</font>
</font></div></pre><hr><address><small>Generated at Fri Nov 3 18:57:43 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
