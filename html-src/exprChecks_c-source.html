<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>exprChecks.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:40 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>exprChecks.c</h1><a href="exprChecks_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** exprChecks.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 <font class="preprocessor"># include "cgrammar.h"</font>
00031 <font class="preprocessor"># include "cgrammar_tokens.h"</font>
00032 <font class="preprocessor"># include "aliasChecks.h"</font>
00033 <font class="preprocessor"># include "exprChecks.h"</font>
00034 
00035 <font class="comment">/*</font>
00036 <font class="comment">** for now, allow exprChecks to access exprNode.</font>
00037 <font class="comment">** may remove this in future</font>
00038 <font class="comment">*/</font>
00039 
00040 <font class="comment">/*@access exprNode@*/</font>
00041 
00042 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkCallModifyAux (sRef p_s, exprNode p_f, sRef p_alias, exprNode p_err);
00043 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkModifyValAux (sRef p_s, exprNode p_f, sRef p_alias, exprNode p_err);
00044 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkModifyAux (sRef p_s, exprNode p_f, sRef p_alias, exprNode p_err);
00045 <font class="keyword">static</font> <font class="keywordtype">void</font> checkSafeReturnExpr (<font class="comment">/*@notnull@*/</font> exprNode p_e);
00046 
00047 <font class="comment">/*</font>
00048 <font class="comment">** called at end of expression statement</font>
00049 <font class="comment">**</font>
00050 <font class="comment">**  of e-&gt;kind is not an assign, empty, body or modop</font>
00051 <font class="comment">**         verify the the value is void</font>
00052 <font class="comment">**</font>
00053 <font class="comment">*/</font>
00054 
00055 <font class="keywordtype">void</font>
<a name="l00056"></a><a class="code" href="exprChecks_c.html#a4">00056</a> <a class="code" href="exprChecks_c.html#a4">exprNode_checkStatement</a> (exprNode e)<font class="keyword"></font>
00057 <font class="keyword"></font>{
00058   <font class="keywordtype">bool</font> hasError = FALSE;
00059 
00060   <font class="keywordflow">if</font> (!exprNode_isError (e))
00061     {
00062       exprKind ek = e-&gt;kind;
00063 
00064       <font class="keywordflow">if</font> (ek == XPR_CALL &amp;&amp; !(<a class="code" href="ctype_c.html#a71">ctype_isRealVoid</a> (e-&gt;typ)))
00065         { 
00066           <font class="keywordflow">if</font> (ctype_isKnown (e-&gt;typ))
00067             {
00068               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a61">ctype_isManifestBool</a> (ctype_realishType (e-&gt;typ)))
00069                 {
00070                   hasError = optgenerror 
00071                     (FLG_RETVALBOOL,
00072                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Return value (type %t) ignored: %s"</font>,
00073                               e-&gt;typ,
00074                               exprNode_unparseFirst (e)),
00075                      e-&gt;loc);
00076                 }
00077               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a78">ctype_isDirectInt</a> (e-&gt;typ))
00078                 {
00079                   hasError = optgenerror 
00080                     (FLG_RETVALINT,
00081                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Return value (type %t) ignored: %s"</font>,
00082                               e-&gt;typ,
00083                               exprNode_unparseFirst (e)),
00084                      e-&gt;loc);
00085                 }
00086               <font class="keywordflow">else</font>
00087                 {
00088                   hasError = optgenerror 
00089                     (FLG_RETVALOTHER,
00090                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Return value (type %t) ignored: %s"</font>,
00091                               e-&gt;typ,
00092                               exprNode_unparseFirst (e)),
00093                      e-&gt;loc);
00094                 }
00095             }
00096         }
00097 
00098       <font class="keywordflow">if</font> (!hasError &amp;&amp; !(<a class="code" href="exprNode_c.html#a123">exprNode_mayEscape</a> (e))
00099           &amp;&amp; !(e-&gt;canBreak)) <font class="comment">/* control changes are effects too! */</font>
00100         {
00101           <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a24">sRefSet_hasRealElement</a> (e-&gt;sets)
00102               || <a class="code" href="sRefSet_c.html#a24">sRefSet_hasRealElement</a> (e-&gt;msets))
00103             {
00104               ; <font class="comment">/* okay */</font>
00105             }
00106           <font class="keywordflow">else</font>
00107             {
00108               <font class="keywordflow">if</font> (sRefSet_isEmpty (e-&gt;sets) &amp;&amp; sRefSet_isEmpty (e-&gt;msets))
00109                 {
00110                   voptgenerror
00111                     (FLG_NOEFFECT,
00112                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Statement has no effect: %s"</font>,
00113                               exprNode_unparseFirst (e)),
00114                      e-&gt;loc);
00115                 }
00116               <font class="keywordflow">else</font>
00117                 {
00118                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NOEFFECTUNCON))
00119                     {
00120                       <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a29">sRefSet_hasUnconstrained</a> (e-&gt;sets))
00121                         {
00122                           voptgenerror
00123                             (FLG_NOEFFECTUNCON,
00124                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Statement has no effect (possible "</font>
00125                                       <font class="stringliteral">"undected modification through "</font>
00126                                       <font class="stringliteral">"call to %q): %s"</font>,
00127                                       sRefSet_unparseUnconstrained (e-&gt;sets),
00128                                       <a class="code" href="exprNode_c.html#a159">exprNode_unparseFirst</a> (e)),
00129                              e-&gt;loc);
00130                         }
00131                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a29">sRefSet_hasUnconstrained</a> (e-&gt;msets))
00132                         {
00133                           voptgenerror
00134                             (FLG_NOEFFECTUNCON,
00135                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Statement has no effect (possible "</font>
00136                                       <font class="stringliteral">"undected modification through "</font>
00137                                       <font class="stringliteral">"call to %q): %s"</font>,
00138                                       sRefSet_unparseUnconstrained (e-&gt;msets),
00139                                       <a class="code" href="exprNode_c.html#a159">exprNode_unparseFirst</a> (e)),
00140                              e-&gt;loc);
00141                         }
00142                       <font class="keywordflow">else</font>
00143                         {
00144                           ; <font class="comment">/* statement has unknown modification */</font>
00145                         }
00146                     }
00147                 }
00148             }
00149         }
00150     }
00151 }
00152 
00153 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00154 checkRepExposed (sRef base, <font class="comment">/*@notnull@*/</font> exprNode e, sRef alias, 
00155                  <font class="comment">/*@unused@*/</font> exprNode unused)<font class="keyword"></font>
00156 <font class="keyword"></font>{
00157   ctype btype;
00158 
00159   <font class="keywordflow">if</font> (sRef_isInvalid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, alias))
00160     {
00161       btype = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (base);
00162 
00163       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (btype) &amp;&amp; <a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (e-&gt;typ))
00164         {
00165           voptgenerror (FLG_RETEXPOSE,
00166                         message (<font class="stringliteral">"Return value exposes rep of %s: %s"</font>,
00167                                  ctype_unparse (btype),
00168                                  <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00169                         e-&gt;loc);
00170           <font class="keywordflow">return</font> TRUE;
00171         }
00172     }
00173   <font class="keywordflow">else</font>
00174     {
00175       sRef rbase = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (base);
00176       btype = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (rbase);
00177                       
00178       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (btype) &amp;&amp; <a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (e-&gt;typ))
00179         {
00180           voptgenerror 
00181             (FLG_RETEXPOSE,
00182              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Return value may expose rep of %s through alias %q: %s"</font>,
00183                       ctype_unparse (btype),
00184                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (rbase),
00185                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00186              e-&gt;loc);
00187           <font class="keywordflow">return</font> TRUE;
00188         }
00189     }
00190 
00191   <font class="keywordflow">return</font> FALSE;
00192 }
00193 
00194 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00195 checkRefGlobParam (sRef base, <font class="comment">/*@notnull@*/</font> exprNode e,
00196                    sRef alias, <font class="comment">/*@unused@*/</font> exprNode unused)<font class="keyword"></font>
00197 <font class="keyword"></font>{
00198   <font class="keywordflow">if</font> (sRef_isInvalid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, alias))
00199     {
00200       ctype ct = e-&gt;typ;
00201 
00202       <font class="keywordflow">if</font> (ctype_isUnknown (ct))
00203         {
00204           ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (base);
00205         }
00206  
00207       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ct))
00208         {
00209           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (base))
00210             {
00211               voptgenerror
00212                 (FLG_RETALIAS,
00213                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns reference to global %q: %s"</font>,
00214                           sRef_unparse (base),
00215                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00216                  e-&gt;loc);
00217 
00218               <font class="keywordflow">return</font> TRUE;
00219             }
00220           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (base))
00221             {
00222               uentryList params = <a class="code" href="context_c.html#a131">context_getParams</a> ();
00223               <font class="keywordtype">int</font> paramno = <a class="code" href="sRef_c.html#a96">sRef_getParam</a> (base);
00224 
00225               <font class="keywordflow">if</font> (paramno &lt; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (params))
00226                 {
00227                   uentry arg = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (params, paramno);
00228                   sRef ref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (arg);
00229 
00230                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (arg) 
00231                       || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (ref) 
00232                       || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (ref)
00233                       || sRef_isRefCounted (ref))
00234                     {
00235                       ; <font class="comment">/* okay */</font>
00236                     }
00237                   <font class="keywordflow">else</font>
00238                     {
00239                       voptgenerror 
00240                         (FLG_RETALIAS,
00241                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns reference to parameter %q: %s"</font>,
00242                                   sRef_unparse (base),
00243                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00244                          e-&gt;loc);
00245                     }
00246                 }
00247               <font class="keywordflow">else</font>
00248                 {
00249                   llbuglit (<font class="stringliteral">"ret alias: bad paramno"</font>);
00250                 }
00251               
00252               <font class="keywordflow">return</font> TRUE;
00253             }
00254           <font class="keywordflow">else</font>
00255             {
00256               <font class="keywordflow">return</font> FALSE;
00257             }
00258         }
00259     }
00260   <font class="keywordflow">else</font>
00261     {
00262       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (e-&gt;typ))
00263         {
00264           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (base))
00265             {
00266               voptgenerror 
00267                 (FLG_RETALIAS,
00268                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function may return reference to global %q through alias %q: %s"</font>,
00269                           sRef_unparse (alias),
00270                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base),
00271                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00272                  e-&gt;loc);
00273               <font class="keywordflow">return</font> TRUE;
00274             }
00275           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (base) &amp;&amp; !(<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (base)))
00276             {
00277               uentryList params = <a class="code" href="context_c.html#a131">context_getParams</a> ();
00278               <font class="keywordtype">int</font> paramno = <a class="code" href="sRef_c.html#a96">sRef_getParam</a> (base);
00279               
00280               <font class="keywordflow">if</font> (paramno &lt; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (params))
00281                 {
00282                   uentry arg = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (params, paramno);
00283                   
00284                   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (arg))
00285                     {
00286                       voptgenerror 
00287                         (FLG_RETALIAS,
00288                          message 
00289                          (<font class="stringliteral">"Function may return reference to parameter %q through alias %q: %s"</font>,
00290                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base),
00291                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (alias),
00292                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00293                          e-&gt;loc);
00294                       
00295                       <font class="keywordflow">return</font> TRUE;
00296                     }
00297                 }
00298               <font class="keywordflow">else</font>
00299                 {
00300                   voptgenerror 
00301                     (FLG_RETALIAS,
00302                      message 
00303                      (<font class="stringliteral">"Function may return reference to parameter %q through alias %q: %s"</font>,
00304                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base),
00305                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (alias),
00306                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00307                      e-&gt;loc);
00308                   
00309                   <font class="keywordflow">return</font> TRUE;
00310                 }
00311             }
00312           <font class="keywordflow">else</font>
00313             {
00314               <font class="keywordflow">return</font> FALSE;
00315             }
00316         }
00317     }
00318   <font class="keywordflow">return</font> FALSE;
00319 }
00320 
00321 
00322 <font class="keywordtype">void</font>
<a name="l00323"></a><a class="code" href="exprChecks_c.html#a7">00323</a> <a class="code" href="exprChecks_c.html#a7">exprNode_checkModify</a> (exprNode e, exprNode err)<font class="keyword"></font>
00324 <font class="keyword"></font>{
00325   llassert (exprNode_isDefined (e));
00326 
00327   DPRINTF ((<font class="stringliteral">"Check modify: %s"</font>, exprNode_unparse (e)));
00328 
00329   <font class="keywordflow">if</font> (sRef_isValid (e-&gt;sref))
00330     {
00331       <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (checkModifyAux, sRef_isReference, e-&gt;sref, e, err);
00332     }
00333 }
00334 
00335 <font class="keywordtype">void</font>
<a name="l00336"></a><a class="code" href="exprChecks_c.html#a8">00336</a> <a class="code" href="exprChecks_c.html#a8">exprNode_checkModifyVal</a> (exprNode e, exprNode err)<font class="keyword"></font>
00337 <font class="keyword"></font>{
00338   llassert (exprNode_isDefined (e));
00339   
00340   DPRINTF ((<font class="stringliteral">"Check modify val: %s"</font>, exprNode_unparse (e)));
00341 
00342   <font class="keywordflow">if</font> (sRef_isValid (e-&gt;sref))
00343     {
00344       <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (checkModifyValAux, sRef_isReference, e-&gt;sref, e, err);
00345     }
00346 }
00347 
00348 <font class="keywordtype">void</font>
<a name="l00349"></a><a class="code" href="exprChecks_c.html#a9">00349</a> <a class="code" href="exprChecks_c.html#a9">exprChecks_checkNullReturn</a> (fileloc loc)<font class="keyword"></font>
00350 <font class="keyword"></font>{
00351   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a176">context_inRealFunction</a> ())
00352     {
00353       <font class="comment">/*</font>
00354 <font class="comment">      llmsg ("exprChecks_checkNullReturnExpr: not in function context");</font>
00355 <font class="comment">      */</font>
00356       <font class="keywordflow">return</font>;
00357     }
00358   <font class="keywordflow">else</font>
00359     {
00360       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (context_currentFunctionType ()))
00361         {
00362           ctype tr = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (context_currentFunctionType ());
00363 
00364           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a115">ctype_isFirstVoid</a> (tr))
00365             {
00366               <font class="keywordflow">if</font> (ctype_isUnknown (tr))
00367                 {
00368                   voptgenerror
00369                     (FLG_CONTROL,
00370                      cstring_makeLiteral (<font class="stringliteral">"Empty return in function declared to implicitly return int"</font>),
00371                      loc);
00372                 }
00373               <font class="keywordflow">else</font>
00374                 {
00375                   voptgenerror (FLG_CONTROL,
00376                                 message (<font class="stringliteral">"Empty return in function declared to return %t"</font>, tr),
00377                                 loc);
00378                 }
00379             }
00380         }
00381     }
00382 }
00383 
00384 <font class="keywordtype">void</font>
<a name="l00385"></a><a class="code" href="exprChecks_c.html#a10">00385</a> <a class="code" href="exprChecks_c.html#a10">exprNode_checkReturn</a> (exprNode e)<font class="keyword"></font>
00386 <font class="keyword"></font>{
00387   <font class="keywordflow">if</font> (!exprNode_isError (e))
00388     {
00389       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a176">context_inRealFunction</a> ())
00390         {
00391           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ())
00392             {
00393               llerror (FLG_CONTROL,
00394                        message (<font class="stringliteral">"Macro %s uses return (not functional)"</font>,
00395                                 context_inFunctionName ()));
00396             }
00397           <font class="keywordflow">else</font>
00398             {
00399               <font class="comment">/*</font>
00400 <font class="comment">                llbuglit ("exprNode_checkReturn: not in function context");</font>
00401 <font class="comment">                */</font>
00402             }
00403         }
00404       <font class="keywordflow">else</font>
00405         {
00406           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (context_currentFunctionType ()))
00407             {
00408               checkSafeReturnExpr (e);
00409             }
00410           <font class="keywordflow">else</font>
00411             {
00412               ;
00413             }
00414         }
00415     }
00416 }
00417 
00418 <font class="keywordtype">void</font>
<a name="l00419"></a><a class="code" href="exprChecks_c.html#a11">00419</a> <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring c, exprNode e)<font class="keyword"></font>
00420 <font class="keyword"></font>{
00421   ctype ct;
00422 
00423   <font class="keywordflow">if</font> (exprNode_isError (e))
00424     <font class="keywordflow">return</font>;
00425 
00426   ct = exprNode_getType (e);
00427 
00428   <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a133">exprNode_isAssign</a> (e))
00429     {
00430       voptgenerror 
00431         (FLG_PREDASSIGN,
00432          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Test expression for %s is assignment expression: %s"</font>, 
00433                   c, exprNode_unparse (e)),
00434          e-&gt;loc);
00435     }
00436 
00437   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (ct))
00438     {
00439      ;
00440     }
00441   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (ct))
00442     {
00443       voptgenerror
00444         (FLG_PREDBOOLPTR,
00445          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Test expression for %s not %s, type %t: %s"</font>, c, 
00446                   context_printBoolName (), 
00447                   ct, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00448          e-&gt;loc);
00449     }
00450   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (ct))
00451     {
00452       voptgenerror 
00453         (FLG_PREDBOOLINT,
00454          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Test expression for %s not %s, type %t: %s"</font>, c, 
00455                   context_printBoolName (), ct, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00456          e-&gt;loc);
00457     }
00458   <font class="keywordflow">else</font>
00459     {
00460       voptgenerror 
00461         (FLG_PREDBOOLOTHERS,
00462          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Test expression for %s not %s, type %t: %s"</font>, c, 
00463                   context_printBoolName (), ct, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00464          e-&gt;loc);
00465     }
00466 }
00467 
00468 <font class="keywordtype">void</font>
<a name="l00469"></a><a class="code" href="exprChecks_c.html#a12">00469</a> <a class="code" href="exprChecks_c.html#a12">exprChecks_checkUsedGlobs</a> (globSet decl, globSet used)<font class="keyword"></font>
00470 <font class="keyword"></font>{
00471   fileloc fl = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (context_getHeader ());
00472 
00473   <font class="keywordflow">if</font> (fileloc_isUndefined (fl))
00474     {
00475       fl = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (context_getHeader ());
00476     }
00477 
00478   globSet_allElements (decl, el)<font class="keyword"></font>
00479 <font class="keyword">    </font>{
00480       <font class="keywordflow">if</font> (!<a class="code" href="globSet_c.html#a5">globSet_member</a> (used, el))
00481         {
00482           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a162">sRef_isSpecInternalState</a> (el)
00483               || <a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (el))
00484             {
00485               ;
00486             }
00487           <font class="keywordflow">else</font>
00488             {
00489               cstring sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el);
00490               
00491               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (fl))
00492                 {
00493                   voptgenerror (FLG_USEALLGLOBS,
00494                                 message (<font class="stringliteral">"Global %s listed (%q) but not used"</font>, 
00495                                          sname, fileloc_unparse (fl)),
00496                                 g_currentloc);
00497                 }               
00498               <font class="keywordflow">else</font>
00499                 {
00500                   voptgenerror (FLG_USEALLGLOBS,
00501                                 message (<font class="stringliteral">"Global %s listed but not used"</font>, sname),
00502                                 fl);
00503                 }
00504 
00505               <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
00506             }
00507         }
00508     } end_globSet_allElements;
00509 }
00510 
00511 <font class="keywordtype">void</font>
<a name="l00512"></a><a class="code" href="exprChecks_c.html#a13">00512</a> <a class="code" href="exprChecks_c.html#a13">exprNode_checkAllMods</a> (sRefSet mods, uentry ue)<font class="keyword"></font>
00513 <font class="keyword"></font>{
00514   <font class="keywordtype">bool</font> realParams = FALSE;
00515   uentry le = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
00516   fileloc fl = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (le);
00517   uentryList specParamNames = uentryList_undefined;
00518   uentryList paramNames = <a class="code" href="context_c.html#a131">context_getParams</a> ();
00519 
00520   <font class="keywordflow">if</font> (uentry_isFunction (le))
00521     {
00522       specParamNames = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (le);  
00523 
00524       <font class="keywordflow">if</font> (uentryList_isUndefined (specParamNames))
00525         {
00526           ; <font class="comment">/* unknown params */</font>
00527         }
00528       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (paramNames) != <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (specParamNames))
00529         {
00530           llbug
00531             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"exprNode_checkAllMods: parameter lists have different sizes: "</font>
00532                       <font class="stringliteral">"%q (%d) / %q (%d)"</font>,
00533                       uentryList_unparse (paramNames),
00534                       <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (paramNames),
00535                       <a class="code" href="uentryList_c.html#a5">uentryList_unparse</a> (specParamNames),
00536                       <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (specParamNames)));
00537         }
00538       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (paramNames) &gt; 0 
00539                &amp;&amp; !<a class="code" href="uentry_c.html#a188">uentry_hasRealName</a> (uentryList_getN (specParamNames, 0)))
00540         {
00541           <font class="comment">/* loaded from a library */</font>
00542         }
00543       <font class="keywordflow">else</font>
00544         {
00545           realParams = TRUE;
00546         }
00547     }
00548 
00549   sRefSet_allElements (mods, sr)<font class="keyword"></font>
00550 <font class="keyword">    </font>{
00551       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (sr) || <a class="code" href="sRef_c.html#a163">sRef_isSpecState</a> (sr))
00552         {
00553           ; <font class="comment">/* should report on anything? */</font>
00554         }
00555       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (sr))
00556         {
00557           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a97">sRef_isModified</a> (sr))
00558             {
00559               <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a28">sRefSet_hasStatic</a> (mods))
00560                 {
00561                   ; <font class="comment">/* okay */</font>
00562                 }
00563               <font class="keywordflow">else</font>
00564                 {
00565                   <font class="keywordflow">if</font> (optgenerror 
00566                       (FLG_MUSTMOD,
00567                        message
00568                        (<font class="stringliteral">"Function %s specified to modify internal state "</font>
00569                         <font class="stringliteral">"but no internal state is modified"</font>, 
00570                         <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue)),
00571                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00572                     {
00573                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (le);
00574                     }
00575                 }
00576             }
00577         }
00578       <font class="keywordflow">else</font> 
00579         {
00580           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a97">sRef_isModified</a> (sr))
00581             {
00582               cstring sname = realParams ? <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr) : <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr);
00583               
00584               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (fl) &amp;&amp; !realParams)
00585                 {
00586                   voptgenerror 
00587                     (FLG_MUSTMOD,
00588                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect object listed (%q) in modifies "</font>
00589                               <font class="stringliteral">"clause of %s not modified: %s"</font>, 
00590                               fileloc_unparse (fl),
00591                               <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue),
00592                               sname),
00593                      <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
00594                 }               
00595               <font class="keywordflow">else</font>
00596                 {
00597                   <font class="keywordflow">if</font> (optgenerror 
00598                       (FLG_MUSTMOD,
00599                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect object listed in modifies of %s "</font>
00600                                 <font class="stringliteral">"not modified: %s"</font>, 
00601                                 uentry_rawName (ue),
00602                                 sname),
00603                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00604                     {
00605                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (le);
00606                     }
00607                 }
00608               <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
00609             }
00610         }
00611     } end_sRefSet_allElements;
00612 }
00613 
<a name="l00614"></a><a class="code" href="exprChecks_c.html#a14">00614</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a14">exprNode_checkMacroBody</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
00615 <font class="keyword"></font>{
00616   <font class="keywordflow">if</font> (!exprNode_isError (e))
00617     {
00618       uentry hdr;
00619 
00620       <font class="keywordflow">if</font> (!(<a class="code" href="context_c.html#a175">context_inFunctionLike</a> () || <a class="code" href="context_c.html#a224">context_inMacroConstant</a> ()
00621             || <a class="code" href="context_c.html#a225">context_inMacroUnknown</a> ()))
00622         {
00623           llcontbug 
00624             (message 
00625              (<font class="stringliteral">"exprNode_checkMacroBody: not in macro function or constant: %q"</font>, 
00626               <a class="code" href="context_c.html#a162">context_unparse</a> ()));
00627           <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (e);
00628           <font class="keywordflow">return</font>;
00629         }
00630 
00631       hdr = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
00632       
00633       <font class="keywordflow">if</font> (e-&gt;kind == XPR_STMTLIST || e-&gt;kind == XPR_BODY)
00634         {
00635           voptgenerror 
00636             (FLG_MACROSTMT,
00637              message 
00638              (<font class="stringliteral">"Macro %q definition is statement list (recommend "</font>
00639               <font class="stringliteral">"do { ... } while (0) constuction to ensure multiple "</font>
00640               <font class="stringliteral">"statement macro is syntactic function)"</font>,
00641               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (hdr)),
00642              fileloc_isDefined (e-&gt;loc) ? e-&gt;loc : g_currentloc);
00643         }
00644       
00645       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a224">context_inMacroConstant</a> ())
00646         {
00647           ctype t = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (hdr);
00648 
00649           <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (hdr, e-&gt;loc);
00650           
00651           <font class="keywordflow">if</font> (!(<a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (t, e)))
00652             {
00653               cstring uname = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (hdr);
00654 
00655               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (uname, context_getTrueName ())
00656                   || <a class="code" href="cstring_c.html#a18">cstring_equal</a> (uname, context_getFalseName ()))
00657                 {
00658                   <font class="comment">/* </font>
00659 <font class="comment">                  ** We need to do something special to allow FALSE and TRUE</font>
00660 <font class="comment">                  ** to be defined without reporting errors.  This is a tad</font>
00661 <font class="comment">                  ** bogus, but otherwise lots of things would break.</font>
00662 <font class="comment">                  */</font>
00663 
00664 
00665                   llassert (ctype_isManifestBool (t));
00666                   <font class="comment">/* Should also check type of e is a reasonable (?) bool type. */</font>
00667                 }
00668               <font class="keywordflow">else</font> 
00669                 {
00670                   <font class="keywordflow">if</font> (optgenerror 
00671                       (FLG_INCONDEFS,
00672                        message
00673                        (<font class="stringliteral">"Constant %q specified as %s, but defined as %s: %s"</font>,
00674                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (hdr),
00675                         <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (t),
00676                         <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (e-&gt;typ),
00677                         <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00678                        e-&gt;loc))
00679                     {
00680                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (hdr);
00681                     }
00682                 }
00683 
00684               <a class="code" href="cstring_c.html#a27">cstring_free</a> (uname);
00685             }
00686           <font class="keywordflow">else</font>
00687             {
00688               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NULLSTATE)
00689                   &amp;&amp; <a class="code" href="ctype_c.html#a31">ctype_isUA</a>(t) 
00690                   &amp;&amp; <a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (t)
00691                   &amp;&amp; <a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (e))
00692                 {
00693                   uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (ctype_typeId (t));
00694                   sRef   sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
00695                   
00696                   <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (sr))
00697                     {
00698                       vgenhinterror 
00699                         (FLG_NULLSTATE,
00700                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Constant %q of non-null type %s defined "</font>
00701                                   <font class="stringliteral">"as null: %s"</font>,
00702                                   uentry_getName (hdr), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (t),
00703                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00704                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"If %s can be null, add a /*@null@*/ "</font>
00705                                   <font class="stringliteral">"qualifer to its typedef."</font>,
00706                                   ctype_unparse (t)),
00707                          e-&gt;loc);
00708                     }
00709                   
00710                   <a class="code" href="uentry_c.html#a259">uentry_mergeConstantValue</a> (hdr, e-&gt;val);
00711                   e-&gt;val = multiVal_undefined;
00712                 }
00713             }
00714         }
00715       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a223">context_inMacroFunction</a> () || <a class="code" href="context_c.html#a225">context_inMacroUnknown</a> ())
00716         {
00717           ctype rettype = <a class="code" href="context_c.html#a117">context_getRetType</a> ();
00718 
00719           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a255">context_isMacroMissingParams</a> ())
00720             {
00721               llassert (context_inMacroFunction ());
00722 
00723               <font class="comment">/*</font>
00724 <font class="comment">              ** # define newname oldname</font>
00725 <font class="comment">              **</font>
00726 <font class="comment">              ** newname is a function</font>
00727 <font class="comment">              ** specification of oldname should match</font>
00728 <font class="comment">              ** specification of newname.</font>
00729 <font class="comment">              */</font>
00730 
00731               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (e-&gt;typ))
00732                 {
00733                   voptgenerror 
00734                     (FLG_INCONDEFS,
00735                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s defined by unparameterized "</font>
00736                               <font class="stringliteral">"macro not corresponding to function"</font>,
00737                               context_inFunctionName ()),
00738                      e-&gt;loc);
00739                 }
00740               <font class="keywordflow">else</font>
00741                 {
00742                   uentry ue = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (e);
00743 
00744                   <font class="keywordflow">if</font> (uentry_isValid (ue))
00745                     {
00746                       <font class="comment">/*</font>
00747 <font class="comment">                      ** Okay, for now --- should check for consistency</font>
00748 <font class="comment">                      */</font>
00749                       <font class="comment">/*</font>
00750 <font class="comment">                      ** uentry oldue = usymtab_lookup (cfname);</font>
00751 <font class="comment">                      */</font>
00752 
00753                       <font class="comment">/* check var conformance here! */</font>
00754                     }
00755                   <font class="keywordflow">else</font>
00756                     {
00757                       voptgenerror
00758                         (FLG_INCONDEFS,
00759                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s defined by unparameterized "</font>
00760                                   <font class="stringliteral">"macro not corresponding to function"</font>,
00761                                   context_inFunctionName ()),
00762                          e-&gt;loc);
00763                     }
00764                   
00765                   e-&gt;typ = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (e-&gt;typ);
00766                   rettype = e-&gt;typ; <font class="comment">/* avoid aditional errors */</font>
00767                 }
00768             }
00769 
00770           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a51">ctype_isVoid</a> (rettype) || ctype_isUnknown (rettype))
00771             {
00772              ; <font class="comment">/* don't complain when void macros have values */</font>
00773             }       
00774           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (rettype, e))
00775             {
00776               <font class="keywordflow">if</font> (optgenerror 
00777                   (FLG_INCONDEFS,
00778                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q specified to return %s, "</font>
00779                             <font class="stringliteral">"implemented as macro having type %s: %s"</font>,
00780                             uentry_getName (hdr),
00781                             <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (rettype), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (e-&gt;typ),
00782                             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00783                    e-&gt;loc))
00784                 {
00785                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (hdr);
00786                 }
00787             }
00788           <font class="keywordflow">else</font>
00789             {
00790               <font class="keywordflow">switch</font> (e-&gt;kind)
00791                 {
00792                   <font class="comment">/* these expressions have values: */</font>
00793                 <font class="keywordflow">case</font> XPR_PARENS: <font class="keywordflow">case</font> XPR_ASSIGN: 
00794                 <font class="keywordflow">case</font> XPR_EMPTY: <font class="keywordflow">case</font> XPR_VAR:
00795                 <font class="keywordflow">case</font> XPR_OP: <font class="keywordflow">case</font> XPR_POSTOP: 
00796                 <font class="keywordflow">case</font> XPR_PREOP: <font class="keywordflow">case</font> XPR_CALL: 
00797                 <font class="keywordflow">case</font> XPR_SIZEOFT: <font class="keywordflow">case</font> XPR_SIZEOF: 
00798                 <font class="keywordflow">case</font> XPR_ALIGNOFT: <font class="keywordflow">case</font> XPR_ALIGNOF: 
00799                 <font class="keywordflow">case</font> XPR_CAST: <font class="keywordflow">case</font> XPR_FETCH: 
00800                 <font class="keywordflow">case</font> XPR_COMMA: <font class="keywordflow">case</font> XPR_COND: 
00801                 <font class="keywordflow">case</font> XPR_ARROW: <font class="keywordflow">case</font> XPR_CONST: 
00802                 <font class="keywordflow">case</font> XPR_STRINGLITERAL: <font class="keywordflow">case</font> XPR_NUMLIT:
00803                 <font class="keywordflow">case</font> XPR_FACCESS: <font class="keywordflow">case</font> XPR_OFFSETOF:
00804 
00805                   <a class="code" href="aliasChecks_c.html#a27">checkReturnTransfer</a> (e, hdr);
00806                   <font class="keywordflow">break</font>;
00807 
00808                   <font class="comment">/* these expressions don't */</font>
00809                 <font class="keywordflow">case</font> XPR_LABEL:
00810                 <font class="keywordflow">case</font> XPR_VAARG: <font class="keywordflow">case</font> XPR_ITER: 
00811                 <font class="keywordflow">case</font> XPR_FOR: <font class="keywordflow">case</font> XPR_FORPRED:
00812                 <font class="keywordflow">case</font> XPR_GOTO: <font class="keywordflow">case</font> XPR_CONTINUE: 
00813                 <font class="keywordflow">case</font> XPR_BREAK: <font class="keywordflow">case</font> XPR_RETURN:
00814                 <font class="keywordflow">case</font> XPR_NULLRETURN: <font class="keywordflow">case</font> XPR_IF: 
00815                 <font class="keywordflow">case</font> XPR_IFELSE: <font class="keywordflow">case</font> XPR_DOWHILE:
00816                 <font class="keywordflow">case</font> XPR_WHILE: <font class="keywordflow">case</font> XPR_STMT: 
00817                 <font class="keywordflow">case</font> XPR_STMTLIST: <font class="keywordflow">case</font> XPR_SWITCH:
00818                 <font class="keywordflow">case</font> XPR_INIT: <font class="keywordflow">case</font> XPR_BODY: 
00819                 <font class="keywordflow">case</font> XPR_NODE: <font class="keywordflow">case</font> XPR_ITERCALL:
00820                 <font class="keywordflow">case</font> XPR_TOK: <font class="keywordflow">case</font> XPR_CASE: 
00821                 <font class="keywordflow">case</font> XPR_FTCASE: <font class="keywordflow">case</font> XPR_FTDEFAULT:
00822                 <font class="keywordflow">case</font> XPR_DEFAULT: <font class="keywordflow">case</font> XPR_WHILEPRED:
00823                 <font class="keywordflow">case</font> XPR_BLOCK: <font class="keywordflow">case</font> XPR_INITBLOCK:
00824                   <font class="keywordflow">if</font> (optgenerror 
00825                       (FLG_INCONDEFS,
00826                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q specified to return %s, "</font>
00827                                 <font class="stringliteral">"implemented as macro with no result: %s"</font>,
00828                                 uentry_getName (hdr),
00829                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (rettype), 
00830                                 <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
00831                        e-&gt;loc))
00832                     {
00833                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (hdr);
00834                     }
00835                 }
00836             }
00837 
00838           <a class="code" href="usymtab_c.html#a105">usymtab_checkFinalScope</a> (FALSE);
00839         }
00840       <font class="keywordflow">else</font>
00841         {
00842           llbug (message (<font class="stringliteral">"exprNode_checkMacroBody: not in macro function: %q"</font>, context_unparse ()));
00843         }
00844 
00845       <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (e);
00846     }
00847 
00848   <a class="code" href="context_c.html#a129">context_exitFunction</a> ();
00849   <font class="keywordflow">return</font>;
00850 }
00851 
<a name="l00852"></a><a class="code" href="exprChecks_c.html#a15">00852</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a15">exprNode_checkFunctionBody</a> (exprNode body)<font class="keyword"></font>
00853 <font class="keyword"></font>{
00854   <font class="keywordflow">if</font> (!exprNode_isError (body))
00855     {
00856       <font class="keywordtype">bool</font> noret = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NORETURN);
00857       <font class="keywordtype">bool</font> checkret = <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (body);
00858 
00859       <font class="keywordflow">if</font> (!checkret 
00860           &amp;&amp; noret 
00861           &amp;&amp; !<a class="code" href="exprNode_c.html#a126">exprNode_errorEscape</a> (body)
00862           &amp;&amp; <a class="code" href="context_c.html#a176">context_inRealFunction</a> ()
00863           &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (context_currentFunctionType ()))
00864         {
00865           ctype tr = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (context_currentFunctionType ());
00866           
00867           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a115">ctype_isFirstVoid</a> (tr)) 
00868             {
00869               <font class="keywordflow">if</font> (ctype_isUnknown (tr))
00870                 {
00871                   voptgenerror 
00872                     (FLG_NORETURN,
00873                      cstring_makeLiteral (<font class="stringliteral">"Path with no return in function declared to implicity return int"</font>), 
00874                      g_currentloc);
00875                 }
00876               <font class="keywordflow">else</font>
00877                 {
00878                   voptgenerror 
00879                     (FLG_NORETURN,
00880                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Path with no return in function declared to return %t"</font>, 
00881                               tr),
00882                      g_currentloc);
00883                 }
00884             }
00885         }
00886       
00887       <font class="keywordflow">if</font> (!checkret)
00888         {
00889           <a class="code" href="context_c.html#a128">context_returnFunction</a> ();
00890         }
00891     }
00892 }
00893       
<a name="l00894"></a><a class="code" href="exprChecks_c.html#a16">00894</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a16">exprNode_checkFunction</a> (<font class="comment">/*@unused@*/</font> uentry ue, <font class="comment">/*@only@*/</font> exprNode body)<font class="keyword"></font>
00895 <font class="keyword"></font>{
00896   <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (body);
00897   }
00898 
<a name="l00899"></a><a class="code" href="exprChecks_c.html#a17">00899</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a17">exprChecks_checkEmptyMacroBody</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00900 <font class="keyword"></font>{
00901   uentry hdr;
00902   
00903   <font class="keywordflow">if</font> (!(<a class="code" href="context_c.html#a175">context_inFunctionLike</a> () || <a class="code" href="context_c.html#a224">context_inMacroConstant</a> ()
00904         || <a class="code" href="context_c.html#a225">context_inMacroUnknown</a> ()))
00905     {
00906       llcontbug 
00907         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"exprNode_checkEmptyMacroBody: not in macro function or constant: %q"</font>, 
00908                   context_unparse ()));
00909       <font class="keywordflow">return</font>;
00910     }
00911   
00912   hdr = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
00913   
00914   beginLine ();
00915   
00916   <font class="keywordflow">if</font> (uentry_isFunction (hdr))
00917     {
00918       voptgenerror 
00919         (FLG_MACROEMPTY,
00920          message 
00921          (<font class="stringliteral">"Macro definition for %q is empty"</font>, <a class="code" href="uentry_c.html#a195">uentry_getName</a> (hdr)),
00922          g_currentloc);
00923 
00924       <a class="code" href="usymtab_c.html#a105">usymtab_checkFinalScope</a> (FALSE);
00925     }
00926 
00927   <a class="code" href="context_c.html#a129">context_exitFunction</a> ();
00928   <font class="keywordflow">return</font>;
00929 }
00930 
<a name="l00931"></a><a class="code" href="exprChecks_c.html#a18">00931</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a18">exprNode_checkIterBody</a> (<font class="comment">/*@only@*/</font> exprNode body)<font class="keyword"></font>
00932 <font class="keyword"></font>{
00933   <a class="code" href="context_c.html#a119">context_exitAllClauses</a> ();
00934 
00935   <a class="code" href="context_c.html#a129">context_exitFunction</a> ();
00936   <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (body);
00937 }
00938 
<a name="l00939"></a><a class="code" href="exprChecks_c.html#a19">00939</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a19">exprNode_checkIterEnd</a> (<font class="comment">/*@only@*/</font> exprNode body)<font class="keyword"></font>
00940 <font class="keyword"></font>{
00941   <a class="code" href="context_c.html#a119">context_exitAllClauses</a> ();
00942   <a class="code" href="context_c.html#a129">context_exitFunction</a> ();
00943   <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (body);
00944 }
00945 
00946 <font class="keyword">static</font>
00947 <font class="keywordtype">bool</font> checkModifyAuxAux (sRef s, exprNode f, sRef alias, exprNode err)<font class="keyword"></font>
00948 <font class="keyword"></font>{
00949   <font class="keywordtype">bool</font> hasMods = <a class="code" href="context_c.html#a118">context_hasMods</a> ();
00950   flagcode errCode = hasMods ? FLG_MODIFIES : FLG_MODNOMODS;
00951 
00952   <font class="keywordflow">if</font> (exprNode_isDefined (f))
00953     {
00954       f-&gt;sets = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (f-&gt;sets, s); 
00955     }
00956 
00957   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODIFIES) 
00958       &amp;&amp; (hasMods || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODNOMODS)))
00959     {
00960       sRefSet mods = <a class="code" href="context_c.html#a110">context_modList</a> ();
00961       
00962       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a100">sRef_canModify</a> (s, mods))
00963         {
00964           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
00965          
00966           
00967           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (rb))
00968             {
00969               <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a108">context_checkGlobMod</a> (rb))
00970                 {
00971                                   <font class="keywordflow">return</font> FALSE;
00972                 }
00973             }
00974 
00975           <font class="keywordflow">if</font> (sRef_isInvalid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s, alias))
00976             {
00977               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sRef_getRootBase (s)))
00978                 {
00979                   voptgenerror 
00980                     (errCode,
00981                      message 
00982                      (<font class="stringliteral">"Undocumented modification of internal state (%q): %s"</font>, 
00983                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)), 
00984                      exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
00985                 }
00986               <font class="keywordflow">else</font>
00987                 {
00988                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (s))
00989                     {
00990                       <font class="keywordflow">if</font> (errCode == FLG_MODNOMODS) 
00991                         {
00992                           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODNOMODS))
00993                             {
00994                               errCode = FLG_MODFILESYSTEM;
00995                             }
00996                         }
00997                       <font class="keywordflow">else</font>
00998                         {
00999                           errCode = FLG_MODFILESYSTEM;
01000                         }
01001                     }
01002 
01003                   voptgenerror 
01004                     (errCode,
01005                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undocumented modification of %q: %s"</font>, 
01006                               sRef_unparse (s), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)), 
01007                      exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01008                 }
01009               
01010               <font class="keywordflow">return</font> TRUE;
01011             }
01012           <font class="keywordflow">else</font>
01013             {
01014               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a249">sRef_isReference</a> (s) &amp;&amp; !<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (alias))
01015                 {
01016                   voptgenerror 
01017                     (errCode,
01018                      message
01019                      (<font class="stringliteral">"Possible undocumented modification of %q through alias %q: %s"</font>, 
01020                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s),
01021                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (alias),
01022                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)),
01023                      exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01024                   <font class="keywordflow">return</font> TRUE;
01025                 }
01026             }
01027         }
01028     }
01029   <font class="keywordflow">else</font>
01030     {
01031       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MUSTMOD))
01032         {
01033           (<font class="keywordtype">void</font>) <a class="code" href="sRef_c.html#a100">sRef_canModify</a> (s, context_modList ());
01034         }
01035       
01036       <font class="keywordflow">if</font> (sRef_isRefsField (s))
01037         {
01038           <a class="code" href="sRef_c.html#a98">sRef_setModified</a> (s);
01039         }
01040     }
01041   
01042   <font class="keywordflow">return</font> FALSE;
01043 }
01044 
01045 <font class="keyword">static</font>
01046 <font class="keywordtype">bool</font> checkModifyAux (sRef s, exprNode f, sRef alias, exprNode err)<font class="keyword"></font>
01047 <font class="keyword"></font>{
01048   DPRINTF ((<font class="stringliteral">"Check modify aux: %s"</font>, sRef_unparseFull (s)));
01049 
01050   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a249">sRef_isReference</a> (s) &amp;&amp; <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (s) 
01051       &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MODOBSERVER))
01052     {    
01053       cstring sname;
01054       
01055       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (s)) 
01056         {
01057           sRef base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (s);
01058           sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base);
01059         }
01060       <font class="keywordflow">else</font> 
01061         {
01062           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (s))
01063             {
01064               sRef p = <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (s);
01065               sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (p);
01066             }
01067           <font class="keywordflow">else</font>
01068             {
01069               sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s);
01070             }
01071         }
01072       
01073       <font class="keywordflow">if</font> (!sRef_isValid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s, alias))
01074         {
01075           <font class="keywordflow">if</font> (sRef_isMeaningful (s))
01076             {
01077               <font class="keywordflow">if</font> (optgenerror 
01078                   (FLG_MODOBSERVER,
01079                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect modification of observer %s: %s"</font>, 
01080                             sname, exprNode_unparse (err)), 
01081                    exprNode_isDefined (f) ? f-&gt;loc : g_currentloc))
01082                 {
01083                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (s);
01084                 }
01085             }
01086           <font class="keywordflow">else</font>
01087             {
01088               voptgenerror 
01089                 (FLG_MODOBSERVER,
01090                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect modification of observer returned by "</font>
01091                           <font class="stringliteral">"function call: %s"</font>, 
01092                           exprNode_unparse (err)), 
01093                  exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01094             }
01095         }
01096       <font class="keywordflow">else</font>
01097         {
01098           <font class="keywordflow">if</font> (optgenerror
01099               (FLG_MODOBSERVER,
01100                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect modification of observer %s through alias %q: %s"</font>, 
01101                         sname, sRef_unparse (alias), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)), 
01102                exprNode_isDefined (f) ? f-&gt;loc : g_currentloc))
01103             {
01104               <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (s);
01105             }
01106         }
01107       
01108       <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
01109     }
01110   
01111   (<font class="keywordtype">void</font>) checkModifyAuxAux (s, f, alias, err);
01112   <font class="keywordflow">return</font> FALSE;
01113 }
01114 
01115 <font class="keyword">static</font>
01116 <font class="keywordtype">bool</font> checkModifyValAux (sRef s, exprNode f, sRef alias, exprNode err)<font class="keyword"></font>
01117 <font class="keyword"></font>{
01118   (<font class="keywordtype">void</font>) checkModifyAuxAux (s, f, alias, err);
01119   <font class="keywordflow">return</font> FALSE;
01120 }
01121 
01122 <font class="keyword">static</font>
01123 <font class="keywordtype">bool</font> checkCallModifyAux (sRef s, exprNode f, sRef alias, exprNode err)<font class="keyword"></font>
01124 <font class="keyword"></font>{
01125   <font class="keywordtype">bool</font> result = FALSE;
01126 
01127   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (s) &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MODOBSERVER))
01128     {    
01129       sRef p = <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (s) ? <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (s) : s;
01130       cstring sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (p);
01131 
01132       <font class="keywordflow">if</font> (!sRef_isValid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s, alias))
01133         {
01134           <font class="keywordflow">if</font> (sRef_isMeaningful (s))
01135             {
01136               result = optgenerror 
01137                 (FLG_MODOBSERVER,
01138                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect modification of observer %s: %s"</font>, 
01139                           sname, exprNode_unparse (err)), 
01140                  exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01141             }
01142           <font class="keywordflow">else</font>
01143             {
01144               result = optgenerror 
01145                 (FLG_MODOBSERVER,
01146                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspect modification of observer returned by "</font>
01147                           <font class="stringliteral">"function call: %s"</font>, 
01148                           exprNode_unparse (err)), 
01149                  exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01150             }
01151         }
01152       <font class="keywordflow">else</font>
01153         {
01154           result = optgenerror 
01155             (FLG_MODOBSERVER,
01156              message
01157              (<font class="stringliteral">"Suspect modification of observer %s through alias %q: %s"</font>, 
01158               sname, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (alias), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)), 
01159              exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01160         }
01161       
01162       <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
01163     }
01164   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MODIFIES))
01165     {
01166       <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a99">sRef_canModifyVal</a> (s, context_modList ())))
01167         {
01168           sRef p = <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (s) ? <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (s) : s;
01169           cstring sname = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (p);
01170           <font class="keywordtype">bool</font> hasMods = <a class="code" href="context_c.html#a118">context_hasMods</a> ();
01171           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
01172           flagcode errCode = hasMods ? FLG_MODIFIES : FLG_MODNOMODS;
01173           <font class="keywordtype">bool</font> check = TRUE;
01174           
01175           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (rb))
01176             {
01177               uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (rb);
01178               
01179               <font class="comment">/* be more specific here! */</font>
01180               <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a92">uentry_isCheckedModify</a> (ue))
01181                 {
01182                   check = FALSE;
01183                 }
01184             }
01185           
01186           <font class="keywordflow">if</font> (check)
01187             {
01188               <font class="keywordflow">if</font> (!sRef_isValid (alias) || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s, alias))
01189                 {
01190                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sRef_getRootBase (s)))
01191                     {
01192                       voptgenerror 
01193                         (errCode,
01194                          message 
01195                          (<font class="stringliteral">"Undocumented modification of internal "</font>
01196                           <font class="stringliteral">"state (%q) through call to %s: %s"</font>, 
01197                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f),
01198                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)), 
01199                          exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01200                     }
01201                   <font class="keywordflow">else</font>
01202                     {
01203                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (s))
01204                         {
01205                           <font class="keywordflow">if</font> (errCode == FLG_MODNOMODS) 
01206                             {
01207                               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODNOMODS))
01208                                 {
01209                                   errCode = FLG_MODFILESYSTEM;
01210                                 }
01211                             }
01212                           <font class="keywordflow">else</font>
01213                             {
01214                               errCode = FLG_MODFILESYSTEM;
01215                             }
01216                         }
01217                       
01218                       result = optgenerror 
01219                         (errCode,
01220                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undocumented modification of %s "</font>
01221                                   <font class="stringliteral">"possible from call to %s: %s"</font>, 
01222                                   sname,
01223                                   exprNode_unparse (f),
01224                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)),
01225                          exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01226                     }
01227                 }
01228               <font class="keywordflow">else</font>
01229                 {
01230                   result = optgenerror
01231                     (errCode,
01232                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undocumented modification of %s possible "</font>
01233                               <font class="stringliteral">"from call to %s (through alias %q): %s"</font>, 
01234                               sname,
01235                               exprNode_unparse (f), 
01236                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (alias), 
01237                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (err)),
01238                      exprNode_isDefined (f) ? f-&gt;loc : g_currentloc);
01239                 }
01240             }
01241           <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
01242         }
01243     }
01244   <font class="keywordflow">else</font>
01245     {
01246       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MUSTMOD))
01247         {
01248           (<font class="keywordtype">void</font>) <a class="code" href="sRef_c.html#a99">sRef_canModifyVal</a> (s, context_modList ());
01249         }
01250     }
01251 
01252   <font class="keywordflow">return</font> result;
01253 }
01254 
<a name="l01255"></a><a class="code" href="exprChecks_c.html#a21">01255</a> <font class="keywordtype">void</font> <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (sRef s, exprNodeList args, exprNode f, exprNode err)<font class="keyword"></font>
01256 <font class="keyword"></font>{
01257   s = <a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s, args);
01258   <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (checkCallModifyAux, NULL, s, f, err);
01259 }
01260 
01261 <font class="keywordtype">void</font>
<a name="l01262"></a><a class="code" href="exprChecks_c.html#a22">01262</a> <a class="code" href="exprChecks_c.html#a22">exprChecks_checkExport</a> (uentry e)<font class="keyword"></font>
01263 <font class="keyword"></font>{
01264   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a104">context_checkExport</a> (e))
01265     {
01266       fileloc fl = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
01267       
01268       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a43">fileloc_isHeader</a> (fl) &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (fl) 
01269           &amp;&amp; !fileloc_isImport (fl) &amp;&amp; !uentry_isStatic (e))
01270         {
01271           <font class="keywordflow">if</font> (uentry_isFunction (e) || 
01272               (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (e))))
01273             {
01274               voptgenerror 
01275                 (FLG_EXPORTFCN,
01276                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function exported, but not specified: %q"</font>, 
01277                           uentry_getName (e)),
01278                  fl);
01279             }
01280           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (e))
01281             {
01282               voptgenerror
01283                 (FLG_EXPORTMACRO,
01284                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Expanded macro exported, but not specified: %q"</font>, 
01285                           uentry_getName (e)),
01286                  fl);
01287             }
01288           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e) &amp;&amp; !<a class="code" href="uentry_c.html#a170">uentry_isParam</a> (e)) 
01289             {
01290               voptgenerror 
01291                 (FLG_EXPORTVAR,
01292                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Variable exported, but not specified: %q"</font>, 
01293                           uentry_getName (e)),
01294                  fl);
01295             }
01296           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isEitherConstant (e))
01297             {
01298               voptgenerror 
01299                 (FLG_EXPORTCONST,
01300                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Constant exported, but not specified: %q"</font>, 
01301                           uentry_getName (e)),
01302                  fl);
01303             }
01304           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (e) || <a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (e))
01305             {
01306               voptgenerror 
01307                 (FLG_EXPORTITER,
01308                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Iterator exported, but not specified: %q"</font>, 
01309                           uentry_getName (e)),
01310                  fl);
01311             }
01312 
01313           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e))
01314             {
01315               ; <font class="comment">/* error already reported */</font>
01316             }
01317           <font class="keywordflow">else</font>
01318             {
01319               BADEXIT;
01320             }
01321         }
01322     }
01323 }
01324 
01325 <font class="keyword">static</font> <font class="keywordtype">void</font> checkSafeReturnExpr (<font class="comment">/*@notnull@*/</font> exprNode e)<font class="keyword"></font>
01326 <font class="keyword"></font>{
01327   ctype tr = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (context_currentFunctionType ());
01328   ctype te = exprNode_getType (e);
01329 
01330   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a97">ctype_forceMatch</a> (tr, te) &amp;&amp; !<a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (tr, e))
01331     {
01332       (<font class="keywordtype">void</font>) gentypeerror
01333         (te, e, tr, exprNode_undefined,
01334          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Return value type %t does not match declared type %t: %s"</font>,
01335                   te, tr, exprNode_unparse (e)),
01336          e-&gt;loc);
01337     }
01338   <font class="keywordflow">else</font>
01339     {
01340       sRef ret = e-&gt;sref;
01341       uentry rval = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
01342       sRef resultref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (rval);
01343 
01344       <a class="code" href="aliasChecks_c.html#a27">checkReturnTransfer</a> (e, rval);
01345 
01346       <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (uentry_getSref (context_getHeader ()))
01347             || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (uentry_getSref (context_getHeader ())))
01348           &amp;&amp; (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_RETALIAS) 
01349               || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_RETEXPOSE)))
01350         {
01351           sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (ret);
01352           ctype rtype = e-&gt;typ;
01353 
01354           <font class="keywordflow">if</font> (ctype_isUnknown (rtype))
01355             {
01356               rtype = tr;
01357             }
01358 
01359           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (rtype))
01360             {
01361               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_RETALIAS))
01362                 {
01363                   <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (checkRefGlobParam, NULL, base, 
01364                                        e, exprNode_undefined);
01365                 }
01366               
01367               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_RETEXPOSE) &amp;&amp; <a class="code" href="sRef_c.html#a250">sRef_isIReference</a> (ret) 
01368                   &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (resultref) &amp;&amp; !<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (resultref))
01369                 {
01370                   <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (checkRepExposed, NULL, base, e, 
01371                                        exprNode_undefined);
01372                 }
01373             }
01374         }
01375     }
01376 }
01377 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:40 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
