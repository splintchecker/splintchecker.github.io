<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>osd.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:43 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>osd.c</h1><a href="osd_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** osd.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Provide a system-independent interface to system-dependent</font>
00028 <font class="comment">** file operations.</font>
00029 <font class="comment">*/</font>
00030 
00031 <font class="comment">/*</font>
00032 <font class="comment"> * Modified by Herbert 04/19/97:</font>
00033 <font class="comment"> * - added conditional 'OS2' to conditional 'MSDOS'</font>
00034 <font class="comment"> * - added include of new header portab.h.</font>
00035 <font class="comment"> * - changed '/' to macro.</font>
00036 <font class="comment"> * - added DOS / OS/2 specific stuff in osd_getPath.</font>
00037 <font class="comment"> * Herbert 06/12/2000:</font>
00038 <font class="comment"> * - added OS/2 specific includes before osd_getPid()</font>
00039 <font class="comment"> * - handle files like in WIN32 for OS/2 in osd_fileExists()</font>
00040 <font class="comment"> */</font>
00041 
00042 <font class="comment">/*@-allmacros*/</font>
00043 <font class="comment">/*@ignore@*/</font>
00044 <font class="preprocessor"># include &lt;sys/types.h&gt;</font>
00045 <font class="preprocessor"># include &lt;sys/stat.h&gt;</font>
00046 <font class="comment">/* Fix suggested by Lars Rasmussen */</font>
00047 <font class="preprocessor"># include &lt;errno.h&gt;</font>
00048 <font class="comment">/*@end@*/</font>
00049 <font class="comment">/*@=allmacros*/</font>
00050 <font class="preprocessor"># include "lclintMacros.nf"</font>
00051 <font class="preprocessor"># include "basic.h"</font>
00052 <font class="preprocessor"># include "osd.h"</font>
00053 <font class="preprocessor"># include "portab.h"</font>
00054 
00055 <font class="comment">/* from stat.h */</font>
00056 <font class="comment">/*@ignore@*/</font>
00057 <font class="keyword">extern</font> <font class="keywordtype">int</font> <a class="code" href="osd_c.html#a0">stat</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *, <font class="comment">/*@out@*/</font> <font class="keyword">struct</font> stat *);
00058 <font class="comment">/*@end@*/</font>
00059 
00060 <font class="keyword">static</font> <font class="keywordtype">bool</font> osd_executableFileExists (<font class="keywordtype">char</font> *);
00061 
00062 <font class="keyword">static</font> <font class="keywordtype">bool</font> nextdir (<font class="keywordtype">char</font> **p_current_dir, <font class="comment">/*@out@*/</font> <font class="keywordtype">char</font> **p_dir, 
00063                      <font class="comment">/*@out@*/</font> size_t *p_len);
00064 
<a name="l00065"></a><a class="code" href="osd_c.html#a3">00065</a> <font class="keyword">extern</font> <font class="keywordtype">char</font> *<a class="code" href="osd_c.html#a3">LSLRootName</a> (<font class="keywordtype">char</font> *filespec)<font class="keyword"></font>
00066 <font class="keyword"></font>{
00067   <font class="keywordtype">char</font> *result, *startName, *tail;
00068   size_t nameLength;
00069 
00070   tail = strrchr (filespec, CONNECTCHAR);
00071   startName = (tail == NULL ? filespec : &amp;tail[1]);
00072   tail = strrchr (startName, <font class="charliteral">'.'</font>);
00073   nameLength = (tail == NULL ? strlen (startName) 
00074                 : <a class="code" href="general_c.html#a33">size_fromInt</a> (tail - startName));
00075   result = dmalloc (nameLength + 1);
00076   strncpy (result, startName, nameLength);
00077   result[(<font class="keywordtype">int</font>) nameLength] = <font class="charliteral">'\0'</font>;
00078   <font class="keywordflow">return</font> result;
00079 }
00080 
00081 <font class="keyword">extern</font> <font class="comment">/*@observer@*/</font> <font class="keywordtype">char</font> *
<a name="l00082"></a><a class="code" href="osd_c.html#a4">00082</a> <a class="code" href="osd_c.html#a4">osd_getEnvironment</a> (<font class="keywordtype">char</font> *env, <font class="comment">/*@returned@*/</font> <font class="keywordtype">char</font> *def)<font class="keyword"></font>
00083 <font class="keyword"></font>{
00084   <font class="keywordtype">char</font> *ret = <a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (env);
00085 
00086   <font class="keywordflow">if</font> (ret == NULL)
00087     {
00088       <font class="keywordflow">return</font> def;
00089     }
00090   <font class="keywordflow">else</font>
00091     {
00092       <font class="keywordflow">return</font> ret;
00093     }
00094 }
00095 
00096 
00097 <font class="comment">/*</font>
00098 <font class="comment">**++</font>
00099 <font class="comment">**  FUNCTIONAL DESCRIPTION:</font>
00100 <font class="comment">**</font>
00101 <font class="comment">**      This function attempts to locate a file in a search list.  On VMS, it</font>
00102 <font class="comment">**      just concatinates the path and file names, and then lets RMS do the</font>
00103 <font class="comment">**      searching.  On Ultrix, it searches for the file on the path.</font>
00104 <font class="comment">**</font>
00105 <font class="comment">**  FORMAL PARAMETERS:</font>
00106 <font class="comment">**</font>
00107 <font class="comment">**      path:       search path where to look for the file.</font>
00108 <font class="comment">**      file:       name of file to search for.</font>
00109 <font class="comment">**      returnPath: if a file is found, this is where the concatenated</font>
00110 <font class="comment">**                  directory and file name are returned.</font>
00111 <font class="comment">**</font>
00112 <font class="comment">**  RETURN VALUE:</font>
00113 <font class="comment">**</font>
00114 <font class="comment">**      OSD_FILEFOUND:      the file was found on the search list.</font>
00115 <font class="comment">**      OSD_FILENOTFOUND    the file was not found.</font>
00116 <font class="comment">**      OSD_PATHTOOLONG     the concatenated directory and file name are too</font>
00117 <font class="comment">**                          long.</font>
00118 <font class="comment">**</font>
00119 <font class="comment">**  SIDE EFFECTS:</font>
00120 <font class="comment">**</font>
00121 <font class="comment">**      None</font>
00122 <font class="comment">**</font>
00123 <font class="comment">**  PRECONDITIONS:</font>
00124 <font class="comment">**</font>
00125 <font class="comment">**      Requires that parameters, path and file, are valid C strings.</font>
00126 <font class="comment">**</font>
00127 <font class="comment">**</font>
00128 <font class="comment">**--</font>
00129 <font class="comment">*/</font>
00130 
00131 <font class="keyword">extern</font> <font class="comment">/*@null@*/</font> <font class="comment">/*@observer@*/</font> <font class="keywordtype">char</font> *
<a name="l00132"></a><a class="code" href="osd_c.html#a5">00132</a>   <a class="code" href="osd_c.html#a5">osd_getHomeDir</a> ()<font class="keyword"></font>
00133 <font class="keyword"></font>{
00134   <font class="comment">/* Would something different be better for windows? */</font>
00135   <font class="keywordflow">return</font> (<a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (<font class="stringliteral">"HOME"</font>));
00136 }
00137 
<a name="l00138"></a><a class="code" href="osd_c.html#a6">00138</a> filestatus <a class="code" href="osd_c.html#a6">osd_findOnLarchPath</a> (<font class="keywordtype">char</font> *file, <font class="keywordtype">char</font> **returnPath)<font class="keyword"></font>
00139 <font class="keyword"></font>{
00140   <font class="keywordflow">return</font> (<a class="code" href="osd_c.html#a7">osd_getPath</a> (cstring_toCharsSafe (context_getLarchPath ()), file, returnPath));
00141 }
00142 
00143 <font class="keyword">extern</font> filestatus
<a name="l00144"></a><a class="code" href="osd_c.html#a7">00144</a> <a class="code" href="osd_c.html#a7">osd_getPath</a> (<font class="keywordtype">char</font> *path, <font class="keywordtype">char</font> *file, <font class="keywordtype">char</font> **returnPath)<font class="keyword"></font>
00145 <font class="keyword"></font>{
00146   <font class="keywordtype">char</font> *fullPath;
00147   <font class="keywordtype">char</font> *dirPtr;
00148   size_t dirLen;
00149   <font class="keywordtype">char</font> aPath[MAXPATHLEN];
00150   filestatus rVal = OSD_FILENOTFOUND;   <font class="comment">/* assume file not found. */</font>
00151 
00152   fullPath = path;
00153 
00154   <font class="keywordflow">if</font> (fullPath == NULL || 
00155 <font class="preprocessor"># if defined(OS2) || defined(MSDOS) || defined(WIN32)</font>
00156 <font class="preprocessor"></font>    <font class="comment">/* under OS/2 and MSDOS the includePath may be empty, if so, search </font>
00157 <font class="comment">     * the current directory. */</font>
00158     *fullPath == <font class="charliteral">'\0'</font> || 
00159     (*file == CONNECTCHAR || (file[0] != <font class="charliteral">'\0'</font> &amp;&amp; file[1] == <font class="charliteral">':'</font>)))
00160 <font class="preprocessor"># else</font>
00161 <font class="preprocessor"></font>     (*file == CONNECTCHAR))
00162 <font class="preprocessor"># endif</font>
00163 <font class="preprocessor"></font>    {
00164      <font class="comment">/* No path specified. Look for it in the current directory.            */</font>
00165 
00166       strcpy (&amp;aPath[0], file);
00167 
00168       <font class="keywordflow">if</font> (<a class="code" href="osd_c.html#a9">osd_fileExists</a> (&amp;aPath[0]))
00169         {
00170           rVal = OSD_FILEFOUND;
00171           *returnPath = dmalloc (strlen (&amp;aPath[0]) + 1);
00172           strcpy (*returnPath, &amp;aPath[0]);
00173         }
00174     }
00175   <font class="keywordflow">else</font>
00176     {
00177      <font class="comment">/* Path specified. Loop through directories in path looking for the */</font>
00178      <font class="comment">/* first occurrence of the file.                               */</font>
00179 
00180       <font class="keywordflow">while</font> (nextdir (&amp;fullPath, &amp;dirPtr, &amp;dirLen) &amp;&amp;
00181              rVal == OSD_FILENOTFOUND)
00182         {
00183           <font class="keywordflow">if</font> ((dirLen + strlen (file) + 2) &lt;= MAXPATHLEN)
00184             {
00185              <font class="comment">/* Cat directory and filename, and see if file exists.  */</font>
00186               strncpy (&amp;aPath[0], dirPtr, dirLen);
00187               strcpy (&amp;aPath[0] + dirLen, <font class="stringliteral">""</font>);  <font class="comment">/* Null terminate aPath. */</font>
00188               strcat (&amp;aPath[0], CONNECTSTR);
00189               strcat (&amp;aPath[0], file);
00190 
00191               <font class="keywordflow">if</font> (<a class="code" href="osd_c.html#a9">osd_fileExists</a> (&amp;aPath[0]))
00192                 {
00193                   rVal = OSD_FILEFOUND;
00194                   *returnPath = (<font class="keywordtype">char</font> *) dmalloc (strlen (&amp;aPath[0]) + 1);
00195                   strcpy (*returnPath, &amp;aPath[0]);
00196                 }
00197             }
00198           <font class="keywordflow">else</font>
00199             {
00200               rVal = OSD_PATHTOOLONG;
00201             }
00202         }       
00203     }
00204 
00205   <font class="keywordflow">return</font> rVal;
00206 }
00207 
00208 <font class="keyword">extern</font> filestatus
<a name="l00209"></a><a class="code" href="osd_c.html#a8">00209</a> <a class="code" href="osd_c.html#a8">osd_getExePath</a> (<font class="keywordtype">char</font> *path, <font class="keywordtype">char</font> *file, <font class="keywordtype">char</font> **returnPath)<font class="keyword"></font>
00210 <font class="keyword"></font>{
00211   <font class="keywordtype">char</font> *fullPath;
00212   <font class="keywordtype">char</font> *dirPtr;
00213   size_t dirLen;
00214   <font class="keywordtype">char</font> aPath[MAXPATHLEN];
00215   filestatus rVal = OSD_FILENOTFOUND;   <font class="comment">/* assume file not found. */</font>
00216   
00217   fullPath = <a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (path);
00218 
00219   <font class="keywordflow">if</font> (fullPath == NULL)
00220     {
00221      <font class="comment">/* No path specified. Look for it in the current directory. */</font>
00222 
00223       strcpy (&amp;aPath[0], file);
00224 
00225       <font class="keywordflow">if</font> (<a class="code" href="osd_c.html#a9">osd_fileExists</a> (&amp;aPath[0]))
00226         {
00227           rVal = OSD_FILEFOUND;
00228           *returnPath = dmalloc (strlen (&amp;aPath[0]) + 1);
00229           strcpy (*returnPath, &amp;aPath[0]);
00230         }
00231     }
00232   <font class="keywordflow">else</font>
00233     {
00234      <font class="comment">/* </font>
00235 <font class="comment">     ** Path specified. Loop through directories in path looking</font>
00236 <font class="comment">     ** for the first occurrence of the file.                               </font>
00237 <font class="comment">     */</font>
00238 
00239       <font class="keywordflow">while</font> (nextdir (&amp;fullPath, &amp;dirPtr, &amp;dirLen) &amp;&amp;
00240              rVal == OSD_FILENOTFOUND)
00241         {
00242           <font class="keywordflow">if</font> ((dirLen + strlen (file) + 2) &lt;= MAXPATHLEN)
00243             {
00244               <font class="comment">/* Cat directory and filename, and see if file exists.  */</font>
00245               strncpy (&amp;aPath[0], dirPtr, dirLen);
00246               strcpy (&amp;aPath[0] + dirLen, <font class="stringliteral">""</font>); <font class="comment">/* Null terminate aPath. */</font>
00247               strcat (&amp;aPath[0], CONNECTSTR);
00248               strcat (&amp;aPath[0], file);
00249 
00250               <font class="keywordflow">if</font> (osd_executableFileExists (&amp;aPath[0]))
00251                 {
00252                   rVal = OSD_FILEFOUND;
00253                   *returnPath = dmalloc (strlen (&amp;aPath[0]) + 1);
00254                   strcpy (*returnPath, &amp;aPath[0]);
00255                 }
00256             }
00257           <font class="keywordflow">else</font>
00258             {
00259               rVal = OSD_PATHTOOLONG;
00260             }
00261         }
00262     }
00263 
00264   <font class="keywordflow">return</font> rVal;
00265 }
00266 
00267 <font class="keywordtype">bool</font>
<a name="l00268"></a><a class="code" href="osd_c.html#a9">00268</a> <a class="code" href="osd_c.html#a9">osd_fileExists</a> (<font class="keywordtype">char</font> *filespec)<font class="keyword"></font>
00269 <font class="keyword"></font>{
00270 <font class="preprocessor"># ifdef UNIX</font>
00271 <font class="preprocessor"></font>  <font class="keyword">struct </font>stat buf;
00272   <font class="keywordflow">return</font> (<a class="code" href="osd_c.html#a0">stat</a> (filespec, &amp;buf) == 0);
00273 <font class="preprocessor"># else</font>
00274 <font class="preprocessor"></font><font class="preprocessor"># if defined (WIN32) || defined (OS2)</font>
00275 <font class="preprocessor"></font>  FILE *test = fopen (filespec, <font class="stringliteral">"r"</font>);
00276   <font class="keywordflow">if</font> (test != NULL) 
00277   {
00278         (<font class="keywordtype">void</font>) fclose (test);
00279         <font class="keywordflow">return</font> TRUE;
00280   } 
00281   <font class="keywordflow">else</font>
00282   { 
00283           <font class="keywordflow">return</font> FALSE;
00284   }
00285 <font class="preprocessor"># else </font>
00286 <font class="preprocessor"></font>  <font class="keywordflow">return</font> FALSE;
00287 <font class="preprocessor"># endif</font>
00288 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00289 <font class="preprocessor"></font>}
00290 
00291 <font class="keywordtype">bool</font>
00292 osd_executableFileExists (<font class="comment">/*@unused@*/</font> <font class="keywordtype">char</font> *filespec)<font class="keyword"></font>
00293 <font class="keyword"></font>{
00294 <font class="preprocessor"># ifdef UNIX</font>
00295 <font class="preprocessor"></font>        <font class="keyword">struct </font>stat buf;
00296 <font class="preprocessor"># if defined(__IBMC__) &amp;&amp; defined(OS2)</font>
00297 <font class="preprocessor"></font><font class="preprocessor"># define S_IFMT (unsigned short)0xFFFF</font>
00298 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00299 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (<a class="code" href="osd_c.html#a0">stat</a> (filespec, &amp;buf) == 0)
00300     { 
00301       <font class="comment">/* mask by file type */</font>
00302       <font class="comment">/*@-unrecog@*/</font> <font class="comment">/* S_IFMT is not defined */</font>
00303       <font class="keywordflow">if</font> ((buf.st_mode &amp; S_IFMT) != S_IFDIR <font class="comment">/*@=unrecog@*/</font>) <font class="comment">/* not a directory */</font>
00304         {
00305           <font class="comment">/* as long as it is an executable file */</font>
00306 <font class="preprocessor"># if defined(__IBMC__) &amp;&amp; defined(OS2)</font>
00307 <font class="preprocessor"></font>      <font class="keywordtype">int</font> com_or_exe_pos = strlen( filespec) - 4;
00308       <font class="keywordflow">return</font> stricmp( &amp;filespec[com_or_exe_pos], <font class="stringliteral">".exe"</font>) == 0
00309         || stricmp( &amp;filespec[com_or_exe_pos], <font class="stringliteral">".com"</font>) == 0
00310         || stricmp( &amp;filespec[com_or_exe_pos], <font class="stringliteral">".bat"</font>) == 0
00311         || stricmp( &amp;filespec[com_or_exe_pos], <font class="stringliteral">".cmd"</font>) == 0;
00312 <font class="preprocessor"># else</font>
00313 <font class="preprocessor"></font>          <font class="keywordflow">return</font> (((buf.st_mode &amp; S_IXUSR)
00314 <font class="preprocessor"># if !defined(MSDOS) &amp;&amp; !defined(OS2) </font>
00315 <font class="preprocessor"></font>                   | (buf.st_mode &amp; S_IXGRP) |
00316                    (buf.st_mode &amp; S_IXOTH)
00317 <font class="preprocessor"># endif</font>
00318 <font class="preprocessor"></font>                   ) != 0);
00319 <font class="preprocessor"># endif</font>
00320 <font class="preprocessor"></font>        }
00321     }
00322 
00323 <font class="preprocessor"># endif</font>
00324 <font class="preprocessor"></font>  <font class="keywordflow">return</font> (FALSE);
00325 
00326 }
00327 
00328 <font class="comment">/*</font>
00329 <font class="comment">**++</font>
00330 <font class="comment">**  FUNCTIONAL DESCRIPTION:</font>
00331 <font class="comment">**</font>
00332 <font class="comment">**      Find the next directory from a directory path.</font>
00333 <font class="comment">**</font>
00334 <font class="comment">**  FORMAL PARAMETERS:</font>
00335 <font class="comment">**</font>
00336 <font class="comment">**      char ** current_dir :</font>
00337 <font class="comment">**          Points to the current position in the path string.  The first time</font>
00338 <font class="comment">**          you call this routine, this should point to the first character of</font>
00339 <font class="comment">**          the path.  On return, this will be updated to point to the</font>
00340 <font class="comment">**          terminating \0 or : of the first directory found.  You can then pass</font>
00341 <font class="comment">**          it unchanged for subsequent calls; this routine will correctly skip</font>
00342 <font class="comment">**          over the :.</font>
00343 <font class="comment">**</font>
00344 <font class="comment">**      char ** dir :</font>
00345 <font class="comment">**          On exit, this will point to the first character of the directory</font>
00346 <font class="comment">**          that was found.  This will be a pointer directly into the client's</font>
00347 <font class="comment">**          path string.</font>
00348 <font class="comment">**</font>
00349 <font class="comment">**      unsigned int * len :</font>
00350 <font class="comment">**          On exit, this will contain the length of the directory that was</font>
00351 <font class="comment">**          found, not counting any terminating \0 or :.  If no directory was</font>
00352 <font class="comment">**          found, this will be 0.</font>
00353 <font class="comment">**</font>
00354 <font class="comment">**  RETURN VALUE:</font>
00355 <font class="comment">**      TRUE if we found another directory.</font>
00356 <font class="comment">**      FALSE otherwise.</font>
00357 <font class="comment">**</font>
00358 <font class="comment">**  DESIGN:</font>
00359 <font class="comment">**</font>
00360 <font class="comment">**      We return a pointer and length, rather than a string, because of a)</font>
00361 <font class="comment">**      historical reasons; and b) this avoids having to allocate storage.</font>
00362 <font class="comment">**</font>
00363 <font class="comment">**</font>
00364 <font class="comment">**</font>
00365 <font class="comment">**--</font>
00366 <font class="comment">*/</font>
00367 
00368 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00369 nextdir (d_char *current_dir, d_char *dir, size_t *len)<font class="keyword"></font>
00370 <font class="keyword"></font>{
00371   <font class="keywordtype">char</font> *tchar;
00372 
00373   <font class="keywordflow">if</font> (**current_dir == <font class="charliteral">'\0'</font>)
00374     {
00375       *len = 0;
00376       <font class="keywordflow">return</font> FALSE;
00377     }
00378 
00379   *dir = (**current_dir == SEPCHAR ? *current_dir + 1 : *current_dir);
00380   
00381   <font class="comment">/* Find next ':' or end of string */</font>
00382   <font class="keywordflow">for</font> (tchar = *dir; *tchar != <font class="charliteral">'\0'</font> &amp;&amp; *tchar != SEPCHAR; tchar++)
00383     {
00384       ;
00385     }
00386   
00387   *current_dir = tchar;
00388   *len = <a class="code" href="general_c.html#a33">size_fromInt</a> (tchar - *dir);
00389   <font class="keywordflow">return</font> TRUE;
00390 }
00391 
<a name="l00392"></a><a class="code" href="osd_c.html#a11">00392</a> <font class="comment">/*@observer@*/</font> <font class="comment">/*@null@*/</font> <font class="keywordtype">char</font> *<a class="code" href="osd_c.html#a11">osd_getEnvironmentVariable</a> (<font class="keywordtype">char</font> *var)<font class="keyword"></font>
00393 <font class="keyword"></font>{
00394 <font class="preprocessor"># ifdef UNIX</font>
00395 <font class="preprocessor"></font>        <font class="keywordflow">return</font> getenv (var);
00396 <font class="preprocessor"># else</font>
00397 <font class="preprocessor"></font><font class="preprocessor"># if defined(OS2) || defined(MSDOS)</font>
00398 <font class="preprocessor"></font>        <font class="keywordflow">return</font> getenv (var);
00399 <font class="preprocessor"># else</font>
00400 <font class="preprocessor"></font><font class="preprocessor"># if defined(WIN32)</font>
00401 <font class="preprocessor"></font>        <font class="keywordflow">return</font> getenv (var);
00402 <font class="preprocessor"># else</font>
00403 <font class="preprocessor"></font>        <font class="keywordflow">return</font> NULL;
00404 <font class="preprocessor"># endif</font>
00405 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00406 <font class="preprocessor"></font><font class="preprocessor"># endif</font>
00407 <font class="preprocessor"></font>}
00408 
00409 <font class="preprocessor"># ifndef NOLCL</font>
00410 <font class="preprocessor"></font>
00411 <font class="preprocessor"># ifdef WIN32</font>
00412 <font class="preprocessor"></font><font class="keyword">extern</font> <font class="comment">/*@external@*/</font> <font class="keywordtype">int</font> _flushall (<font class="keywordtype">void</font>) <font class="comment">/*@modifies fileSystem@*/</font> ;
00413 <font class="preprocessor"># endif</font>
00414 <font class="preprocessor"></font>
00415 <font class="preprocessor"># ifndef system</font>
00416 <font class="preprocessor"></font><font class="keyword">extern</font> <font class="comment">/*@external@*/</font> <font class="keywordtype">int</font> <a class="code" href="osd_c.html#a12">system</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *) <font class="comment">/*@modifies fileSystem@*/</font> ;
00417 <font class="preprocessor"># endif</font>
<a name="l00418"></a><a class="code" href="osd_c.html#a13">00418</a> <font class="preprocessor"></font><font class="keywordtype">int</font> <a class="code" href="osd_c.html#a13">osd_system</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *cmd)<font class="keyword"></font>
00419 <font class="keyword"></font>{
00420   <font class="keywordtype">int</font> res;
00421     <font class="comment">/* system ("printenv"); */</font>
00422 <font class="preprocessor"># ifdef WIN32</font>
00423 <font class="preprocessor"></font>  (<font class="keywordtype">void</font>) _flushall (); 
00424 <font class="preprocessor"># endif</font>
00425 <font class="preprocessor"></font>
00426   res = <a class="code" href="osd_c.html#a12">system</a> (cmd);
00427   <font class="keywordflow">return</font> res;
00428 }
00429 <font class="preprocessor"># endif</font>
00430 <font class="preprocessor"></font>
00431 <font class="preprocessor"># ifndef unlink</font>
00432 <font class="preprocessor"></font><font class="comment">/*@-redecl@*/</font>
00433 <font class="keyword">extern</font> <font class="comment">/*@external@*/</font> <font class="keywordtype">int</font> <a class="code" href="osd_c.html#a14">unlink</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *) <font class="comment">/*@modifies fileSystem@*/</font> ;
00434 <font class="comment">/*@=redecl@*/</font>
00435 <font class="preprocessor"># endif</font>
00436 <font class="preprocessor"></font>
<a name="l00437"></a><a class="code" href="osd_c.html#a15">00437</a> <font class="keywordtype">int</font> <a class="code" href="osd_c.html#a15">osd_unlink</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *fname)<font class="keyword"></font>
00438 <font class="keyword"></font>{
00439   <font class="keywordtype">int</font> res;
00440 
00441   res = <a class="code" href="osd_c.html#a14">unlink</a> (fname);
00442 
00443   <font class="keywordflow">if</font> (res != 0)
00444     {
00445       llcontbug (message (<font class="stringliteral">"Cannot remove temporary file: %s (%s)"</font>,
00446                           cstring_fromChars (fname),
00447                           <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (strerror (errno))));
00448     }
00449   
00450   <font class="keywordflow">return</font> res;
00451 }
00452 
00453 <font class="preprocessor"># if defined (WIN32) || (defined(OS2) &amp;&amp; defined(__IBMC__))</font>
00454 <font class="preprocessor"></font><font class="preprocessor"># include &lt;process.h&gt;</font>
00455 <font class="preprocessor"># elif defined OS2</font>
00456 <font class="preprocessor"></font><font class="preprocessor"># include &lt;unistd.h&gt;</font>
00457 <font class="preprocessor"># endif</font>
00458 <font class="preprocessor"></font>
00459 <font class="preprocessor"># if defined (WIN32) || defined (OS2) &amp;&amp; defined (__IBMC__)</font>
00460 <font class="preprocessor"></font><font class="keywordtype">int</font>
00461 <font class="preprocessor"># else</font>
00462 <font class="preprocessor"></font><font class="keywordtype">int</font> <font class="comment">/* pid_t */</font>
00463 <font class="preprocessor"># endif</font>
<a name="l00464"></a><a class="code" href="osd_c.html#a16">00464</a> <font class="preprocessor"></font><a class="code" href="osd_c.html#a16">osd_getPid</a> ()<font class="keyword"></font>
00465 <font class="keyword"></font>{
00466 <font class="preprocessor"># if defined (WIN32) || defined (OS2) &amp;&amp; defined (__IBMC__)</font>
00467 <font class="preprocessor"></font>  <font class="keywordtype">int</font> pid = _getpid ();
00468 <font class="preprocessor"># else</font>
00469 <font class="preprocessor"></font>  pid_t pid = getpid ();
00470 <font class="preprocessor"># endif</font>
00471 <font class="preprocessor"></font>
00472   <font class="keywordflow">return</font> (<font class="keywordtype">int</font>) pid;
00473 }
00474   
<a name="l00475"></a><a class="code" href="osd_c.html#a17">00475</a> cstring <a class="code" href="osd_c.html#a17">osd_fixDefine</a> (<font class="keywordtype">char</font> *x)<font class="keyword"></font>
00476 <font class="keyword"></font>{
00477 <font class="preprocessor"># ifdef UNIX</font>
00478 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (strchr (x, <font class="charliteral">'\''</font>) != NULL) {
00479     <font class="comment">/*</font>
00480 <font class="comment">    ** If there is a single quote, check for &lt;ident&gt;='&lt;string&gt;' and </font>
00481 <font class="comment">    ** produce &lt;ident&gt;=&lt;string&gt;</font>
00482 <font class="comment">    */</font>
00483 
00484     <font class="keywordtype">char</font> *eqs = strchr (x, <font class="charliteral">'='</font>);
00485 
00486     <font class="keywordflow">if</font> (eqs != NULL) {
00487       <font class="keywordflow">if</font> (eqs[1] == <font class="charliteral">'\''</font>) {
00488         <font class="keywordtype">char</font> *endqu = strrchr (x, <font class="charliteral">'\''</font>);
00489 
00490         <font class="keywordflow">if</font> (endqu != NULL) {
00491           <font class="keywordflow">if</font> (*(endqu - 1) != <font class="charliteral">'\\'</font>) {
00492             <font class="keywordflow">if</font> (*(endqu + 1) == <font class="charliteral">'\0'</font>) {
00493               cstring res;
00494               cstring def;
00495 
00496               *endqu = <font class="charliteral">'\0'</font>;
00497               def = <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (eqs + 2);
00498               eqs[1] = <font class="charliteral">'\0'</font>;
00499               res = <a class="code" href="cstring_c.html#a42">cstring_concat</a> (cstring_fromChars (x), def);
00500                       <font class="keywordflow">return</font> res;
00501             }
00502           }
00503         }
00504       }
00505     }
00506   } 
00507 
00508 <font class="preprocessor"># endif</font>
00509 <font class="preprocessor"></font>
00510   <font class="keywordflow">return</font> cstring_fromCharsNew (x);
00511 }
00512 
<a name="l00513"></a><a class="code" href="osd_c.html#a18">00513</a> <font class="keywordtype">bool</font> <a class="code" href="osd_c.html#a18">osd_fileIsReadable</a> (<font class="keywordtype">char</font> *f)<font class="keyword"></font>
00514 <font class="keyword"></font>{
00515   FILE *fl = fopen (f, <font class="stringliteral">"r"</font>);
00516 
00517   <font class="keywordflow">if</font> (fl != (FILE *) 0)
00518     {
00519       check (fclose (fl) == 0);
00520       <font class="keywordflow">return</font> (TRUE);
00521     }
00522   <font class="keywordflow">else</font>
00523     {
00524       <font class="keywordflow">return</font> (FALSE);
00525     }
00526 }
00527 
<a name="l00528"></a><a class="code" href="osd_c.html#a19">00528</a> <font class="keywordtype">bool</font> <a class="code" href="osd_c.html#a19">osd_isConnectChar</a> (<font class="keywordtype">char</font> c)<font class="keyword"></font>
00529 <font class="keyword"></font>{
00530   <font class="keywordflow">if</font> (c == CONNECTCHAR) 
00531     {
00532       <font class="keywordflow">return</font> TRUE;
00533     }
00534 
00535 <font class="preprocessor"># ifdef HASALTCONNECTCHAR</font>
00536 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (c == ALTCONNECTCHAR)
00537     {
00538       <font class="keywordflow">return</font> TRUE;
00539     }
00540 <font class="preprocessor"># endif</font>
00541 <font class="preprocessor"></font>
00542   <font class="keywordflow">return</font> FALSE;
00543 }
00544 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:43 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
