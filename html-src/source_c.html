<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>source.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:58:06 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>source.c File Reference</h1><code>#include "lclintMacros.nf"</code><br>
<code>#include "llbasic.h"</code><br>
<code>#include "osd.h"</code><br>
<code>#include "portab.h"</code><br>

<p>
<a href="source_c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a0">tsource_close</a> (tsource *s)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a1">tsource_free</a> ( tsource *s)</td></tr>
<tr><td nowrap align=right valign=top>tsource*&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a2">tsource_create</a> (char *name, char *suffix, bool echo)</td></tr>
<tr><td nowrap align=right valign=top>tsource*&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a3">tsource_fromString</a> (char *name, char *str)</td></tr>
<tr><td nowrap align=right valign=top>char*&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a4">tsource_nextLine</a> (tsource *s)</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a5">tsource_open</a> (tsource *s)</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a6">tsource_getPath</a> (char *path, tsource *s)</td></tr>
<tr><td nowrap align=right valign=top>char*&nbsp;</td><td valign=bottom><a class="el" href="source_c.html#a7">specFullName</a> (char *specfile, char **inpath)</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a7" doxytag="source.c::specFullName"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
char * specFullName (
          </b></td>
          <td valign="bottom"><b>
char * <em>specfile</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
char ** <em>inpath</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00263">263</a> of file <a class="el" href="source_c-source.html">source.c</a>.<div class="fragment"><pre>00264 {
00265   <font class="comment">/* extract the path and the specname associated with the given file */</font>
00266   <font class="keywordtype">char</font> *specname = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*specname) 
00267                                      * (strlen (specfile) + 9));
00268   <font class="keywordtype">char</font> *ospecname = specname;
00269   <font class="keywordtype">char</font> *path = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*path) * (strlen (specfile)));
00270   size_t size;
00271   <font class="keywordtype">long</font> <font class="keywordtype">int</font> i, j;
00272   
00273   <font class="comment">/* initialized path to empty string or may have accidental garbage */</font>
00274   *path = <font class="charliteral">'\0'</font>;
00275 
00276   <font class="comment">/*@-mayaliasunique@*/</font> 
00277   strcpy (specname, specfile);
00278   <font class="comment">/*@=mayaliasunique@*/</font> 
00279 
00280   <font class="comment">/* trim off pathnames in specfile */</font>
00281   size = strlen (specname);
00282 
00283   <font class="keywordflow">for</font> (i = <a class="code" href="general_c.html#a34">size_toInt</a> (size) - 1; i &gt;= 0; i--)
00284     {
00285       <font class="keywordflow">if</font> (specname[i] == CONNECTCHAR)
00286         {
00287           <font class="comment">/* strcpy (specname, (char *)specname+i+1); */</font>
00288           <font class="keywordflow">for</font> (j = 0; j &lt;= i; j++)      <font class="comment">/* include '/'  */</font>
00289             {
00290               path[j] = specname[j];
00291             }
00292 
00293           path[i + 1] = <font class="charliteral">'\0'</font>;
00294           specname += i + 1;
00295           <font class="keywordflow">break</font>;
00296         }
00297     }
00298 
00299   <font class="comment">/* </font>
00300 <font class="comment">  ** also remove .lcl file extension, assume it's the last extension</font>
00301 <font class="comment">  ** of the file name </font>
00302 <font class="comment">  */</font>
00303 
00304   size = strlen (specname);
00305 
00306   <font class="keywordflow">for</font> (i = <a class="code" href="general_c.html#a34">size_toInt</a> (size) - 1; i &gt;= 0; i--)
00307     {
00308       <font class="keywordflow">if</font> (specname[i] == <font class="charliteral">'.'</font>)
00309         {
00310           specname[i] = <font class="charliteral">'\0'</font>;
00311           <font class="keywordflow">break</font>;
00312         }
00313     }
00314   
00315   *inpath = path;
00316 
00317   <font class="comment">/*</font>
00318 <font class="comment">  ** If specname no longer points to the original char,</font>
00319 <font class="comment">  ** we need to allocate a new pointer and copy the string.</font>
00320 <font class="comment">  */</font>
00321 
00322   <font class="keywordflow">if</font> (specname != ospecname) {
00323     <font class="keywordtype">char</font> *rspecname = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*rspecname) * (strlen (specname) + 1));
00324     strcpy (rspecname, specname); <font class="comment">/* evs 2000-05-16: Bug: was ospecname! */</font>
00325     <a class="code" href="general_c.html#a0">sfree</a> (ospecname);
00326     <font class="keywordflow">return</font> rspecname;
00327   } 
00328 
00329   <font class="keywordflow">return</font> specname;
00330 }
</div></pre>    </td>
  </tr>
</table>
<a name="a0" doxytag="source.c::tsource_close"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool tsource_close (
          </b></td>
          <td valign="bottom"><b>
tsource * <em>s</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00053">53</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>(), <a class="el" href="lslparse_c-source.html#l00113">parseOpLine</a>(), <a class="el" href="lslparse_c-source.html#l00055">parseSignatures</a>(), and <a class="el" href="imports_c-source.html#l00165">processImport</a>().<div class="fragment"><pre>00054 {
00055   <font class="keywordflow">if</font> (s-&gt;file != NULL)
00056     {
00057       check (fclose (s-&gt;file) == 0);
00058       s-&gt;file = NULL;
00059       <font class="keywordflow">return</font> TRUE;
00060     }
00061 
00062   <font class="keywordflow">return</font> FALSE;
00063 }
</div></pre>    </td>
  </tr>
</table>
<a name="a2" doxytag="source.c::tsource_create"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
tsource * tsource_create (
          </b></td>
          <td valign="bottom"><b>
char * <em>name</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
char * <em>suffix</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
bool <em>echo</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00077">77</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>(), <a class="el" href="lslparse_c-source.html#l00055">parseSignatures</a>(), and <a class="el" href="imports_c-source.html#l00165">processImport</a>().<div class="fragment"><pre>00078 {
00079   <font class="keywordtype">char</font> *ps;
00080   tsource *s = (tsource *) dmalloc (<font class="keyword">sizeof</font> (*s));
00081   
00082   s-&gt;name = (<font class="keywordtype">char</font> *) dmalloc (strlen (name) + strlen (suffix) + 1);
00083   s-&gt;file = 0;
00084   strcpy (s-&gt;name, name);
00085 
00086   ps = strrchr (s-&gt;name, CONNECTCHAR);
00087 
00088   <font class="keywordflow">if</font> (ps == (<font class="keywordtype">char</font> *) 0)
00089     {
00090       ps = s-&gt;name;
00091     }
00092 
00093   <font class="keywordflow">if</font> (strchr (ps, <font class="charliteral">'.'</font>) == NULL)
00094     {
00095       strcat (s-&gt;name, suffix);
00096     }
00097 
00098   
00099 
00100   s-&gt;lineNo = 0;
00101   s-&gt;echo = echo;
00102   s-&gt;fromString = FALSE;
00103   s-&gt;stringSource = NULL;
00104   s-&gt;stringSourceTail = NULL;
00105   
00106 
00107   <font class="keywordflow">return</font> s;
00108 }
</div></pre>    </td>
  </tr>
</table>
<a name="a1" doxytag="source.c::tsource_free"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void tsource_free (
          </b></td>
          <td valign="bottom"><b>
tsource * <em>s</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00066">66</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="lslparse_c-source.html#l00113">parseOpLine</a>(), <a class="el" href="lslparse_c-source.html#l00055">parseSignatures</a>(), and <a class="el" href="imports_c-source.html#l00165">processImport</a>().<div class="fragment"><pre>00067 {
00068   <font class="keywordflow">if</font> (s != NULL)
00069     {
00070       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;name);
00071       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;stringSource);
00072       <a class="code" href="general_c.html#a0">sfree</a> (s);
00073     }
00074 }
</div></pre>    </td>
  </tr>
</table>
<a name="a3" doxytag="source.c::tsource_fromString"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
tsource * tsource_fromString (
          </b></td>
          <td valign="bottom"><b>
char * <em>name</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
char * <em>str</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00111">111</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="lslparse_c-source.html#l00113">parseOpLine</a>().<div class="fragment"><pre>00112 {
00113   tsource *s = (tsource *) dmalloc (<font class="keyword">sizeof</font> (*s));
00114 
00115   s-&gt;name = <a class="code" href="general_c.html#a27">mstring_copy</a> (name);
00116   s-&gt;stringSource = <a class="code" href="general_c.html#a27">mstring_copy</a> (str);
00117   s-&gt;stringSourceTail = s-&gt;stringSource;
00118   s-&gt;file = 0;
00119   s-&gt;echo = FALSE;
00120   s-&gt;fromString = TRUE;
00121   s-&gt;lineNo = 0;
00122 
00123     <font class="keywordflow">return</font> s;
00124 }
</div></pre>    </td>
  </tr>
</table>
<a name="a6" doxytag="source.c::tsource_getPath"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool tsource_getPath (
          </b></td>
          <td valign="bottom"><b>
char * <em>path</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
tsource * <em>s</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00223">223</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="lslparse_c-source.html#l00055">parseSignatures</a>().<div class="fragment"><pre>00224 {
00225   <font class="keywordtype">char</font> *returnPath;
00226   filestatus status;            <font class="comment">/* return status of osd_getEnvPath.*/</font>
00227   <font class="keywordtype">bool</font> rVal;                    <font class="comment">/* return value of this procedure. */</font>
00228 
00229  <font class="comment">/* Check if requires met. */</font>
00230   <font class="keywordflow">if</font> (path == NULL || s == NULL || s-&gt;name == NULL)
00231     {
00232       llbugexitlit (<font class="stringliteral">"tsource_getPath: invalid parameter"</font>);
00233     }
00234 
00235   status = <a class="code" href="osd_c.html#a7">osd_getPath</a> (path, s-&gt;name, &amp;returnPath);
00236 
00237   <font class="keywordflow">if</font> (status == OSD_FILEFOUND)
00238     {                           <font class="comment">/* Should be majority of cases. */</font>
00239       rVal = TRUE;
00240       
00241       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;name);
00242       s-&gt;name = returnPath;
00243     }
00244   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (status == OSD_FILENOTFOUND)
00245     {
00246       rVal = FALSE;
00247     }
00248   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (status == OSD_PATHTOOLONG)
00249     {
00250       rVal = FALSE;
00251      <font class="comment">/* Directory and filename are too long.  Report error. */</font>
00252      llbuglit (<font class="stringliteral">"soure_getPath: Filename plus directory from search path too long"</font>);
00253  }
00254   <font class="keywordflow">else</font>
00255     {
00256       rVal = FALSE;
00257       llbuglit (<font class="stringliteral">"tsource_getPath: invalid return status"</font>);
00258     }
00259   <font class="keywordflow">return</font> rVal;
00260 }
</div></pre>    </td>
  </tr>
</table>
<a name="a4" doxytag="source.c::tsource_nextLine"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
char * tsource_nextLine (
          </b></td>
          <td valign="bottom"><b>
tsource * <em>s</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00127">127</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="lclscan_c-source.html#l00118">LCLScanNextToken</a>(), <a class="el" href="scan_c-source.html#l00070">LSLScanNextToken</a>(), <a class="el" href="imports_c-source.html#l00165">processImport</a>(), <a class="el" href="sort_c-source.html#l02867">sort_import</a>(), and <a class="el" href="symtable_c-source.html#l01375">symtable_import</a>().<div class="fragment"><pre>00128 {
00129   <font class="keywordtype">char</font> *currentLine;
00130   <font class="keywordtype">int</font> len;
00131 
00132   <font class="keywordflow">if</font> (s-&gt;fromString)
00133     {
00134       <font class="keywordflow">if</font> (s-&gt;stringSourceTail == NULL || (strlen (s-&gt;stringSourceTail) == 0))
00135         {
00136           currentLine = 0;
00137         }
00138       <font class="keywordflow">else</font>
00139         {
00140           <font class="keywordtype">char</font> *c = strchr (s-&gt;stringSourceTail, <font class="charliteral">'\n'</font>);
00141           
00142           
00143           <font class="comment">/* in case line is terminated not by newline */</font> 
00144           <font class="keywordflow">if</font> (c == 0)
00145             {
00146               c = strchr (s-&gt;stringSourceTail, <font class="charliteral">'\0'</font>);
00147             }
00148 
00149           len = c - s-&gt;stringSourceTail + 1;
00150 
00151           <font class="keywordflow">if</font> (len &gt; STUBMAXRECORDSIZE - 2)
00152             {
00153               len = (STUBMAXRECORDSIZE - 2);
00154             }
00155 
00156           currentLine = &amp;(s-&gt;buffer)[0];
00157           strncpy (currentLine, s-&gt;stringSourceTail, size_fromInt (len));
00158           currentLine[len] = <font class="charliteral">'\0'</font>;
00159           s-&gt;stringSourceTail += len;
00160         }
00161       
00162     }
00163   <font class="keywordflow">else</font>
00164     {
00165       llassert (s-&gt;file != NULL);
00166       currentLine = fgets (&amp;(s-&gt;buffer)[0], STUBMAXRECORDSIZE, s-&gt;file);
00167     }
00168   <font class="keywordflow">if</font> (currentLine == 0)
00169     {
00170       strcpy (s-&gt;buffer, "*** End of File ***");
00171     }
00172   <font class="keywordflow">else</font>
00173     {
00174       s-&gt;lineNo++;
00175       len = strlen (currentLine) - 1;
00176       <font class="keywordflow">if</font> (s-&gt;buffer[len] == <font class="charliteral">'\n'</font>)
00177         {
00178           s-&gt;buffer[len] = <font class="charliteral">'\0'</font>;
00179         }
00180       <font class="keywordflow">else</font> 
00181         {
00182           <font class="keywordflow">if</font> (len &gt;= STUBMAXRECORDSIZE - 2)
00183             {
00184               <a class="code" href="llerror_c.html#a22">lldiagmsg</a> (message (<font class="stringliteral">"Input line too long: %s"</font>,
00185                                   cstring_fromChars (currentLine)));
00186             }
00187         }
00188     }
00189   <font class="comment">/* if (s-&gt;echo) slo_echoLine (currentLine);           only needed in LCL */</font>
00190     <font class="keywordflow">return</font> currentLine;
00191 }
</div></pre>    </td>
  </tr>
</table>
<a name="a5" doxytag="source.c::tsource_open"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool tsource_open (
          </b></td>
          <td valign="bottom"><b>
tsource * <em>s</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="source_c-source.html#l00194">194</a> of file <a class="el" href="source_c-source.html">source.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>(), <a class="el" href="lslparse_c-source.html#l00055">parseSignatures</a>(), and <a class="el" href="imports_c-source.html#l00165">processImport</a>().<div class="fragment"><pre>00195 {
00196   <font class="keywordflow">if</font> (s-&gt;fromString)
00197     {
00198       <font class="comment">/* not an error: tail is dependent */</font>
00199       s-&gt;stringSourceTail = s-&gt;stringSource; 
00200       <font class="keywordflow">return</font> TRUE;
00201     }
00202 
00203   DPRINTF ((<font class="stringliteral">"Open: %s"</font>, s-&gt;name));
00204   s-&gt;file = fopen (s-&gt;name, "r");
00205   <font class="keywordflow">return</font> (s-&gt;file != 0 || s-&gt;fromString);
00206 }
</div></pre>    </td>
  </tr>
</table>
<hr><address><small>Generated at Fri Nov 3 18:58:06 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
