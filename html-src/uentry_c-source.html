<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>uentry.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:45 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>uentry.c</h1><a href="uentry_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** uentry.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 <font class="preprocessor"># include "structNames.h"</font>
00031 <font class="preprocessor"># include "nameChecks.h"</font>
00032 
00033 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> uentry posRedeclared = uentry_undefined;
00034 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> fileloc posLoc = fileloc_undefined;
00035 <font class="keyword">static</font> <font class="keywordtype">int</font> nuentries = 0;
00036 <font class="keyword">static</font> <font class="keywordtype">int</font> totuentries = 0;
00037 
00038 <font class="keyword">static</font> <font class="keywordtype">void</font> checkGlobalsModifies (<font class="comment">/*@notnull@*/</font> uentry p_ue, sRefSet p_sr) ;
00039 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setDeclDef (uentry p_e, fileloc p_f) <font class="comment">/*@modifies p_e@*/</font> ;
00040 <font class="keyword">static</font> <font class="keywordtype">bool</font> uentry_isRefCounted (uentry p_ue) <font class="comment">/*@*/</font> ;
00041 <font class="keyword">static</font> <font class="keywordtype">bool</font> uentry_isRefsField (uentry p_ue) <font class="comment">/*@*/</font> ;
00042 <font class="keyword">static</font> <font class="keywordtype">bool</font> uentry_isReallySpecified (uentry p_e) <font class="comment">/*@*/</font> ;
00043 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_checkIterArgs (uentry p_ue);
00044 <font class="keyword">static</font> cstring uentry_dumpAux (uentry p_v, <font class="keywordtype">bool</font> p_isParam);
00045 
00046 <font class="comment">/*@access ekind@*/</font>
00047 <font class="keyword">static</font> <font class="keywordtype">void</font> checkAliasState (<font class="comment">/*@notnull@*/</font> uentry p_old,
00048                                <font class="comment">/*@notnull@*/</font> uentry p_unew, 
00049                                <font class="keywordtype">bool</font> p_mustConform, <font class="keywordtype">bool</font> p_completeConform) 
00050    <font class="comment">/*@modifies p_old, p_unew@*/</font> ;
00051 <font class="keyword">static</font> <font class="keywordtype">void</font> checkNullState (<font class="comment">/*@notnull@*/</font> uentry p_old,
00052                             <font class="comment">/*@notnull@*/</font> uentry p_unew, 
00053                             <font class="keywordtype">bool</font> p_mustConform, <font class="keywordtype">bool</font> p_completeConform) 
00054    <font class="comment">/*@modifies p_old, p_unew@*/</font> ;
00055 
00056 <font class="keyword">static</font> <font class="keywordtype">void</font> checkVarConformance (<font class="comment">/*@notnull@*/</font> uentry p_old,
00057                                  <font class="comment">/*@notnull@*/</font> uentry p_unew, 
00058                                  <font class="keywordtype">bool</font> p_mustConform, <font class="keywordtype">bool</font> p_completeConform) 
00059    <font class="comment">/*@modifies p_old, p_unew@*/</font>;
00060 
00061 <font class="preprocessor"># ifndef NOLCL</font>
00062 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setHasMods (uentry p_ue) <font class="comment">/*@modifies p_ue@*/</font>;
00063 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setHasGlobs (uentry p_ue) <font class="comment">/*@modifies p_ue@*/</font>;
00064 <font class="preprocessor"># endif</font>
00065 <font class="preprocessor"></font>
00066 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_reallyFree (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> uentry p_e);
00067 
00068 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setSpecDef (<font class="comment">/*@special@*/</font> uentry p_e, <font class="comment">/*@keep@*/</font> fileloc p_f)
00069    <font class="comment">/*@defines p_e-&gt;whereSpecified, p_e-&gt;whereDeclared, p_e-&gt;whereDefined@*/</font>
00070    <font class="comment">/*@modifies p_e@*/</font>;
00071 
00072 <font class="keyword">static</font> <font class="keywordtype">void</font> returnValueError (<font class="comment">/*@notnull@*/</font> uentry p_old, <font class="comment">/*@notnull@*/</font> uentry p_unew);
00073 <font class="keyword">static</font> <font class="keywordtype">void</font> nargsError (<font class="comment">/*@notnull@*/</font> uentry p_old, <font class="comment">/*@notnull@*/</font> uentry p_unew);
00074 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring paramStorageName (uentry p_ue) <font class="comment">/*@*/</font> ;
00075 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring fcnErrName (uentry p_ue) <font class="comment">/*@*/</font> ;
00076 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring checkedName (chkind p_checked) <font class="comment">/*@*/</font> ;
00077 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00078   paramTypeError (<font class="comment">/*@notnull@*/</font> uentry p_old, <font class="comment">/*@notnull@*/</font> uentry p_oldCurrent,
00079                   ctype p_oldType, <font class="comment">/*@notnull@*/</font> uentry p_unew,
00080                   <font class="comment">/*@notnull@*/</font> uentry p_newCurrent, 
00081                   ctype p_newType, <font class="keywordtype">int</font> p_paramno) <font class="comment">/*@modifies g_msgstream@*/</font> ;
00082 
00083 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
00084   uentry_makeVariableAux (cstring p_n, ctype p_t, <font class="comment">/*@keep@*/</font> fileloc p_f,
00085                           <font class="comment">/*@exposed@*/</font> sRef p_s, <font class="keywordtype">bool</font> p_priv, vkind p_kind);
00086 
00087 <font class="keyword">static</font> <font class="comment">/*@out@*/</font> <font class="comment">/*@notnull@*/</font> uentry uentry_alloc (<font class="keywordtype">void</font>) <font class="comment">/*@*/</font> 
00088 {
00089   uentry ue = (uentry) dmalloc (<font class="keyword">sizeof</font> (*ue));
00090   nuentries++;
00091   totuentries++;
00092   
00093   <font class="keywordflow">return</font> ue;
00094 }
00095 
00096 <font class="keyword">static</font> cstring uentry_getOptName (uentry p_e) <font class="comment">/*@*/</font> ;
00097 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_copyInto (<font class="comment">/*@out@*/</font> <font class="comment">/*@unique@*/</font> uentry p_unew, uentry p_old);
00098 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setNullState (<font class="comment">/*@notnull@*/</font> uentry p_ue, nstate p_ns);
00099 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setAliasKind (<font class="comment">/*@notnull@*/</font> uentry p_ue, alkind p_ak);
00100 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> uinfo uinfo_copy (uinfo p_u, ekind p_kind);
00101 <font class="keyword">static</font> <font class="keywordtype">void</font> uinfo_free (<font class="comment">/*@only@*/</font> uinfo p_u, ekind p_kind);
00102 <font class="keyword">static</font> <font class="keywordtype">void</font> uvinfo_free (<font class="comment">/*@only@*/</font> uvinfo p_u);
00103 
00104 <font class="preprocessor"># ifdef DOANNOTS</font>
00105 <font class="preprocessor"></font>
00106 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring ancontext_unparse (ancontext an)<font class="keyword"></font>
00107 <font class="keyword"></font>{
00108   <font class="keywordflow">switch</font> (an)
00109     {
00110     <font class="keywordflow">case</font> AN_UNKNOWN: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"unknown"</font>);
00111     <font class="keywordflow">case</font> AN_FCNRETURN: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"return value"</font>);
00112     <font class="keywordflow">case</font> AN_FCNPARAM: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"function param"</font>);
00113     <font class="keywordflow">case</font> AN_SUFIELD: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"su field"</font>);
00114     <font class="keywordflow">case</font> AN_TDEFN: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"type definition"</font>);
00115     <font class="keywordflow">case</font> AN_GSVAR: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"global/static var"</font>);
00116     <font class="keywordflow">case</font> AN_CONST: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"constant"</font>);
00117     BADDEFAULT;
00118     }
00119   BADEXIT;
00120 }
00121 
00122 <font class="keyword">static</font> <font class="keywordtype">int</font> annots[AN_LAST][QU_LAST];
00123 <font class="keyword">static</font> <font class="keywordtype">int</font> decls[AN_LAST];
00124 <font class="keyword">static</font> <font class="keywordtype">int</font> shdecls[AN_LAST];
00125 <font class="keyword">static</font> <font class="keywordtype">int</font> idecls[AN_LAST];
00126 
00127 <font class="keywordtype">void</font> initAnnots ()<font class="keyword"></font>
00128 <font class="keyword"></font>{
00129   <font class="keywordtype">int</font> i, j;
00130 
00131   <font class="keywordflow">for</font> (i = AN_UNKNOWN; i &lt; AN_LAST; i++)
00132     {
00133       decls[i] = 0;
00134       shdecls[i] = 0;
00135       idecls[i] = 0;
00136 
00137       <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00138         {
00139           annots[i][j] = 0;
00140         }
00141     }
00142 }
00143 
00144 <font class="keyword">static</font> <font class="keywordtype">void</font> tallyAnnot (ancontext ac, qual q)<font class="keyword"></font>
00145 <font class="keyword"></font>{
00146   (annots[ac][q])++;
00147 }
00148 
00149 <font class="keywordtype">void</font> printAnnots ()<font class="keyword"></font>
00150 <font class="keyword"></font>{
00151   <font class="keywordtype">int</font> total[QU_LAST];
00152   <font class="keywordtype">int</font> alltotals = 0;
00153   <font class="keywordtype">int</font> totdecls = 0;
00154   <font class="keywordtype">int</font> totshdecls = 0;
00155   <font class="keywordtype">int</font> totidecls = 0;
00156   <font class="keywordtype">int</font> i, j;
00157 
00158   <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00159     {
00160       total[j] = 0;
00161     }
00162 
00163   <font class="keywordflow">for</font> (i = AN_UNKNOWN; i &lt; AN_LAST; i++)
00164     {
00165       <font class="keywordtype">int</font> tmptot;
00166 
00167       <font class="keywordflow">if</font> (decls[i] &gt; 0)
00168         {
00169           printf (<font class="stringliteral">"Context: %s (%d declarations, %d sharable, %d indirect)\n"</font>, 
00170                   ancontext_unparse (i),
00171                   decls[i], shdecls[i], idecls[i]);
00172           
00173           totdecls += decls[i];
00174           totshdecls += shdecls[i];
00175           totidecls += idecls[i];
00176           
00177           <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00178             {
00179               total[j] += annots[i][j];
00180               alltotals += annots[i][j];
00181             }
00182           
00183           printf (<font class="stringliteral">"   Allocation:\n"</font>);
00184           
00185           tmptot = 0;
00186           
00187           <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00188             {
00189               <font class="keywordflow">if</font> (qual_isAliasQual (j) &amp;&amp; !qual_isUnique (j))
00190                 {
00191                   <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00192                     {
00193                       printf (<font class="stringliteral">"\t%10s: %5d (%3.2f%%)\n"</font>, qual_unparse (j), annots[i][j],
00194                               100.0 * (<font class="keywordtype">double</font>)annots[i][j] / (<font class="keywordtype">double</font>)decls[i]);
00195                       tmptot += annots[i][j];
00196                     }
00197                 }
00198             }
00199 
00200           printf (<font class="stringliteral">"   Exposure:\n"</font>);
00201           
00202           tmptot = 0;
00203           
00204           <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00205             {
00206               <font class="keywordflow">if</font> (qual_isExQual (j))
00207                 {
00208                   <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00209                     {
00210                       printf (<font class="stringliteral">"\t%10s: %5d (%3.2f%%)\n"</font>, qual_unparse (j), annots[i][j],
00211                               100.0 * (<font class="keywordtype">double</font>)annots[i][j] / (<font class="keywordtype">double</font>)decls[i]);
00212                       tmptot += annots[i][j];
00213                     }
00214                 }
00215             }
00216           
00217           printf (<font class="stringliteral">"   Definition:\n"</font>);
00218           
00219           <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00220             {
00221               <font class="keywordflow">if</font> (qual_isAllocQual (j))
00222                 {
00223                   <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00224                     {
00225                       printf (<font class="stringliteral">"\t%10s: %5d (%3.2f%%)\n"</font>, qual_unparse (j), annots[i][j],
00226                               100.0 * (<font class="keywordtype">double</font>)annots[i][j] / (<font class="keywordtype">double</font>)decls[i]);
00227                     }
00228                 }
00229             }
00230           
00231           printf (<font class="stringliteral">"   Null:\n"</font>);
00232           
00233           <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00234             {
00235               <font class="keywordflow">if</font> (qual_isNull (j) || qual_isNotNull (j) || qual_isRelNull (j))
00236                 {
00237                   <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00238                     {
00239                       printf (<font class="stringliteral">"\t%10s: %5d (%3.2f%%)\n"</font>, qual_unparse (j), annots[i][j],
00240                               100.0 * (<font class="keywordtype">double</font>)annots[i][j] / (<font class="keywordtype">double</font>)decls[i]);
00241                     }
00242                 }
00243             }
00244 
00245           printf (<font class="stringliteral">"\n"</font>);
00246         }
00247     }
00248 
00249   <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00250     {
00251       <font class="keywordtype">bool</font> hasone = FALSE;
00252 
00253       <font class="keywordflow">for</font> (i = AN_UNKNOWN; i &lt; AN_LAST; i++)
00254         {
00255           <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00256             {
00257               hasone = TRUE;
00258               <font class="keywordflow">break</font>;
00259             }
00260         }
00261 
00262       <font class="keywordflow">if</font> (hasone)
00263         {
00264           printf (<font class="stringliteral">"Annotation: %s\n"</font>, qual_unparse (j));
00265           
00266           <font class="keywordflow">for</font> (i = AN_UNKNOWN; i &lt; AN_LAST; i++)
00267             {
00268               <font class="keywordflow">if</font> (annots[i][j] &gt; 0)
00269                 {
00270                   printf (<font class="stringliteral">"%25s: %5d\n"</font>, ancontext_unparse (i), annots[i][j]);
00271                 }
00272             }
00273           printf (<font class="stringliteral">"\n"</font>);
00274         }
00275     }
00276 
00277   printf (<font class="stringliteral">"All Contexts\n"</font>);
00278   
00279   <font class="keywordflow">for</font> (j = QU_UNKNOWN; j &lt; QU_LAST; j++)
00280     {
00281       <font class="keywordflow">if</font> (total[j] &gt; 0)
00282         {
00283           printf (<font class="stringliteral">"%10s: %5d (%3.2f%%)\n"</font>, qual_unparse (j), total[j],
00284                   100.0 * (<font class="keywordtype">double</font>)total[j] / (<font class="keywordtype">double</font>)(totdecls));
00285         }
00286     }
00287   printf (<font class="stringliteral">"\n"</font>);
00288 
00289   printf (<font class="stringliteral">"Total Annotations: %d (%d decls, %d sharable, %d indirect)\n"</font>, alltotals, totdecls, totshdecls, totidecls); }
00290 
00291 <font class="keyword">extern</font> <font class="keywordtype">void</font> uentry_tallyAnnots (uentry u, ancontext kind)<font class="keyword"></font>
00292 <font class="keyword"></font>{
00293   alkind ak = sRef_getAliasKind (u-&gt;sref);
00294   exkind ek = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (u-&gt;sref);
00295   nstate ns = sRef_getNullState (u-&gt;sref);
00296   sstate ss = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (u-&gt;sref);
00297   <font class="keywordtype">bool</font> recordUnknown = FALSE;
00298 
00299   
00300   <font class="keywordflow">if</font> (kind == AN_UNKNOWN)
00301     {
00302       ekind e = u-&gt;ukind;
00303 
00304       <font class="keywordflow">if</font> (e == KENDITER)
00305         {
00306           <font class="keywordflow">return</font>;
00307         }
00308       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e == KCONST || e == KENUMCONST)
00309         {
00310           kind = AN_CONST;
00311         }
00312       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e == KFCN || e == KITER)
00313         {
00314           uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (u);
00315           <font class="keywordtype">bool</font> hasRet = FALSE;
00316 
00317           uentryList_elements (params, current)<font class="keyword"></font>
00318 <font class="keyword">            </font>{
00319               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (current))
00320                 {
00321                   hasRet = TRUE;
00322                 }
00323               <font class="keywordflow">if</font> (!uentry_isElipsisMarker (current))
00324                 {
00325                   uentry_tallyAnnots (current, AN_FCNPARAM);
00326                 }
00327             } end_uentryList_elements;
00328           
00329           kind = AN_FCNRETURN;
00330           
00331           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (u-&gt;utype)
00332               &amp;&amp; !hasRet
00333               &amp;&amp; <a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ctype_realType (ctype_returnValue (u-&gt;utype))))
00334             {
00335               recordUnknown = TRUE;
00336             }
00337         }
00338       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e == KDATATYPE || e == KSTRUCTTAG || e == KUNIONTAG || e == KENUMTAG)
00339         {
00340           ctype t = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (u-&gt;utype);
00341 
00342           <font class="keywordflow">if</font> (ctype_isSU (t))
00343             {
00344               uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (t);
00345 
00346               uentryList_elements (fields, current)<font class="keyword"></font>
00347 <font class="keyword">                </font>{
00348                   uentry_tallyAnnots (current, AN_SUFIELD);
00349                 }
00350             } end_uentryList_elements;
00351           
00352           kind = AN_TDEFN;
00353 
00354           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (u-&gt;utype))
00355             {
00356               recordUnknown = TRUE;
00357             }
00358         }
00359       <font class="keywordflow">else</font> 
00360         {
00361           kind = AN_GSVAR;
00362           
00363           
00364           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ctype_realType (u-&gt;utype)))
00365             {
00366               recordUnknown = TRUE;
00367             }
00368         }
00369     }
00370 
00371   decls[kind]++;
00372 
00373   <font class="keywordflow">if</font> (kind == AN_FCNRETURN)
00374     {
00375       <font class="keywordflow">if</font> (recordUnknown) 
00376         {
00377           shdecls[kind]++;
00378           idecls[kind]++;
00379         }
00380       <font class="keywordflow">else</font> 
00381         {
00382           ;
00383         }
00384     }
00385   <font class="keywordflow">else</font>
00386     {
00387       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ctype_realType (u-&gt;utype)))
00388         {
00389           shdecls[kind]++;
00390                 }
00391       
00392       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (ctype_realType (u-&gt;utype)))
00393         {
00394           idecls[kind]++;
00395         }
00396     }
00397   
00398 
00399 
00400 
00401 
00402 
00403 
00404 
00405 
00406 
00407   <font class="keywordflow">switch</font> (ss)
00408     {
00409     <font class="keywordflow">case</font> SS_ALLOCATED: tallyAnnot (kind, QU_OUT); <font class="keywordflow">break</font>;
00410     <font class="keywordflow">case</font> SS_PARTIAL:   tallyAnnot (kind, QU_PARTIAL); <font class="keywordflow">break</font>;
00411     <font class="keywordflow">case</font> SS_RELDEF:    tallyAnnot (kind, QU_RELDEF); <font class="keywordflow">break</font>;
00412     <font class="keywordflow">case</font> SS_SPECIAL:   tallyAnnot (kind, QU_SPECIAL); <font class="keywordflow">break</font>;
00413     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00414     }
00415 
00416   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (u))
00417     {
00418       tallyAnnot (kind, QU_RETURNED); 
00419     }
00420 
00421   <font class="keywordflow">switch</font> (ak)
00422     {
00423     <font class="keywordflow">case</font> AK_UNKNOWN:    
00424       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a130">ctype_isRefCounted</a> (ctype_realType (u-&gt;utype))
00425           || (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (u-&gt;utype) &amp;&amp;
00426               <a class="code" href="ctype_c.html#a130">ctype_isRefCounted</a> (ctype_realType (ctype_returnValue (u-&gt;utype)))))
00427         {
00428           ;
00429         }
00430       <font class="keywordflow">else</font>
00431         {
00432           <font class="keywordflow">if</font> (kind == AN_FCNPARAM) 
00433             { 
00434               tallyAnnot (kind, QU_TEMP); 
00435             } 
00436           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (recordUnknown) 
00437             { 
00438               <font class="keywordflow">if</font> (kind == AN_FCNRETURN)
00439                 {
00440                                 }
00441               tallyAnnot (kind, QU_UNKNOWN); 
00442             }
00443         }
00444       <font class="keywordflow">break</font>;
00445     <font class="keywordflow">case</font> AK_ONLY:       tallyAnnot (kind, QU_ONLY); <font class="keywordflow">break</font>;
00446     <font class="keywordflow">case</font> AK_IMPONLY:    tallyAnnot (kind, QU_ONLY); <font class="keywordflow">break</font>;
00447     <font class="keywordflow">case</font> AK_KEEP:       tallyAnnot (kind, QU_KEEP); <font class="keywordflow">break</font>;
00448     <font class="keywordflow">case</font> AK_KEPT:       tallyAnnot (kind, QU_KEPT); <font class="keywordflow">break</font>;
00449     <font class="keywordflow">case</font> AK_IMPTEMP:
00450     <font class="keywordflow">case</font> AK_TEMP:       tallyAnnot (kind, QU_TEMP); <font class="keywordflow">break</font>;
00451     <font class="keywordflow">case</font> AK_SHARED:     tallyAnnot (kind, QU_SHARED); <font class="keywordflow">break</font>;
00452     <font class="keywordflow">case</font> AK_UNIQUE:     tallyAnnot (kind, QU_UNIQUE); <font class="keywordflow">break</font>;
00453     <font class="keywordflow">case</font> AK_RETURNED:   tallyAnnot (kind, QU_RETURNED); <font class="keywordflow">break</font>;
00454     <font class="keywordflow">case</font> AK_REFCOUNTED: tallyAnnot (kind, QU_UNKNOWN); <font class="keywordflow">break</font>;
00455     <font class="keywordflow">case</font> AK_REFS:       tallyAnnot (kind, QU_REFS); <font class="keywordflow">break</font>;
00456     <font class="keywordflow">case</font> AK_KILLREF:    tallyAnnot (kind, QU_KILLREF); <font class="keywordflow">break</font>;
00457     <font class="keywordflow">case</font> AK_NEWREF:     tallyAnnot (kind, QU_NEWREF); <font class="keywordflow">break</font>;
00458     <font class="keywordflow">case</font> AK_OWNED:      tallyAnnot (kind, QU_OWNED); <font class="keywordflow">break</font>;
00459     <font class="keywordflow">case</font> AK_IMPDEPENDENT:
00460     <font class="keywordflow">case</font> AK_DEPENDENT:  tallyAnnot (kind, QU_DEPENDENT); <font class="keywordflow">break</font>;
00461     <font class="keywordflow">case</font> AK_ERROR:    
00462     <font class="keywordflow">case</font> AK_FRESH:
00463     <font class="keywordflow">case</font> AK_STACK:
00464     <font class="keywordflow">case</font> AK_LOCAL:
00465       <font class="keywordflow">break</font>;
00466     }
00467 
00468   <font class="keywordflow">switch</font> (ek)
00469     {
00470     <font class="keywordflow">case</font> XO_EXPOSED:    tallyAnnot (kind, QU_EXPOSED); <font class="keywordflow">break</font>;
00471     <font class="keywordflow">case</font> XO_OBSERVER:   tallyAnnot (kind, QU_OBSERVER); <font class="keywordflow">break</font>;
00472     <font class="keywordflow">default</font>:  <font class="keywordflow">break</font>;
00473     }
00474 
00475   <font class="keywordflow">switch</font> (ns)
00476     {
00477     <font class="keywordflow">case</font> NS_ERROR:   <font class="keywordflow">break</font>;
00478     <font class="keywordflow">case</font> NS_UNKNOWN:   <font class="keywordflow">break</font>;
00479     <font class="keywordflow">case</font> NS_NOTNULL:   <font class="keywordflow">break</font>;
00480     <font class="keywordflow">case</font> NS_MNOTNULL:  tallyAnnot (kind, QU_NOTNULL); <font class="keywordflow">break</font>;
00481     <font class="keywordflow">case</font> NS_RELNULL:   tallyAnnot (kind, QU_RELNULL); <font class="keywordflow">break</font>;
00482     <font class="keywordflow">case</font> NS_CONSTNULL: tallyAnnot (kind, QU_NULL); <font class="keywordflow">break</font>;
00483     <font class="keywordflow">case</font> NS_POSNULL:   tallyAnnot (kind, QU_NULL); <font class="keywordflow">break</font>;
00484     <font class="keywordflow">case</font> NS_DEFNULL: 
00485     <font class="keywordflow">case</font> NS_ABSNULL:   <font class="keywordflow">break</font>;   
00486     }
00487 }
00488 
00489 <font class="preprocessor"># endif</font>
00490 <font class="preprocessor"></font>
00491 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring specCode_unparse (specCode s) <font class="comment">/*@*/</font>
00492 {
00493   <font class="keywordflow">switch</font> (s)
00494     {
00495     <font class="keywordflow">case</font> SPC_NONE: <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"normal"</font>);
00496     <font class="keywordflow">case</font> SPC_PRINTFLIKE: <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"printflike"</font>);
00497     <font class="keywordflow">case</font> SPC_SCANFLIKE: <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"scanflike"</font>);
00498     <font class="keywordflow">case</font> SPC_MESSAGELIKE: <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"messagelike"</font>);
00499     <font class="keywordflow">case</font> SPC_LAST: <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;error&gt;"</font>);
00500     }
00501 
00502   BADEXIT;
00503 }
00504 
00505 <font class="keyword">static</font> specCode specCode_fromInt (<font class="keywordtype">int</font> i)<font class="keyword"></font>
00506 <font class="keyword"></font>{
00507   <font class="comment">/*@+enumint@*/</font>
00508   llassert (i &gt;= SPC_NONE &amp;&amp; i &lt; SPC_LAST);
00509 
00510   <font class="keywordflow">return</font> ((specCode) i);
00511   <font class="comment">/*@=enumint@*/</font>
00512 }
00513 
<a name="l00514"></a><a class="code" href="uentry_c.html#a36">00514</a> <font class="comment">/*@observer@*/</font> cstring <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (uentry u)<font class="keyword"> </font>
00515 <font class="keyword"></font>{
00516   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (u))
00517     {
00518       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"previously declared"</font>);
00519     }
00520   <font class="keywordflow">else</font>
00521     {
00522       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"specified"</font>);
00523     }
00524 }
00525 
<a name="l00526"></a><a class="code" href="uentry_c.html#a37">00526</a> <font class="comment">/*@observer@*/</font> cstring <a class="code" href="uentry_c.html#a37">uentry_specDeclName</a> (uentry u)<font class="keyword"> </font>
00527 <font class="keyword"></font>{
00528   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (u))
00529     {
00530       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"previous declaration"</font>);
00531     }
00532   <font class="keywordflow">else</font>
00533     {
00534       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"specification"</font>);
00535     }
00536 }
00537 
00538 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring uentry_reDefDecl (uentry old, uentry unew)  <font class="comment">/*@*/</font> 
00539 {
00540   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (unew))
00541     {
00542       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"redefined"</font>);
00543     }
00544   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (unew))
00545     {
00546       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"defined"</font>);
00547     }
00548   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (unew))
00549     {
00550       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"redeclared"</font>);
00551     }
00552   <font class="keywordflow">else</font>
00553     {
00554       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"declared"</font>);
00555     }
00556 }
00557 
00558 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> fileloc setLocation (<font class="keywordtype">void</font>)<font class="keyword"></font>
00559 <font class="keyword"></font>{
00560   fileloc fl = <a class="code" href="context_c.html#a183">context_getSaveLocation</a> ();
00561 
00562   <font class="keywordflow">if</font> (fileloc_isDefined (fl)) 
00563     {
00564       <font class="keywordflow">return</font> fl;
00565     }
00566   <font class="keywordflow">else</font>
00567     {
00568       <font class="keywordflow">return</font> <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc);
00569     }
00570 }
00571 
<a name="l00572"></a><a class="code" href="uentry_c.html#a40">00572</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a40">uentry_makeEnumConstant</a> (cstring n, ctype t)<font class="keyword"></font>
00573 <font class="keyword"></font>{
00574   fileloc loc = setLocation ();
00575   uentry ue = <a class="code" href="uentry_c.html#a85">uentry_makeConstant</a> (n, t, loc);
00576 
00577   ue-&gt;ukind = KENUMCONST;
00578   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, loc);
00579   <font class="keywordflow">return</font> ue;
00580 }
00581 
<a name="l00582"></a><a class="code" href="uentry_c.html#a41">00582</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a41">uentry_makeEnumInitializedConstant</a> (cstring n, ctype t, exprNode expr)<font class="keyword"></font>
00583 <font class="keyword"></font>{
00584   fileloc loc = setLocation ();
00585   uentry ue = <a class="code" href="uentry_c.html#a85">uentry_makeConstant</a> (n, t, loc);
00586   ctype etype = exprNode_getType (expr);
00587 
00588   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (etype)) {
00589     voptgenerror 
00590       (FLG_ENUMMEMBERS,
00591        message
00592        (<font class="stringliteral">"Value of enum member is not an integeral type (type %s): %s"</font>,
00593         <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (etype), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (expr)),
00594        <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (expr));
00595   }
00596   
00597   ue-&gt;ukind = KENUMCONST;
00598   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, loc);
00599   <font class="keywordflow">return</font> ue;
00600 }
00601 
00602 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00603"></a><a class="code" href="uentry_c.html#a42">00603</a> <font class="preprocessor"></font><font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a42">uentry_makeSpecEnumConstant</a> (cstring n, ctype t, fileloc loc)<font class="keyword"></font>
00604 <font class="keyword"></font>{
00605   uentry ue = <a class="code" href="uentry_c.html#a85">uentry_makeConstant</a> (n, t, loc);
00606 
00607   ue-&gt;ukind = KENUMCONST;
00608   <font class="keywordflow">return</font> ue;
00609 }
00610 <font class="preprocessor"># endif</font>
00611 <font class="preprocessor"></font>
<a name="l00612"></a><a class="code" href="uentry_c.html#a43">00612</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (cstring n, ctype t)<font class="keyword"></font>
00613 <font class="keyword"></font>{
00614   <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (n, t, setLocation (), FALSE);
00615 }
00616 
00617 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00618"></a><a class="code" href="uentry_c.html#a44">00618</a> <font class="preprocessor"></font><font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> uentry <a class="code" href="uentry_c.html#a44">uentry_makeUnnamedVariable</a> (ctype t)<font class="keyword"></font>
00619 <font class="keyword"></font>{
00620   <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (cstring_undefined, t, setLocation (), FALSE);
00621 }
00622 <font class="preprocessor"># endif</font>
00623 <font class="preprocessor"></font>
<a name="l00624"></a><a class="code" href="uentry_c.html#a45">00624</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a45">uentry_makeIdDatatype</a> (idDecl id)<font class="keyword"></font>
00625 <font class="keyword"></font>{
00626   ctype ct = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (id);
00627   uentry ue = <a class="code" href="uentry_c.html#a112">uentry_makeDatatype</a> (idDecl_observeId (id), ct, 
00628                                    MAYBE, MAYBE, setLocation ());
00629 
00630   <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (ue, idDecl_getQuals (id));
00631   
00632   <font class="keywordflow">if</font> (!ynm_isOn (ue-&gt;info-&gt;datatype-&gt;abs))
00633     {
00634       <font class="keywordflow">if</font> (ctype_isUnknown (ct))
00635         {
00636           ue-&gt;info-&gt;datatype-&gt;mut = MAYBE;
00637         }
00638       <font class="keywordflow">else</font>
00639         {
00640           ue-&gt;info-&gt;datatype-&gt;mut = ynm_fromBool (ctype_isMutable (ct));
00641         }
00642     }
00643   
00644   <font class="keywordflow">return</font> ue;
00645 }
00646 
<a name="l00647"></a><a class="code" href="uentry_c.html#a46">00647</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a46">uentry_checkParams</a> (uentry ue)<font class="keyword"></font>
00648 <font class="keyword"></font>{
00649   <font class="keywordflow">if</font> (uentry_isValid (ue))
00650     {
00651       <font class="keywordtype">bool</font> isExt = uentry_isExtern (ue);
00652 
00653       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a186">uentry_isRealFunction</a> (ue))
00654         {
00655           uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (ue);
00656 
00657           uentryList_elements (params, current)<font class="keyword"></font>
00658 <font class="keyword">            </font>{
00659               <font class="keywordflow">if</font> (uentry_isValid (current))
00660                 {
00661                   ctype ct = current-&gt;utype;                  
00662                   
00663                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a103">ctype_isFixedArray</a> (ct))
00664                     {
00665                       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ctype_baseArrayPtr (ct))
00666                           &amp;&amp; !<a class="code" href="ctype_c.html#a103">ctype_isFixedArray</a> (ctype_baseArrayPtr (ct)))
00667                         {
00668                           ;
00669                         }
00670                       <font class="keywordflow">else</font>
00671                         {
00672                           voptgenerror 
00673                             (FLG_FIXEDFORMALARRAY,
00674                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function parameter %q declared as "</font>
00675                                       <font class="stringliteral">"manifest array (size constant is meaningless)"</font>,
00676                                       uentry_getName (current)),
00677                              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (current));
00678                         }
00679                     }
00680                   <font class="keywordflow">else</font> 
00681                     {
00682                       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ct))
00683                         {
00684                           voptgenerror 
00685                             (FLG_FORMALARRAY,
00686                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function parameter %q declared as "</font>
00687                                       <font class="stringliteral">"array (treated as pointer)"</font>, 
00688                                       uentry_getName (current)),
00689                              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (current));
00690                         }
00691                     }
00692 
00693                   <font class="keywordflow">if</font> (sRef_getNullState (uentry_getSref (current)) == NS_MNOTNULL)
00694                     {
00695                       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct) &amp;&amp; 
00696                           (isExt || (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ctype_realType (ct))
00697                                      &amp;&amp; !<a class="code" href="context_c.html#a113">context_hasFileAccess</a> (ctype_typeId (ct)))))
00698                         {
00699                           vgenhinterror 
00700                             (FLG_INCONDEFS,
00701                              message 
00702                              (<font class="stringliteral">"Function %q declared with notnull parameter %q of abstract "</font>
00703                               <font class="stringliteral">"type %s"</font>,
00704                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
00705                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (current),
00706                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
00707                              message 
00708                              (<font class="stringliteral">"Since %s is an abstract type, notnull can only be "</font>
00709                               <font class="stringliteral">"used for parameters if the function is static to a "</font>
00710                               <font class="stringliteral">"module where %s is accessible."</font>,
00711                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
00712                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
00713                              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (current));
00714                         }
00715                     }
00716                 }
00717             } end_uentryList_elements;
00718           
00719           <font class="keywordflow">if</font> (sRef_getNullState (uentry_getSref (ue)) == NS_MNOTNULL)
00720             {
00721               ctype ct = ue-&gt;utype;
00722                   
00723               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct) 
00724                   &amp;&amp; (isExt || (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ctype_realType (ct))
00725                                 &amp;&amp; !<a class="code" href="context_c.html#a113">context_hasFileAccess</a> (ctype_typeId (ct)))))
00726                 {
00727                   vgenhinterror 
00728                     (FLG_INCONDEFS,
00729                      message 
00730                      (<font class="stringliteral">"%s %q declared %s notnull storage of abstract type %s"</font>,
00731                       <a class="code" href="ekind_c.html#a3">ekind_capName</a> (uentry_getKind (ue)),
00732                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
00733                       fcnErrName (ue),
00734                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
00735                      message 
00736                      (<font class="stringliteral">"Since %s is an abstract type, notnull can only be used "</font>
00737                       <font class="stringliteral">"if it is static to a module where %s is accessible."</font>,
00738                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
00739                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
00740                      <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
00741                 }
00742             }
00743         }
00744     }
00745 }
00746 
00747 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectImplicitFunctionQualifiers (<font class="comment">/*@notnull@*/</font> uentry ue, <font class="keywordtype">bool</font> spec)<font class="keyword"></font>
00748 <font class="keyword"></font>{
00749   alkind ak = sRef_getAliasKind (ue-&gt;sref);
00750 
00751   <font class="keywordflow">if</font> (alkind_isRefCounted (ak))
00752     {
00753       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, AK_NEWREF, fileloc_undefined);
00754     }
00755   <font class="keywordflow">else</font> 
00756     {
00757       <font class="keywordflow">if</font> (alkind_isUnknown (ak))
00758         {
00759           exkind ek = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (ue-&gt;sref);
00760           
00761           <font class="keywordflow">if</font> (exkind_isKnown (ek))
00762             {
00763               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, AK_IMPDEPENDENT, fileloc_undefined);
00764             }
00765           <font class="keywordflow">else</font> 
00766             {
00767               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (spec ? FLG_SPECRETIMPONLY : FLG_RETIMPONLY))
00768                 {
00769                   <font class="keywordflow">if</font> (ctype_isVisiblySharable 
00770                       (<a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_returnValue (ue-&gt;utype))))
00771                     {
00772                       <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a31">uentryList_hasReturned</a> (uentry_getParams (ue)))
00773                         {
00774                           ;
00775                         }
00776                       <font class="keywordflow">else</font>
00777                         {
00778                           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, AK_IMPONLY, 
00779                                              fileloc_undefined);
00780                                                 }
00781                     }
00782                 }
00783             }
00784         }
00785     }
00786 }
00787 
00788 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> uentry 
00789 uentry_makeFunctionAux (cstring n, ctype t, 
00790                         typeIdSet access,
00791                         <font class="comment">/*@only@*/</font> globSet globs, 
00792                         <font class="comment">/*@only@*/</font> sRefSet mods, 
00793                         <font class="comment">/*@keep@*/</font> fileloc f, <font class="keywordtype">bool</font> priv,
00794                         <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> isForward)<font class="keyword"></font>
00795 <font class="keyword"></font>{
00796   uentry e = uentry_alloc ();
00797   ctype ret;
00798 
00799   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (t))
00800     {
00801       ret = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (t);
00802     }
00803   <font class="keywordflow">else</font>
00804     {
00805       <font class="keywordflow">if</font> (ctype_isKnown (t))
00806         {
00807           llbug (message (<font class="stringliteral">"not function: %s"</font>, ctype_unparse (t)));
00808         }
00809       ret = ctype_unknown;
00810     }
00811 
00812   e-&gt;ukind = KFCN;
00813 
00814   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (f) || fileloc_isImport (f))
00815     {
00816       e-&gt;whereSpecified = f;
00817       e-&gt;whereDeclared = fileloc_undefined;
00818     }
00819   <font class="keywordflow">else</font>
00820     {
00821       e-&gt;whereSpecified = fileloc_undefined;
00822       e-&gt;whereDeclared = f;
00823     }
00824 
00825   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
00826   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
00827   e-&gt;utype = t;
00828   e-&gt;storageclass = SCNONE;
00829 
00830     e-&gt;sref = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ret);
00831 
00832   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ret))
00833     {
00834       <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (e-&gt;sref, ret);
00835     }
00836   
00837   e-&gt;used = FALSE;
00838   e-&gt;lset = FALSE;
00839   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
00840   e-&gt;isPrivate = priv;
00841   e-&gt;hasNameError = FALSE;
00842 
00843   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
00844   e-&gt;info-&gt;fcn = (ufinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;fcn));
00845 
00846   e-&gt;info-&gt;fcn-&gt;hasMods = sRefSet_isDefined (mods);
00847   e-&gt;info-&gt;fcn-&gt;hasGlobs = globSet_isDefined (globs);
00848 
00849   e-&gt;info-&gt;fcn-&gt;exitCode = XK_UNKNOWN;
00850   e-&gt;info-&gt;fcn-&gt;nullPred = QU_UNKNOWN;
00851   e-&gt;info-&gt;fcn-&gt;specialCode = SPC_NONE;
00852 
00853   e-&gt;info-&gt;fcn-&gt;access = access;
00854   e-&gt;info-&gt;fcn-&gt;globs = globs;
00855   e-&gt;info-&gt;fcn-&gt;defparams = uentryList_undefined;
00856 
00857   <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (e-&gt;sref, f);
00858   e-&gt;whereDefined = fileloc_undefined;
00859   
00860   e-&gt;info-&gt;fcn-&gt;mods = sRefSet_undefined;
00861   e-&gt;info-&gt;fcn-&gt;specclauses = NULL;
00862   checkGlobalsModifies (e, mods);
00863   e-&gt;info-&gt;fcn-&gt;mods = mods;
00864 
00865   <font class="keywordflow">return</font> (e);
00866 }
00867 
<a name="l00868"></a><a class="code" href="uentry_c.html#a49">00868</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (idDecl id)<font class="keyword"></font>
00869 <font class="keyword"></font>{
00870   uentry ue = 
00871     <a class="code" href="uentry_c.html#a103">uentry_makeFunction</a> (idDecl_observeId (id), <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (id), 
00872                          typeId_invalid, globSet_undefined, 
00873                          sRefSet_undefined, 
00874                          setLocation ());
00875   
00876   <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (ue, idDecl_getQuals (id));
00877   reflectImplicitFunctionQualifiers (ue, FALSE);
00878 
00879   <font class="keywordflow">if</font> (!uentry_isStatic (ue)
00880       &amp;&amp; cstring_equalLit (ue-&gt;uname, "main"))
00881     {
00882       ctype typ = ue-&gt;utype;
00883       ctype retval;
00884       uentryList args;
00885 
00886       llassert (ctype_isFunction (typ));
00887 
00888       retval = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (typ);
00889 
00890       <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (retval))
00891         {
00892           voptgenerror 
00893             (FLG_MAINTYPE,
00894              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function main declared to return %s, should return int"</font>,
00895                       ctype_unparse (retval)),
00896              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
00897         }
00898 
00899       args = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (typ);
00900 
00901       <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (args) 
00902           || <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (args) == 0)
00903         {
00904           ;
00905         }
00906       <font class="keywordflow">else</font>
00907         {
00908           <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (args) != 2)
00909             {
00910               voptgenerror 
00911                 (FLG_MAINTYPE,
00912                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function main declared with %d arg%p, "</font>
00913                           <font class="stringliteral">"should have 2 (int argc, char *argv[])"</font>,
00914                           uentryList_size (args)),
00915                  <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
00916             }
00917           <font class="keywordflow">else</font>
00918             {
00919               uentry arg = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (args, 0);
00920               ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (arg);
00921 
00922               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (ct))
00923                 {
00924                   voptgenerror 
00925                     (FLG_MAINTYPE,
00926                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter 1, %q, of function main declared "</font>
00927                               <font class="stringliteral">"with type %t, should have type int"</font>,
00928                               uentry_getName (arg), ct),
00929                      <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (arg));
00930                 }
00931 
00932               arg = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (args, 1);
00933               ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (arg);
00934 
00935               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (ct)
00936                   &amp;&amp; <a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (ctype_baseArrayPtr (ct))
00937                   &amp;&amp; <a class="code" href="ctype_c.html#a58">ctype_isChar</a> (ctype_baseArrayPtr (ctype_baseArrayPtr (ct))))
00938                 {
00939                   ;
00940                 }
00941               <font class="keywordflow">else</font>
00942                 {
00943                   voptgenerror 
00944                     (FLG_MAINTYPE,
00945                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter 2, %q, of function main declared "</font>
00946                               <font class="stringliteral">"with type %t, should have type char **"</font>,
00947                               uentry_getName (arg), ct),
00948                      <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (arg));
00949                 }
00950             }
00951         }
00952     }
00953 
00954   <font class="keywordflow">return</font> ue;
00955 }
00956 
00957 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_implicitParamAnnots (<font class="comment">/*@notnull@*/</font> uentry e)<font class="keyword"></font>
00958 <font class="keyword"></font>{
00959   alkind ak = sRef_getAliasKind (e-&gt;sref);
00960 
00961   <font class="keywordflow">if</font> ((alkind_isUnknown (ak) || alkind_isImplicit (ak))
00962       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_PARAMIMPTEMP))
00963     {
00964       exkind ek = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (e-&gt;sref);
00965       
00966       <font class="keywordflow">if</font> (exkind_isKnown (ek))
00967         {
00968           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_IMPDEPENDENT, fileloc_undefined);
00969           <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (e-&gt;sref, AK_IMPDEPENDENT);
00970         }
00971       <font class="keywordflow">else</font>
00972         {
00973           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_IMPTEMP, fileloc_undefined);
00974           <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (e-&gt;sref, AK_IMPTEMP);
00975         }
00976     }
00977 }
00978 
00979 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
00980 uentry_makeVariableParamAux (cstring n, ctype t, sRef s, sstate defstate)<font class="keyword"></font>
00981 <font class="keyword"></font>{
00982   cstring pname = <a class="code" href="structNames_c.html#a6">makeParam</a> (n);
00983   uentry e = uentry_makeVariableAux (pname, t, setLocation (), s, FALSE, VKPARAM);
00984 
00985   <a class="code" href="cstring_c.html#a27">cstring_free</a> (pname);
00986   uentry_implicitParamAnnots (e);
00987 
00988   <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (e-&gt;sref) &amp;&amp; !sRef_isPartial (e-&gt;sref))
00989     {
00990       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (e-&gt;sref, defstate, uentry_whereDeclared (e));
00991       e-&gt;info-&gt;var-&gt;defstate = defstate;
00992     }
00993 
00994   <font class="keywordflow">return</font> (e);
00995 }
00996 
00997 <font class="preprocessor"># ifndef NOLCL</font>
00998 <font class="preprocessor"></font><font class="keywordtype">void</font>
<a name="l00999"></a><a class="code" href="uentry_c.html#a52">00999</a> <a class="code" href="uentry_c.html#a52">uentry_setRefCounted</a> (uentry e)<font class="keyword"></font>
01000 <font class="keyword"></font>{
01001   <font class="keywordflow">if</font> (uentry_isValid (e))
01002     {
01003       uentry_setAliasKind (e, AK_REFCOUNTED);
01004       <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
01005     }
01006 }
01007 <font class="preprocessor"># endif</font>
01008 <font class="preprocessor"></font>
01009 <font class="keywordtype">void</font>
<a name="l01010"></a><a class="code" href="uentry_c.html#a53">01010</a> <a class="code" href="uentry_c.html#a53">uentry_setStatic</a> (uentry c)<font class="keyword"></font>
01011 <font class="keyword"></font>{
01012   <font class="keywordflow">if</font> (uentry_isValid (c)) 
01013     {
01014       alkind ak = sRef_getAliasKind (c-&gt;sref);
01015       c-&gt;storageclass = SCSTATIC;
01016 
01017       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (c) &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (c)))
01018         {
01019           <font class="keywordflow">if</font> (!alkind_isUnknown (ak)
01020               &amp;&amp; !alkind_isStatic (ak))
01021             {
01022               <font class="keywordflow">if</font>  (!(<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (uentry_getType (c)))
01023                    &amp;&amp; !(<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ctype_realType (uentry_getType (c))))
01024                    &amp;&amp; !alkind_isRefCounted (ak))
01025                 {
01026                   <font class="keywordflow">if</font> (alkind_isImplicit (ak)
01027                       &amp;&amp; alkind_isDependent (ak)
01028                       &amp;&amp; <a class="code" href="ctype_c.html#a101">ctype_isArray</a> (uentry_getType (c)))
01029                     {
01030                       ; <font class="comment">/* no error for observer arrays */</font>
01031                     }
01032                   <font class="keywordflow">else</font>
01033                     {
01034                       voptgenerror 
01035                         (FLG_INCONDEFS,
01036                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Static storage %q declared as %s"</font>,
01037                                   uentry_getName (c),
01038                                   <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (ak)),
01039                          <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (c));
01040                     }
01041                 }
01042             }
01043           <font class="keywordflow">else</font>
01044             {
01045               <font class="keywordflow">if</font> (alkind_isUnknown (ak)
01046                   || (alkind_isImplicit (sRef_getAliasKind (c-&gt;sref))
01047                       &amp;&amp; !alkind_isDependent (sRef_getAliasKind (c-&gt;sref))))
01048                 {
01049                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (c-&gt;sref, AK_STATIC, fileloc_undefined);
01050                   <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (c-&gt;sref, AK_STATIC);
01051                 }
01052             }
01053         }
01054     }
01055 }
01056 
01057 <font class="keywordtype">void</font>
<a name="l01058"></a><a class="code" href="uentry_c.html#a54">01058</a> <a class="code" href="uentry_c.html#a54">uentry_setExtern</a> (uentry c)<font class="keyword"></font>
01059 <font class="keyword"></font>{
01060   <font class="keywordflow">if</font> (uentry_isValid (c)) 
01061     c-&gt;storageclass = SCEXTERN;
01062 }
01063 
01064 <font class="keywordtype">void</font>
<a name="l01065"></a><a class="code" href="uentry_c.html#a55">01065</a> <a class="code" href="uentry_c.html#a55">uentry_setParamNo</a> (uentry ue, <font class="keywordtype">int</font> pno)<font class="keyword"></font>
01066 <font class="keyword"></font>{
01067   llassert (uentry_isAnyParam (ue) &amp;&amp; <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (ue-&gt;sref));
01068   <a class="code" href="sRef_c.html#a132">sRef_setParamNo</a> (ue-&gt;sref, pno);
01069 }
01070 
01071 <font class="keyword">static</font>
01072 <font class="keywordtype">void</font> checkGlobalsModifies (<font class="comment">/*@notnull@*/</font> uentry ue, sRefSet sr)<font class="keyword"></font>
01073 <font class="keyword"></font>{
01074   sRefSet_allElements (sr, el)<font class="keyword"></font>
01075 <font class="keyword">    </font>{
01076       sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
01077       
01078       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (base) || <a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (base)
01079           || (sRef_isKindSpecial (base) &amp;&amp; !<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (base)))
01080         {
01081           <font class="keywordflow">if</font> (!<a class="code" href="globSet_c.html#a5">globSet_member</a> (ue-&gt;info-&gt;fcn-&gt;globs, base))
01082             {
01083               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a142">uentry_hasGlobs</a> (ue)
01084                   || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_WARNMISSINGGLOBALSNOGLOBS))
01085                 {
01086                   <font class="keywordflow">if</font> (optgenerror 
01087                       (FLG_WARNMISSINGGLOBALS,
01088                        message
01089                        (<font class="stringliteral">"Modifies list for %q uses global %q, "</font>
01090                         <font class="stringliteral">"not included in globals list."</font>,
01091                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
01092                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base)),
01093                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
01094                     {
01095                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (ue);
01096                     } 
01097                 }
01098               
01099               ue-&gt;info-&gt;fcn-&gt;globs = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (ue-&gt;info-&gt;fcn-&gt;globs, 
01100                                                      base);
01101               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (base))
01102                 {
01103                   <a class="code" href="context_c.html#a147">context_recordFileGlobals</a> (ue-&gt;info-&gt;fcn-&gt;globs);
01104                 }
01105             }
01106         }
01107     } end_sRefSet_allElements;
01108 }
01109 
01110 uentry
<a name="l01111"></a><a class="code" href="uentry_c.html#a56">01111</a> <a class="code" href="uentry_c.html#a56">uentry_makeVariableSrefParam</a> (cstring n, ctype t, sRef s)<font class="keyword"></font>
01112 <font class="keyword"></font>{
01113   <font class="keywordflow">return</font> (uentry_makeVariableParamAux (n, t, s, SS_UNKNOWN));
01114 }
01115 
01116 <font class="keywordtype">void</font>
<a name="l01117"></a><a class="code" href="uentry_c.html#a57">01117</a> <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (uentry ue)<font class="keyword"></font>
01118 <font class="keyword"></font>{
01119   sRef sr;
01120   
01121   <font class="keywordflow">if</font> (uentry_isUndefined (ue) || uentry_isElipsisMarker (ue)) 
01122     {
01123       <font class="keywordflow">return</font>;
01124     }
01125   
01126   sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
01127 
01128   <a class="code" href="sRef_c.html#a292">sRef_resetState</a> (sr);
01129   <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (sr);
01130   
01131   llassertprint (uentry_isVariable (ue), (<font class="stringliteral">"fixing: %s"</font>, <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (ue)));
01132   llassert (sRef_isValid (sr)); 
01133   
01134   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
01135     {
01136       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sr, ue-&gt;info-&gt;var-&gt;defstate, fileloc_undefined);
01137       <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sr, ue-&gt;info-&gt;var-&gt;nullstate, fileloc_undefined);
01138     }
01139 }
01140 
<a name="l01141"></a><a class="code" href="uentry_c.html#a58">01141</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a58">uentry_setSpecialClauses</a> (uentry ue, specialClauses clauses)<font class="keyword"></font>
01142 <font class="keyword"></font>{
01143   llassert (uentry_isFunction (ue));
01144   llassert (!specialClauses_isDefined (ue-&gt;info-&gt;fcn-&gt;specclauses));
01145 
01146   ue-&gt;info-&gt;fcn-&gt;specclauses = clauses;
01147   <a class="code" href="specialClauses_c.html#a36">specialClauses_checkAll</a> (ue);
01148 }
01149 
01150 <font class="comment">/*</font>
01151 <font class="comment">** Used for @modifies@ @endmodifies@ syntax.</font>
01152 <font class="comment">**</font>
01153 <font class="comment">** If ue is specified, sr must contain *only*:</font>
01154 <font class="comment">**</font>
01155 <font class="comment">**      o file static globals</font>
01156 <font class="comment">**      o sRef's derived from modifies spec (i.e., more specific than</font>
01157 <font class="comment">**        what was specified)</font>
01158 <font class="comment">**</font>
01159 <font class="comment">** Otherwise, if sr has modifies it must match sr.</font>
01160 <font class="comment">**</font>
01161 <font class="comment">** If it doesn't have modifies, set them to sr.</font>
01162 <font class="comment">*/</font>
01163 
01164 <font class="keywordtype">void</font>
<a name="l01165"></a><a class="code" href="uentry_c.html#a59">01165</a> <a class="code" href="uentry_c.html#a59">uentry_setModifies</a> (uentry ue, <font class="comment">/*@owned@*/</font> sRefSet sr)<font class="keyword"></font>
01166 <font class="keyword"></font>{
01167   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01168     {
01169       llparseerror
01170         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies list not in function context.  "</font>
01171                   <font class="stringliteral">"A modifies list can only appear following the parameter list "</font>
01172                   <font class="stringliteral">"in a function declaration or header."</font>));
01173 
01174       <font class="comment">/*@-mustfree@*/</font> <font class="keywordflow">return</font>; <font class="comment">/*@=mustfree@*/</font> 
01175     }
01176 
01177   <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a28">sRefSet_hasStatic</a> (sr))
01178     {
01179       <a class="code" href="context_c.html#a146">context_recordFileModifies</a> (sr);
01180     }
01181 
01182   <font class="keywordflow">if</font> (uentry_isValid (ue))
01183     {
01184       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ue))
01185         {
01186           llassert (sRefSet_isUndefined (ue-&gt;info-&gt;iter-&gt;mods));
01187           ue-&gt;info-&gt;iter-&gt;mods = sr;
01188         }
01189       <font class="keywordflow">else</font>
01190         {
01191           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
01192             {
01193               <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
01194             }
01195           
01196           llassertfatal (uentry_isFunction (ue));
01197           llassert (sRefSet_isUndefined (ue-&gt;info-&gt;fcn-&gt;mods));
01198           
01199           ue-&gt;info-&gt;fcn-&gt;mods = sr;
01200           ue-&gt;info-&gt;fcn-&gt;hasMods = TRUE;
01201           
01202           checkGlobalsModifies (ue, sr);
01203         }
01204       
01205       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODIFIESIMPNOGLOBALS))
01206         {
01207           ue-&gt;info-&gt;fcn-&gt;hasGlobs = TRUE;
01208         }
01209     }
01210   <font class="keywordflow">else</font>
01211     {
01212       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (sr);
01213     }
01214 }
01215 
01216 <font class="comment">/*</font>
01217 <font class="comment">** requires: new and old are functions</font>
01218 <font class="comment">*/</font>
01219  
01220 <font class="keyword">static</font> <font class="keywordtype">void</font>
01221 checkGlobalsConformance (<font class="comment">/*@notnull@*/</font> uentry old, 
01222                          <font class="comment">/*@notnull@*/</font> uentry unew, 
01223                          <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
01224 <font class="keyword"></font>{
01225   <font class="keywordtype">bool</font> hasInternalState = FALSE;
01226 
01227   old-&gt;info-&gt;fcn-&gt;hasGlobs |= unew-&gt;info-&gt;fcn-&gt;hasGlobs;
01228 
01229   <font class="keywordflow">if</font> (globSet_isDefined (unew-&gt;info-&gt;fcn-&gt;globs))
01230     {
01231       globSet_allElements (unew-&gt;info-&gt;fcn-&gt;globs, el)<font class="keyword"></font>
01232 <font class="keyword">        </font>{
01233           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (el))
01234             {
01235               sRef sr = <a class="code" href="globSet_c.html#a6">globSet_lookup</a> (old-&gt;info-&gt;fcn-&gt;globs, el);
01236 
01237               <font class="keywordflow">if</font> (sRef_isInvalid (sr))
01238                 {
01239                   <font class="keywordtype">bool</font> hasError = FALSE;
01240 
01241                   <font class="keywordflow">if</font> (!hasInternalState 
01242                       &amp;&amp; sRef_isInvalid (globSet_lookup (old-&gt;info-&gt;fcn-&gt;globs,
01243                                                          sRef_makeInternalState ()))
01244                       &amp;&amp; sRef_isInvalid (globSet_lookup (old-&gt;info-&gt;fcn-&gt;globs,
01245                                                          sRef_makeSpecState ())))
01246                     {
01247                       <font class="keywordflow">if</font> (mustConform 
01248                           &amp;&amp; !uentry_isStatic (old)
01249                           &amp;&amp; optgenerror 
01250                           (FLG_INCONDEFS,
01251                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Globals list for %q includes internal state, %q, "</font>
01252                                     <font class="stringliteral">"but %s without globals internalState."</font>,
01253                                     uentry_getName (old),
01254                                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el),
01255                                     <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old)),
01256                            <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
01257                         {
01258                           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01259                           hasError = TRUE;
01260                         }
01261                       
01262                       old-&gt;info-&gt;fcn-&gt;globs = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (old-&gt;info-&gt;fcn-&gt;globs,
01263                                                               sRef_makeInternalState ());
01264                       hasInternalState = TRUE;
01265                     }
01266 
01267                   <font class="keywordflow">if</font> (!hasError
01268                       &amp;&amp; <a class="code" href="fileloc_c.html#a17">fileloc_sameFile</a> (uentry_whereDeclared (unew),
01269                                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (old)))
01270                     {
01271                       <font class="keywordflow">if</font> (mustConform
01272                           &amp;&amp; optgenerror 
01273                           (FLG_INCONDEFS,
01274                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared (in "</font>
01275                                     <font class="stringliteral">"same file) with file static global %q in "</font>
01276                                     <font class="stringliteral">"globals list"</font>,
01277                                     uentry_getName (unew),
01278                                     <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
01279                                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
01280                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01281                         {
01282                           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01283                         }
01284                     }
01285                 }
01286 
01287               old-&gt;info-&gt;fcn-&gt;globs = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (old-&gt;info-&gt;fcn-&gt;globs, el);
01288               <a class="code" href="context_c.html#a147">context_recordFileGlobals</a> (old-&gt;info-&gt;fcn-&gt;globs);
01289             }
01290           <font class="keywordflow">else</font>
01291             {
01292               sRef sr = <a class="code" href="globSet_c.html#a6">globSet_lookup</a> (old-&gt;info-&gt;fcn-&gt;globs, el);
01293               
01294               <font class="keywordflow">if</font> (sRef_isInvalid (sr))
01295                 {
01296                   <font class="keywordflow">if</font> (mustConform
01297                       &amp;&amp; optgenerror 
01298                       (FLG_INCONDEFS,
01299                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared with "</font>
01300                                 <font class="stringliteral">"%q in globals list"</font>,
01301                                 uentry_getName (unew),
01302                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
01303                                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
01304                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01305                     {
01306                       old-&gt;info-&gt;fcn-&gt;globs = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (old-&gt;info-&gt;fcn-&gt;globs, el);
01307                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01308                     }
01309                 }
01310               <font class="keywordflow">else</font>
01311                 {
01312                   <font class="keywordflow">if</font> (!bool_equal (sRef_isAllocated (el), <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (sr)))
01313                     {
01314                       <font class="keywordflow">if</font> (mustConform
01315                           &amp;&amp; optgenerror 
01316                           (FLG_INCONDEFS,
01317                            message 
01318                            (<font class="stringliteral">"Function %q global %q inconsistently "</font>
01319                             <font class="stringliteral">"%rdeclared as %qout global"</font>,
01320                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
01321                             <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el),
01322                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
01323                             cstring_makeLiteral (sRef_isAllocated (el) ? <font class="stringliteral">""</font> : <font class="stringliteral">"non-"</font>)),
01324                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01325                         {
01326                           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01327                         }
01328                     }
01329                 }
01330             }
01331         } end_globSet_allElements ;
01332 
01333       <font class="keywordflow">if</font> (completeConform)
01334         {
01335           globSet_allElements (old-&gt;info-&gt;fcn-&gt;globs, el)<font class="keyword"></font>
01336 <font class="keyword">            </font>{
01337               sRef sr = <a class="code" href="globSet_c.html#a6">globSet_lookup</a> (unew-&gt;info-&gt;fcn-&gt;globs, el);
01338               
01339               <font class="keywordflow">if</font> (sRef_isInvalid (sr))
01340                 {
01341                   <font class="keywordflow">if</font> (mustConform
01342                       &amp;&amp; uentry_isReallySpecified (old)
01343                       &amp;&amp; optgenerror 
01344                       (FLG_NEEDSPEC,
01345                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q specified with %q in globals list, "</font>
01346                                 <font class="stringliteral">"but declared without %q"</font>,
01347                                 uentry_getName (unew),
01348                                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el),
01349                                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
01350                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01351                     {
01352                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01353                     }
01354                 }
01355             } end_globSet_allElements;
01356         }
01357     }
01358   <font class="keywordflow">else</font>
01359     {
01360       <font class="keywordflow">if</font> (completeConform &amp;&amp; !globSet_isEmpty (old-&gt;info-&gt;fcn-&gt;globs))
01361         {
01362           <font class="keywordflow">if</font> (uentry_isReallySpecified (old)
01363               &amp;&amp; optgenerror 
01364               (FLG_NEEDSPEC,
01365                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified with globals list, but "</font>
01366                         <font class="stringliteral">"declared with no globals"</font>,
01367                         ekind_capName (unew-&gt;ukind),
01368                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
01369                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01370             {
01371               llgenindentmsg 
01372                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Specification globals: %q"</font>, 
01373                           globSet_unparse (old-&gt;info-&gt;fcn-&gt;globs)),
01374                  <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (old));
01375             }
01376         }
01377       
01378       unew-&gt;info-&gt;fcn-&gt;globs = <a class="code" href="globSet_c.html#a3">globSet_copy</a> (unew-&gt;info-&gt;fcn-&gt;globs, 
01379                                             old-&gt;info-&gt;fcn-&gt;globs);
01380     }
01381 }
01382 
01383 <font class="comment">/*</font>
01384 <font class="comment">** new modifies list must be included by old modifies list.</font>
01385 <font class="comment">**</font>
01386 <font class="comment">** file static state may be added to new, if old has internal.</font>
01387 <font class="comment">*/</font>
01388 
01389 <font class="keyword">static</font> <font class="keywordtype">void</font>
01390 checkModifiesConformance (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, 
01391                           <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
01392 <font class="keyword"></font>{
01393   sRefSet newMods;
01394   <font class="keywordtype">bool</font> changedMods = FALSE;
01395   <font class="keywordtype">bool</font> modInternal = FALSE;
01396 
01397   llassert (uentry_isFunction (old) &amp;&amp; uentry_isFunction (unew));
01398 
01399   old-&gt;info-&gt;fcn-&gt;hasMods |= unew-&gt;info-&gt;fcn-&gt;hasMods;
01400   newMods = unew-&gt;info-&gt;fcn-&gt;mods;
01401             
01402   <font class="keywordflow">if</font> (sRefSet_isEmpty (newMods))
01403     {
01404       <font class="keywordflow">if</font> (completeConform &amp;&amp; !sRefSet_isEmpty (old-&gt;info-&gt;fcn-&gt;mods)
01405           &amp;&amp; uentry_isReallySpecified (old))
01406         {
01407           <font class="keywordflow">if</font> (optgenerror 
01408               (FLG_NEEDSPEC,
01409                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified with modifies clause, "</font>
01410                         <font class="stringliteral">"but declared with no modifies clause"</font>,
01411                         ekind_capName (unew-&gt;ukind),
01412                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
01413                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
01414             {
01415               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification has modifies %q"</font>, 
01416                                        sRefSet_unparse (old-&gt;info-&gt;fcn-&gt;mods)),
01417                               <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (old));
01418             }
01419         }
01420 
01421       <font class="keywordflow">return</font>;
01422     }
01423 
01424   sRefSet_allElements (newMods, current)<font class="keyword"></font>
01425 <font class="keyword">    </font>{
01426       <font class="keywordflow">if</font> (sRef_isValid (current))
01427         {
01428           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (current);
01429           
01430           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (rb))
01431             {
01432               <font class="keywordflow">if</font> (!modInternal)
01433                 {
01434                   <font class="keywordflow">if</font> (!<a class="code" href="sRefSet_c.html#a25">sRefSet_isSameMember</a> (old-&gt;info-&gt;fcn-&gt;mods, 
01435                                              sRef_makeInternalState ())
01436                       &amp;&amp; !<a class="code" href="sRefSet_c.html#a25">sRefSet_isSameMember</a> (old-&gt;info-&gt;fcn-&gt;mods, 
01437                                                 sRef_makeSpecState ()))
01438                     {
01439                       <font class="keywordflow">if</font> (mustConform 
01440                           &amp;&amp; !uentry_isStatic (old)
01441                           &amp;&amp; optgenerror 
01442                           (FLG_INCONDEFS,
01443                            message
01444                            (<font class="stringliteral">"Modifies list for %q includes internal state, "</font>
01445                             <font class="stringliteral">"but %s without modifies internal."</font>,
01446                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (old),
01447                             <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old)),
01448                            <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
01449                         {
01450                           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01451                         }
01452                       
01453                       old-&gt;info-&gt;fcn-&gt;mods = 
01454                         <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (old-&gt;info-&gt;fcn-&gt;mods, 
01455                                         sRef_makeInternalState ());
01456                       modInternal = TRUE;
01457                     }
01458                 }
01459               
01460               old-&gt;info-&gt;fcn-&gt;mods = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (old-&gt;info-&gt;fcn-&gt;mods,
01461                                                      current);
01462               changedMods = TRUE;
01463             }
01464           <font class="keywordflow">else</font>
01465             {
01466               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a99">sRef_canModifyVal</a> (current, old-&gt;info-&gt;fcn-&gt;mods))
01467                 {
01468                   <font class="keywordtype">int</font> size = <a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (old-&gt;info-&gt;fcn-&gt;mods);
01469 
01470                   old-&gt;info-&gt;fcn-&gt;mods = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (old-&gt;info-&gt;fcn-&gt;mods,
01471                                                          current);
01472 
01473                   <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (old-&gt;info-&gt;fcn-&gt;mods) != size)
01474                     {
01475                       changedMods = TRUE;
01476                     }
01477                 }
01478               <font class="keywordflow">else</font>
01479                 {
01480                   <font class="keywordflow">if</font> (mustConform
01481                       &amp;&amp; optgenerror 
01482                       (FLG_INCONDEFS,
01483                        message 
01484                        (<font class="stringliteral">"Modifies list for %q contains %q, not modifiable "</font>
01485                         <font class="stringliteral">"according to %s"</font>,
01486                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (old),
01487                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (current),
01488                         <a class="code" href="uentry_c.html#a37">uentry_specDeclName</a> (old)),
01489                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
01490                     {
01491                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01492                     }
01493                 }
01494             }
01495         }
01496     } end_sRefSet_allElements;
01497 
01498   <font class="keywordflow">if</font> (completeConform &amp;&amp; uentry_isReallySpecified (old))
01499     {
01500       sRefSet_allElements (old-&gt;info-&gt;fcn-&gt;mods, el)<font class="keyword"></font>
01501 <font class="keyword">        </font>{
01502           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a100">sRef_canModify</a> (el, newMods))
01503             {
01504               ; <font class="comment">/* okay */</font>
01505             }
01506           <font class="keywordflow">else</font>
01507             {
01508               <font class="keywordflow">if</font> (optgenerror 
01509                   (FLG_NEEDSPEC,
01510                    message 
01511                    (<font class="stringliteral">"Specification modifies clause for %q contains %q, "</font>
01512                     <font class="stringliteral">"not included in declaration modifies clause"</font>,
01513                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (old),
01514                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
01515                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
01516                 {
01517                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
01518                 }
01519             }
01520         } end_sRefSet_allElements ;
01521     } 
01522 
01523   <font class="comment">/*</font>
01524 <font class="comment">  ** Make sure file static elements will be removed.</font>
01525 <font class="comment">  */</font>
01526 
01527   <font class="keywordflow">if</font> (changedMods)
01528     {
01529       <a class="code" href="context_c.html#a146">context_recordFileModifies</a> (old-&gt;info-&gt;fcn-&gt;mods);
01530     }
01531 }
01532 
01533 <font class="keyword">static</font> <font class="keywordtype">void</font> 
01534   uentry_checkMutableType (uentry ue)<font class="keyword"></font>
01535 <font class="keyword"></font>{
01536   ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
01537 
01538   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (ct) &amp;&amp; !<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (ct))
01539     {
01540       voptgenerror (FLG_MUTREP,
01541                     message (<font class="stringliteral">"Mutable abstract type %q declared without pointer "</font>
01542                              <font class="stringliteral">"indirection: %t (violates assignment semantics)"</font>,
01543                              uentry_getName (ue), ct),
01544                     <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
01545     }
01546 }
01547 
01548 <font class="keywordtype">void</font>
<a name="l01549"></a><a class="code" href="uentry_c.html#a63">01549</a> <a class="code" href="uentry_c.html#a63">uentry_setMutable</a> (uentry e)<font class="keyword"></font>
01550 <font class="keyword"></font>{
01551   llassert (uentry_isDatatype (e));
01552   e-&gt;info-&gt;datatype-&gt;mut = YES;
01553 }
01554 
01555 <font class="keyword">static</font> <font class="keywordtype">void</font>
01556 uentry_checkIterArgs (uentry ue)<font class="keyword"></font>
01557 <font class="keyword"></font>{
01558   <font class="keywordtype">bool</font> hasYield = FALSE;
01559   uentryList args;
01560 
01561   llassert (uentry_isIter (ue));
01562 
01563   args = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (ue);
01564 
01565   uentryList_elements (args, el)<font class="keyword"></font>
01566 <font class="keyword">    </font>{
01567       sstate ds = <a class="code" href="uentry_c.html#a175">uentry_getDefState</a> (el);
01568 
01569       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (el))
01570         {
01571           hasYield = TRUE;
01572         }
01573 
01574       <font class="keywordflow">if</font> (sstate_isUnknown (ds))
01575         {
01576           <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (el, SS_DEFINED);
01577         }
01578       <font class="keywordflow">else</font>
01579         {
01580           ;
01581         }
01582     } end_uentryList_elements;
01583 
01584   <font class="keywordflow">if</font> (!hasYield)
01585     {
01586       voptgenerror (FLG_HASYIELD,
01587                     message (<font class="stringliteral">"Iterator %q declared with no yield parameters"</font>,
01588                              uentry_getName (ue)),
01589                     <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
01590     }
01591 }
01592 
01593 <font class="keyword">static</font> chkind
01594 chkind_fromQual (qual qel)<font class="keyword"></font>
01595 <font class="keyword"></font>{
01596   <font class="keywordflow">if</font> (qual_isChecked (qel))
01597     {
01598       <font class="keywordflow">return</font> CH_CHECKED;
01599     }
01600   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isCheckMod (qel))
01601     {
01602       <font class="keywordflow">return</font> CH_CHECKMOD;
01603     }
01604   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isCheckedStrict (qel))
01605     {
01606       <font class="keywordflow">return</font> CH_CHECKEDSTRICT;
01607     }
01608   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isUnchecked (qel))
01609     {
01610       <font class="keywordflow">return</font> CH_UNCHECKED;
01611     }
01612   <font class="keywordflow">else</font>
01613     {
01614       BADEXIT;
01615       <font class="comment">/*@notreached@*/</font> <font class="keywordflow">return</font> CH_UNKNOWN;
01616     }
01617 }
01618 
01619 <font class="keyword">static</font> <font class="keywordtype">void</font>
01620 uentry_reflectOtherQualifier (<font class="comment">/*@notnull@*/</font> uentry ue, qual qel)<font class="keyword"></font>
01621 <font class="keyword"></font>{
01622   <font class="keywordflow">if</font> (qual_isKillRef (qel) || qual_isNewRef (qel) || qual_isTempRef (qel))
01623     {
01624       <font class="keywordflow">if</font> (!uentry_isRefCounted (ue))
01625         {
01626           llerror 
01627             (FLG_SYNTAX, 
01628              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counting qualifier %s used on non-reference "</font>
01629                       <font class="stringliteral">"counted storage: %q"</font>,
01630                       qual_unparse (qel), 
01631                       <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
01632         }
01633       <font class="keywordflow">else</font>
01634         {
01635           alkind ak = <a class="code" href="varKinds_c.html#a18">alkind_fromQual</a> (qel);
01636           
01637           uentry_setAliasKind (ue, ak);
01638         }
01639     }
01640   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isRefCounted (qel))
01641     {
01642       ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (ue));
01643       ctype rt;
01644       
01645       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct) 
01646           &amp;&amp; (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (rt = ctype_realType (ctype_baseArrayPtr (ct)))))
01647         {
01648           <font class="comment">/* check there is a refs field */</font>
01649           uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (rt);
01650           uentry refs = uentry_undefined;
01651 
01652           uentryList_elements (fields, field)<font class="keyword"></font>
01653 <font class="keyword">            </font>{
01654               <font class="keywordflow">if</font> (uentry_isRefsField (field))
01655                 {
01656                   <font class="keywordflow">if</font> (uentry_isValid (refs))
01657                     {
01658                       llerror 
01659                         (FLG_SYNTAX, 
01660                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counted structure type %s has "</font>
01661                                   <font class="stringliteral">"multiple refs fields: %q and %q"</font>,
01662                                   ctype_unparse (ct),
01663                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (refs),
01664                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (field)));
01665                     }
01666                   
01667                   refs = field;
01668                 }
01669             } end_uentryList_elements;
01670 
01671           <font class="keywordflow">if</font> (uentry_isInvalid (refs))
01672             {
01673               vgenhinterror 
01674                 (FLG_SYNTAX, 
01675                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counted structure type %s has "</font>
01676                           <font class="stringliteral">"no refs field"</font>,
01677                           ctype_unparse (ct)),
01678                  cstring_makeLiteral
01679                  (<font class="stringliteral">"To count reference, the structure must have a field named "</font>
01680                   <font class="stringliteral">"refs of type int."</font>),
01681                  g_currentloc);           
01682             }
01683           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (uentry_getType (refs)))
01684             {
01685               llerror 
01686                 (FLG_SYNTAX, 
01687                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counted structure type %s refs field has "</font>
01688                           <font class="stringliteral">"type %s (should be int)"</font>, ctype_unparse (ct),
01689                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (uentry_getType (refs))));
01690             }
01691           <font class="keywordflow">else</font>
01692             {
01693               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, alkind_fromQual (qel), 
01694                                  <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
01695             }
01696         }
01697       <font class="keywordflow">else</font>
01698         {
01699           <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct) 
01700                &amp;&amp; ctype_isUnknown (ctype_realType (ctype_baseArrayPtr (ct))))
01701               ||<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct) || ctype_isUnknown (ct))
01702             {
01703               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, alkind_fromQual (qel), 
01704                                  <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
01705             }
01706           <font class="keywordflow">else</font>
01707             {
01708               llerror 
01709                 (FLG_SYNTAX, 
01710                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Non-pointer to structure type %s declared with "</font>
01711                           <font class="stringliteral">"refcounted qualifier"</font>,
01712                           ctype_unparse (ct)));
01713             }
01714         }
01715     }
01716   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isRefs (qel))
01717     {
01718       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; !<a class="code" href="uentry_c.html#a170">uentry_isParam</a> (ue))
01719         {
01720           uentry_setAliasKind (ue, AK_REFS);
01721         }
01722       <font class="keywordflow">else</font>
01723         {
01724           llerror 
01725             (FLG_SYNTAX, 
01726              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Refs qualifier used on non-structure field: %q"</font>,
01727                       uentry_unparse (ue)));
01728         }
01729     }
01730   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isAliasQual (qel))
01731     {
01732       alkind ak = <a class="code" href="varKinds_c.html#a18">alkind_fromQual</a> (qel);
01733       <font class="keywordtype">bool</font> okay = TRUE;
01734       alkind oldak = <a class="code" href="uentry_c.html#a182">uentry_getAliasKind</a> (ue);
01735       ctype ut = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
01736       
01737       <font class="keywordflow">if</font> (alkind_isImplicit (ak) 
01738           &amp;&amp; (alkind_isKnown (oldak) &amp;&amp; !alkind_isImplicit (oldak)))
01739         {
01740           <font class="comment">/* ignore the implied qualifier */</font>
01741           okay = FALSE;
01742         }
01743       
01744       <font class="keywordflow">if</font> (uentry_isEitherConstant (ue))
01745         {
01746           llerror 
01747             (FLG_SYNTAX, 
01748              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Alias qualifier %s used on constant: %q"</font>,
01749                       alkind_unparse (ak), <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
01750           okay = FALSE;
01751         }
01752       
01753       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ut))
01754         {
01755           ut = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ut);
01756         }
01757       
01758       <font class="keywordflow">if</font> (!(<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ut) 
01759             || <a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (ut)
01760             || <a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (ut)))
01761         {
01762           <font class="keywordflow">if</font> (!qual_isImplied (qel))
01763             {
01764               llerror 
01765                 (FLG_SYNTAX, 
01766                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Alias qualifier %s used on unsharable storage type %t: %q"</font>,
01767                           alkind_unparse (ak), ut, <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue)));
01768             }
01769           
01770           okay = FALSE;
01771         }
01772       <font class="keywordflow">else</font>
01773         {
01774           <font class="keywordflow">if</font> (uentry_isRefCounted (ue))
01775             {
01776               <font class="keywordflow">if</font> (!(qual_isRefQual (qel) || qual_isOnly (qel)
01777                     || qual_isExposed (qel) 
01778                     || qual_isObserver (qel)))
01779                 {
01780                   <font class="keywordflow">if</font> (!qual_isImplied (qel))
01781                     {
01782                       llerror 
01783                         (FLG_SYNTAX, 
01784                          message 
01785                          (<font class="stringliteral">"Alias qualifier %s used on reference counted storage: %q"</font>,
01786                           <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (ak), 
01787                           <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
01788                     }
01789                   
01790                   okay = FALSE;
01791                 }
01792             }
01793           <font class="keywordflow">else</font>
01794             {
01795               <font class="keywordflow">if</font> (qual_isRefQual (qel))
01796                 {
01797                   llerror 
01798                     (FLG_SYNTAX, 
01799                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on non-reference counted storage: %q"</font>,
01800                               alkind_unparse (ak), <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
01801                   
01802                   okay = FALSE;
01803                 }
01804             }
01805         }
01806       
01807       <font class="keywordflow">if</font> (okay)
01808         {
01809           uentry_setAliasKind (ue, ak);
01810         }
01811     }
01812   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isNull (qel))
01813     {
01814       <font class="keywordflow">if</font> (uentry_isConstant (ue))
01815         {
01816           sRef_setNullState 
01817             (ue-&gt;sref, 
01818              <a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ue-&gt;utype) ? NS_CONSTNULL : NS_DEFNULL, 
01819              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ue));
01820         }
01821       <font class="keywordflow">else</font>
01822         {
01823           uentry_setNullState (ue, NS_POSNULL);
01824         }
01825     }
01826   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isRelNull (qel))
01827     {
01828       uentry_setNullState (ue, NS_RELNULL);
01829     }
01830   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isNotNull (qel))
01831     {
01832       uentry_setNullState (ue, NS_MNOTNULL);
01833     }
01834   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isAbstract (qel)
01835            || qual_isConcrete (qel))
01836     {
01837       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ue))
01838         {
01839           llerror 
01840             (FLG_SYNTAX, 
01841              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used with non-datatype"</font>, 
01842                       qual_unparse (qel)));
01843         }
01844       <font class="keywordflow">else</font>
01845         {
01846           ue-&gt;info-&gt;datatype-&gt;abs = ynm_fromBool (qual_isAbstract (qel));
01847         }
01848     }
01849   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isMutable (qel))
01850     {
01851       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ue))
01852         {
01853           llerror (FLG_SYNTAX,
01854                    message (<font class="stringliteral">"Qualifier %s used with non-datatype"</font>, qual_unparse (qel)));
01855         }
01856       <font class="keywordflow">else</font>
01857         {
01858           <font class="keywordflow">if</font> (!ynm_isOn (ue-&gt;info-&gt;datatype-&gt;mut))
01859             {
01860               uentry_checkMutableType (ue);
01861             }
01862           
01863           ue-&gt;info-&gt;datatype-&gt;mut = YES;
01864         }
01865     }
01866   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isImmutable (qel))
01867     {
01868       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ue))
01869         {
01870           llerror (FLG_SYNTAX, message (<font class="stringliteral">"Qualifier %s used with non-datatype"</font>, 
01871                                         qual_unparse (qel)));
01872         }
01873       <font class="keywordflow">else</font>
01874         {
01875           ue-&gt;info-&gt;datatype-&gt;mut = NO;
01876         }
01877     }
01878   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isNullPred (qel))
01879     {
01880       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
01881         {
01882           <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
01883         }
01884       
01885       <font class="keywordflow">if</font> (uentry_isFunction (ue))
01886         {
01887           ctype typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
01888           ctype rtype = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (uentry_getType (ue));
01889           
01890           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (rtype))
01891             {
01892               uentryList pl = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (typ);
01893               
01894               <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (pl) == 1)
01895                 {
01896                   ue-&gt;info-&gt;fcn-&gt;nullPred = qel;
01897                 }
01898               <font class="keywordflow">else</font>
01899                 {
01900                   llerror (FLG_SYNTAX, 
01901                            message (<font class="stringliteral">"Qualifier %s used with function having %d "</font>
01902                                     <font class="stringliteral">"arguments (should have 1)"</font>, 
01903                                     qual_unparse (qel),
01904                                     <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (pl)));
01905                 }
01906             }
01907           <font class="keywordflow">else</font>
01908             {
01909               llerror (FLG_SYNTAX, 
01910                        message (<font class="stringliteral">"Qualifier %s used with function returning %s "</font>
01911                                 <font class="stringliteral">"(should return bool)"</font>, 
01912                                 qual_unparse (qel),
01913                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (rtype)));
01914             }
01915         }
01916       <font class="keywordflow">else</font>
01917         {
01918           llerror (FLG_SYNTAX, 
01919                    message (<font class="stringliteral">"Qualifier %s used with non-function"</font>, 
01920                             qual_unparse (qel)));
01921         }
01922     }
01923   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isExitQual (qel))
01924     {
01925       exitkind exk = <a class="code" href="varKinds_c.html#a17">exitkind_fromQual</a> (qel);
01926       
01927       <font class="keywordflow">if</font> (uentry_isFunction (ue))
01928         {
01929           <font class="keywordflow">if</font> (exitkind_isKnown (ue-&gt;info-&gt;fcn-&gt;exitCode))
01930             {
01931               llerror (FLG_SYNTAX, 
01932                        message (<font class="stringliteral">"Multiple exit qualifiers used on function %q:  %s, %s"</font>, 
01933                                 uentry_getName (ue),
01934                                 <a class="code" href="varKinds_c.html#a23">exitkind_unparse</a> (ue-&gt;info-&gt;fcn-&gt;exitCode),
01935                                 <a class="code" href="varKinds_c.html#a23">exitkind_unparse</a> (exk)));
01936             }
01937           
01938           ue-&gt;info-&gt;fcn-&gt;exitCode = exk;
01939         }
01940       <font class="keywordflow">else</font>
01941         {
01942           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
01943             {
01944               <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
01945               ue-&gt;info-&gt;fcn-&gt;exitCode = exk;
01946             }
01947           <font class="keywordflow">else</font>
01948             {
01949               llerror (FLG_SYNTAX,
01950                        message (<font class="stringliteral">"Exit qualifier %s used with non-function (type %s)"</font>, 
01951                                 qual_unparse (qel),
01952                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (uentry_getType (ue))));
01953             }
01954         }
01955     }
01956   <font class="keywordflow">else</font>
01957     {
01958       <font class="keywordflow">if</font> (qual_isCQual (qel))
01959         {
01960           ; <font class="comment">/* okay */</font>
01961         }
01962       <font class="keywordflow">else</font>
01963         {
01964           llbug (message (<font class="stringliteral">"unhandled qualifier: %s"</font>, qual_unparse (qel)));
01965         }
01966     }
01967 }
01968 
01969 <font class="keywordtype">void</font>
<a name="l01970"></a><a class="code" href="uentry_c.html#a66">01970</a> <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (uentry ue, qualList q)<font class="keyword"></font>
01971 <font class="keyword"></font>{
01972   llassert (uentry_isValid (ue)); 
01973 
01974   qualList_elements (q, qel)<font class="keyword"></font>
01975 <font class="keyword">    </font>{
01976       <font class="keywordflow">if</font> (qual_isStatic (qel))
01977         {
01978           <a class="code" href="uentry_c.html#a53">uentry_setStatic</a> (ue);
01979         }
01980       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isUnused (qel))
01981         {
01982           <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ue, fileloc_undefined);         
01983         }
01984       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isExternal (qel))
01985         {
01986           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (ue-&gt;whereDefined);
01987           ue-&gt;whereDefined = <a class="code" href="fileloc_c.html#a25">fileloc_createExternal</a> ();
01988         }
01989       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isSef (qel))
01990         {
01991           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
01992             {
01993               vkind vk = ue-&gt;info-&gt;var-&gt;kind;
01994 
01995               llassert (vk != VKREFPARAM);
01996 
01997               <font class="keywordflow">if</font> (vk == VKYIELDPARAM)
01998                 {
01999                   llerror
02000                     (FLG_SYNTAX,
02001                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier sef cannot be used with %s: %q"</font>,
02002                               cstring_makeLiteralTemp (vk == VKYIELDPARAM ? <font class="stringliteral">"yield"</font> : <font class="stringliteral">"returned"</font>),
02003                               <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
02004                 }
02005               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (vk == VKRETPARAM)
02006                 {
02007                   ue-&gt;info-&gt;var-&gt;kind = VKSEFRETPARAM;
02008                 }
02009               <font class="keywordflow">else</font>
02010                 {
02011                   ue-&gt;info-&gt;var-&gt;kind = VKSEFPARAM;
02012                 }
02013             }
02014           <font class="keywordflow">else</font>
02015             {
02016               llerror 
02017                 (FLG_SYNTAX,
02018                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier sef is meaningful only on parameters: %q"</font>, 
02019                           uentry_unparse (ue)));
02020             }
02021         }
02022       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isExtern (qel))
02023         {
02024           ue-&gt;storageclass = SCEXTERN;
02025         }
02026       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isGlobalQual (qel)) <font class="comment">/* undef, killed */</font>
02027         {
02028           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02029             {
02030               sstate oldstate = ue-&gt;info-&gt;var-&gt;defstate;
02031               sstate defstate = <a class="code" href="varKinds_c.html#a16">sstate_fromQual</a> (qel);
02032 
02033 
02034               <font class="keywordflow">if</font> ((oldstate == SS_UNDEFGLOB &amp;&amp; defstate == SS_KILLED)
02035                   || (oldstate == SS_KILLED &amp;&amp; defstate == SS_UNDEFGLOB))
02036                 {
02037                   defstate = SS_UNDEFKILLED;
02038                 }
02039               <font class="keywordflow">else</font> 
02040                 {
02041                   ; <font class="comment">/* any errors? */</font>
02042                 }
02043 
02044               <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (ue-&gt;sref, defstate, fileloc_undefined);
02045               ue-&gt;info-&gt;var-&gt;defstate = defstate;
02046             }
02047           <font class="keywordflow">else</font>
02048             {
02049               llerror 
02050                 (FLG_SYNTAX, 
02051                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on non-variable: %q"</font>,
02052                           qual_unparse (qel), <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));          
02053             }
02054         }
02055       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isAllocQual (qel)) <font class="comment">/* out, partial, reldef, special, etc. */</font>
02056         {
02057           ctype realType = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ue-&gt;utype);
02058           sstate defstate = <a class="code" href="varKinds_c.html#a16">sstate_fromQual</a> (qel);
02059 
02060           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (realType))
02061             {
02062               realType = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_returnValue (realType));
02063             }
02064 
02065           <font class="keywordflow">if</font> (qual_isRelDef (qel))
02066             {
02067               ; <font class="comment">/* okay anywhere */</font>
02068             }
02069           <font class="keywordflow">else</font>
02070             {
02071               <font class="keywordflow">if</font> (!ctype_isAP (realType) 
02072                   &amp;&amp; !ctype_isSU (realType)
02073                   &amp;&amp; !ctype_isUnknown (realType)
02074                   &amp;&amp; !<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ue-&gt;utype))
02075                 {
02076                   llerror 
02077                     (FLG_SYNTAX, 
02078                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on non-pointer or struct: %q"</font>,
02079                               qual_unparse (qel), <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
02080                 }
02081             }
02082 
02083           <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (ue, defstate);
02084 
02085           <font class="keywordflow">if</font> (sRef_isStateSpecial (ue-&gt;sref)
02086               &amp;&amp; alkind_isImplicit (sRef_getAliasKind (ue-&gt;sref)))
02087             {
02088               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, AK_ERROR, fileloc_undefined);
02089             }
02090         }
02091       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isYield (qel))
02092         {
02093           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02094             {
02095               ue-&gt;info-&gt;var-&gt;kind = VKYIELDPARAM;
02096             }
02097           <font class="keywordflow">else</font>
02098             {
02099               llerror 
02100                 (FLG_SYNTAX, 
02101                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on non-iterator parameter: %q"</font>,
02102                           qual_unparse (qel), <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));          
02103             }
02104         }
02105       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isExQual (qel))
02106         {
02107           exkind ek = <a class="code" href="varKinds_c.html#a15">exkind_fromQual</a> (qel);
02108           ctype ut = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
02109 
02110           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ut))
02111             {
02112               ut = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ut);
02113             }
02114           
02115           <font class="keywordflow">if</font> (!(<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ut))
02116               &amp;&amp; !(<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ut)) <font class="comment">/* can apply to arrays also! */</font>
02117               &amp;&amp; !(<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ctype_realType (ut)))) <font class="comment">/* applies to structure fields! */</font>
02118             {
02119               <font class="keywordflow">if</font> (!qual_isImplied (qel))
02120                 {
02121                   llerror 
02122                     (FLG_SYNTAX, 
02123                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on unsharable storage type %t: %q"</font>,
02124                               exkind_unparse (ek), ut, <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue)));
02125                 }
02126             }
02127           <font class="keywordflow">else</font>
02128             {
02129               alkind ak = sRef_getAliasKind (ue-&gt;sref);
02130 
02131               <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (ue-&gt;sref, ek, uentry_whereDeclared (ue));
02132 
02133               <font class="keywordflow">if</font> (alkind_isUnknown (ak) || alkind_isImplicit (ak) || alkind_isStatic (ak))
02134                 {
02135                   <font class="keywordflow">if</font> (!alkind_isTemp (ak))
02136                     {
02137                       uentry_setAliasKind (ue, AK_IMPDEPENDENT);
02138                     }
02139                 }
02140               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isDependent (ak) || alkind_isTemp (ak)
02141                        || alkind_isOwned (ak))
02142                 {
02143                   ; <font class="comment">/* okay */</font>
02144                 }
02145               <font class="keywordflow">else</font>
02146                 {
02147                   llerror 
02148                     (FLG_SYNTAX, 
02149                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Exposure qualifier %s used on %s storage (should "</font>
02150                               <font class="stringliteral">"be dependent): %q"</font>,
02151                               qual_unparse (qel), 
02152                               <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (ak),
02153                               <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue)));
02154                 }
02155             }
02156         }
02157       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isGlobCheck (qel))
02158         {
02159           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02160             {
02161               chkind ch = chkind_fromQual (qel);                
02162                        
02163               <font class="keywordflow">if</font> (ue-&gt;info-&gt;var-&gt;checked != CH_UNKNOWN)
02164                 {
02165                   <font class="keywordflow">if</font> (ch == ue-&gt;info-&gt;var-&gt;checked)
02166                     {
02167                       llerror (FLG_SYNTAX, 
02168                                message (<font class="stringliteral">"Redundant %s qualifier on %q"</font>,
02169                                         qual_unparse (qel),
02170                                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue)));
02171                     }
02172                   <font class="keywordflow">else</font>
02173                     {
02174                       llerror (FLG_SYNTAX, 
02175                                message
02176                                (<font class="stringliteral">"Contradictory %s and %s qualifiers on %q"</font>,
02177                                 qual_unparse (qel),
02178                                 checkedName (ue-&gt;info-&gt;var-&gt;checked),
02179                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue)));
02180                     }
02181                 }
02182 
02183               ue-&gt;info-&gt;var-&gt;checked = ch;
02184             }
02185           <font class="keywordflow">else</font>
02186             {
02187               llerror
02188                 (FLG_SYNTAX, 
02189                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used with non-variable"</font>, 
02190                           qual_unparse (qel)));
02191             }
02192         }
02193       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isReturned (qel))
02194         {
02195           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02196             {
02197               ue-&gt;info-&gt;var-&gt;kind = VKRETPARAM;
02198             }
02199           <font class="keywordflow">else</font>
02200             {
02201               llerror (FLG_SYNTAX, message (<font class="stringliteral">"Qualifier %s used with non-variable"</font>, 
02202                                             qual_unparse (qel)));
02203             }
02204         }
02205       <font class="keywordflow">else</font>
02206         {
02207           uentry_reflectOtherQualifier (ue, qel);
02208         }
02209 
02210       <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (ue-&gt;sref);
02211     } end_qualList_elements;
02212 
02213   <a class="code" href="qualList_c.html#a2">qualList_clear</a> (q);
02214 }
02215         
02216 <font class="keywordtype">bool</font>
<a name="l02217"></a><a class="code" href="uentry_c.html#a67">02217</a> <a class="code" href="uentry_c.html#a67">uentry_isOnly</a> (uentry ue)<font class="keyword"></font>
02218 <font class="keyword"></font>{
02219   <font class="keywordflow">return</font> (!uentry_isUndefined (ue) 
02220           &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) 
02221           &amp;&amp; alkind_isOnly (sRef_getOrigAliasKind (ue-&gt;sref)));
02222 }
02223 
02224 <font class="keyword">static</font> <font class="keywordtype">void</font>
02225 uentry_setAliasKind (<font class="comment">/*@notnull@*/</font> uentry ue, alkind ak)<font class="keyword"></font>
02226 <font class="keyword"></font>{
02227   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, ak, uentry_whereDeclared (ue));
02228   <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (ue-&gt;sref, ak);
02229 }
02230 
02231 <font class="keyword">static</font> <font class="keywordtype">void</font>
02232 uentry_setNullState (<font class="comment">/*@notnull@*/</font> uentry ue, nstate ns)<font class="keyword"></font>
02233 <font class="keyword"></font>{
02234   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02235     {
02236       ue-&gt;info-&gt;var-&gt;nullstate = ns;
02237     }
02238 
02239   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (ue-&gt;sref, ns, uentry_whereDeclared (ue));
02240 }
02241 
02242 <font class="keywordtype">bool</font>
<a name="l02243"></a><a class="code" href="uentry_c.html#a68">02243</a> <a class="code" href="uentry_c.html#a68">uentry_isUnique</a> (uentry ue)<font class="keyword"></font>
02244 <font class="keyword"></font>{
02245   <font class="keywordflow">return</font> (!uentry_isUndefined (ue) 
02246           &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) 
02247           &amp;&amp; alkind_isUnique (sRef_getOrigAliasKind (ue-&gt;sref)));
02248 }
02249 
02250 <font class="keywordtype">bool</font>
<a name="l02251"></a><a class="code" href="uentry_c.html#a69">02251</a> <a class="code" href="uentry_c.html#a69">uentry_isFileStatic</a> (uentry ue)<font class="keyword"></font>
02252 <font class="keyword"></font>{
02253   <font class="keywordflow">return</font> (uentry_isStatic (ue) 
02254           &amp;&amp; (!<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue)
02255               || <a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (uentry_getSref (ue))));
02256 }
02257 
02258 <font class="keywordtype">bool</font>
<a name="l02259"></a><a class="code" href="uentry_c.html#a70">02259</a> <a class="code" href="uentry_c.html#a70">uentry_isExported</a> (uentry ue)<font class="keyword"></font>
02260 <font class="keyword"></font>{
02261   <font class="keywordflow">if</font> (uentry_isValid (ue))
02262     {
02263       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02264         {
02265           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a252">sRef_isRealGlobal</a> (uentry_getSref (ue)));
02266         }
02267       <font class="keywordflow">else</font>
02268         {
02269           <font class="keywordflow">return</font> !uentry_isStatic (ue);
02270         }
02271     }
02272 
02273   <font class="keywordflow">return</font> FALSE;
02274 }
02275 
02276 <font class="keywordtype">bool</font>
<a name="l02277"></a><a class="code" href="uentry_c.html#a71">02277</a> <a class="code" href="uentry_c.html#a71">uentry_isNonLocal</a> (uentry ue)<font class="keyword"></font>
02278 <font class="keyword"></font>{
02279   <font class="keywordflow">return</font> (uentry_isValid (ue) &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue)
02280           &amp;&amp; (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (ue-&gt;sref) || uentry_isStatic (ue)));
02281 }
02282 
02283 <font class="keywordtype">bool</font>
<a name="l02284"></a><a class="code" href="uentry_c.html#a72">02284</a> <a class="code" href="uentry_c.html#a72">uentry_isGlobal</a> (uentry ue)<font class="keyword"></font>
02285 <font class="keyword"></font>{
02286   <font class="keywordflow">return</font> (uentry_isValid (ue) &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; 
02287           <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (ue-&gt;sref));
02288 }
02289 
02290 <font class="keywordtype">bool</font>
<a name="l02291"></a><a class="code" href="uentry_c.html#a73">02291</a> <a class="code" href="uentry_c.html#a73">uentry_isPrintfLike</a> (uentry ue)<font class="keyword"></font>
02292 <font class="keyword"></font>{
02293   <font class="keywordflow">return</font> (uentry_isFunction (ue) 
02294           &amp;&amp; (ue-&gt;info-&gt;fcn-&gt;specialCode == SPC_PRINTFLIKE));
02295 }
02296 
02297 <font class="keywordtype">bool</font>
<a name="l02298"></a><a class="code" href="uentry_c.html#a74">02298</a> <a class="code" href="uentry_c.html#a74">uentry_isScanfLike</a> (uentry ue)<font class="keyword"></font>
02299 <font class="keyword"></font>{
02300   <font class="keywordflow">return</font> (uentry_isFunction (ue) 
02301           &amp;&amp; (ue-&gt;info-&gt;fcn-&gt;specialCode == SPC_SCANFLIKE));
02302 }
02303 
02304 <font class="keywordtype">bool</font>
<a name="l02305"></a><a class="code" href="uentry_c.html#a75">02305</a> <a class="code" href="uentry_c.html#a75">uentry_isMessageLike</a> (uentry ue)<font class="keyword"></font>
02306 <font class="keyword"></font>{
02307   <font class="keywordflow">return</font> (uentry_isFunction (ue) 
02308           &amp;&amp; (ue-&gt;info-&gt;fcn-&gt;specialCode == SPC_MESSAGELIKE));
02309 }
02310 
02311 <font class="keyword">static</font> <font class="keywordtype">void</font> checkSpecialFunction (<font class="comment">/*@notnull@*/</font> uentry ue)<font class="keyword"></font>
02312 <font class="keyword"></font>{
02313   uentryList args = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (ue);
02314 
02315   <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (args))
02316     {
02317       uentry last = uentry_undefined;
02318 
02319       uentryList_elements (args, current)<font class="keyword"></font>
02320 <font class="keyword">        </font>{
02321           <font class="keywordflow">if</font> (uentry_isElipsisMarker (current))
02322             {
02323               <font class="keywordflow">if</font> (uentry_isUndefined (last))
02324                 {
02325                   voptgenerror 
02326                     (FLG_SYNTAX,
02327                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q is marked %s, but has no format "</font>
02328                               <font class="stringliteral">"string argument before elipsis"</font>,
02329                               uentry_getName (ue),
02330                               specCode_unparse (ue-&gt;info-&gt;fcn-&gt;specialCode)),
02331                      <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
02332                   ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_NONE;
02333                 }
02334               <font class="keywordflow">else</font>
02335                 {
02336                   ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (last));
02337 
02338                   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (rt, ctype_string))
02339                     {
02340                       <font class="keywordtype">bool</font> okay = FALSE;
02341 
02342                       <font class="comment">/* wchar_t * is okay too */</font>
02343                       <font class="keywordflow">if</font> (ctype_isAP (rt))
02344                         {
02345                           ctype base = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (rt);
02346                           
02347                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a52">ctype_isArbitraryIntegral</a> (base)) 
02348                             {
02349                               okay = TRUE;
02350                             }
02351                         }
02352                       
02353                       <font class="keywordflow">if</font> (!okay) 
02354                         {
02355                           voptgenerror
02356                             (FLG_SYNTAX,
02357                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q is marked %s, but the argument "</font>
02358                                       <font class="stringliteral">"before the elipsis has type %s (should be char *)"</font>,
02359                                       uentry_getName (ue),
02360                                       specCode_unparse (ue-&gt;info-&gt;fcn-&gt;specialCode),
02361                                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (uentry_getType (last))),
02362                              <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
02363                           
02364                           ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_NONE;
02365                         }
02366                     }
02367                 }
02368               <font class="keywordflow">return</font>;
02369             }
02370           last = current;
02371         } end_uentryList_elements ;
02372 
02373       voptgenerror 
02374         (FLG_SYNTAX,
02375          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q is marked %s, but has no elipsis parameter"</font>,
02376                   uentry_getName (ue),
02377                   specCode_unparse (ue-&gt;info-&gt;fcn-&gt;specialCode)),
02378          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
02379 
02380       ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_NONE;
02381     }
02382 }
02383 
02384 <font class="keywordtype">void</font>
<a name="l02385"></a><a class="code" href="uentry_c.html#a77">02385</a> <a class="code" href="uentry_c.html#a77">uentry_setPrintfLike</a> (uentry ue)<font class="keyword"></font>
02386 <font class="keyword"></font>{
02387   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
02388     {
02389       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
02390     }
02391   
02392   llassertfatal (uentry_isFunction (ue));
02393   ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_PRINTFLIKE;
02394   checkSpecialFunction (ue);
02395 }
02396 
02397 <font class="keywordtype">void</font>
<a name="l02398"></a><a class="code" href="uentry_c.html#a78">02398</a> <a class="code" href="uentry_c.html#a78">uentry_setScanfLike</a> (uentry ue)<font class="keyword"></font>
02399 <font class="keyword"></font>{
02400   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
02401     {
02402       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
02403     }
02404   
02405   llassertfatal (uentry_isFunction (ue));
02406   ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_SCANFLIKE;
02407   checkSpecialFunction (ue);
02408 }
02409 
02410 <font class="keywordtype">void</font>
<a name="l02411"></a><a class="code" href="uentry_c.html#a79">02411</a> <a class="code" href="uentry_c.html#a79">uentry_setMessageLike</a> (uentry ue)<font class="keyword"></font>
02412 <font class="keyword"></font>{
02413   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
02414     {
02415       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
02416     }
02417   
02418   llassertfatal (uentry_isFunction (ue));
02419   ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_MESSAGELIKE;
02420   checkSpecialFunction (ue);
02421 }
02422 
02423 <font class="keywordtype">bool</font>
<a name="l02424"></a><a class="code" href="uentry_c.html#a80">02424</a> <a class="code" href="uentry_c.html#a80">uentry_isSpecialFunction</a> (uentry ue)<font class="keyword"></font>
02425 <font class="keyword"></font>{
02426   <font class="keywordflow">return</font> (uentry_isFunction (ue) 
02427           &amp;&amp; (ue-&gt;info-&gt;fcn-&gt;specialCode != SPC_NONE));
02428 }
02429 
<a name="l02430"></a><a class="code" href="uentry_c.html#a81">02430</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (idDecl t, <font class="keywordtype">int</font> i)<font class="keyword"></font>
02431 <font class="keyword"></font>{
02432   ctype ct = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (t);
02433   ctype base = ct;
02434   sRef pref = <a class="code" href="sRef_c.html#a133">sRef_makeParam</a> (i, ct);
02435   uentry ue = <a class="code" href="uentry_c.html#a56">uentry_makeVariableSrefParam</a> (idDecl_observeId (t), ct, pref);
02436 
02437   <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (ue, idDecl_getQuals (t));
02438   uentry_implicitParamAnnots (ue);
02439 
02440   <font class="comment">/* Parameter type [][] or [x][] is invalid */</font>
02441 
02442   <font class="keywordflow">while</font> (<a class="code" href="ctype_c.html#a103">ctype_isFixedArray</a> (base)) {
02443     base = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (base);
02444   }
02445   
02446   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a102">ctype_isIncompleteArray</a> (base)) {
02447     base = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (base);
02448 
02449     <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (base)) {
02450       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (ue)) {
02451         (<font class="keywordtype">void</font>) optgenerror (FLG_INCOMPLETETYPE, 
02452                             message (<font class="stringliteral">"Unnamed function parameter %d is incomplete type (inner array must have bounds): %s"</font>,
02453                                      i + 1,
02454                                      ctype_unparse (ct)),
02455                             <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
02456       } <font class="keywordflow">else</font> {
02457         (<font class="keywordtype">void</font>) optgenerror (FLG_INCOMPLETETYPE, 
02458                             message (<font class="stringliteral">"Function parameter %q is incomplete type (inner array must have bounds): %s"</font>,
02459                                      uentry_getName (ue),
02460                                      <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
02461                             <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
02462       }
02463     }
02464   }
02465 
02466   <font class="keywordflow">return</font> ue;
02467 }
02468 
<a name="l02469"></a><a class="code" href="uentry_c.html#a82">02469</a> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a82">uentry_makeIdVariable</a> (idDecl t)<font class="keyword"></font>
02470 <font class="keyword"></font>{
02471   ctype ct = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (t);
02472 
02473   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
02474     {
02475             <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (t));
02476     }
02477   <font class="keywordflow">else</font>
02478     {
02479       fileloc loc = setLocation ();
02480       uentry ue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (idDecl_observeId (t), ct, loc, FALSE);
02481       
02482       <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (ue, idDecl_getQuals (t));
02483 
02484       <font class="keywordflow">if</font> (!uentry_isExtern (ue))
02485         {
02486           <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, loc);
02487         }
02488 
02489       <font class="keywordflow">return</font> ue;
02490     }
02491 }
02492 
02493 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l02494"></a><a class="code" href="uentry_c.html#a83">02494</a> <font class="preprocessor"></font><font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a83">uentry_makeVariableParam</a> (cstring n, ctype t)<font class="keyword"></font>
02495 <font class="keyword"></font>{
02496   <font class="keywordflow">return</font> (uentry_makeVariableParamAux (n, t, sRef_makeType (t), SS_DEFINED));
02497 }
02498 <font class="preprocessor"># endif</font>
02499 <font class="preprocessor"></font>
02500 <font class="comment">/*</font>
02501 <font class="comment">** constants</font>
02502 <font class="comment">*/</font>
02503 
02504 <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> 
<a name="l02505"></a><a class="code" href="uentry_c.html#a84">02505</a> uentry <a class="code" href="uentry_c.html#a84">uentry_makeConstantAux</a> (cstring n, ctype t, 
02506                                <font class="comment">/*@keep@*/</font> fileloc f, <font class="keywordtype">bool</font> priv,
02507                                <font class="comment">/*@only@*/</font> multiVal m)<font class="keyword"></font>
02508 <font class="keyword"></font>{
02509   uentry e = uentry_alloc ();
02510 
02511   e-&gt;ukind = KCONST;
02512   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
02513   e-&gt;utype = t;
02514   e-&gt;storageclass = SCNONE;
02515 
02516   e-&gt;sref  = <a class="code" href="sRef_c.html#a286">sRef_makeConst</a> (t);
02517 
02518   e-&gt;lset = FALSE;
02519   e-&gt;used = FALSE;
02520   
02521   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
02522   e-&gt;isPrivate = priv;
02523   e-&gt;hasNameError = FALSE;
02524 
02525   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
02526   e-&gt;info-&gt;uconst = (ucinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;uconst));
02527   e-&gt;info-&gt;uconst-&gt;val = m;
02528   e-&gt;info-&gt;uconst-&gt;access = typeIdSet_undefined;
02529 
02530   uentry_setSpecDef (e, f);
02531 
02532   <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m) &amp;&amp; (<a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m) == 0))
02533     {
02534       <a class="code" href="sRef_c.html#a217">sRef_setDefNull</a> (e-&gt;sref, uentry_whereDeclared (e)); 
02535     }
02536 
02537   <font class="keywordflow">return</font> (e);
02538 }
02539 
<a name="l02540"></a><a class="code" href="uentry_c.html#a85">02540</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a85">uentry_makeConstant</a> (cstring n, ctype t, fileloc f)<font class="keyword"></font>
02541 <font class="keyword"></font>{
02542   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a84">uentry_makeConstantAux</a> (n, t, f, FALSE, multiVal_unknown ()));
02543 }
02544 
<a name="l02545"></a><a class="code" href="uentry_c.html#a86">02545</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a86">uentry_makeIdConstant</a> (idDecl t)<font class="keyword"></font>
02546 <font class="keyword"></font>{
02547   uentry ue = <a class="code" href="uentry_c.html#a85">uentry_makeConstant</a> (idDecl_observeId (t), 
02548                                    <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (t), 
02549                                    fileloc_undefined);
02550 
02551   llassert (fileloc_isUndefined (ue-&gt;whereDeclared));
02552   ue-&gt;whereDeclared = setLocation ();
02553 
02554   <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (ue, idDecl_getQuals (t));
02555 
02556   <font class="keywordflow">return</font> ue;
02557 }
02558 
02559 <font class="comment">/*</font>
02560 <font class="comment">** variables</font>
02561 <font class="comment">*/</font>
02562 
<a name="l02563"></a><a class="code" href="uentry_c.html#a87">02563</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (uentry ue, sstate defstate)<font class="keyword"></font>
02564 <font class="keyword"></font>{
02565   <font class="keywordflow">if</font> (uentry_isValid (ue))
02566     {
02567       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (ue-&gt;sref, defstate, fileloc_undefined);
02568 
02569       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
02570         {
02571           ue-&gt;info-&gt;var-&gt;defstate = defstate; <font class="comment">/* evs 2000-05-17: fixed bug, was SS_DEFINED! */</font>
02572         }
02573     }
02574 }
02575 
<a name="l02576"></a><a class="code" href="uentry_c.html#a88">02576</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a88">uentry_isCheckedUnknown</a> (uentry ue)<font class="keyword"></font>
02577 <font class="keyword"></font>{
02578   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02579           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_UNKNOWN));
02580 }
02581 
<a name="l02582"></a><a class="code" href="uentry_c.html#a89">02582</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a89">uentry_isCheckMod</a> (uentry ue)<font class="keyword"></font>
02583 <font class="keyword"></font>{
02584   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02585           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_CHECKMOD));
02586 }
02587 
<a name="l02588"></a><a class="code" href="uentry_c.html#a90">02588</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a90">uentry_isUnchecked</a> (uentry ue)<font class="keyword"></font>
02589 <font class="keyword"></font>{
02590   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02591           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_UNCHECKED));
02592 }
02593 
<a name="l02594"></a><a class="code" href="uentry_c.html#a91">02594</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a91">uentry_isChecked</a> (uentry ue)<font class="keyword"></font>
02595 <font class="keyword"></font>{
02596   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02597           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_CHECKED));
02598 }
02599 
<a name="l02600"></a><a class="code" href="uentry_c.html#a92">02600</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a92">uentry_isCheckedModify</a> (uentry ue)<font class="keyword"></font>
02601 <font class="keyword"></font>{
02602   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02603           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_CHECKED
02604               || ue-&gt;info-&gt;var-&gt;checked == CH_CHECKMOD
02605               || ue-&gt;info-&gt;var-&gt;checked == CH_CHECKEDSTRICT));
02606 }
02607 
<a name="l02608"></a><a class="code" href="uentry_c.html#a93">02608</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a93">uentry_isCheckedStrict</a> (uentry ue)<font class="keyword"></font>
02609 <font class="keyword"></font>{
02610   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue) 
02611           &amp;&amp; (ue-&gt;info-&gt;var-&gt;checked == CH_CHECKEDSTRICT));
02612 }
02613 
<a name="l02614"></a><a class="code" href="uentry_c.html#a94">02614</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a94">uentry_setUnchecked</a> (uentry ue)<font class="keyword"></font>
02615 <font class="keyword"></font>{
02616   llassert (uentry_isVar (ue));
02617 
02618   ue-&gt;info-&gt;var-&gt;checked = CH_UNCHECKED;
02619 }
02620 
<a name="l02621"></a><a class="code" href="uentry_c.html#a95">02621</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a95">uentry_setChecked</a> (uentry ue)<font class="keyword"></font>
02622 <font class="keyword"></font>{
02623   llassert (uentry_isVar (ue));
02624 
02625   ue-&gt;info-&gt;var-&gt;checked = CH_CHECKED;
02626 }
02627 
<a name="l02628"></a><a class="code" href="uentry_c.html#a96">02628</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a96">uentry_setCheckMod</a> (uentry ue)<font class="keyword"></font>
02629 <font class="keyword"></font>{
02630   llassert (uentry_isVar (ue));
02631 
02632   ue-&gt;info-&gt;var-&gt;checked = CH_CHECKMOD;
02633 }
02634 
<a name="l02635"></a><a class="code" href="uentry_c.html#a97">02635</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a97">uentry_setCheckedStrict</a> (uentry ue)<font class="keyword"></font>
02636 <font class="keyword"></font>{
02637   llassert (uentry_isVar (ue));
02638   
02639   ue-&gt;info-&gt;var-&gt;checked = CH_CHECKEDSTRICT;
02640 }
02641 
02642 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> 
02643   uentry uentry_makeVariableAux (cstring n, ctype t, 
02644                                  fileloc f,
02645                                  <font class="comment">/*@exposed@*/</font> sRef s,
02646                                  <font class="keywordtype">bool</font> priv, vkind kind)<font class="keyword"></font>
02647 <font class="keyword"></font>{
02648   uentry e = uentry_alloc ();
02649   ctype rt = t;
02650 
02651   DPRINTF ((<font class="stringliteral">"Make variable: %s %s %s"</font>, n, ctype_unparse (t), <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)));
02652 
02653   e-&gt;ukind = KVAR;
02654   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
02655   e-&gt;utype = t;
02656 
02657   e-&gt;storageclass = SCNONE;
02658 
02659   e-&gt;sref  = s;
02660 
02661   e-&gt;used = FALSE;
02662   e-&gt;lset = FALSE;
02663 
02664   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
02665   e-&gt;isPrivate = priv;
02666   e-&gt;hasNameError = FALSE;
02667 
02668   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
02669   e-&gt;info-&gt;var = (uvinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;var));
02670   e-&gt;info-&gt;var-&gt;kind = kind;
02671 
02672   e-&gt;info-&gt;var-&gt;checked = CH_UNKNOWN;
02673 
02674   uentry_setSpecDef (e, f);
02675 
02676   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (rt))
02677     {
02678       rt = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (rt);
02679     }
02680 
02681   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (rt))
02682     {
02683       <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (e-&gt;sref, rt);
02684     }
02685 
02686   e-&gt;info-&gt;var-&gt;defstate = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (e-&gt;sref);  
02687   e-&gt;info-&gt;var-&gt;nullstate = sRef_getNullState (e-&gt;sref);
02688 
02689   <font class="keywordflow">return</font> (e);
02690 }
02691 
02692 <font class="keywordtype">bool</font>
<a name="l02693"></a><a class="code" href="uentry_c.html#a98">02693</a> <a class="code" href="uentry_c.html#a98">uentry_isYield</a> (uentry ue)<font class="keyword"></font>
02694 <font class="keyword"></font>{
02695   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) 
02696           &amp;&amp; (ue-&gt;info-&gt;var-&gt;kind == VKYIELDPARAM
02697               || ue-&gt;info-&gt;var-&gt;kind == VKREFYIELDPARAM));
02698 }
02699 
02700 <font class="keyword">static</font> <font class="keywordtype">bool</font>
02701 uentry_isRefsField (uentry ue)<font class="keyword"></font>
02702 <font class="keyword"></font>{
02703   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; sRef_isRefsField (ue-&gt;sref));
02704 }
02705 
02706 <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> 
<a name="l02707"></a><a class="code" href="uentry_c.html#a99">02707</a> uentry <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (cstring n, ctype t, fileloc f, <font class="keywordtype">bool</font> isPriv)<font class="keyword"></font>
02708 <font class="keyword"></font>{
02709   <font class="keywordflow">return</font> (uentry_makeVariableAux (n, t, f, sRef_makeType (t), isPriv, 
02710                                   <a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (f) ? VKSPEC : VKNORMAL));
02711 }
02712 
02713 <font class="comment">/*</font>
02714 <font class="comment">** functions</font>
02715 <font class="comment">*/</font>
02716 
<a name="l02717"></a><a class="code" href="uentry_c.html#a100">02717</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (uentry ue)<font class="keyword"></font>
02718 <font class="keyword"></font>{
02719   alkind ak;
02720   exkind ek;
02721   uvinfo oldInfo;
02722   fileloc loc;
02723 
02724   llassert (uentry_isValid (ue));
02725   llassert (!sRef_modInFunction ());
02726 
02727   ak = sRef_getOrigAliasKind (ue-&gt;sref);
02728   ek = <a class="code" href="sRef_c.html#a189">sRef_getOrigExKind</a> (ue-&gt;sref);
02729 
02730   oldInfo = ue-&gt;info-&gt;var;
02731 
02732   llassert (ctype_isUnknown (ue-&gt;utype) || <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ue-&gt;utype));
02733 
02734   <font class="comment">/*</font>
02735 <font class="comment">  ** expanded macro is marked used (until I write a pre-processor)</font>
02736 <font class="comment">  */</font>
02737 
02738   ue-&gt;used |= (oldInfo-&gt;kind == VKEXPMACRO);
02739 
02740   ue-&gt;ukind = KFCN;
02741   ue-&gt;info-&gt;fcn = (ufinfo) dmalloc (<font class="keyword">sizeof</font> (*ue-&gt;info-&gt;fcn));
02742   ue-&gt;info-&gt;fcn-&gt;exitCode = XK_UNKNOWN;
02743   ue-&gt;info-&gt;fcn-&gt;nullPred = QU_UNKNOWN;
02744   ue-&gt;info-&gt;fcn-&gt;specialCode = SPC_NONE;
02745   ue-&gt;info-&gt;fcn-&gt;access = typeIdSet_undefined;
02746   ue-&gt;info-&gt;fcn-&gt;hasGlobs = FALSE;
02747   ue-&gt;info-&gt;fcn-&gt;globs = globSet_undefined;
02748   ue-&gt;info-&gt;fcn-&gt;hasMods = FALSE;
02749   ue-&gt;info-&gt;fcn-&gt;mods = sRefSet_undefined;
02750   ue-&gt;info-&gt;fcn-&gt;specclauses = NULL;
02751   ue-&gt;info-&gt;fcn-&gt;defparams = uentryList_undefined;
02752 
02753   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ue-&gt;utype))
02754     {
02755       ue-&gt;sref = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ctype_returnValue (ue-&gt;utype)); 
02756     }
02757   <font class="keywordflow">else</font>
02758     {
02759       ue-&gt;sref = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ctype_unknown); 
02760     }
02761 
02762   <font class="keywordflow">if</font> (sRef_isRefCounted (ue-&gt;sref))
02763     {
02764       ak = AK_NEWREF;
02765     }
02766   <font class="keywordflow">else</font>
02767     {
02768       <font class="keywordflow">if</font> (alkind_isUnknown (ak))
02769         {
02770           <font class="keywordflow">if</font> (exkind_isKnown (ek))
02771             {
02772               ak = AK_IMPDEPENDENT;
02773             }
02774           <font class="keywordflow">else</font> 
02775             {
02776               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_RETIMPONLY))
02777                 {
02778                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ue-&gt;utype)
02779                       &amp;&amp; ctype_isVisiblySharable 
02780                       (<a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_returnValue (ue-&gt;utype))))
02781                     {
02782                       <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a31">uentryList_hasReturned</a> (uentry_getParams (ue)))
02783                         {
02784                           ;
02785                         }
02786                       <font class="keywordflow">else</font>
02787                         {
02788                           ak = AK_IMPONLY;
02789                                                 }
02790                     }
02791                 }
02792             }
02793         }
02794     }
02795 
02796   loc = ue-&gt;whereDeclared;
02797 
02798   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ue-&gt;sref, ak, loc);
02799   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (ue-&gt;sref, oldInfo-&gt;nullstate, loc);
02800   <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (ue-&gt;sref, oldInfo-&gt;defstate, loc);
02801   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (ue-&gt;sref, ek, loc);
02802 
02803   <font class="keywordflow">if</font> (oldInfo-&gt;kind == VKEXPMACRO)
02804     {
02805       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (loc);
02806       ue-&gt;whereDeclared = fileloc_undefined;
02807     }
02808   <font class="keywordflow">else</font>
02809     {
02810       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (ue-&gt;whereDefined);
02811       ue-&gt;whereDefined = fileloc_undefined;
02812     }
02813 
02814   uvinfo_free (oldInfo);
02815 }
02816 
02817 <font class="keywordtype">void</font>
<a name="l02818"></a><a class="code" href="uentry_c.html#a101">02818</a> <a class="code" href="uentry_c.html#a101">uentry_setGlobals</a> (uentry ue, <font class="comment">/*@owned@*/</font> globSet globs)<font class="keyword"></font>
02819 <font class="keyword"></font>{
02820   llassert (uentry_isValid (ue));
02821 
02822   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ue))
02823     {
02824       llassert (globSet_isUndefined (ue-&gt;info-&gt;iter-&gt;globs));
02825       ue-&gt;info-&gt;iter-&gt;globs = globs;
02826     }
02827   <font class="keywordflow">else</font>
02828     {
02829       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ue)))
02830         {
02831           <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
02832         }
02833       
02834       llassert (uentry_isFunction (ue));
02835       llassert (!ue-&gt;info-&gt;fcn-&gt;hasGlobs 
02836                 &amp;&amp; globSet_isUndefined (ue-&gt;info-&gt;fcn-&gt;globs));
02837       
02838       ue-&gt;info-&gt;fcn-&gt;hasGlobs = TRUE;
02839       <font class="comment">/*@-mustfree@*/</font> ue-&gt;info-&gt;fcn-&gt;globs = globs;
02840       <font class="comment">/*@=mustfree@*/</font>
02841     }
02842 
02843   <font class="keywordflow">if</font> (<a class="code" href="globSet_c.html#a7">globSet_hasStatic</a> (globs))
02844     {
02845       <a class="code" href="context_c.html#a147">context_recordFileGlobals</a> (globs);
02846     }
02847 
02848   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_GLOBALSIMPMODIFIESNOTHING))
02849     {
02850       ue-&gt;info-&gt;fcn-&gt;hasMods = TRUE;
02851     }
02852 }
02853 
<a name="l02854"></a><a class="code" href="uentry_c.html#a102">02854</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a102">uentry_addAccessType</a> (uentry ue, typeId tid)<font class="keyword"></font>
02855 <font class="keyword"></font>{
02856   <font class="keywordflow">if</font> (uentry_isFunction (ue))
02857     {
02858       ue-&gt;info-&gt;fcn-&gt;access = <a class="code" href="typeIdSet_c.html#a19">typeIdSet_insert</a> (ue-&gt;info-&gt;fcn-&gt;access, tid);
02859     }
02860   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isEitherConstant (ue))
02861     {
02862       ue-&gt;info-&gt;uconst-&gt;access = <a class="code" href="typeIdSet_c.html#a19">typeIdSet_insert</a> (ue-&gt;info-&gt;uconst-&gt;access, tid);
02863     }
02864   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ue))
02865     {
02866       ue-&gt;info-&gt;iter-&gt;access = <a class="code" href="typeIdSet_c.html#a19">typeIdSet_insert</a> (ue-&gt;info-&gt;iter-&gt;access, tid);
02867     }
02868   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ue))
02869     {
02870       ue-&gt;info-&gt;enditer-&gt;access = <a class="code" href="typeIdSet_c.html#a19">typeIdSet_insert</a> (ue-&gt;info-&gt;enditer-&gt;access, tid);
02871     }
02872   <font class="keywordflow">else</font>
02873     {
02874       llbug (message (<font class="stringliteral">"no access for: %q"</font>, uentry_unparse (ue)));
02875     }
02876 }
02877 
02878 <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
<a name="l02879"></a><a class="code" href="uentry_c.html#a103">02879</a>   <a class="code" href="uentry_c.html#a103">uentry_makeFunction</a> (cstring n, ctype t, 
02880                        typeId access, 
02881                        <font class="comment">/*@only@*/</font> globSet globs, <font class="comment">/*@only@*/</font> sRefSet mods, 
02882                        fileloc f)<font class="keyword"></font>
02883 <font class="keyword"></font>{
02884   <font class="keywordflow">return</font> (uentry_makeFunctionAux (n, t, 
02885                                   ((typeId_isInvalid (access)) ? <a class="code" href="typeIdSet_c.html#a14">typeIdSet_emptySet</a> () 
02886                                    : <a class="code" href="typeIdSet_c.html#a17">typeIdSet_single</a> (access)),
02887                                   globs, mods, f,
02888                                   FALSE, FALSE));
02889 }
02890 
02891 <font class="preprocessor"># ifndef NOLCL</font>
02892 <font class="preprocessor"></font><font class="comment">/*@notnull@*/</font> uentry 
<a name="l02893"></a><a class="code" href="uentry_c.html#a104">02893</a>   <a class="code" href="uentry_c.html#a104">uentry_makePrivFunction2</a> (cstring n, ctype t, 
02894                             typeIdSet access, 
02895                             globSet globs, sRefSet mods, 
02896                             fileloc f)<font class="keyword"></font>
02897 <font class="keyword"></font>{
02898   <font class="keywordflow">return</font> (uentry_makeFunctionAux (n, t, access, globs, mods, f, TRUE, FALSE));
02899 }
02900 
02901 
02902 <font class="comment">/*@notnull@*/</font> uentry 
<a name="l02903"></a><a class="code" href="uentry_c.html#a105">02903</a>   <a class="code" href="uentry_c.html#a105">uentry_makeSpecFunction</a> (cstring n, ctype t, 
02904                            typeIdSet access,
02905                            <font class="comment">/*@only@*/</font> globSet globs, 
02906                            <font class="comment">/*@only@*/</font> sRefSet mods, 
02907                            fileloc f)<font class="keyword"></font>
02908 <font class="keyword"></font>{
02909   uentry ue = uentry_makeFunctionAux (n, t, access, 
02910                                       globs, mods, f,
02911                                       FALSE, FALSE);
02912 
02913   uentry_setHasGlobs (ue);
02914   uentry_setHasMods (ue);
02915 
02916   reflectImplicitFunctionQualifiers (ue, TRUE);
02917   <font class="keywordflow">return</font> (ue);
02918 }
02919 <font class="preprocessor"># endif</font>
02920 <font class="preprocessor"></font>
<a name="l02921"></a><a class="code" href="uentry_c.html#a106">02921</a> uentry <a class="code" href="uentry_c.html#a106">uentry_makeExpandedMacro</a> (cstring s, fileloc f)<font class="keyword"></font>
02922 <font class="keyword"></font>{
02923   uentry ue = uentry_makeVariableAux (s, ctype_unknown, fileloc_undefined, 
02924                                       sRef_undefined, FALSE, VKEXPMACRO);
02925 
02926   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, f);
02927   <font class="keywordflow">return</font> ue;
02928 }
02929 
02930 <font class="comment">/*@notnull@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
<a name="l02931"></a><a class="code" href="uentry_c.html#a107">02931</a>   <a class="code" href="uentry_c.html#a107">uentry_makeForwardFunction</a> (cstring n, typeId access, fileloc f)<font class="keyword"></font>
02932 <font class="keyword"></font>{
02933   uentry ue = uentry_makeFunctionAux (n, ctype_unknown, 
02934                                       typeIdSet_singleOpt (access),
02935                                       globSet_undefined, sRefSet_undefined, 
02936                                       fileloc_undefined,
02937                                       FALSE, TRUE);
02938 
02939   ue-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ue-&gt;whereDeclared, f);
02940   <font class="keywordflow">return</font> ue;
02941 }
02942 
<a name="l02943"></a><a class="code" href="uentry_c.html#a108">02943</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a108">uentry_isForward</a> (uentry e)<font class="keyword"></font>
02944 <font class="keyword"></font>{
02945   <font class="keywordflow">if</font> (uentry_isValid (e))
02946     {
02947       ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
02948 
02949       <font class="keywordflow">return</font> (ctype_isUnknown (ct)
02950               || (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct)
02951                   &amp;&amp; ctype_isUnknown (ctype_returnValue (ct))));
02952     }
02953 
02954   <font class="keywordflow">return</font> FALSE;
02955 }
02956 
02957 <font class="preprocessor"># ifndef NOLCL</font>
02958 <font class="preprocessor"></font><font class="comment">/*@notnull@*/</font> uentry 
<a name="l02959"></a><a class="code" href="uentry_c.html#a109">02959</a> <a class="code" href="uentry_c.html#a109">uentry_makeTypeListFunction</a> (cstring n, typeIdSet access, fileloc f)<font class="keyword"></font>
02960 <font class="keyword"></font>{
02961   <font class="keywordflow">return</font> (uentry_makeFunctionAux (n, ctype_unknown, access,
02962                                   globSet_new (),
02963                                   <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> (), f,
02964                                   FALSE, TRUE));
02965 }
02966 
02967 <font class="comment">/*@notnull@*/</font> uentry 
<a name="l02968"></a><a class="code" href="uentry_c.html#a110">02968</a> <a class="code" href="uentry_c.html#a110">uentry_makeUnspecFunction</a> (cstring n, ctype t, 
02969                            typeIdSet access, 
02970                            fileloc f)<font class="keyword"></font>
02971 <font class="keyword"></font>{
02972   uentry ue = uentry_makeFunctionAux (n, t, access, globSet_new (),
02973                                       <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> (), f, FALSE, TRUE);
02974 
02975   reflectImplicitFunctionQualifiers (ue, TRUE);
02976   <font class="keywordflow">return</font> ue;
02977 }
02978 <font class="preprocessor"># endif</font>
02979 <font class="preprocessor"></font>
02980 <font class="comment">/*</font>
02981 <font class="comment">** datatypes</font>
02982 <font class="comment">*/</font>
02983 
02984 <font class="comment">/* is exported for use by usymtab_interface */</font>
02985 
02986 <font class="comment">/*@notnull@*/</font> uentry 
<a name="l02987"></a><a class="code" href="uentry_c.html#a111">02987</a>   <a class="code" href="uentry_c.html#a111">uentry_makeDatatypeAux</a> (cstring n, ctype t, ynm mut, ynm abs, 
02988                           fileloc f, <font class="keywordtype">bool</font> priv)<font class="keyword"></font>
02989 <font class="keyword"></font>{
02990   uentry e = uentry_alloc ();
02991 
02992   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
02993   e-&gt;ukind = KDATATYPE;
02994   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
02995   e-&gt;utype = t;
02996   e-&gt;storageclass = SCNONE;
02997   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02998 
02999   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (t))
03000     {
03001       <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (e-&gt;sref, t);
03002     }
03003 
03004   uentry_setSpecDef (e, f);
03005 
03006   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03007   e-&gt;isPrivate = priv;
03008   e-&gt;hasNameError = FALSE;
03009 
03010   e-&gt;used = FALSE;
03011   e-&gt;lset = FALSE;
03012 
03013   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03014   e-&gt;info-&gt;datatype = (udinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;datatype));
03015   e-&gt;info-&gt;datatype-&gt;abs = abs;
03016   e-&gt;info-&gt;datatype-&gt;mut = mut;
03017   e-&gt;info-&gt;datatype-&gt;type = ctype_undefined;
03018 
03019   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (e))
03020     {
03021       <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (e, f);
03022     }
03023 
03024   <font class="keywordflow">if</font> (ynm_isOn (abs) &amp;&amp; !(<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (e)))
03025     {
03026       <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (e-&gt;sref, NS_ABSNULL, uentry_whereDeclared (e));
03027     }
03028 
03029   <font class="keywordflow">return</font> (e);
03030 }
03031 
03032 <font class="comment">/*@notnull@*/</font> uentry
<a name="l03033"></a><a class="code" href="uentry_c.html#a112">03033</a>   <a class="code" href="uentry_c.html#a112">uentry_makeDatatype</a> (cstring n, ctype t, ynm mut, ynm abs, 
03034                        fileloc f)<font class="keyword"></font>
03035 <font class="keyword"></font>{
03036   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a111">uentry_makeDatatypeAux</a> (n, t, mut, abs, f, FALSE));
03037 }
03038 
<a name="l03039"></a><a class="code" href="uentry_c.html#a113">03039</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a113">uentry_makeBoolDatatype</a> (ynm abs)<font class="keyword"></font>
03040 <font class="keyword"></font>{
03041   uentry ret = <a class="code" href="uentry_c.html#a111">uentry_makeDatatypeAux</a> (context_getBoolName (),
03042                                        ctype_bool, NO, abs, 
03043                                        <a class="code" href="fileloc_c.html#a28">fileloc_getBuiltin</a> (),
03044                                        FALSE);
03045   
03046   ret-&gt;info-&gt;datatype-&gt;type = ctype_bool;
03047   <font class="keywordflow">return</font> ret;
03048 }
03049 
03050 <font class="comment">/*</font>
03051 <font class="comment">** iters</font>
03052 <font class="comment">*/</font>
03053 
03054 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
03055   uentry_makeIterAux (cstring n, typeIdSet access, ctype ct, 
03056                       <font class="comment">/*@only@*/</font> fileloc f)<font class="keyword"></font>
03057 <font class="keyword"></font>{
03058   uentry e = uentry_alloc ();
03059 
03060   e-&gt;ukind = KITER;
03061   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
03062   e-&gt;utype = ct;
03063   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03064   e-&gt;storageclass = SCNONE;
03065   e-&gt;used = FALSE;
03066   e-&gt;lset = FALSE;
03067 
03068   uentry_setSpecDef (e, f);
03069 
03070   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03071   e-&gt;isPrivate = FALSE;
03072   e-&gt;hasNameError = FALSE;
03073 
03074   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03075   e-&gt;info-&gt;iter = (uiinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;iter));
03076   e-&gt;info-&gt;iter-&gt;access = access;
03077   e-&gt;info-&gt;iter-&gt;mods = sRefSet_undefined;
03078   e-&gt;info-&gt;iter-&gt;globs = globSet_undefined;
03079 
03080   uentry_checkIterArgs (e);
03081   <font class="keywordflow">return</font> (e);
03082 }
03083 
<a name="l03084"></a><a class="code" href="uentry_c.html#a115">03084</a> <font class="comment">/*@notnull@*/</font> uentry <a class="code" href="uentry_c.html#a115">uentry_makeIter</a> (cstring n, ctype ct, fileloc f)<font class="keyword"></font>
03085 <font class="keyword"></font>{
03086   <font class="keywordflow">return</font> (uentry_makeIterAux (n, context_fileAccessTypes (), ct, f));
03087 }
03088 
03089 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> uentry
03090 uentry_makeEndIterAux (cstring n, typeIdSet access, <font class="comment">/*@only@*/</font> fileloc f)<font class="keyword"></font>
03091 <font class="keyword"></font>{
03092   uentry e = uentry_alloc ();
03093 
03094   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03095   e-&gt;ukind = KENDITER;
03096   e-&gt;storageclass = SCNONE;
03097   e-&gt;uname = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"end_%s"</font>, n);
03098   e-&gt;utype = ctype_unknown;
03099   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03100 
03101   uentry_setSpecDef (e, f);
03102 
03103   e-&gt;used = FALSE;
03104   e-&gt;lset = FALSE;
03105 
03106   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03107   e-&gt;isPrivate = FALSE;
03108   e-&gt;hasNameError = FALSE;
03109 
03110   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03111   e-&gt;info-&gt;enditer = (ueinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;enditer));
03112 
03113   e-&gt;info-&gt;enditer-&gt;access = access;
03114 
03115   <font class="keywordflow">return</font> (e);
03116 }
03117 
<a name="l03118"></a><a class="code" href="uentry_c.html#a117">03118</a> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> uentry <a class="code" href="uentry_c.html#a117">uentry_makeEndIter</a> (cstring n, fileloc f)<font class="keyword"></font>
03119 <font class="keyword"></font>{
03120   <font class="keywordflow">return</font> (uentry_makeEndIterAux (n, context_fileAccessTypes (), f));
03121 }
03122 
03123 <font class="comment">/*</font>
03124 <font class="comment">** tags</font>
03125 <font class="comment">*/</font>
03126 
03127 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> uentry 
03128   uentry_makeTagAux (cstring n, ctype t, 
03129                      <font class="comment">/*@only@*/</font> fileloc fl, 
03130                      <font class="keywordtype">bool</font> priv, ekind kind)<font class="keyword"></font>
03131 <font class="keyword"></font>{
03132   uentry e = uentry_alloc ();
03133   
03134   <font class="keywordflow">if</font> (kind != KSTRUCTTAG &amp;&amp; kind != KUNIONTAG &amp;&amp; kind != KENUMTAG)
03135     {
03136       llbuglit (<font class="stringliteral">"uentry_makeTagAux: not a tag type"</font>);
03137     }
03138   
03139   e-&gt;ukind = kind;
03140   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03141   e-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (n);
03142 
03143   e-&gt;utype = t;
03144   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03145   e-&gt;storageclass = SCNONE;
03146 
03147   uentry_setSpecDef (e, fl);
03148   
03149   e-&gt;used = FALSE;
03150   e-&gt;lset = FALSE;
03151 
03152   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03153   e-&gt;isPrivate = priv;
03154   e-&gt;hasNameError = FALSE;
03155 
03156   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03157   e-&gt;info-&gt;datatype = (udinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;datatype));
03158   e-&gt;info-&gt;datatype-&gt;abs = NO;
03159   e-&gt;info-&gt;datatype-&gt;mut = (kind == KENUMTAG) ? NO : MAYBE;
03160   e-&gt;info-&gt;datatype-&gt;type = t;
03161 
03162   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (e))
03163     {
03164       <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (e, fl);
03165     }
03166 
03167   <font class="keywordflow">return</font> (e);  
03168 }
03169 
<a name="l03170"></a><a class="code" href="uentry_c.html#a119">03170</a> uentry <a class="code" href="uentry_c.html#a119">uentry_makeStructTagLoc</a> (cstring n, ctype t)<font class="keyword"></font>
03171 <font class="keyword"></font>{
03172   cstring sname = <a class="code" href="structNames_c.html#a8">makeStruct</a> (n);
03173   uentry ret = uentry_makeTagAux (sname, t, setLocation (), FALSE, KSTRUCTTAG);
03174 
03175   <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
03176   <font class="keywordflow">return</font> (ret);
03177 }
03178 
03179 <font class="comment">/*@only@*/</font> uentry
<a name="l03180"></a><a class="code" href="uentry_c.html#a120">03180</a> <a class="code" href="uentry_c.html#a120">uentry_makeStructTag</a> (cstring n, ctype t, fileloc loc)<font class="keyword"></font>
03181 <font class="keyword"></font>{
03182   cstring sname = <a class="code" href="structNames_c.html#a8">makeStruct</a> (n);
03183   uentry ret = uentry_makeTagAux (sname, t, loc, FALSE, KSTRUCTTAG);
03184 
03185   <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
03186   <font class="keywordflow">return</font> ret;
03187 }
03188 
03189 <font class="comment">/*@only@*/</font> uentry
<a name="l03190"></a><a class="code" href="uentry_c.html#a121">03190</a> <a class="code" href="uentry_c.html#a121">uentry_makeUnionTag</a> (cstring n, ctype t, fileloc loc)<font class="keyword"></font>
03191 <font class="keyword"></font>{
03192   cstring uname = <a class="code" href="structNames_c.html#a9">makeUnion</a> (n);
03193   uentry ret = uentry_makeTagAux (uname, t, loc, FALSE, KUNIONTAG);
03194 
03195   <a class="code" href="cstring_c.html#a27">cstring_free</a> (uname);
03196   <font class="keywordflow">return</font> (ret);
03197 }
03198 
03199 <font class="preprocessor"># ifndef NOLCL</font>
03200 <font class="preprocessor"></font>uentry
<a name="l03201"></a><a class="code" href="uentry_c.html#a122">03201</a> <a class="code" href="uentry_c.html#a122">uentry_makeEnumTag</a> (cstring n, ctype t, fileloc loc)<font class="keyword"></font>
03202 <font class="keyword"></font>{
03203   cstring ename = <a class="code" href="structNames_c.html#a10">makeEnum</a> (n);
03204   uentry ret = uentry_makeTagAux (ename, t, loc, FALSE, KENUMTAG);
03205 
03206   <a class="code" href="cstring_c.html#a27">cstring_free</a> (ename);
03207   <font class="keywordflow">return</font> ret;
03208 }
03209 <font class="preprocessor"># endif</font>
03210 <font class="preprocessor"></font>
03211 uentry
<a name="l03212"></a><a class="code" href="uentry_c.html#a123">03212</a> <a class="code" href="uentry_c.html#a123">uentry_makeUnionTagLoc</a> (cstring n, ctype t)<font class="keyword"></font>
03213 <font class="keyword"></font>{
03214   cstring uname = <a class="code" href="structNames_c.html#a9">makeUnion</a> (n);
03215   uentry ret = uentry_makeTagAux (uname, t, setLocation (), FALSE, KUNIONTAG);
03216 
03217   <a class="code" href="cstring_c.html#a27">cstring_free</a> (uname);
03218   <font class="keywordflow">return</font> ret;
03219 }
03220 
03221 uentry
<a name="l03222"></a><a class="code" href="uentry_c.html#a124">03222</a> <a class="code" href="uentry_c.html#a124">uentry_makeEnumTagLoc</a> (cstring n, ctype t)<font class="keyword"></font>
03223 <font class="keyword"></font>{
03224   cstring ename = <a class="code" href="structNames_c.html#a10">makeEnum</a> (n);
03225   uentry ret = uentry_makeTagAux (ename, t, setLocation (), FALSE, KENUMTAG);
03226 
03227   <a class="code" href="cstring_c.html#a27">cstring_free</a> (ename);
03228   <font class="keywordflow">return</font> ret;
03229 }
03230 
03231 <font class="keywordtype">bool</font> 
<a name="l03232"></a><a class="code" href="uentry_c.html#a125">03232</a> <a class="code" href="uentry_c.html#a125">uentry_isStructTag</a> (uentry ue)<font class="keyword"> </font>
03233 <font class="keyword"></font>{
03234   <font class="keywordflow">return</font> (uentry_isValid (ue) &amp;&amp; ue-&gt;ukind == KSTRUCTTAG);
03235 }
03236 
03237 <font class="keywordtype">bool</font> 
<a name="l03238"></a><a class="code" href="uentry_c.html#a126">03238</a> <a class="code" href="uentry_c.html#a126">uentry_isUnionTag</a> (uentry ue)<font class="keyword"> </font>
03239 <font class="keyword"></font>{
03240   <font class="keywordflow">return</font> (uentry_isValid (ue) &amp;&amp; ue-&gt;ukind == KUNIONTAG);
03241 }
03242 
03243 <font class="keywordtype">bool</font> 
<a name="l03244"></a><a class="code" href="uentry_c.html#a127">03244</a> <a class="code" href="uentry_c.html#a127">uentry_isEnumTag</a> (uentry ue)<font class="keyword"> </font>
03245 <font class="keyword"></font>{
03246   <font class="keywordflow">return</font> (uentry_isValid (ue) &amp;&amp; ue-&gt;ukind == KENUMTAG);
03247 }
03248 
03249 <font class="keywordtype">bool</font>
<a name="l03250"></a><a class="code" href="uentry_c.html#a128">03250</a> <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (uentry ue)<font class="keyword"></font>
03251 <font class="keyword"></font>{
03252   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a125">uentry_isStructTag</a> (ue) 
03253           || <a class="code" href="uentry_c.html#a126">uentry_isUnionTag</a> (ue)
03254           || <a class="code" href="uentry_c.html#a127">uentry_isEnumTag</a> (ue));
03255 }
03256 
03257 <font class="keyword">static</font> <font class="comment">/*@unchecked@*/</font> <font class="comment">/*@only@*/</font> uentry emarker = NULL;
03258 
<a name="l03259"></a><a class="code" href="uentry_c.html#a129">03259</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a129">uentry_destroyMod</a> (<font class="keywordtype">void</font>)
03260    <font class="comment">/*@globals killed emarker@*/</font> <font class="comment">/*@modifies emarker@*/</font>
03261 {
03262   <font class="keyword">static</font> <font class="keywordtype">bool</font> wasDestroyed = FALSE;
03263 
03264   llassert (!wasDestroyed);
03265 
03266   <font class="keywordflow">if</font> (emarker != NULL)
03267     {
03268       uentry_reallyFree (emarker);
03269     }
03270 
03271   wasDestroyed = TRUE;
03272 }
03273 
03274 uentry
<a name="l03275"></a><a class="code" href="uentry_c.html#a130">03275</a> <a class="code" href="uentry_c.html#a130">uentry_makeElipsisMarker</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
03276 <font class="keyword"></font>{
03277   <font class="keywordflow">if</font> (emarker == NULL)
03278     {
03279       emarker = uentry_alloc ();
03280 
03281       emarker-&gt;ukind = KELIPSMARKER;
03282       emarker-&gt;uname = cstring_makeLiteral (<font class="stringliteral">"..."</font>);
03283       emarker-&gt;utype = ctype_elipsMarker;
03284       emarker-&gt;sref  = sRef_undefined;
03285       emarker-&gt;storageclass = SCNONE;
03286       emarker-&gt;used = FALSE;
03287       emarker-&gt;lset = FALSE;
03288       emarker-&gt;info = NULL;
03289 
03290       uentry_setSpecDef (emarker, fileloc_undefined);
03291       emarker-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03292       emarker-&gt;isPrivate = FALSE;
03293       emarker-&gt;hasNameError = FALSE;
03294     }
03295 
03296   <font class="comment">/*@ignore@*/</font> <font class="keywordflow">return</font> (emarker); <font class="comment">/*@end@*/</font>
03297 } 
03298 
03299 <font class="comment">/*</font>
03300 <font class="comment">** comparisons</font>
03301 <font class="comment">*/</font>
03302 
03303 <font class="keywordtype">bool</font>
<a name="l03304"></a><a class="code" href="uentry_c.html#a131">03304</a> <a class="code" href="uentry_c.html#a131">uentry_equiv</a> (uentry p1, uentry p2)<font class="keyword"></font>
03305 <font class="keyword"></font>{
03306   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a135">uentry_compare</a> (p1, p2) != 0)
03307     {
03308       <font class="keywordflow">return</font> FALSE;
03309     }
03310   <font class="keywordflow">else</font>
03311     {
03312       <font class="keywordflow">return</font> TRUE;
03313     }
03314 }
03315 
03316 <font class="keywordtype">int</font>
<a name="l03317"></a><a class="code" href="uentry_c.html#a132">03317</a> <a class="code" href="uentry_c.html#a132">uentry_xcomparealpha</a> (uentry *p1, uentry *p2)<font class="keyword"></font>
03318 <font class="keyword"></font>{
03319   <font class="keywordtype">int</font> res;
03320 
03321   <font class="keywordflow">if</font> ((res = <a class="code" href="uentry_c.html#a135">uentry_compare</a> (*p1, *p2)) == 0) {
03322     <font class="keywordflow">if</font> ((*p1 != NULL) &amp;&amp; (*p2 != NULL)) {
03323       res = <a class="code" href="cstring_c.html#a25">cstring_compare</a> ((*p1)-&gt;uname,
03324                              (*p2)-&gt;uname);
03325     }
03326   }
03327 
03328   <font class="keywordflow">return</font> res;
03329 }
03330 
03331 <font class="keywordtype">int</font>
<a name="l03332"></a><a class="code" href="uentry_c.html#a133">03332</a> <a class="code" href="uentry_c.html#a133">uentry_xcompareuses</a> (uentry *p1, uentry *p2)<font class="keyword"></font>
03333 <font class="keyword"></font>{
03334   uentry u1 = *p1;
03335   uentry u2 = *p2;
03336 
03337   <font class="keywordflow">if</font> (uentry_isValid (u1))
03338     {
03339       <font class="keywordflow">if</font> (uentry_isValid (u2))
03340         {
03341           <font class="keywordflow">return</font> (-1 * int_compare (filelocList_size (u1-&gt;uses), 
03342                                     filelocList_size (u2-&gt;uses)));
03343         }
03344       <font class="keywordflow">else</font>
03345         {
03346           <font class="keywordflow">return</font> 1;
03347         }
03348     }
03349   <font class="keywordflow">else</font>
03350     {
03351       <font class="keywordflow">if</font> (uentry_isValid (u2))
03352         {
03353           <font class="keywordflow">return</font> -1;
03354         }
03355       <font class="keywordflow">else</font>
03356         {
03357           <font class="keywordflow">return</font> 0;
03358         }
03359     }
03360 }
03361 
03362 <font class="keywordtype">int</font> 
<a name="l03363"></a><a class="code" href="uentry_c.html#a134">03363</a> <a class="code" href="uentry_c.html#a134">uentry_compareStrict</a> (uentry v1, uentry v2)<font class="keyword"></font>
03364 <font class="keyword"></font>{
03365   COMPARERETURN (uentry_compare (v1, v2));
03366 
03367   <font class="keywordflow">if</font> (v1 != v2 &amp;&amp; uentry_isValid (v1) &amp;&amp; uentry_isValid (v2))
03368     {
03369       COMPARERETURN (fileloc_compare (v1-&gt;whereDeclared, v2-&gt;whereDeclared));
03370       COMPARERETURN (fileloc_compare (v1-&gt;whereDefined, v2-&gt;whereDefined));
03371       COMPARERETURN (fileloc_compare (v1-&gt;whereSpecified, v2-&gt;whereSpecified));
03372     }
03373 
03374   <font class="keywordflow">return</font> 0;
03375 }
03376 
03377 <font class="keywordtype">int</font>
<a name="l03378"></a><a class="code" href="uentry_c.html#a135">03378</a> <a class="code" href="uentry_c.html#a135">uentry_compare</a> (uentry u1, uentry u2)<font class="keyword"></font>
03379 <font class="keyword"></font>{
03380   <font class="keywordflow">if</font> (u1 == u2) <font class="keywordflow">return</font> 0;
03381   
03382   <font class="keywordflow">if</font> (uentry_isInvalid (u1)) <font class="keywordflow">return</font> -1;
03383   <font class="keywordflow">if</font> (uentry_isInvalid (u2)) <font class="keywordflow">return</font> 1;
03384 
03385   INTCOMPARERETURN (u1-&gt;ukind, u2-&gt;ukind);
03386   COMPARERETURN (ctype_compare (u1-&gt;utype, u2-&gt;utype));
03387   COMPARERETURN (bool_compare (uentry_isPriv (u1), uentry_isPriv (u2)));
03388 
03389   COMPARERETURN (sRef_compare (u1-&gt;sref, u2-&gt;sref));
03390 
03391   <font class="keywordflow">switch</font> (u1-&gt;ukind)
03392     {
03393     <font class="keywordflow">case</font> KINVALID:
03394     <font class="keywordflow">case</font> KELIPSMARKER:
03395       <font class="comment">/* bug detected by lclint:  </font>
03396 <font class="comment">      ** uentry.c:753,14: Return value type bool does not match declared type int: TRUE </font>
03397 <font class="comment">      */</font>
03398       <font class="keywordflow">return</font> 0;
03399     <font class="keywordflow">case</font> KENUMCONST:
03400     <font class="keywordflow">case</font> KCONST:
03401       <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a19">multiVal_compare</a> (u1-&gt;info-&gt;uconst-&gt;val,
03402                                 u2-&gt;info-&gt;uconst-&gt;val));
03403     <font class="keywordflow">case</font> KSTRUCTTAG: 
03404     <font class="keywordflow">case</font> KUNIONTAG: 
03405     <font class="keywordflow">case</font> KENUMTAG: 
03406       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a43">ctype_compare</a> (u1-&gt;info-&gt;datatype-&gt;type, u2-&gt;info-&gt;datatype-&gt;type));
03407     <font class="keywordflow">case</font> KITER:
03408       COMPARERETURN (typeIdSet_compare (uentry_accessType (u1), 
03409                                          <a class="code" href="uentry_c.html#a158">uentry_accessType</a> (u2)));
03410       <font class="keywordflow">return</font> (<a class="code" href="uentryList_c.html#a18">uentryList_compareParams</a> (uentry_getParams (u1), 
03411                                         <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (u2)));
03412     <font class="keywordflow">case</font> KENDITER:
03413       <font class="keywordflow">return</font> (<a class="code" href="typeIdSet_c.html#a22">typeIdSet_compare</a> (uentry_accessType (u1), 
03414                                   <a class="code" href="uentry_c.html#a158">uentry_accessType</a> (u2)));
03415     <font class="keywordflow">case</font> KFCN:
03416       COMPARERETURN (typeIdSet_compare (uentry_accessType (u1), 
03417                                          <a class="code" href="uentry_c.html#a158">uentry_accessType</a> (u2)));
03418       COMPARERETURN (globSet_compare (uentry_getGlobs (u1), 
03419                                       <a class="code" href="uentry_c.html#a189">uentry_getGlobs</a> (u2)));
03420       COMPARERETURN (uentryList_compareParams (uentry_getParams (u1), 
03421                                                <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (u2)));
03422       COMPARERETURN (generic_compare (u1-&gt;info-&gt;fcn-&gt;specialCode,
03423                                        u2-&gt;info-&gt;fcn-&gt;specialCode));
03424       COMPARERETURN (generic_compare (u1-&gt;info-&gt;fcn-&gt;nullPred,
03425                                        u2-&gt;info-&gt;fcn-&gt;nullPred));
03426 
03427       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a45">sRefSet_compare</a> (uentry_getMods (u1), <a class="code" href="uentry_c.html#a190">uentry_getMods</a> (u2)));
03428     <font class="keywordflow">case</font> KVAR:
03429       COMPARERETURN (generic_compare (u1-&gt;info-&gt;var-&gt;kind, u2-&gt;info-&gt;var-&gt;kind));
03430       COMPARERETURN (generic_compare (sRef_getOrigAliasKind (u1-&gt;sref),
03431                                       sRef_getOrigAliasKind (u2-&gt;sref)));
03432       COMPARERETURN (generic_compare (sRef_getOrigExKind (u1-&gt;sref),
03433                                       <a class="code" href="sRef_c.html#a189">sRef_getOrigExKind</a> (u2-&gt;sref)));
03434       COMPARERETURN (generic_compare (u1-&gt;info-&gt;var-&gt;checked,
03435                                       u2-&gt;info-&gt;var-&gt;checked));
03436       COMPARERETURN (generic_compare (u1-&gt;info-&gt;var-&gt;defstate, 
03437                                       u2-&gt;info-&gt;var-&gt;defstate));
03438       <font class="keywordflow">return</font>        (generic_compare (u1-&gt;info-&gt;var-&gt;nullstate, 
03439                                       u2-&gt;info-&gt;var-&gt;nullstate));
03440     <font class="keywordflow">case</font> KDATATYPE:
03441       COMPARERETURN (ctype_compare (u1-&gt;info-&gt;datatype-&gt;type,
03442                                     u2-&gt;info-&gt;datatype-&gt;type));
03443       COMPARERETURN (ynm_compare (u1-&gt;info-&gt;datatype-&gt;mut,
03444                                   u2-&gt;info-&gt;datatype-&gt;mut));
03445       <font class="keywordflow">return</font> (<a class="code" href="ynm_c.html#a1">ynm_compare</a> (u1-&gt;info-&gt;datatype-&gt;abs, u2-&gt;info-&gt;datatype-&gt;abs));
03446     }
03447   
03448   BADEXIT;
03449 }
03450 
03451 <font class="comment">/*</font>
03452 <font class="comment">** library format:</font>
03453 <font class="comment">**</font>
03454 <font class="comment">** all entries are: &lt;type&gt;[@&lt;info&gt;]*#&lt;name&gt;</font>
03455 <font class="comment">**</font>
03456 <font class="comment">** info depends on kind:</font>
03457 <font class="comment">*/</font>
03458 
03459 <font class="keyword">static</font> <font class="keywordtype">void</font>
03460 advanceField (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
03461 <font class="keyword"></font>{
03462   checkChar (s, <font class="charliteral">'@'</font>);
03463 }
03464 
03465 <font class="keyword">static</font> <font class="keywordtype">void</font>
03466 advanceName (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
03467 <font class="keyword"></font>{
03468   checkChar (s, <font class="charliteral">'#'</font>);
03469 }
03470 
03471 <font class="keyword">static</font> vkind
03472 vkind_fromInt (<font class="keywordtype">int</font> i)<font class="keyword"></font>
03473 <font class="keyword"></font>{
03474   <font class="keywordflow">if</font> <font class="comment">/*@+enumint@*/</font> (i &lt; VKFIRST || i &gt; VKLAST) <font class="comment">/*@=enumint@*/</font>
03475     {
03476       llbuglit (<font class="stringliteral">"vkind_fromInt: out of range"</font>);
03477     }
03478 
03479   <font class="keywordflow">return</font> (vkind)i;
03480 }
03481 
03482 <font class="keyword">static</font> uentry  
03483   uentry_makeConstantBase (<font class="comment">/*@only@*/</font> cstring name, ctype ct, 
03484                            typeIdSet access, nstate nullstate,
03485                            <font class="comment">/*@keep@*/</font> fileloc loc, <font class="comment">/*@only@*/</font> multiVal m)<font class="keyword"></font>
03486 <font class="keyword"></font>{
03487   uentry e = uentry_alloc ();
03488   
03489   e-&gt;ukind = KCONST;
03490   e-&gt;uname = name;
03491   e-&gt;utype = ct;
03492   e-&gt;sref  = <a class="code" href="sRef_c.html#a286">sRef_makeConst</a> (ct);
03493 
03494   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (e-&gt;sref, nullstate, loc);
03495   e-&gt;storageclass = SCNONE;
03496 
03497   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03498     {
03499       e-&gt;whereSpecified = loc;
03500       e-&gt;whereDeclared = fileloc_undefined;
03501     }
03502   <font class="keywordflow">else</font>
03503     {
03504       e-&gt;whereSpecified = fileloc_undefined;
03505       e-&gt;whereDeclared = loc;
03506     }
03507 
03508   e-&gt;whereDefined = fileloc_undefined;
03509   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03510   e-&gt;isPrivate = FALSE;
03511   e-&gt;hasNameError = FALSE;
03512 
03513   e-&gt;used = FALSE;
03514   e-&gt;lset = FALSE;
03515 
03516   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03517   e-&gt;info-&gt;uconst = (ucinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;uconst));
03518   e-&gt;info-&gt;uconst-&gt;val = m;
03519   e-&gt;info-&gt;uconst-&gt;access = access;
03520 
03521   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03522 
03523   <font class="keywordflow">return</font> (e);
03524 }
03525 
03526 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry  
03527   uentry_makeVariableBase (<font class="comment">/*@only@*/</font> cstring name, ctype ct, vkind kind, 
03528                            sstate defstate, nstate isnull, alkind aliased,
03529                            exkind exp, chkind checked, 
03530                            <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03531 <font class="keyword"></font>{
03532   uentry e = uentry_alloc ();
03533 
03534   e-&gt;ukind = KVAR;
03535   e-&gt;uname = name;
03536   e-&gt;utype = ct;
03537   e-&gt;storageclass = SCNONE;
03538 
03539   e-&gt;sref  = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ct);
03540   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (e-&gt;sref, isnull, loc);
03541 
03542   e-&gt;whereDefined = fileloc_undefined;
03543 
03544   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03545     {
03546       e-&gt;whereSpecified = loc;
03547       e-&gt;whereDeclared = fileloc_undefined;
03548     }
03549   <font class="keywordflow">else</font>
03550     {
03551       e-&gt;whereSpecified = fileloc_undefined;
03552       e-&gt;whereDeclared = loc;
03553     }
03554 
03555   e-&gt;isPrivate = FALSE;
03556   e-&gt;hasNameError = FALSE;
03557 
03558   e-&gt;used = FALSE;
03559   e-&gt;lset = FALSE;
03560 
03561   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03562 
03563   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03564   e-&gt;info-&gt;var = (uvinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;var));
03565   e-&gt;info-&gt;var-&gt;kind = kind;
03566   e-&gt;info-&gt;var-&gt;checked = checked;
03567   e-&gt;info-&gt;var-&gt;defstate = defstate;
03568 
03569   <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (e-&gt;sref, defstate, loc);
03570 
03571   e-&gt;info-&gt;var-&gt;nullstate = sRef_getNullState (e-&gt;sref);
03572 
03573   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (e-&gt;sref, exp, loc);
03574   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, aliased, loc);
03575 
03576   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03577   <font class="keywordflow">return</font> (e);
03578 }
03579 
03580 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry  
03581 uentry_makeDatatypeBase (<font class="comment">/*@only@*/</font> cstring name, ctype ct, ynm abs, 
03582                          ynm mut, ctype rtype, alkind ak, exkind exp, 
03583                          sstate defstate, nstate isnull,
03584                          <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03585 <font class="keyword"></font>{
03586   uentry e = uentry_alloc ();
03587 
03588   e-&gt;ukind = KDATATYPE;
03589   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03590   e-&gt;uname = name;
03591   e-&gt;utype = ct;
03592   e-&gt;storageclass = SCNONE;
03593   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03594 
03595   <font class="comment">/*</font>
03596 <font class="comment">  ** This is only setting null state.  (I think?)</font>
03597 <font class="comment">  */</font>
03598 
03599   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ct))
03600     {
03601       uentry te = <a class="code" href="usymtab_c.html#a72">usymtab_getTypeEntrySafe</a> (ctype_typeId (ct));
03602 
03603       <font class="keywordflow">if</font> (uentry_isValid (te))
03604         {
03605           <a class="code" href="sRef_c.html#a266">sRef_setStateFromUentry</a> (e-&gt;sref, te);
03606         }
03607       <font class="keywordflow">else</font>
03608         {
03609           <font class="comment">/* problem for recursive type definitions */</font>
03610         }
03611     }
03612   
03613   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, ak, loc);
03614   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (e-&gt;sref, exp, loc);
03615 
03616   <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (e-&gt;sref, defstate, loc);
03617 
03618   <font class="keywordflow">if</font> (ynm_isOn (abs) &amp;&amp; ctype_isUnknown (ct) &amp;&amp; isnull == NS_UNKNOWN)
03619     {
03620       isnull = NS_ABSNULL;
03621     }
03622 
03623   <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (e-&gt;sref, isnull);
03624 
03625   e-&gt;whereDefined = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (loc); <font class="comment">/*&lt; bogus!  (but necessary for lexer) &gt;*/</font>
03626 
03627   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03628     {
03629       e-&gt;whereSpecified = loc;
03630       e-&gt;whereDeclared = fileloc_undefined;
03631     }
03632   <font class="keywordflow">else</font>
03633     {
03634       e-&gt;whereSpecified = fileloc_undefined;
03635       e-&gt;whereDeclared = loc;
03636     }
03637   
03638   e-&gt;isPrivate = FALSE;
03639   e-&gt;hasNameError = FALSE;
03640 
03641   e-&gt;used = FALSE;
03642   e-&gt;lset = FALSE;
03643   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03644 
03645   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03646   e-&gt;info-&gt;datatype = (udinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;datatype));
03647   e-&gt;info-&gt;datatype-&gt;abs = abs;
03648   e-&gt;info-&gt;datatype-&gt;mut = mut;
03649   e-&gt;info-&gt;datatype-&gt;type = rtype;
03650   
03651   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03652 
03653   <font class="keywordflow">return</font> (e);
03654 }
03655 
03656 <font class="preprocessor"># ifndef NOLCL</font>
03657 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setHasGlobs (uentry ue)<font class="keyword"></font>
03658 <font class="keyword"></font>{
03659   llassert (uentry_isFunction (ue));
03660 
03661   ue-&gt;info-&gt;fcn-&gt;hasGlobs = TRUE;
03662 }
03663 
03664 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_setHasMods (uentry ue)<font class="keyword"></font>
03665 <font class="keyword"></font>{
03666   llassert (uentry_isFunction (ue));
03667 
03668   ue-&gt;info-&gt;fcn-&gt;hasMods = TRUE;
03669 }
03670 <font class="preprocessor"># endif</font>
03671 <font class="preprocessor"></font>
<a name="l03672"></a><a class="code" href="uentry_c.html#a142">03672</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a142">uentry_hasGlobs</a> (uentry ue)<font class="keyword"></font>
03673 <font class="keyword"></font>{
03674   <font class="keywordflow">if</font> (uentry_isFunction (ue))
03675     {
03676       <font class="keywordflow">return</font> (ue-&gt;info-&gt;fcn-&gt;hasGlobs);
03677     }
03678 
03679   <font class="keywordflow">return</font> FALSE;
03680 }
03681 
<a name="l03682"></a><a class="code" href="uentry_c.html#a143">03682</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a143">uentry_hasSpecialClauses</a> (uentry ue)<font class="keyword"></font>
03683 <font class="keyword"></font>{
03684   <font class="keywordflow">return</font> (uentry_isFunction (ue) &amp;&amp; specialClauses_isDefined (ue-&gt;info-&gt;fcn-&gt;specclauses));
03685 }
03686 
<a name="l03687"></a><a class="code" href="uentry_c.html#a144">03687</a> specialClauses <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (uentry ue)<font class="keyword"></font>
03688 <font class="keyword"></font>{
03689   llassert (uentry_isFunction (ue));
03690   <font class="keywordflow">return</font> ue-&gt;info-&gt;fcn-&gt;specclauses;
03691 }
03692 
<a name="l03693"></a><a class="code" href="uentry_c.html#a145">03693</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a145">uentry_hasMods</a> (uentry ue)<font class="keyword"></font>
03694 <font class="keyword"></font>{
03695   <font class="keywordflow">if</font> (uentry_isFunction (ue))
03696     {
03697       <font class="keywordflow">return</font> (ue-&gt;info-&gt;fcn-&gt;hasMods);
03698     }
03699 
03700   <font class="keywordflow">return</font> FALSE;
03701 }
03702 
03703 <font class="keyword">static</font> uentry  
03704   uentry_makeFunctionBase (<font class="comment">/*@only@*/</font> cstring name, ctype ct, 
03705                            typeIdSet access, 
03706                            <font class="keywordtype">bool</font> hasGlobs, <font class="comment">/*@only@*/</font> globSet globs, 
03707                            <font class="keywordtype">bool</font> hasMods, <font class="comment">/*@only@*/</font> sRefSet mods, 
03708                            alkind ak, exkind exp, 
03709                            sstate defstate, nstate isnull,
03710                            exitkind exitCode,
03711                            specCode sCode,
03712                            qual nullPred,
03713                            <font class="comment">/*@only@*/</font> specialClauses specclauses,
03714                            <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03715 <font class="keyword"></font>{
03716   uentry e = uentry_alloc ();
03717   ctype ret;
03718 
03719   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03720   e-&gt;ukind = KFCN;
03721   e-&gt;uname = name;
03722   e-&gt;utype = ct;
03723   e-&gt;storageclass = SCNONE;
03724 
03725   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
03726     {
03727       ret = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ct);
03728     }
03729   <font class="keywordflow">else</font>
03730     {
03731       <font class="keywordflow">if</font> (ctype_isKnown (ct))
03732         {
03733           llbug (message (<font class="stringliteral">"not function: %s"</font>, ctype_unparse (ct)));
03734         }
03735 
03736       ret = ctype_unknown;
03737     }
03738 
03739   e-&gt;sref  = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ret);
03740 
03741   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ret))
03742     {
03743       <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (e-&gt;sref, ret);
03744     }
03745 
03746   <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (e-&gt;sref, loc);
03747   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (e-&gt;sref, isnull, loc);
03748 
03749   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, ak, loc);
03750   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (e-&gt;sref, exp, loc);
03751   <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (e-&gt;sref, defstate, loc);
03752 
03753   e-&gt;whereSpecified = loc;
03754   e-&gt;whereDefined = fileloc_undefined;
03755 
03756   e-&gt;isPrivate = FALSE;
03757   e-&gt;hasNameError = FALSE;
03758 
03759   e-&gt;used = FALSE;
03760   e-&gt;lset = FALSE;
03761   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();  
03762 
03763   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03764   e-&gt;info-&gt;fcn = (ufinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;fcn));
03765   
03766   e-&gt;info-&gt;fcn-&gt;exitCode = exitCode;
03767   e-&gt;info-&gt;fcn-&gt;specialCode = sCode;
03768   e-&gt;info-&gt;fcn-&gt;nullPred = nullPred;
03769   e-&gt;info-&gt;fcn-&gt;access = access;
03770 
03771   e-&gt;info-&gt;fcn-&gt;specclauses = specclauses;
03772   e-&gt;info-&gt;fcn-&gt;hasGlobs = hasGlobs;
03773   e-&gt;info-&gt;fcn-&gt;globs = globs;
03774 
03775   e-&gt;info-&gt;fcn-&gt;hasMods = hasMods;
03776   e-&gt;info-&gt;fcn-&gt;mods = mods;
03777 
03778   e-&gt;info-&gt;fcn-&gt;defparams = uentryList_undefined; 
03779   e-&gt;whereDeclared = fileloc_undefined;
03780 
03781   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03782 
03783   <font class="keywordflow">return</font> (e);
03784 }
03785 
03786 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry  
03787   uentry_makeTagBase (<font class="comment">/*@only@*/</font> cstring name, ekind tagkind, 
03788                       ctype ct, ctype rtype, <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03789 <font class="keyword"></font>{
03790   uentry e = uentry_alloc ();
03791   
03792   <font class="keywordflow">if</font> (tagkind != KSTRUCTTAG &amp;&amp; tagkind != KUNIONTAG &amp;&amp; tagkind != KENUMTAG)
03793     {
03794       llbuglit (<font class="stringliteral">"uentry_makeTagBase: not a tag type"</font>);
03795     }
03796 
03797   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03798   e-&gt;ukind = tagkind;
03799   e-&gt;uname = name;
03800   e-&gt;utype = ct;
03801   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03802   e-&gt;storageclass = SCNONE;
03803 
03804   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03805     {
03806       e-&gt;whereSpecified = loc;
03807       e-&gt;whereDeclared = fileloc_undefined;
03808     }
03809   <font class="keywordflow">else</font>
03810     {
03811       e-&gt;whereDeclared = loc;
03812       e-&gt;whereSpecified = fileloc_undefined;
03813     }
03814 
03815   e-&gt;whereDefined = fileloc_undefined;
03816 
03817   e-&gt;isPrivate = FALSE;
03818   e-&gt;hasNameError = FALSE;
03819 
03820   e-&gt;used = FALSE;
03821   e-&gt;lset = FALSE;
03822   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03823 
03824   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03825   e-&gt;info-&gt;datatype = (udinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;datatype));
03826   e-&gt;info-&gt;datatype-&gt;abs  = NO;
03827   e-&gt;info-&gt;datatype-&gt;mut  = MAYBE;
03828   e-&gt;info-&gt;datatype-&gt;type = rtype;
03829 
03830   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03831 
03832   <font class="keywordflow">return</font> (e);  
03833 }
03834 
03835 <font class="keyword">static</font> uentry  
03836   uentry_makeIterBase (<font class="comment">/*@only@*/</font> cstring name, typeIdSet access, 
03837                        ctype ct, <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03838 <font class="keyword"></font>{
03839   uentry e = uentry_alloc ();
03840   
03841   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03842   e-&gt;ukind = KITER;
03843   e-&gt;uname = name;
03844   e-&gt;utype = ct;
03845   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03846   e-&gt;storageclass = SCNONE;
03847 
03848   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03849     {
03850       e-&gt;whereSpecified = loc;
03851       e-&gt;whereDeclared = fileloc_undefined;
03852     }
03853   <font class="keywordflow">else</font>
03854     {
03855       e-&gt;whereDeclared = loc;
03856       e-&gt;whereSpecified = fileloc_undefined;
03857     }
03858 
03859   e-&gt;whereDefined = fileloc_undefined;
03860   
03861   e-&gt;isPrivate = FALSE;
03862   e-&gt;hasNameError = FALSE;
03863 
03864   e-&gt;used = FALSE;
03865   e-&gt;lset = FALSE;
03866   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03867 
03868   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03869   e-&gt;info-&gt;iter = (uiinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;iter));
03870   e-&gt;info-&gt;iter-&gt;access = access;
03871   e-&gt;info-&gt;iter-&gt;mods = sRefSet_undefined;
03872   e-&gt;info-&gt;iter-&gt;globs = globSet_undefined;
03873   
03874   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03875   <font class="keywordflow">return</font> (e);
03876 }
03877 
03878 <font class="keyword">static</font> uentry  
03879   uentry_makeEndIterBase (<font class="comment">/*@only@*/</font> cstring name, typeIdSet access, 
03880                           <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
03881 <font class="keyword"></font>{
03882   uentry e = uentry_alloc ();
03883 
03884   <font class="comment">/* e-&gt;shallowCopy = FALSE; */</font>
03885   e-&gt;ukind = KENDITER;
03886   e-&gt;storageclass = SCNONE;
03887   e-&gt;uname = name;
03888   e-&gt;utype = ctype_unknown;
03889   e-&gt;sref  = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
03890   
03891   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (loc))
03892     {
03893       e-&gt;whereSpecified = loc;
03894       e-&gt;whereDeclared = fileloc_undefined;
03895     }
03896   <font class="keywordflow">else</font>
03897     {
03898       e-&gt;whereDeclared = loc;
03899       e-&gt;whereSpecified = fileloc_undefined;
03900     }
03901 
03902   e-&gt;whereDefined = fileloc_undefined;
03903 
03904   e-&gt;isPrivate = FALSE;
03905   e-&gt;hasNameError = FALSE;
03906 
03907   e-&gt;used = FALSE;
03908   e-&gt;lset = FALSE;
03909   e-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
03910 
03911   e-&gt;info = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info));
03912   e-&gt;info-&gt;enditer = (ueinfo) dmalloc (<font class="keyword">sizeof</font> (*e-&gt;info-&gt;enditer));
03913   e-&gt;info-&gt;enditer-&gt;access = access;
03914   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (e-&gt;sref);
03915 
03916   <font class="keywordflow">return</font> (e);
03917 }
03918 
<a name="l03919"></a><a class="code" href="uentry_c.html#a150">03919</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a150">uentry_markFree</a> (<font class="comment">/*@unused@*/</font> <font class="comment">/*@owned@*/</font> uentry u)<font class="keyword"></font>
03920 <font class="keyword"></font>{
03921   <font class="comment">/* should save u */</font>
03922 <font class="comment">/*@-mustfree@*/</font>
03923 }
03924 <font class="comment">/*@=mustfree@*/</font>
03925 
03926 <font class="comment">/*@only@*/</font> uentry
<a name="l03927"></a><a class="code" href="uentry_c.html#a151">03927</a> <a class="code" href="uentry_c.html#a151">uentry_undump</a> (ekind kind, fileloc loc, <font class="keywordtype">char</font> **s)<font class="keyword"></font>
03928 <font class="keyword"></font>{
03929   uentry ue;
03930   
03931   <font class="keywordflow">if</font> (**s == <font class="charliteral">'!'</font>)
03932     {
03933       checkChar (s, <font class="charliteral">'!'</font>);
03934       checkChar (s, <font class="charliteral">'.'</font>);
03935       ue = <a class="code" href="uentry_c.html#a130">uentry_makeElipsisMarker</a> ();
03936     }
03937   <font class="keywordflow">else</font>
03938     {
03939       ctype ct = <a class="code" href="ctype_c.html#a110">ctype_undump</a> (s);
03940       cstring name;
03941 
03942       <font class="keywordflow">switch</font> (kind)
03943         {
03944         <font class="keywordflow">case</font> KVAR:
03945           {
03946             vkind  tkind;
03947             sstate defstate;
03948             nstate isnull;
03949             alkind aliased;
03950             exkind exp;
03951             chkind checked;
03952             
03953             checkChar (s, <font class="charliteral">'|'</font>);
03954 
03955             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'@'</font>))
03956               {
03957                 tkind = vkind_fromInt (getInt (s));
03958                 checkChar (s, <font class="charliteral">'|'</font>);
03959               }
03960             <font class="keywordflow">else</font>
03961               {
03962                 tkind = VKPARAM;
03963               }
03964 
03965             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'$'</font>))
03966               {
03967                 defstate = SS_UNKNOWN;
03968                 isnull = NS_UNKNOWN;
03969                 aliased = AK_IMPTEMP;
03970                 exp = XO_UNKNOWN;
03971                 checked = CH_UNKNOWN;
03972               }         
03973             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'&amp;'</font>))
03974               {
03975                 defstate = SS_DEFINED;
03976                 isnull = NS_UNKNOWN;
03977                 aliased = AK_IMPTEMP;
03978                 exp = XO_UNKNOWN;
03979                 checked = CH_UNKNOWN;
03980               }         
03981             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'^'</font>))
03982               {
03983                 defstate = SS_UNKNOWN;
03984                 isnull = NS_UNKNOWN;
03985                 aliased = AK_IMPTEMP;
03986                 exp = XO_UNKNOWN;
03987                 checked = CH_UNKNOWN;
03988               }         
03989             <font class="keywordflow">else</font>
03990               {
03991                 defstate = <a class="code" href="varKinds_c.html#a2">sstate_fromInt</a> (getInt (s));      
03992                 advanceField (s); isnull = <a class="code" href="varKinds_c.html#a1">nstate_fromInt</a> (getInt (s));      
03993                 advanceField (s); aliased = <a class="code" href="varKinds_c.html#a0">alkind_fromInt</a> (getInt (s));      
03994 
03995                 <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'&amp;'</font>))
03996                   {
03997                     exp = XO_UNKNOWN;
03998                     checked = CH_UNKNOWN;
03999                   }
04000                 <font class="keywordflow">else</font>
04001                   {
04002                     advanceField (s); exp = <a class="code" href="varKinds_c.html#a3">exkind_fromInt</a> (getInt (s));      
04003                     advanceField (s); checked = (chkind) (<a class="code" href="general_c.html#a16">getInt</a> (s));      
04004                   }
04005               }
04006 
04007             advanceName (s);
04008             name = getStringWord (s);
04009             
04010             ue = uentry_makeVariableBase (name, ct, tkind, defstate, 
04011                                           isnull, aliased, exp, 
04012                                           checked, fileloc_copy (loc));
04013           }
04014           <font class="keywordflow">break</font>;
04015         <font class="keywordflow">case</font> KDATATYPE: 
04016           {
04017             ynm abs;
04018             ynm mut;
04019             ctype rtype;
04020             sstate defstate;
04021             nstate isnull;
04022             alkind aliased;
04023             exkind exp;
04024 
04025             advanceField (s); abs = <a class="code" href="ynm_c.html#a0">ynm_fromCodeChar</a> (loadChar (s));
04026             advanceField (s); mut = <a class="code" href="ynm_c.html#a0">ynm_fromCodeChar</a> (loadChar (s));
04027             advanceField (s); defstate = <a class="code" href="varKinds_c.html#a2">sstate_fromInt</a> (getInt (s));      
04028             advanceField (s); isnull = <a class="code" href="varKinds_c.html#a1">nstate_fromInt</a> (getInt (s));      
04029             advanceField (s); aliased = <a class="code" href="varKinds_c.html#a0">alkind_fromInt</a> (getInt (s));      
04030             advanceField (s); exp = <a class="code" href="varKinds_c.html#a3">exkind_fromInt</a> (getInt (s));      
04031             advanceField (s); rtype = <a class="code" href="ctype_c.html#a110">ctype_undump</a> (s);
04032             advanceName (s); 
04033             name = getStringWord (s);
04034 
04035             ue = uentry_makeDatatypeBase (name, ct, abs, mut, rtype, 
04036                                           aliased, exp, defstate, isnull, 
04037                                           fileloc_copy (loc));
04038           }
04039           <font class="keywordflow">break</font>;
04040         <font class="keywordflow">case</font> KFCN:
04041           {
04042             alkind     ak;
04043             exkind     exp;
04044             sstate     defstate;
04045             nstate     isnull;
04046             exitkind   exitCode;
04047             specCode   specc;
04048             qual       nullPred;
04049             typeIdSet access;
04050             <font class="keywordtype">bool</font>       hasGlobs;
04051             globSet    globs;
04052             <font class="keywordtype">bool</font>       hasMods;
04053             sRefSet    mods;
04054             specialClauses specclauses;
04055 
04056             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'$'</font>))
04057               {
04058                 defstate = SS_DEFINED;
04059                 isnull = NS_UNKNOWN;
04060                 exitCode = XK_UNKNOWN;
04061                 specc = SPC_NONE;
04062                 nullPred = QU_UNKNOWN;
04063               }
04064             <font class="keywordflow">else</font>
04065               {
04066                 advanceField (s); defstate = <a class="code" href="varKinds_c.html#a2">sstate_fromInt</a> (getInt (s)); 
04067                 advanceField (s); isnull = <a class="code" href="varKinds_c.html#a1">nstate_fromInt</a> (getInt (s)); 
04068                 advanceField (s); exitCode = <a class="code" href="varKinds_c.html#a30">exitkind_fromInt</a> (getInt (s)); 
04069                 advanceField (s); specc = specCode_fromInt (getInt (s)); 
04070                 advanceField (s); nullPred = <a class="code" href="qual_c.html#a1">qual_fromInt</a> (getInt (s)); 
04071               }
04072 
04073             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'$'</font>))
04074               {
04075                 hasGlobs = FALSE;
04076                 globs = globSet_undefined;
04077                 hasMods = FALSE;
04078                 mods = sRefSet_undefined;
04079               }
04080             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'^'</font>))
04081               {
04082                 hasGlobs = TRUE;
04083                 globs = globSet_undefined;
04084                 hasMods = TRUE;
04085                 mods = sRefSet_undefined;
04086               }
04087             <font class="keywordflow">else</font>
04088               {
04089                 advanceField (s); hasGlobs = bool_fromInt (getInt (s));
04090                 advanceField (s); globs  = <a class="code" href="globSet_c.html#a10">globSet_undump</a> (s);
04091                 advanceField (s); hasMods = bool_fromInt (getInt (s));
04092                 advanceField (s); mods   = <a class="code" href="sRefSet_c.html#a47">sRefSet_undump</a> (s);      
04093               }
04094 
04095             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'$'</font>))
04096               {
04097                 ak = AK_UNKNOWN;
04098                 exp = XO_UNKNOWN;
04099               }
04100             <font class="keywordflow">else</font>
04101               {
04102                 advanceField (s); ak = <a class="code" href="varKinds_c.html#a0">alkind_fromInt</a> (getInt (s));
04103                 advanceField (s); exp = <a class="code" href="varKinds_c.html#a3">exkind_fromInt</a> (getInt (s));      
04104               }
04105 
04106             advanceField (s); access = <a class="code" href="typeIdSet_c.html#a25">typeIdSet_undump</a> (s);
04107 
04108             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'@'</font>))
04109               {
04110                 specclauses = <a class="code" href="specialClauses_c.html#a34">specialClauses_undump</a> (s);
04111               }
04112             <font class="keywordflow">else</font>
04113               {
04114                 specclauses = specialClauses_undefined; 
04115               }
04116 
04117             advanceName (s);  name = getStringWord (s);
04118 
04119             ue = uentry_makeFunctionBase (name, ct, access, 
04120                                           hasGlobs, globs, 
04121                                           hasMods, mods, 
04122                                           ak, exp, defstate, isnull, 
04123                                           exitCode, specc, nullPred,
04124                                           specclauses,
04125                                           fileloc_copy (loc));
04126             DPRINTF ((<font class="stringliteral">"Undump: %s"</font>, uentry_unparse (ue)));
04127           }
04128           <font class="keywordflow">break</font>;
04129         <font class="keywordflow">case</font> KITER:
04130           {
04131             typeIdSet access;
04132             
04133             advanceField (s); access = <a class="code" href="typeIdSet_c.html#a25">typeIdSet_undump</a> (s);
04134             advanceName (s);  name = getStringWord (s);
04135             
04136             ue = uentry_makeIterBase (name, access, ct,
04137                                       fileloc_copy (loc));
04138           }
04139           <font class="keywordflow">break</font>;
04140         <font class="keywordflow">case</font> KENDITER:
04141           {
04142             typeIdSet access;
04143 
04144             advanceField (s); access = <a class="code" href="typeIdSet_c.html#a25">typeIdSet_undump</a> (s);
04145             advanceName (s);  name = getStringWord (s);
04146             
04147             ue = uentry_makeEndIterBase (name, access, fileloc_copy (loc));
04148           }
04149           <font class="keywordflow">break</font>;
04150         <font class="keywordflow">case</font> KENUMCONST:  
04151         <font class="keywordflow">case</font> KCONST:  
04152           {
04153             typeIdSet access;
04154             multiVal val;
04155             nstate nullstate;
04156 
04157             <font class="keywordflow">if</font> (<a class="code" href="general_c.html#a20">optCheckChar</a> (s, <font class="charliteral">'$'</font>))
04158               {
04159                 val = multiVal_undefined;
04160                 access = typeIdSet_undefined;
04161                 nullstate = NS_UNKNOWN;
04162               }
04163             <font class="keywordflow">else</font>
04164               {
04165                 advanceField (s); val = <a class="code" href="multiVal_c.html#a18">multiVal_undump</a> (s);
04166                 advanceField (s); access = <a class="code" href="typeIdSet_c.html#a25">typeIdSet_undump</a> (s);
04167                 advanceField (s); nullstate = <a class="code" href="varKinds_c.html#a1">nstate_fromInt</a> (getInt (s));
04168               }
04169 
04170             advanceName (s);  name = getStringWord (s);
04171             
04172             ue = uentry_makeConstantBase (name, ct, access,
04173                                           nullstate, fileloc_copy (loc), val);
04174             <font class="keywordflow">break</font>;
04175           }
04176         <font class="keywordflow">case</font> KSTRUCTTAG:
04177         <font class="keywordflow">case</font> KUNIONTAG:
04178         <font class="keywordflow">case</font> KENUMTAG:
04179           {
04180             ctype rtype;
04181             
04182             advanceField (s); rtype = <a class="code" href="ctype_c.html#a110">ctype_undump</a> (s);
04183             advanceName (s);  name = getStringWord (s);
04184             ue = uentry_makeTagBase (name, kind, ct, rtype, fileloc_copy (loc));
04185           }
04186           <font class="keywordflow">break</font>;
04187         <font class="keywordflow">case</font> KINVALID:
04188           llcontbuglit (<font class="stringliteral">"uentry_undump: invalid"</font>);
04189           ue = uentry_undefined;
04190           <font class="keywordflow">break</font>;
04191         <font class="keywordflow">case</font> KELIPSMARKER:
04192           llcontbuglit (<font class="stringliteral">"uentry_undump: elips marker"</font>);
04193           ue = uentry_undefined;
04194           <font class="keywordflow">break</font>;
04195         }
04196     }
04197   
04198   <font class="keywordflow">return</font> (ue);
04199 }
04200 
04201 cstring
<a name="l04202"></a><a class="code" href="uentry_c.html#a152">04202</a> <a class="code" href="uentry_c.html#a152">uentry_dump</a> (uentry v)<font class="keyword"></font>
04203 <font class="keyword"></font>{
04204   <font class="keywordflow">return</font> (uentry_dumpAux (v, FALSE));
04205 }
04206 
04207 cstring
<a name="l04208"></a><a class="code" href="uentry_c.html#a153">04208</a> <a class="code" href="uentry_c.html#a153">uentry_dumpParam</a> (uentry v)<font class="keyword"></font>
04209 <font class="keyword"></font>{
04210   llassertprint (uentry_isVariable (v) || uentry_isElipsisMarker (v),
04211                  (<font class="stringliteral">"dump: %s"</font>, <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (v)));
04212 
04213   <font class="keywordflow">return</font> (uentry_dumpAux (v, TRUE));
04214 }
04215 
04216 <font class="keyword">static</font> cstring
04217 uentry_dumpAux (uentry v, <font class="keywordtype">bool</font> isParam)<font class="keyword"></font>
04218 <font class="keyword"></font>{
04219   llassert (uentry_isValid (v));
04220 
04221   DPRINTF ((<font class="stringliteral">"Dumping entry: %s"</font>, uentry_unparseFull (v)));
04222 
04223   <font class="keywordflow">switch</font> (v-&gt;ukind)
04224     {
04225     <font class="keywordflow">case</font> KINVALID: 
04226       llcontbuglit (<font class="stringliteral">"uentry_dump: invalid entry"</font>); 
04227       <font class="keywordflow">return</font> cstring_undefined;
04228     <font class="keywordflow">case</font> KELIPSMARKER: 
04229       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"!."</font>));
04230     <font class="keywordflow">case</font> KVAR:     
04231       {
04232         cstring sdump;
04233         vkind vk  = v-&gt;info-&gt;var-&gt;kind;
04234         sstate dss = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (v-&gt;sref);
04235         nstate nst = sRef_getNullState (v-&gt;sref);
04236         alkind alk = sRef_getAliasKind (v-&gt;sref);
04237         exkind exk = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (v-&gt;sref);
04238         chkind chk = v-&gt;info-&gt;var-&gt;checked;
04239 
04240         DPRINTF ((<font class="stringliteral">"Dumping var"</font>));
04241 
04242         <font class="keywordflow">if</font> (dss == SS_UNKNOWN
04243             &amp;&amp; nst == NS_UNKNOWN
04244             &amp;&amp; alk == AK_IMPTEMP
04245             &amp;&amp; exk == XO_UNKNOWN
04246             &amp;&amp; chk == CH_UNKNOWN)
04247           {
04248             sdump = cstring_makeLiteral (<font class="stringliteral">"$"</font>);
04249           }
04250         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (dss == SS_DEFINED
04251                  &amp;&amp; nst == NS_UNKNOWN
04252                  &amp;&amp; alk == AK_IMPTEMP
04253                  &amp;&amp; exk == XO_UNKNOWN
04254                  &amp;&amp; chk == CH_UNKNOWN)
04255           {
04256             sdump = cstring_makeLiteral (<font class="stringliteral">"&amp;"</font>);
04257           }
04258         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (dss == SS_UNKNOWN
04259                  &amp;&amp; nst == NS_UNKNOWN
04260                  &amp;&amp; alk == AK_UNKNOWN
04261                  &amp;&amp; exk == XO_UNKNOWN
04262                  &amp;&amp; chk == CH_UNKNOWN)
04263           {
04264             sdump = cstring_makeLiteral (<font class="stringliteral">"^"</font>);
04265           }
04266         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (exk == XO_UNKNOWN
04267                  &amp;&amp; chk == CH_UNKNOWN)
04268           {
04269             sdump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d@%d@%d&amp;"</font>,
04270                              (<font class="keywordtype">int</font>) dss,
04271                              (<font class="keywordtype">int</font>) nst,
04272                              (<font class="keywordtype">int</font>) alk);
04273           }
04274         <font class="keywordflow">else</font>
04275           {
04276             sdump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d@%d@%d@%d@%d"</font>,  
04277                      (<font class="keywordtype">int</font>) dss,
04278                              (<font class="keywordtype">int</font>) nst,
04279                              (<font class="keywordtype">int</font>) alk,
04280                              (<font class="keywordtype">int</font>) exk,
04281                              (<font class="keywordtype">int</font>) chk);
04282           }
04283         
04284 
04285         <font class="keywordflow">if</font> (vk != VKPARAM)
04286           {
04287             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q|@%d|%q#%s"</font>, 
04288                              ctype_dump (v-&gt;utype), 
04289                              (<font class="keywordtype">int</font>) vk,
04290                              sdump,
04291                              isParam ? cstring_undefined : v-&gt;uname));
04292           }
04293         <font class="keywordflow">else</font>
04294           {
04295             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q|%q#%s"</font>, 
04296                              ctype_dump (v-&gt;utype), 
04297                              sdump,
04298                              isParam ? cstring_undefined : v-&gt;uname));
04299           }
04300 
04301       }
04302     <font class="keywordflow">case</font> KDATATYPE: 
04303       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q@%s@%s@%d@%d@%d@%d@%q#%s"</font>, 
04304                        ctype_dump (v-&gt;utype),
04305                        ynm_unparseCode (v-&gt;info-&gt;datatype-&gt;abs),
04306                        ynm_unparseCode (v-&gt;info-&gt;datatype-&gt;mut),
04307                        (<font class="keywordtype">int</font>) <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (v-&gt;sref),
04308                        (<font class="keywordtype">int</font>) sRef_getNullState (v-&gt;sref),
04309                        (<font class="keywordtype">int</font>) sRef_getAliasKind (v-&gt;sref),
04310                        (<font class="keywordtype">int</font>) <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (v-&gt;sref),
04311                        <a class="code" href="ctype_c.html#a111">ctype_dump</a> (v-&gt;info-&gt;datatype-&gt;type),
04312                        v-&gt;uname));
04313     <font class="keywordflow">case</font> KFCN:
04314       {
04315         cstring sdump, gdump, adump;
04316         alkind alk = sRef_getAliasKind (v-&gt;sref);
04317         exkind exk = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (v-&gt;sref);
04318 
04319         <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (v-&gt;sref) == SS_DEFINED
04320             &amp;&amp; !nstate_isKnown (sRef_getNullState (v-&gt;sref))
04321             &amp;&amp; !exitkind_isKnown (v-&gt;info-&gt;fcn-&gt;exitCode)
04322             &amp;&amp; v-&gt;info-&gt;fcn-&gt;specialCode == SPC_NONE
04323             &amp;&amp; v-&gt;info-&gt;fcn-&gt;nullPred == QU_UNKNOWN)
04324           {
04325             sdump = cstring_makeLiteral (<font class="stringliteral">"$"</font>);
04326           }
04327         <font class="keywordflow">else</font>
04328           {
04329             sdump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"@%d@%d@%d@%d@%d"</font>,
04330                              (<font class="keywordtype">int</font>) <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (v-&gt;sref),
04331                              (<font class="keywordtype">int</font>) sRef_getNullState (v-&gt;sref),
04332                              (<font class="keywordtype">int</font>) v-&gt;info-&gt;fcn-&gt;exitCode,
04333                              (<font class="keywordtype">int</font>) v-&gt;info-&gt;fcn-&gt;specialCode,
04334                              (<font class="keywordtype">int</font>) v-&gt;info-&gt;fcn-&gt;nullPred);
04335           }
04336 
04337         <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a142">uentry_hasGlobs</a>(v) &amp;&amp; !<a class="code" href="uentry_c.html#a145">uentry_hasMods</a> (v))
04338           {
04339             gdump = cstring_makeLiteral (<font class="stringliteral">"$"</font>);
04340           }
04341         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a142">uentry_hasGlobs</a> (v) &amp;&amp; globSet_isEmpty (uentry_getGlobs (v))
04342                  &amp;&amp; <a class="code" href="uentry_c.html#a145">uentry_hasMods</a> (v) &amp;&amp; sRefSet_isEmpty (uentry_getMods (v)))
04343           {
04344             gdump = cstring_makeLiteral (<font class="stringliteral">"^"</font>);
04345           }
04346         <font class="keywordflow">else</font>
04347           {
04348             gdump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"@%s@%q@%s@%q"</font>,
04349                              bool_dump (uentry_hasGlobs (v)),
04350                              <a class="code" href="globSet_c.html#a9">globSet_dump</a> (uentry_getGlobs (v)),
04351                              bool_dump (uentry_hasMods (v)),
04352                              <a class="code" href="sRefSet_c.html#a48">sRefSet_dump</a> (uentry_getMods (v)));
04353           }
04354 
04355         <font class="keywordflow">if</font> (alk == AK_UNKNOWN &amp;&amp; exk == XO_UNKNOWN)
04356           {
04357             adump = cstring_makeLiteral (<font class="stringliteral">"$"</font>);
04358           }
04359         <font class="keywordflow">else</font>
04360           {
04361             adump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"@%d@%d"</font>, (<font class="keywordtype">int</font>) alk, (<font class="keywordtype">int</font>) exk);
04362           }
04363 
04364         <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a143">uentry_hasSpecialClauses</a> (v))
04365           {
04366             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q%q%q@%q@%q#%s"</font>,
04367                              ctype_dump (v-&gt;utype),
04368                              sdump,
04369                              gdump,
04370                              adump,
04371                              <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (uentry_accessType (v)),
04372                              <a class="code" href="specialClauses_c.html#a33">specialClauses_dump</a> (v-&gt;info-&gt;fcn-&gt;specclauses),
04373                              v-&gt;uname));
04374           }
04375         <font class="keywordflow">else</font>
04376           {
04377             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q%q%q@%q#%s"</font>,
04378                              ctype_dump (v-&gt;utype),
04379                              sdump,
04380                              gdump,
04381                              adump,
04382                              <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (uentry_accessType (v)),
04383                              v-&gt;uname));
04384           }
04385       }
04386     <font class="keywordflow">case</font> KITER:
04387       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q@%q#%s"</font>,
04388                        ctype_dump (v-&gt;utype),
04389                        <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (v-&gt;info-&gt;iter-&gt;access),
04390                        v-&gt;uname));
04391     <font class="keywordflow">case</font> KENDITER:
04392       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q@%q#%s"</font>,
04393                        ctype_dump (v-&gt;utype),
04394                        <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (uentry_accessType (v)),
04395                        v-&gt;uname));
04396     <font class="keywordflow">case</font> KENUMCONST:  
04397     <font class="keywordflow">case</font> KCONST:  
04398       {
04399         cstring sdump;
04400 
04401         <font class="keywordflow">if</font> (multiVal_isUnknown (v-&gt;info-&gt;uconst-&gt;val)
04402             &amp;&amp; <a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (uentry_accessType (v))
04403             &amp;&amp; (sRef_getNullState (v-&gt;sref) == NS_UNKNOWN))
04404           {
04405             sdump = cstring_makeLiteral (<font class="stringliteral">"$"</font>);
04406           }
04407         <font class="keywordflow">else</font>
04408           {
04409             sdump = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"@%q@%q@%d"</font>,
04410                              multiVal_dump (v-&gt;info-&gt;uconst-&gt;val),
04411                              <a class="code" href="typeIdSet_c.html#a24">typeIdSet_dump</a> (uentry_accessType (v)),
04412                              (<font class="keywordtype">int</font>) sRef_getNullState (v-&gt;sref));
04413           }
04414 
04415         <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q#%s"</font>, 
04416                          ctype_dump (v-&gt;utype), 
04417                          sdump,
04418                          v-&gt;uname));
04419       }
04420     <font class="keywordflow">case</font> KSTRUCTTAG:
04421     <font class="keywordflow">case</font> KUNIONTAG:
04422     <font class="keywordflow">case</font> KENUMTAG:
04423       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q@%q#%s"</font>, 
04424                        ctype_dump (v-&gt;utype), 
04425                        <a class="code" href="ctype_c.html#a111">ctype_dump</a> (v-&gt;info-&gt;datatype-&gt;type), v-&gt;uname));
04426     }
04427 
04428   BADEXIT;
04429 }
04430 
04431 <font class="comment">/*@only@*/</font> cstring
<a name="l04432"></a><a class="code" href="uentry_c.html#a154">04432</a> <a class="code" href="uentry_c.html#a154">uentry_unparseAbbrev</a> (uentry v)<font class="keyword"></font>
04433 <font class="keyword"></font>{
04434   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (v))
04435     {
04436       llcontbuglit (<font class="stringliteral">"uentry_unparseAbbrev: not variable"</font>);
04437       <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (v);
04438     }
04439 
04440   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q"</font>, ctype_unparseDeep (v-&gt;utype), <a class="code" href="uentry_c.html#a195">uentry_getName</a> (v)));
04441 }
04442 
04443 <font class="comment">/*@only@*/</font> cstring
<a name="l04444"></a><a class="code" href="uentry_c.html#a155">04444</a> <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (uentry v)<font class="keyword"></font>
04445 <font class="keyword"></font>{
04446   cstring st;
04447 
04448     <font class="keywordflow">if</font> (uentry_isUndefined (v)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;undefined&gt;"</font>));
04449   <font class="keywordflow">if</font> (uentry_isElipsisMarker (v)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"..."</font>));
04450 
04451   st = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (v);
04452 
04453   <font class="keywordflow">if</font> (cstring_isDefined (st))
04454     {
04455       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a106">ctype_unparseDeclaration</a> (v-&gt;utype, st)); 
04456     }
04457   <font class="keywordflow">else</font>
04458     {
04459       <a class="code" href="cstring_c.html#a27">cstring_free</a> (st);
04460       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (v-&gt;utype)));
04461     }
04462 }
04463 
04464 <font class="comment">/*@only@*/</font> cstring
<a name="l04465"></a><a class="code" href="uentry_c.html#a156">04465</a> <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (uentry v)<font class="keyword"></font>
04466 <font class="keyword"></font>{
04467   <font class="keywordflow">if</font> (uentry_isUndefined (v))
04468     {
04469       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;undefined&gt;"</font>));
04470     }
04471   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (v))
04472     {
04473       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%d] [%s] %s %q : %t [%t] %s %s // %q [s: %q; d: %q]"</font>,
04474                        (<font class="keywordtype">int</font>) v,
04475                        <a class="code" href="ekind_c.html#a1">ekind_unparse</a> (v-&gt;ukind),
04476                        v-&gt;uname,
04477                        <a class="code" href="uentry_c.html#a195">uentry_getName</a> (v),
04478                        v-&gt;utype,
04479                        ctype_isDefined (v-&gt;info-&gt;datatype-&gt;type) 
04480                           ? v-&gt;info-&gt;datatype-&gt;type : ctype_unknown,
04481                        ynm_unparse (v-&gt;info-&gt;datatype-&gt;mut),
04482                        ynm_unparse (v-&gt;info-&gt;datatype-&gt;abs),
04483                        <a class="code" href="sRef_c.html#a171">sRef_unparseState</a> (v-&gt;sref),
04484                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereSpecified),
04485                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDefined)));
04486     }
04487   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isFunction (v))
04488     {
04489       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%w] = [%s] %q : %t / sref: %q / mods: %q / "</font>
04490                        <font class="stringliteral">"globs: %q / [s: %q; decl: %q; def: %q]"</font>,
04491                        (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) v,
04492                        <a class="code" href="ekind_c.html#a1">ekind_unparse</a> (v-&gt;ukind),
04493                        <a class="code" href="uentry_c.html#a195">uentry_getName</a> (v),
04494                        v-&gt;utype,
04495                        <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (v-&gt;sref),
04496                        <a class="code" href="sRefSet_c.html#a35">sRefSet_unparse</a> (v-&gt;info-&gt;fcn-&gt;mods),
04497                        <a class="code" href="globSet_c.html#a11">globSet_unparse</a>  (v-&gt;info-&gt;fcn-&gt;globs),
04498                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereSpecified),
04499                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDeclared),
04500                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDefined)));
04501     }
04502   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (v))
04503     {
04504       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%s] %q: %t / %q [s: %q; d: %q]"</font>,
04505                        ekind_unparse (v-&gt;ukind),
04506                        <a class="code" href="uentry_c.html#a195">uentry_getName</a> (v),
04507                        v-&gt;utype,
04508                        <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (v-&gt;sref),
04509                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereSpecified),
04510                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDefined)));
04511     }
04512   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (v))
04513     {
04514       <font class="keywordflow">return</font> 
04515         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[check: %s] / [%w] = [%s] %s : %t %q [s: %q; def: %q; dec: %q] "</font>
04516                   <font class="stringliteral">"kind &lt;%d&gt; isout &lt;%d&gt; used &lt;%d&gt;"</font>,
04517                   checkedName (v-&gt;info-&gt;var-&gt;checked),
04518                   (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) v,
04519                   <a class="code" href="ekind_c.html#a1">ekind_unparse</a> (v-&gt;ukind),
04520                   v-&gt;uname,
04521                   v-&gt;utype,
04522                   <a class="code" href="sRef_c.html#a170">sRef_unparseDeep</a> (v-&gt;sref),
04523                   <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereSpecified),
04524                   <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDefined),
04525                   <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDeclared),
04526                   (<font class="keywordtype">int</font>) v-&gt;info-&gt;var-&gt;kind,
04527                   (<font class="keywordtype">int</font>) v-&gt;info-&gt;var-&gt;defstate,
04528                   (<font class="keywordtype">int</font>) v-&gt;used));
04529     }
04530   <font class="keywordflow">else</font>
04531     {
04532       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%s] %s : %t %q at [s: %q; d: %q]"</font>,
04533                        ekind_unparse (v-&gt;ukind),
04534                        v-&gt;uname,
04535                        v-&gt;utype,
04536                        <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (v-&gt;sref),
04537                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereSpecified),
04538                        <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (v-&gt;whereDefined)));
04539       
04540     }
04541 }
04542 
<a name="l04543"></a><a class="code" href="uentry_c.html#a157">04543</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a157">uentry_hasAccessType</a> (uentry e)<font class="keyword"></font>
04544 <font class="keyword"></font>{
04545   <font class="keywordflow">if</font> (uentry_isValid (e))
04546     {
04547       <font class="keywordflow">switch</font> (e-&gt;ukind)
04548         {
04549         <font class="keywordflow">case</font> KITER:
04550           <font class="keywordflow">return</font> (!<a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (e-&gt;info-&gt;iter-&gt;access));
04551         <font class="keywordflow">case</font> KENDITER:
04552           <font class="keywordflow">return</font> (!<a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (e-&gt;info-&gt;enditer-&gt;access));
04553         <font class="keywordflow">case</font> KFCN:
04554           <font class="keywordflow">return</font> (!<a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (e-&gt;info-&gt;fcn-&gt;access));
04555         <font class="keywordflow">case</font> KENUMCONST:
04556         <font class="keywordflow">case</font> KCONST:
04557           <font class="keywordflow">return</font> (!<a class="code" href="typeIdSet_c.html#a16">typeIdSet_isEmpty</a> (e-&gt;info-&gt;uconst-&gt;access));
04558         <font class="keywordflow">default</font>:
04559           <font class="keywordflow">return</font> FALSE;
04560         }
04561     }
04562 
04563   <font class="keywordflow">return</font> FALSE;
04564 }
04565   
<a name="l04566"></a><a class="code" href="uentry_c.html#a158">04566</a> typeIdSet <a class="code" href="uentry_c.html#a158">uentry_accessType</a> (uentry e)<font class="keyword"></font>
04567 <font class="keyword"></font>{
04568   <font class="keywordflow">if</font> (uentry_isValid (e))
04569     {
04570       <font class="keywordflow">switch</font> (e-&gt;ukind)
04571         {
04572         <font class="keywordflow">case</font> KITER:
04573           <font class="keywordflow">return</font> (e-&gt;info-&gt;iter-&gt;access);
04574         <font class="keywordflow">case</font> KENDITER:
04575           <font class="keywordflow">return</font> (e-&gt;info-&gt;enditer-&gt;access);
04576         <font class="keywordflow">case</font> KFCN:
04577           <font class="keywordflow">return</font> (e-&gt;info-&gt;fcn-&gt;access);
04578         <font class="keywordflow">case</font> KENUMCONST:
04579         <font class="keywordflow">case</font> KCONST:
04580           <font class="keywordflow">return</font> (e-&gt;info-&gt;uconst-&gt;access);
04581         <font class="keywordflow">default</font>:
04582           <font class="keywordflow">break</font>;
04583         }
04584     }
04585 
04586   <font class="keywordflow">return</font> typeIdSet_undefined;
04587 }
04588 
04589 <font class="keywordtype">bool</font>
<a name="l04590"></a><a class="code" href="uentry_c.html#a159">04590</a> <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (uentry e)<font class="keyword"></font>
04591 <font class="keyword"></font>{
04592   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (e));
04593 }
04594 
04595 <font class="keywordtype">bool</font>
<a name="l04596"></a><a class="code" href="uentry_c.html#a160">04596</a> <a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (uentry e)<font class="keyword"></font>
04597 <font class="keyword"></font>{
04598   <font class="keywordflow">return</font> (uentry_isValid (e) &amp;&amp; !fileloc_isUndefined (e-&gt;whereSpecified));
04599 }
04600 
04601 <font class="keyword">static</font> <font class="keywordtype">bool</font>
04602 uentry_isReallySpecified (uentry e)<font class="keyword"></font>
04603 <font class="keyword"></font>{
04604   <font class="keywordflow">return</font> (uentry_isValid (e) 
04605           &amp;&amp; <a class="code" href="fileloc_c.html#a45">fileloc_isRealSpec</a> (e-&gt;whereSpecified));
04606 }
04607 
04608 <font class="keywordtype">bool</font>
<a name="l04609"></a><a class="code" href="uentry_c.html#a161">04609</a> <a class="code" href="uentry_c.html#a161">uentry_isVar</a> (uentry e)<font class="keyword"></font>
04610 <font class="keyword"></font>{
04611   <font class="keywordflow">return</font> (!uentry_isUndefined (e) &amp;&amp; e-&gt;ukind == KVAR);
04612 }
04613 
04614 <font class="keywordtype">bool</font> 
<a name="l04615"></a><a class="code" href="uentry_c.html#a162">04615</a> <a class="code" href="uentry_c.html#a162">uentry_isFakeTag</a> (uentry e)<font class="keyword"></font>
04616 <font class="keyword"></font>{
04617   <font class="keywordflow">return</font> (uentry_isValid (e) &amp;&amp; strchr (cstring_toCharsSafe (e-&gt;uname), <font class="charliteral">'!'</font>) != 0);
04618 }
04619 
04620 <font class="keywordtype">bool</font>
<a name="l04621"></a><a class="code" href="uentry_c.html#a163">04621</a> <a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (uentry e)<font class="keyword"></font>
04622 <font class="keyword"></font>{
04623   <font class="keywordflow">return</font> (!uentry_isUndefined (e) &amp;&amp;
04624           (e-&gt;ukind == KDATATYPE || e-&gt;ukind == KSTRUCTTAG ||
04625            e-&gt;ukind == KUNIONTAG || e-&gt;ukind == KENUMTAG));
04626 }
04627 
04628 <font class="keywordtype">void</font>
<a name="l04629"></a><a class="code" href="uentry_c.html#a164">04629</a> <a class="code" href="uentry_c.html#a164">uentry_setAbstract</a> (uentry e)<font class="keyword"></font>
04630 <font class="keyword"></font>{
04631   typeId oldid;
04632 
04633   llassert (uentry_isDatatype (e) 
04634             &amp;&amp; (ynm_isMaybe (e-&gt;info-&gt;datatype-&gt;abs)));
04635 
04636   oldid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (e-&gt;info-&gt;datatype-&gt;type);
04637   e-&gt;info-&gt;datatype-&gt;abs = YES;
04638   e-&gt;info-&gt;datatype-&gt;type = <a class="code" href="ctype_c.html#a25">ctype_createAbstract</a> (oldid);
04639 }
04640 
04641 <font class="keywordtype">void</font>
<a name="l04642"></a><a class="code" href="uentry_c.html#a165">04642</a> <a class="code" href="uentry_c.html#a165">uentry_setConcrete</a> (uentry e)<font class="keyword"></font>
04643 <font class="keyword"></font>{
04644   llassert (uentry_isDatatype (e) 
04645             &amp;&amp; (ynm_isMaybe (e-&gt;info-&gt;datatype-&gt;abs)));
04646 
04647   e-&gt;info-&gt;datatype-&gt;abs = NO;
04648 }
04649 
04650 <font class="keywordtype">bool</font>
<a name="l04651"></a><a class="code" href="uentry_c.html#a166">04651</a> <a class="code" href="uentry_c.html#a166">uentry_isAbstractDatatype</a> (uentry e)<font class="keyword"></font>
04652 <font class="keyword"></font>{
04653   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) 
04654           &amp;&amp; (ynm_isOn (e-&gt;info-&gt;datatype-&gt;abs)));
04655 }
04656 
04657 <font class="keywordtype">bool</font>
<a name="l04658"></a><a class="code" href="uentry_c.html#a167">04658</a> <a class="code" href="uentry_c.html#a167">uentry_isMaybeAbstract</a> (uentry e)<font class="keyword"></font>
04659 <font class="keyword"></font>{
04660   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) 
04661           &amp;&amp; (ynm_isMaybe (e-&gt;info-&gt;datatype-&gt;abs)));
04662 }
04663 
04664 <font class="keywordtype">bool</font>
<a name="l04665"></a><a class="code" href="uentry_c.html#a168">04665</a> <a class="code" href="uentry_c.html#a168">uentry_isMutableDatatype</a> (uentry e)<font class="keyword"></font>
04666 <font class="keyword"></font>{
04667   <font class="keywordtype">bool</font> res = <a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) 
04668     &amp;&amp; (ynm_toBoolRelaxed (e-&gt;info-&gt;datatype-&gt;mut));
04669   
04670   <font class="keywordflow">return</font> res;
04671 }
04672 
04673 <font class="keywordtype">bool</font>
<a name="l04674"></a><a class="code" href="uentry_c.html#a169">04674</a> <a class="code" href="uentry_c.html#a169">uentry_isRefCountedDatatype</a> (uentry e)<font class="keyword"></font>
04675 <font class="keyword"></font>{
04676   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) &amp;&amp; (sRef_isRefCounted (uentry_getSref (e))));
04677 }
04678 
04679 <font class="keywordtype">bool</font>
<a name="l04680"></a><a class="code" href="uentry_c.html#a170">04680</a> <a class="code" href="uentry_c.html#a170">uentry_isParam</a> (uentry u)<font class="keyword"></font>
04681 <font class="keyword"></font>{
04682   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) &amp;&amp; (u-&gt;info-&gt;var-&gt;kind == VKPARAM
04683                                     || u-&gt;info-&gt;var-&gt;kind == VKYIELDPARAM));
04684 }
04685 
04686 <font class="keywordtype">bool</font>
<a name="l04687"></a><a class="code" href="uentry_c.html#a171">04687</a> <a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (uentry u)<font class="keyword"></font>
04688 <font class="keyword"></font>{
04689   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) &amp;&amp; (u-&gt;info-&gt;var-&gt;kind == VKEXPMACRO));
04690 }
04691 
04692 <font class="keywordtype">bool</font>
<a name="l04693"></a><a class="code" href="uentry_c.html#a172">04693</a> <a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (uentry u)<font class="keyword"></font>
04694 <font class="keyword"></font>{
04695   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) 
04696           &amp;&amp; (u-&gt;info-&gt;var-&gt;kind == VKSEFPARAM
04697               || u-&gt;info-&gt;var-&gt;kind == VKREFSEFPARAM
04698               || u-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM
04699               || u-&gt;info-&gt;var-&gt;kind == VKREFSEFRETPARAM));
04700 }
04701 
04702 <font class="keywordtype">bool</font>
<a name="l04703"></a><a class="code" href="uentry_c.html#a173">04703</a> <a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (uentry u)<font class="keyword"></font>
04704 <font class="keyword"></font>{
04705   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) 
04706           &amp;&amp; (u-&gt;info-&gt;var-&gt;kind == VKREFPARAM
04707               || u-&gt;info-&gt;var-&gt;kind == VKREFYIELDPARAM
04708               || u-&gt;info-&gt;var-&gt;kind == VKREFSEFPARAM
04709               || u-&gt;info-&gt;var-&gt;kind == VKREFSEFRETPARAM));
04710 }
04711 
04712 <font class="keywordtype">bool</font>
<a name="l04713"></a><a class="code" href="uentry_c.html#a174">04713</a> <a class="code" href="uentry_c.html#a174">uentry_isAnyParam</a> (uentry u)<font class="keyword"></font>
04714 <font class="keyword"></font>{
04715   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) 
04716           &amp;&amp; ((u-&gt;info-&gt;var-&gt;kind == VKPARAM)
04717               || (u-&gt;info-&gt;var-&gt;kind == VKSEFPARAM)
04718               || (u-&gt;info-&gt;var-&gt;kind == VKYIELDPARAM)
04719               || (u-&gt;info-&gt;var-&gt;kind == VKRETPARAM)
04720               || (u-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM)));
04721 }
04722 
04723 sstate 
<a name="l04724"></a><a class="code" href="uentry_c.html#a175">04724</a> <a class="code" href="uentry_c.html#a175">uentry_getDefState</a> (uentry u)<font class="keyword"></font>
04725 <font class="keyword"></font>{
04726   <font class="keywordflow">if</font> (uentry_isValid (u))
04727     {
04728       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (u-&gt;sref));
04729     }
04730   <font class="keywordflow">else</font>
04731     {
04732       <font class="keywordflow">return</font> (SS_UNKNOWN);
04733     }
04734 }
04735 
04736 <font class="keywordtype">bool</font>
<a name="l04737"></a><a class="code" href="uentry_c.html#a176">04737</a> <a class="code" href="uentry_c.html#a176">uentry_isOut</a> (uentry u)<font class="keyword"></font>
04738 <font class="keyword"></font>{
04739   <font class="keywordflow">return</font> ((<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) &amp;&amp; (u-&gt;info-&gt;var-&gt;defstate == SS_ALLOCATED))
04740           || (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (u) &amp;&amp; (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (u-&gt;sref))));
04741 }
04742 
04743 <font class="keywordtype">bool</font>
<a name="l04744"></a><a class="code" href="uentry_c.html#a177">04744</a> <a class="code" href="uentry_c.html#a177">uentry_isPartial</a> (uentry u)<font class="keyword"></font>
04745 <font class="keyword"></font>{
04746   <font class="keywordflow">return</font> ((<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) &amp;&amp; (u-&gt;info-&gt;var-&gt;defstate == SS_PARTIAL))
04747           || (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (u) &amp;&amp; (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (u-&gt;sref))));
04748 }
04749 
04750 <font class="keywordtype">bool</font>
<a name="l04751"></a><a class="code" href="uentry_c.html#a178">04751</a> <a class="code" href="uentry_c.html#a178">uentry_isStateSpecial</a> (uentry u)<font class="keyword"></font>
04752 <font class="keyword"></font>{
04753   <font class="keywordflow">return</font> ((<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) 
04754            &amp;&amp; (u-&gt;info-&gt;var-&gt;defstate == SS_SPECIAL))
04755           || (uentry_isValid (u) &amp;&amp; sRef_isStateSpecial (u-&gt;sref)));
04756 }
04757 
<a name="l04758"></a><a class="code" href="uentry_c.html#a179">04758</a> exitkind <a class="code" href="uentry_c.html#a179">uentry_getExitCode</a> (uentry ue)<font class="keyword"> </font>
04759 <font class="keyword"></font>{
04760   <font class="keywordflow">if</font> (uentry_isFunction (ue))
04761     {
04762       <font class="keywordflow">return</font> ue-&gt;info-&gt;fcn-&gt;exitCode;
04763     }
04764   <font class="keywordflow">else</font>
04765     {
04766       <font class="keywordflow">return</font> XK_UNKNOWN;
04767     }
04768 }
04769 
04770 qual
<a name="l04771"></a><a class="code" href="uentry_c.html#a180">04771</a> <a class="code" href="uentry_c.html#a180">uentry_nullPred</a> (uentry u)<font class="keyword"></font>
04772 <font class="keyword"></font>{
04773   llassert (uentry_isRealFunction (u));
04774 
04775   <font class="keywordflow">if</font> (uentry_isFunction (u))
04776     {
04777       <font class="keywordflow">return</font> (u-&gt;info-&gt;fcn-&gt;nullPred);
04778     }
04779   <font class="keywordflow">else</font>
04780     {
04781       <font class="keywordflow">return</font> QU_UNKNOWN;
04782     }
04783 }
04784 
04785 <font class="keywordtype">bool</font>
<a name="l04786"></a><a class="code" href="uentry_c.html#a181">04786</a> <a class="code" href="uentry_c.html#a181">uentry_possiblyNull</a> (uentry u)<font class="keyword"></font>
04787 <font class="keyword"></font>{
04788   <font class="keywordflow">return</font> ((<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (u) &amp;&amp; (<a class="code" href="varKinds_c.html#a5">nstate_possiblyNull</a> (u-&gt;info-&gt;var-&gt;nullstate)))
04789           || (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (u) &amp;&amp; (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (u-&gt;sref))));
04790 }
04791 
04792 alkind 
<a name="l04793"></a><a class="code" href="uentry_c.html#a182">04793</a> <a class="code" href="uentry_c.html#a182">uentry_getAliasKind</a> (uentry u)<font class="keyword"></font>
04794 <font class="keyword"></font>{
04795   <font class="keywordflow">if</font> (uentry_isValid (u))
04796     {
04797       <font class="keywordflow">return</font> (sRef_getAliasKind (uentry_getSref (u)));
04798     }
04799   <font class="keywordflow">else</font>
04800     {
04801       <font class="keywordflow">return</font> AK_UNKNOWN;
04802     }
04803 }
04804 
04805 exkind 
<a name="l04806"></a><a class="code" href="uentry_c.html#a183">04806</a> <a class="code" href="uentry_c.html#a183">uentry_getExpKind</a> (uentry u)<font class="keyword"></font>
04807 <font class="keyword"></font>{
04808   <font class="keywordflow">if</font> (uentry_isValid (u))
04809     {
04810       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (uentry_getSref (u)));
04811     }
04812   <font class="keywordflow">else</font>
04813     {
04814       <font class="keywordflow">return</font> XO_UNKNOWN;
04815     }
04816 }
04817 
04818 <font class="keywordtype">bool</font>
<a name="l04819"></a><a class="code" href="uentry_c.html#a184">04819</a> <a class="code" href="uentry_c.html#a184">uentry_isIter</a> (uentry e)<font class="keyword"></font>
04820 <font class="keyword"></font>{
04821   <font class="keywordflow">return</font> (!uentry_isUndefined (e) &amp;&amp; e-&gt;ukind == KITER);
04822 }
04823 
04824 <font class="keywordtype">bool</font>
<a name="l04825"></a><a class="code" href="uentry_c.html#a185">04825</a> <a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (uentry e)<font class="keyword"></font>
04826 <font class="keyword"></font>{
04827   <font class="keywordflow">return</font> (!uentry_isUndefined (e) &amp;&amp; e-&gt;ukind == KENDITER);
04828 }
04829 
04830 <font class="keywordtype">bool</font>
<a name="l04831"></a><a class="code" href="uentry_c.html#a186">04831</a> <a class="code" href="uentry_c.html#a186">uentry_isRealFunction</a> (uentry e)<font class="keyword"></font>
04832 <font class="keyword"></font>{
04833   <font class="keywordflow">return</font> (uentry_isFunction (e) ||
04834           (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (e))));
04835 }
04836 
04837 <font class="keywordtype">bool</font>
<a name="l04838"></a><a class="code" href="uentry_c.html#a187">04838</a> <a class="code" href="uentry_c.html#a187">uentry_hasName</a> (uentry e)<font class="keyword"></font>
04839 <font class="keyword"></font>{
04840   <font class="keywordflow">if</font> (uentry_isValid (e))
04841     {
04842       cstring s = e-&gt;uname;
04843       
04844       <font class="keywordflow">return</font> (!(cstring_isEmpty (s) || cstring_equalLit (s, <font class="stringliteral">"..."</font>)));
04845     }
04846   <font class="keywordflow">else</font>
04847     {
04848       <font class="keywordflow">return</font> FALSE;
04849     }
04850 }
04851 
<a name="l04852"></a><a class="code" href="uentry_c.html#a188">04852</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a188">uentry_hasRealName</a> (uentry e)<font class="keyword"></font>
04853 <font class="keyword"></font>{
04854   <font class="keywordflow">return</font> (uentry_isValid (e) &amp;&amp; cstring_isNonEmpty (e-&gt;uname));
04855 }
04856 
04857 
04858 <font class="comment">/*@observer@*/</font> globSet
<a name="l04859"></a><a class="code" href="uentry_c.html#a189">04859</a> <a class="code" href="uentry_c.html#a189">uentry_getGlobs</a> (uentry l)<font class="keyword"></font>
04860 <font class="keyword"></font>{
04861   <font class="keywordflow">if</font> (uentry_isInvalid (l)) 
04862     {
04863       <font class="keywordflow">return</font> globSet_undefined;
04864     }
04865 
04866   <font class="keywordflow">if</font> (l-&gt;ukind != KFCN)
04867     {
04868       <font class="keywordflow">if</font> (l-&gt;ukind != KITER &amp;&amp; l-&gt;ukind != KENDITER)
04869         {
04870           <font class="keywordflow">if</font> (l-&gt;ukind == KVAR)
04871             {
04872               llbug (message (<font class="stringliteral">"Bad call to uentry_getGlobs (var): %q (%s)"</font>, 
04873                               uentry_unparse (l), 
04874                               <a class="code" href="ekind_c.html#a1">ekind_unparse</a> (l-&gt;ukind)));
04875             }
04876           <font class="keywordflow">else</font>
04877             {
04878               llbug (message (<font class="stringliteral">"Bad call to uentry_getGlobs: %q (%s)"</font>, 
04879                               uentry_unparse (l), 
04880                               <a class="code" href="ekind_c.html#a1">ekind_unparse</a> (l-&gt;ukind)));
04881             }
04882         }
04883       <font class="keywordflow">return</font> globSet_undefined;
04884     }
04885 
04886   <font class="keywordflow">return</font> l-&gt;info-&gt;fcn-&gt;globs;
04887 }
04888 
04889 <font class="comment">/*@observer@*/</font> sRefSet
<a name="l04890"></a><a class="code" href="uentry_c.html#a190">04890</a> <a class="code" href="uentry_c.html#a190">uentry_getMods</a> (uentry l)<font class="keyword"></font>
04891 <font class="keyword"></font>{
04892   llassert (uentry_isValid (l));
04893 
04894   <font class="keywordflow">if</font> (l-&gt;ukind != KFCN &amp;&amp; l-&gt;ukind != KITER &amp;&amp; l-&gt;ukind != KENDITER)
04895     {
04896       llcontbug (message (<font class="stringliteral">"Bad call to uentry_getMods: %q"</font>, uentry_unparse (l)));
04897       <font class="keywordflow">return</font> sRefSet_undefined; 
04898     }
04899 
04900   <font class="keywordflow">return</font> l-&gt;info-&gt;fcn-&gt;mods;
04901 }
04902 
04903 ekind
<a name="l04904"></a><a class="code" href="uentry_c.html#a191">04904</a> <a class="code" href="uentry_c.html#a191">uentry_getKind</a> (uentry e)<font class="keyword"></font>
04905 <font class="keyword"></font>{
04906   llassert (uentry_isValid (e));
04907 
04908   <font class="keywordflow">return</font> (e-&gt;ukind);
04909 }
04910 
<a name="l04911"></a><a class="code" href="uentry_c.html#a192">04911</a> <font class="comment">/*@observer@*/</font> multiVal <a class="code" href="uentry_c.html#a192">uentry_getConstantValue</a> (uentry e)<font class="keyword"></font>
04912 <font class="keyword"></font>{
04913   llassert (uentry_isEitherConstant (e));
04914 
04915   <font class="keywordflow">return</font> (e-&gt;info-&gt;uconst-&gt;val);
04916 }
04917 
04918 <font class="comment">/*@observer@*/</font> uentryList
<a name="l04919"></a><a class="code" href="uentry_c.html#a193">04919</a> <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (uentry l)<font class="keyword"></font>
04920 <font class="keyword"></font>{
04921   <font class="keywordflow">if</font> (uentry_isInvalid (l)) <font class="keywordflow">return</font> uentryList_undefined;
04922 
04923   <font class="keywordflow">switch</font> (l-&gt;ukind)
04924     {
04925     <font class="keywordflow">case</font> KFCN:  
04926     <font class="keywordflow">case</font> KITER:
04927       {
04928         ctype ct = l-&gt;utype;
04929 
04930         <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
04931           {
04932             <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (ct));
04933           }
04934         <font class="keywordflow">else</font>
04935           {
04936             <font class="keywordflow">return</font> uentryList_undefined;
04937           }
04938       }
04939     <font class="keywordflow">case</font> KVAR:  
04940       {
04941         ctype ct = l-&gt;utype;
04942 
04943         llassert (ctype_isFunction (ct));
04944         <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (ct));
04945       }
04946     BADDEFAULT;
04947     }
04948   BADEXIT;
04949 }
04950 
04951 <font class="comment">/*@observer@*/</font> cstring
<a name="l04952"></a><a class="code" href="uentry_c.html#a194">04952</a> <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (uentry e)<font class="keyword"></font>
04953 <font class="keyword"></font>{
04954   <font class="keywordflow">if</font> (uentry_isValid (e))
04955     {
04956       <font class="keywordflow">return</font> (e-&gt;uname);
04957     }
04958   <font class="keywordflow">else</font>
04959     {
04960       <font class="keywordflow">return</font> cstring_undefined;
04961     }
04962 }
04963 
04964 <font class="keyword">static</font> cstring
04965 uentry_getOptName (uentry e)<font class="keyword"></font>
04966 <font class="keyword"></font>{
04967   cstring s = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e);
04968 
04969   <font class="keywordflow">if</font> (cstring_isDefined (s))
04970     {
04971       s = <a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (s, <font class="charliteral">' '</font>);
04972     }
04973   
04974   <font class="keywordflow">return</font> s;
04975 }
04976 
04977 <font class="comment">/*@only@*/</font> cstring
<a name="l04978"></a><a class="code" href="uentry_c.html#a195">04978</a> <a class="code" href="uentry_c.html#a195">uentry_getName</a> (uentry e)<font class="keyword"></font>
04979 <font class="keyword"></font>{
04980   cstring ret = cstring_undefined;
04981 
04982   <font class="keywordflow">if</font> (uentry_isValid (e))
04983     {
04984       
04985       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))
04986         {
04987           ret = <a class="code" href="structNames_c.html#a5">fixTagName</a> (e-&gt;uname); 
04988         }
04989       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a174">uentry_isAnyParam</a> (e))
04990         {
04991           ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (fixParamName (e-&gt;uname));
04992         }
04993       <font class="keywordflow">else</font>
04994         {
04995           ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (e-&gt;uname);
04996         }
04997     }
04998 
04999   <font class="keywordflow">return</font> ret;
05000 }
05001 
<a name="l05002"></a><a class="code" href="uentry_c.html#a196">05002</a> cstring <a class="code" href="uentry_c.html#a196">uentry_getRealName</a> (uentry e)<font class="keyword"></font>
05003 <font class="keyword"></font>{
05004   <font class="keywordflow">if</font> (uentry_isValid (e))
05005     {
05006       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))
05007         {
05008           <font class="keywordflow">return</font> (cstring_undefined);
05009         }
05010       <font class="keywordflow">else</font>
05011         {
05012           <font class="keywordflow">return</font> (e-&gt;uname);
05013         }
05014     }
05015   <font class="keywordflow">return</font> cstring_undefined;
05016 }
05017 
<a name="l05018"></a><a class="code" href="uentry_c.html#a197">05018</a> ctype <a class="code" href="uentry_c.html#a197">uentry_getType</a> (uentry e)<font class="keyword"></font>
05019 <font class="keyword"></font>{
05020   <font class="keywordflow">if</font> (uentry_isValid (e))
05021     {
05022       <font class="keywordflow">return</font> e-&gt;utype;
05023     }
05024   <font class="keywordflow">else</font>
05025     {
05026       <font class="keywordflow">return</font> ctype_unknown;
05027     }
05028 }
05029 
<a name="l05030"></a><a class="code" href="uentry_c.html#a198">05030</a> fileloc <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (uentry e)<font class="keyword"></font>
05031 <font class="keyword"></font>{
05032   fileloc loc;
05033 
05034   <font class="keywordflow">if</font> (uentry_isInvalid (e)) 
05035     {
05036       <font class="keywordflow">return</font> fileloc_undefined;
05037     }
05038   
05039   loc = e-&gt;whereDefined;
05040 
05041   <font class="keywordflow">if</font> (fileloc_isValid (loc) &amp;&amp; !fileloc_isExternal (loc))
05042     {
05043       <font class="keywordflow">return</font> loc;
05044     }
05045 
05046   loc = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
05047 
05048   <font class="keywordflow">if</font> (fileloc_isValid (loc) &amp;&amp; !fileloc_isExternal (loc))
05049     {
05050       <font class="keywordflow">return</font> loc;
05051     }
05052 
05053   loc = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (e);
05054   <font class="keywordflow">return</font> loc;
05055 }
05056 
<a name="l05057"></a><a class="code" href="uentry_c.html#a199">05057</a> fileloc <a class="code" href="uentry_c.html#a199">uentry_whereEither</a> (uentry e)<font class="keyword"></font>
05058 <font class="keyword"></font>{
05059   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> fileloc_undefined;
05060 
05061   <font class="keywordflow">if</font> (fileloc_isDefined (e-&gt;whereDefined) 
05062       &amp;&amp; !fileloc_isExternal (e-&gt;whereDefined))
05063     {
05064       <font class="keywordflow">return</font> e-&gt;whereDefined;
05065     }
05066   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isDefined (e-&gt;whereDeclared))
05067     {
05068       <font class="keywordflow">return</font> e-&gt;whereDeclared;
05069     }
05070   <font class="keywordflow">else</font>
05071     {
05072       <font class="keywordflow">return</font> e-&gt;whereSpecified;
05073     }
05074 }
05075 
<a name="l05076"></a><a class="code" href="uentry_c.html#a200">05076</a> fileloc <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (uentry e)<font class="keyword"></font>
05077 <font class="keyword"></font>{
05078   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> fileloc_undefined;
05079 
05080   <font class="keywordflow">return</font> (e-&gt;whereSpecified);
05081 }
05082 
<a name="l05083"></a><a class="code" href="uentry_c.html#a201">05083</a> fileloc <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (uentry e)<font class="keyword"></font>
05084 <font class="keyword"></font>{
05085   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> fileloc_undefined;
05086 
05087   <font class="keywordflow">return</font> (e-&gt;whereDefined);
05088 }
05089 
<a name="l05090"></a><a class="code" href="uentry_c.html#a202">05090</a> fileloc <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (uentry e)<font class="keyword"></font>
05091 <font class="keyword"></font>{
05092   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> fileloc_undefined;
05093 
05094   <font class="keywordflow">return</font> (e-&gt;whereDeclared);
05095 }
05096 
05097 <font class="comment">/*@observer@*/</font> fileloc
<a name="l05098"></a><a class="code" href="uentry_c.html#a203">05098</a> <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (uentry e)<font class="keyword"></font>
05099 <font class="keyword"></font>{
05100   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> fileloc_undefined;
05101   
05102   <font class="keywordflow">if</font> (fileloc_isDefined (e-&gt;whereSpecified))
05103     {
05104       <font class="keywordflow">return</font> (e-&gt;whereSpecified);
05105     }
05106   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isDefined (e-&gt;whereDeclared))
05107     {
05108       <font class="keywordflow">return</font> (e-&gt;whereDeclared);
05109     }
05110   <font class="keywordflow">else</font>
05111     {
05112       <font class="keywordflow">return</font> e-&gt;whereDefined;
05113     }
05114 }
05115 
05116 <font class="keywordtype">void</font>
<a name="l05117"></a><a class="code" href="uentry_c.html#a204">05117</a> <a class="code" href="uentry_c.html#a204">uentry_setFunctionDefined</a> (uentry e, fileloc loc)<font class="keyword"></font>
05118 <font class="keyword"></font>{
05119   <font class="keywordflow">if</font> (uentry_isValid (e))
05120     {
05121       llassert (uentry_isFunction (e));
05122 
05123       <font class="keywordflow">if</font> (fileloc_isUndefined (e-&gt;whereDeclared))
05124         {
05125           e-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDeclared, loc);
05126         }
05127       
05128       <font class="keywordflow">if</font> (!fileloc_isDefined (e-&gt;whereDefined))
05129         {
05130           e-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDefined, loc);
05131         }
05132     }
05133 }
05134 
05135 <font class="keywordtype">void</font>
05136 uentry_setDeclDef (uentry e, fileloc f)<font class="keyword"></font>
05137 <font class="keyword"></font>{
05138   <a class="code" href="uentry_c.html#a208">uentry_setDeclared</a> (e, f);
05139   
05140   <font class="keywordflow">if</font> (!uentry_isFunction (e)
05141       &amp;&amp; !(<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e) &amp;&amp; uentry_isExtern (e)))
05142     {
05143       <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (e, f);
05144     }
05145 }
05146 
05147 <font class="keywordtype">void</font>
<a name="l05148"></a><a class="code" href="uentry_c.html#a205">05148</a> <a class="code" href="uentry_c.html#a205">uentry_setDeclaredForce</a> (uentry e, fileloc f)<font class="keyword"></font>
05149 <font class="keyword"></font>{
05150   llassert (uentry_isValid (e));
05151   e-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDeclared, f);
05152 }
05153 
05154 <font class="keywordtype">void</font>
<a name="l05155"></a><a class="code" href="uentry_c.html#a206">05155</a> <a class="code" href="uentry_c.html#a206">uentry_setDeclaredForceOnly</a> (uentry e, fileloc f)<font class="keyword"></font>
05156 <font class="keyword"></font>{
05157   llassert (uentry_isValid (e));
05158   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;whereDeclared);
05159   e-&gt;whereDeclared = f;
05160 }
05161 
05162 <font class="keywordtype">void</font>
<a name="l05163"></a><a class="code" href="uentry_c.html#a207">05163</a> <a class="code" href="uentry_c.html#a207">uentry_setDeclaredOnly</a> (uentry e, <font class="comment">/*@only@*/</font> fileloc f)<font class="keyword"></font>
05164 <font class="keyword"></font>{
05165   fileloc oldloc;
05166 
05167   llassert (uentry_isValid (e));
05168   oldloc = e-&gt;whereDeclared;  
05169 
05170   <font class="keywordflow">if</font> (fileloc_isDefined (oldloc))
05171     {
05172       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (oldloc) || fileloc_isImport (oldloc))
05173         {
05174           e-&gt;whereDeclared = f;
05175           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (oldloc);
05176         }
05177       <font class="keywordflow">else</font>
05178         {
05179           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (f);
05180         }
05181     }
05182   <font class="keywordflow">else</font>
05183     {
05184       e-&gt;whereDeclared = f;
05185       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (oldloc);
05186     }
05187 }
05188   
05189 <font class="keywordtype">void</font>
<a name="l05190"></a><a class="code" href="uentry_c.html#a208">05190</a> <a class="code" href="uentry_c.html#a208">uentry_setDeclared</a> (uentry e, fileloc f)<font class="keyword"></font>
05191 <font class="keyword"></font>{
05192   fileloc oldloc;
05193 
05194   llassert (uentry_isValid (e));
05195   oldloc = e-&gt;whereDeclared;  
05196 
05197   <font class="keywordflow">if</font> (fileloc_isDefined (oldloc))
05198     {
05199       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (oldloc) || fileloc_isImport (oldloc))
05200         {
05201           e-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDeclared, f);
05202         }
05203       <font class="keywordflow">else</font>
05204         {
05205           ;
05206         }
05207     }
05208   <font class="keywordflow">else</font>
05209     {
05210       e-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDeclared, f);
05211     }
05212 }
05213 
05214 <font class="keywordtype">void</font>
<a name="l05215"></a><a class="code" href="uentry_c.html#a209">05215</a> <a class="code" href="uentry_c.html#a209">uentry_clearDefined</a> (uentry e)<font class="keyword"></font>
05216 <font class="keyword"></font>{
05217   <font class="keywordflow">if</font> (uentry_isValid (e))
05218     {
05219       e-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDefined, fileloc_undefined);
05220     }
05221 }
05222 
05223 <font class="keywordtype">void</font>
<a name="l05224"></a><a class="code" href="uentry_c.html#a210">05224</a> <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (uentry e, fileloc f)<font class="keyword"></font>
05225 <font class="keyword"></font>{
05226   fileloc oldloc;
05227 
05228   llassert (uentry_isValid (e));
05229   oldloc = e-&gt;whereDefined;
05230 
05231   <font class="keywordflow">if</font> (fileloc_isDefined (oldloc))
05232     {
05233       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (oldloc) 
05234           || fileloc_isImport (oldloc)
05235           || fileloc_isBuiltin (oldloc) 
05236           || fileloc_isPreproc (oldloc))
05237         {
05238           e-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDefined, f);
05239         }
05240       <font class="keywordflow">else</font>
05241         {
05242           <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (oldloc, f) || <a class="code" href="context_c.html#a179">context_processingMacros</a> ())
05243             {
05244               ; <font class="comment">/* okay */</font>
05245             }
05246           <font class="keywordflow">else</font>
05247             {
05248               <font class="keywordflow">if</font> (optgenerror (FLG_REDEF,
05249                                message (<font class="stringliteral">"%s %q redefined"</font>, 
05250                                         ekind_capName (e-&gt;ukind),
05251                                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
05252                                f))
05253                 {
05254                   <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous definition of %q"</font>, 
05255                                            uentry_getName (e)),
05256                                   e-&gt;whereDefined);
05257                 }
05258             }
05259         }
05260     }
05261   <font class="keywordflow">else</font>
05262     {
05263       e-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;whereDefined, f);
05264     }
05265 }
05266 
05267 <font class="keywordtype">bool</font>
<a name="l05268"></a><a class="code" href="uentry_c.html#a211">05268</a> <a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (uentry e)<font class="keyword"></font>
05269 <font class="keyword"></font>{
05270   <font class="keywordflow">return</font> (uentry_isValid (e) &amp;&amp; fileloc_isDefined (e-&gt;whereDefined));
05271 }
05272 
05273 <font class="keywordtype">bool</font>
<a name="l05274"></a><a class="code" href="uentry_c.html#a212">05274</a> <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (uentry e)<font class="keyword"></font>
05275 <font class="keyword"></font>{
05276   <font class="keywordflow">if</font> (uentry_isValid (e))
05277     {
05278       <font class="keywordflow">return</font> (fileloc_isDefined (e-&gt;whereDeclared));
05279     }
05280 
05281   <font class="keywordflow">return</font> FALSE;
05282 }
05283 
<a name="l05284"></a><a class="code" href="uentry_c.html#a213">05284</a> sRef <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (uentry e)<font class="keyword"></font>
05285 <font class="keyword"></font>{
05286   <font class="comment">/* not true, used for functions too (but shouldn't be? */</font>
05287   <font class="comment">/* llassertprint (e-&gt;ukind == KVAR, ("uentry_getSref: not variable!")); */</font>
05288 
05289   <font class="keywordflow">if</font> (uentry_isInvalid (e)) <font class="keywordflow">return</font> sRef_undefined;
05290   
05291   <font class="keywordflow">return</font> (e-&gt;sref);
05292 }
05293 
<a name="l05294"></a><a class="code" href="uentry_c.html#a214">05294</a> sRef <a class="code" href="uentry_c.html#a214">uentry_getOrigSref</a> (uentry e)<font class="keyword"></font>
05295 <font class="keyword"></font>{
05296   <font class="keywordflow">if</font> (uentry_isValid (e))
05297     {
05298       sRef sr = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (uentry_getSref (e));
05299       
05300       <a class="code" href="sRef_c.html#a292">sRef_resetState</a> (sr);
05301       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (sr);
05302       
05303       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e))
05304         {
05305           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sr, e-&gt;info-&gt;var-&gt;defstate, fileloc_undefined);
05306           <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sr, e-&gt;info-&gt;var-&gt;nullstate, fileloc_undefined);
05307         }
05308       
05309       <font class="keywordflow">return</font> (sr);
05310     }
05311   <font class="keywordflow">else</font>
05312     {
05313       <font class="keywordflow">return</font> sRef_undefined;
05314     }
05315 }
05316 
05317 <font class="comment">/*</font>
05318 <font class="comment">** requires: uentry e is not in a hashed symbol table</font>
05319 <font class="comment">*/</font>
05320 
05321 <font class="keywordtype">void</font> 
<a name="l05322"></a><a class="code" href="uentry_c.html#a215">05322</a> <a class="code" href="uentry_c.html#a215">uentry_setName</a> (uentry e, <font class="comment">/*@only@*/</font> cstring n)<font class="keyword"></font>
05323 <font class="keyword"></font>{
05324   llassert (uentry_isValid (e));
05325 
05326   <a class="code" href="cstring_c.html#a27">cstring_free</a> (e-&gt;uname);
05327   e-&gt;uname = n;
05328 }
05329 
05330 <font class="keywordtype">void</font>
<a name="l05331"></a><a class="code" href="uentry_c.html#a216">05331</a> <a class="code" href="uentry_c.html#a216">uentry_setType</a> (uentry e, ctype t)<font class="keyword"></font>
05332 <font class="keyword"></font>{
05333   <font class="keywordflow">if</font> (uentry_isValid (e)) 
05334     {
05335       e-&gt;utype = t;
05336       <a class="code" href="sRef_c.html#a256">sRef_setType</a> (e-&gt;sref, t);
05337     }
05338 }
05339 
05340 <font class="keywordtype">void</font>
<a name="l05341"></a><a class="code" href="uentry_c.html#a217">05341</a> <a class="code" href="uentry_c.html#a217">uentry_resetParams</a> (uentry ue, <font class="comment">/*@only@*/</font> uentryList pn)<font class="keyword"></font>
05342 <font class="keyword"></font>{
05343   ctype rct;
05344   ctype rettype = ctype_unknown;
05345   
05346   llassert (uentry_isValid (ue));
05347 
05348   rct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ue-&gt;utype);
05349 
05350   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue) &amp;&amp; (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (rct) || ctype_isUnknown (rct)))
05351     {
05352       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (ue);
05353     }
05354 
05355   llassert (uentry_isFunction (ue));
05356 
05357   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (rct))
05358     {
05359       rettype = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (rct);
05360     }
05361 
05362   ue-&gt;utype = <a class="code" href="ctype_c.html#a45">ctype_makeNFParamsFunction</a> (rettype, pn);      
05363 }
05364 
05365 <font class="keywordtype">void</font>
<a name="l05366"></a><a class="code" href="uentry_c.html#a218">05366</a> <a class="code" href="uentry_c.html#a218">uentry_setRefParam</a> (uentry e)<font class="keyword"></font>
05367 <font class="keyword"></font>{
05368   
05369   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (e))
05370     {
05371       llbug (message (<font class="stringliteral">"uentry_setParam: not variable: %q"</font>, uentry_unparse (e)));
05372     }
05373   <font class="keywordflow">else</font>
05374     {
05375       <font class="keywordflow">if</font> (e-&gt;info-&gt;var-&gt;kind == VKSEFPARAM)
05376         {
05377           e-&gt;info-&gt;var-&gt;kind = VKREFSEFPARAM;
05378         }
05379       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM)
05380         {
05381           e-&gt;info-&gt;var-&gt;kind = VKREFSEFRETPARAM;
05382         }
05383       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;info-&gt;var-&gt;kind == VKYIELDPARAM)
05384         {
05385           e-&gt;info-&gt;var-&gt;kind = VKREFYIELDPARAM;
05386         }
05387       <font class="keywordflow">else</font>
05388         {
05389           e-&gt;info-&gt;var-&gt;kind = VKREFPARAM;
05390         }
05391     }
05392 }
05393 
05394 <font class="keywordtype">void</font>
<a name="l05395"></a><a class="code" href="uentry_c.html#a219">05395</a> <a class="code" href="uentry_c.html#a219">uentry_setParam</a> (uentry e)<font class="keyword"></font>
05396 <font class="keyword"></font>{
05397   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (e))
05398     {
05399       <font class="keywordflow">if</font> (uentry_isElipsisMarker (e))
05400         {
05401 
05402         }
05403       <font class="keywordflow">else</font>
05404         {
05405           llbug (message (<font class="stringliteral">"uentry_setParam: not variable: %q"</font>, uentry_unparse (e)));
05406         }
05407     }
05408   <font class="keywordflow">else</font>
05409     {
05410       cstring oldname;
05411 
05412       <font class="keywordflow">if</font> (e-&gt;info-&gt;var-&gt;kind == VKYIELDPARAM 
05413           || e-&gt;info-&gt;var-&gt;kind == VKSEFPARAM
05414           || e-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM)
05415         {
05416           ;
05417         }
05418       <font class="keywordflow">else</font>
05419         {
05420           e-&gt;info-&gt;var-&gt;kind = VKPARAM;
05421         }
05422 
05423       oldname = e-&gt;uname;
05424       e-&gt;uname = <a class="code" href="structNames_c.html#a6">makeParam</a> (e-&gt;uname);
05425       <a class="code" href="cstring_c.html#a27">cstring_free</a> (oldname);
05426     }
05427 }
05428 
05429 <font class="keywordtype">void</font>
<a name="l05430"></a><a class="code" href="uentry_c.html#a220">05430</a> <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (uentry e, sRef s)<font class="keyword"></font>
05431 <font class="keyword"></font>{
05432   <font class="keywordflow">if</font> (uentry_isValid (e))
05433     {
05434       <font class="keywordflow">if</font> (sRef_isValid (e-&gt;sref))
05435         {
05436           <a class="code" href="sRef_c.html#a148">sRef_mergeStateQuietReverse</a> (e-&gt;sref, s);
05437         }
05438       <font class="keywordflow">else</font>
05439         {
05440           e-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s);
05441         }
05442     }
05443 }
05444 
05445 ctype
<a name="l05446"></a><a class="code" href="uentry_c.html#a221">05446</a> <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (uentry e)<font class="keyword"></font>
05447 <font class="keyword"></font>{
05448   llassert (uentry_isDatatype (e));
05449 
05450   <font class="comment">/*</font>
05451 <font class="comment">  ** This assertion removed.</font>
05452 <font class="comment">  ** Okay to have undefined type, for system types</font>
05453 <font class="comment">  </font>
05454 <font class="comment">  llassertprintret (!ctype_isUndefined (e-&gt;info-&gt;datatype-&gt;type),</font>
05455 <font class="comment">                    ("uentry_getAbstractType %q: undefined", uentry_unparseFull (e)),</font>
05456 <font class="comment">                    e-&gt;utype);</font>
05457 <font class="comment">                    </font>
05458 <font class="comment">  */</font>
05459 
05460   <font class="keywordflow">if</font> (ctype_isUndefined (e-&gt;info-&gt;datatype-&gt;type))
05461     {
05462       <font class="keywordflow">return</font> ctype_unknown;
05463     }
05464 
05465   <font class="comment">/*</font>
05466 <font class="comment">  ** Sadly, a kludge...</font>
05467 <font class="comment">  */</font>
05468 
05469   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a23">ctype_isUserBool</a> (e-&gt;info-&gt;datatype-&gt;type)) {
05470     <font class="keywordflow">return</font> ctype_bool;
05471   }
05472 
05473   <font class="keywordflow">return</font> e-&gt;info-&gt;datatype-&gt;type;
05474 }
05475 
<a name="l05476"></a><a class="code" href="uentry_c.html#a222">05476</a> ctype <a class="code" href="uentry_c.html#a222">uentry_getRealType</a> (uentry e)<font class="keyword"></font>
05477 <font class="keyword"></font>{
05478   ctype ct;
05479   typeId uid = USYMIDINVALID;
05480 
05481   <font class="keywordflow">if</font> (uentry_isInvalid (e))
05482     {
05483       <font class="keywordflow">return</font> ctype_unknown;
05484     }
05485 
05486   llassertprint (uentry_isDatatype (e), (<font class="stringliteral">"not datatype: %s"</font>, <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (e)));
05487 
05488   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))
05489     {
05490       <font class="keywordflow">return</font> (e-&gt;utype);
05491     }
05492   
05493   <font class="keywordflow">if</font> (uentry_isAbstractType (e))
05494     {
05495       ct = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (e);      
05496 
05497       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a61">ctype_isManifestBool</a> (ct)) {
05498         <font class="keywordflow">return</font> ct;
05499       }
05500 
05501       llassert (ctype_isUA (ct));
05502       
05503       uid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
05504       
05505       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a112">context_hasAccess</a> (uid))
05506         {
05507           <font class="keywordflow">return</font> (ct);
05508         }
05509     }
05510 
05511   ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
05512 
05513   <font class="comment">/* if (ctype_isUserBool (ct)) return ct; */</font>
05514 
05515   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a61">ctype_isManifestBool</a> (ct)) {
05516     <font class="keywordflow">return</font> ctype_bool;
05517   }
05518   
05519   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ct))
05520     {
05521       usymId iid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
05522       
05523       <font class="keywordflow">if</font> <font class="comment">/*@access usymId@*/</font> (iid == uid) <font class="comment">/*@noaccess usymId@*/</font>
05524         {         
05525           llcontbug (message (<font class="stringliteral">"uentry_getRealType: recursive type! %s"</font>,
05526                               ctype_unparse (ct)));
05527           <font class="keywordflow">return</font> ct;
05528         }
05529       <font class="keywordflow">else</font>
05530         {
05531           <font class="comment">/* evs 2000-07-25: possible infinite recursion ? */</font>
05532           uentry ue2 = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (iid);
05533           llassertprint (ue2 != e, (<font class="stringliteral">"Bad recursion: %s"</font>, uentry_unparseFull (e)));
05534 
05535           <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a222">uentry_getRealType</a> (ue2);
05536         }
05537     }
05538   <font class="keywordflow">else</font>
05539     {
05540       <font class="keywordflow">return</font> ct;
05541     }
05542 }
05543 
<a name="l05544"></a><a class="code" href="uentry_c.html#a223">05544</a> ctype <a class="code" href="uentry_c.html#a223">uentry_getForceRealType</a> (uentry e)<font class="keyword"></font>
05545 <font class="keyword"></font>{
05546   ctype   ct;
05547   typeId uid = USYMIDINVALID;
05548 
05549   <font class="keywordflow">if</font> (uentry_isInvalid (e))
05550     {
05551       <font class="keywordflow">return</font> ctype_unknown;
05552     }
05553 
05554   llassertprint (uentry_isDatatype (e), (<font class="stringliteral">"not datatype: %s"</font>, <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (e)));
05555   
05556   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))
05557     {
05558       <font class="keywordflow">return</font> (e-&gt;utype);
05559     }
05560   
05561   <font class="keywordflow">if</font> (uentry_isAbstractType (e))
05562     {
05563       ct = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (e);      
05564       llassert (ctype_isUA (ct));
05565       
05566       uid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
05567       <font class="comment">/* no check for access! */</font>
05568     }
05569   
05570   ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
05571 
05572   <font class="comment">/* evs 2000-07-25 */</font>
05573   <font class="comment">/* if (ctype_isUserBool (ct)) return ct; */</font>
05574 
05575   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a61">ctype_isManifestBool</a> (ct)) {
05576     <font class="keywordflow">return</font> ctype_bool;
05577   }
05578   
05579   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ct))
05580     {
05581       usymId iid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
05582       
05583       <font class="keywordflow">if</font> <font class="comment">/*@access usymId@*/</font> (iid == uid) <font class="comment">/*@noaccess usymId@*/</font>
05584         {         
05585           llcontbug (message (<font class="stringliteral">"uentry_getRealType: recursive type! %s"</font>,
05586                               ctype_unparse (ct)));
05587           <font class="keywordflow">return</font> ct;
05588         }
05589       <font class="keywordflow">else</font>
05590         {
05591           <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a223">uentry_getForceRealType</a> (usymtab_getTypeEntry (iid));
05592         }
05593     }
05594   <font class="keywordflow">else</font>
05595     {
05596       <font class="keywordflow">return</font> ct;
05597     }
05598 }
05599 
<a name="l05600"></a><a class="code" href="uentry_c.html#a224">05600</a> uentry <a class="code" href="uentry_c.html#a224">uentry_nameCopy</a> (cstring name, uentry e)<font class="keyword"></font>
05601 <font class="keyword"></font>{
05602   uentry enew = uentry_alloc ();
05603 
05604   llassert (uentry_isValid (e));
05605 
05606   <font class="comment">/* enew-&gt;shallowCopy = FALSE; */</font>
05607   enew-&gt;ukind = e-&gt;ukind;
05608   enew-&gt;uname = name;
05609   enew-&gt;utype = e-&gt;utype;
05610   enew-&gt;whereSpecified = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;whereSpecified);
05611   enew-&gt;whereDefined = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;whereDefined);
05612   enew-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;whereDeclared);
05613   enew-&gt;sref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (e-&gt;sref); 
05614   enew-&gt;used = e-&gt;used;
05615   enew-&gt;lset = FALSE;
05616   enew-&gt;isPrivate = e-&gt;isPrivate;
05617   enew-&gt;hasNameError = FALSE;
05618 
05619   enew-&gt;uses = <a class="code" href="filelocList_c.html#a0">filelocList_new</a> ();
05620 
05621   enew-&gt;storageclass = e-&gt;storageclass;
05622   enew-&gt;info = uinfo_copy (e-&gt;info, e-&gt;ukind);
05623 
05624   <font class="keywordflow">return</font> enew;
05625 }
05626 
05627 <font class="keywordtype">void</font>
<a name="l05628"></a><a class="code" href="uentry_c.html#a225">05628</a> <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (uentry e, usymId uid)<font class="keyword"></font>
05629 <font class="keyword"></font>{
05630   llassert (uentry_isDatatype (e));
05631 
05632   <font class="keywordflow">if</font> (uentry_isAbstractType (e))
05633     {
05634       e-&gt;info-&gt;datatype-&gt;type = <a class="code" href="ctype_c.html#a25">ctype_createAbstract</a> (uid);
05635     }
05636   <font class="keywordflow">else</font>
05637     {
05638       e-&gt;info-&gt;datatype-&gt;type = <a class="code" href="ctype_c.html#a24">ctype_createUser</a> (uid);
05639     }
05640 }
05641 
05642 <font class="keyword">static</font> <font class="keywordtype">void</font> 
05643 uentry_setSpecDef (<font class="comment">/*@special@*/</font> uentry e, <font class="comment">/*@keep@*/</font> fileloc f)
05644    <font class="comment">/*@defines e-&gt;whereSpecified, e-&gt;whereDeclared, e-&gt;whereDefined@*/</font>
05645    <font class="comment">/*@modifies e@*/</font>
05646 {
05647   llassert (uentry_isValid (e));
05648 
05649   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (f) || fileloc_isImport (f))
05650     {
05651       e-&gt;whereSpecified = f;
05652       e-&gt;whereDeclared  = fileloc_undefined;
05653       e-&gt;whereDefined  = fileloc_undefined;
05654     }
05655   <font class="keywordflow">else</font>
05656     {
05657       e-&gt;whereSpecified = fileloc_undefined;
05658       e-&gt;whereDeclared  = f;
05659       e-&gt;whereDefined  = fileloc_undefined;
05660     }
05661 }
05662 
05663 <font class="keyword">static</font> <font class="keywordtype">void</font>
05664 ucinfo_free (<font class="comment">/*@only@*/</font> ucinfo u)<font class="keyword"></font>
05665 <font class="keyword"></font>{
05666   <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (u-&gt;val);
05667   <a class="code" href="general_c.html#a0">sfree</a> (u);
05668 }
05669 
05670 <font class="keyword">static</font> <font class="keywordtype">void</font>
05671 uvinfo_free (<font class="comment">/*@only@*/</font> uvinfo u)<font class="keyword"></font>
05672 <font class="keyword"></font>{
05673   <a class="code" href="general_c.html#a0">sfree</a> (u);
05674 }
05675 
05676 <font class="keyword">static</font> <font class="keywordtype">void</font>
05677 udinfo_free (<font class="comment">/*@only@*/</font> udinfo u)<font class="keyword"></font>
05678 <font class="keyword"></font>{
05679   <a class="code" href="general_c.html#a0">sfree</a> (u);
05680 }
05681 
05682 <font class="keyword">static</font> <font class="keywordtype">void</font>
05683 ufinfo_free (<font class="comment">/*@only@*/</font> ufinfo u)<font class="keyword"></font>
05684 <font class="keyword"></font>{
05685   <a class="code" href="globSet_c.html#a8">globSet_free</a> (u-&gt;globs);
05686   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (u-&gt;mods);
05687   <a class="code" href="specialClauses_c.html#a32">specialClauses_free</a> (u-&gt;specclauses);
05688 
05689   <a class="code" href="general_c.html#a0">sfree</a> (u);
05690 }
05691 
05692 <font class="keyword">static</font> <font class="keywordtype">void</font>
05693 uiinfo_free (<font class="comment">/*@only@*/</font> uiinfo u)<font class="keyword"></font>
05694 <font class="keyword"></font>{
05695   <a class="code" href="general_c.html#a0">sfree</a> (u);
05696 }
05697 
05698 <font class="keyword">static</font> <font class="keywordtype">void</font>
05699 ueinfo_free (<font class="comment">/*@only@*/</font> ueinfo u)<font class="keyword"></font>
05700 <font class="keyword"></font>{
05701   <a class="code" href="general_c.html#a0">sfree</a> (u);
05702 }
05703 
05704 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> ucinfo
05705 ucinfo_copy (ucinfo u)<font class="keyword"></font>
05706 <font class="keyword"></font>{
05707   ucinfo ret = (ucinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05708   
05709   ret-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (u-&gt;val);
05710   ret-&gt;access = u-&gt;access;
05711 
05712   <font class="keywordflow">return</font> ret;
05713 }
05714 
05715 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uvinfo
05716 uvinfo_copy (uvinfo u)<font class="keyword"></font>
05717 <font class="keyword"></font>{
05718   uvinfo ret = (uvinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05719   
05720   ret-&gt;kind = u-&gt;kind;
05721   ret-&gt;nullstate = u-&gt;nullstate;
05722   ret-&gt;defstate = u-&gt;defstate;
05723   ret-&gt;checked = u-&gt;checked;
05724 
05725   <font class="keywordflow">return</font> ret;
05726 }
05727 
05728 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> udinfo
05729 udinfo_copy (udinfo u)<font class="keyword"></font>
05730 <font class="keyword"></font>{
05731   udinfo ret = (udinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05732 
05733   ret-&gt;abs = u-&gt;abs;
05734   ret-&gt;mut = u-&gt;mut;
05735   ret-&gt;type = u-&gt;type;
05736 
05737   <font class="keywordflow">return</font> ret;
05738 }
05739 
05740 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> ufinfo
05741 ufinfo_copy (ufinfo u)<font class="keyword"></font>
05742 <font class="keyword"></font>{
05743   ufinfo ret = (ufinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05744 
05745   ret-&gt;hasGlobs = u-&gt;hasGlobs;
05746   ret-&gt;hasMods = u-&gt;hasMods;
05747   ret-&gt;exitCode = u-&gt;exitCode;
05748   ret-&gt;specialCode = u-&gt;specialCode;
05749   ret-&gt;nullPred = u-&gt;nullPred;
05750   ret-&gt;access = u-&gt;access;
05751   ret-&gt;globs = <a class="code" href="globSet_c.html#a4">globSet_newCopy</a> (u-&gt;globs);
05752   ret-&gt;mods = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (u-&gt;mods);
05753   ret-&gt;defparams = u-&gt;defparams;
05754   ret-&gt;specclauses = <a class="code" href="specialClauses_c.html#a31">specialClauses_copy</a> (u-&gt;specclauses);
05755 
05756   <font class="keywordflow">return</font> ret;
05757 }
05758 
05759 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uiinfo
05760 uiinfo_copy (uiinfo u)<font class="keyword"></font>
05761 <font class="keyword"></font>{
05762   uiinfo ret = (uiinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05763 
05764   ret-&gt;access = u-&gt;access;
05765   ret-&gt;globs = <a class="code" href="globSet_c.html#a4">globSet_newCopy</a> (u-&gt;globs);
05766   ret-&gt;mods = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (u-&gt;mods);
05767 
05768   <font class="keywordflow">return</font> (ret);
05769 }
05770 
05771 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> ueinfo
05772 ueinfo_copy (ueinfo u)<font class="keyword"></font>
05773 <font class="keyword"></font>{
05774   ueinfo ret = (ueinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05775 
05776   ret-&gt;access = u-&gt;access;
05777   <font class="keywordflow">return</font> ret;
05778 }
05779 
05780 <font class="keyword">static</font> <font class="keywordtype">void</font>
05781 uinfo_free (uinfo u, ekind kind)<font class="keyword"></font>
05782 <font class="keyword"></font>{
05783   <font class="keywordflow">switch</font> (kind)
05784     {
05785     <font class="keywordflow">case</font> KENUMCONST:
05786     <font class="keywordflow">case</font> KCONST:       ucinfo_free (u-&gt;uconst); <font class="keywordflow">break</font>;
05787     <font class="keywordflow">case</font> KVAR:         uvinfo_free (u-&gt;var); <font class="keywordflow">break</font>;
05788     <font class="keywordflow">case</font> KSTRUCTTAG:
05789     <font class="keywordflow">case</font> KUNIONTAG:
05790     <font class="keywordflow">case</font> KENUMTAG:
05791     <font class="keywordflow">case</font> KDATATYPE:    udinfo_free (u-&gt;datatype); <font class="keywordflow">break</font>;
05792     <font class="keywordflow">case</font> KFCN:         ufinfo_free (u-&gt;fcn); <font class="keywordflow">break</font>;
05793     <font class="keywordflow">case</font> KITER:        uiinfo_free (u-&gt;iter); <font class="keywordflow">break</font>;
05794     <font class="keywordflow">case</font> KENDITER:     ueinfo_free (u-&gt;enditer); <font class="keywordflow">break</font>;
05795     <font class="keywordflow">case</font> KELIPSMARKER: <font class="keywordflow">break</font>;
05796     <font class="keywordflow">case</font> KINVALID:     <font class="keywordflow">break</font>;
05797     }
05798   
05799     <a class="code" href="general_c.html#a0">sfree</a> (u);
05800 }
05801 
05802 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> uinfo
05803 uinfo_copy (uinfo u, ekind kind)<font class="keyword"></font>
05804 <font class="keyword"></font>{
05805   <font class="keywordflow">if</font> (kind == KELIPSMARKER || kind == KINVALID)
05806     {
05807       <font class="keywordflow">return</font> NULL;
05808     }
05809   <font class="keywordflow">else</font>
05810     {
05811       uinfo ret = (uinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
05812       
05813       <font class="keywordflow">switch</font> (kind)
05814         {
05815         <font class="keywordflow">case</font> KENUMCONST:
05816         <font class="keywordflow">case</font> KCONST:    ret-&gt;uconst = ucinfo_copy (u-&gt;uconst); <font class="keywordflow">break</font>;
05817         <font class="keywordflow">case</font> KVAR:      ret-&gt;var = uvinfo_copy (u-&gt;var); <font class="keywordflow">break</font>;
05818         <font class="keywordflow">case</font> KSTRUCTTAG:
05819         <font class="keywordflow">case</font> KUNIONTAG:
05820         <font class="keywordflow">case</font> KENUMTAG:
05821         <font class="keywordflow">case</font> KDATATYPE: ret-&gt;datatype = udinfo_copy (u-&gt;datatype); <font class="keywordflow">break</font>;
05822         <font class="keywordflow">case</font> KFCN:      ret-&gt;fcn = ufinfo_copy (u-&gt;fcn); <font class="keywordflow">break</font>;
05823         <font class="keywordflow">case</font> KITER:     ret-&gt;iter = uiinfo_copy (u-&gt;iter); <font class="keywordflow">break</font>;
05824         <font class="keywordflow">case</font> KENDITER:  ret-&gt;enditer = ueinfo_copy (u-&gt;enditer); <font class="keywordflow">break</font>;
05825         BADDEFAULT;
05826         }
05827       <font class="keywordflow">return</font> ret;
05828     }
05829 }
05830 
05831 <font class="keyword">static</font> <font class="keywordtype">void</font>
05832 uentry_reallyFree (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> uentry e)<font class="keyword"></font>
05833 <font class="keyword"></font>{
05834   <a class="code" href="filelocList_c.html#a11">filelocList_free</a> (e-&gt;uses);
05835   <a class="code" href="cstring_c.html#a27">cstring_free</a> (e-&gt;uname);
05836   
05837   uinfo_free (e-&gt;info, e-&gt;ukind);
05838   
05839   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;whereSpecified); 
05840   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;whereDefined); 
05841   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;whereDeclared); 
05842 
05843   nuentries--;
05844   <a class="code" href="general_c.html#a0">sfree</a> (e);
05845   }
05846 
<a name="l05847"></a><a class="code" href="uentry_c.html#a237">05847</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a237">uentry_markOwned</a> (<font class="comment">/*@owned@*/</font> uentry u)<font class="keyword"></font>
05848 <font class="keyword"></font>{
05849   <a class="code" href="general_c.html#a1">sfreeEventually</a> (u);
05850 }
05851 
05852 <font class="keywordtype">void</font>
<a name="l05853"></a><a class="code" href="uentry_c.html#a238">05853</a> <a class="code" href="uentry_c.html#a238">uentry_free</a> (<font class="comment">/*@only@*/</font> uentry e)<font class="keyword"></font>
05854 <font class="keyword"></font>{
05855   <font class="keywordflow">if</font> (uentry_isValid (e) &amp;&amp; !uentry_isElipsisMarker (e))
05856     {
05857       uentry_reallyFree (e);
05858     }
05859 }
05860 
05861 <font class="comment">/*</font>
05862 <font class="comment">** For uentry's in the global or file scope</font>
05863 <font class="comment">*/</font>
05864 
05865 <font class="keywordtype">void</font>
<a name="l05866"></a><a class="code" href="uentry_c.html#a239">05866</a> <a class="code" href="uentry_c.html#a239">uentry_freeComplete</a> (<font class="comment">/*@only@*/</font> uentry e)<font class="keyword"></font>
05867 <font class="keyword"></font>{
05868   <font class="keywordflow">if</font> (uentry_isValid (e) &amp;&amp; !uentry_isElipsisMarker (e))
05869     {
05870       <font class="comment">/*@i@*/</font> <a class="code" href="sRef_c.html#a255">sRef_free</a> (e-&gt;sref);
05871       e-&gt;sref = sRef_undefined;
05872       uentry_reallyFree (e);
05873     }
05874 }
05875 
05876 <font class="comment">/*</font>
05877 <font class="comment">** requires old-&gt;kind != new-&gt;kind, old-&gt;uname = new-&gt;uname</font>
05878 <font class="comment">*/</font>
05879 
05880 <font class="keyword">static</font> <font class="keywordtype">void</font>
05881 KindConformanceError (<font class="comment">/*@unique@*/</font> uentry old, uentry unew, <font class="keywordtype">bool</font> mustConform)<font class="keyword"></font>
05882 <font class="keyword"></font>{
05883   llassert (uentry_isValid (old));
05884   llassert (uentry_isValid (unew));
05885 
05886   <font class="keywordflow">if</font> (uentry_isEitherConstant (unew)
05887       &amp;&amp; (fileloc_isPreproc (uentry_whereDeclared (old))
05888           || ctype_isUnknown (old-&gt;utype))
05889       &amp;&amp; !<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (old))
05890     {
05891       ; <font class="comment">/* no error */</font>
05892     }
05893   <font class="keywordflow">else</font> 
05894     {
05895       <font class="keywordflow">if</font> (mustConform)
05896         {
05897           <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old))
05898             {
05899               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (old))
05900                 {
05901                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (unew))
05902                     {
05903                       llbuglit (<font class="stringliteral">"Respecification!"</font>);
05904                     }
05905                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (unew))
05906                     {
05907                       <font class="keywordflow">if</font> (optgenerror
05908                           (FLG_INCONDEFS,
05909                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently declared as %s: %t"</font>,
05910                                     ekind_capName (old-&gt;ukind),
05911                                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
05912                                     <a class="code" href="ekind_c.html#a2">ekind_unparseLong</a> (unew-&gt;ukind),
05913                                     unew-&gt;utype),
05914                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
05915                         {
05916                           <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
05917                         }
05918                     }
05919                   <font class="keywordflow">else</font>
05920                     {
05921                       BADEXIT;
05922                     }
05923                 }
05924               <font class="keywordflow">else</font>
05925                 {
05926                   <font class="keywordflow">if</font> (optgenerror
05927                       (FLG_INCONDEFS,
05928                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently declared as %s: %t"</font>,
05929                                 ekind_capName (old-&gt;ukind),
05930                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
05931                                 <a class="code" href="ekind_c.html#a2">ekind_unparseLong</a> (unew-&gt;ukind),
05932                                 unew-&gt;utype),
05933                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
05934                     {
05935                       <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
05936                     }
05937                 }
05938             }
05939           <font class="keywordflow">else</font>
05940             {
05941               llassert (uentry_isDeclared (unew));
05942 
05943               <font class="keywordflow">if</font> (optgenerror
05944                   (FLG_INCONDEFS,
05945                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently redeclared as %s"</font>,
05946                             ekind_capName (old-&gt;ukind),
05947                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
05948                             <a class="code" href="ekind_c.html#a2">ekind_unparseLong</a> (unew-&gt;ukind)),
05949                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
05950                 {
05951                   <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
05952                 }
05953             }
05954         }
05955     }
05956 
05957   uentry_copyInto (old, unew);
05958 }
05959 
05960 <font class="comment">/*</font>
05961 <font class="comment">** def is the definition of spec, modifies spec</font>
05962 <font class="comment">**</font>
05963 <font class="comment">** reports any inconsistencies</font>
05964 <font class="comment">** returns the summary of all available information</font>
05965 <font class="comment">** if spec and def are inconsistent, def is returned</font>
05966 <font class="comment">*/</font>
05967 
05968 <font class="keywordtype">void</font>
<a name="l05969"></a><a class="code" href="uentry_c.html#a241">05969</a> <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (uentry spec)<font class="keyword"></font>
05970 <font class="keyword"></font>{
05971   <font class="keywordflow">if</font> (uentry_isValid (spec))
05972     {
05973       <font class="keywordflow">if</font> (fileloc_isDefined (spec-&gt;whereDefined)
05974           &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (spec-&gt;whereDefined)
05975           &amp;&amp; !fileloc_isPreproc (spec-&gt;whereDefined))
05976         {
05977           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous definition of %q: %t"</font>, 
05978                                    uentry_getName (spec),
05979                                    <a class="code" href="uentry_c.html#a197">uentry_getType</a> (spec)),
05980                           <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (spec));
05981         }
05982       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
05983         {
05984           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q: %t"</font>, 
05985                                    uentry_getName (spec),
05986                                    <a class="code" href="uentry_c.html#a197">uentry_getType</a> (spec)),
05987                           <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
05988         }
05989       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
05990         {
05991           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
05992             {
05993               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q: %t"</font>, 
05994                                        uentry_getName (spec),
05995                                        <a class="code" href="uentry_c.html#a197">uentry_getType</a> (spec)),
05996                               <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
05997             }
05998           <font class="keywordflow">else</font>
05999             {
06000               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification: %t"</font>, uentry_getType (spec)),
06001                               <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06002             }
06003         }
06004       <font class="keywordflow">else</font>
06005         {
06006           <font class="comment">/* nothing to show */</font>
06007         }
06008     }
06009 }
06010 
06011 <font class="keywordtype">void</font>
<a name="l06012"></a><a class="code" href="uentry_c.html#a242">06012</a> <a class="code" href="uentry_c.html#a242">uentry_showDefSpecInfo</a> (uentry ce, fileloc fwhere)<font class="keyword"></font>
06013 <font class="keyword"></font>{
06014   fileloc loc = <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (ce);
06015   
06016   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (loc) &amp;&amp; !<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (loc, fwhere))
06017     {
06018       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Definition of %q"</font>, uentry_getName (ce)),
06019                       loc);
06020     }
06021 
06022   loc = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (ce);
06023   
06024   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (loc) &amp;&amp; !<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (loc, fwhere))
06025     {
06026       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q"</font>, uentry_getName (ce)),
06027                       loc);
06028     }
06029 }
06030 
<a name="l06031"></a><a class="code" href="uentry_c.html#a243">06031</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a243">uentry_showWhereLastExtra</a> (uentry spec, cstring extra)<font class="keyword"></font>
06032 <font class="keyword"></font>{
06033   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06034     {
06035       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q: %q"</font>, 
06036                                uentry_getName (spec), extra),
06037                       <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06038     }
06039   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06040     {
06041       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q: %q"</font>, 
06042                                uentry_getName (spec), extra),
06043                       <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06044     }
06045   <font class="keywordflow">else</font>
06046     {
06047       <a class="code" href="cstring_c.html#a27">cstring_free</a> (extra);
06048     }
06049 }
06050 
06051 <font class="keywordtype">void</font>
<a name="l06052"></a><a class="code" href="uentry_c.html#a244">06052</a> <a class="code" href="uentry_c.html#a244">uentry_showWhereDeclared</a> (uentry spec)<font class="keyword"></font>
06053 <font class="keyword"></font>{
06054   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06055     {
06056       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06057         {
06058           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Declaration of %q"</font>, uentry_getName (spec)),
06059                           <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06060         }
06061       <font class="keywordflow">else</font>
06062         {
06063           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Declaration"</font>), <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06064         }
06065     }
06066   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06067     {
06068       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06069         {
06070           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q"</font>, uentry_getName (spec)),
06071                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06072         }
06073       <font class="keywordflow">else</font>
06074         {
06075           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Specification"</font>), <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06076         }
06077     }
06078   <font class="keywordflow">else</font>
06079     {
06080       <font class="comment">/* nothing to show */</font>
06081     }
06082     
06083 }
06084 
06085 <font class="keywordtype">void</font>
<a name="l06086"></a><a class="code" href="uentry_c.html#a245">06086</a> <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (uentry spec)<font class="keyword"></font>
06087 <font class="keyword"></font>{
06088   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06089     {
06090       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06091         {
06092           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Declaration of %q"</font>, uentry_getName (spec)),
06093                           <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06094         }
06095       <font class="keywordflow">else</font>
06096         {
06097           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Declaration"</font>), <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06098         }
06099     }
06100   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06101     {
06102       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06103         {
06104           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q"</font>,
06105                                    uentry_getName (spec)),
06106                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06107         }
06108       <font class="keywordflow">else</font>
06109         {
06110           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Specification"</font>), 
06111                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06112         }
06113     }
06114   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isDefined (uentry_whereDefined (spec))) 
06115     {
06116       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06117         {
06118           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Definition of %q"</font>, uentry_getName (spec)),
06119                           <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (spec));
06120         }
06121       <font class="keywordflow">else</font>
06122         {
06123           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Definition"</font>), <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (spec));
06124         }
06125     }
06126   <font class="keywordflow">else</font>
06127     {
06128       <font class="comment">/* nothing to show */</font>
06129     }
06130 }
06131 
06132 <font class="keywordtype">void</font>
<a name="l06133"></a><a class="code" href="uentry_c.html#a246">06133</a> <a class="code" href="uentry_c.html#a246">uentry_showWhereDefined</a> (uentry spec)<font class="keyword"></font>
06134 <font class="keyword"></font>{
06135   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (spec))
06136     {
06137       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous definition of %q"</font>, uentry_getName (spec)),
06138                       <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (spec));
06139     }
06140 }
06141 
06142 <font class="keywordtype">void</font>
<a name="l06143"></a><a class="code" href="uentry_c.html#a247">06143</a> <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (uentry spec)<font class="keyword"></font>
06144 <font class="keyword"></font>{
06145   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06146     {
06147       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q"</font>, uentry_getName (spec)),
06148                       <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06149     }
06150   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06151     {
06152       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q"</font>, uentry_getName (spec)),
06153                       <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06154     }
06155   <font class="keywordflow">else</font>
06156     {
06157           }
06158 }
06159 
06160 <font class="keyword">static</font> <font class="keywordtype">void</font>
06161 uentry_showWhereLastVal (uentry spec, cstring val)<font class="keyword"></font>
06162 <font class="keyword"></font>{
06163   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06164     {
06165       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q: %s"</font>, 
06166                                uentry_getName (spec), val),
06167                       <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06168     }
06169   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06170     {
06171       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q: %s"</font>, 
06172                                uentry_getName (spec), val),
06173                       <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06174     }
06175   <font class="keywordflow">else</font>
06176     {
06177     }
06178 }
06179 
06180 <font class="keywordtype">void</font>
<a name="l06181"></a><a class="code" href="uentry_c.html#a249">06181</a> <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (uentry spec)<font class="keyword"></font>
06182 <font class="keyword"></font>{
06183   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06184     {
06185       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06186         {
06187           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q"</font>, uentry_getName (spec)),
06188                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06189         }
06190       <font class="keywordflow">else</font>
06191         {
06192           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Specification"</font>), 
06193                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06194         }
06195     }
06196   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06197     {
06198       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Declaration of %q"</font>, uentry_getName (spec)),
06199                       <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06200     }
06201   <font class="keywordflow">else</font>
06202     {
06203       <font class="comment">/* nothing to show */</font>
06204     }
06205 }
06206 
06207 <font class="keywordtype">void</font>
<a name="l06208"></a><a class="code" href="uentry_c.html#a250">06208</a> <a class="code" href="uentry_c.html#a250">uentry_showWhereSpecifiedExtra</a> (uentry spec, cstring s)<font class="keyword"></font>
06209 <font class="keyword"></font>{
06210   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (spec))
06211     {
06212       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (spec))
06213         {
06214           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification of %q: %q"</font>, 
06215                                    uentry_getName (spec), s),
06216                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06217         }
06218       <font class="keywordflow">else</font>
06219         {
06220           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Specification: %q"</font>, s), 
06221                           <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (spec));
06222         }
06223     }
06224   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (spec))
06225     {
06226       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Declaration of %q: %q"</font>, 
06227                                uentry_getName (spec), s),
06228                       <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (spec));
06229     }
06230   <font class="keywordflow">else</font>
06231     {
06232       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous: %q"</font>, s),
06233                       <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (spec));
06234     }
06235 }
06236 
06237 <font class="comment">/*</font>
06238 <font class="comment">**</font>
06239 <font class="comment">*/</font>
06240 
06241 <font class="keyword">static</font> <font class="keywordtype">void</font>
06242 checkStructConformance (uentry old, uentry unew)<font class="keyword"></font>
06243 <font class="keyword"></font>{
06244   ctype oldr, newr; 
06245   uentryList fold, fnew;
06246 
06247   <font class="comment">/*</font>
06248 <font class="comment">  ** requires: types of old and new are structs or unions</font>
06249 <font class="comment">  */</font>
06250 
06251   llassert (uentry_isValid (old));
06252   llassert (uentry_isValid (unew));
06253 
06254   oldr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (old-&gt;utype);
06255   fold =  <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (oldr);
06256 
06257   newr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (unew-&gt;utype);
06258   fnew = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (newr);
06259 
06260   <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a35">uentryList_matchFields</a> (fold, fnew))
06261     {
06262       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (uentry_whereLast (old),
06263                          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
06264         {
06265           ; <font class="comment">/* cheat! */</font>
06266         }
06267       <font class="keywordflow">else</font> 
06268         {
06269           <font class="keywordflow">if</font> (optgenerror 
06270               (FLG_MATCHFIELDS,
06271                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q %rdeclared with fields { %q }, %s "</font>
06272                         <font class="stringliteral">"with fields { %q }"</font>,
06273                         cstring_makeLiteral (ctype_isStruct (newr) ? <font class="stringliteral">"Structure"</font>: <font class="stringliteral">"Union"</font>),
06274                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (old), 
06275                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06276                         <a class="code" href="uentryList_c.html#a9">uentryList_unparseAbbrev</a> (fnew),
06277                         <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06278                         <a class="code" href="uentryList_c.html#a9">uentryList_unparseAbbrev</a> (fold)),
06279                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06280             {
06281               <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
06282               <a class="code" href="uentryList_c.html#a34">uentryList_showFieldDifference</a> (fold, fnew);
06283             }
06284         }
06285 
06286       old-&gt;utype = unew-&gt;utype;
06287     }
06288 }
06289 
06290 <font class="keyword">static</font> <font class="keywordtype">void</font>
06291 checkEnumConformance (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew)<font class="keyword"></font>
06292 <font class="keyword"></font>{
06293   <font class="comment">/*</font>
06294 <font class="comment">  ** requires old and new are enums</font>
06295 <font class="comment">  */</font>
06296   
06297   ctype        rold = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (old-&gt;utype);
06298   ctype        rnew = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (unew-&gt;utype);
06299   enumNameList eold = <a class="code" href="ctype_c.html#a114">ctype_elist</a> (rold);
06300   enumNameList enew = <a class="code" href="ctype_c.html#a114">ctype_elist</a> (rnew);
06301   
06302   <font class="keywordflow">if</font> (!<a class="code" href="enumNameList_c.html#a2">enumNameList_match</a> (eold, enew))
06303     {
06304       <font class="keywordflow">if</font> (optgenerror 
06305           (FLG_MATCHFIELDS,
06306            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enum %q declared with members { %q } but "</font>
06307                     <font class="stringliteral">"specified with members { %q }"</font>,
06308                     uentry_getName (old), 
06309                     <a class="code" href="enumNameList_c.html#a9">enumNameList_unparse</a> (enew),
06310                     <a class="code" href="enumNameList_c.html#a9">enumNameList_unparse</a> (eold)),
06311            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06312         {
06313           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06314           old-&gt;utype = unew-&gt;utype;
06315         }
06316     }
06317 }
06318 
06319 <font class="comment">/*</font>
06320 <font class="comment">** either oldCurrent or newCurrent may be undefined!</font>
06321 <font class="comment">*/</font>
06322 
06323 <font class="keyword">static</font> <font class="keywordtype">void</font>
06324 paramTypeError (uentry old, uentry oldCurrent, ctype oldType,
06325                 uentry unew, uentry newCurrent, ctype newType,
06326                 <font class="keywordtype">int</font> paramno)<font class="keyword"></font>
06327 <font class="keyword"></font>{
06328   <font class="keywordtype">bool</font> hasError = FALSE;
06329 
06330   <font class="keywordflow">if</font> (uentry_isValid (newCurrent) &amp;&amp; <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (newCurrent))
06331     {
06332       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (newCurrent))
06333         {
06334           hasError = optgenerror 
06335             (FLG_TYPE,
06336              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %d, %q, of function %q has inconsistent type: "</font>
06337                       <font class="stringliteral">"declared %t, %s %t"</font>,
06338                       paramno + 1, uentry_getName (newCurrent), 
06339                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06340                       newType, <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old), oldType),
06341              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (newCurrent));
06342         }
06343       <font class="keywordflow">else</font>
06344         {
06345           hasError = optgenerror
06346             (FLG_TYPE,
06347              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %d of function %q has inconsistent type: "</font>
06348                       <font class="stringliteral">"declared %t, %s %t"</font>,
06349                       paramno + 1, uentry_getName (unew),
06350                       newType, <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old), oldType),
06351              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (newCurrent));
06352 
06353           DPRINTF ((<font class="stringliteral">"type: %s / %s"</font>,
06354                     ctype_unparse (newType),
06355                     <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ctype_realType (newType))));
06356         }
06357     }
06358   <font class="keywordflow">else</font> 
06359     {
06360       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (unew))
06361         {
06362           hasError = optgenerror 
06363             (FLG_TYPE,
06364              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %d of function %s has inconsistent type: "</font>
06365                       <font class="stringliteral">"declared %t, %s %t"</font>,
06366                       paramno + 1, unew-&gt;uname, 
06367                       newType, uentry_specOrDefName (old), oldType),
06368              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew));
06369         }
06370       <font class="keywordflow">else</font>
06371         {
06372           hasError = optgenerror
06373             (FLG_TYPE,
06374              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %d of function %s has inconsistent type: "</font>
06375                       <font class="stringliteral">"declared %t, %s %t"</font>,
06376                       paramno + 1, unew-&gt;uname, 
06377                       newType, uentry_specOrDefName (old), oldType),
06378              <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew));
06379         }
06380     }
06381   
06382   <font class="keywordflow">if</font> (hasError)
06383     {
06384       <font class="keywordflow">if</font> (!uentry_isUndefined (oldCurrent))
06385         {
06386           <font class="keywordflow">if</font> (!uentry_isUndefined (newCurrent) 
06387               &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (uentry_rawName (newCurrent), <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (oldCurrent)))
06388             {
06389               <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (oldCurrent);
06390             }
06391           <font class="keywordflow">else</font>
06392             {
06393               <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
06394             }
06395           
06396           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (oldCurrent, newType);
06397         }
06398       <font class="keywordflow">else</font>
06399         {
06400           <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
06401         }
06402     }
06403 }
06404 
06405 <font class="keyword">static</font> <font class="keywordtype">void</font>
06406 nargsError (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew)<font class="keyword"></font>
06407 <font class="keyword"></font>{
06408   <font class="keywordflow">if</font> (optgenerror 
06409       (FLG_TYPE,
06410        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s %rdeclared with %d arg%p, %s with %d"</font>,
06411                 unew-&gt;uname, 
06412                 uentry_isDeclared (old),
06413                 <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (uentry_getParams (unew)),
06414                 <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06415                 <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (uentry_getParams (old))),
06416        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06417     {
06418       <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
06419     }
06420 }
06421 
06422 <font class="keyword">static</font> <font class="keywordtype">void</font>
06423 returnValueError (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew)<font class="keyword"></font>
06424 <font class="keyword"></font>{
06425   <font class="keywordflow">if</font> (optgenerror
06426       (FLG_INCONDEFS,
06427        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s inconsistently %rdeclared to return %t"</font>,
06428                 unew-&gt;uname,
06429                 uentry_isDeclared (old),
06430                 <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (unew-&gt;utype)),
06431        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06432     {
06433       uentry_showWhereLastVal (old, ctype_unparse (ctype_returnValue (old-&gt;utype)));
06434     }
06435 }
06436 
06437 <font class="keyword">static</font> cstring paramStorageName (uentry ue)<font class="keyword"></font>
06438 <font class="keyword"></font>{
06439   <font class="keywordflow">return</font> (cstring_makeLiteralTemp (uentry_isParam (ue) ? <font class="stringliteral">"param"</font> : <font class="stringliteral">"storage"</font>));
06440 }
06441 
06442 <font class="keyword">static</font> cstring fcnErrName (uentry ue)<font class="keyword"></font>
06443 <font class="keyword"></font>{
06444   <font class="keywordflow">return</font> (cstring_makeLiteralTemp (uentry_isFunction (ue) ? <font class="stringliteral">"to return"</font> : <font class="stringliteral">"as"</font>));
06445 }
06446 
<a name="l06447"></a><a class="code" href="uentry_c.html#a253">06447</a> <font class="keyword">extern</font> <font class="comment">/*@observer@*/</font> cstring <a class="code" href="uentry_c.html#a253">uentry_checkedName</a> (uentry ue)<font class="keyword"></font>
06448 <font class="keyword"></font>{
06449   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue))
06450     {
06451       <font class="keywordflow">return</font> (checkedName (ue-&gt;info-&gt;var-&gt;checked));
06452     }
06453   <font class="keywordflow">else</font>
06454     {
06455       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"&lt;checked invalid&gt;"</font>));
06456     }
06457 }
06458 
06459 <font class="keyword">static</font> cstring checkedName (chkind checked)<font class="keyword"></font>
06460 <font class="keyword"></font>{
06461   <font class="keywordflow">switch</font> (checked)
06462     {
06463     <font class="keywordflow">case</font> CH_UNKNOWN:       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"unknown"</font>));
06464     <font class="keywordflow">case</font> CH_UNCHECKED:     <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"unchecked"</font>));
06465     <font class="keywordflow">case</font> CH_CHECKED:       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"checked"</font>));
06466     <font class="keywordflow">case</font> CH_CHECKMOD:      <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"checkmod"</font>));
06467     <font class="keywordflow">case</font> CH_CHECKEDSTRICT: <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"checkedstrict"</font>));
06468     }
06469   BADEXIT;
06470 }
06471 
06472 <font class="keyword">static</font>
06473 <font class="keywordtype">void</font> checkNullState (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06474 <font class="keyword"></font>{
06475   nstate oldState;
06476   nstate newState;
06477   
06478   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (unew))
06479     {
06480       llassert (uentry_isVar (old));
06481       
06482       oldState = old-&gt;info-&gt;var-&gt;nullstate;
06483       newState = unew-&gt;info-&gt;var-&gt;nullstate;
06484     }
06485   <font class="keywordflow">else</font>
06486     {
06487       oldState = sRef_getNullState (old-&gt;sref);
06488       newState = sRef_getNullState (unew-&gt;sref);
06489     }
06490 
06491   <font class="keywordflow">if</font> (oldState == NS_ABSNULL)
06492     {
06493       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (old))
06494         {
06495           old-&gt;info-&gt;var-&gt;nullstate = newState;
06496         }
06497       
06498       <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (old-&gt;sref, newState);
06499     }
06500   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (newState == NS_UNKNOWN)
06501     {
06502       <font class="keywordflow">if</font> (completeConform &amp;&amp; newState != oldState
06503           &amp;&amp; uentry_isReallySpecified (old))
06504         {
06505           <font class="keywordflow">if</font> (optgenerror 
06506               (FLG_NEEDSPEC,
06507                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified as %s, but declared without %s qualifier"</font>,
06508                         ekind_capName (unew-&gt;ukind),
06509                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06510                         <a class="code" href="varKinds_c.html#a7">nstate_unparse</a> (oldState),
06511                         <a class="code" href="varKinds_c.html#a7">nstate_unparse</a> (oldState)),
06512                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06513             {
06514               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06515             }
06516         }
06517       
06518       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (unew))
06519         {
06520           unew-&gt;info-&gt;var-&gt;nullstate = oldState;
06521         }
06522 
06523       <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (unew-&gt;sref, oldState);
06524     }
06525   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (newState == NS_POSNULL)
06526     {
06527       <font class="keywordflow">if</font> (oldState == NS_MNOTNULL 
06528           &amp;&amp; (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (unew-&gt;utype) 
06529               || (uentry_isFunction (unew)
06530                   &amp;&amp; <a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ctype_returnValue (unew-&gt;utype)))))
06531         {
06532           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (unew))
06533             {
06534               unew-&gt;info-&gt;var-&gt;nullstate = oldState;
06535             }
06536 
06537           <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (unew-&gt;sref, oldState);
06538         }
06539       <font class="keywordflow">else</font> 
06540         {
06541           <font class="keywordflow">if</font> (oldState == NS_NOTNULL || oldState == NS_MNOTNULL 
06542               || oldState == NS_UNKNOWN)
06543             {
06544               <font class="keywordflow">if</font> (mustConform)
06545                 {
06546                   <font class="keywordflow">if</font> (optgenerror 
06547                       (FLG_INCONDEFS,
06548                        message 
06549                        (<font class="stringliteral">"%s %q inconsistently %rdeclared %s possibly null storage, "</font>
06550                         <font class="stringliteral">"%s %q qualifier"</font>,
06551                         <a class="code" href="uentry_c.html#a282">uentry_ekindName</a> (unew),
06552                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06553                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06554                         fcnErrName (unew),
06555                         <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06556                         cstring_makeLiteral (oldState == NS_MNOTNULL ? <font class="stringliteral">"with notnull"</font> : <font class="stringliteral">"without null"</font>)),
06557                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06558                     {
06559                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06560                     }
06561                 }
06562             }
06563           
06564           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (old))
06565             {
06566               old-&gt;info-&gt;var-&gt;nullstate = newState;
06567             }
06568 
06569           <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (old-&gt;sref, newState);
06570         }
06571     }
06572   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (newState == NS_MNOTNULL)
06573     {
06574       <font class="keywordflow">if</font> (oldState != NS_MNOTNULL)
06575         {
06576           <font class="keywordflow">if</font> (mustConform)
06577             {
06578               <font class="keywordflow">if</font> (optgenerror 
06579                   (FLG_INCONDEFS,
06580                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s notnull storage, "</font>
06581                             <font class="stringliteral">"%s without notnull qualifier"</font>,
06582                             uentry_ekindName (unew),
06583                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06584                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06585                             fcnErrName (unew),
06586                             <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old)),
06587                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06588                 {
06589                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06590                 }
06591             }
06592           
06593           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (old))
06594             {
06595               old-&gt;info-&gt;var-&gt;nullstate = newState;
06596             }
06597 
06598           <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (old-&gt;sref, newState);
06599         }
06600     }
06601   <font class="keywordflow">else</font>
06602     {
06603       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (unew)) 
06604         {
06605           unew-&gt;info-&gt;var-&gt;nullstate = oldState;
06606         }
06607 
06608       <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (unew-&gt;sref, oldState);
06609     }
06610 }
06611 
06612 <font class="keyword">static</font>
06613 <font class="keywordtype">void</font> checkDefState (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, 
06614                     <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06615 <font class="keyword"></font>{
06616   sstate oldState;
06617   sstate newState;
06618   <font class="keywordtype">bool</font> vars = FALSE;
06619 
06620   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a161">uentry_isVar</a> (unew))
06621     {
06622       oldState = old-&gt;info-&gt;var-&gt;defstate;
06623       newState = unew-&gt;info-&gt;var-&gt;defstate;
06624       vars = TRUE;
06625     }
06626   <font class="keywordflow">else</font>
06627     {
06628       oldState = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (old-&gt;sref);
06629       newState = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (unew-&gt;sref);
06630     }
06631 
06632   <font class="keywordflow">if</font> (newState != oldState &amp;&amp; newState != SS_UNKNOWN &amp;&amp; newState != SS_DEFINED)
06633     {
06634       <font class="keywordflow">if</font> (mustConform)
06635         {
06636           <font class="keywordflow">if</font> (optgenerror 
06637               (FLG_INCONDEFS,
06638                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s %s %s, "</font>
06639                         <font class="stringliteral">"%s %s %s %s"</font>,
06640                         uentry_ekindName (unew),
06641                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06642                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06643                         fcnErrName (unew),
06644                         <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (newState),
06645                         paramStorageName (unew),
06646                         <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06647                         fcnErrName (unew),
06648                         <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (oldState),
06649                         paramStorageName (unew)),
06650                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06651             {
06652               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06653             }
06654         }
06655       
06656       <font class="keywordflow">if</font> (vars) old-&gt;info-&gt;var-&gt;defstate = newState;
06657       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (old-&gt;sref, newState, uentry_whereDeclared (unew));
06658     }
06659   <font class="keywordflow">else</font>
06660     {
06661       <font class="keywordflow">if</font> (completeConform
06662           &amp;&amp; (newState != oldState) &amp;&amp; (oldState != SS_DEFINED)
06663           &amp;&amp; uentry_isReallySpecified (old))
06664         {
06665           <font class="keywordflow">if</font> (optgenerror 
06666               (FLG_NEEDSPEC,
06667                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified as %s, but declared without %s qualifier"</font>,
06668                         ekind_capName (unew-&gt;ukind),
06669                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06670                         <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (oldState),
06671                         <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (oldState)),
06672                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06673             {
06674               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06675             }
06676         }
06677 
06678       <font class="keywordflow">if</font> (vars) unew-&gt;info-&gt;var-&gt;defstate = oldState;
06679       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (unew-&gt;sref, oldState, uentry_whereDeclared (unew));
06680     }
06681 }
06682 
06683 <font class="keyword">static</font> <font class="keywordtype">void</font> 
06684   checkAliasState (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, 
06685                    <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06686 <font class="keyword"></font>{
06687   alkind newKind;
06688   alkind oldKind;
06689 
06690   oldKind = sRef_getAliasKind (old-&gt;sref);
06691   newKind = sRef_getAliasKind (unew-&gt;sref);
06692 
06693   <font class="keywordflow">if</font> (alkind_isImplicit (newKind) 
06694       || (alkind_isRefCounted (newKind) &amp;&amp; !<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (unew)))
06695     {
06696       <font class="keywordflow">if</font> (completeConform &amp;&amp; !<a class="code" href="varKinds_c.html#a21">alkind_equal</a> (newKind, oldKind)
06697           &amp;&amp; uentry_isReallySpecified (old))
06698         {
06699           <font class="keywordflow">if</font> (optgenerror 
06700               (FLG_NEEDSPEC,
06701                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified as %s, but declared without "</font>
06702                         <font class="stringliteral">"explicit alias qualifier"</font>,
06703                         ekind_capName (unew-&gt;ukind),
06704                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06705                         <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (oldKind)),
06706                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06707             {
06708               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06709             }
06710         }
06711 
06712       <font class="comment">/*  </font>
06713 <font class="comment">      ** This really shouldn't be necessary, but it is!</font>
06714 <font class="comment">      ** Function params (?) use new here.</font>
06715 <font class="comment">      */</font>
06716 
06717       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (unew-&gt;sref, oldKind, uentry_whereDeclared (unew));
06718       <font class="keywordflow">return</font>;
06719     }
06720 
06721   <font class="keywordflow">if</font> (alkind_isKnown (newKind))
06722     {
06723       <font class="keywordflow">if</font> (!<a class="code" href="varKinds_c.html#a21">alkind_equal</a> (oldKind, newKind))
06724         {
06725           <font class="keywordflow">if</font> (alkind_isKnown (oldKind))
06726             {
06727               <font class="keywordflow">if</font> (mustConform &amp;&amp; 
06728                   optgenerror 
06729                   (FLG_INCONDEFS,
06730                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s %s storage, "</font>
06731                             <font class="stringliteral">"%s as %s storage"</font>,
06732                             uentry_ekindName (unew),
06733                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06734                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06735                             fcnErrName (unew),
06736                             <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (newKind),
06737                             <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06738                             <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (oldKind)),
06739                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06740                 {
06741                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06742 
06743                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (old-&gt;sref, AK_ERROR, 
06744                                      uentry_whereDeclared (unew));
06745                 }
06746               <font class="keywordflow">else</font>
06747                 {
06748                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (old-&gt;sref, newKind, 
06749                                      uentry_whereDeclared (unew));
06750                 }
06751             }
06752           <font class="keywordflow">else</font>
06753             {
06754               <font class="keywordflow">if</font> (!(alkind_isImplicit (newKind)))
06755                 {
06756                   <font class="keywordflow">if</font> (mustConform &amp;&amp;
06757                       !uentry_isFunction (unew) &amp;&amp;
06758                       optgenerror 
06759                       (FLG_INCONDEFS,
06760                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s %s storage, "</font>
06761                                 <font class="stringliteral">"implicitly %s as temp storage"</font>,
06762                                 uentry_ekindName (unew),
06763                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06764                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06765                                 fcnErrName (unew),
06766                                 <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (newKind),
06767                                 <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old)),
06768                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06769                     {
06770                       <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06771                       oldKind = AK_ERROR;
06772                     }
06773                   
06774                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (old-&gt;sref, newKind, 
06775                                      uentry_whereDeclared (unew));
06776                 }
06777               <font class="keywordflow">else</font> <font class="comment">/* newKind is temp or refcounted */</font>
06778                 {
06779                   ;
06780                 }
06781             }
06782         }
06783     }
06784   <font class="keywordflow">else</font> <font class="comment">/* newKind unknown */</font>
06785     {
06786       ;
06787     }
06788 }
06789 
06790 <font class="keyword">static</font> <font class="keywordtype">void</font> 
06791   checkExpState(<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, 
06792                 <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06793 <font class="keyword"></font>{
06794   exkind newKind;
06795   exkind oldKind;
06796   
06797   oldKind = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (old-&gt;sref);
06798   newKind = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (unew-&gt;sref);
06799 
06800   <font class="keywordflow">if</font> (exkind_isKnown (newKind))
06801     {
06802       <font class="keywordflow">if</font> (oldKind != newKind)
06803         {
06804           <font class="keywordflow">if</font> (exkind_isKnown (oldKind))
06805             {
06806               <font class="keywordflow">if</font> (mustConform &amp;&amp; 
06807                   optgenerror 
06808                   (FLG_INCONDEFS,
06809                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s %s, %s as %s"</font>,
06810                             uentry_ekindName (unew),
06811                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06812                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06813                             fcnErrName (unew),
06814                             <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (newKind),
06815                             <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old),
06816                             <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (oldKind)),
06817                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06818                 {
06819                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06820                 }
06821 
06822               <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (old-&gt;sref, newKind, uentry_whereDefined (unew));
06823             }
06824           <font class="keywordflow">else</font>
06825             {
06826               <font class="keywordflow">if</font> (mustConform &amp;&amp;
06827                   optgenerror 
06828                   (FLG_INCONDEFS,
06829                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared %s %s, "</font>
06830                             <font class="stringliteral">"implicitly %s without exposure qualifier"</font>,
06831                             uentry_ekindName (unew),
06832                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06833                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06834                             fcnErrName (unew),
06835                             <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (newKind),
06836                             <a class="code" href="uentry_c.html#a36">uentry_specOrDefName</a> (old)),
06837                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06838                 {
06839                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06840                 }
06841 
06842               <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (old-&gt;sref, newKind, uentry_whereDefined (unew));
06843             }
06844         }
06845     }
06846   <font class="keywordflow">else</font>
06847     {
06848       <font class="keywordflow">if</font> (completeConform &amp;&amp; exkind_isKnown (oldKind)
06849           &amp;&amp; uentry_isReallySpecified (old))
06850         {
06851           <font class="keywordflow">if</font> (optgenerror 
06852               (FLG_NEEDSPEC,
06853                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified as %s, but declared without "</font>
06854                         <font class="stringliteral">"exposure qualifier"</font>,
06855                         ekind_capName (unew-&gt;ukind),
06856                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06857                         <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (oldKind)),
06858                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06859             {
06860               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06861             }
06862         }
06863 
06864       <font class="comment">/* yes, this is necessary! (if its a param) */</font>
06865       <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (unew-&gt;sref, oldKind, fileloc_undefined);
06866     }
06867 }
06868 
06869 <font class="keyword">static</font> <font class="keywordtype">void</font>
06870 uentry_checkStateConformance (<font class="comment">/*@notnull@*/</font> uentry old,
06871                               <font class="comment">/*@notnull@*/</font> uentry unew,
06872                               <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06873 <font class="keyword"></font>{
06874   checkDefState (old, unew, mustConform, completeConform);
06875   checkNullState (old, unew, mustConform, completeConform);
06876   checkAliasState (old, unew, mustConform, completeConform);
06877   checkExpState (old, unew, mustConform, completeConform);
06878 
06879   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (old-&gt;sref);
06880   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (unew-&gt;sref);
06881 }
06882 
06883 <font class="keyword">static</font> <font class="keywordtype">void</font>
06884 checkVarConformance (uentry old, uentry unew, <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
06885 <font class="keyword"></font>{
06886   <font class="keywordflow">if</font> (uentry_isElipsisMarker (old) || uentry_isElipsisMarker (unew))
06887     {
06888       <font class="keywordflow">return</font>;
06889     }
06890 
06891   llassert (uentry_isVar (old));
06892   llassert (uentry_isVar (unew));
06893 
06894   <font class="keywordflow">if</font> (cstring_isEmpty (old-&gt;uname)) 
06895     {
06896       <a class="code" href="cstring_c.html#a27">cstring_free</a> (old-&gt;uname);
06897       old-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (unew-&gt;uname);
06898     }
06899 
06900   <font class="keywordflow">if</font> (unew-&gt;info-&gt;var-&gt;kind == VKRETPARAM
06901       || unew-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM)
06902     {
06903       <font class="keywordflow">if</font> (old-&gt;info-&gt;var-&gt;kind != VKRETPARAM
06904           &amp;&amp; old-&gt;info-&gt;var-&gt;kind != VKSEFRETPARAM)
06905         {
06906           <font class="keywordflow">if</font> (optgenerror 
06907               (FLG_INCONDEFS,
06908                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %q inconsistently %rdeclared as "</font>
06909                         <font class="stringliteral">"returned parameter"</font>,
06910                         uentry_getName (unew),
06911                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
06912                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06913             {
06914               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06915               old-&gt;info-&gt;var-&gt;kind = unew-&gt;info-&gt;var-&gt;kind;
06916             }
06917         }
06918     }
06919 
06920 
06921   <font class="keywordflow">if</font> (unew-&gt;info-&gt;var-&gt;kind == VKSEFPARAM || unew-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM)
06922     {
06923       <font class="keywordflow">if</font> (old-&gt;info-&gt;var-&gt;kind != VKSEFPARAM 
06924           &amp;&amp; old-&gt;info-&gt;var-&gt;kind != VKSEFRETPARAM)
06925         {
06926           <font class="keywordflow">if</font> (optgenerror 
06927               (FLG_INCONDEFS,
06928                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %qinconsistently %rdeclared as "</font>
06929                         <font class="stringliteral">"sef parameter"</font>,
06930                         uentry_getOptName (unew),
06931                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
06932                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06933             {
06934               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06935               old-&gt;info-&gt;var-&gt;kind = unew-&gt;info-&gt;var-&gt;kind;
06936             }
06937         }
06938     }
06939 
06940   <font class="keywordflow">if</font> (old-&gt;info-&gt;var-&gt;kind == VKSPEC)
06941     {
06942       old-&gt;info-&gt;var-&gt;kind = unew-&gt;info-&gt;var-&gt;kind;
06943     }
06944   <font class="keywordflow">else</font>
06945     {
06946       unew-&gt;info-&gt;var-&gt;kind = old-&gt;info-&gt;var-&gt;kind;
06947     }
06948 
06949   <font class="keywordflow">if</font> (unew-&gt;info-&gt;var-&gt;checked != CH_UNKNOWN
06950       &amp;&amp; unew-&gt;info-&gt;var-&gt;checked != old-&gt;info-&gt;var-&gt;checked)
06951     {
06952       <font class="keywordflow">if</font> (old-&gt;info-&gt;var-&gt;checked == CH_UNKNOWN
06953           &amp;&amp; !<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (uentry_whereLast (old)))
06954         {
06955           ; <font class="comment">/* no error */</font>
06956         }
06957       <font class="keywordflow">else</font>
06958         {
06959           <font class="keywordflow">if</font> (optgenerror 
06960               (FLG_INCONDEFS,
06961                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Variable %q inconsistently %rdeclared as "</font>
06962                         <font class="stringliteral">"%s parameter (was %s)"</font>,
06963                         uentry_getName (unew),
06964                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
06965                         checkedName (unew-&gt;info-&gt;var-&gt;checked),
06966                         checkedName (old-&gt;info-&gt;var-&gt;checked)),
06967                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06968             {
06969               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06970             }
06971         }
06972       
06973       old-&gt;info-&gt;var-&gt;checked = unew-&gt;info-&gt;var-&gt;checked;
06974     }
06975   <font class="keywordflow">else</font>
06976     {
06977       <font class="keywordflow">if</font> (completeConform 
06978           &amp;&amp; (old-&gt;info-&gt;var-&gt;checked != CH_UNKNOWN)
06979           &amp;&amp; uentry_isReallySpecified (old))
06980         {
06981           <font class="keywordflow">if</font> (optgenerror 
06982               (FLG_NEEDSPEC,
06983                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified as %s, but declared without %s qualifier"</font>,
06984                         ekind_capName (unew-&gt;ukind),
06985                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
06986                         checkedName (old-&gt;info-&gt;var-&gt;checked),
06987                         checkedName (old-&gt;info-&gt;var-&gt;checked)),
06988                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
06989             {
06990               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
06991             }
06992         }
06993       
06994       unew-&gt;info-&gt;var-&gt;checked = old-&gt;info-&gt;var-&gt;checked;
06995     }
06996 
06997   uentry_checkStateConformance (old, unew, mustConform, completeConform);
06998 }
06999 
<a name="l07000"></a><a class="code" href="uentry_c.html#a257">07000</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a257">uentry_checkMatchParam</a> (uentry u1, uentry u2, <font class="keywordtype">int</font> paramno, exprNode e)<font class="keyword"></font>
07001 <font class="keyword"></font>{
07002   <font class="keywordflow">if</font> (uentry_isElipsisMarker (u1) || uentry_isElipsisMarker (u2))
07003     {
07004       <font class="keywordflow">return</font>;
07005     }
07006 
07007   llassert (uentry_isVar (u1));
07008   llassert (uentry_isVar (u2));
07009 
07010   <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;kind != u2-&gt;info-&gt;var-&gt;kind) {
07011     <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM) {
07012       <font class="keywordflow">if</font> (u2-&gt;info-&gt;var-&gt;kind == VKRETPARAM) {
07013         voptgenerror 
07014           (FLG_TYPE,
07015            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07016                     <font class="stringliteral">"sef parameter, but non-sef parameter in "</font>
07017                     <font class="stringliteral">"assigned function: %s"</font>,
07018                     paramno, exprNode_unparse (e)),
07019            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07020       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (u2-&gt;info-&gt;var-&gt;kind == VKSEFPARAM) {
07021         voptgenerror 
07022           (FLG_TYPE,
07023            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07024                     <font class="stringliteral">"returns parameter, but non-returns parameter in "</font>
07025                     <font class="stringliteral">"assigned function: %s"</font>,
07026                     paramno, exprNode_unparse (e)),
07027            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07028       } <font class="keywordflow">else</font> {
07029         voptgenerror 
07030           (FLG_TYPE,
07031            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07032                     <font class="stringliteral">"sef returns parameter, but non-sef returns parameter in "</font>
07033                     <font class="stringliteral">"assigned function: %s"</font>,
07034                     paramno, exprNode_unparse (e)),
07035            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07036       }
07037     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;kind == VKRETPARAM) {
07038       voptgenerror 
07039         (FLG_TYPE,
07040          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07041                   <font class="stringliteral">"returns parameter, but non-returns parameter in "</font>
07042                   <font class="stringliteral">"assigned function: %s"</font>,
07043                   paramno, exprNode_unparse (e)),
07044          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07045     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;kind == VKSEFPARAM) {
07046       voptgenerror 
07047         (FLG_TYPE,
07048          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07049                   <font class="stringliteral">"sef parameter, but non-sef parameter in "</font>
07050                   <font class="stringliteral">"assigned function: %s"</font>,
07051                   paramno, exprNode_unparse (e)),
07052          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07053     } <font class="keywordflow">else</font> {
07054       <font class="keywordflow">if</font> (u2-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM) {
07055         voptgenerror 
07056           (FLG_TYPE,
07057            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07058                     <font class="stringliteral">"normal parameter, but sef returns parameter in "</font>
07059                     <font class="stringliteral">"assigned function: %s"</font>,
07060                     paramno, exprNode_unparse (e)),
07061            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07062       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (u2-&gt;info-&gt;var-&gt;kind == VKSEFPARAM) {
07063         voptgenerror 
07064           (FLG_TYPE,
07065            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07066                     <font class="stringliteral">"normal parameter, but sef parameter in "</font>
07067                     <font class="stringliteral">"assigned function: %s"</font>,
07068                     paramno, exprNode_unparse (e)),
07069            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07070       } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (u2-&gt;info-&gt;var-&gt;kind == VKRETPARAM) {
07071         voptgenerror 
07072           (FLG_TYPE,
07073            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07074                     <font class="stringliteral">"normal parameter, but returns parameter in "</font>
07075                     <font class="stringliteral">"assigned function: %s"</font>,
07076                     paramno, exprNode_unparse (e)),
07077            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07078       } <font class="keywordflow">else</font> {
07079         BADBRANCH;
07080       }
07081     }
07082   }
07083 
07084   <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;defstate != u2-&gt;info-&gt;var-&gt;defstate) 
07085     {
07086       voptgenerror 
07087         (FLG_TYPE,
07088          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07089                   <font class="stringliteral">"%s, but %s in assigned function: %s"</font>,
07090                   paramno, 
07091                   sstate_unparse (u1-&gt;info-&gt;var-&gt;defstate),
07092                   <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (u2-&gt;info-&gt;var-&gt;defstate),
07093                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
07094          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07095     }
07096 
07097   <font class="keywordflow">if</font> (u1-&gt;info-&gt;var-&gt;nullstate != u2-&gt;info-&gt;var-&gt;nullstate) 
07098     {
07099       voptgenerror 
07100         (FLG_TYPE,
07101          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07102                   <font class="stringliteral">"%s, but %s in assigned function: %s"</font>,
07103                   paramno, 
07104                   nstate_unparse (u1-&gt;info-&gt;var-&gt;nullstate),
07105                   <a class="code" href="varKinds_c.html#a7">nstate_unparse</a> (u2-&gt;info-&gt;var-&gt;nullstate),
07106                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
07107          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07108     }
07109       
07110   <font class="keywordflow">if</font> (sRef_getAliasKind (u1-&gt;sref) != sRef_getAliasKind (u2-&gt;sref))
07111     {
07112       voptgenerror 
07113         (FLG_TYPE,
07114          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07115                   <font class="stringliteral">"%s, but %s in assigned function: %s"</font>,
07116                   paramno, 
07117                   alkind_unparse (sRef_getAliasKind (u1-&gt;sref)),
07118                   <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (u2-&gt;sref)),
07119                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
07120          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07121     }
07122 
07123   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (u1-&gt;sref) != <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (u2-&gt;sref))
07124     {
07125       voptgenerror 
07126         (FLG_TYPE,
07127          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function types are inconsistent. Parameter %d is "</font>
07128                   <font class="stringliteral">"%s, but %s in assigned function: %s"</font>,
07129                   paramno, 
07130                   exkind_unparse (sRef_getExKind (u1-&gt;sref)),
07131                   <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (sRef_getExKind (u2-&gt;sref)),
07132                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
07133          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
07134     }
07135 }
07136 
07137 <font class="keyword">static</font> <font class="keywordtype">void</font>
07138 checkFunctionConformance (<font class="comment">/*@unique@*/</font> <font class="comment">/*@notnull@*/</font> uentry old,
07139                           <font class="comment">/*@notnull@*/</font> uentry unew, 
07140                           <font class="keywordtype">bool</font> mustConform, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
07141 <font class="keyword"></font>{
07142   uentryList oldParams  = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (old);
07143   uentryList newParams  = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (unew);
07144   ctype      newType    = unew-&gt;utype;
07145   ctype      oldType    = old-&gt;utype;
07146   ctype      oldRetType = ctype_unknown;
07147   ctype      newRetType = ctype_unknown;
07148 
07149   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a108">uentry_isForward</a> (old))
07150     {
07151       mustConform = FALSE;
07152       uentry_copyInto (old, unew);
07153       <font class="keywordflow">return</font>;
07154     }
07155 
07156   <font class="comment">/*</font>
07157 <font class="comment">  ** check return values</font>
07158 <font class="comment">  */</font>
07159   
07160   <font class="keywordflow">if</font> (ctype_isKnown (oldType))
07161     {
07162       llassert (ctype_isFunction (oldType));
07163 
07164       oldRetType = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (oldType);
07165     }
07166 
07167   <font class="keywordflow">if</font> (ctype_isKnown (newType))
07168     {
07169       llassert (ctype_isFunction (newType));
07170 
07171       newRetType = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (newType);
07172     }
07173 
07174   <font class="keywordflow">if</font> (ctype_isKnown (oldRetType) &amp;&amp; ctype_isKnown (newRetType)
07175       &amp;&amp; !<a class="code" href="ctype_c.html#a95">ctype_matchDef</a> (newRetType, oldRetType))
07176     {
07177       <font class="keywordflow">if</font> (mustConform) returnValueError (old, unew);
07178     }
07179   <font class="keywordflow">else</font> 
07180     {
07181       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (newRetType))
07182         {
07183           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (oldRetType))
07184             {
07185               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a42">ctype_sameAltTypes</a> (newRetType, oldRetType))
07186                 {
07187                   <font class="keywordflow">if</font> (optgenerror 
07188                       (FLG_INCONDEFS,
07189                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared to "</font>
07190                                 <font class="stringliteral">"return alternate types %s "</font>
07191                                 <font class="stringliteral">"(types match, but alternates are not identical, "</font>
07192                                 <font class="stringliteral">"so checking may not be correct)"</font>,
07193                                 uentry_getName (unew),
07194                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07195                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (newRetType)),
07196                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07197                     {
07198                       uentry_showWhereLastVal (old, ctype_unparse (oldRetType));
07199                     }
07200                 }
07201             }
07202           <font class="keywordflow">else</font>
07203             {
07204               old-&gt;utype = <a class="code" href="ctype_c.html#a46">ctype_makeFunction</a> (oldRetType, uentryList_copy (newParams));
07205             }
07206         }
07207     }
07208 
07209   uentry_checkStateConformance (old, unew, mustConform, completeConform);
07210 
07211   <font class="keywordflow">if</font> (!exitkind_equal (unew-&gt;info-&gt;fcn-&gt;exitCode, old-&gt;info-&gt;fcn-&gt;exitCode))
07212     {
07213       <font class="keywordflow">if</font> (exitkind_isKnown (unew-&gt;info-&gt;fcn-&gt;exitCode))
07214         {
07215           <font class="keywordflow">if</font> (optgenerror 
07216               (FLG_INCONDEFS,
07217                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared using %s"</font>,
07218                         uentry_getName (unew),
07219                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07220                         <a class="code" href="varKinds_c.html#a23">exitkind_unparse</a> (unew-&gt;info-&gt;fcn-&gt;exitCode)),
07221                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07222             {
07223               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
07224             }
07225         }
07226       <font class="keywordflow">else</font>
07227         {
07228           unew-&gt;info-&gt;fcn-&gt;exitCode = old-&gt;info-&gt;fcn-&gt;exitCode;
07229         }
07230     }
07231 
07232   <font class="keywordflow">if</font> (!qual_isUnknown (unew-&gt;info-&gt;fcn-&gt;nullPred))
07233     {
07234       <font class="keywordflow">if</font> (!qual_equal (old-&gt;info-&gt;fcn-&gt;nullPred, unew-&gt;info-&gt;fcn-&gt;nullPred))
07235         {
07236           <font class="keywordflow">if</font> (optgenerror
07237               (FLG_INCONDEFS,
07238                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared using %s"</font>,
07239                         uentry_getName (unew),
07240                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07241                         <a class="code" href="qual_c.html#a2">qual_unparse</a> (unew-&gt;info-&gt;fcn-&gt;nullPred)),
07242                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07243             {
07244               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
07245             }
07246         }
07247     }
07248   <font class="keywordflow">else</font>
07249     {
07250       unew-&gt;info-&gt;fcn-&gt;nullPred = old-&gt;info-&gt;fcn-&gt;nullPred;
07251     }
07252 
07253   <font class="keywordflow">if</font> (unew-&gt;info-&gt;fcn-&gt;specialCode != SPC_NONE)
07254     {
07255       <font class="keywordflow">if</font> (old-&gt;info-&gt;fcn-&gt;specialCode != unew-&gt;info-&gt;fcn-&gt;specialCode)
07256         {
07257           <font class="keywordflow">if</font> (optgenerror
07258               (FLG_INCONDEFS,
07259                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q inconsistently %rdeclared using %s"</font>,
07260                         uentry_getName (unew),
07261                         <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07262                         specCode_unparse (unew-&gt;info-&gt;fcn-&gt;specialCode)),
07263                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07264             {
07265               <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (old);
07266             }
07267         }
07268     }
07269   <font class="keywordflow">else</font>
07270     {
07271       unew-&gt;info-&gt;fcn-&gt;specialCode = old-&gt;info-&gt;fcn-&gt;specialCode;
07272     }
07273           
07274   <font class="comment">/*</font>
07275 <font class="comment">  ** check parameters</font>
07276 <font class="comment">  */</font>
07277   
07278   <font class="keywordflow">if</font> (!uentryList_sameObject (oldParams, newParams)
07279       &amp;&amp; (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (oldParams)))
07280     {
07281       <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (newParams))
07282         {
07283           <font class="keywordtype">int</font> paramno = 0;
07284           <font class="keywordtype">int</font> nparams = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (oldParams);
07285           <font class="keywordtype">bool</font> checknames = <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_DECLPARAMMATCH);
07286 
07287           <font class="keywordflow">if</font> (nparams != <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (newParams))
07288             {
07289               nargsError (old, unew);
07290             }
07291           
07292           <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (newParams) &lt; nparams) 
07293             {
07294               nparams = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (newParams);
07295             }
07296 
07297           <font class="keywordflow">while</font> (paramno &lt; nparams)
07298             {
07299               uentry oldCurrent = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (oldParams, paramno);
07300               uentry newCurrent  = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (newParams, paramno);
07301               ctype  oldCurrentType = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (oldCurrent);
07302               ctype  newCurrentType = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (newCurrent);
07303 
07304               llassert (uentry_isValid (oldCurrent)
07305                         &amp;&amp; uentry_isValid (newCurrent));
07306               
07307               <font class="keywordflow">if</font> (!uentry_isElipsisMarker (oldCurrent)
07308                   &amp;&amp; !uentry_isElipsisMarker (newCurrent))
07309                 {
07310                   checkVarConformance (oldCurrent, newCurrent, 
07311                                        mustConform, completeConform);
07312                 }
07313 
07314               <font class="keywordflow">if</font> (checknames)
07315                 {
07316                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (oldCurrent) 
07317                       &amp;&amp; <a class="code" href="uentry_c.html#a187">uentry_hasName</a> (newCurrent))
07318                     {
07319                       cstring oldname = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oldCurrent);
07320                       cstring pfx = <a class="code" href="context_c.html#a157">context_getString</a> (FLG_DECLPARAMPREFIX);
07321                       cstring oname;
07322                       cstring nname = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (newCurrent);
07323                       cstring nnamefix;
07324 
07325                       <font class="keywordflow">if</font> (cstring_isDefined (pfx)
07326                           &amp;&amp; <a class="code" href="cstring_c.html#a22">cstring_equalPrefix</a> (oldname, cstring_toCharsSafe (pfx)))
07327                         {
07328                           oname = <a class="code" href="cstring_c.html#a3">cstring_suffix</a> (oldname, cstring_length (pfx));
07329                         }
07330                       <font class="keywordflow">else</font>
07331                         {
07332                           oname = oldname;
07333                         <font class="comment">/*@-branchstate@*/</font> } <font class="comment">/*@=branchstate@*/</font>
07334 
07335                       <font class="keywordflow">if</font> (cstring_isDefined (pfx)
07336                           &amp;&amp; <a class="code" href="cstring_c.html#a22">cstring_equalPrefix</a> (nname, cstring_toCharsSafe (pfx)))
07337                         {
07338                           nnamefix = <a class="code" href="cstring_c.html#a3">cstring_suffix</a> (nname, cstring_length (pfx));
07339                         }
07340                       <font class="keywordflow">else</font>
07341                         {
07342                           nnamefix = nname;
07343                         <font class="comment">/*@-branchstate@*/</font> } <font class="comment">/*@=branchstate@*/</font>
07344 
07345                       <font class="keywordflow">if</font> (!<a class="code" href="cstring_c.html#a18">cstring_equal</a> (oname, nnamefix))
07346                         {
07347                           <font class="keywordflow">if</font> (optgenerror
07348                               (FLG_DECLPARAMMATCH, 
07349                                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Definition parameter name %s does not match "</font>
07350                                         <font class="stringliteral">"name of corresponding parameter in "</font>
07351                                         <font class="stringliteral">"declaration: %s"</font>,
07352                                         nnamefix, oname),
07353                                <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (newCurrent)))
07354                             {
07355                               <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (oldCurrent);
07356                             }
07357                         }
07358                       
07359                       <a class="code" href="cstring_c.html#a27">cstring_free</a> (oldname);
07360                       <a class="code" href="cstring_c.html#a27">cstring_free</a> (nname);
07361                     }
07362                 }
07363 
07364               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (oldCurrentType, newCurrentType))
07365                 {
07366                   paramTypeError (old, oldCurrent, oldCurrentType,
07367                                   unew, newCurrent, newCurrentType, paramno);
07368                 }
07369               <font class="keywordflow">else</font>
07370                 {
07371                   <font class="keywordflow">if</font> (ctype_isMissingParamsMarker (newCurrentType)
07372                       || ctype_isElips (newCurrentType)
07373                       || ctype_isMissingParamsMarker (oldCurrentType)
07374                       || ctype_isElips (oldCurrentType))
07375                     {
07376                       ;
07377                     }
07378                   <font class="keywordflow">else</font>
07379                     {
07380                       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (newCurrentType))
07381                         {
07382                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (oldCurrentType))
07383                             {
07384                               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a42">ctype_sameAltTypes</a> (newCurrentType, oldCurrentType))
07385                                 {
07386                                   <font class="keywordflow">if</font> (optgenerror 
07387                                       (FLG_INCONDEFS,
07388                                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %q inconsistently %rdeclared with "</font>
07389                                                 <font class="stringliteral">"alternate types %s "</font>
07390                                                 <font class="stringliteral">"(types match, but alternates are not identical, "</font>
07391                                                 <font class="stringliteral">"so checking may not be correct)"</font>,
07392                                                 uentry_getName (newCurrent),
07393                                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (oldCurrent),
07394                                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (newCurrentType)),
07395                                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07396                                     {
07397                                       uentry_showWhereLastVal (oldCurrent,
07398                                                                ctype_unparse (oldCurrentType));
07399                                     }
07400                                 }
07401                             }
07402                           <font class="keywordflow">else</font>
07403                             {
07404                               <font class="keywordflow">if</font> (optgenerror 
07405                                   (FLG_INCONDEFS,
07406                                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter %q inconsistently %rdeclared with "</font>
07407                                             <font class="stringliteral">"alternate types %s"</font>,
07408                                             uentry_getName (newCurrent),
07409                                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (oldCurrent),
07410                                             <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (newCurrentType)),
07411                                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07412                                 {
07413                                   uentry_showWhereLastVal (oldCurrent,
07414                                                            ctype_unparse (oldCurrentType));
07415                                   
07416                                 }
07417                             }
07418                         }
07419                       <font class="keywordflow">else</font> 
07420                         {
07421                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (oldCurrentType))
07422                             {
07423                               <a class="code" href="uentry_c.html#a216">uentry_setType</a> (newCurrent, oldCurrentType);
07424                             }
07425                         }
07426                     }
07427                 }
07428 
07429               paramno++;  
07430               <font class="comment">/*</font>
07431 <font class="comment">               ** Forgot this!  detected by lclint:</font>
07432 <font class="comment">               ** uentry.c:1257,15: Suspected infinite loop</font>
07433 <font class="comment">               */</font>
07434             }
07435         }
07436     }
07437 
07438   <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (newParams))
07439     {
07440       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (oldRetType))
07441         {
07442           old-&gt;utype = <a class="code" href="ctype_c.html#a46">ctype_makeFunction</a> (oldRetType, 
07443                                            uentryList_copy (newParams));
07444         }
07445       <font class="keywordflow">else</font>
07446         {
07447           old-&gt;utype = unew-&gt;utype;
07448         }
07449     }
07450 
07451   checkGlobalsConformance (old, unew, mustConform, completeConform);
07452   checkModifiesConformance (old, unew, mustConform, completeConform);
07453 
07454   <font class="keywordflow">if</font> (specialClauses_isDefined (unew-&gt;info-&gt;fcn-&gt;specclauses))
07455     {
07456       <font class="keywordflow">if</font> (!specialClauses_isDefined (old-&gt;info-&gt;fcn-&gt;specclauses))
07457         {
07458           <font class="keywordflow">if</font> (optgenerror
07459               (FLG_INCONDEFS,
07460                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q redeclared using special clauses (can only "</font>
07461                         <font class="stringliteral">"be used in first declaration)"</font>,
07462                         uentry_getName (unew)),
07463                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07464             {
07465               <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
07466             }
07467         }
07468       <font class="keywordflow">else</font>
07469         {
07470           <a class="code" href="specialClauses_c.html#a37">specialClauses_checkEqual</a> (old, unew);
07471         }
07472     }
07473 
07474   <font class="keywordflow">if</font> (fileloc_isUndefined (old-&gt;whereDeclared))
07475     {
07476       old-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (unew-&gt;whereDeclared);
07477     }
07478   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isUndefined (unew-&gt;whereDeclared))
07479     {
07480       unew-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (old-&gt;whereDeclared);
07481     }
07482   <font class="keywordflow">else</font>
07483     {
07484       <font class="comment">/* no change */</font>
07485     }
07486 }
07487 
07488 <font class="keywordtype">void</font>
<a name="l07489"></a><a class="code" href="uentry_c.html#a259">07489</a> <a class="code" href="uentry_c.html#a259">uentry_mergeConstantValue</a> (uentry ue, <font class="comment">/*@only@*/</font> multiVal m)<font class="keyword"></font>
07490 <font class="keyword"></font>{
07491   multiVal uval;
07492 
07493   llassert (uentry_isValid (ue));
07494   llassert (uentry_isEitherConstant (ue));
07495 
07496   uval = ue-&gt;info-&gt;uconst-&gt;val;
07497 
07498   <font class="keywordflow">if</font> (multiVal_isDefined (uval))
07499     {
07500       <font class="keywordflow">if</font> (multiVal_isDefined (m))
07501         {
07502           <font class="keywordflow">if</font> (!multiVal_equiv (uval, m))
07503             {
07504               <font class="keywordflow">if</font> (optgenerror 
07505                   (FLG_INCONDEFS,
07506                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q defined with inconsistent value: %q"</font>,
07507                             ekind_capName (ue-&gt;ukind),
07508                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue), 
07509                             <a class="code" href="multiVal_c.html#a16">multiVal_unparse</a> (m)),
07510                    g_currentloc))
07511                 {
07512                   <a class="code" href="uentry_c.html#a243">uentry_showWhereLastExtra</a> (ue, multiVal_unparse (uval));
07513                 }
07514             }
07515         }
07516       <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (m);
07517     }
07518   <font class="keywordflow">else</font>
07519     {
07520       ue-&gt;info-&gt;uconst-&gt;val = m;
07521       <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (uval);
07522     }
07523 }
07524 
07525 <font class="keyword">static</font>
07526 <font class="keywordtype">bool</font> checkTypeConformance (<font class="comment">/*@notnull@*/</font> uentry old, <font class="comment">/*@notnull@*/</font> uentry unew, 
07527                            <font class="keywordtype">bool</font> mustConform)<font class="keyword"></font>
07528 <font class="keyword"></font>{
07529   <font class="keywordtype">bool</font> typeError = FALSE;
07530 
07531   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a125">uentry_isStructTag</a> (old) || <a class="code" href="uentry_c.html#a126">uentry_isUnionTag</a> (old))
07532     {
07533       <font class="keywordflow">if</font> (ctype_isSU (old-&gt;utype) &amp;&amp; ctype_isSU (unew-&gt;utype))
07534         {
07535           <font class="keywordflow">if</font> (mustConform)
07536             {
07537               checkStructConformance (old, unew); 
07538             }
07539         }
07540       <font class="keywordflow">else</font>
07541         {
07542           <font class="keywordflow">if</font> (!(ctype_isBogus (old-&gt;utype) || ctype_isBogus (unew-&gt;utype)))
07543             {
07544               llbug (message (<font class="stringliteral">"struct tags: bad types: %t / %t"</font>, 
07545                               old-&gt;utype, unew-&gt;utype));
07546             }
07547         }
07548     }
07549   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a127">uentry_isEnumTag</a> (old))
07550     {
07551       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (old-&gt;utype) &amp;&amp; <a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (unew-&gt;utype))
07552         {
07553           <font class="keywordflow">if</font> (mustConform) checkEnumConformance (old, unew);
07554         }
07555       <font class="keywordflow">else</font> 
07556         {
07557           <font class="keywordflow">if</font> (!(ctype_isBogus (old-&gt;utype) || ctype_isBogus (unew-&gt;utype)))
07558             {
07559               llbug (message (<font class="stringliteral">"enum! bad type: %s / %s"</font>, ctype_unparse (old-&gt;utype),
07560                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (unew-&gt;utype)));
07561             }
07562         }
07563     }
07564   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (old-&gt;utype, unew-&gt;utype))
07565     {
07566       <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (uentry_rawName (old), <a class="code" href="context_c.html#a246">context_getBoolName</a> ()))
07567         {
07568           ctype realt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (unew-&gt;utype);
07569           
07570           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (realt) || <a class="code" href="ctype_c.html#a58">ctype_isChar</a> (realt))
07571             {
07572               unew-&gt;utype = ctype_bool;
07573             }
07574           <font class="keywordflow">else</font>
07575             {
07576               <font class="keywordflow">if</font> (mustConform)
07577                 {
07578                   typeError = optgenerror
07579                     (FLG_INCONDEFS,
07580                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q defined as %s"</font>, uentry_getName (old), 
07581                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (realt)),
07582                      <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew));
07583                 }
07584             }
07585         } 
07586       <font class="keywordflow">else</font> 
07587         {
07588           <font class="keywordflow">if</font> (mustConform)
07589             {
07590               ctype oldr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (old-&gt;utype);
07591               ctype newr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (unew-&gt;utype);
07592               
07593               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (oldr) &amp;&amp; <a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (newr))
07594                 {
07595                   checkStructConformance (old, unew);
07596                 }
07597               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (oldr) &amp;&amp; <a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (newr))
07598                 {
07599                   checkStructConformance (old, unew);
07600                 }
07601               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (oldr) &amp;&amp; <a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (newr))
07602                 {
07603                   checkEnumConformance (old, unew);
07604                 }
07605               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isConstant (old) 
07606                        &amp;&amp; (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (oldr) &amp;&amp; <a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (newr)))
07607                 {
07608                   <font class="comment">/* okay...for now! (should check the type is reset later... */</font>
07609                 }
07610               <font class="keywordflow">else</font>
07611                 {
07612                   <font class="keywordflow">if</font> (optgenerror 
07613                       (FLG_INCONDEFS,
07614                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q %rdeclared with inconsistent type: %t"</font>,
07615                                 ekind_capName (unew-&gt;ukind),
07616                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
07617                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07618                                 unew-&gt;utype),
07619                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07620                     {
07621                       <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
07622                       typeError = TRUE;
07623                     }
07624                 }
07625             }
07626         }
07627     }
07628   <font class="keywordflow">else</font>
07629     {
07630       <font class="comment">/* no error */</font>
07631     }
07632 
07633   <font class="keywordflow">return</font> typeError;
07634 }
07635 
07636 <font class="keyword">static</font> <font class="keywordtype">void</font>
07637 uentry_checkDatatypeConformance (<font class="comment">/*@notnull@*/</font> uentry old,
07638                                  <font class="comment">/*@notnull@*/</font> uentry unew,
07639                                  <font class="keywordtype">bool</font> mustConform, <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
07640 <font class="keyword"></font>{
07641   <font class="keywordflow">if</font> (ctype_isDefined (unew-&gt;info-&gt;datatype-&gt;type))
07642     {
07643       <font class="comment">/*</font>
07644 <font class="comment">      ** bool is hard coded here, since it is built into LCL.</font>
07645 <font class="comment">      ** For now, we're stuck with LCL's types.</font>
07646 <font class="comment">      */</font>
07647 
07648       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (old-&gt;utype) &amp;&amp;
07649           cstring_equalLit (unew-&gt;uname, "<font class="keywordtype">bool</font>"))
07650         {
07651           <font class="comment">/* if (!context_getFlag (FLG_ABSTRACTBOOL))</font>
07652 <font class="comment">             evs 2000-07-25: removed</font>
07653 <font class="comment">          */</font>
07654               unew-&gt;utype = ctype_bool;
07655         }
07656       
07657       <font class="keywordflow">if</font> (ctype_isUnknown (old-&gt;info-&gt;datatype-&gt;type))
07658         {
07659           old-&gt;info-&gt;datatype-&gt;type = unew-&gt;info-&gt;datatype-&gt;type;
07660         }
07661       <font class="keywordflow">else</font>
07662         {
07663           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a95">ctype_matchDef</a> (old-&gt;info-&gt;datatype-&gt;type,
07664                               unew-&gt;info-&gt;datatype-&gt;type))
07665             {
07666               ;
07667             }
07668           <font class="keywordflow">else</font>
07669             {
07670               <font class="keywordflow">if</font> (optgenerror 
07671                   (FLG_INCONDEFS,
07672                    message
07673                    (<font class="stringliteral">"Type %q %s with inconsistent type: %t"</font>,
07674                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
07675                     uentry_reDefDecl (old, unew),
07676                     unew-&gt;info-&gt;datatype-&gt;type),
07677                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07678                 {
07679                   uentry_showWhereLastExtra 
07680                     (old, <a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (old-&gt;info-&gt;datatype-&gt;type)));
07681                 }
07682 
07683               old-&gt;info-&gt;datatype-&gt;type = unew-&gt;info-&gt;datatype-&gt;type;
07684             }
07685         }
07686     }
07687   
07688   <font class="keywordflow">if</font> (unew-&gt;info-&gt;datatype-&gt;abs != MAYBE)
07689     {
07690       <font class="keywordflow">if</font> (ynm_isOff (old-&gt;info-&gt;datatype-&gt;abs)
07691           &amp;&amp; ynm_isOn (unew-&gt;info-&gt;datatype-&gt;abs))
07692         {
07693           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (old-&gt;utype))
07694             {
07695               <font class="keywordflow">if</font> (optgenerror 
07696                   (FLG_INCONDEFS,
07697                    message 
07698                    (<font class="stringliteral">"Datatype %q inconsistently %rdeclared as abstract type"</font>,
07699                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
07700                     <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
07701                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07702                 {
07703                   <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07704                 }
07705             }
07706         }
07707       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ynm_isOn (old-&gt;info-&gt;datatype-&gt;abs)
07708                &amp;&amp; ynm_isOff (unew-&gt;info-&gt;datatype-&gt;abs))
07709         {
07710           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (old-&gt;utype))
07711             {
07712               <font class="keywordflow">if</font> (optgenerror 
07713                   (FLG_INCONDEFS,
07714                    message 
07715                    (<font class="stringliteral">"Datatype %q inconsistently %rdeclared as concrete type"</font>,
07716                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
07717                     <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
07718                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07719                 {
07720                   <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07721                 }
07722             }
07723         }
07724       <font class="keywordflow">else</font>
07725         {
07726           ;
07727         }
07728     }
07729   <font class="keywordflow">else</font> 
07730     {
07731       <font class="keywordflow">if</font> (ynm_isOn (old-&gt;info-&gt;datatype-&gt;abs))
07732         {
07733           old-&gt;sref = unew-&gt;sref;
07734           unew-&gt;info-&gt;datatype-&gt;mut = old-&gt;info-&gt;datatype-&gt;mut;
07735           
07736           <font class="keywordflow">if</font> (completeConform
07737               &amp;&amp; uentry_isReallySpecified (old))
07738             {
07739               <font class="keywordflow">if</font> (optgenerror 
07740                   (FLG_NEEDSPEC,
07741                    message 
07742                    (<font class="stringliteral">"Datatype %q specified as abstract, "</font>
07743                     <font class="stringliteral">"but abstract annotation not used in declaration"</font>,
07744                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)), 
07745                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07746                 {
07747                   <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07748                 }
07749             }
07750         }
07751     }
07752   
07753   unew-&gt;info-&gt;datatype-&gt;abs = old-&gt;info-&gt;datatype-&gt;abs;   
07754   
07755   <font class="keywordflow">if</font> (ynm_isMaybe (unew-&gt;info-&gt;datatype-&gt;mut))
07756     {
07757       <font class="keywordflow">if</font> (completeConform &amp;&amp; ynm_isOff (old-&gt;info-&gt;datatype-&gt;mut)
07758           &amp;&amp; uentry_isReallySpecified (old))
07759         {
07760           <font class="keywordflow">if</font> (optgenerror 
07761               (FLG_NEEDSPEC,
07762                message 
07763                (<font class="stringliteral">"Datatype %q specified as immutable, "</font>
07764                 <font class="stringliteral">"but immutable annotation not used in declaration"</font>,
07765                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)), 
07766                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07767             {
07768               <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07769             }
07770         }
07771       
07772       unew-&gt;info-&gt;datatype-&gt;mut = old-&gt;info-&gt;datatype-&gt;mut;
07773     }
07774   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ynm_isMaybe (old-&gt;info-&gt;datatype-&gt;mut))
07775     {
07776       old-&gt;info-&gt;datatype-&gt;mut = unew-&gt;info-&gt;datatype-&gt;mut;
07777     }
07778   <font class="keywordflow">else</font>
07779     {
07780       <font class="keywordflow">if</font> (ynm_isOn (old-&gt;info-&gt;datatype-&gt;abs))
07781         {
07782           <font class="keywordflow">if</font> (ynm_isOn (old-&gt;info-&gt;datatype-&gt;mut) &amp;&amp; ynm_isOff (unew-&gt;info-&gt;datatype-&gt;mut))
07783             {
07784               <font class="keywordflow">if</font> (optgenerror
07785                   (FLG_INCONDEFS,
07786                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Datatype %q inconsistently %rdeclared as immutable"</font>,
07787                             uentry_getName (unew), 
07788                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
07789                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07790                 {
07791                   <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07792                 }
07793             }
07794           <font class="keywordflow">else</font> 
07795             {
07796               <font class="keywordflow">if</font> (ynm_isOff (old-&gt;info-&gt;datatype-&gt;mut)
07797                   &amp;&amp; ynm_isOn (unew-&gt;info-&gt;datatype-&gt;mut))
07798                 {
07799                   <font class="keywordflow">if</font> (optgenerror
07800                       (FLG_INCONDEFS,
07801                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Datatype %q inconsistently %rdeclared as mutable"</font>,
07802                                 uentry_getName (unew), 
07803                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old)),
07804                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07805                     {
07806                       <a class="code" href="uentry_c.html#a247">uentry_showWhereLastPlain</a> (old);
07807                     }
07808                 }
07809             }
07810         }
07811       old-&gt;info-&gt;datatype-&gt;mut = unew-&gt;info-&gt;datatype-&gt;mut;       
07812     }
07813 
07814   uentry_checkStateConformance (old, unew, mustConform, completeConform);
07815 }
07816 
07817 <font class="keyword">static</font> <font class="keywordtype">void</font>
07818 uentry_checkConstantConformance (<font class="comment">/*@notnull@*/</font> uentry old,
07819                                  <font class="comment">/*@notnull@*/</font> uentry unew,
07820                                  <font class="keywordtype">bool</font> mustConform, 
07821                                  <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
07822 <font class="keyword"></font>{
07823   multiVal oldVal = old-&gt;info-&gt;uconst-&gt;val;
07824   multiVal newVal = unew-&gt;info-&gt;uconst-&gt;val;
07825   
07826   <font class="keywordflow">if</font> (multiVal_isDefined (oldVal))
07827     {
07828       <font class="keywordflow">if</font> (multiVal_isDefined (newVal))
07829         {
07830           <font class="keywordflow">if</font> (!multiVal_equiv (oldVal, newVal))
07831             {
07832               <font class="keywordflow">if</font> (mustConform
07833                   &amp;&amp; optgenerror 
07834                   (FLG_INCONDEFS,
07835                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q %rdeclared with inconsistent value: %q"</font>,
07836                             ekind_capName (unew-&gt;ukind),
07837                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
07838                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
07839                             <a class="code" href="multiVal_c.html#a16">multiVal_unparse</a> (newVal)),
07840                    <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
07841                 {
07842                   <a class="code" href="uentry_c.html#a243">uentry_showWhereLastExtra</a> (old, multiVal_unparse (oldVal));
07843                 }
07844             }
07845           
07846           unew-&gt;info-&gt;uconst-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (oldVal);
07847           <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (newVal);
07848         }
07849       <font class="keywordflow">else</font>
07850         {
07851           ;
07852         }
07853     }
07854   <font class="keywordflow">else</font>
07855     {
07856       old-&gt;info-&gt;uconst-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (newVal);
07857     }
07858 }
07859 
07860 <font class="keyword">static</font> <font class="keywordtype">void</font> 
07861 uentry_checkConformance (<font class="comment">/*@unique@*/</font> <font class="comment">/*@notnull@*/</font> uentry old, 
07862                          <font class="comment">/*@notnull@*/</font> uentry unew, <font class="keywordtype">bool</font> mustConform,
07863                          <font class="keywordtype">bool</font> completeConform)<font class="keyword"></font>
07864 <font class="keyword"></font>{
07865   <font class="keywordtype">bool</font> typeError = FALSE;
07866   <font class="keywordtype">bool</font> fcnConformance = FALSE;
07867 
07868   <font class="keywordflow">if</font> (!ekind_equal (unew-&gt;ukind, old-&gt;ukind))
07869     {
07870       <font class="comment">/*</font>
07871 <font class="comment">      ** okay, only if one is a function and the other is</font>
07872 <font class="comment">      ** a variable of type function.</font>
07873 <font class="comment">      */</font>
07874 
07875       <font class="keywordflow">if</font> (unew-&gt;ukind == KENUMCONST
07876           &amp;&amp; old-&gt;ukind == KCONST)
07877         {
07878           old-&gt;ukind = KENUMCONST;
07879           <font class="keywordflow">goto</font> nokinderror;
07880         }
07881 
07882       <font class="keywordflow">if</font> (unew-&gt;ukind == KFCN 
07883           &amp;&amp; old-&gt;ukind == KCONST
07884           &amp;&amp; ctype_isUnknown (old-&gt;utype))
07885         {
07886           <font class="comment">/*</font>
07887 <font class="comment">          ** When a function is defined with an unparam macro</font>
07888 <font class="comment">          */</font>
07889 
07890           uentry_copyInto (old, unew);
07891           <font class="keywordflow">return</font>;
07892         }
07893 
07894       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (old) 
07895           &amp;&amp; uentry_isEitherConstant (unew))
07896         {
07897           uentry_copyInto (old, unew);
07898           <font class="keywordflow">return</font>;
07899         }
07900 
07901       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (unew))
07902         {
07903           <font class="keywordflow">if</font> (ctype_isUnknown (old-&gt;utype))
07904             {
07905               <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (old)
07906                   &amp;&amp; <a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (unew))
07907                 {
07908                   <font class="keywordflow">if</font> (!<a class="code" href="fileloc_c.html#a13">fileloc_withinLines</a> (uentry_whereDefined (old),
07909                                             <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew), 2))
07910                     { <font class="comment">/* bogus!  will give errors if there is too much whitespace */</font>
07911                       voptgenerror
07912                         (FLG_SYNTAX,
07913                          message
07914                          (<font class="stringliteral">"Iterator finalized name %q does not match name in "</font>
07915                           <font class="stringliteral">"previous iter declaration (should be end_%q).  This iter "</font>
07916                           <font class="stringliteral">"is declared at %q"</font>, 
07917                           <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
07918                           <a class="code" href="uentry_c.html#a195">uentry_getName</a> (old),
07919                           <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (uentry_whereDefined (old))),
07920                          <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (old));
07921                     }
07922                 }
07923 
07924               uentry_copyInto (old, unew);
07925               <font class="keywordflow">return</font>;
07926             }
07927           <font class="keywordflow">else</font>
07928             {
07929               KindConformanceError (old, unew, mustConform);
07930             }
07931         }
07932 
07933       <font class="keywordflow">if</font> (uentry_isFunction (unew))
07934         {
07935           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (old))
07936             {
07937               <font class="keywordflow">if</font> (!ctype_isUnknown (old-&gt;utype))
07938                 {
07939                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (old-&gt;utype))
07940                     {
07941                       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (old);
07942                       checkFunctionConformance (old, unew, mustConform,
07943                                                 completeConform);
07944                       fcnConformance = TRUE;
07945                     }
07946                   <font class="keywordflow">else</font>
07947                     {
07948                       KindConformanceError (old, unew, mustConform);
07949                     }
07950                 }
07951               <font class="keywordflow">else</font>
07952                 {
07953                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (old))
07954                     {
07955                       <font class="keywordflow">if</font> (fileloc_isUndefined (unew-&gt;whereDefined))
07956                         {
07957                           unew-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (unew-&gt;whereDefined, 
07958                                                               old-&gt;whereDefined);
07959                         }
07960 
07961                       uentry_copyInto (old, unew);
07962                       old-&gt;used = unew-&gt;used = TRUE;
07963                       <font class="keywordflow">return</font>;
07964                     }
07965                   <font class="keywordflow">else</font>
07966                     {
07967                       <font class="comment">/* undeclared identifier */</font>
07968                       old-&gt;utype = unew-&gt;utype;
07969                       <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (old);
07970                       checkFunctionConformance (old, unew, FALSE, FALSE);
07971                       fcnConformance = TRUE;
07972                     }
07973                 }
07974             }
07975           <font class="keywordflow">else</font>
07976             {
07977               KindConformanceError (old, unew, mustConform);
07978             }
07979         }
07980       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isFunction (old) &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (unew))
07981         {
07982           <font class="keywordflow">if</font> (!ctype_isUnknown (unew-&gt;utype))
07983             {
07984               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (unew-&gt;utype))
07985                 {
07986                   <a class="code" href="uentry_c.html#a100">uentry_makeVarFunction</a> (unew);
07987                   checkFunctionConformance (old, unew, mustConform, completeConform);
07988                   fcnConformance = TRUE;
07989                 }
07990               <font class="keywordflow">else</font>
07991                 {
07992                   KindConformanceError (old, unew, mustConform);
07993                 }
07994             }
07995           <font class="keywordflow">else</font>
07996             {
07997               KindConformanceError (old, unew, mustConform);
07998             }
07999         }
08000       <font class="keywordflow">else</font>
08001         {
08002           KindConformanceError (old, unew, mustConform);
08003         }
08004     }
08005   <font class="keywordflow">else</font>
08006     {
08007       <font class="comment">/*</font>
08008 <font class="comment">      ** check parameter lists for functions </font>
08009 <font class="comment">      ** (before type errors, to get better messages</font>
08010 <font class="comment">      */</font>
08011 
08012       <font class="keywordflow">if</font> (uentry_isFunction (old))
08013         {
08014           checkFunctionConformance (old, unew, mustConform, completeConform);
08015           fcnConformance = TRUE;
08016         }
08017       <font class="keywordflow">else</font> 
08018         {
08019           <font class="keywordflow">if</font> (!ctype_isUndefined (old-&gt;utype))
08020             {
08021               typeError = checkTypeConformance (old, unew, mustConform);
08022             }
08023         }
08024     }
08025 
08026  nokinderror:
08027 
08028   <font class="keywordflow">if</font> (uentry_isEitherConstant (old) &amp;&amp; uentry_isEitherConstant (unew))
08029     {
08030       uentry_checkConstantConformance (old, unew, mustConform, completeConform);
08031     }
08032 
08033   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (unew))
08034     {
08035       uentry_checkDatatypeConformance (old, unew, mustConform, completeConform);
08036     }
08037 
08038   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (unew))
08039     {
08040       <font class="keywordflow">if</font> (!typeError &amp;&amp; 
08041           !<a class="code" href="ctype_c.html#a95">ctype_matchDef</a> (old-&gt;utype, unew-&gt;utype))
08042         {
08043           <font class="keywordflow">if</font> (optgenerror 
08044               (FLG_INCONDEFS,
08045                message
08046                (<font class="stringliteral">"Variable %q %s with inconsistent type (arrays and pointers are "</font>
08047                 <font class="stringliteral">"not identical in variable declarations): %t"</font>,
08048                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew), 
08049                 uentry_reDefDecl (old, unew),
08050                 unew-&gt;utype),
08051                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
08052             {
08053               <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
08054               
08055               <font class="comment">/*</font>
08056 <font class="comment">              ** Avoid repeated errors.</font>
08057 <font class="comment">              */</font>
08058 
08059               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (old) &amp;&amp; <a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (unew))
08060                 {
08061                   old-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;whereDefined,
08062                                                       fileloc_undefined);
08063                 }
08064 
08065               typeError = TRUE;
08066             }
08067         }
08068 
08069       checkVarConformance (old, unew, mustConform, completeConform);
08070     }
08071 
08072   <font class="keywordflow">if</font> (fcnConformance)
08073     {
08074       <font class="comment">/* old-&gt;utype = unew-&gt;utype; */</font>
08075     }
08076   <font class="keywordflow">else</font>
08077     {
08078       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (old-&gt;utype))
08079         {
08080           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a86">ctype_isConj</a> (unew-&gt;utype))
08081             {
08082               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a42">ctype_sameAltTypes</a> (old-&gt;utype, unew-&gt;utype))
08083                 {
08084                   <font class="keywordflow">if</font> (optgenerror 
08085                       (FLG_INCONDEFS,
08086                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q inconsistently %rdeclared with "</font>
08087                                 <font class="stringliteral">"alternate types %s "</font>
08088                                 <font class="stringliteral">"(types match, but alternates are not identical, "</font>
08089                                 <font class="stringliteral">"so checking may not be correct)"</font>,
08090                                 ekind_capName (uentry_getKind (old)),
08091                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew),
08092                                 <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
08093                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (unew-&gt;utype)),
08094                        <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew)))
08095                     {
08096                       uentry_showWhereLastVal (old, ctype_unparse (old-&gt;utype));
08097                     }
08098                   <font class="keywordflow">else</font>
08099                     {
08100                       old-&gt;utype = unew-&gt;utype;
08101                     }
08102                 }
08103             }
08104         }
08105       <font class="keywordflow">else</font>
08106         {
08107           <font class="keywordflow">if</font> (ctype_isUnknown (old-&gt;utype))
08108             {
08109               old-&gt;utype = unew-&gt;utype;
08110             }
08111         }
08112     }  
08113 
08114   <font class="keywordflow">if</font> (unew-&gt;ukind == old-&gt;ukind) 
08115     {
08116       <a class="code" href="general_c.html#a0">sfree</a> (unew-&gt;info);
08117       unew-&gt;info = uinfo_copy (old-&gt;info, old-&gt;ukind);
08118     }
08119 
08120   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (old-&gt;sref);
08121   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (unew-&gt;sref);
08122 }
08123 
08124 <font class="comment">/*</font>
08125 <font class="comment">** modifies spec to reflect def, reports any inconsistencies</font>
08126 <font class="comment">*/</font>
08127 
08128 <font class="keywordtype">void</font>
<a name="l08129"></a><a class="code" href="uentry_c.html#a264">08129</a> <a class="code" href="uentry_c.html#a264">uentry_mergeEntries</a> (uentry spec, <font class="comment">/*@only@*/</font> uentry def)<font class="keyword"></font>
08130 <font class="keyword"></font>{
08131   llassert (uentry_isValid (spec));
08132   llassert (uentry_isValid (def));
08133   llassert (cstring_equal (spec-&gt;uname, def-&gt;uname));
08134 
08135   uentry_checkConformance (spec, def, TRUE, 
08136                            context_getFlag (FLG_NEEDSPEC));
08137 
08138   <font class="comment">/* was: !(fileloc_isImport (uentry_whereSpecified (spec)))); */</font>
08139 
08140   <font class="comment">/*</font>
08141 <font class="comment">  ** okay, declarations conform.  Propagate extra information.</font>
08142 <font class="comment">  */</font>
08143 
08144   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (spec, uentry_whereDefined (def));
08145   <a class="code" href="uentry_c.html#a208">uentry_setDeclared</a> (spec, uentry_whereDeclared (def));
08146 
08147   <font class="keywordflow">if</font> (uentry_isStatic (def))
08148     {
08149       <font class="keywordflow">if</font> (optgenerror 
08150           (FLG_INCONDEFS,
08151            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified, but declared as static"</font>,
08152                     ekind_capName (def-&gt;ukind),
08153                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (def)),
08154            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (def)))
08155         {
08156           <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (spec);
08157         }
08158     }
08159   <font class="keywordflow">else</font> 
08160     {
08161       spec-&gt;storageclass = def-&gt;storageclass;
08162     }
08163 
08164   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (spec-&gt;sref);
08165 
08166   spec-&gt;used = def-&gt;used || spec-&gt;used;
08167   spec-&gt;hasNameError |= def-&gt;hasNameError;
08168 
08169   <a class="code" href="uentry_c.html#a238">uentry_free</a> (def);
08170 
08171   <font class="keywordflow">if</font> (!spec-&gt;hasNameError)
08172     {
08173       <a class="code" href="uentry_c.html#a284">uentry_checkName</a> (spec);
08174     }
08175   <font class="keywordflow">else</font>
08176     {
08177       ;
08178     }
08179 }
08180 
08181 <font class="comment">/*</font>
08182 <font class="comment">** Can't generate function redeclaration errors when the </font>
08183 <font class="comment">** entries are merged, since we don't yet know if its the</font>
08184 <font class="comment">** definition of the function.</font>
08185 <font class="comment">*/</font>
08186 
08187 <font class="keywordtype">void</font>
<a name="l08188"></a><a class="code" href="uentry_c.html#a265">08188</a> <a class="code" href="uentry_c.html#a265">uentry_clearDecl</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
08189 <font class="keyword"></font>{
08190   posRedeclared = uentry_undefined;
08191   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (posLoc);
08192   posLoc = fileloc_undefined;
08193 }
08194 
08195 <font class="keywordtype">void</font>
<a name="l08196"></a><a class="code" href="uentry_c.html#a266">08196</a> <a class="code" href="uentry_c.html#a266">uentry_checkDecl</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
08197 <font class="keyword"></font>{
08198   <font class="keywordflow">if</font> (uentry_isValid (posRedeclared))
08199     {
08200       llassert (fileloc_isDefined (posLoc));
08201 
08202       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (posRedeclared))
08203         {
08204           <font class="keywordflow">if</font> (optgenerror (FLG_REDECL,
08205                            message (<font class="stringliteral">"%s %q declared after definition"</font>, 
08206                                     ekind_capName (posRedeclared-&gt;ukind),
08207                                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (posRedeclared)),
08208                            posLoc))
08209             {
08210               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Definition of %q"</font>, 
08211                                        uentry_getName (posRedeclared)),
08212                               posRedeclared-&gt;whereDeclared);
08213             }
08214         }
08215       <font class="keywordflow">else</font>
08216         {
08217           <font class="keywordflow">if</font> (optgenerror (FLG_REDECL,
08218                            message (<font class="stringliteral">"%s %q declared more than once"</font>, 
08219                                     ekind_capName (posRedeclared-&gt;ukind),
08220                                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (posRedeclared)),
08221                            posLoc))
08222             {
08223               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q"</font>, 
08224                                        uentry_getName (posRedeclared)),
08225                               posRedeclared-&gt;whereDeclared);
08226             }
08227         }
08228     }
08229 
08230   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (posLoc);
08231   posLoc = fileloc_undefined;
08232   posRedeclared = uentry_undefined;
08233 }
08234 
08235 <font class="comment">/*</font>
08236 <font class="comment">** Redefinition of old as unew.</font>
08237 <font class="comment">** modifies old to reflect unew, reports any inconsistencies</font>
08238 <font class="comment">*/</font>
08239 
08240 <font class="keywordtype">void</font>
<a name="l08241"></a><a class="code" href="uentry_c.html#a267">08241</a> <a class="code" href="uentry_c.html#a267">uentry_mergeDefinition</a> (uentry old, <font class="comment">/*@only@*/</font> uentry unew)<font class="keyword"></font>
08242 <font class="keyword"></font>{
08243   fileloc olddef = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (old);
08244   fileloc unewdef = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (unew);
08245   <font class="keywordtype">bool</font> mustConform;
08246   <font class="keywordtype">bool</font> wasForward;
08247  
08248   <font class="keywordflow">if</font> (uentry_isExtern (unew))
08249     {
08250       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (old, unewdef);
08251     }
08252 
08253   wasForward = 
08254     fileloc_isUndefined (olddef) 
08255       &amp;&amp; fileloc_isDefined (uentry_whereDefined (old)) 
08256         &amp;&amp; !<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (old);
08257   
08258   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INCONDEFSLIB)
08259       &amp;&amp; (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (olddef) || fileloc_isImport (olddef)))
08260     {
08261       mustConform = FALSE;
08262     }
08263   <font class="keywordflow">else</font>
08264     {
08265       mustConform = TRUE;
08266     }
08267   
08268   llassert (uentry_isValid (old));
08269   llassert (uentry_isValid (unew));
08270   llassert (cstring_equal (old-&gt;uname, unew-&gt;uname));
08271 
08272   <font class="comment">/*</font>
08273 <font class="comment">  ** should check old one was extern!</font>
08274 <font class="comment">  */</font>
08275 
08276   <font class="keywordflow">if</font> (uentry_isStatic (old))
08277     {
08278       <font class="keywordflow">if</font> (!(uentry_isStatic (unew)))
08279         {
08280           <font class="keywordflow">if</font> (optgenerror 
08281               (FLG_SHADOW,
08282                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q shadows static declaration"</font>,
08283                         ekind_capName (unew-&gt;ukind),
08284                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08285                unewdef))
08286             {
08287               <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (old);
08288             }
08289         }
08290       <font class="keywordflow">else</font>
08291         {
08292           uentry_setDeclDef (old, unewdef);
08293         }
08294     }
08295   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isStatic (unew))
08296     {
08297       uentry_setDeclDef (old, unewdef);
08298     }
08299   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isExtern (old))
08300     {
08301       <a class="code" href="uentry_c.html#a208">uentry_setDeclared</a> (old, unewdef);
08302     }
08303   <font class="keywordflow">else</font>
08304     {
08305       <font class="keywordflow">if</font> (!uentry_isExtern (unew) &amp;&amp; !<a class="code" href="uentry_c.html#a108">uentry_isForward</a> (old)
08306           &amp;&amp; !<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (olddef, unewdef)
08307           &amp;&amp; !fileloc_isUndefined (olddef)
08308           &amp;&amp; !fileloc_isUndefined (unewdef)
08309           &amp;&amp; !fileloc_isBuiltin (olddef)
08310           &amp;&amp; !fileloc_isBuiltin (unewdef)
08311           &amp;&amp; !<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (old)
08312           &amp;&amp; !(<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (olddef) || fileloc_isImport (olddef)))
08313         {
08314           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (old) || <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (unew))
08315             {
08316               ; <font class="comment">/* will report redeclaration error later */</font>
08317             }
08318           <font class="keywordflow">else</font>
08319             {
08320               <font class="keywordflow">if</font> (fileloc_isDefined (uentry_whereDefined (old)))
08321                 {
08322                   <font class="keywordflow">if</font> (optgenerror
08323                       (FLG_REDEF,
08324                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q defined more than once"</font>, 
08325                                 ekind_capName (unew-&gt;ukind),
08326                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08327                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (unew)))
08328                     {
08329                       llgenindentmsg
08330                         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Previous definition of %q"</font>, 
08331                                   uentry_getName (old)),
08332                          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (old));
08333                     }
08334                   <font class="comment">/*</font>
08335 <font class="comment">                  if (uentry_isDatatype (old) || uentry_isAnyTag (old))</font>
08336 <font class="comment">                    {</font>
08337 <font class="comment">                      uentry_copyInto (old, unew);</font>
08338 <font class="comment">                      old-&gt;sref = sRef_saveCopy (old-&gt;sref);</font>
08339 <font class="comment">                    }</font>
08340 <font class="comment">                    */</font>
08341                 }
08342             }
08343         }
08344       <font class="keywordflow">else</font>
08345         {
08346           <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (olddef)
08347               || fileloc_isUndefined (olddef)
08348               || fileloc_isImport (olddef))
08349             {
08350               <font class="keywordflow">if</font> (uentry_isExtern (unew)) 
08351                 {
08352                   <font class="keywordflow">if</font> (uentry_isExtern (old)
08353                       || (fileloc_isDefined (uentry_whereDeclared (old))
08354                           &amp;&amp; (!<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (uentry_whereDeclared (old),
08355                                               <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (old)))))
08356                     {
08357                       <font class="keywordflow">if</font> (optgenerror
08358                           (FLG_REDECL,
08359                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q declared more than once"</font>, 
08360                                     ekind_capName (unew-&gt;ukind),
08361                                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08362                            unew-&gt;whereDeclared))
08363                         {
08364                           llgenindentmsg
08365                             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Previous declaration of %q"</font>, 
08366                                       uentry_getName (old)),
08367                              old-&gt;whereDeclared);
08368                         }
08369                     }
08370                   
08371                   <a class="code" href="uentry_c.html#a54">uentry_setExtern</a> (old);
08372                 }
08373               <font class="keywordflow">else</font>
08374                 {
08375                   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (old, unewdef);
08376                 }
08377             }
08378         }
08379     }
08380 
08381   uentry_checkConformance (old, unew, mustConform, FALSE);
08382 
08383   old-&gt;used = old-&gt;used || unew-&gt;used;
08384   old-&gt;uses = <a class="code" href="filelocList_c.html#a3">filelocList_append</a> (old-&gt;uses, unew-&gt;uses);
08385   unew-&gt;uses = filelocList_undefined; 
08386 
08387   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (old-&gt;sref); 
08388   <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (unew-&gt;sref);
08389 
08390   <font class="keywordflow">if</font> (wasForward)
08391     {
08392       old-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;whereDefined,
08393                                           fileloc_undefined);
08394     }
08395 
08396   <font class="comment">/*</font>
08397 <font class="comment">  ** No redeclaration errors for functions here, since we</font>
08398 <font class="comment">  ** don't know if this is the definition of the function.</font>
08399 <font class="comment">  */</font>
08400 
08401   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (old-&gt;whereDeclared)
08402       &amp;&amp; <a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (unew-&gt;whereDeclared)
08403       &amp;&amp; !<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (old-&gt;whereDeclared, unew-&gt;whereDeclared)
08404       &amp;&amp; !fileloc_isDefined (unew-&gt;whereDefined))
08405     {
08406       <font class="keywordflow">if</font> (uentry_isFunction (old))
08407         {
08408           <font class="comment">/*@-temptrans@*/</font> posRedeclared = old; <font class="comment">/*@=temptrans@*/</font>
08409           posLoc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (posLoc, unew-&gt;whereDeclared);
08410         }
08411       <font class="keywordflow">else</font>
08412         {
08413           <font class="keywordflow">if</font> (optgenerror (FLG_REDECL,
08414                            message (<font class="stringliteral">"%s %q declared more than once"</font>, 
08415                                     ekind_capName (unew-&gt;ukind),
08416                                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08417                            unew-&gt;whereDeclared))
08418             {
08419               <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous declaration of %q"</font>, 
08420                                        uentry_getName (old)),
08421                               old-&gt;whereDeclared);
08422             }
08423         }
08424     }
08425 
08426   <font class="keywordflow">if</font> (fileloc_isUndefined (old-&gt;whereDefined))
08427     {
08428       old-&gt;whereDefined = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;whereDefined, unew-&gt;whereDefined);
08429     }
08430   <font class="keywordflow">else</font>
08431     {
08432       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a179">context_processingMacros</a> ()
08433           &amp;&amp; <a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (old-&gt;whereDefined) 
08434           &amp;&amp; <a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (unew-&gt;whereDefined)
08435           &amp;&amp; !<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (old-&gt;whereDefined, unew-&gt;whereDefined))
08436         {
08437           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (unew) || uentry_isFunction (unew))
08438             {
08439               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (unew) 
08440                   &amp;&amp; uentry_isExtern (unew))
08441                 {
08442                   <font class="keywordflow">if</font> (optgenerror (FLG_REDECL,
08443                                    message (<font class="stringliteral">"%s %q declared after definition"</font>, 
08444                                             ekind_capName (unew-&gt;ukind),
08445                                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08446                                    unew-&gt;whereDeclared))
08447                     {
08448                       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Definition of %q"</font>, 
08449                                                uentry_getName (old)),
08450                                       old-&gt;whereDefined);
08451                     }
08452                 }
08453               <font class="keywordflow">else</font>
08454                 {
08455                   <font class="keywordflow">if</font> (optgenerror (FLG_REDEF,
08456                                    message (<font class="stringliteral">"%s %q redefined"</font>, 
08457                                             ekind_capName (unew-&gt;ukind),
08458                                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew)),
08459                                    unew-&gt;whereDefined))
08460                     {
08461                       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Previous definition of %q"</font>, 
08462                                                uentry_getName (old)),
08463                                       old-&gt;whereDefined);
08464                     }
08465                 }
08466             }
08467         }
08468     }
08469 
08470   <font class="keywordflow">if</font> (uentry_isExternal (unew))
08471     {
08472       old-&gt;whereDefined = <a class="code" href="fileloc_c.html#a25">fileloc_createExternal</a> ();
08473     }
08474 
08475   <font class="keywordflow">if</font> (unew-&gt;hasNameError)
08476     {
08477       old-&gt;hasNameError = TRUE;
08478     }
08479 
08480   <a class="code" href="uentry_c.html#a238">uentry_free</a> (unew);
08481 
08482   <font class="keywordflow">if</font> (!old-&gt;hasNameError)
08483     {
08484       <a class="code" href="uentry_c.html#a284">uentry_checkName</a> (old);
08485     }
08486 
08487   llassert (!ctype_isUndefined (old-&gt;utype));
08488 }
08489 
08490 <font class="keywordtype">void</font>
<a name="l08491"></a><a class="code" href="uentry_c.html#a268">08491</a> <a class="code" href="uentry_c.html#a268">uentry_copyState</a> (uentry res, uentry other)<font class="keyword"></font>
08492 <font class="keyword"></font>{
08493   llassert (uentry_isValid (res));
08494   llassert (uentry_isValid (other));
08495 
08496   res-&gt;used = other-&gt;used;
08497 
08498   res-&gt;info-&gt;var-&gt;kind = other-&gt;info-&gt;var-&gt;kind;
08499   res-&gt;info-&gt;var-&gt;defstate = other-&gt;info-&gt;var-&gt;defstate;
08500   res-&gt;info-&gt;var-&gt;nullstate = other-&gt;info-&gt;var-&gt;nullstate;
08501   res-&gt;info-&gt;var-&gt;checked = other-&gt;info-&gt;var-&gt;checked;
08502 
08503   <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (res-&gt;sref, other-&gt;sref);
08504 }
08505 
08506 <font class="keywordtype">bool</font>
<a name="l08507"></a><a class="code" href="uentry_c.html#a269">08507</a> <a class="code" href="uentry_c.html#a269">uentry_sameKind</a> (uentry u1, uentry u2)<font class="keyword"></font>
08508 <font class="keyword"></font>{
08509   <font class="keywordflow">if</font> (uentry_isValid (u1) &amp;&amp; uentry_isValid (u2))
08510     {
08511       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (u1) &amp;&amp; <a class="code" href="uentry_c.html#a161">uentry_isVar</a> (u2))
08512         {
08513           ctype c1 = u1-&gt;utype;
08514           ctype c2 = u2-&gt;utype;
08515 
08516           <font class="keywordflow">if</font> (ctype_isUnknown (c1) || ctype_isUnknown (c2)) <font class="keywordflow">return</font> FALSE;
08517 
08518           <font class="comment">/*</font>
08519 <font class="comment">          ** both functions, or both not functions</font>
08520 <font class="comment">          */</font>
08521 
08522           <font class="keywordflow">return</font> (bool_equal (ctype_isFunction (c1), <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (c2)));
08523         }
08524       <font class="keywordflow">else</font>
08525         {
08526           <font class="keywordflow">return</font> ((u1-&gt;ukind == u2-&gt;ukind));
08527         }
08528     }
08529   
08530   <font class="keywordflow">return</font> FALSE;
08531 }
08532    
08533 <font class="keyword">static</font> <font class="keywordtype">void</font> uentry_copyInto (<font class="comment">/*@unique@*/</font> uentry unew, uentry old)<font class="keyword"></font>
08534 <font class="keyword"></font>{
08535   llassert (uentry_isValid (unew));
08536   llassert (uentry_isValid (old));
08537 
08538   unew-&gt;ukind = old-&gt;ukind;
08539   unew-&gt;uname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (old-&gt;uname);
08540   unew-&gt;utype = old-&gt;utype;
08541 
08542   unew-&gt;whereSpecified = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (old-&gt;whereSpecified);
08543   unew-&gt;whereDefined = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (old-&gt;whereDefined);
08544   unew-&gt;whereDeclared = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (old-&gt;whereDeclared);
08545 
08546   unew-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (old-&gt;sref); <font class="comment">/* Memory leak! */</font>
08547   unew-&gt;used = old-&gt;used;
08548   unew-&gt;lset = FALSE;
08549   unew-&gt;isPrivate = old-&gt;isPrivate;
08550   unew-&gt;hasNameError = old-&gt;hasNameError;
08551   unew-&gt;uses = filelocList_undefined;
08552 
08553   unew-&gt;storageclass = old-&gt;storageclass;
08554   unew-&gt;info = uinfo_copy (old-&gt;info, old-&gt;ukind);
08555 }
08556 
08557 
08558 uentry
<a name="l08559"></a><a class="code" href="uentry_c.html#a270">08559</a> <a class="code" href="uentry_c.html#a270">uentry_copy</a> (uentry e)<font class="keyword"></font>
08560 <font class="keyword"></font>{
08561   <font class="keywordflow">if</font> (uentry_isValid (e))
08562     {
08563       uentry enew = uentry_alloc ();
08564       DPRINTF ((<font class="stringliteral">"copy: %s"</font>, uentry_unparseFull (e)));
08565       uentry_copyInto (enew, e);
08566       DPRINTF ((<font class="stringliteral">"Here we are..."</font>));
08567       DPRINTF ((<font class="stringliteral">"original: %s"</font>, uentry_unparseFull (e)));
08568       DPRINTF ((<font class="stringliteral">"copy: %s"</font>, uentry_unparse (enew)));
08569       DPRINTF ((<font class="stringliteral">"copy: %s"</font>, uentry_unparseFull (enew)));
08570       <font class="keywordflow">return</font> enew;
08571     }
08572   <font class="keywordflow">else</font>
08573     {
08574       <font class="keywordflow">return</font> uentry_undefined;
08575     }
08576 }
08577 
08578 <font class="keywordtype">void</font>
<a name="l08579"></a><a class="code" href="uentry_c.html#a271">08579</a> <a class="code" href="uentry_c.html#a271">uentry_setState</a> (uentry res, uentry other)<font class="keyword"></font>
08580 <font class="keyword"></font>{
08581   llassert (uentry_isValid (res));
08582   llassert (uentry_isValid (other));
08583 
08584   llassert (res-&gt;ukind == other-&gt;ukind);
08585   llassert (res-&gt;ukind == KVAR);
08586 
08587   res-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (other-&gt;sref);
08588   res-&gt;used = other-&gt;used;
08589   <a class="code" href="filelocList_c.html#a11">filelocList_free</a> (res-&gt;uses); 
08590   res-&gt;uses = other-&gt;uses; 
08591   other-&gt;uses = filelocList_undefined; 
08592   res-&gt;lset = other-&gt;lset;
08593 }
08594 
08595 <font class="keywordtype">void</font>
<a name="l08596"></a><a class="code" href="uentry_c.html#a272">08596</a> <a class="code" href="uentry_c.html#a272">uentry_mergeUses</a> (uentry res, uentry other)<font class="keyword"></font>
08597 <font class="keyword"></font>{
08598   llassert (uentry_isValid (res));
08599   llassert (uentry_isValid (other));
08600 
08601   res-&gt;used = other-&gt;used || res-&gt;used;
08602   res-&gt;lset = other-&gt;lset || res-&gt;lset;
08603   res-&gt;uses = <a class="code" href="filelocList_c.html#a3">filelocList_append</a> (res-&gt;uses, other-&gt;uses);
08604   other-&gt;uses = filelocList_undefined;
08605 }
08606 
08607 
08608 <font class="comment">/*</font>
08609 <font class="comment">** This is a really ugly routine.</font>
08610 <font class="comment">**</font>
08611 <font class="comment">** gack...fix this one day.</font>
08612 <font class="comment">*/</font>
08613 
08614 <font class="comment">/*</font>
08615 <font class="comment">** flip == TRUE</font>
08616 <font class="comment">**   &gt;&gt; res is the false branch, other is the true branch (or continuation)</font>
08617 <font class="comment">** flip == FALSE</font>
08618 <font class="comment">**   &gt;&gt; res is the true branch, other is the false branch (or continutation)</font>
08619 <font class="comment">**</font>
08620 <font class="comment">** opt == TRUE if,</font>
08621 <font class="comment">**</font>
08622 <font class="comment">** &lt;other&gt;</font>
08623 <font class="comment">** if &lt;res&gt; ;</font>
08624 <font class="comment">**</font>
08625 <font class="comment">** References not effected by res are propagated from other.</font>
08626 <font class="comment">*/</font>
08627 
08628 <font class="keyword">static</font> <font class="keywordtype">void</font>
08629   branchStateError (<font class="comment">/*@notnull@*/</font> uentry res, <font class="comment">/*@notnull@*/</font> uentry other, 
08630                     <font class="keywordtype">bool</font> flip, clause cl, fileloc loc)<font class="keyword"></font>
08631 <font class="keyword"></font>{
08632   <font class="keywordflow">if</font> (optgenerror 
08633       (FLG_BRANCHSTATE,
08634        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q is %s %s, but %s %s."</font>,
08635                 ekind_capName (res-&gt;ukind), <a class="code" href="uentry_c.html#a195">uentry_getName</a> (res),
08636                 <a class="code" href="sRef_c.html#a101">sRef_stateVerb</a> (res-&gt;sref), <a class="code" href="clause_c.html#a3">clause_nameFlip</a> (cl, flip),
08637                 <a class="code" href="sRef_c.html#a102">sRef_stateAltVerb</a> (res-&gt;sref), <a class="code" href="clause_c.html#a3">clause_nameFlip</a> (cl, !flip)),
08638        loc))
08639     {
08640       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (res-&gt;sref))
08641         {
08642           <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (res-&gt;sref);
08643         }
08644       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isKept (res-&gt;sref))
08645         {
08646           <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (res-&gt;sref);
08647         }
08648       <font class="keywordflow">else</font> <font class="comment">/* dependent */</font>
08649         {
08650           <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (res-&gt;sref);
08651           <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (other-&gt;sref);
08652         }
08653       
08654       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res-&gt;sref, AK_ERROR, fileloc_undefined);
08655     }
08656 }
08657 
08658 <font class="keyword">static</font> <font class="keywordtype">bool</font> incompatibleStates (sRef rs, sRef os)<font class="keyword"></font>
08659 <font class="keyword"></font>{
08660   alkind rk = sRef_getAliasKind (rs);
08661   alkind ok = sRef_getAliasKind (os);
08662 
08663   <font class="keywordflow">if</font> (alkind_isError (rk) || alkind_isError (ok))
08664     {
08665       <font class="keywordflow">return</font> FALSE;
08666     }
08667   <font class="keywordflow">else</font>
08668     {
08669       <font class="keywordflow">return</font> ((<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (rs)
08670                || (alkind_isKept (rk) &amp;&amp; !alkind_isKept (ok))
08671                || (alkind_isDependent (rk) 
08672                    &amp;&amp; !alkind_isDependent (ok) &amp;&amp; !alkind_isTemp (ok)))
08673               &amp;&amp; (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (os) || sRef_isStateDefined (os)));
08674     }
08675 }
08676 
08677 <font class="keyword">static</font> <font class="keywordtype">void</font>
08678   branchStateAltError (<font class="comment">/*@notnull@*/</font> uentry res,
08679                        <font class="comment">/*@notnull@*/</font> uentry other, <font class="keywordtype">bool</font> flip,
08680                        clause cl, fileloc loc)<font class="keyword"></font>
08681 <font class="keyword"></font>{
08682   <font class="keywordflow">if</font> (optgenerror 
08683       (FLG_BRANCHSTATE,
08684        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q is %s %s, but %s %s."</font>,
08685                 ekind_capName (res-&gt;ukind), <a class="code" href="uentry_c.html#a195">uentry_getName</a> (res),
08686                 <a class="code" href="sRef_c.html#a101">sRef_stateVerb</a> (other-&gt;sref), <a class="code" href="clause_c.html#a3">clause_nameFlip</a> (cl, flip),
08687                 <a class="code" href="sRef_c.html#a102">sRef_stateAltVerb</a> (other-&gt;sref), <a class="code" href="clause_c.html#a3">clause_nameFlip</a> (cl, !flip)),
08688        loc))
08689     {
08690       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (other-&gt;sref))
08691         {
08692           <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (other-&gt;sref);
08693         }
08694       <font class="keywordflow">else</font> <font class="comment">/* kept */</font>
08695         {
08696           <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (other-&gt;sref);
08697         }
08698       
08699       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res-&gt;sref, AK_ERROR, fileloc_undefined);
08700       <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (res-&gt;sref, fileloc_undefined);
08701       
08702       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (other-&gt;sref, AK_ERROR, fileloc_undefined);
08703       <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (other-&gt;sref, fileloc_undefined);
08704     }
08705 }
08706 
08707 <font class="keyword">static</font> <font class="keywordtype">bool</font> notNull (sRef sr, <font class="keywordtype">bool</font> flip)<font class="keyword"></font>
08708 <font class="keyword"></font>{
08709   <font class="keywordflow">return</font> (!<a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (sr)
08710           &amp;&amp; !(sRef_isKept (sr))
08711           &amp;&amp; !(<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (sr))
08712           &amp;&amp; !(flip ? <a class="code" href="usymtab_c.html#a147">usymtab_isProbableDeepNull</a> (sr)
08713                : usymtab_isAltProbablyDeepNull (sr)));
08714 }
08715     
08716 <font class="keywordtype">void</font>
<a name="l08717"></a><a class="code" href="uentry_c.html#a277">08717</a> <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (uentry res, uentry other, fileloc loc,
08718                    <font class="keywordtype">bool</font> mustReturn, <font class="keywordtype">bool</font> flip, <font class="keywordtype">bool</font> opt,
08719                    clause cl)<font class="keyword"></font>
08720 <font class="keyword"></font>{
08721   llassert (uentry_isValid (res));
08722   llassert (uentry_isValid (other));
08723 
08724   llassert (res-&gt;ukind == other-&gt;ukind);
08725   llassert (res-&gt;ukind == KVAR);
08726 
08727   DPRINTF ((<font class="stringliteral">"Merge state: %s / %s"</font>, 
08728             uentry_unparse (res),
08729             <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (other)));
08730 
08731   <font class="keywordflow">if</font> (sRef_isValid (res-&gt;sref))
08732     {
08733       <font class="keywordflow">if</font> (!mustReturn)
08734         {
08735           <font class="keywordflow">if</font> (incompatibleStates (res-&gt;sref, other-&gt;sref))
08736             {
08737               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (res-&gt;sref)
08738                   &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTBRANCHSTATE))
08739                 {
08740                   <font class="keywordflow">if</font> (sRef_isKept (res-&gt;sref) || sRef_isKept (other-&gt;sref))
08741                     {
08742                       <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (res-&gt;sref, loc);
08743                     }
08744                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (other-&gt;sref))
08745                     {
08746                       <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (res-&gt;sref, loc);
08747                     }
08748                   <font class="keywordflow">else</font>
08749                     {
08750                       ;
08751                     }
08752                 }
08753               <font class="keywordflow">else</font>
08754                 {
08755                   <font class="keywordflow">if</font> (notNull (other-&gt;sref, flip))
08756                     {
08757                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a333">sRef_isLocalParamVar</a> (res-&gt;sref) 
08758                           &amp;&amp; (<a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (other-&gt;sref) 
08759                               || <a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (other-&gt;sref)))
08760                         {
08761                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (res-&gt;sref))
08762                             {
08763                               <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (other-&gt;sref, loc);
08764                             }
08765                           <font class="keywordflow">else</font>
08766                             {
08767                               <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (res-&gt;sref, SS_UNUSEABLE, loc);
08768                             }
08769                         }
08770                       <font class="keywordflow">else</font> 
08771                         {
08772                           branchStateError (res, other, flip, cl, loc);
08773                         }
08774                     }
08775                 }
08776               
08777               <font class="keywordflow">if</font> (sRef_isKept (res-&gt;sref))
08778                 {
08779                   <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (other-&gt;sref, loc);
08780                 }
08781             }
08782           <font class="keywordflow">else</font>
08783             {
08784               <font class="keywordflow">if</font> (incompatibleStates (other-&gt;sref, res-&gt;sref))
08785                 {
08786                   <font class="keywordflow">if</font> (notNull (res-&gt;sref, !flip))
08787                     {
08788                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a333">sRef_isLocalParamVar</a> (res-&gt;sref) 
08789                           &amp;&amp; (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (res-&gt;sref)
08790                               || <a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (res-&gt;sref)))
08791                         {
08792                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (other-&gt;sref))
08793                             {
08794                               <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (res-&gt;sref, loc);
08795                             }
08796                           <font class="keywordflow">else</font>
08797                             {
08798                               <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (res-&gt;sref, SS_UNUSEABLE, loc);
08799                             }
08800                         }
08801                       <font class="keywordflow">else</font>
08802                         {
08803                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (other-&gt;sref))
08804                             {
08805                               <font class="comment">/* </font>
08806 <font class="comment">                              ** If the local variable associated</font>
08807 <font class="comment">                              ** with the param has the correct state,</font>
08808 <font class="comment">                              ** its okay.</font>
08809 <font class="comment">                              ** (e.g., free (s); s = new(); ...</font>
08810 <font class="comment">                              */</font>
08811 
08812                               uentry uvar = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (other-&gt;uname);
08813 
08814                               <font class="keywordflow">if</font> (uentry_isValid (uvar)
08815                                   &amp;&amp; ((<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (other-&gt;sref) 
08816                                        &amp;&amp; <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (uvar-&gt;sref))
08817                                       || (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (other-&gt;sref)
08818                                           &amp;&amp; <a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (uvar-&gt;sref))))
08819                                 {
08820                                   <font class="comment">/* no error */</font>
08821                                 }
08822                               <font class="keywordflow">else</font>
08823                                 {
08824                                   branchStateAltError (res, other,
08825                                                        flip, cl, loc);
08826                                 }
08827                             }
08828                           <font class="keywordflow">else</font>
08829                             {
08830                               branchStateAltError (res, other, 
08831                                                    flip, cl, loc);
08832                             }
08833                         }
08834                     }
08835                 }
08836 
08837               <font class="keywordflow">if</font> (sRef_isKept (other-&gt;sref))
08838                 {
08839                   <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (res-&gt;sref, loc);
08840                 }
08841             }
08842           
08843           <font class="keywordflow">if</font> (opt)
08844             {
08845               DPRINTF ((<font class="stringliteral">"Merge opt..."</font>));
08846               <a class="code" href="sRef_c.html#a150">sRef_mergeOptState</a> (res-&gt;sref, other-&gt;sref, cl, loc);
08847               DPRINTF ((<font class="stringliteral">"Done!"</font>));
08848             }
08849           <font class="keywordflow">else</font>
08850             {
08851               <a class="code" href="sRef_c.html#a149">sRef_mergeState</a> (res-&gt;sref, other-&gt;sref, cl, loc);
08852             }
08853         }
08854       <font class="keywordflow">else</font>
08855         {
08856           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a97">sRef_isModified</a> (other-&gt;sref))
08857             {
08858               <a class="code" href="sRef_c.html#a98">sRef_setModified</a> (res-&gt;sref);
08859             }
08860         }
08861 
08862       <font class="keywordflow">if</font> (cl == DOWHILECLAUSE)
08863         {
08864           res-&gt;used = other-&gt;used || res-&gt;used;
08865           res-&gt;lset = other-&gt;lset || res-&gt;lset;
08866           res-&gt;uses = <a class="code" href="filelocList_c.html#a3">filelocList_append</a> (res-&gt;uses, other-&gt;uses);
08867           other-&gt;uses = filelocList_undefined;
08868         }
08869       <font class="keywordflow">else</font>
08870         {
08871           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (res-&gt;sref)
08872               &amp;&amp; !<a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (other)
08873               &amp;&amp; !<a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (res))
08874             {
08875               <font class="keywordtype">bool</font> hasError = FALSE;
08876               
08877               <font class="keywordflow">if</font> (bool_equal (res-&gt;used, other-&gt;used))
08878                 {
08879                   res-&gt;used = other-&gt;used;
08880                 }
08881               <font class="keywordflow">else</font>
08882                 {
08883                   <font class="keywordflow">if</font> (other-&gt;used &amp;&amp; !flip)
08884                     {
08885                       hasError = 
08886                         optgenerror 
08887                           (FLG_MACROPARAMS,
08888                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Macro parameter %q used in true clause, "</font>
08889                                     <font class="stringliteral">"but not in false clause"</font>,
08890                                     uentry_getName (res)),
08891                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (res));
08892                     }
08893                   <font class="keywordflow">else</font>
08894                     {   
08895                       hasError = 
08896                         optgenerror 
08897                           (FLG_MACROPARAMS,
08898                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Macro parameter %q used in false clause, "</font>
08899                                     <font class="stringliteral">"but not in true clause"</font>,
08900                                     uentry_getName (res)),
08901                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (res));
08902                     }
08903                   res-&gt;used = TRUE;
08904                   
08905                   <font class="keywordflow">if</font> (hasError)
08906                     {
08907                       <font class="comment">/* make it sef now, prevent more errors */</font>
08908                       res-&gt;info-&gt;var-&gt;kind = VKREFSEFPARAM;
08909                     }
08910                 }
08911             }
08912           <font class="keywordflow">else</font>
08913             {
08914               res-&gt;used = other-&gt;used || res-&gt;used;
08915               res-&gt;lset = other-&gt;lset || res-&gt;lset;
08916               res-&gt;uses = <a class="code" href="filelocList_c.html#a3">filelocList_append</a> (res-&gt;uses, other-&gt;uses);
08917               other-&gt;uses = filelocList_undefined;
08918             }
08919         }
08920     }
08921 }
08922 
<a name="l08923"></a><a class="code" href="uentry_c.html#a278">08923</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (uentry e, fileloc loc)<font class="keyword"></font>
08924 <font class="keyword"></font>{
08925   <font class="keyword">static</font> <font class="keywordtype">bool</font> firstTime = TRUE;
08926   <font class="keyword">static</font> <font class="keywordtype">bool</font> showUses = FALSE;
08927   <font class="keyword">static</font> <font class="keywordtype">bool</font> exportLocal = FALSE;
08928 
08929   <font class="keywordflow">if</font> (firstTime)
08930     {
08931       <font class="comment">/* need to track uses is FLG_SHOWUSES or FLG_EXPORTLOCAL is true */</font>
08932 
08933       showUses = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWUSES); 
08934       exportLocal = <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EXPORTLOCAL);
08935 
08936       firstTime = FALSE;
08937     }
08938 
08939   <font class="keywordflow">if</font> (uentry_isValid (e))
08940     {
08941       <font class="keywordtype">int</font> dp;
08942       
08943       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (e-&gt;sref))
08944         {
08945           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (e) || <a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (e))
08946             {
08947               ;
08948             }
08949           <font class="keywordflow">else</font> 
08950             {
08951               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a80">context_inConditional</a> ())
08952                 {
08953                   <font class="keywordflow">if</font> (optgenerror
08954                       (FLG_MACROPARAMS,
08955                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Macro parameter %q used in conditionally "</font>
08956                                 <font class="stringliteral">"executed code (may or may not be "</font>
08957                                 <font class="stringliteral">"evaluated exactly once)"</font>, 
08958                                 uentry_getName (e)),
08959                        loc))
08960                     {
08961                       e-&gt;info-&gt;var-&gt;kind = VKREFSEFPARAM;
08962                     }
08963                 }
08964               <font class="keywordflow">else</font>
08965                 {
08966                   <font class="keywordflow">if</font> ((e)-&gt;used)
08967                     {
08968                       <font class="keywordflow">if</font> (optgenerror
08969                           (FLG_MACROPARAMS,
08970                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Macro parameter %q used more than once"</font>, 
08971                                     uentry_getName (e)),
08972                            <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e)))
08973                         {
08974                           e-&gt;info-&gt;var-&gt;kind = VKREFSEFPARAM;
08975                         }
08976                     }
08977                 }
08978             }
08979         }
08980       
08981       <font class="keywordflow">if</font> ((dp = <a class="code" href="usymtab_c.html#a109">uentry_directParamNo</a> (e)) &gt;= 0)
08982         {
08983           <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (usymtab_getParam (dp), loc);
08984         }
08985       
08986       e-&gt;used = TRUE;
08987       
08988       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (e-&gt;sref))
08989         {
08990           <font class="keywordflow">if</font> (showUses)
08991             {
08992               e-&gt;uses = <a class="code" href="filelocList_c.html#a7">filelocList_add</a> (e-&gt;uses, fileloc_copy (loc));
08993             }
08994           <font class="keywordflow">else</font> 
08995             {
08996               <font class="keywordflow">if</font> (exportLocal)
08997                 {
08998                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ())
08999                     {
09000                       e-&gt;uses = <a class="code" href="filelocList_c.html#a4">filelocList_addUndefined</a> (e-&gt;uses);
09001                     }
09002                   <font class="keywordflow">else</font> 
09003                     {
09004                       e-&gt;uses = filelocList_addDifferentFile
09005                         (e-&gt;uses, 
09006                          <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e),
09007                          loc);
09008                     }
09009                 }
09010             }
09011         }
09012     }
09013 }
09014 
<a name="l09015"></a><a class="code" href="uentry_c.html#a279">09015</a> <font class="keywordtype">bool</font> <a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (uentry u)<font class="keyword"></font>
09016 <font class="keyword"></font>{
09017   <font class="keywordflow">return</font> (uentry_isValid (u) &amp;&amp; <a class="code" href="uentry_c.html#a161">uentry_isVar</a> (u) 
09018           &amp;&amp; (u-&gt;info-&gt;var-&gt;kind == VKRETPARAM
09019               || u-&gt;info-&gt;var-&gt;kind == VKSEFRETPARAM));
09020 }
09021 
<a name="l09022"></a><a class="code" href="uentry_c.html#a280">09022</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="uentry_c.html#a280">uentry_returnedRef</a> (uentry u, exprNodeList args)<font class="keyword"></font>
09023 <font class="keyword"></font>{
09024   llassert (uentry_isRealFunction (u));
09025 
09026   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (u-&gt;utype)
09027       &amp;&amp; sRef_isStateSpecial (uentry_getSref (u)))
09028     {
09029       specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (u);
09030       sRef res = <a class="code" href="sRef_c.html#a284">sRef_makeNew</a> (ctype_returnValue (u-&gt;utype), u-&gt;sref, u-&gt;uname);
09031 
09032       <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (res, g_currentloc);
09033 
09034       specialClauses_postElements (clauses, cl)<font class="keyword"></font>
09035 <font class="keyword">        </font>{
09036           sRefSet refs = specialClause_getRefs (cl);
09037           sRefMod modf = <a class="code" href="specialClauses_c.html#a13">specialClause_getEffectFunction</a> (cl);
09038 
09039           sRefSet_elements (refs, el)<font class="keyword"></font>
09040 <font class="keyword">            </font>{
09041               sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
09042 
09043               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (base))
09044                 {
09045                   <font class="keywordflow">if</font> (modf != NULL)
09046                     {
09047                       sRef sr = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (el, res);
09048                       modf (sr, g_currentloc);
09049                     }
09050                 }
09051               <font class="keywordflow">else</font>
09052                 {
09053                   ;
09054                 }
09055             } end_sRefSet_elements ;
09056 
09057         } end_specialClauses_postElements ;
09058 
09059       <font class="keywordflow">return</font> res;
09060     }
09061   <font class="keywordflow">else</font>
09062     {
09063       uentryList params;
09064       alkind ak;
09065       sRefSet prefs = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
09066       sRef res = sRef_undefined;
09067       <font class="keywordtype">int</font> paramno = 0;
09068       
09069       params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (u);
09070       
09071       uentryList_elements (params, current)<font class="keyword"></font>
09072 <font class="keyword">        </font>{
09073           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (current))
09074             {
09075               <font class="keywordflow">if</font> (exprNodeList_size (args) &gt;= paramno)
09076                 {
09077                   exprNode ecur = <a class="code" href="exprNodeList_c.html#a10">exprNodeList_nth</a> (args, paramno);
09078                   sRef tref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (ecur);
09079                   
09080                   <font class="keywordflow">if</font> (sRef_isValid (tref))
09081                     {
09082                       sRef tcref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (tref);
09083                       
09084                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (tcref))
09085                         {
09086                           <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (tcref, g_currentloc);
09087                           <a class="code" href="sRef_c.html#a220">sRef_setOnly</a> (tcref, g_currentloc);
09088                         }
09089                       
09090                       <font class="keywordflow">if</font> (sRef_isRefCounted (tcref))
09091                         {
09092                           <font class="comment">/* could be a new ref now (but only if its returned) */</font>
09093                           <a class="code" href="sRef_c.html#a185">sRef_setAliasKindComplete</a> (tcref, AK_ERROR, g_currentloc);
09094                         }
09095                       
09096                       <a class="code" href="sRef_c.html#a167">sRef_makeSafe</a> (tcref);
09097                       
09098                       prefs = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (prefs, tcref);
09099                     }
09100                 }
09101             }
09102           
09103           paramno++;
09104         } end_uentryList_elements ;
09105       
09106       <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (prefs) &gt; 0)
09107         {
09108           nstate n = sRef_getNullState (u-&gt;sref);
09109           
09110           <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (prefs) == 1)
09111             {
09112               res = <a class="code" href="sRefSet_c.html#a8">sRefSet_choose</a> (prefs);
09113             }
09114           <font class="keywordflow">else</font>
09115             {
09116               res = <a class="code" href="sRefSet_c.html#a9">sRefSet_mergeIntoOne</a> (prefs);
09117             }
09118           
09119           <font class="keywordflow">if</font> (nstate_isKnown (n))
09120             {
09121               <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (res, n, g_currentloc);
09122             }
09123         }
09124       <font class="keywordflow">else</font>
09125         {
09126           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (u-&gt;utype))
09127             {
09128               res = <a class="code" href="sRef_c.html#a284">sRef_makeNew</a> (ctype_returnValue (u-&gt;utype), u-&gt;sref, u-&gt;uname);
09129             }
09130           <font class="keywordflow">else</font>
09131             {
09132               res = <a class="code" href="sRef_c.html#a284">sRef_makeNew</a> (ctype_unknown, u-&gt;sref, u-&gt;uname);
09133             }
09134           
09135           <font class="keywordflow">if</font> (sRef_isRefCounted (res))
09136             {
09137               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res, AK_NEWREF, g_currentloc);
09138             }
09139         }
09140       
09141       <font class="keywordflow">if</font> (sRef_getNullState (res) == NS_ABSNULL)
09142         {
09143           ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (u-&gt;utype);
09144           
09145           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct))
09146             {
09147               <a class="code" href="sRef_c.html#a213">sRef_setNotNull</a> (res, g_currentloc);
09148             }
09149           <font class="keywordflow">else</font>
09150             {
09151               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a32">ctype_isUser</a> (ct))
09152                 {
09153                   <a class="code" href="sRef_c.html#a266">sRef_setStateFromUentry</a> (res, usymtab_getTypeEntry (ctype_typeId (ct)));
09154                 }
09155               <font class="keywordflow">else</font>
09156                 {
09157                   <a class="code" href="sRef_c.html#a213">sRef_setNotNull</a> (res, g_currentloc);
09158                 }
09159             }
09160         }
09161       
09162       <font class="keywordflow">if</font> (sRef_isRefCounted (res))
09163         {
09164           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res, AK_NEWREF, g_currentloc);
09165         }
09166       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isKillRef (res))
09167         {
09168           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res, AK_REFCOUNTED, g_currentloc);
09169         }
09170       <font class="keywordflow">else</font>
09171         {
09172           ;
09173         }
09174       
09175       ak = sRef_getAliasKind (res);
09176       
09177       <font class="keywordflow">if</font> (alkind_isImplicit (ak))
09178         {
09179           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (res, 
09180                              alkind_fixImplicit (ak),
09181                              g_currentloc);
09182         }
09183       
09184       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (prefs);
09185       
09186       <font class="keywordflow">return</font> res;
09187     }
09188 }
09189 
09190 <font class="keyword">static</font> <font class="keywordtype">bool</font> uentry_isRefCounted (uentry ue)<font class="keyword"></font>
09191 <font class="keyword"></font>{
09192   ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
09193 
09194   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
09195     {
09196       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a130">ctype_isRefCounted</a> (ctype_returnValue (ct)));
09197     }
09198   <font class="keywordflow">else</font>
09199     {
09200       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a130">ctype_isRefCounted</a> (ct));
09201     }
09202 }
09203 
09204 <font class="comment">/*</font>
09205 <font class="comment">** old was declared yield in the specification.  </font>
09206 <font class="comment">** new is declared in the iter implementation.</font>
09207 <font class="comment">*/</font>
09208 
<a name="l09209"></a><a class="code" href="uentry_c.html#a281">09209</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a281">uentry_checkYieldParam</a> (uentry old, uentry unew)<font class="keyword"></font>
09210 <font class="keyword"></font>{
09211   cstring name;
09212 
09213   llassert (uentry_isVariable (old));
09214   llassert (uentry_isVariable (unew));
09215 
09216   unew-&gt;info-&gt;var-&gt;kind = VKYIELDPARAM;
09217   (<font class="keywordtype">void</font>) checkTypeConformance (old, unew, TRUE);
09218   checkVarConformance (old, unew, TRUE, FALSE);
09219 
09220   <font class="comment">/* get rid of param marker */</font>
09221 
09222   name = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (unew);
09223   <a class="code" href="cstring_c.html#a27">cstring_free</a> (unew-&gt;uname);
09224   unew-&gt;uname = name;
09225   unew-&gt;info-&gt;var-&gt;kind = VKREFYIELDPARAM;
09226 
09227   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (old, fileloc_undefined);
09228   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (unew, fileloc_undefined);
09229 }
09230 
09231 <font class="comment">/*@observer@*/</font> cstring
<a name="l09232"></a><a class="code" href="uentry_c.html#a282">09232</a> <a class="code" href="uentry_c.html#a282">uentry_ekindName</a> (uentry ue)<font class="keyword"></font>
09233 <font class="keyword"></font>{
09234   <font class="keywordflow">if</font> (uentry_isValid (ue))
09235     {
09236       <font class="keywordflow">switch</font> (ue-&gt;ukind)
09237         {
09238         <font class="keywordflow">case</font> KINVALID:
09239           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;Error: invalid uentry&gt;"</font>);
09240         <font class="keywordflow">case</font> KDATATYPE: 
09241           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Datatype"</font>);
09242         <font class="keywordflow">case</font> KENUMCONST:
09243           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Enum member"</font>);
09244         <font class="keywordflow">case</font> KCONST:  
09245           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Constant"</font>);
09246         <font class="keywordflow">case</font> KVAR:      
09247           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a170">uentry_isParam</a> (ue))
09248             {
09249               <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Parameter"</font>);
09250             }
09251           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ue))
09252             {
09253               <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Expanded macro"</font>);
09254             }
09255           <font class="keywordflow">else</font>
09256             {
09257               <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Variable"</font>);
09258             }
09259         <font class="keywordflow">case</font> KFCN:   
09260           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Function"</font>);
09261         <font class="keywordflow">case</font> KITER: 
09262           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Iterator"</font>);
09263         <font class="keywordflow">case</font> KENDITER:
09264           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Iterator finalizer"</font>);
09265         <font class="keywordflow">case</font> KSTRUCTTAG:
09266           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Struct tag"</font>);
09267         <font class="keywordflow">case</font> KUNIONTAG:
09268           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Union tag"</font>);
09269         <font class="keywordflow">case</font> KENUMTAG: 
09270           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Enum tag"</font>);
09271         <font class="keywordflow">case</font> KELIPSMARKER: 
09272           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Optional parameters"</font>);
09273         }
09274     }
09275   <font class="keywordflow">else</font>
09276     {
09277       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;Undefined&gt;"</font>);
09278     }
09279 
09280   BADEXIT;
09281 }
09282 
<a name="l09283"></a><a class="code" href="uentry_c.html#a283">09283</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (uentry ue)<font class="keyword"></font>
09284 <font class="keyword"></font>{
09285   llassert (uentry_isValid (ue));
09286 
09287   ue-&gt;hasNameError = TRUE;
09288 }
09289 
<a name="l09290"></a><a class="code" href="uentry_c.html#a284">09290</a> <font class="keywordtype">void</font> <a class="code" href="uentry_c.html#a284">uentry_checkName</a> (uentry ue)<font class="keyword"></font>
09291 <font class="keyword"></font>{
09292   <font class="keywordflow">if</font> (uentry_isValid (ue) 
09293       &amp;&amp; !uentry_isElipsisMarker (ue)
09294       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NAMECHECKS)
09295       &amp;&amp; !ue-&gt;hasNameError 
09296       &amp;&amp; !<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ue)
09297       &amp;&amp; !fileloc_isBuiltin (uentry_whereLast (ue))
09298       &amp;&amp; (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ue) || !<a class="code" href="uentry_c.html#a108">uentry_isForward</a> (ue)))
09299     {
09300       
09301       <font class="keywordflow">if</font> (uentry_isPriv (ue))
09302         {
09303           ; <font class="comment">/* any checks here? */</font>
09304         }
09305       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isExternal (uentry_whereDefined (ue)))
09306         {
09307           ; <font class="comment">/* no errors for externals */</font>
09308         }
09309       <font class="keywordflow">else</font>
09310         {
09311           <font class="keywordtype">int</font> scope;
09312           
09313           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ue))
09314             {
09315               scope = globScope;
09316             }
09317           <font class="keywordflow">else</font>
09318             {
09319               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ue))
09320                 {
09321                   scope = fileScope;
09322                 }
09323               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue))
09324                 {
09325                   sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
09326 
09327                   <font class="keywordflow">if</font> (sRef_isValid (sr))
09328                     {
09329                       scope = <a class="code" href="sRef_c.html#a307">sRef_getScope</a> (sr);
09330                     }
09331                   <font class="keywordflow">else</font>
09332                     {
09333                       scope = fileScope; 
09334                     }
09335                 }
09336               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isFunction (ue)
09337                        || <a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ue)
09338                        || <a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ue)
09339                        || uentry_isConstant (ue))
09340                 {
09341                   scope = uentry_isStatic (ue) ? fileScope : globScope;
09342                 }
09343               <font class="keywordflow">else</font> <font class="comment">/* datatypes, etc. must be global */</font>
09344                 {
09345                   scope = globScope;
09346                 }
09347               
09348               <a class="code" href="usymtab_c.html#a165">usymtab_checkDistinctName</a> (ue, scope);
09349             }
09350 
09351           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_CPPNAMES)) 
09352             {
09353               <font class="keywordflow">if</font> (<a class="code" href="nameChecks_c.html#a17">checkCppName</a> (uentry_rawName (ue), <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
09354                 {
09355                   <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue);
09356                 }
09357             }
09358 
09359           <font class="keywordflow">if</font> (scope == globScope)
09360             {
09361               <a class="code" href="nameChecks_c.html#a15">checkGlobalName</a> (ue);
09362 
09363               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ANSIRESERVED))
09364                 {
09365                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (ue)
09366                       &amp;&amp; !<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ue))
09367                     {
09368                       <font class="keywordflow">if</font> (<a class="code" href="nameChecks_c.html#a18">checkAnsiName</a> (uentry_rawName (ue),
09369                                          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
09370                         {
09371                           <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue);
09372                         }
09373                     }
09374                 }
09375             }
09376           <font class="keywordflow">else</font>
09377             {
09378               <a class="code" href="nameChecks_c.html#a16">checkLocalName</a> (ue);
09379               
09380               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ANSIRESERVEDLOCAL))
09381                 {
09382                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (ue)
09383                       &amp;&amp; !<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ue))
09384                     {
09385                       <font class="keywordflow">if</font> (<a class="code" href="nameChecks_c.html#a18">checkAnsiName</a> (uentry_rawName (ue),
09386                                          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
09387                         {
09388                           <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue);
09389                         }
09390                     }
09391                 }
09392             }
09393 
09394           DPRINTF ((<font class="stringliteral">"Check prefix: %s"</font>, uentry_unparse (ue)));
09395           <a class="code" href="nameChecks_c.html#a13">checkPrefix</a> (ue);
09396         }
09397     }
09398 }
09399 
<a name="l09400"></a><a class="code" href="uentry_c.html#a285">09400</a> <font class="comment">/*@exposed@*/</font> uentry <a class="code" href="uentry_c.html#a285">uentry_makeUnrecognized</a> (cstring c, <font class="comment">/*@keep@*/</font> fileloc loc)<font class="keyword"></font>
09401 <font class="keyword"></font>{
09402   uentry ue;
09403   fileloc tloc;
09404 
09405   <font class="comment">/*</font>
09406 <font class="comment">  ** Can't but unrecognized ids in macros in global scope, because srefs will break! */</font>
09407   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a235">context_inMacro</a> ())
09408     {
09409       <a class="code" href="sRef_c.html#a83">sRef_setGlobalScopeSafe</a> ();
09410     }
09411 
09412   ue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (c, ctype_unknown, loc, FALSE);
09413   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ue, loc);               
09414   
09415   tloc = <a class="code" href="fileloc_c.html#a25">fileloc_createExternal</a> ();
09416   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, tloc);
09417   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (tloc);
09418   <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue);
09419   
09420   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_REPEATUNRECOG))
09421     {
09422       <a class="code" href="uentry_c.html#a237">uentry_markOwned</a> (ue);
09423     }
09424   <font class="keywordflow">else</font>
09425     {
09426       ue = <a class="code" href="usymtab_c.html#a62">usymtab_supReturnFileEntry</a> (ue);
09427     }
09428   
09429   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a235">context_inMacro</a> ())
09430     {
09431       <a class="code" href="sRef_c.html#a84">sRef_clearGlobalScopeSafe</a> ();
09432     }
09433 
09434   <font class="keywordflow">return</font> ue;
09435 }
09436 
09437 
09438 
09439 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:45 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
