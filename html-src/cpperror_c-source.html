<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cpperror.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:39 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>cpperror.c</h1><a href="cpperror_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** cpperror.c</font>
00026 <font class="comment">*/</font>
00027 <font class="comment">/* Default error handlers for CPP Library.</font>
00028 <font class="comment">   Copyright (C) 1986, 87, 89, 92, 93, 94, 1995 Free Software Foundation, Inc.</font>
00029 <font class="comment">   Written by Per Bothner, 1994.</font>
00030 <font class="comment">   Based on CCCP program by by Paul Rubin, June 1986</font>
00031 <font class="comment">   Adapted to ANSI C, Richard Stallman, Jan 1987</font>
00032 <font class="comment"></font>
00033 <font class="comment">This program is free software; you can redistribute it and/or modify it</font>
00034 <font class="comment">under the terms of the GNU General Public License as published by the</font>
00035 <font class="comment">Free Software Foundation; either version 2, or (at your option) any</font>
00036 <font class="comment">later version.</font>
00037 <font class="comment"></font>
00038 <font class="comment">This program is distributed in the hope that it will be useful,</font>
00039 <font class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00040 <font class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
00041 <font class="comment">GNU General Public License for more details.</font>
00042 <font class="comment"></font>
00043 <font class="comment">You should have received a copy of the GNU General Public License</font>
00044 <font class="comment">along with this program; if not, write to the Free Software</font>
00045 <font class="comment">Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</font>
00046 <font class="comment"></font>
00047 <font class="comment"> In other words, you are welcome to use, share and improve this program.</font>
00048 <font class="comment"> You are forbidden to forbid anyone else to use, share and improve</font>
00049 <font class="comment"> what you give them.   Help stamp out software-hoarding!  */</font>
00050 
00051 <font class="comment">/*@-macroconstdecl@*/</font> 
00052 <font class="comment">/*@-macrofcndecl@*/</font>
00053 <font class="comment">/*@-evalorderuncon@*/</font>
00054 <font class="comment">/*@+ptrnegate@*/</font>
00055 <font class="comment">/*@-memchecks@*/</font>
00056 <font class="comment">/*@+charintliteral@*/</font>
00057 <font class="comment">/*@-infloopsuncon@*/</font>
00058 <font class="comment">/*@-loopswitchbreak@*/</font>
00059 <font class="comment">/*@-switchloopbreak@*/</font>
00060 <font class="comment">/*@-whileblock@*/</font>
00061 <font class="comment">/*@-forblock@*/</font>
00062 <font class="comment">/*@-elseifcomplete@*/</font>
00063 <font class="comment">/*@-abstract@*/</font>
00064 <font class="comment">/*@-usedef@*/</font>
00065 <font class="comment">/*@-retvalint@*/</font>
00066 <font class="comment">/*@-macroparams@*/</font>
00067 <font class="comment">/*@-readonlytrans@*/</font>
00068 <font class="comment">/*@-boolops@*/</font>
00069 <font class="comment">/*@-sizeoftype@*/</font>
00070 <font class="comment">/*@-predboolint@*/</font>
00071 <font class="comment">/*@-predboolptr@*/</font>
00072 <font class="comment">/*@+boolint@*/</font>
00073 <font class="comment">/*@+charint@*/</font>
00074 <font class="comment">/*@+ignorequals@*/</font>
00075 <font class="comment">/*@+ignoresigns@*/</font>
00076 <font class="comment">/*@+matchanyintegral@*/</font>
00077 <font class="comment">/*@-shiftsigned@*/</font>
00078 <font class="comment">/*@-onlyunqglobaltrans@*/</font>
00079 <font class="comment">/*@-macroconstdecl@*/</font>
00080 
00081 <font class="preprocessor"># include &lt;stdlib.h&gt;</font>
00082 <font class="preprocessor"># include &lt;errno.h&gt;</font>
00083 <font class="preprocessor"># include &lt;stdio.h&gt;</font>
00084 
<a name="l00085"></a><a class="code" href="cpperror_c.html#a0">00085</a> <font class="preprocessor"># define FATAL_EXIT_CODE EXIT_FAILURE</font>
00086 <font class="preprocessor"></font>
00087 <font class="preprocessor"># include "lclintMacros.nf"</font>
00088 <font class="preprocessor"># include "llbasic.h"</font>
00089 <font class="preprocessor"># include "cpp.h"</font>
00090 <font class="preprocessor"># include "cpplib.h"</font>
00091 <font class="preprocessor"># include "cpperror.h"</font>
00092 
00093 <font class="keyword">static</font> <font class="keywordtype">void</font> cppReader_printFileAndLine (cppReader *p_pfile);
00094 <font class="keyword">static</font> <font class="keywordtype">void</font> cppReader_warningWithLine (cppReader *p_pfile, 
00095                                        <font class="keywordtype">int</font> p_line, <font class="keywordtype">int</font> p_column, 
00096                                        <font class="comment">/*@only@*/</font> cstring p_msg);
00097 
00098 <font class="comment">/* Print the file names and line numbers of the #include</font>
00099 <font class="comment">   commands which led to the current file.  */</font>
00100 
00101 <font class="keyword">static</font> <font class="keywordtype">void</font> cppReader_printContainingFiles (cppReader *pfile)<font class="keyword"></font>
00102 <font class="keyword"></font>{
00103   cppBuffer *ip;
00104   <font class="keywordtype">int</font> first = 1;
00105 
00106   <font class="keywordflow">if</font> (pfile == NULL) {
00107     <font class="comment">/* Error processing command line. */</font>
00108     <font class="keywordflow">return</font>;
00109   }
00110 
00111   <font class="comment">/* If stack of files hasn't changed since we last printed</font>
00112 <font class="comment">     this info, don't repeat it.  */</font>
00113   <font class="keywordflow">if</font> (pfile-&gt;input_stack_listing_current)
00114     {
00115       <font class="keywordflow">return</font>;
00116     }
00117 
00118   ip = <a class="code" href="cpplib_c.html#a127">cppReader_fileBuffer</a> (pfile);
00119 
00120   <font class="comment">/* Give up if we don't find a source file.  */</font>
00121   <font class="keywordflow">if</font> (ip == NULL)
00122     {
00123       <font class="keywordflow">return</font>;
00124     }
00125 
00126   <font class="comment">/* Find the other, outer source files.  */</font>
00127   <font class="keywordflow">while</font> ((ip = <a class="code" href="cpplib_c.html#a149">cppBuffer_prevBuffer</a> (ip)), 
00128          ip != cppReader_nullBuffer (pfile))
00129     {
00130       <font class="keywordtype">int</font> line, col;
00131       cstring temps; 
00132       
00133       <a class="code" href="cpplib_c.html#a126">cppBuffer_lineAndColumn</a> (ip, &amp;line, &amp;col);
00134       <font class="keywordflow">if</font> (ip-&gt;fname != NULL)
00135         {
00136           <font class="keywordflow">if</font> (first)
00137             {
00138               first = 0;
00139               fprintf (stderr, <font class="stringliteral">"In file included"</font>);
00140             }
00141           <font class="keywordflow">else</font>
00142             fprintf (stderr, <font class="stringliteral">",\n                "</font>);
00143         }
00144 
00145       fprintf (stderr, <font class="stringliteral">"  from %s"</font>, 
00146                cstring_toCharsSafe (temps = fileloc_unparseRaw (ip-&gt;nominal_fname, line)));
00147 
00148       <a class="code" href="cstring_c.html#a27">cstring_free</a> (temps);
00149     }
00150   
00151   <font class="keywordflow">if</font> (!first)
00152     {
00153       fprintf (stderr, <font class="stringliteral">":\n"</font>);
00154     }
00155 
00156   <font class="comment">/* Record we have printed the status as of this time.  */</font>
00157   pfile-&gt;input_stack_listing_current = 1;
00158 }
00159 
00160 <font class="keyword">static</font> <font class="keywordtype">void</font>
00161 cppReader_fileLineForMessage (cstring filename, <font class="keywordtype">long</font> line, <font class="keywordtype">long</font> column)<font class="keyword"></font>
00162 <font class="keyword"></font>{
00163   <font class="keywordflow">if</font> (column &gt; 0)
00164     {
00165       cstring temps;
00166 
00167       <font class="keywordflow">if</font> (filename != NULL)
00168         {
00169           fprintf (stderr, <font class="stringliteral">"%s: "</font>,
00170                    cstring_toCharsSafe (temps = fileloc_unparseRawCol (filename, (<font class="keywordtype">int</font>) line, (<font class="keywordtype">int</font>) column)));
00171         }
00172       <font class="keywordflow">else</font> 
00173         {
00174           fprintf (stderr, <font class="stringliteral">"%s: "</font>,
00175                    cstring_toCharsSafe (temps = fileloc_unparseRawCol (cstring_makeLiteralTemp (<font class="stringliteral">"&lt;no file&gt;"</font>),
00176                                                                        (<font class="keywordtype">int</font>) line, (<font class="keywordtype">int</font>) column)));
00177         }
00178 
00179       <a class="code" href="cstring_c.html#a27">cstring_free</a> (temps);
00180     }
00181   <font class="keywordflow">else</font>
00182     {
00183       cstring temps;
00184 
00185       <font class="keywordflow">if</font> (filename != NULL) 
00186         {
00187           fprintf (stderr, <font class="stringliteral">"%s: "</font>, 
00188                    cstring_toCharsSafe (temps = fileloc_unparseRaw (filename, (<font class="keywordtype">int</font>) line)));
00189           
00190         }
00191       <font class="keywordflow">else</font>
00192         {
00193           fprintf (stderr, <font class="stringliteral">"%s: "</font>,
00194                    cstring_toCharsSafe (temps = fileloc_unparseRaw (cstring_makeLiteralTemp (<font class="stringliteral">"&lt;no file&gt;"</font>),
00195                                                                     (<font class="keywordtype">int</font>) line)));
00196         }
00197 
00198       <a class="code" href="cstring_c.html#a27">cstring_free</a> (temps);
00199     }
00200 }
00201 
00202 <font class="comment">/* IS_ERROR is 2 for "fatal" error, 1 for error, 0 for warning */</font>
00203 
00204 <font class="keyword">static</font> <font class="keywordtype">void</font>
00205 cppReader_message (cppReader *pfile, <font class="keywordtype">int</font> is_error, <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00206 <font class="keyword"></font>{
00207   <font class="keywordflow">if</font> (!is_error)
00208     {
00209       <font class="comment">/* fprintf (stderr, "warning: "); */</font>
00210     }
00211   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (is_error == 2)
00212     {
00213       pfile-&gt;errors = cppReader_fatalErrorLimit;
00214     }
00215   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (pfile-&gt;errors &lt; cppReader_fatalErrorLimit)
00216     {
00217       pfile-&gt;errors++;
00218     }
00219   <font class="keywordflow">else</font>
00220     {
00221       ;
00222     }
00223 
00224   fprintf (stderr, <font class="stringliteral">"%s"</font>, cstring_toCharsSafe (msg));
00225   fprintf (stderr, <font class="stringliteral">"\n"</font>);
00226 }
00227 
00228 <font class="comment">/* Same as cppReader_error, except we consider the error to be "fatal",</font>
00229 <font class="comment">   such as inconsistent options.  I.e. there is little point in continuing.</font>
00230 <font class="comment">   (We do not exit, to support use of cpplib as a library.</font>
00231 <font class="comment">   Instead, it is the caller's responsibility to check</font>
00232 <font class="comment">   cppFatalErrors.  */</font>
00233 
00234 <font class="keywordtype">void</font>
<a name="l00235"></a><a class="code" href="cpperror_c.html#a6">00235</a> <a class="code" href="cpperror_c.html#a6">cppReader_fatalError</a> (cppReader *pfile, <font class="comment">/*@only@*/</font> cstring str)<font class="keyword"></font>
00236 <font class="keyword"></font>{
00237   fprintf (stderr, <font class="stringliteral">"preprocessor: "</font>);
00238   cppReader_message (pfile, 2, str);
00239 }
00240 
00241 <font class="keywordtype">void</font>
<a name="l00242"></a><a class="code" href="cpperror_c.html#a7">00242</a> <a class="code" href="cpperror_c.html#a7">cppReader_pfatalWithName</a> (cppReader *pfile, cstring name)<font class="keyword"></font>
00243 <font class="keyword"></font>{
00244   <a class="code" href="cpperror_c.html#a16">cppReader_perrorWithName</a> (pfile, name);
00245   exit (FATAL_EXIT_CODE);
00246 }
00247 
00248 <font class="keywordtype">void</font>
00249 cppReader_printFileAndLine (cppReader *pfile)<font class="keyword"></font>
00250 <font class="keyword"></font>{
00251   cppBuffer *ip = <a class="code" href="cpplib_c.html#a127">cppReader_fileBuffer</a> (pfile);
00252 
00253   <font class="keywordflow">if</font> (ip != NULL)
00254     {
00255       <font class="keywordtype">int</font> line, col;
00256 
00257       <a class="code" href="cpplib_c.html#a126">cppBuffer_lineAndColumn</a> (ip, &amp;line, &amp;col);
00258       cppReader_fileLineForMessage (ip-&gt;nominal_fname,
00259                                     line, pfile-&gt;show_column ? col : -1);
00260     }
00261   <font class="keywordflow">else</font>
00262     {
00263       fprintf (stderr, <font class="stringliteral">"Command Line: "</font>);
00264     }
00265 }
00266 
00267 <font class="keywordtype">void</font>
<a name="l00268"></a><a class="code" href="cpperror_c.html#a8">00268</a> <a class="code" href="cpperror_c.html#a8">cppReader_errorLit</a> (cppReader *pfile, <font class="comment">/*@observer@*/</font> cstring msg)<font class="keyword"></font>
00269 <font class="keyword"></font>{
00270   <a class="code" href="cpperror_c.html#a9">cppReader_error</a> (pfile, cstring_copy (msg));
00271 }
00272 
00273 <font class="keywordtype">void</font>
<a name="l00274"></a><a class="code" href="cpperror_c.html#a9">00274</a> <a class="code" href="cpperror_c.html#a9">cppReader_error</a> (cppReader *pfile, <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00275 <font class="keyword"></font>{
00276   <a class="code" href="llerror_c.html#a19">prepareMessage</a> ();
00277   cppReader_printContainingFiles (pfile);
00278   cppReader_printFileAndLine (pfile);
00279   cppReader_message (pfile, 1, msg);
00280   <a class="code" href="llerror_c.html#a20">closeMessage</a> ();
00281 }
00282 
00283 <font class="comment">/* Print error message but don't count it.  */</font>
00284 
00285 <font class="keywordtype">void</font>
<a name="l00286"></a><a class="code" href="cpperror_c.html#a10">00286</a> <a class="code" href="cpperror_c.html#a10">cppReader_warningLit</a> (cppReader *pfile, cstring msg)<font class="keyword"></font>
00287 <font class="keyword"></font>{
00288   <a class="code" href="cpperror_c.html#a11">cppReader_warning</a> (pfile, cstring_copy (msg));
00289 }
00290 
00291 <font class="keywordtype">void</font>
<a name="l00292"></a><a class="code" href="cpperror_c.html#a11">00292</a> <a class="code" href="cpperror_c.html#a11">cppReader_warning</a> (cppReader *pfile, <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00293 <font class="keyword"></font>{
00294   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;inhibit_warnings)
00295     <font class="keywordflow">return</font>;
00296 
00297   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;warnings_are_errors)
00298     pfile-&gt;errors++;
00299 
00300   <a class="code" href="llerror_c.html#a19">prepareMessage</a> ();
00301   cppReader_printContainingFiles (pfile);
00302   cppReader_printFileAndLine (pfile);
00303   cppReader_message (pfile, 0, msg);
00304   <a class="code" href="llerror_c.html#a20">closeMessage</a> ();
00305 }
00306 
00307 <font class="comment">/* Print an error message and maybe count it.  */</font>
00308 
00309 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00310"></a><a class="code" href="cpperror_c.html#a12">00310</a> <a class="code" href="cpperror_c.html#a12">cppReader_pedwarnLit</a> (cppReader *pfile, <font class="comment">/*@observer@*/</font> cstring msg)<font class="keyword"></font>
00311 <font class="keyword"></font>{
00312   <a class="code" href="cpperror_c.html#a13">cppReader_pedwarn</a> (pfile, cstring_copy (msg));
00313 }
00314 
00315 <font class="keyword">extern</font> <font class="keywordtype">void</font>
<a name="l00316"></a><a class="code" href="cpperror_c.html#a13">00316</a> <a class="code" href="cpperror_c.html#a13">cppReader_pedwarn</a> (cppReader *pfile, <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00317 <font class="keyword"></font>{
00318   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;pedantic_errors)
00319     {
00320       <a class="code" href="cpperror_c.html#a9">cppReader_error</a> (pfile, msg);
00321     }
00322   <font class="keywordflow">else</font>
00323     {
00324       <a class="code" href="cpperror_c.html#a11">cppReader_warning</a> (pfile, msg);
00325     }
00326 }
00327 
00328 <font class="keywordtype">void</font>
<a name="l00329"></a><a class="code" href="cpperror_c.html#a14">00329</a> <a class="code" href="cpperror_c.html#a14">cppReader_errorWithLine</a> (cppReader *pfile, <font class="keywordtype">long</font> line, <font class="keywordtype">long</font> column, 
00330                      <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00331 <font class="keyword"></font>{
00332   cppBuffer *ip = <a class="code" href="cpplib_c.html#a127">cppReader_fileBuffer</a> (pfile);
00333 
00334   <a class="code" href="llerror_c.html#a19">prepareMessage</a> ();
00335   cppReader_printContainingFiles (pfile);
00336 
00337   <font class="keywordflow">if</font> (ip != NULL)
00338     cppReader_fileLineForMessage (ip-&gt;nominal_fname, line, column);
00339 
00340   cppReader_message (pfile, 1, msg);
00341   <a class="code" href="llerror_c.html#a20">closeMessage</a> ();
00342 }
00343 
00344 <font class="keywordtype">void</font>
00345 cppReader_warningWithLine (cppReader *pfile, 
00346                        <font class="keywordtype">int</font> line, <font class="keywordtype">int</font> column, 
00347                        <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00348 <font class="keyword"></font>{
00349   cppBuffer *ip;
00350 
00351   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;inhibit_warnings)
00352     <font class="keywordflow">return</font>;
00353 
00354   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;warnings_are_errors)
00355     pfile-&gt;errors++;
00356 
00357   <a class="code" href="llerror_c.html#a19">prepareMessage</a> ();
00358 
00359   cppReader_printContainingFiles (pfile);
00360 
00361   ip = <a class="code" href="cpplib_c.html#a127">cppReader_fileBuffer</a> (pfile);
00362 
00363   <font class="keywordflow">if</font> (ip != NULL)
00364     {
00365       cppReader_fileLineForMessage (ip-&gt;nominal_fname, line, column);
00366     }
00367 
00368   cppReader_message (pfile, 0, msg);
00369   <a class="code" href="llerror_c.html#a20">closeMessage</a> ();
00370 }
00371 
00372 <font class="keywordtype">void</font>
<a name="l00373"></a><a class="code" href="cpperror_c.html#a15">00373</a> <a class="code" href="cpperror_c.html#a15">cppReader_pedwarnWithLine</a> (cppReader *pfile, <font class="keywordtype">int</font> line, <font class="keywordtype">int</font> column,
00374                        <font class="comment">/*@only@*/</font> cstring msg)<font class="keyword"></font>
00375 <font class="keyword"></font>{
00376   <font class="keywordflow">if</font> (CPPOPTIONS (pfile)-&gt;pedantic_errors)
00377     {
00378       <a class="code" href="cpperror_c.html#a14">cppReader_errorWithLine</a> (pfile, column, line, msg);
00379     }
00380   <font class="keywordflow">else</font>
00381     {
00382       cppReader_warningWithLine (pfile, line, column, msg);
00383     }
00384 }
00385 
<a name="l00386"></a><a class="code" href="cpperror_c.html#a16">00386</a> <font class="keywordtype">void</font> <a class="code" href="cpperror_c.html#a16">cppReader_perrorWithName</a> (cppReader *pfile, cstring name)<font class="keyword"></font>
00387 <font class="keyword"></font>{
00388   cppReader_message (pfile, 1, 
00389                      message (<font class="stringliteral">"preprocessing: %s: %s"</font>,
00390                               name, lldecodeerror (errno)));
00391 }
00392 
00393 
00394 
00395 
00396 
00397 
00398 
00399 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:39 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
