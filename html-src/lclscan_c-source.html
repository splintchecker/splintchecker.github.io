<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lclscan.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:42 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>lclscan.c</h1><a href="lclscan_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** lclscan.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Deliver tokens one at a time</font>
00028 <font class="comment">**</font>
00029 <font class="comment">**      METHOD:</font>
00030 <font class="comment">**      The input arrives via LSLScanFreshToken ().</font>
00031 <font class="comment">**      The output is reported via LSLScanNextToken ().</font>
00032 <font class="comment">**</font>
00033 <font class="comment">**      The tokens are built in module ScanLine.</font>
00034 <font class="comment">**      The tokens are delivered from this module.</font>
00035 <font class="comment">**      Meantimes, they are saved in a static array.</font>
00036 <font class="comment">**</font>
00037 <font class="comment">**      The tokenizing is split off from the delivery of tokens</font>
00038 <font class="comment">**      to facilitate incremental scanning at a later date.</font>
00039 <font class="comment">**      The essential is that scanline () can be called or not</font>
00040 <font class="comment">**      if the input text is dirty or not.  Clean lines cause</font>
00041 <font class="comment">**      tokens to be played out from the saved token list (not</font>
00042 <font class="comment">**      yet implemented in this version).</font>
00043 <font class="comment">*/</font>
00044 
00045 <font class="preprocessor"># include "lclintMacros.nf"</font>
00046 <font class="preprocessor"># include "llbasic.h"</font>
00047 
00048 <font class="comment">/*@-redecl@*/</font> <font class="comment">/* from llgrammar.y */</font>
00049 <font class="keyword">extern</font> <font class="keywordtype">bool</font> g_inTypeDef;
00050 <font class="comment">/*@=redecl@*/</font>
00051 
00052 <font class="comment">/*@ignore@*/</font>
00053 <font class="preprocessor"># include "llgrammar2.h"</font> <font class="comment">/* hack to force real include */</font>
00054 <font class="comment">/*@end@*/</font>
00055 
00056 <font class="preprocessor"># include "lclscan.h"</font>
00057 <font class="preprocessor"># include "scanline.h"</font>
00058 <font class="preprocessor"># include "lclscanline.h"</font>
00059 <font class="preprocessor"># include "lcltokentable.h"</font>
00060 
00061 <font class="keyword">static</font> tsource *scanFile;       <font class="comment">/* file to scan         */</font>
00062 <font class="keyword">static</font> o_ltoken TokenList[MAXLINE];     <font class="comment">/* available tokens     */</font>
00063 <font class="keyword">static</font> <font class="keywordtype">bool</font> restore = FALSE;      <font class="comment">/* wasn't static! */</font>
00064 <font class="keyword">static</font> <a class="code" href="union_YYSTYPE.html">YYSTYPE</a> restoretok;
00065 <font class="keyword">static</font> <font class="keywordtype">int</font> nextToken;           <font class="comment">/* next available token */</font>
00066 <font class="keyword">static</font> <font class="keywordtype">int</font> lastToken;           <font class="comment">/* next available slot  */</font>
00067 
00068 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@null@*/</font> <font class="keywordtype">char</font> *line;  <font class="comment">/* input text */</font>
00069 <font class="keyword">static</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> lineNumber;                <font class="comment">/* current line number */</font>
00070 
<a name="l00071"></a><a class="code" href="lclscan_c.html#a8">00071</a> ltokenCode <a class="code" href="lclscan_c.html#a8">yllex</a> (<font class="keywordtype">void</font>)
00072   <font class="comment">/*@globals killed restoretok@*/</font> 
00073 {
00074   lsymbol tokenSym;
00075 
00076   <font class="keywordflow">if</font> (restore)
00077     {
00078       yllval = restoretok;
00079       restore = FALSE;
00080     }
00081   <font class="keywordflow">else</font>
00082     {
00083       yllval.ltok = <a class="code" href="ltoken_c.html#a39">ltoken_copy</a> (LCLScanNextToken ());
00084     }
00085 
00086   tokenSym = ltoken_getText (yllval.ltok);
00087 
00088   <font class="keywordflow">if</font> (ltoken_getCode (yllval.ltok) == simpleId)
00089     {
00090       <font class="keywordflow">if</font> (g_inTypeDef)
00091         {
00092           ltoken_setCode (yllval.ltok, LLT_TYPEDEF_NAME);
00093           <a class="code" href="lcltokentable_c.html#a4">LCLUpdateToken</a> (LLT_TYPEDEF_NAME, tokenSym, 
00094                           ltoken_isStateDefined (yllval.ltok));
00095         }
00096       <font class="keywordflow">else</font>
00097         {
00098          <font class="comment">/* or if it is already declared as a type, so</font>
00099 <font class="comment">            typedef int foo; typedef foo bar;      works*/</font>
00100           <font class="keywordflow">if</font> (<a class="code" href="symtable_c.html#a48">symtable_exists</a> (g_symtab, tokenSym))
00101             {
00102               <font class="keywordflow">if</font> (typeInfo_exists (symtable_typeInfo (g_symtab, tokenSym)))
00103                 {
00104                   ltoken_setCode (yllval.ltok, LLT_TYPEDEF_NAME);
00105                   <a class="code" href="lcltokentable_c.html#a4">LCLUpdateToken</a> (LLT_TYPEDEF_NAME, tokenSym, 
00106                                   ltoken_isStateDefined (yllval.ltok));
00107                 }
00108             }
00109         }
00110     }
00111 
00112   <font class="keywordflow">return</font> (ltoken_getCode (yllval.ltok));
00113 }
00114 
00115 <font class="comment">/* useful for scanning LCL init files and LSL init files ? */</font>
00116 
00117 <font class="comment">/*@dependent@*/</font> ltoken
<a name="l00118"></a><a class="code" href="lclscan_c.html#a9">00118</a> <a class="code" href="lclscan_c.html#a9">LCLScanNextToken</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00119 <font class="keyword"></font>{
00120   ltoken ret;
00121 
00122   <font class="keywordflow">if</font> (nextToken &lt; lastToken)
00123     {                   
00124       ret = TokenList[nextToken++];
00125     }
00126   <font class="keywordflow">else</font>
00127     {
00128       lastToken = 0;
00129       lineNumber++;
00130       line = <a class="code" href="source_c.html#a4">tsource_nextLine</a> (scanFile);       
00131 
00132       <font class="keywordflow">if</font> (line != (<font class="keywordtype">char</font> *) 0)
00133         {
00134           
00135           <a class="code" href="lclscanline_c.html#a44">LCLScanLine</a> (line);   
00136           nextToken = 0;
00137           ret = <a class="code" href="lclscan_c.html#a9">LCLScanNextToken</a> ();    
00138           <font class="keywordflow">return</font> ret;
00139         }
00140       <font class="keywordflow">else</font>
00141         {
00142           ret = <a class="code" href="lclscanline_c.html#a45">LCLScanEofToken</a> ();
00143         }
00144     }
00145 
00146 
00147     <font class="keywordflow">return</font> ret;
00148 }
00149 
00150 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> ltoken
00151 LCLScanLookAhead (<font class="keywordtype">void</font>)<font class="keyword"></font>
00152 <font class="keyword"></font>{
00153   <font class="keywordflow">if</font> (nextToken &lt; lastToken)
00154     {                   
00155       <font class="keywordflow">return</font> TokenList[nextToken];
00156     }
00157   <font class="keywordflow">else</font>
00158     {
00159       lastToken = 0;    
00160       line = <a class="code" href="source_c.html#a4">tsource_nextLine</a> (scanFile);
00161       <font class="keywordflow">if</font> (line != (<font class="keywordtype">char</font> *) 0)
00162         {
00163           <a class="code" href="lclscanline_c.html#a44">LCLScanLine</a> (line);   
00164           nextToken = 0;        
00165           <font class="keywordflow">return</font> LCLScanLookAhead ();
00166         }
00167       <font class="keywordflow">else</font>
00168         {
00169           <font class="keywordflow">return</font> <a class="code" href="lclscanline_c.html#a45">LCLScanEofToken</a> ();    
00170         }
00171     }
00172 }
00173 
00174 <font class="keywordtype">void</font>
<a name="l00175"></a><a class="code" href="lclscan_c.html#a11">00175</a> <a class="code" href="lclscan_c.html#a11">LCLScanFreshToken</a> (<font class="comment">/*@only@*/</font> ltoken tok)<font class="keyword"></font>
00176 <font class="keyword"></font>{
00177   <font class="keywordflow">if</font> (lastToken &lt; MAXLINE)
00178     {           
00179       TokenList[lastToken++] = tok;
00180     }
00181   <font class="keywordflow">else</font>
00182     {
00183       llbugexitlit (<font class="stringliteral">"LCLScanFreshToken: out of range"</font>);
00184     }
00185 }
00186 
<a name="l00187"></a><a class="code" href="lclscan_c.html#a12">00187</a> tsource *<a class="code" href="lclscan_c.html#a12">LCLScanSource</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00188 <font class="keyword"></font>{
00189   <font class="keywordflow">return</font> scanFile;
00190 }
00191 
00192 
00193 <font class="keywordtype">void</font>
<a name="l00194"></a><a class="code" href="lclscan_c.html#a13">00194</a> <a class="code" href="lclscan_c.html#a13">LCLScanInit</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00195 <font class="keyword"></font>{
00196 }
00197 
00198 <font class="keywordtype">void</font>
<a name="l00199"></a><a class="code" href="lclscan_c.html#a14">00199</a> <a class="code" href="lclscan_c.html#a14">LCLScanReset</a> (tsource * s)<font class="keyword"></font>
00200 <font class="keyword"></font>{
00201   scanFile = s;
00202   lastToken = 0;
00203   nextToken = lastToken + 1;    
00204   lineNumber = 0;
00205 }
00206 
00207 <font class="keywordtype">void</font>
<a name="l00208"></a><a class="code" href="lclscan_c.html#a15">00208</a> <a class="code" href="lclscan_c.html#a15">LCLScanCleanup</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00209 <font class="keyword"></font>{
00210 }
00211 
00212 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:42 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
