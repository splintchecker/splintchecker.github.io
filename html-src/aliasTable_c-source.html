<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>aliasTable.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:38 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>aliasTable.c</h1><a href="aliasTable_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** aliasTable.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 
00031 <font class="comment">/*@constant int ATINVALID; @*/</font>
<a name="l00032"></a><a class="code" href="aliasTable_c.html#a0">00032</a> <font class="preprocessor"># define ATINVALID -1</font>
00033 <font class="preprocessor"></font>
00034 <font class="keyword">static</font> sRefSet
00035   aliasTable_canAliasAux (aliasTable p_s, sRef p_sr, <font class="keywordtype">int</font> p_lim) <font class="comment">/*@*/</font> ;
00036 <font class="keyword">static</font> sRefSet
00037   aliasTable_aliasedByLimit (aliasTable p_s, sRef p_sr, <font class="keywordtype">int</font> p_lim) <font class="comment">/*@*/</font> ;
00038 <font class="keyword">static</font> sRefSet 
00039   aliasTable_aliasedByAux (aliasTable p_s, sRef p_sr, <font class="keywordtype">int</font> p_lim) <font class="comment">/*@*/</font> ;
00040 
00041 aliasTable
<a name="l00042"></a><a class="code" href="aliasTable_c.html#a4">00042</a> <a class="code" href="aliasTable_c.html#a4">aliasTable_new</a> ()<font class="keyword"></font>
00043 <font class="keyword"></font>{
00044   <font class="keywordflow">return</font> (aliasTable_undefined);
00045 }
00046 
00047 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> aliasTable
00048 aliasTable_newEmpty (<font class="keywordtype">void</font>)<font class="keyword"></font>
00049 <font class="keyword"></font>{
00050   aliasTable s = (aliasTable) dmalloc (<font class="keyword">sizeof</font> (*s));
00051   
00052   s-&gt;nelements = 0;
00053   s-&gt;nspace = aliasTableBASESIZE;
00054   s-&gt;keys     = (sRef *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;keys) * aliasTableBASESIZE);
00055   s-&gt;values   = (sRefSet *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;values) * aliasTableBASESIZE);
00056   
00057   <font class="keywordflow">return</font> (s);
00058 }
00059 
00060 <font class="keyword">static</font> <font class="keywordtype">void</font>
00061 aliasTable_grow (<font class="comment">/*@notnull@*/</font> aliasTable s)<font class="keyword"></font>
00062 <font class="keyword"></font>{
00063   <font class="keywordtype">int</font> i;
00064   o_sRefSet *oldvalues = s-&gt;values;
00065   sRef    *oldkeys = s-&gt;keys;
00066   
00067   s-&gt;nspace += aliasTableBASESIZE; 
00068 
00069   s-&gt;values = (sRefSet *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;values)
00070                                    * (s-&gt;nelements + s-&gt;nspace));
00071   s-&gt;keys = (sRef *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;keys) * (s-&gt;nelements + aliasTableBASESIZE));
00072 
00073   <font class="keywordflow">if</font> (s-&gt;keys == (sRef *) 0 || s-&gt;values == (sRefSet *)0)
00074     {
00075       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (cstring_makeLiteral (<font class="stringliteral">"aliasTable_grow: out of memory!"</font>));
00076     }
00077 
00078   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00079     {
00080       s-&gt;values[i] = oldvalues[i];
00081       s-&gt;keys[i] = oldkeys[i];
00082     }
00083   
00084   <a class="code" href="general_c.html#a0">sfree</a> (oldvalues);
00085   <a class="code" href="general_c.html#a0">sfree</a> (oldkeys);
00086 }
00087 
00088 <font class="keyword">static</font> <font class="keywordtype">int</font> aliasTable_lookupRefs (<font class="comment">/*@notnull@*/</font> aliasTable s, sRef sr)<font class="keyword"></font>
00089 <font class="keyword"></font>{
00090   <font class="keywordtype">int</font> i;
00091 
00092   
00093   <font class="keywordflow">for</font> (i = 0; i &lt; aliasTable_size (s); i++)
00094     {
00095       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a112">sRef_same</a> (sr, s-&gt;keys[i])) 
00096         {
00097           <font class="keywordflow">return</font> i;
00098         }
00099     }
00100 
00101   <font class="keywordflow">return</font> ATINVALID;
00102 }
00103 
00104 <font class="comment">/*</font>
00105 <font class="comment">** sr aliases al (and anything al aliases!)</font>
00106 <font class="comment">*/</font>
00107 
00108 aliasTable
<a name="l00109"></a><a class="code" href="aliasTable_c.html#a8">00109</a> <a class="code" href="aliasTable_c.html#a8">aliasTable_addMustAlias</a> (<font class="comment">/*@returned@*/</font> aliasTable s,
00110                          <font class="comment">/*@exposed@*/</font> sRef sr,
00111                          sRef al)<font class="keyword"></font>
00112 <font class="keyword"></font>{
00113   <font class="keywordtype">int</font> ind;
00114   sRefSet ss;
00115   
00116   llassert (NOALIAS (sr, al));
00117 
00118   <font class="keywordflow">if</font> (aliasTable_isUndefined (s))
00119     {
00120       s = aliasTable_newEmpty ();
00121       ind = ATINVALID;
00122     }
00123   <font class="keywordflow">else</font>
00124     {
00125       ind = aliasTable_lookupRefs (s, sr);
00126     }
00127   
00128   ss = <a class="code" href="aliasTable_c.html#a13">aliasTable_canAlias</a> (s, al); 
00129   
00130   
00131   <font class="keywordflow">if</font> (ind == ATINVALID)
00132     {
00133       <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0) {
00134         aliasTable_grow (s);
00135       }
00136 
00137       s-&gt;nspace--;
00138       s-&gt;keys[s-&gt;nelements] = sr;
00139       s-&gt;values[s-&gt;nelements] = <a class="code" href="sRefSet_c.html#a2">sRefSet_single</a> (al); 
00140       ind = s-&gt;nelements;
00141       s-&gt;nelements++;      
00142     }
00143   <font class="keywordflow">else</font>
00144     {
00145       s-&gt;values[ind] = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (s-&gt;values[ind], al); 
00146     }
00147   
00148   s-&gt;values[ind] = <a class="code" href="sRefSet_c.html#a13">sRefSet_unionExcept</a> (s-&gt;values[ind], ss, s-&gt;keys[ind]); 
00149 
00150   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (ss);
00151   <font class="keywordflow">return</font> s;
00152 }
00153 
00154 <font class="keyword">static</font> aliasTable 
00155   aliasTable_addSet (<font class="comment">/*@returned@*/</font> aliasTable s,
00156                      <font class="comment">/*@exposed@*/</font> sRef key, <font class="comment">/*@only@*/</font> sRefSet value)<font class="keyword"></font>
00157 <font class="keyword"></font>{
00158   <font class="keywordflow">if</font> (!sRefSet_isEmpty (value))
00159     {
00160       <font class="keywordflow">if</font> (aliasTable_isUndefined (s))
00161         {
00162           s = aliasTable_newEmpty ();
00163         }
00164       <font class="keywordflow">else</font>
00165         {
00166           <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0)
00167             {
00168               aliasTable_grow (s);
00169             }
00170         }
00171 
00172       s-&gt;nspace--;
00173       s-&gt;keys[s-&gt;nelements] = key;
00174       s-&gt;values[s-&gt;nelements] = value;
00175       s-&gt;nelements++;      
00176     }
00177   <font class="keywordflow">else</font>
00178     {
00179       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (value);
00180     }
00181 
00182   <font class="keywordflow">return</font> s;
00183 }
00184 
00185 <font class="comment">/*</font>
00186 <font class="comment">** When aliases are cleared:</font>
00187 <font class="comment">**</font>
00188 <font class="comment">**    o remove all entries for sr</font>
00189 <font class="comment">**    o replace all aliases for things which alias sr with sr's aliases</font>
00190 <font class="comment">**</font>
00191 <font class="comment">** Clear aliases for sr; if sr is a direct param reference, clear its aliases too.</font>
00192 <font class="comment">*/</font>
00193 
00194 <font class="keyword">static</font> <font class="keywordtype">void</font> aliasTable_clearAliasesAux (<font class="comment">/*@notnull@*/</font> aliasTable p_s, sRef p_sr)
00195    <font class="comment">/*@modifies p_s@*/</font> ;
00196 
<a name="l00197"></a><a class="code" href="aliasTable_c.html#a11">00197</a> <font class="keywordtype">void</font> <a class="code" href="aliasTable_c.html#a11">aliasTable_clearAliases</a> (aliasTable s, sRef sr)<font class="keyword"></font>
00198 <font class="keyword"></font>{
00199   <font class="keywordflow">if</font> (aliasTable_isUndefined (s))
00200     {
00201       <font class="keywordflow">return</font>;
00202     }
00203   <font class="keywordflow">else</font>
00204     {
00205       sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sr);
00206 
00207             
00208       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (sr) &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (rb))
00209         {
00210           <font class="keywordtype">int</font> ind = aliasTable_lookupRefs (s, rb);
00211           
00212           <font class="keywordflow">if</font> (ind != ATINVALID)
00213             {
00214               sRefSet al = s-&gt;values[ind];
00215               
00216                       
00217               sRefSet_realElements (al, el)<font class="keyword"></font>
00218 <font class="keyword">                </font>{
00219                                   
00220                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (el))
00221                     {
00222                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (el, rb))
00223                         {
00224                           sRef fb = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (sr, el); 
00225 
00226                           aliasTable_clearAliasesAux (s, fb); 
00227                         }
00228                     }
00229                 } end_sRefSet_realElements ;
00230             }
00231         }
00232       
00233       aliasTable_clearAliasesAux (s, sr); 
00234     }  
00235 }
00236 
00237 <font class="keyword">static</font>
00238 <font class="keywordtype">void</font> aliasTable_clearAliasesAux (<font class="comment">/*@notnull@*/</font> aliasTable s, sRef sr)<font class="keyword"></font>
00239 <font class="keyword"></font>{
00240   <font class="keywordtype">int</font> i;
00241   
00242   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00243     {
00244       sRef key = s-&gt;keys[i];
00245       
00246       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (key, sr))
00247         {
00248           <a class="code" href="sRefSet_c.html#a5">sRefSet_clear</a> (s-&gt;values[i]);
00249         }
00250       <font class="keywordflow">else</font>
00251         {
00252           (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a10">sRefSet_deleteBase</a> (s-&gt;values[i], sr);   
00253         }
00254     }
00255 }
00256 
00257 <font class="comment">/*</font>
00258 <font class="comment">** returns set of all sRefs that must alias sr (but are different from sr)</font>
00259 <font class="comment">*/</font>
00260 
00261 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet aliasTable_aliasedByAux (aliasTable s, sRef sr, <font class="keywordtype">int</font> lim)<font class="keyword"></font>
00262 <font class="keyword"></font>{
00263   <font class="keyword">static</font> <font class="keywordtype">bool</font> hadWarning = FALSE;
00264   sRefSet res = sRefSet_undefined;
00265   <font class="keywordtype">int</font> i;
00266 
00267   llassert (!sRef_isConj (sr));
00268   
00269   
00270   <font class="keywordflow">if</font> (aliasTable_isUndefined (s) || lim &gt;= ALIASSEARCHLIMIT)
00271     {
00272       <font class="keywordflow">if</font> (lim &gt;= ALIASSEARCHLIMIT &amp;&amp; !hadWarning)
00273         {
00274           llquietbug
00275             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Alias search limit exceeded, checking %q. "</font>
00276                       <font class="stringliteral">"This either means there is a variable with at least "</font>
00277                       <font class="stringliteral">"%d indirections, or there is a bug in LCLint."</font>,
00278                       sRef_unparse (sr),
00279                       ALIASSEARCHLIMIT));
00280           
00281           hadWarning = TRUE;
00282         }
00283 
00284       <font class="keywordflow">return</font> sRefSet_undefined;
00285     }
00286   <font class="keywordflow">else</font>
00287     {
00288       sRefSet abl;
00289 
00290       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (sr))
00291         {
00292           abl = aliasTable_aliasedByLimit (s, sRef_getBase (sr), lim);
00293           res = <a class="code" href="sRefSet_c.html#a41">sRefSet_addIndirection</a> (abl);
00294         }
00295       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (sr))
00296         {
00297           abl = aliasTable_aliasedByLimit (s, sRef_getBase (sr), lim);
00298           res = <a class="code" href="sRefSet_c.html#a40">sRefSet_removeIndirection</a> (abl);
00299         }
00300       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
00301         {
00302           abl = aliasTable_aliasedByLimit (s, sRef_getBase (sr), lim);
00303           res = <a class="code" href="sRefSet_c.html#a42">sRefSet_accessField</a> (abl, sRef_getField (sr));
00304         }
00305       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (sr))
00306         {
00307           abl = aliasTable_aliasedByLimit (s, sRef_getBase (sr), lim);
00308 
00309           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a134">sRef_isIndexKnown</a> (sr))
00310             {
00311               <font class="keywordtype">int</font> idx = <a class="code" href="sRef_c.html#a135">sRef_getIndex</a> (sr);
00312               
00313               res = <a class="code" href="sRefSet_c.html#a44">sRefSet_fetchKnown</a> (abl, idx);
00314             }
00315           <font class="keywordflow">else</font>
00316             {
00317               res = <a class="code" href="sRefSet_c.html#a43">sRefSet_fetchUnknown</a> (abl);
00318             }
00319         }
00320       <font class="keywordflow">else</font>
00321         {
00322           abl = sRefSet_undefined;
00323         }
00324 
00325       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (abl);
00326     }
00327 
00328   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00329     {
00330       sRef elem = s-&gt;keys[i];
00331       
00332       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a112">sRef_same</a> (sr, elem)) <font class="comment">/* was sameName */</font>
00333         {
00334                   
00335           sRefSet_realElements (s-&gt;values[i], current)<font class="keyword"></font>
00336 <font class="keyword">            </font>{
00337                       
00338               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (sr, current))
00339                 {
00340                                                   res = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (res, sRef_fixOuterRef (elem));
00341                   <font class="comment">/*@innerbreak@*/</font> <font class="keywordflow">break</font>;
00342                 }
00343             } end_sRefSet_realElements;
00344         } 
00345     }
00346   
00347     <font class="keywordflow">return</font> res;
00348 }
00349 
00350 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet aliasTable_aliasedByLimit (aliasTable s, sRef sr, <font class="keywordtype">int</font> lim)<font class="keyword"></font>
00351 <font class="keyword"></font>{
00352   sRefSet res;
00353   
00354   
00355   <font class="keywordflow">if</font> (sRef_isConj (sr))
00356     {
00357       res = <a class="code" href="sRefSet_c.html#a11">sRefSet_unionFree</a> (aliasTable_aliasedByLimit (s, sRef_getConjA (sr), lim),
00358                                aliasTable_aliasedByLimit (s, sRef_getConjB (sr), lim));
00359     }
00360   <font class="keywordflow">else</font>
00361     {
00362       res = aliasTable_aliasedByAux (s, sr, lim + 1);
00363     }
00364   
00365     <font class="keywordflow">return</font> res;
00366 }
00367 
<a name="l00368"></a><a class="code" href="aliasTable_c.html#a12">00368</a> <font class="comment">/*@only@*/</font> sRefSet <a class="code" href="aliasTable_c.html#a12">aliasTable_aliasedBy</a> (aliasTable s, sRef sr)<font class="keyword"></font>
00369 <font class="keyword"></font>{ 
00370   <font class="keywordflow">if</font> (sRef_isConj (sr))
00371     {
00372       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a11">sRefSet_unionFree</a> (aliasTable_aliasedBy (s, sRef_getConjA (sr)),
00373                                  <a class="code" href="aliasTable_c.html#a12">aliasTable_aliasedBy</a> (s, sRef_getConjB (sr))));
00374     }
00375 
00376   <font class="keywordflow">return</font> (aliasTable_aliasedByAux (s, sr, 0));
00377 }
00378 
<a name="l00379"></a><a class="code" href="aliasTable_c.html#a13">00379</a> <font class="comment">/*@only@*/</font> sRefSet <a class="code" href="aliasTable_c.html#a13">aliasTable_canAlias</a> (aliasTable s, sRef sr)<font class="keyword"></font>
00380 <font class="keyword"></font>{
00381   sRefSet res;
00382 
00383     
00384   <font class="keywordflow">if</font> (sRef_isConj (sr))
00385     {
00386       res = <a class="code" href="sRefSet_c.html#a11">sRefSet_unionFree</a> (aliasTable_canAlias (s, sRef_getConjA (sr)),
00387                                <a class="code" href="aliasTable_c.html#a13">aliasTable_canAlias</a> (s, sRef_getConjB (sr)));
00388     }
00389   <font class="keywordflow">else</font>
00390     {
00391       res = aliasTable_canAliasAux (s, sr, 0);
00392           }
00393 
00394     <font class="keywordflow">return</font> res;
00395 }
00396 
00397 <font class="comment">/*</font>
00398 <font class="comment">** need to limit the depth of aliasing searches </font>
00399 <font class="comment">*/</font>
00400 
00401 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet aliasTable_canAliasLimit (aliasTable s, sRef sr, <font class="keywordtype">int</font> lim)<font class="keyword"></font>
00402 <font class="keyword"></font>{
00403   sRefSet res;
00404   
00405   <font class="keywordflow">if</font> (sRef_isConj (sr))
00406     {
00407       sRefSet a = aliasTable_canAliasLimit (s, sRef_getConjA (sr), lim);
00408       sRefSet b = aliasTable_canAliasLimit (s, sRef_getConjB (sr), lim);
00409 
00410       res = <a class="code" href="sRefSet_c.html#a11">sRefSet_unionFree</a> (a, b);
00411     }
00412   <font class="keywordflow">else</font>
00413     {
00414       res = aliasTable_canAliasAux (s, sr, lim + 1);
00415     }
00416   
00417   <font class="keywordflow">return</font> res;
00418 }
00419 
00420 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet 
00421   aliasTable_canAliasAux (aliasTable s, sRef sr, <font class="keywordtype">int</font> lim)<font class="keyword"></font>
00422 <font class="keyword"></font>{
00423   <font class="keyword">static</font> <font class="keywordtype">bool</font> hadWarning = FALSE;
00424   llassert (!sRef_isConj (sr));
00425   
00426   
00427   <font class="keywordflow">if</font> (aliasTable_isUndefined (s) || lim &gt;= ALIASSEARCHLIMIT)
00428     {
00429       <font class="keywordflow">if</font> (lim &gt;= ALIASSEARCHLIMIT &amp;&amp; !hadWarning)
00430         {
00431           llquietbug
00432             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Alias search limit exceeded, checking %q. "</font>
00433                       <font class="stringliteral">"This either means there is a variable with at least "</font>
00434                       <font class="stringliteral">"%d indirections, or there is a bug in LCLint."</font>,
00435                       sRef_unparse (sr),
00436                       ALIASSEARCHLIMIT));
00437           
00438           hadWarning = TRUE;
00439         }
00440 
00441       <font class="keywordflow">return</font> sRefSet_undefined;
00442     }
00443   <font class="keywordflow">else</font>
00444     {
00445       <font class="keywordtype">int</font> ind = aliasTable_lookupRefs (s, sr);
00446 
00447       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (sr) || <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (sr) || <a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr)
00448           || <a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (sr))
00449         {
00450           sRef base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (sr);
00451           sRefSet tmp = aliasTable_canAliasLimit (s, base, lim);
00452           sRefSet ret;
00453 
00454           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (sr))
00455             {
00456               ret = <a class="code" href="sRefSet_c.html#a41">sRefSet_addIndirection</a> (tmp); 
00457             }
00458           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (sr))
00459             {
00460               ret = <a class="code" href="sRefSet_c.html#a40">sRefSet_removeIndirection</a> (tmp);
00461             }
00462           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
00463             {
00464               ret = <a class="code" href="sRefSet_c.html#a42">sRefSet_accessField</a> (tmp, sRef_getField (sr));
00465             }
00466           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (sr))
00467             {
00468               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a134">sRef_isIndexKnown</a> (sr))
00469                 {
00470                   ret = <a class="code" href="sRefSet_c.html#a44">sRefSet_fetchKnown</a> (tmp, sRef_getIndex (sr));
00471                 }
00472               <font class="keywordflow">else</font>
00473                 {
00474                   ret = <a class="code" href="sRefSet_c.html#a43">sRefSet_fetchUnknown</a> (tmp);
00475                 }
00476             }
00477           <font class="keywordflow">else</font>
00478             {
00479               BADBRANCH;
00480             }
00481 
00482           <font class="keywordflow">if</font> (ind != ATINVALID)
00483             {
00484               ret = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret, s-&gt;values[ind]);
00485             }
00486 
00487           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (tmp);
00488                   <font class="keywordflow">return</font> ret;
00489         }
00490       
00491       <font class="keywordflow">if</font> (ind == ATINVALID) <font class="keywordflow">return</font> sRefSet_undefined;      
00492       
00493       <font class="keywordflow">return</font> <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (s-&gt;values[ind]);
00494     }
00495 }
00496 
<a name="l00497"></a><a class="code" href="aliasTable_c.html#a15">00497</a> aliasTable <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (aliasTable s)<font class="keyword"></font>
00498 <font class="keyword"></font>{
00499   <font class="keywordflow">if</font> (aliasTable_isEmpty (s))
00500     {
00501       <font class="keywordflow">return</font> aliasTable_undefined;
00502     }
00503   <font class="keywordflow">else</font>
00504     {
00505       aliasTable t = (aliasTable) dmalloc (<font class="keyword">sizeof</font> (*s));
00506       <font class="keywordtype">int</font> i;
00507 
00508       t-&gt;nelements = s-&gt;nelements;
00509       t-&gt;nspace = 0;
00510       t-&gt;keys = (sRef *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;keys) * s-&gt;nelements);
00511       t-&gt;values = (sRefSet *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;values) * t-&gt;nelements);
00512         
00513       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00514         {
00515           t-&gt;keys[i] = s-&gt;keys[i];
00516           t-&gt;values[i] = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (s-&gt;values[i]);
00517         }
00518 
00519       <font class="keywordflow">return</font> t;
00520     }
00521 }
00522 
00523 <font class="keyword">static</font> <font class="keywordtype">void</font>
00524 aliasTable_levelPrune (aliasTable s, <font class="keywordtype">int</font> lexlevel)<font class="keyword"></font>
00525 <font class="keyword"></font>{
00526   
00527   
00528   <font class="keywordflow">if</font> (aliasTable_isEmpty (s))
00529     {
00530       <font class="keywordflow">return</font>;
00531     }
00532   <font class="keywordflow">else</font>
00533     {
00534       <font class="keywordtype">int</font> i;
00535       <font class="keywordtype">int</font> backcount = s-&gt;nelements - 1;
00536       
00537       <font class="keywordflow">for</font> (i = 0; i &lt;= backcount; i++)
00538         {
00539           sRef key = s-&gt;keys[i];
00540           
00541           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (key) &gt; lexlevel)
00542             {
00543               <font class="keywordtype">int</font> j;
00544               <font class="keywordflow">for</font> (j = backcount; j &gt; i; j--)
00545                 {
00546                   backcount--;
00547                   s-&gt;nelements--;
00548                   s-&gt;nspace++;
00549                   
00550                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (s-&gt;keys[j]) &lt;= lexlevel)
00551                     {
00552                       s-&gt;keys[i] = s-&gt;keys[j];
00553                       s-&gt;values[i] = s-&gt;values[j];
00554                       <a class="code" href="sRefSet_c.html#a17">sRefSet_levelPrune</a> (s-&gt;values[i], lexlevel);
00555                       <font class="comment">/*@innerbreak@*/</font> <font class="keywordflow">break</font>;
00556                     }
00557                 }
00558               <font class="keywordflow">if</font> (backcount == i)
00559                 s-&gt;nelements--;
00560             }
00561           <font class="keywordflow">else</font>
00562             {
00563               <a class="code" href="sRefSet_c.html#a17">sRefSet_levelPrune</a> (s-&gt;values[i], lexlevel);
00564             }
00565         }
00566     }
00567 }
00568 
00569 <font class="comment">/*</font>
00570 <font class="comment">** levelUnionSeq</font>
00571 <font class="comment">**</font>
00572 <font class="comment">**    like level union, but know that t2 was executed after t1.  So if</font>
00573 <font class="comment">**    t1 has x -&gt; { a, b } and t2 has x -&gt; { a }, then result has x -&gt; { a }.</font>
00574 <font class="comment">**</font>
00575 <font class="comment">** NOTE: t2 is "only".</font>
00576 <font class="comment">*/</font>
00577 
<a name="l00578"></a><a class="code" href="aliasTable_c.html#a17">00578</a> aliasTable <a class="code" href="aliasTable_c.html#a17">aliasTable_levelUnionSeq</a> (<font class="comment">/*@returned@*/</font> aliasTable t1, 
00579                                      <font class="comment">/*@only@*/</font> aliasTable t2, <font class="keywordtype">int</font> level)<font class="keyword"></font>
00580 <font class="keyword"></font>{
00581   <font class="keywordflow">if</font> (aliasTable_isUndefined (t2))
00582     {
00583       <font class="keywordflow">return</font> t1;
00584     }
00585 
00586   <font class="keywordflow">if</font> (aliasTable_isUndefined (t1))
00587     {
00588       t1 = aliasTable_newEmpty ();
00589     }
00590   <font class="keywordflow">else</font>
00591     {
00592       aliasTable_levelPrune (t1, level);
00593     }
00594 
00595   aliasTable_elements (t2, key, value)<font class="keyword"></font>
00596 <font class="keyword">    </font>{
00597       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (key) &lt;= level)
00598         {
00599           <font class="keywordtype">int</font> ind = aliasTable_lookupRefs (t1, key);
00600 
00601           <a class="code" href="sRefSet_c.html#a17">sRefSet_levelPrune</a> (value, level);
00602               
00603           <font class="keywordflow">if</font> (ind == ATINVALID)
00604             {
00605               <font class="comment">/* okay, t2 is killed */</font>
00606               <font class="comment">/*@-exposetrans@*/</font> <font class="comment">/*@-dependenttrans@*/</font> 
00607               t1 = aliasTable_addSet (t1, key, value);
00608               <font class="comment">/*@=exposetrans@*/</font> <font class="comment">/*@=dependenttrans@*/</font> 
00609             }
00610           <font class="keywordflow">else</font>
00611             {
00612               <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (t1-&gt;values[ind]);
00613 
00614               <font class="comment">/*@-dependenttrans@*/</font> <font class="comment">/* okay, t2 is killed */</font>
00615               t1-&gt;values[ind] = value;
00616               <font class="comment">/*@=dependenttrans@*/</font>
00617             } 
00618         }
00619       <font class="keywordflow">else</font>
00620         {
00621           <font class="comment">/*@-exposetrans@*/</font> <font class="comment">/*@-dependenttrans@*/</font> 
00622           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (value);
00623           <font class="comment">/*@=exposetrans@*/</font> <font class="comment">/*@=dependenttrans@*/</font> 
00624         }
00625 
00626     } end_aliasTable_elements;
00627   
00628   <a class="code" href="general_c.html#a0">sfree</a> (t2-&gt;keys);
00629   <a class="code" href="general_c.html#a0">sfree</a> (t2-&gt;values);
00630   <a class="code" href="general_c.html#a0">sfree</a> (t2);
00631 
00632     <font class="keywordflow">return</font> t1;
00633 }
00634 
00635 aliasTable 
<a name="l00636"></a><a class="code" href="aliasTable_c.html#a18">00636</a> <a class="code" href="aliasTable_c.html#a18">aliasTable_levelUnion</a> (<font class="comment">/*@returned@*/</font> aliasTable t1, aliasTable t2, <font class="keywordtype">int</font> level)<font class="keyword"></font>
00637 <font class="keyword"></font>{
00638   <font class="keywordflow">if</font> (aliasTable_isUndefined (t1))
00639     {
00640       <font class="keywordflow">if</font> (aliasTable_isUndefined (t2)) 
00641         {
00642           <font class="keywordflow">return</font> t1;
00643         }
00644       <font class="keywordflow">else</font>
00645         {
00646           t1 = aliasTable_newEmpty ();
00647         }
00648     }
00649   <font class="keywordflow">else</font>
00650     {
00651       aliasTable_levelPrune (t1, level);
00652     }
00653 
00654   aliasTable_elements (t2, key, cvalue)<font class="keyword"></font>
00655 <font class="keyword">    </font>{
00656       sRefSet value = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (cvalue);
00657 
00658       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (key) &lt;= level)
00659         {
00660           <a class="code" href="sRefSet_c.html#a17">sRefSet_levelPrune</a> (value, level);
00661 
00662           <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (value) &gt; 0)
00663             {
00664               <font class="keywordtype">int</font> ind = aliasTable_lookupRefs (t1, key);
00665               
00666               <font class="keywordflow">if</font> (ind == ATINVALID)
00667                 {
00668                   t1 = aliasTable_addSet (t1, key, value);
00669                 }
00670               <font class="keywordflow">else</font>
00671                 {
00672                   t1-&gt;values[ind] = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (t1-&gt;values[ind], value);
00673                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (value);
00674                 }
00675             }
00676           <font class="keywordflow">else</font>
00677             {
00678               <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (value); 
00679             }
00680         }
00681       <font class="keywordflow">else</font>
00682         {
00683           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (value); 
00684         }
00685     } end_aliasTable_elements;
00686 
00687     <font class="keywordflow">return</font> t1;
00688 }
00689 
<a name="l00690"></a><a class="code" href="aliasTable_c.html#a19">00690</a> aliasTable <a class="code" href="aliasTable_c.html#a19">aliasTable_levelUnionNew</a> (aliasTable t1, aliasTable t2, <font class="keywordtype">int</font> level)<font class="keyword"></font>
00691 <font class="keyword"></font>{
00692   aliasTable ret = <a class="code" href="aliasTable_c.html#a18">aliasTable_levelUnion</a> (aliasTable_copy (t1), t2, level);
00693 
00694   <font class="keywordflow">return</font> ret;
00695 }
00696 
00697 <font class="comment">/*@only@*/</font> cstring
<a name="l00698"></a><a class="code" href="aliasTable_c.html#a20">00698</a> <a class="code" href="aliasTable_c.html#a20">aliasTable_unparse</a> (aliasTable s)<font class="keyword"></font>
00699 <font class="keyword"></font>{
00700    cstring st = cstring_undefined;
00701 
00702    <font class="keywordflow">if</font> (aliasTable_isUndefined (s)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;NULL&gt;"</font>));
00703 
00704    aliasTable_elements (s, key, value)<font class="keyword"></font>
00705 <font class="keyword">     </font>{
00706        st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q\t%q -&gt; %q\n"</font>, st, sRef_unparse (key), 
00707                      <a class="code" href="sRefSet_c.html#a35">sRefSet_unparse</a> (value));
00708      } end_aliasTable_elements;
00709 
00710    <font class="keywordflow">return</font> st;
00711 }
00712 
00713 <font class="comment">/*</font>
00714 <font class="comment">** bogus!</font>
00715 <font class="comment">*/</font>
00716 
00717 <font class="keywordtype">void</font>
<a name="l00718"></a><a class="code" href="aliasTable_c.html#a21">00718</a> <a class="code" href="aliasTable_c.html#a21">aliasTable_fixSrefs</a> (aliasTable s)<font class="keyword"></font>
00719 <font class="keyword"></font>{
00720   <font class="keywordtype">int</font> i;
00721 
00722   <font class="keywordflow">if</font> (aliasTable_isUndefined (s)) <font class="keywordflow">return</font>;
00723 
00724   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00725     {
00726       sRef old = s-&gt;keys[i];
00727 
00728       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (old))
00729         {
00730           s-&gt;keys[i] = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (sRef_getUentry (old));
00731         }
00732 
00733       <a class="code" href="sRefSet_c.html#a38">sRefSet_fixSrefs</a> (s-&gt;values[i]);
00734     }
00735 }
00736 
00737 <font class="keywordtype">void</font>
<a name="l00738"></a><a class="code" href="aliasTable_c.html#a22">00738</a> <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (<font class="comment">/*@only@*/</font> aliasTable s)<font class="keyword"></font>
00739 <font class="keyword"></font>{
00740   <font class="keywordtype">int</font> i;
00741   
00742   <font class="keywordflow">if</font> (aliasTable_isUndefined (s)) <font class="keywordflow">return</font>;
00743   
00744   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00745     {
00746       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (s-&gt;values[i]); 
00747     }
00748   
00749   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;values);
00750   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;keys);
00751   <a class="code" href="general_c.html#a0">sfree</a> (s);
00752 }
00753 
00754 <font class="keywordtype">void</font> 
<a name="l00755"></a><a class="code" href="aliasTable_c.html#a23">00755</a> <a class="code" href="aliasTable_c.html#a23">aliasTable_checkGlobs</a> (aliasTable t)<font class="keyword"></font>
00756 <font class="keyword"></font>{
00757   aliasTable_elements (t, key, value)<font class="keyword"></font>
00758 <font class="keyword">    </font>{
00759       sRef root = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (key);
00760 
00761       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a254">sRef_isAliasCheckedGlobal</a> (root))
00762         {
00763           sRefSet_realElements (value, sr)<font class="keyword"></font>
00764 <font class="keyword">            </font>{
00765               root = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sr);
00766 
00767               <font class="keywordflow">if</font> (((<a class="code" href="sRef_c.html#a254">sRef_isAliasCheckedGlobal</a> (root) 
00768                     &amp;&amp; !(<a class="code" href="sRef_c.html#a109">sRef_similar</a> (root, key)))
00769                    || <a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (root))
00770                   &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (root))
00771                 {
00772                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a254">sRef_isAliasCheckedGlobal</a> (key))
00773                     {
00774                       <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (key) 
00775                             &amp;&amp; <a class="code" href="sRef_c.html#a343">sRef_isShared</a> (root)))
00776                         {
00777                           voptgenerror 
00778                             (FLG_GLOBALIAS,
00779                              message 
00780                              (<font class="stringliteral">"Function returns with %q variable %q aliasing %q %q"</font>,
00781                               cstring_makeLiteral (sRef_isRealGlobal (key) 
00782                                                    ? <font class="stringliteral">"global"</font> : <font class="stringliteral">"file static"</font>),
00783                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (key),
00784                               cstring_makeLiteral (sRef_isAnyParam (root) 
00785                                                    ? <font class="stringliteral">"parameter"</font> : <font class="stringliteral">"global"</font>),
00786                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr)),
00787                              g_currentloc);
00788                         }
00789                     }
00790 
00791                 }
00792             } end_sRefSet_realElements;
00793         }
00794       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (key) || <a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (root))
00795         {
00796           sRefSet_realElements (value, sr)<font class="keyword"></font>
00797 <font class="keyword">            </font>{
00798               root = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sr);
00799               
00800               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a254">sRef_isAliasCheckedGlobal</a> (root) 
00801                   &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (root)
00802                   &amp;&amp; !<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (key)
00803                   &amp;&amp; !<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (root))
00804                 {
00805                   voptgenerror 
00806                     (FLG_GLOBALIAS,
00807                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns with parameter %q aliasing %q %q"</font>,
00808                               sRef_unparse (key),
00809                               cstring_makeLiteral (sRef_isRealGlobal (root) 
00810                                                    ? <font class="stringliteral">"global"</font> : <font class="stringliteral">"file static"</font>),
00811                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr)),
00812                      g_currentloc);
00813                 }
00814             } end_sRefSet_realElements;
00815         }
00816       <font class="keywordflow">else</font>
00817         {
00818           ;
00819         }
00820     } end_aliasTable_elements;
00821 }
00822 
00823 
00824 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:39 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
