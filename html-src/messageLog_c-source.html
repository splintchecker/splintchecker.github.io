<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>messageLog.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:43 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>messageLog.c</h1><a href="messageLog_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** messageLog.c (from slist_template.c)</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 
00031 <font class="comment">/*@only@*/</font> messageLog
<a name="l00032"></a><a class="code" href="messageLog_c.html#a0">00032</a> <a class="code" href="messageLog_c.html#a0">messageLog_new</a> ()<font class="keyword"></font>
00033 <font class="keyword"></font>{
00034   messageLog s = (messageLog) dmalloc (<font class="keyword">sizeof</font> (*s));
00035   
00036   s-&gt;nelements = 0;
00037   s-&gt;nspace = messageLogBASESIZE;
00038   s-&gt;elements = (msgentry *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;elements) * messageLogBASESIZE);
00039 
00040   <font class="keywordflow">return</font> (s);
00041 }
00042 
00043 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> msgentry
00044 msgentry_create (fileloc loc, cstring mess)<font class="keyword"></font>
00045 <font class="keyword"></font>{
00046   msgentry msg = (msgentry) dmalloc (<font class="keyword">sizeof</font> (*msg));
00047 
00048   msg-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (loc);
00049   msg-&gt;msg = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (mess);
00050 
00051   <font class="keywordflow">return</font> msg;
00052 }
00053 
00054 <font class="keyword">static</font> <font class="keywordtype">void</font> msgentry_free (<font class="comment">/*@only@*/</font> msgentry msg)<font class="keyword"></font>
00055 <font class="keyword"></font>{
00056   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (msg-&gt;loc);
00057   <a class="code" href="cstring_c.html#a27">cstring_free</a> (msg-&gt;msg);
00058   <a class="code" href="general_c.html#a0">sfree</a> (msg);
00059 }
00060 
00061 <font class="comment">/*</font>
00062 <font class="comment">** returns TRUE if m1 &lt; m2</font>
00063 <font class="comment">*/</font>
00064 
00065 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00066 msgentry_lessthan (msgentry m1, msgentry m2)<font class="keyword"></font>
00067 <font class="keyword"></font>{
00068   <font class="keywordflow">return</font> (<a class="code" href="fileloc_c.html#a14">fileloc_lessthan</a> (m1-&gt;loc, m2-&gt;loc)
00069           || (<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (m1-&gt;loc, m2-&gt;loc) 
00070               &amp;&amp; (cstring_lessthan (m1-&gt;msg, m2-&gt;msg))));
00071 }
00072 
00073 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00074 msgentry_equal (msgentry m1, msgentry m2)<font class="keyword"></font>
00075 <font class="keyword"></font>{
00076   <font class="keywordflow">return</font> (<a class="code" href="fileloc_c.html#a11">fileloc_equal</a> (m1-&gt;loc, m2-&gt;loc) &amp;&amp;
00077           <a class="code" href="cstring_c.html#a18">cstring_equal</a> (m1-&gt;msg, m2-&gt;msg));
00078 }
00079 
00080 <font class="comment">/*</font>
00081 <font class="comment">** returns highest index of element less than msg</font>
00082 <font class="comment">*/</font>
00083 
00084 <font class="keyword">static</font> <font class="keywordtype">int</font>
00085 messageLog_index (messageLog s, msgentry msg)<font class="keyword"></font>
00086 <font class="keyword"></font>{
00087   <font class="keywordtype">int</font> high;
00088   <font class="keywordtype">int</font> low  = 0;
00089 
00090   llassert (messageLog_isDefined (s));
00091 
00092   high = s-&gt;nelements - 1;
00093 
00094   <font class="keywordflow">for</font> (low = high; low &gt;= 0; low--)
00095     {
00096       <font class="keywordflow">if</font> (msgentry_lessthan (s-&gt;elements[low], msg))
00097         {
00098           <font class="keywordflow">return</font> low;
00099         }
00100     }
00101 
00102   <font class="keywordflow">return</font> -1;
00103 <font class="preprocessor"># if 0      </font>
00104 <font class="preprocessor"></font>  <font class="keywordflow">while</font> (low &lt; high)
00105     {
00106       <font class="keywordtype">int</font> mid = (low + high + 1) / 2;
00107 
00108       <font class="keywordflow">if</font> (msgentry_lessthan (s-&gt;elements[mid], msg)) <font class="comment">/* mid &lt; msg */</font>
00109         {
00110           <font class="keywordflow">if</font> (high == mid) <font class="keywordflow">break</font>;
00111           high = mid;
00112         }
00113       <font class="keywordflow">else</font>
00114         {
00115           <font class="keywordflow">if</font> (low == mid) <font class="keywordflow">break</font>;
00116           low = mid;
00117         }
00118     }
00119 
00120   <font class="keywordflow">return</font> low - 1;
00121 <font class="preprocessor"># endif</font>
00122 <font class="preprocessor"></font>}
00123 
00124 <font class="keyword">static</font> <font class="keywordtype">void</font>
00125 messageLog_grow (<font class="comment">/*@notnull@*/</font> messageLog s)<font class="keyword"></font>
00126 <font class="keyword"></font>{
00127   <font class="keywordtype">int</font> i;
00128   msgentry *newelements;
00129   
00130   s-&gt;nspace += messageLogBASESIZE; 
00131   newelements = (msgentry *) dmalloc (<font class="keyword">sizeof</font> (*newelements) * (s-&gt;nelements + s-&gt;nspace));
00132   
00133   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00134     {
00135       newelements[i] = s-&gt;elements[i];
00136     }
00137   
00138   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements);
00139   s-&gt;elements = newelements;
00140 }
00141 
<a name="l00142"></a><a class="code" href="messageLog_c.html#a7">00142</a> <font class="keywordtype">bool</font> <a class="code" href="messageLog_c.html#a7">messageLog_add</a> (messageLog s, fileloc fl, cstring mess)<font class="keyword"></font>
00143 <font class="keyword"></font>{
00144   msgentry msg = msgentry_create (fl, mess);
00145   <font class="keywordtype">int</font> ind, i;
00146 
00147   llassert (messageLog_isDefined (s));
00148 
00149   ind = messageLog_index (s, msg);
00150 
00151   <font class="keywordflow">if</font> (ind + 1 &lt; s-&gt;nelements)
00152     {
00153       <font class="keywordflow">if</font> (msgentry_equal (msg, s-&gt;elements[ind + 1]))
00154         {
00155           msgentry_free (msg);
00156           <font class="keywordflow">return</font> FALSE;
00157         }
00158     }
00159 
00160   <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0) {
00161     messageLog_grow (s);
00162   }
00163 
00164   <font class="keywordflow">for</font> (i = s-&gt;nelements; i &gt; ind + 1; i--)
00165     {
00166       s-&gt;elements[i] = s-&gt;elements[i-1];
00167     }
00168   
00169   s-&gt;elements[ind + 1] = msg;
00170   s-&gt;nspace--;
00171   s-&gt;nelements++;
00172 
00173   <font class="keywordflow">return</font> TRUE;
00174 }
00175 
00176 <font class="comment">/*@only@*/</font> cstring
<a name="l00177"></a><a class="code" href="messageLog_c.html#a8">00177</a> <a class="code" href="messageLog_c.html#a8">messageLog_unparse</a> (messageLog s)<font class="keyword"></font>
00178 <font class="keyword"></font>{
00179    <font class="keywordtype">int</font> i;
00180    cstring st = cstring_makeLiteral (<font class="stringliteral">"["</font>);
00181 
00182    <font class="keywordflow">if</font> (messageLog_isDefined (s))
00183      {
00184        <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00185          {
00186            <font class="keywordflow">if</font> (i == 0)
00187              {
00188                st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q"</font>, st, fileloc_unparseDirect (s-&gt;elements[i]-&gt;loc));
00189              }
00190            <font class="keywordflow">else</font>
00191              st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q, %q"</font>, st, fileloc_unparseDirect (s-&gt;elements[i]-&gt;loc));
00192          }
00193      }
00194 
00195    st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q ]"</font>, st);
00196    <font class="keywordflow">return</font> st;
00197 }
00198 
00199 <font class="keywordtype">void</font>
<a name="l00200"></a><a class="code" href="messageLog_c.html#a9">00200</a> <a class="code" href="messageLog_c.html#a9">messageLog_free</a> (messageLog s)<font class="keyword"></font>
00201 <font class="keyword"></font>{
00202   <font class="keywordflow">if</font> (s != NULL)
00203     {
00204       <font class="keywordtype">int</font> i;
00205 
00206       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00207         {
00208           msgentry_free (s-&gt;elements[i]);
00209         }
00210       
00211       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements); 
00212       <a class="code" href="general_c.html#a0">sfree</a> (s);
00213     }
00214 }
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:43 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
