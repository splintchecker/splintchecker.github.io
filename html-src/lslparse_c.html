<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>lslparse.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:58:03 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>lslparse.c File Reference</h1><code>#include "lclintMacros.nf"</code><br>
<code>#include "llbasic.h"</code><br>
<code>#include "lclscan.h"</code><br>
<code>#include "signature.h"</code><br>
<code>#include "signature2.h"</code><br>
<code>#include "scan.h"</code><br>
<code>#include "scanline.h"</code><br>
<code>#include "syntable.h"</code><br>
<code>#include "tokentable.h"</code><br>
<code>#include "lslinit.h"</code><br>
<code>#include "lslparse.h"</code><br>
<code>#include "llmain.h"</code><br>

<p>
<a href="lslparse_c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a3">parseSignatures</a> (cstring infile)</td></tr>
<tr><td nowrap align=right valign=top>lslOp&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a4">parseOpLine</a> (char *fname, char *line)</td></tr>
<tr><td nowrap align=right valign=top>lsymbol&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a5">processTraitSortId</a> (lsymbol sortid)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a12">callLSL</a> ( char *specfile, char *text)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a13">readlsignatures</a> (interfaceNode n)</td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top>lslOp&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a0">g_importedlslOp</a> = NULL</td></tr>
<tr><td nowrap align=right valign=top>bool&nbsp;</td><td valign=bottom><a class="el" href="lslparse_c.html#a1">g_lslParsingTraits</a> = FALSE</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a12" doxytag="lslparse.c::callLSL"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void callLSL (
          </b></td>
          <td valign="bottom"><b>
char * <em>specfile</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
char * <em>text</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00372">372</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.
<p>
Referenced by <a class="el" href="imports_c-source.html#l00099">importCTrait</a>(), and <a class="el" href="lslparse_c-source.html#l00505">readlsignatures</a>().<div class="fragment"><pre>00373 {
00374   <font class="comment">/* specfile is the name of the LCL file that contains "uses"</font>
00375 <font class="comment">     Create an intermediate file named</font>
00376 <font class="comment">     specfile_&lt;TEMP_LSL_SUFFIX&gt;.&lt;TEMP_LSL_IN_SUFFIX&gt;.</font>
00377 <font class="comment">     put text in the file, run lsl on it and direct</font>
00378 <font class="comment">     output to specfile_&lt;TEMP_LSL_SUFFIX&gt;.&lt;TEMP_LSL_OUT_SUFFIX&gt;.</font>
00379 <font class="comment">     specfile can be a full pathname.</font>
00380 <font class="comment">     Note: LSL does not support traitnames that are pathnames, only</font>
00381 <font class="comment">     symbols. </font>
00382 <font class="comment">     */</font>
00383 
00384   <font class="keywordtype">char</font> *infile, *outfile;
00385   <font class="keywordtype">char</font> *tmp1, *tmp2;
00386   FILE *inptr;
00387 
00388   infile = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (fileName (fileTable_addltemp (context_fileTable ())));
00389   
00390   inptr = fopen (infile, <font class="stringliteral">"w"</font>);
00391   
00392   <font class="keywordflow">if</font> (inptr == NULL)
00393     {
00394       <font class="comment">/* fopen fails */</font>
00395       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"Unable to write intermediate file: %s"</font>, 
00396                              cstring_fromChars (infile)));
00397     }
00398   
00399   tmp1 = <a class="code" href="general_c.html#a11">removePath</a> (infile);
00400   tmp2 = <a class="code" href="general_c.html#a14">removeAnyExtension</a> (tmp1);
00401 
00402   fprintf (inptr, <font class="stringliteral">"%s : trait\n"</font>, tmp2);
00403   <a class="code" href="general_c.html#a0">sfree</a> (tmp1);
00404   <a class="code" href="general_c.html#a0">sfree</a> (tmp2);
00405 
00406   fprintf (inptr, <font class="stringliteral">"%s"</font>, text);
00407   check (fclose (inptr) == 0);
00408 
00409   <font class="comment">/* the default is to delete the input file */</font>
00410 
00411   outfile = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (fileName (fileTable_addltemp (context_fileTable ())));
00412   invokeLSL (infile, outfile, context_getFlag (FLG_KEEP));
00413   <a class="code" href="general_c.html#a0">sfree</a> (text);
00414 }
</div></pre>    </td>
  </tr>
</table>
<a name="a4" doxytag="lslparse.c::parseOpLine"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
lslOp parseOpLine (
          </b></td>
          <td valign="bottom"><b>
char * <em>fname</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
char * <em>line</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00113">113</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.
<p>
Referenced by <a class="el" href="symtable_c-source.html#l00958">o_fctInfo</a>().<div class="fragment"><pre>00114 {
00115   tsource *sourceFile;
00116   <font class="keywordtype">bool</font> status;
00117 
00118   sourceFile = <a class="code" href="source_c.html#a3">tsource_fromString</a> (fname, line);
00119   
00120   <font class="keywordflow">if</font> (check (tsource_open (sourceFile)))
00121     {
00122       <a class="code" href="scan_c.html#a7">LSLScanReset</a> (sourceFile);
00123       <a class="code" href="scanline_c.html#a6">LSLReportEolTokens</a> (FALSE); <font class="comment">/* 0 by default, lslParsingTraits = 0; */</font>
00124       
00125       <font class="comment">/*</font>
00126 <font class="comment">      ** lsl parsing and importing .lcs files are expected to be mutually</font>
00127 <font class="comment">      ** exclusive. </font>
00128 <font class="comment">      **</font>
00129 <font class="comment">      ** lslparse sets importedlslOp</font>
00130 <font class="comment">      */</font>
00131       
00132       status = (lslparse () != 0);
00133       
00134       <font class="keywordflow">if</font> (status)
00135         {
00136           <a class="code" href="llerror_c.html#a57">lclplainfatalerror</a> (message (<font class="stringliteral">"Error in parsing line: %s"</font>, 
00137                                        cstring_fromChars (line)));
00138         }
00139       
00140       (<font class="keywordtype">void</font>) <a class="code" href="source_c.html#a0">tsource_close</a> (sourceFile);
00141     }
00142 
00143   <a class="code" href="source_c.html#a1">tsource_free</a> (sourceFile);
00144   
00145   llassert (g_importedlslOp != NULL);
00146   <font class="keywordflow">return</font> (<a class="code" href="abstract_c.html#a238">lslOp_copy</a> (g_importedlslOp));
00147 }
</div></pre>    </td>
  </tr>
</table>
<a name="a3" doxytag="lslparse.c::parseSignatures"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int parseSignatures (
          </b></td>
          <td valign="bottom"><b>
cstring <em>infile</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00055">55</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.
<p>
Referenced by <a class="el" href="imports_c-source.html#l00099">importCTrait</a>().<div class="fragment"><pre>00056 {
00057   <font class="keywordtype">char</font> *cinfile = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (infile);
00058   tsource *sourceFile;
00059   ltoken *id = (ltoken *) dmalloc (<font class="keyword">sizeof</font> (*id));
00060   <font class="keywordtype">int</font> status = 0;
00061 
00062   <font class="comment">/* parse traits */</font>
00063   *id = <a class="code" href="tokentable_c.html#a1">LSLInsertToken</a> (LST_SIMPLEID, lsymbol_fromChars (cinfile), 0, FALSE);
00064   ltoken_setFileName (*id, cinfile);
00065   ltoken_setLine (*id, 0);
00066   ltoken_setCol (*id, 0);
00067 
00068   sourceFile = <a class="code" href="source_c.html#a2">tsource_create</a> (cinfile, <font class="stringliteral">""</font>, FALSE);
00069 
00070   <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a6">tsource_getPath</a> (cstring_toCharsSafe (context_getLarchPath ()), sourceFile))
00071     {
00072       lclplainerror 
00073         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"LSL signature parsing: can't find file %s containing trait"</font>,
00074                   cstring_fromChars (tsource_fileName (sourceFile))));
00075       status = 1;
00076 
00077       <a class="code" href="general_c.html#a0">sfree</a> (id);
00078       <a class="code" href="source_c.html#a1">tsource_free</a> (sourceFile);
00079       <font class="keywordflow">return</font> status;
00080     }
00081 
00082   <font class="keywordflow">if</font> (!<a class="code" href="source_c.html#a5">tsource_open</a> (sourceFile))
00083     {
00084       lclplainerror 
00085         (cstring_makeLiteral (<font class="stringliteral">"LSL parsing: can't open file containing trait"</font>));
00086       status = 2;
00087       <a class="code" href="general_c.html#a0">sfree</a> (id);
00088       <a class="code" href="source_c.html#a1">tsource_free</a> (sourceFile);
00089 
00090       <font class="keywordflow">return</font> status;
00091     }
00092 
00093   lsldebug = 0;
00094   g_lslParsingTraits = TRUE;
00095   <a class="code" href="scan_c.html#a7">LSLScanReset</a> (sourceFile);
00096   <a class="code" href="scanline_c.html#a6">LSLReportEolTokens</a> (FALSE);
00097 
00098   status = lslparse ();
00099 
00100   <font class="comment">/* symtable_dump (symtab, stdout, TRUE); */</font>
00101   g_lslParsingTraits = FALSE;
00102 
00103   (<font class="keywordtype">void</font>) <a class="code" href="source_c.html#a0">tsource_close</a> (sourceFile);
00104   <a class="code" href="source_c.html#a1">tsource_free</a> (sourceFile);
00105 
00106   <a class="code" href="general_c.html#a0">sfree</a> (id);
00107 
00108   
00109   <font class="keywordflow">return</font> status;
00110 }
</div></pre>    </td>
  </tr>
</table>
<a name="a5" doxytag="lslparse.c::processTraitSortId"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
lsymbol processTraitSortId (
          </b></td>
          <td valign="bottom"><b>
lsymbol <em>sortid</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00150">150</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.<div class="fragment"><pre>00151 {
00152   lsymbol out = <a class="code" href="symtable_c.html#a46">lsymbol_sortFromType</a> (g_symtab, sortid);
00153   <font class="keywordflow">if</font> (out == sortid)
00154     { <font class="comment">/* may be a new sort */</font>
00155       (<font class="keywordtype">void</font>) <a class="code" href="sort_c.html#a116">sort_fromLsymbol</a> (sortid);
00156     }
00157   <font class="keywordflow">return</font> out;
00158 }
</div></pre>    </td>
  </tr>
</table>
<a name="a13" doxytag="lslparse.c::readlsignatures"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void readlsignatures (
          </b></td>
          <td valign="bottom"><b>
interfaceNode <em>n</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00505">505</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.<div class="fragment"><pre>00506 {
00507   <font class="comment">/* assume n-&gt;kind = usesKIND */</font>
00508   <font class="keywordtype">char</font> *content;
00509   
00510   content = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (printTraitRefList2 (n-&gt;content.uses));
00511   <a class="code" href="lslparse_c.html#a12">callLSL</a> (cstring_toCharsSafe (g_currentSpec), content);
00512 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a0" doxytag="lslparse.c::g_importedlslOp"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
lslOp g_importedlslOp = NULL
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00049">49</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.    </td>
  </tr>
</table>
<a name="a1" doxytag="lslparse.c::g_lslParsingTraits"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
bool g_lslParsingTraits = FALSE
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="lslparse_c-source.html#l00050">50</a> of file <a class="el" href="lslparse_c-source.html">lslparse.c</a>.    </td>
  </tr>
</table>
<hr><address><small>Generated at Fri Nov 3 18:58:03 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
