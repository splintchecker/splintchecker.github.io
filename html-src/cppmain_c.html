<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cppmain.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:54 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>cppmain.c File Reference</h1><code>#include "lclintMacros.nf"</code><br>
<code>#include "llbasic.h"</code><br>
<code>#include "cpp.h"</code><br>
<code>#include "cpplib.h"</code><br>
<code>#include "cpphash.h"</code><br>
<code>#include "cpperror.h"</code><br>
<code>#include "llmain.h"</code><br>
<code>#include &lt;stdio.h&gt;</code><br>

<p>
<a href="cppmain_c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a1">cppReader_initMod</a> ()</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a2">cppReader_initialize</a> ()</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a3">cppProcess</a> ( cstring infile, cstring outfile)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a4">cppAddIncludeDir</a> (cstring dir)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a5">cppDoDefine</a> (cstring str)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a6">cppDoUndefine</a> (cstring str)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a7">cppReader_saveDefinitions</a> ()</td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td nowrap align=right valign=top>cppReader&nbsp;</td><td valign=bottom><a class="el" href="cppmain_c.html#a0">g_cppState</a></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a4" doxytag="cppmain.c::cppAddIncludeDir"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppAddIncludeDir (
          </b></td>
          <td valign="bottom"><b>
cstring <em>dir</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00170">170</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>().<div class="fragment"><pre>00171 {
00172   <font class="comment">/* -I option (Add directory to include path) */</font>
00173   <font class="keyword">struct </font>file_name_list *dirtmp = (struct file_name_list *) dmalloc (sizeof (*dirtmp));
00174 
00175   DPRINTF ((<font class="stringliteral">"Add include: %s"</font>, dir));
00176 
00177   dirtmp-&gt;next = 0;             <font class="comment">/* New one goes on the end */</font>
00178   dirtmp-&gt;control_macro = 0;
00179   dirtmp-&gt;c_system_include_path = FALSE;
00180   
00181   <font class="comment">/* This copy is necessary...but shouldn't be? */</font>
00182   <font class="comment">/*@-onlytrans@*/</font>
00183   dirtmp-&gt;fname = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (dir);
00184   <font class="comment">/*@=onlytrans@*/</font>
00185   
00186   dirtmp-&gt;got_name_map = FALSE;
00187   <a class="code" href="cpplib_c.html#a111">cppReader_addIncludeChain</a> (&amp;g_cppState, dirtmp);
00188 }
</div></pre>    </td>
  </tr>
</table>
<a name="a5" doxytag="cppmain.c::cppDoDefine"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppDoDefine (
          </b></td>
          <td valign="bottom"><b>
cstring <em>str</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00190">190</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.<div class="fragment"><pre>00191 {
00192   cppBuffer *tbuf = g_cppState.buffer;
00193 
00194   g_cppState.buffer = NULL;
00195   <a class="code" href="cpplib_c.html#a109">cppReader_define</a> (&amp;g_cppState, cstring_toCharsSafe (str));
00196   g_cppState.buffer = tbuf;
00197 }
</div></pre>    </td>
  </tr>
</table>
<a name="a6" doxytag="cppmain.c::cppDoUndefine"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppDoUndefine (
          </b></td>
          <td valign="bottom"><b>
cstring <em>str</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00199">199</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.<div class="fragment"><pre>00200 {
00201   <font class="keywordtype">int</font> sym_length;
00202   HASHNODE *hp;
00203   <font class="keywordtype">char</font> *buf = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (str);
00204 
00205   sym_length = <a class="code" href="cpplib_c.html#a120">cppReader_checkMacroName</a> (&amp;g_cppState, buf,
00206                                  cstring_makeLiteralTemp (<font class="stringliteral">"macro"</font>));
00207   
00208   <font class="keywordflow">while</font> ((hp = <a class="code" href="cpphash_c.html#a10">cppReader_lookup</a> (buf, sym_length, -1)) != NULL)
00209     {
00210       <font class="comment">/*@-exposetrans@*/</font> <font class="comment">/*@-dependenttrans@*/</font>
00211       <a class="code" href="cpphash_c.html#a12">cppReader_deleteMacro</a> (hp);
00212       <font class="comment">/*@=exposetrans@*/</font> <font class="comment">/*@=dependenttrans@*/</font>
00213     }
00214 }
</div></pre>    </td>
  </tr>
</table>
<a name="a3" doxytag="cppmain.c::cppProcess"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int cppProcess (
          </b></td>
          <td valign="bottom"><b>
cstring <em>infile</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
cstring <em>outfile</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00097">97</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.<div class="fragment"><pre>00099 {
00100   FILE *ofile;
00101   <font class="keyword">struct </font>cppOptions *opts = CPPOPTIONS (&amp;g_cppState);
00102   
00103   opts-&gt;out_fname = outfile;
00104   opts-&gt;in_fname = infile;
00105   opts-&gt;out_fname = outfile;
00106   
00107   <font class="keywordflow">if</font> (cppFatalErrors (&amp;g_cppState))
00108     {
00109       <a class="code" href="llmain_c.html#a26">llexit</a> (LLFAILURE);
00110     }
00111   
00112   g_cppState.show_column = TRUE;
00113 
00114   <font class="keywordflow">if</font> (<a class="code" href="cpplib_c.html#a146">cppReader_startProcess</a> (&amp;g_cppState, opts-&gt;in_fname) == 0) 
00115     {
00116       <a class="code" href="llmain_c.html#a26">llexit</a> (LLFAILURE);
00117     }
00118 
00119   ofile = fopen (cstring_toCharsSafe (outfile), <font class="stringliteral">"w"</font>);
00120   
00121   <font class="keywordflow">if</font> (ofile == NULL) 
00122     {
00123       <a class="code" href="fileTable_c.html#a12">fileTable_noDelete</a> (context_fileTable (), outfile);
00124       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"Cannot create temporary file for "</font>
00125                              <font class="stringliteral">"pre-processor output.  Trying to "</font>
00126                              <font class="stringliteral">"open: %s.  Use -tmpdir to change "</font>
00127                              <font class="stringliteral">"the directory for temporary files."</font>,
00128                              outfile));
00129     }
00130   
00131   <font class="keywordflow">for</font> (;;)
00132     {
00133       <font class="keyword">enum</font> cpp_token kind;
00134       
00135       llassert (g_cppState.token_buffer != NULL);
00136 
00137       <font class="keywordflow">if</font> (!opts-&gt;no_output)
00138         {
00139           (<font class="keywordtype">void</font>) fwrite (g_cppState.token_buffer, (size_t) 1,
00140                          cppReader_getWritten (&amp;g_cppState), ofile);
00141         }
00142       
00143       cppReader_setWritten (&amp;g_cppState, 0);
00144       kind = <a class="code" href="cpplib_c.html#a141">cppGetToken</a> (&amp;g_cppState);
00145       
00146       <font class="keywordflow">if</font> (kind == CPP_EOF)
00147         <font class="keywordflow">break</font>;
00148     }
00149 
00150   <a class="code" href="cpplib_c.html#a143">cppReader_finish</a> (&amp;g_cppState);
00151   check (fclose (ofile) == 0);
00152 
00153   <font class="comment">/* Resotre the original definition table. */</font>
00154 
00155   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SINGLEINCLUDE))
00156     {
00157       <a class="code" href="cpphash_c.html#a8">cppReader_restoreHashtab</a> ();  
00158     }
00159 
00160   
00161   <font class="comment">/* Undefine everything from this file! */</font>
00162 
00163   <font class="keywordflow">if</font> (g_cppState.errors != 0) {
00164     <font class="keywordflow">return</font> -1;
00165   }
00166 
00167   <font class="keywordflow">return</font> 0;
00168 }
</div></pre>    </td>
  </tr>
</table>
<a name="a1" doxytag="cppmain.c::cppReader_initMod"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppReader_initMod (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00080">80</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>().<div class="fragment"><pre>00081 {
00082   <font class="keyword">struct </font>cppOptions *opts = (struct cppOptions *) dmalloc (sizeof (*opts));
00083 
00084   <a class="code" href="cpplib_c.html#a142">cppReader_init</a> (&amp;g_cppState);
00085   llassert (g_cppState.opts == NULL);
00086   g_cppState.opts = opts;
00087 
00088   <a class="code" href="cpplib_c.html#a112">cppOptions_init</a> (opts);
00089   <font class="comment">/*@-compdef@*/</font> <font class="comment">/* g_cppState is not yet innitialized */</font>
00090 }
</div></pre>    </td>
  </tr>
</table>
<a name="a2" doxytag="cppmain.c::cppReader_initialize"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppReader_initialize (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00092">92</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>().<div class="fragment"><pre>00093 {
00094   <a class="code" href="cpplib_c.html#a145">cppReader_initializeReader</a> (&amp;g_cppState);
00095 }
</div></pre>    </td>
  </tr>
</table>
<a name="a7" doxytag="cppmain.c::cppReader_saveDefinitions"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void cppReader_saveDefinitions (
          </b></td>
          <td valign="bottom"><b>
)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00216">216</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.
<p>
Referenced by <a class="el" href="llmain_c-source.html#l00536">main</a>().<div class="fragment"><pre>00217 {
00218   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SINGLEINCLUDE))
00219     {
00220       <a class="code" href="cpphash_c.html#a7">cppReader_saveHashtab</a> ();
00221     }
00222 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a name="a0" doxytag="cppmain.c::g_cppState"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
cppReader g_cppState
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="cppmain_c-source.html#l00067">67</a> of file <a class="el" href="cppmain_c-source.html">cppmain.c</a>.    </td>
  </tr>
</table>
<hr><address><small>Generated at Fri Nov 3 18:57:54 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
