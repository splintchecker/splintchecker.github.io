<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>usymtab.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:46 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>usymtab.c</h1><a href="usymtab_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** usymtab</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Lexically scoped symbol table.</font>
00028 <font class="comment">**</font>
00029 <font class="comment">** Unlike a normal symbol table, this table splits to reflect branches.</font>
00030 <font class="comment">**</font>
00031 <font class="comment">** This is necessary since symbol table entries also reflect</font>
00032 <font class="comment">** some state information, like initialization, that may be</font>
00033 <font class="comment">** different on different branches.</font>
00034 <font class="comment">**</font>
00035 <font class="comment">** For each control structure we split:</font>
00036 <font class="comment">**</font>
00037 <font class="comment">** { }                - a normal scope (no control) US_NORMAL</font>
00038 <font class="comment">**</font>
00039 <font class="comment">** if &lt;pred&gt; { }      - US_TBRANCH true branch</font>
00040 <font class="comment">** while &lt;pred&gt; { }     US_FBRANCH else branch</font>
00041 <font class="comment">**</font>
00042 <font class="comment">** switch &lt;pred&gt; { }  - US_SWITCH</font>
00043 <font class="comment">**</font>
00044 <font class="comment">** case x:            - case scope US_CBRANCH</font>
00045 <font class="comment">**                      Should be kept in a separate table, because of</font>
00046 <font class="comment">**                      weird C syntax.</font>
00047 <font class="comment">*/</font>
00048 
00049 <font class="preprocessor"># include "lclintMacros.nf"</font>
00050 <font class="preprocessor"># include "basic.h"</font>
00051 <font class="preprocessor"># include "structNames.h"</font>
00052 <font class="preprocessor"># include "exprChecks.h"</font>
00053 <font class="preprocessor"># include "aliasChecks.h"</font>
00054 
00055 <font class="comment">/*</font>
00056 <font class="comment">** Keep track of type definitions inside a function.</font>
00057 <font class="comment">*/</font>
00058 
00059 <font class="keyword">static</font> uentryList functypes = uentryList_undefined;
00060 
00061 <font class="keyword">static</font> <font class="keywordtype">bool</font> dbgfree = FALSE;
00062 <font class="keyword">static</font> <font class="keywordtype">bool</font> dbgload = TRUE;
00063 
00064 <font class="comment">/*@access ekind usymId@*/</font>
00065 
00066 <font class="comment">/*</font>
00067 <font class="comment">** Hack to prevent shadow errors from appearing when function parameters</font>
00068 <font class="comment">** are entered into a new scope.</font>
00069 <font class="comment">*/</font>
00070 
00071 <font class="keyword">static</font> <font class="keywordtype">bool</font> noshadowerror = FALSE;
00072 
00073 <font class="comment">/*</font>
00074 <font class="comment">** Constraint: static variables can live in 1 or &gt; 2. </font>
00075 <font class="comment">**</font>
00076 <font class="comment">** except for tags.  All tags must be at the global level.</font>
00077 <font class="comment">** Static tags are handled in a kludgey way.</font>
00078 <font class="comment">*/</font>
00079 
00080 <font class="comment">/*</font>
00081 <font class="comment">** utab    is the universal symbol table</font>
00082 <font class="comment">** globtab is the global environment of utab</font>
00083 <font class="comment">** oldtab  is needed for conversions in dumping (after sorting the table)</font>
00084 <font class="comment">**</font>
00085 <font class="comment">** there can be only one usymtab!</font>
00086 <font class="comment">*/</font>
00087 
00088 <font class="keyword">static</font> <font class="comment">/*@checkedstrict@*/</font> <font class="comment">/*@owned@*/</font> <font class="comment">/*@notnull@*/</font> usymtab utab;
00089 
00090 <font class="comment">/* Reachable environments from from utab */</font>
00091 <font class="keyword">static</font> <font class="comment">/*@checkedstrict@*/</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> usymtab globtab;
00092 <font class="keyword">static</font> <font class="comment">/*@checkedstrict@*/</font> <font class="comment">/*@dependent@*/</font> usymtab filetab;
00093 
00094 <font class="comment">/* Used for sorting for dumpage. */</font>
00095 <font class="keyword">static</font> <font class="comment">/*@checkedstrict@*/</font> <font class="comment">/*@owned@*/</font> usymtab oldtab;
00096 
00097 <font class="keyword">static</font> <font class="keywordtype">int</font> usymtab_lexicalLevel (<font class="keywordtype">void</font>) <font class="comment">/*@globals utab@*/</font> ;
00098 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_isProbableNullAltBranch (sRef p_s) <font class="comment">/*@globals utab@*/</font> ;
00099 <font class="keyword">static</font> <font class="keywordtype">void</font> refTable_free (<font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> refTable p_x, <font class="keywordtype">int</font> p_nentries);
00100 <font class="keyword">static</font> ctype usymtab_suFieldsType (uentryList p_f, <font class="keywordtype">bool</font> p_isStruct) <font class="comment">/*@globals globtab@*/</font> ;
00101 
00102 <font class="keyword">static</font> <font class="keywordtype">void</font>
00103 usymtab_freeLevel (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> usymtab p_u)
00104   <font class="comment">/*@globals globtab, utab, filetab@*/</font> <font class="comment">/*@modifies p_u@*/</font> ;
00105 
00106 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_isProbableNullAux (sRef p_s) <font class="comment">/*@globals utab@*/</font> ;
00107 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring usymtab_unparseStackTab (usymtab p_t);
00108 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> uentry 
00109   usymtab_getRefTab (<font class="comment">/*@notnull@*/</font> usymtab p_u, <font class="keywordtype">int</font> p_level, usymId p_index);
00110 <font class="keyword">static</font> <font class="comment">/*@unused@*/</font> <font class="comment">/*@only@*/</font> cstring 
00111   usymtab_unparseLocalAux (<font class="comment">/*@notnull@*/</font> usymtab p_s);
00112 <font class="keyword">static</font> <font class="comment">/*@unused@*/</font> <font class="comment">/*@only@*/</font> cstring 
00113   usymtab_unparseLocalList (<font class="comment">/*@notnull@*/</font> usymtab p_s);
00114 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring usymtab_typeName (<font class="comment">/*@notnull@*/</font> usymtab p_t);
00115 <font class="keyword">static</font> <font class="keywordtype">void</font> usymtab_handleParams (<font class="keywordtype">void</font>)
00116    <font class="comment">/*@globals utab, globtab, filetab@*/</font> 
00117    <font class="comment">/*@modifies utab@*/</font> ;
00118 
00119 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> uentry 
00120   usymtab_addRefEntry (<font class="comment">/*@notnull@*/</font> usymtab p_s, cstring p_k);
00121 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> usymtab
00122   usymtab_dropEnv (<font class="comment">/*@notnull@*/</font> usymtab p_s);
00123 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> uentry 
00124   usymtab_getRefNoisy (<font class="comment">/*@notnull@*/</font> usymtab p_s, <font class="keywordtype">int</font> p_level, usymId p_index);
00125 
00126 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> uentry 
00127   usymtab_lookupQuiet (usymtab p_s, cstring p_k);
00128 <font class="keyword">static</font> <font class="keywordtype">void</font> usymtab_printAllAux (usymtab p_s) <font class="comment">/*@modifies g_msgstream@*/</font> ;
00129 <font class="keyword">static</font> <font class="keywordtype">int</font> usymtab_getIndex (<font class="comment">/*@notnull@*/</font> usymtab p_s, cstring p_k);
00130 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> uentry usymtab_fetchIndex (<font class="comment">/*@notnull@*/</font> usymtab p_s, <font class="keywordtype">int</font> p_i);
00131 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> uentry 
00132   usymtab_lookupAux (usymtab p_s, cstring p_k);
00133 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@notnull@*/</font> usymtab 
00134   usymtab_getFileTab (<font class="keywordtype">void</font>) <font class="comment">/*@globals filetab@*/</font> ;
00135 <font class="keyword">static</font> <font class="keywordtype">int</font> refTable_lookup (<font class="comment">/*@notnull@*/</font> usymtab p_ut, <font class="keywordtype">int</font> p_level, <font class="keywordtype">int</font> p_index);
00136 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_mustBreak (usymtab p_s);
00137 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_mustEscape (usymtab p_s);
00138 
00139 <font class="keyword">static</font> <font class="keywordtype">void</font> recordFunctionType (uentry ue)<font class="keyword"></font>
00140 <font class="keyword"></font>{
00141     llassert (uentry_isDatatype (ue) || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ue)
00142             || uentry_isEnumConstant (ue));
00143 
00144   <font class="comment">/*@-temptrans@*/</font>
00145   functypes = <a class="code" href="uentryList_c.html#a4">uentryList_add</a> (functypes, ue);
00146   <font class="comment">/*@=temptrans@*/</font>
00147 }
00148 
00149 <font class="keyword">static</font> <font class="keywordtype">void</font> clearFunctionTypes (<font class="keywordtype">void</font>)
00150   <font class="comment">/*@modifies globtab@*/</font>
00151 {
00152   uentryList_elements (functypes, el)<font class="keyword"></font>
00153 <font class="keyword">    </font>{
00154       <font class="keywordflow">if</font> (cstring_isDefined (uentry_rawName (el)))
00155         {
00156           <font class="keywordflow">if</font> (globtab-&gt;htable != NULL)
00157             {
00158               <a class="code" href="hashTable_c.html#a24">hashTable_remove</a> (globtab-&gt;htable, uentry_rawName (el));
00159             }
00160 
00161           <a class="code" href="uentry_c.html#a215">uentry_setName</a> (el, cstring_undefined);
00162         }
00163 
00164       <font class="comment">/*@access uentry@*/</font> 
00165       llassert (uentry_isValid (el));
00166       el-&gt;sref = sRef_undefined;
00167       <font class="comment">/*@noaccess uentry@*/</font>
00168     } end_uentryList_elements ;
00169 
00170   <a class="code" href="uentryList_c.html#a3">uentryList_clear</a> (functypes);
00171 }
00172 
00173 <font class="keyword">static</font> <font class="comment">/*@falsenull@*/</font> <font class="keywordtype">bool</font> usymtab_isBranch (usymtab u)<font class="keyword"></font>
00174 <font class="keyword"></font>{
00175   <font class="keywordflow">return</font> (usymtab_isDefined (u) &amp;&amp; 
00176           (u-&gt;kind == US_TBRANCH || u-&gt;kind == US_FBRANCH
00177            || u-&gt;kind == US_CBRANCH || u-&gt;kind == US_SWITCH));
00178 }
00179 
00180 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_mustBreak (usymtab s)<font class="keyword"></font>
00181 <font class="keyword"></font>{
00182   llassert (s != GLOBAL_ENV);
00183   <font class="keywordflow">return</font> (s-&gt;mustBreak);
00184 }
00185 
00186 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_mustEscape (usymtab s)<font class="keyword"></font>
00187 <font class="keyword"></font>{
00188   llassert (s != GLOBAL_ENV);
00189   <font class="keywordflow">return</font> (exitkind_mustEscape (s-&gt;exitCode));
00190 }
00191 
<a name="l00192"></a><a class="code" href="usymtab_c.html#a35">00192</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a35">usymtab_setMustBreak</a> () 
00193   <font class="comment">/*@modifies utab@*/</font>
00194 {
00195   llassert (utab != GLOBAL_ENV);
00196   utab-&gt;mustBreak = TRUE;
00197 }
00198 
<a name="l00199"></a><a class="code" href="usymtab_c.html#a36">00199</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a36">usymtab_setExitCode</a> (exitkind ex) 
00200    <font class="comment">/*@modifies utab@*/</font>
00201 {
00202   llassert (utab != GLOBAL_ENV);
00203 
00204   utab-&gt;exitCode = ex;
00205   
00206   <font class="keywordflow">if</font> (exitkind_mustEscape (ex))
00207     {
00208       utab-&gt;mustBreak = TRUE;
00209     }
00210 }
00211 
<a name="l00212"></a><a class="code" href="usymtab_c.html#a37">00212</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a37">usymtab_isAltProbablyDeepNull</a> (sRef s)<font class="keyword"></font>
00213 <font class="keyword"></font>{
00214   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (usymtab_isProbableNullAltBranch, s));
00215 }
00216 
00217 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_isProbableNullAltBranch (sRef s) 
00218    <font class="comment">/*@globals utab@*/</font>
00219 {
00220   guardSet t;
00221   <font class="keywordtype">bool</font> res;
00222 
00223   t = utab-&gt;guards;
00224 
00225   llassert (utab-&gt;env != NULL);
00226 
00227   <font class="comment">/*@-mods@*/</font> <font class="comment">/* These modifications are cancelled. */</font>
00228   utab-&gt;guards = utab-&gt;env-&gt;guards;
00229   utab-&gt;env-&gt;guards = t;
00230   <font class="comment">/*@=mods@*/</font>
00231 
00232   llassert (usymtab_isDefined (utab));
00233   res = <a class="code" href="usymtab_c.html#a146">usymtab_isProbableNull</a> (s);
00234 
00235   <font class="comment">/*</font>
00236 <font class="comment">  ** This reports a spurious error.  It is okay, because of</font>
00237 <font class="comment">  ** the nesting relationship of usymtab environments.</font>
00238 <font class="comment">  */</font>
00239 
00240   <font class="comment">/*@-mods@*/</font> <font class="comment">/* Cancelling modifications. */</font>
00241   <font class="comment">/*@i1@*/</font> utab-&gt;env-&gt;guards = utab-&gt;guards;
00242   <font class="comment">/*@i1@*/</font> utab-&gt;guards = t;
00243   <font class="comment">/*@=mods@*/</font> 
00244 
00245   <font class="keywordflow">return</font> res;
00246 }
00247 
00248 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> usymtab
00249   usymtab_create (uskind kind, <font class="comment">/*@keep@*/</font> usymtab env, <font class="keywordtype">bool</font> nextlevel)
00250   <font class="comment">/*@defines result@*/</font>
00251   <font class="comment">/*@post:isnull result-&gt;htable, result-&gt;guards, result-&gt;aliases@*/</font>
00252 {
00253   usymtab t = (usymtab) dmalloc (<font class="keyword">sizeof</font> (*t));
00254   
00255   t-&gt;nentries = 0;
00256   t-&gt;nspace = CBASESIZE;
00257   t-&gt;entries = (uentry *) dmalloc (<font class="keyword">sizeof</font> (*t-&gt;entries) * CBASESIZE);
00258   t-&gt;reftable = (nextlevel 
00259                  ? NULL
00260                  : (refentry *) dmalloc (<font class="keyword">sizeof</font> (*t-&gt;reftable) * CBASESIZE));
00261   
00262   t-&gt;kind = kind;
00263   t-&gt;lexlevel = (env == GLOBAL_ENV ? 0 : env-&gt;lexlevel) + (nextlevel ? 1 : 0); 
00264 
00265   t-&gt;env = env;
00266   t-&gt;htable = NULL;
00267 
00268   t-&gt;guards = guardSet_undefined;
00269   t-&gt;aliases = aliasTable_undefined;
00270 
00271     t-&gt;mustBreak = FALSE;
00272   t-&gt;exitCode = XK_NEVERESCAPE;
00273 
00274   <font class="keywordflow">return</font> t;
00275 }
00276 
00277 <font class="comment">/*</font>
00278 <font class="comment">** constructors</font>
00279 <font class="comment">*/</font>
00280 
00281 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> usymtab
00282   usymtab_createRoot (<font class="keywordtype">void</font>) <font class="comment">/*@modifies nothing@*/</font>
00283 {
00284   usymtab u = (usymtab) dmalloc (<font class="keyword">sizeof</font> (*u));
00285   
00286   u-&gt;nentries = 0;
00287   u-&gt;nspace = CGLOBBASESIZE;
00288   u-&gt;entries = (uentry *) dmalloc (<font class="keyword">sizeof</font> (*u-&gt;entries) * CGLOBBASESIZE);
00289   u-&gt;env = GLOBAL_ENV;
00290   u-&gt;lexlevel = 0;
00291   u-&gt;htable = <a class="code" href="hashTable_c.html#a17">hashTable_create</a> (CGLOBHASHSIZE);
00292   u-&gt;reftable = NULL;
00293 
00294   u-&gt;guards = <a class="code" href="guardSet_c.html#a0">guardSet_new</a> ();
00295   u-&gt;aliases = <a class="code" href="aliasTable_c.html#a4">aliasTable_new</a> ();
00296 
00297   u-&gt;mustBreak = FALSE;
00298   u-&gt;exitCode = XK_NEVERESCAPE;
00299   u-&gt;kind = US_NORMAL;
00300 
00301   <font class="keywordflow">return</font> (u);
00302 }
00303 
00304 <font class="keywordtype">void</font>
<a name="l00305"></a><a class="code" href="usymtab_c.html#a40">00305</a> <a class="code" href="usymtab_c.html#a40">usymtab_initMod</a> (<font class="keywordtype">void</font>)
00306    <font class="comment">/*@globals undef utab, undef oldtab, undef globtab, undef filetab @*/</font>
00307    <font class="comment">/*@modifies utab, globtab, filetab, oldtab @*/</font>
00308 {
00309   utab = usymtab_createRoot ();
00310   globtab = utab;
00311   filetab = usymtab_undefined;
00312   oldtab = usymtab_undefined;
00313 }
00314 
00315 <font class="comment">/*</font>
00316 <font class="comment">** utab should be empty?  (requires?)</font>
00317 <font class="comment">**</font>
00318 <font class="comment">** Adds bool types to symbol table (these are built in for now)</font>
00319 <font class="comment">** Only do this is there is no library!</font>
00320 <font class="comment">*/</font>
00321 
00322 <font class="keywordtype">void</font>
<a name="l00323"></a><a class="code" href="usymtab_c.html#a41">00323</a> <a class="code" href="usymtab_c.html#a41">usymtab_initBool</a> ()<font class="keyword"></font>
00324 <font class="keyword"></font>{
00325   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NOLIB))
00326     {
00327       ctype boolt = ctype_bool;
00328       <font class="comment">/* evs 2000-07-24: bool is now treated as abstract (always) */</font>
00329 
00330       uentry boolentry = <a class="code" href="uentry_c.html#a113">uentry_makeBoolDatatype</a> (YES);
00331       <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (boolentry);
00332       <a class="code" href="context_c.html#a135">context_addBoolAccess</a> ();
00333 
00334       <font class="comment">/*</font>
00335 <font class="comment">      ** We supply values 0 and 1 for the constants, so things like</font>
00336 <font class="comment">      ** while (TRUE) can be interpreted correctly.</font>
00337 <font class="comment">      */</font>
00338 
00339       usymtab_supGlobalEntry 
00340         (<a class="code" href="uentry_c.html#a84">uentry_makeConstantAux</a> (context_getFalseName (), boolt, 
00341                                  <a class="code" href="fileloc_c.html#a28">fileloc_getBuiltin</a> (), FALSE,
00342                                  <a class="code" href="multiVal_c.html#a2">multiVal_makeInt</a> (0)));
00343       usymtab_supGlobalEntry 
00344         (<a class="code" href="uentry_c.html#a84">uentry_makeConstantAux</a> (context_getTrueName (), boolt, 
00345                                  <a class="code" href="fileloc_c.html#a28">fileloc_getBuiltin</a> (), FALSE,
00346                                  <a class="code" href="multiVal_c.html#a2">multiVal_makeInt</a> (1)));
00347     }
00348 }
00349 
00350 <font class="comment">/*</font>
00351 <font class="comment">** mutators </font>
00352 <font class="comment">*/</font>
00353 
00354 <font class="keyword">static</font> <font class="keywordtype">void</font>
00355 usymtab_grow (<font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
00356 <font class="keyword"></font>{
00357   <font class="keywordtype">int</font> i;
00358   o_uentry *oldsyms = s-&gt;entries;
00359 
00360   s-&gt;nspace = CBASESIZE;
00361   s-&gt;entries = (uentry *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;entries) 
00362                                    * (s-&gt;nentries + s-&gt;nspace));
00363 
00364   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
00365     {
00366       s-&gt;entries[i] = oldsyms[i];
00367     }
00368 
00369   <a class="code" href="general_c.html#a0">sfree</a> (oldsyms);
00370 
00371   <font class="keywordflow">if</font> (s-&gt;reftable != NULL)
00372     {
00373       refTable oldRefs = s-&gt;reftable;
00374 
00375       s-&gt;reftable = (refentry *) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;reftable)
00376                                           * (s-&gt;nentries + CBASESIZE + 1));
00377       
00378       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
00379         {
00380           s-&gt;reftable[i] = oldRefs[i];
00381         }
00382 
00383       <font class="comment">/*@-compdestroy@*/</font> 
00384       <a class="code" href="general_c.html#a0">sfree</a> (oldRefs);
00385       <font class="comment">/*@=compdestroy@*/</font> 
00386     }
00387       
00388 }
00389 
00390 <font class="keyword">static</font> <font class="keywordtype">void</font>
00391 usymtab_addEntryQuiet (<font class="comment">/*@notnull@*/</font> usymtab s, <font class="comment">/*@keep@*/</font> uentry e)<font class="keyword"></font>
00392 <font class="keyword"></font>{
00393   <font class="keywordflow">if</font> (!(s-&gt;lexlevel &gt; fileScope || !<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ()))
00394     {
00395       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) 
00396           || uentry_isFunction (e)
00397           || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e)
00398           || uentry_isEnumConstant (e)
00399           || <a class="code" href="context_c.html#a235">context_inMacro</a> ())
00400         {
00401           <font class="comment">/* </font>
00402 <font class="comment">          ** Not a bug.  Code like,</font>
00403 <font class="comment">          **    int f (void) { typedef int tint; ... }</font>
00404 <font class="comment">          ** is legal.</font>
00405 <font class="comment">          */</font>
00406           
00407           <font class="comment">/* was nothing here! */</font>
00408           <font class="comment">/*@i@*/</font> e-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (e-&gt;sref);
00409         }
00410       <font class="keywordflow">else</font>
00411         {
00412           llparseerror 
00413             (cstring_makeLiteral (<font class="stringliteral">"Declaration outside function scope"</font>));
00414 
00415           llcontbug (message (<font class="stringliteral">"usymtab_addEntryQuiet: inconsistent state "</font>
00416                               <font class="stringliteral">"(lexlevel = %d, modFunction = %s) adding: %q"</font>, 
00417                               s-&gt;lexlevel, bool_unparse (sRef_modInFunction ()), 
00418                               <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (e)));
00419           <a class="code" href="sRef_c.html#a81">sRef_setGlobalScope</a> ();
00420           <font class="comment">/* make sure the sRef is not bashed! */</font>
00421           <font class="comment">/*@i@*/</font> e-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (e-&gt;sref);
00422         }
00423     }
00424 
00425   <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0)
00426     {
00427       usymtab_grow (s);
00428     }
00429   
00430   s-&gt;nspace--;
00431   s-&gt;entries[s-&gt;nentries] = e;
00432 
00433 <font class="preprocessor"># ifdef DOANNOTS</font>
00434 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (s == globtab || s == filetab)
00435     {
00436       <font class="keywordflow">if</font> (!<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (g_currentloc))
00437         {
00438           uentry_tallyAnnots (e, AN_UNKNOWN);
00439         }
00440     }
00441 <font class="preprocessor"># endif</font>
00442 <font class="preprocessor"></font>
00443   <font class="keywordflow">if</font> (s-&gt;htable != NULL)
00444     {
00445       <a class="code" href="hashTable_c.html#a21">hashTable_insert</a> (s-&gt;htable, uentry_rawName (e), s-&gt;nentries);
00446     }
00447 
00448   s-&gt;nentries++;
00449 }
00450 
00451 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> uentry <font class="comment">/*@alt void@*/</font>
00452 usymtab_addEntryBase (<font class="comment">/*@notnull@*/</font> usymtab s, <font class="comment">/*@only@*/</font> uentry e)<font class="keyword"></font>
00453 <font class="keyword"></font>{
00454   <font class="comment">/* </font>
00455 <font class="comment">  ** In theory, we shouldn't need this test because it this is</font>
00456 <font class="comment">  ** only called when a library is being read, and it shouldn't</font>
00457 <font class="comment">  ** ever have a duplicate entry.  In practice, its safer to</font>
00458 <font class="comment">  ** leave it in, though.</font>
00459 <font class="comment">  */</font>
00460 
00461   uentry old;
00462 
00463   <font class="keywordflow">if</font> (uentry_isValid (old = usymtab_lookupQuiet (s, uentry_rawName (e))))
00464     {
00465       DPRINTF ((<font class="stringliteral">"Duplicate entry: %s"</font>, uentry_unparse (e)));
00466       <a class="code" href="uentry_c.html#a238">uentry_free</a> (e); <font class="comment">/* duplicate */</font>
00467       <font class="keywordflow">return</font> old;
00468     }
00469   <font class="keywordflow">else</font>
00470     {
00471       <font class="keywordtype">int</font> thisentry = s-&gt;nentries;  
00472       
00473       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (e))
00474         {
00475           <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (e, sRef_makeCvar (globScope, thisentry, 
00476                                             uentry_getType (e)));
00477         }
00478       
00479       usymtab_addEntryQuiet (s, e);
00480       <font class="keywordflow">return</font> e;
00481     }
00482 }
00483 
00484 <font class="keyword">static</font> usymId
00485 usymtab_addEntryAux (<font class="comment">/*@notnull@*/</font> usymtab st, <font class="comment">/*@keep@*/</font> uentry e, <font class="keywordtype">bool</font> isSref)
00486      <font class="comment">/*@globals globtab@*/</font>
00487      <font class="comment">/*@modifies st, e@*/</font>
00488 {
00489   usymId thisentry = st-&gt;nentries;
00490 
00491   llassert (!uentry_isElipsisMarker (e));
00492 
00493   <font class="comment">/*</font>
00494 <font class="comment">  ** not true for tags</font>
00495 <font class="comment">  **  llassert (usymtab_lookupSafe (uentry_rawName (e)) == uentry_undefined);</font>
00496 <font class="comment">  **/</font>
00497 
00498   llassertprint (uentry_isAnyTag (e) ? st == globtab : TRUE, 
00499                  (<font class="stringliteral">"non-global tag: %s / %d"</font>, <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (e), st-&gt;lexlevel));
00500 
00501   <font class="keywordflow">if</font> (st-&gt;lexlevel == fileScope 
00502       &amp;&amp; (!(uentry_isStatic (e)) || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))) 
00503     {
00504       st = globtab;
00505     }
00506 
00507   <font class="keywordflow">if</font> (isSref)
00508     {
00509       ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
00510 
00511       <font class="keywordflow">if</font> (uentry_isFunction (e) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
00512         {
00513           ct = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ct);
00514         }
00515 
00516       <font class="keywordflow">if</font> (uentry_isStatic (e))
00517         {
00518           sRef sr = <a class="code" href="sRef_c.html#a129">sRef_makeCvar</a> (st-&gt;lexlevel, thisentry, ct);
00519 
00520           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a349">sRef_isStack</a> (sr) || <a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (sr))
00521             {
00522               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (sr, AK_STATIC, uentry_whereLast (e));
00523               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sr, uentry_whereLast (e));
00524             }
00525           
00526           <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (e, sr);
00527         }
00528       <font class="keywordflow">else</font>
00529         {
00530           <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (e, sRef_makeCvar (st-&gt;lexlevel, thisentry, ct));
00531         }
00532 
00533           }
00534 
00535   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e))
00536     {
00537       
00538       <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (e, thisentry);
00539     }
00540 
00541   <font class="keywordflow">if</font> (uentry_isFunction (e))
00542     {
00543       ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
00544 
00545       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct)
00546           &amp;&amp; <a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (ctype_argsFunction (ct)))
00547         {
00548           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (e))
00549             {
00550               voptgenerror 
00551                 (FLG_NOPARAMS,
00552                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q declared without parameter list"</font>,
00553                           uentry_getName (e)),
00554                  <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e));
00555             }
00556           <font class="keywordflow">else</font>
00557             {
00558               voptgenerror
00559                 (FLG_NOPARAMS,
00560                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q specified without parameter list"</font>,
00561                           uentry_getName (e)),
00562                  <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (e));
00563             }
00564         }
00565     }
00566 
00567   <font class="keywordflow">if</font> (st == globtab &amp;&amp; !<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (e))
00568     {
00569       <a class="code" href="exprChecks_c.html#a22">exprChecks_checkExport</a> (e);
00570     }
00571   
00572   
00573   <a class="code" href="uentry_c.html#a284">uentry_checkName</a> (e);
00574   
00575   usymtab_addEntryQuiet (st, e);
00576   <font class="keywordflow">return</font> (thisentry);
00577 }
00578 
00579 usymId
<a name="l00580"></a><a class="code" href="usymtab_c.html#a46">00580</a> <a class="code" href="usymtab_c.html#a46">usymtab_addEntry</a> (uentry e) 
00581    <font class="comment">/*@globals utab, globtab@*/</font>
00582    <font class="comment">/*@modifies utab, e@*/</font>
00583 {
00584   
00585   llassertprint (!usymtab_exists (uentry_rawName (e)),
00586                  (<font class="stringliteral">"Entry already exists: %s"</font>, <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (e)));
00587 
00588   <font class="keywordflow">return</font> usymtab_addEntryAux (utab, e, FALSE);
00589 }
00590 
00591 <font class="keywordtype">void</font>
<a name="l00592"></a><a class="code" href="usymtab_c.html#a47">00592</a> <a class="code" href="usymtab_c.html#a47">usymtab_addGlobalEntry</a> (uentry e)
00593    <font class="comment">/*@modifies globtab, e@*/</font> 
00594 {
00595   DPRINTF ((<font class="stringliteral">"Add global: %s / %s"</font>, uentry_unparse (e), bool_unparse (uentry_isForward (e))));
00596 
00597   (<font class="keywordtype">void</font>) usymtab_addEntryAux (globtab, e, FALSE);
00598 }
00599 
00600 <font class="comment">/*</font>
00601 <font class="comment">** supercede and replace entry use elements of entries array, and</font>
00602 <font class="comment">** assign an element to a new value, and then free the old value.</font>
00603 <font class="comment">** Need -deparrays to avoid errors for this. </font>
00604 <font class="comment">*/</font>
00605 
00606 <font class="comment">/*@-deparrays@*/</font> 
00607 
00608 <font class="keyword">static</font> usymId
00609 usymtab_supEntryAux (<font class="comment">/*@notnull@*/</font> usymtab st, 
00610                      <font class="comment">/*@only@*/</font> uentry e, <font class="keywordtype">bool</font> isSref)
00611    <font class="comment">/*@globals globtab, filetab@*/</font>
00612    <font class="comment">/*@modifies st, globtab, e@*/</font>
00613 {
00614   cstring ename = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e);
00615   <font class="keywordtype">bool</font> staticEntry = FALSE;
00616   <font class="keywordtype">int</font> eindex;
00617 
00618   <font class="comment">/* static tags in global scope */</font>
00619   <font class="keywordflow">if</font> (st-&gt;lexlevel == fileScope 
00620       &amp;&amp; (!(uentry_isStatic (e)) || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))) 
00621     {
00622       eindex = usymtab_getIndex (st, ename);
00623 
00624       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
00625         {
00626           uentry ce = st-&gt;entries[eindex];      
00627           
00628           <font class="keywordflow">if</font> (optgenerror
00629               (FLG_SHADOW,
00630                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q shadows static declaration"</font>,
00631                         ekind_capName (uentry_getKind (e)),
00632                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
00633                <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e)))
00634             {
00635               <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (ce);
00636             }
00637 
00638           <font class="keywordflow">if</font> (eindex == st-&gt;nentries - 1)
00639             {
00640              ;
00641             }
00642           <font class="keywordflow">else</font>
00643             {
00644               st-&gt;entries[eindex] = st-&gt;entries[st-&gt;nentries - 1];
00645             }
00646 
00647           <font class="keywordflow">if</font> (st-&gt;htable != NULL)
00648             {
00649               <a class="code" href="hashTable_c.html#a23">hashTable_replaceKey</a> (st-&gt;htable, uentry_rawName (ce), 
00650                                     <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e));
00651             }
00652 
00653           <a class="code" href="uentry_c.html#a238">uentry_free</a> (ce);
00654           st-&gt;nentries--;
00655         }
00656       
00657       st = globtab;
00658     }
00659 
00660   <font class="keywordflow">if</font> (uentry_isStatic (e)) {
00661     <font class="keywordflow">if</font> (uentry_isFunction (e)) {
00662       <font class="comment">/* Static function declarations are at the file level, even if they are in a deeped scope. */</font>
00663       st = usymtab_getFileTab ();
00664       staticEntry = TRUE;
00665     } <font class="keywordflow">else</font> {
00666       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e) &amp;&amp; st == globtab) 
00667         {
00668           st = usymtab_getFileTab ();
00669           staticEntry = TRUE;
00670           DPRINTF ((<font class="stringliteral">"Static entry!"</font>));
00671         }
00672     }
00673   }
00674 
00675   DPRINTF ((<font class="stringliteral">"Using symtab: %s"</font>, usymtab_unparseLocalAux (st)));
00676 
00677   eindex = usymtab_getIndex (st, ename);
00678       
00679   <font class="keywordflow">if</font> (eindex != NOT_FOUND)
00680     {
00681       uentry ce = st-&gt;entries[eindex];
00682 
00683       DPRINTF ((<font class="stringliteral">"Found entry: %s"</font>, uentry_unparse (ce)));
00684 
00685       <font class="keywordflow">if</font> (uentry_isPriv (ce)
00686           <font class="comment">/* || (fileloc_isImport (uentry_whereSpecified (ce))) */</font>
00687           || (uentry_isStatic (ce) 
00688               &amp;&amp; <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ce)
00689               &amp;&amp; (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (ce) 
00690                   &amp;&amp; !<a class="code" href="fileloc_c.html#a17">fileloc_sameFile</a> (uentry_whereDefined (ce),
00691                                         <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (e)))))
00692         {
00693           <font class="comment">/*</font>
00694 <font class="comment">          ** overload entry </font>
00695 <font class="comment">          **    if overloading import should do some checks!</font>
00696 <font class="comment">          */</font>
00697 
00698           llassert ((st-&gt;lexlevel &gt; fileScope || !sRef_modInFunction ()));
00699           
00700           st-&gt;entries[eindex] = e;
00701 
00702           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e))
00703             {
00704               <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (e, eindex);
00705             }
00706           
00707           <font class="keywordflow">if</font> (st == globtab &amp;&amp; !<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (e))
00708             {
00709               <a class="code" href="exprChecks_c.html#a22">exprChecks_checkExport</a> (e);
00710             }
00711 
00712           <font class="keywordflow">if</font> (st-&gt;htable != NULL)
00713             {
00714               <a class="code" href="hashTable_c.html#a23">hashTable_replaceKey</a> (st-&gt;htable, uentry_rawName (ce), 
00715                                     <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e));
00716             }
00717 
00718           <a class="code" href="uentry_c.html#a238">uentry_free</a> (ce);
00719           ce = e; 
00720         }
00721       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (ce))
00722         {
00723           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (e))
00724             {
00725               <font class="keywordflow">if</font> (fileloc_isImport (uentry_whereSpecified (ce)))
00726                 {
00727                   
00728                   <font class="keywordflow">if</font> (st-&gt;htable != NULL)
00729                     {
00730                       <a class="code" href="hashTable_c.html#a23">hashTable_replaceKey</a> (st-&gt;htable, 
00731                                             uentry_rawName (ce), 
00732                                             <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e));
00733                     }
00734                   
00735                   <a class="code" href="uentry_c.html#a238">uentry_free</a> (ce); 
00736                   st-&gt;entries[eindex] = e;
00737                   ce = e;
00738 
00739                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e)) <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (e, eindex);
00740                 }
00741               <font class="keywordflow">else</font> 
00742                 {
00743                   <font class="keywordflow">if</font> (fileloc_isImport (uentry_whereSpecified (e)))
00744                     {
00745                       <a class="code" href="uentry_c.html#a238">uentry_free</a> (e);
00746                     }
00747                   <font class="keywordflow">else</font>
00748                     {
00749                       <font class="comment">/* respecification errors already reported */</font>
00750   
00751                       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e)) 
00752                         {
00753                           <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (e, eindex);
00754                         }
00755                       
00756                       <font class="keywordflow">if</font> (st-&gt;htable != NULL)
00757                         {
00758                           <a class="code" href="hashTable_c.html#a23">hashTable_replaceKey</a> (st-&gt;htable, 
00759                                                 uentry_rawName (ce), 
00760                                                 <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e));
00761                         }
00762                       
00763                       llassert ((st-&gt;lexlevel &gt; fileScope || !sRef_modInFunction ()));
00764                       <a class="code" href="uentry_c.html#a238">uentry_free</a> (ce);
00765                       st-&gt;entries[eindex] = e;
00766                       ce = e;
00767                     } 
00768                 }
00769             }
00770           <font class="keywordflow">else</font> <font class="comment">/* e not specified */</font>
00771             {
00772               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (ce))
00773                 {
00774                   llassert ((st-&gt;lexlevel &gt; fileScope || !sRef_modInFunction ()));
00775                   <a class="code" href="uentry_c.html#a267">uentry_mergeDefinition</a> (ce, e);
00776                 }
00777               <font class="keywordflow">else</font> 
00778                 {
00779                   llassert ((st-&gt;lexlevel &gt; fileScope || !sRef_modInFunction ()));
00780                   <a class="code" href="uentry_c.html#a264">uentry_mergeEntries</a> (ce, e);
00781                 }
00782             }
00783         }
00784       <font class="keywordflow">else</font> <font class="comment">/* ce not specified */</font>
00785         {
00786           <font class="keywordflow">if</font> (!(st-&gt;lexlevel &gt; fileScope || !<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ()))
00787             {
00788               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (e) || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e)
00789                   || uentry_isEnumConstant (e))
00790                 {
00791                   ; <font class="comment">/* </font>
00792 <font class="comment">                     ** Not a bug.  Code like,</font>
00793 <font class="comment">                     **    int f (void) { typedef int tint; ... }</font>
00794 <font class="comment">                     ** is legal.</font>
00795 <font class="comment">                     */</font>
00796                 }
00797               <font class="keywordflow">else</font>
00798                 {
00799                   llcontbug (message (<font class="stringliteral">"usymtab_supEntryAux: inconsistent state "</font>
00800                                       <font class="stringliteral">"(lexlevel = %d, modFunction = %s) adding: %q"</font>, 
00801                                       st-&gt;lexlevel, bool_unparse (sRef_modInFunction ()), 
00802                                       <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (e)));
00803 
00804                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
00805                     {
00806                       <font class="comment">/* make sure the sRef is not bashed! */</font>
00807                       <font class="comment">/*@i@*/</font> e-&gt;sref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (e-&gt;sref);
00808                     }
00809                 }
00810             }
00811           
00812           <a class="code" href="uentry_c.html#a267">uentry_mergeDefinition</a> (ce, e);
00813         }
00814       
00815       <font class="keywordflow">if</font> (isSref)
00816         {
00817           ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ce);
00818           
00819           <font class="keywordflow">if</font> (uentry_isFunction (ce) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct))
00820             {
00821               ct = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ct);
00822             }
00823           
00824           <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (ce, sRef_makeCvar (st-&gt;lexlevel, eindex, ct));
00825                 }
00826     }
00827   <font class="keywordflow">else</font> <font class="comment">/* no previous entry */</font>
00828     {
00829       uentry outer;
00830 
00831       <font class="keywordflow">if</font> (st-&gt;lexlevel == globScope 
00832           &amp;&amp; !uentry_isStatic (e)
00833           &amp;&amp; !uentry_isExtern (e)
00834           &amp;&amp; usymtab_isDefined (filetab))
00835         {
00836           <font class="comment">/*</font>
00837 <font class="comment">          ** check if there is a static entry:  (i.e.,</font>
00838 <font class="comment">          **   </font>
00839 <font class="comment">          **    static int f ();</font>
00840 <font class="comment">          **    ...</font>
00841 <font class="comment">          **    int f (); </font>
00842 <font class="comment">          */</font>
00843           
00844           eindex = usymtab_getIndex (filetab, ename);
00845           
00846           <font class="keywordflow">if</font> (eindex != NOT_FOUND)
00847             {
00848               uentry ce = filetab-&gt;entries[eindex];
00849 
00850               <a class="code" href="uentry_c.html#a53">uentry_setStatic</a> (e);
00851               <a class="code" href="uentry_c.html#a267">uentry_mergeDefinition</a> (ce, e);
00852               staticEntry = TRUE;
00853               <font class="keywordflow">goto</font> exitPoint;
00854             }
00855         }
00856       
00857       outer = usymtab_lookupQuiet (st-&gt;env, ename);
00858 
00859       <font class="comment">/*</font>
00860 <font class="comment">      ** no previous definition, add the new one</font>
00861 <font class="comment">      */</font>
00862       
00863       <font class="keywordflow">if</font> (!noshadowerror 
00864           &amp;&amp; uentry_isValid (outer)
00865           &amp;&amp; !(<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (e) || <a class="code" href="uentry_c.html#a98">uentry_isYield</a> (outer))
00866           &amp;&amp; fileloc_isDefined (uentry_whereLast (e))
00867           &amp;&amp; fileloc_isDefined (uentry_whereLast (outer)))
00868         {
00869           <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a269">uentry_sameKind</a> (outer, e))
00870             {
00871               ; <font class="comment">/* no error */</font>
00872             }
00873           <font class="keywordflow">else</font>
00874             {
00875               <font class="keywordflow">if</font> (ctype_isUnknown (uentry_getType (outer))
00876                   || <a class="code" href="uentry_c.html#a108">uentry_isForward</a> (outer))
00877                 {
00878                   ;
00879                 }
00880               <font class="keywordflow">else</font>
00881                 {
00882                   <font class="keywordflow">if</font> (optgenerror 
00883                       (FLG_SHADOW,
00884                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q shadows outer declaration"</font>,
00885                                 ekind_capName (uentry_getKind (e)),
00886                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
00887                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
00888                     {
00889                       <a class="code" href="uentry_c.html#a241">uentry_showWhereLast</a> (outer);
00890                     }
00891                 }
00892             }
00893         }
00894       
00895       <font class="keywordflow">if</font> (st == globtab &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NEWDECL))
00896         {
00897           voptgenerror 
00898             (FLG_NEWDECL,
00899              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"New declaration: %q"</font>, uentry_getName (e)),
00900              <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e));
00901         }
00902 
00903       eindex = usymtab_addEntryAux (st, e, isSref);
00904     }
00905 
00906  exitPoint:
00907     <font class="keywordflow">return</font> (staticEntry ? USYMIDINVALID : eindex);
00908 }
00909 
00910 <font class="preprocessor"># ifndef NOLCL</font>
00911 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">void</font>
00912 usymtab_replaceEntryAux (<font class="comment">/*@notnull@*/</font> usymtab st, <font class="comment">/*@only@*/</font> uentry e)
00913    <font class="comment">/*@globals globtab@*/</font> <font class="comment">/*@modifies st, e@*/</font>
00914 {
00915   cstring ename = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e);
00916   <font class="keywordtype">int</font> eindex;
00917 
00918   <font class="comment">/* static tags in global scope */</font>
00919   eindex = usymtab_getIndex (st, ename);
00920   
00921   <font class="keywordflow">if</font> (eindex != NOT_FOUND)
00922     {
00923       uentry ce = st-&gt;entries[eindex];      
00924       
00925       <font class="keywordflow">if</font> (st-&gt;htable != NULL)
00926         {
00927           <a class="code" href="hashTable_c.html#a23">hashTable_replaceKey</a> (st-&gt;htable, uentry_rawName (ce), <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e));
00928         }
00929 
00930       <a class="code" href="uentry_c.html#a238">uentry_free</a> (ce);
00931       st-&gt;entries[eindex] = e;
00932     }
00933   <font class="keywordflow">else</font>
00934     {
00935       eindex = usymtab_addEntryAux (st, e, FALSE);
00936     }
00937 }
00938 <font class="preprocessor"># endif</font>
00939 <font class="preprocessor"></font>
00940 <font class="comment">/*@=deparrays@*/</font> 
00941 
<a name="l00942"></a><a class="code" href="usymtab_c.html#a50">00942</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a50">usymtab_supEntry</a> (uentry e)
00943    <font class="comment">/*@globals utab, filetab, globtab@*/</font>
00944    <font class="comment">/*@modifies utab, globtab, e@*/</font>
00945 {
00946     (<font class="keywordtype">void</font>) usymtab_supEntryAux (utab, e, FALSE);
00947 }
00948 
00949 <font class="comment">/*</font>
00950 <font class="comment">** this should be lots more efficient!</font>
00951 <font class="comment">*/</font>
00952 
00953 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> uentry 
00954   usymtab_supEntryReturnAux (<font class="comment">/*@notnull@*/</font> usymtab tab, 
00955                              <font class="comment">/*@only@*/</font> uentry e, <font class="keywordtype">bool</font> isref)
00956   <font class="comment">/*@globals globtab, filetab@*/</font>
00957   <font class="comment">/*@modifies tab, globtab, e@*/</font>
00958 {
00959   cstring rawName = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (uentry_rawName (e));
00960   <font class="keywordtype">bool</font> stat = (tab == globtab) &amp;&amp; uentry_isStatic (e);
00961   uentry ret;
00962 
00963     
00964   (<font class="keywordtype">void</font>) usymtab_supEntryAux (tab, e, isref);
00965 
00966   <font class="keywordflow">if</font> (stat)
00967     {
00968       ret = usymtab_lookupAux (filetab, rawName);
00969     }
00970   <font class="keywordflow">else</font>
00971     {
00972       ret = usymtab_lookupAux (tab, rawName);
00973 
00974       <font class="keywordflow">if</font> (uentry_isInvalid (ret) &amp;&amp; usymtab_isDefined (filetab))
00975         {
00976           ret = usymtab_lookupAux (filetab, rawName);
00977         }
00978     }
00979   
00980   <a class="code" href="cstring_c.html#a27">cstring_free</a> (rawName);
00981   <font class="keywordflow">return</font> ret;
00982 }
00983 
00984 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
<a name="l00985"></a><a class="code" href="usymtab_c.html#a52">00985</a>   <a class="code" href="usymtab_c.html#a52">usymtab_supEntryReturn</a> (<font class="comment">/*@only@*/</font> uentry e)
00986   <font class="comment">/*@globals utab, filetab, globtab@*/</font>
00987   <font class="comment">/*@modifies utab, globtab, e@*/</font>
00988 {
00989   <font class="keywordflow">return</font> (usymtab_supEntryReturnAux (utab, e, FALSE));
00990 }
00991 
00992 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
<a name="l00993"></a><a class="code" href="usymtab_c.html#a53">00993</a>   <a class="code" href="usymtab_c.html#a53">usymtab_supEntrySrefReturn</a> (<font class="comment">/*@only@*/</font> uentry e)
00994   <font class="comment">/*@globals utab, globtab, filetab@*/</font>
00995   <font class="comment">/*@modifies utab, globtab, e@*/</font>
00996 {
00997   <font class="keywordflow">return</font> (usymtab_supEntryReturnAux (utab, e, TRUE));
00998 }
00999 
01000 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
<a name="l01001"></a><a class="code" href="usymtab_c.html#a54">01001</a>   <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (uentry e)
01002   <font class="comment">/*@globals globtab, filetab@*/</font>
01003   <font class="comment">/*@modifies globtab, e@*/</font>
01004 {
01005   uentry ret;
01006 
01007   ret = usymtab_supEntryReturnAux (globtab, e, FALSE);
01008 
01009   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01010     {
01011       recordFunctionType (ret);
01012     }
01013 
01014   <font class="keywordflow">return</font> (ret);
01015 }
01016 
01017 ctype
<a name="l01018"></a><a class="code" href="usymtab_c.html#a55">01018</a> <a class="code" href="usymtab_c.html#a55">usymtab_supTypeEntry</a> (<font class="comment">/*@only@*/</font> uentry e)
01019   <font class="comment">/*@globals globtab, filetab@*/</font>
01020   <font class="comment">/*@modifies globtab, e@*/</font>
01021 {
01022   usymId uid;
01023   ctype ret;
01024 
01025   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a166">uentry_isAbstractDatatype</a> (e))
01026     {
01027       uid = <a class="code" href="usymtab_c.html#a57">usymtab_supAbstractTypeEntry</a> (e, FALSE);
01028       ret = <a class="code" href="ctype_c.html#a25">ctype_createAbstract</a> (uid);
01029     }
01030   <font class="keywordflow">else</font>
01031     {
01032       uid = usymtab_supEntryAux (globtab, e, FALSE);
01033       ret = <a class="code" href="ctype_c.html#a24">ctype_createUser</a> (uid);
01034     }
01035 
01036   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01037     {
01038       recordFunctionType (globtab-&gt;entries[uid]);
01039     }
01040 
01041   <font class="keywordflow">return</font> ret;
01042 }
01043 
01044 uentry
<a name="l01045"></a><a class="code" href="usymtab_c.html#a56">01045</a> <a class="code" href="usymtab_c.html#a56">usymtab_supReturnTypeEntry</a> (<font class="comment">/*@only@*/</font> uentry e)
01046   <font class="comment">/*@globals globtab, filetab@*/</font>
01047   <font class="comment">/*@modifies globtab@*/</font>
01048 {
01049   usymId uid;
01050   
01051   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a166">uentry_isAbstractDatatype</a> (e))
01052     {
01053       uid = <a class="code" href="usymtab_c.html#a57">usymtab_supAbstractTypeEntry</a> (e, FALSE);
01054     }
01055   <font class="keywordflow">else</font>
01056     {
01057       uid = usymtab_supEntryAux (globtab, e, FALSE);
01058     }
01059   
01060   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01061     {
01062       recordFunctionType (globtab-&gt;entries[uid]);
01063     }
01064 
01065     <font class="keywordflow">return</font> (globtab-&gt;entries[uid]);
01066 }
01067 
01068 usymId
<a name="l01069"></a><a class="code" href="usymtab_c.html#a57">01069</a> <a class="code" href="usymtab_c.html#a57">usymtab_supAbstractTypeEntry</a> (<font class="comment">/*@only@*/</font> uentry e, <font class="keywordtype">bool</font> dodef)
01070   <font class="comment">/*@globals globtab, filetab@*/</font>
01071   <font class="comment">/*@modifies globtab, e@*/</font>
01072 {
01073   usymId uid;
01074   uid = usymtab_supEntryAux (globtab, e, FALSE);
01075 
01076   <font class="keywordflow">if</font> (dodef)
01077     {
01078       uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (uid);
01079       <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (ue, uid);
01080     }
01081 
01082   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ACCESSMODULE))
01083     {
01084       <a class="code" href="context_c.html#a66">context_addFileAccessType</a> (uid);
01085     }
01086 
01087   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01088     {
01089       recordFunctionType (globtab-&gt;entries[uid]);
01090     }
01091 
01092   <font class="keywordflow">return</font> (uid);
01093 }
01094 
01095 <font class="preprocessor"># ifndef NOLCL</font>
01096 <font class="preprocessor"></font>usymId
<a name="l01097"></a><a class="code" href="usymtab_c.html#a58">01097</a> <a class="code" href="usymtab_c.html#a58">usymtab_supExposedTypeEntry</a> (<font class="comment">/*@only@*/</font> uentry e, <font class="keywordtype">bool</font> dodef)
01098   <font class="comment">/*@globals globtab, filetab@*/</font>
01099   <font class="comment">/*@modifies globtab, e@*/</font>
01100 {
01101   usymId uid;
01102 
01103   uid = usymtab_supEntryAux (globtab, e, FALSE);
01104 
01105   <font class="keywordflow">if</font> (dodef)
01106     {
01107       uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (uid);
01108 
01109       <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (ue, uid);
01110     }
01111 
01112   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01113     {
01114       recordFunctionType (globtab-&gt;entries[uid]);
01115     }
01116 
01117   <font class="keywordflow">return</font> (uid);
01118 }
01119 <font class="preprocessor"># endif</font>
01120 <font class="preprocessor"></font>
01121 ctype
<a name="l01122"></a><a class="code" href="usymtab_c.html#a59">01122</a> <a class="code" href="usymtab_c.html#a59">usymtab_supForwardTypeEntry</a> (<font class="comment">/*@only@*/</font> uentry e)
01123   <font class="comment">/*@globals globtab, filetab@*/</font>
01124   <font class="comment">/*@modifies globtab, e@*/</font>
01125 {
01126   usymId uid = usymtab_supEntryAux (globtab, e, FALSE);
01127   uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (uid);
01128 
01129     <a class="code" href="uentry_c.html#a225">uentry_setDatatype</a> (ue, uid);
01130 
01131   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01132     {
01133       recordFunctionType (globtab-&gt;entries[uid]);
01134     }
01135 
01136   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (ue));
01137 }
01138 
01139 <font class="keywordtype">void</font>
<a name="l01140"></a><a class="code" href="usymtab_c.html#a60">01140</a>   <a class="code" href="usymtab_c.html#a60">usymtab_supEntrySref</a> (uentry e)
01141   <font class="comment">/*@globals utab, globtab, filetab@*/</font>
01142   <font class="comment">/*@modifies utab, globtab, e@*/</font>
01143 {
01144   sRef old = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (e);
01145 
01146   
01147   <font class="keywordflow">if</font> (sRef_isType (old))
01148     {
01149       uentry ue = usymtab_supEntryReturnAux (utab, e, TRUE);
01150 
01151       <font class="comment">/*@access uentry@*/</font>
01152       <font class="keywordflow">if</font> (uentry_isValid (ue)) 
01153         {
01154           sRef uref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
01155 
01156           <a class="code" href="sRef_c.html#a147">sRef_mergeStateQuiet</a> (uref, old); 
01157           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (uref);
01158         }
01159       <font class="comment">/*@noaccess uentry@*/</font>
01160     }
01161   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isKnown (old))
01162     {
01163       <a class="code" href="usymtab_c.html#a50">usymtab_supEntry</a> (e);
01164     }
01165   <font class="keywordflow">else</font>
01166     {
01167       (<font class="keywordtype">void</font>) usymtab_supEntryAux (utab, e, TRUE);
01168     }
01169 }
01170 
<a name="l01171"></a><a class="code" href="usymtab_c.html#a61">01171</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (<font class="comment">/*@only@*/</font> uentry e)
01172   <font class="comment">/*@globals globtab, filetab@*/</font>
01173   <font class="comment">/*@modifies globtab, filetab, e@*/</font>
01174 {
01175   usymId uid;
01176 
01177   DPRINTF ((<font class="stringliteral">"Sup global entry: %s"</font>, uentry_unparse (e)));
01178 
01179   uid = usymtab_supEntryAux (globtab, e, FALSE);
01180 
01181   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> ())
01182     {
01183       recordFunctionType (globtab-&gt;entries[uid]);
01184     }
01185 }
01186 
01187 uentry
<a name="l01188"></a><a class="code" href="usymtab_c.html#a62">01188</a>   <a class="code" href="usymtab_c.html#a62">usymtab_supReturnFileEntry</a> (<font class="comment">/*@only@*/</font> uentry e)
01189   <font class="comment">/*@globals filetab, globtab@*/</font>
01190   <font class="comment">/*@modifies filetab, globtab, e@*/</font>
01191 {
01192   llassert (filetab != usymtab_undefined);
01193   DPRINTF ((<font class="stringliteral">"File entry: %s"</font>, uentry_unparse (e)));
01194   <font class="keywordflow">return</font> (usymtab_supEntryReturnAux (filetab, e, FALSE));
01195 }
01196 
01197 <font class="comment">/*</font>
01198 <font class="comment">** observers</font>
01199 <font class="comment">*/</font>
01200 
01201 <font class="keywordtype">bool</font>
<a name="l01202"></a><a class="code" href="usymtab_c.html#a63">01202</a> <a class="code" href="usymtab_c.html#a63">usymtab_inDeepScope</a> () <font class="comment">/*@globals utab@*/</font>
01203 {
01204   <font class="keywordflow">return</font> (utab-&gt;lexlevel &gt; paramsScope);
01205 }
01206 
01207 <font class="keyword">static</font> <font class="keywordtype">int</font>
01208 usymtab_getIndex (<font class="comment">/*@notnull@*/</font> usymtab s, cstring k)<font class="keyword"></font>
01209 <font class="keyword"></font>{
01210   <font class="keywordtype">int</font> i;
01211 
01212   <font class="keywordflow">if</font> (s-&gt;htable != NULL)
01213     {
01214       i = <a class="code" href="hashTable_c.html#a22">hashTable_lookup</a> (s-&gt;htable, k);
01215 
01216       <font class="keywordflow">return</font> i;
01217     }
01218   <font class="keywordflow">else</font>
01219     {
01220       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
01221         {
01222           uentry current = s-&gt;entries[i];
01223 
01224           <font class="keywordflow">if</font> (!uentry_isUndefined (current) 
01225               &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (uentry_rawName (current), k))
01226             {
01227               <font class="keywordflow">return</font> i;
01228             }
01229         }
01230 
01231       <font class="keywordflow">return</font> NOT_FOUND;
01232     }
01233 }
01234 
01235 <font class="keyword">static</font> uentry
01236 usymtab_fetchIndex (<font class="comment">/*@notnull@*/</font> usymtab s, <font class="keywordtype">int</font> i)<font class="keyword"></font>
01237 <font class="keyword"></font>{
01238   llassert (i &gt;= 0 &amp;&amp; i &lt; s-&gt;nentries);
01239   <font class="keywordflow">return</font> (s-&gt;entries[i]);
01240 }
01241 
01242 usymId
<a name="l01243"></a><a class="code" href="usymtab_c.html#a64">01243</a> <a class="code" href="usymtab_c.html#a64">usymtab_getTypeId</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
01244 {
01245   usymId uid = usymtab_getIndex (globtab, k);
01246 
01247   <font class="keywordflow">if</font> (uid == NOT_FOUND) <font class="keywordflow">return</font> USYMIDINVALID;
01248 
01249   <font class="keywordflow">if</font> (!(<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (usymtab_getTypeEntry (uid)))) {
01250     <font class="keywordflow">return</font> USYMIDINVALID;
01251   }
01252 
01253   <font class="keywordflow">return</font> uid;
01254 }
01255 
01256 <font class="comment">/*@dependent@*/</font> uentry
<a name="l01257"></a><a class="code" href="usymtab_c.html#a65">01257</a> <a class="code" href="usymtab_c.html#a65">usymtab_lookupStructTag</a> (cstring k)<font class="keyword"></font>
01258 <font class="keyword"></font>{
01259   cstring sname = <a class="code" href="structNames_c.html#a8">makeStruct</a> (k);
01260   uentry ue = <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (sname);
01261     <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
01262   <font class="keywordflow">return</font> (ue);
01263 }
01264 
01265 <font class="comment">/*@dependent@*/</font> uentry
<a name="l01266"></a><a class="code" href="usymtab_c.html#a66">01266</a> <a class="code" href="usymtab_c.html#a66">usymtab_lookupUnionTag</a> (cstring k)<font class="keyword"></font>
01267 <font class="keyword"></font>{
01268   cstring uname = <a class="code" href="structNames_c.html#a9">makeUnion</a> (k);
01269   uentry res = <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (uname);
01270 
01271   <a class="code" href="cstring_c.html#a27">cstring_free</a> (uname);
01272   <font class="keywordflow">return</font> res;
01273 }
01274 
01275 <font class="comment">/*@dependent@*/</font> uentry
<a name="l01276"></a><a class="code" href="usymtab_c.html#a67">01276</a> <a class="code" href="usymtab_c.html#a67">usymtab_lookupEnumTag</a> (cstring k)<font class="keyword"></font>
01277 <font class="keyword"></font>{
01278   cstring ename = <a class="code" href="structNames_c.html#a10">makeEnum</a> (k);
01279   uentry res = <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (ename);
01280 
01281   <a class="code" href="cstring_c.html#a27">cstring_free</a> (ename);
01282   <font class="keywordflow">return</font> res;
01283 }
01284 
01285 usymId
<a name="l01286"></a><a class="code" href="usymtab_c.html#a68">01286</a> <a class="code" href="usymtab_c.html#a68">usymtab_getId</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
01287 {
01288   usymId uid = usymtab_getIndex (globtab, k);
01289   uentry ue;
01290 
01291   <font class="keywordflow">if</font> (uid == NOT_FOUND)
01292     {
01293       <font class="keywordflow">return</font> USYMIDINVALID;
01294     }
01295 
01296   ue = <a class="code" href="usymtab_c.html#a70">usymtab_getGlobalEntry</a> (uid);
01297 
01298   <font class="keywordflow">if</font> (uentry_isPriv (ue))
01299     {
01300       <font class="keywordflow">return</font> USYMIDINVALID;
01301     }
01302 
01303   <font class="keywordflow">return</font> uid;
01304 }
01305 
01306 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> uentry 
01307 usymtab_getEntryAux (<font class="comment">/*@notnull@*/</font> usymtab s, usymId uid)<font class="keyword"></font>
01308 <font class="keyword"></font>{
01309   llassert (uid != USYMIDINVALID);
01310  
01311   <font class="keywordflow">if</font> (uid &lt; 0 || uid &gt;= s-&gt;nentries)
01312     {
01313       llcontbug (message (<font class="stringliteral">"usymtab_getEntry: out of range: level = %d [%d]"</font>,
01314                           s-&gt;lexlevel, uid));
01315       <font class="keywordflow">return</font> uentry_undefined;
01316     }
01317 
01318   llassertprint (uentry_isValid (s-&gt;entries[uid]),
01319                  (<font class="stringliteral">"entry undefined: %d"</font>, uid));
01320 
01321   <font class="keywordflow">return</font> s-&gt;entries[uid];
01322 }
01323 
01324 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@observer@*/</font> uentry 
<a name="l01325"></a><a class="code" href="usymtab_c.html#a70">01325</a>   <a class="code" href="usymtab_c.html#a70">usymtab_getGlobalEntry</a> (usymId uid)
01326   <font class="comment">/*@globals utab, globtab@*/</font>
01327 {
01328   <font class="keywordflow">if</font> (dbgfree) <font class="keywordflow">return</font> (uentry_undefined);
01329   
01330   <font class="keywordflow">if</font> (utab-&gt;lexlevel &gt; paramsScope)
01331     {
01332       <font class="comment">/* need to do this the awkward way, since it could be in conditional scope */</font>
01333      <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (uentry_rawName (globtab-&gt;entries[uid])));
01334     }
01335   <font class="keywordflow">else</font>
01336     {
01337       <font class="keywordflow">return</font> (globtab-&gt;entries[uid]);
01338     }
01339 }
01340 
01341 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
<a name="l01342"></a><a class="code" href="usymtab_c.html#a71">01342</a>   <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (usymId uid)
01343   <font class="comment">/*@globals globtab@*/</font>
01344 {
01345   <font class="keywordflow">if</font> (dbgload)
01346     {
01347       <font class="keywordflow">if</font> (uid &gt;= 0 &amp;&amp; uid &lt; globtab-&gt;nentries)
01348         {
01349           <font class="keywordflow">return</font> (globtab-&gt;entries[uid]);
01350         }
01351       <font class="keywordflow">else</font>
01352         {
01353           <font class="keywordflow">return</font> (uentry_undefined);
01354         }
01355     }
01356   <font class="keywordflow">else</font>
01357     {
01358       llassert (uid &gt;= 0 &amp;&amp; uid &lt; globtab-&gt;nentries);
01359       
01360       <font class="keywordflow">return</font> (globtab-&gt;entries[uid]);
01361     }
01362 }
01363 
01364 <font class="comment">/*</font>
01365 <font class="comment">** in load files</font>
01366 <font class="comment">*/</font>
01367 
01368 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
<a name="l01369"></a><a class="code" href="usymtab_c.html#a72">01369</a>   <a class="code" href="usymtab_c.html#a72">usymtab_getTypeEntrySafe</a> (usymId uid)
01370   <font class="comment">/*@globals globtab@*/</font>
01371 {
01372   <font class="keywordflow">if</font> (uid &lt; 0 || uid &gt;= globtab-&gt;nentries)
01373     {
01374       <font class="keywordflow">return</font> uentry_undefined;
01375     }
01376 
01377       <font class="keywordflow">return</font> (globtab-&gt;entries[uid]);
01378 }
01379 
01380 <font class="keywordtype">bool</font>
<a name="l01381"></a><a class="code" href="usymtab_c.html#a73">01381</a>   <a class="code" href="usymtab_c.html#a73">usymtab_isBoolType</a> (usymId uid)
01382   <font class="comment">/*@globals globtab@*/</font>
01383 {
01384   llassert (uid &gt;= 0 &amp;&amp; uid &lt; globtab-&gt;nentries);
01385 
01386   <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (uentry_rawName (globtab-&gt;entries[uid]),
01387                          <a class="code" href="context_c.html#a246">context_getBoolName</a> ()));
01388 }
01389  
01390 cstring
<a name="l01391"></a><a class="code" href="usymtab_c.html#a74">01391</a> <a class="code" href="usymtab_c.html#a74">usymtab_getTypeEntryName</a> (usymId uid)
01392    <font class="comment">/*@globals globtab@*/</font>
01393 {
01394   uentry ue;
01395 
01396   <font class="keywordflow">if</font> (dbgfree)
01397     {
01398       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;freetype&gt;"</font>));
01399     }
01400 
01401   ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (uid);
01402 
01403   <font class="keywordflow">if</font> (dbgload &amp;&amp; !uentry_isValid (ue))
01404     {
01405       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;missing type: %d&gt;"</font>, uid));
01406     }
01407 
01408   llassertprint (uentry_isValid (ue), (<font class="stringliteral">"type undefined: %d"</font>, uid));
01409 
01410   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue));
01411 }
01412 
01413 <font class="keyword">static</font> <font class="keywordtype">void</font>
01414 usymtab_rehash (<font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
01415 <font class="keyword"></font>{
01416   <font class="keywordtype">int</font> i;
01417   
01418   <font class="keywordflow">if</font> (s-&gt;htable != NULL)
01419     {
01420       <a class="code" href="hashTable_c.html#a12">hashTable_free</a> (s-&gt;htable);
01421     }
01422   
01423   s-&gt;htable = <a class="code" href="hashTable_c.html#a17">hashTable_create</a> (LLHASHSIZE);
01424 
01425   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
01426     {
01427       <a class="code" href="hashTable_c.html#a21">hashTable_insert</a> (s-&gt;htable, uentry_rawName (s-&gt;entries[i]), i);
01428     }
01429 }
01430 
01431 <font class="comment">/*</font>
01432 <font class="comment">** superficial copy of usymtab</font>
01433 <font class="comment">**</font>
01434 <font class="comment">** DO copy spec entries </font>
01435 <font class="comment">*/</font>
01436 
01437 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> usymtab
01438 usymtab_shallowCopy (<font class="comment">/*@notnull@*/</font> usymtab s) <font class="comment">/*@*/</font>
01439 {
01440   usymtab copytab = usymtab_createRoot ();
01441   <font class="keywordtype">int</font> i;
01442 
01443   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
01444     {
01445       usymtab_addEntryBase (copytab, s-&gt;entries[i]);
01446     }
01447 
01448   <font class="keywordflow">return</font> copytab;
01449 }
01450 
01451 <font class="keyword">static</font> <font class="keywordtype">void</font>
01452 usymtab_shallowFree (<font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
01453 <font class="keyword"></font>{
01454   <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (s-&gt;aliases);
01455   refTable_free (s-&gt;reftable, s-&gt;nentries);
01456   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;entries);
01457   <font class="comment">/*@-compdestroy@*/</font> <a class="code" href="general_c.html#a0">sfree</a> (s); <font class="comment">/*@=compdestroy@*/</font>
01458 }
01459 
01460 <font class="comment">/*</font>
01461 <font class="comment">** converts usymId from old table to sorted one</font>
01462 <font class="comment">*/</font>
01463 
01464 usymId 
<a name="l01465"></a><a class="code" href="usymtab_c.html#a78">01465</a>   <a class="code" href="usymtab_c.html#a78">usymtab_convertId</a> (usymId uid)
01466   <font class="comment">/*@globals oldtab, utab@*/</font>
01467 {
01468   uentry ue;
01469   usymId ret;
01470   cstring name;
01471 
01472   llassert (usymtab_isDefined (oldtab));
01473 
01474   ue = usymtab_getEntryAux (oldtab, uid);
01475 
01476   llassertprint (uentry_isValid (ue), (<font class="stringliteral">"convertId: undefined: %d"</font>, uid));
01477 
01478   name = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue);
01479 
01480   ret = usymtab_getIndex (utab, name);
01481 
01482   llassertprint (ret != USYMIDINVALID, (<font class="stringliteral">"convertId: return is invalid"</font>));
01483 
01484   <font class="keywordflow">return</font> (ret);
01485 }
01486 
01487 <font class="keywordtype">void</font>
<a name="l01488"></a><a class="code" href="usymtab_c.html#a79">01488</a> <a class="code" href="usymtab_c.html#a79">usymtab_prepareDump</a> (<font class="keywordtype">void</font>)
01489    <font class="comment">/*@globals oldtab, utab@*/</font>
01490    <font class="comment">/*@modifies oldtab, utab@*/</font>
01491 {
01492   llassert (usymtab_inGlobalScope ());
01493 
01494   llassert (oldtab == usymtab_undefined);
01495 
01496   oldtab = usymtab_shallowCopy (utab);
01497 
01498   <font class="comment">/* </font>
01499 <font class="comment">     alpha compare - make sure order is same on different platforms</font>
01500 <font class="comment">     error messages appear in same order </font>
01501 <font class="comment">  */</font>
01502 
01503   qsort (utab-&gt;entries, (size_t)utab-&gt;nentries, 
01504          <font class="keyword">sizeof</font> (*utab-&gt;entries), (int (*)(<font class="keyword">const</font> <font class="keywordtype">void</font> *, <font class="keyword">const</font> <font class="keywordtype">void</font> *)) uentry_xcomparealpha);
01505 
01506   usymtab_rehash (utab);
01507 }
01508 
01509 <font class="keywordtype">void</font>
<a name="l01510"></a><a class="code" href="usymtab_c.html#a80">01510</a>   <a class="code" href="usymtab_c.html#a80">usymtab_dump</a> (FILE *fout)
01511   <font class="comment">/*@globals utab, oldtab@*/</font>
01512 {
01513   <font class="keywordtype">int</font> i;
01514   <font class="keywordtype">bool</font> neednl = FALSE;
01515   uentry lastentry = uentry_undefined;
01516   ekind lastekind = KINVALID;
01517   <font class="keywordtype">int</font> linelen = 0;
01518 
01519   <font class="comment">/*</font>
01520 <font class="comment">  ** must call prepareDump first</font>
01521 <font class="comment">  */</font>
01522 
01523   llassert (oldtab != usymtab_undefined);
01524 
01525   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
01526     {
01527       uentry thisentry = utab-&gt;entries[i];
01528       ekind  thisekind = <a class="code" href="uentry_c.html#a191">uentry_getKind</a> (thisentry);
01529 
01530       
01531       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a188">uentry_hasRealName</a> (thisentry)) {
01532         <font class="keywordflow">if</font> (thisekind != lastekind)
01533           {
01534             <font class="keywordflow">if</font> (neednl)
01535               {
01536                 check (fputc (<font class="charliteral">'\n'</font>, fout) == (<font class="keywordtype">int</font>) <font class="charliteral">'\n'</font>);
01537               }
01538             
01539             neednl = FALSE;
01540             lastentry = uentry_undefined;
01541             fprintf (fout, <font class="stringliteral">"*%d (%s)\n"</font>, ekind_toInt (thisekind),  
01542                      <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (ekind_capName (thisekind)));
01543             lastekind = thisekind;
01544             linelen = 0;
01545           }
01546         
01547         <font class="keywordflow">if</font> (uentry_isInvalid (lastentry) || !<a class="code" href="uentry_c.html#a131">uentry_equiv</a> (lastentry, thisentry)
01548             || (linelen &gt; (MAX_DUMP_LINE_LENGTH - (2 * MAX_NAME_LENGTH))))
01549           {
01550             cstring cdump = <a class="code" href="uentry_c.html#a152">uentry_dump</a> (thisentry);
01551             
01552             lastentry = thisentry;
01553             <font class="keywordflow">if</font> (neednl)
01554               {
01555                 check (fputc (<font class="charliteral">'\n'</font>, fout) == (<font class="keywordtype">int</font>) <font class="charliteral">'\n'</font>);
01556                 linelen = 0;
01557               }
01558             
01559             linelen += <a class="code" href="cstring_c.html#a30">cstring_length</a> (cdump);
01560             
01561             <font class="comment">/* no new line here! */</font>
01562             <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a30">cstring_length</a> (cdump) &gt; 0) 
01563               {
01564                 check (fputs (cstring_toCharsSafe (cdump), fout) != EOF);
01565               }
01566             
01567             <a class="code" href="cstring_c.html#a27">cstring_free</a> (cdump);
01568             neednl = TRUE;
01569           }
01570         <font class="keywordflow">else</font>
01571           {
01572             cstring cdump = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (thisentry);
01573                     linelen += <a class="code" href="cstring_c.html#a30">cstring_length</a> (cdump);
01574             fprintf (fout, <font class="stringliteral">"#%s"</font>, cstring_toCharsSafe (cdump));
01575           }
01576       }
01577     }
01578 
01579   <font class="keywordflow">if</font> (neednl)
01580     {
01581       check (fputc (<font class="charliteral">'\n'</font>, fout) == (<font class="keywordtype">int</font>) <font class="charliteral">'\n'</font>);
01582     }
01583 }
01584 
<a name="l01585"></a><a class="code" href="usymtab_c.html#a81">01585</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a81">usymtab_load</a> (FILE *f)
01586   <font class="comment">/*@globals utab, globtab@*/</font>
01587   <font class="comment">/*@modifies utab, *f@*/</font>
01588 {
01589   <font class="keywordtype">char</font> *s = <a class="code" href="general_c.html#a29">mstring_create</a> (MAX_DUMP_LINE_LENGTH);
01590   <font class="keywordtype">char</font> *os = s;
01591   ekind kind = KINVALID;
01592   fileloc loc = g_currentloc;
01593   <font class="keywordtype">char</font> c;
01594   uentry ue;
01595 
01596   dbgload = TRUE;
01597 
01598   llassert (utab == globtab);
01599   llassert (utab-&gt;nentries == 0);
01600 
01601   <font class="keywordflow">while</font> (fgets (s, MAX_DUMP_LINE_LENGTH, f) != NULL 
01602          &amp;&amp; *s == <font class="charliteral">';'</font>)
01603     {
01604       ; <font class="comment">/* ignore ;-comments */</font>
01605     }
01606 
01607   <font class="keywordflow">while</font> (s != NULL &amp;&amp; *s != <font class="charliteral">';'</font>)
01608     {
01609       
01610       <font class="keywordflow">if</font> (*s == <font class="charliteral">'*'</font>)
01611         {
01612           s++;
01613           kind = <a class="code" href="ekind_c.html#a0">ekind_fromInt</a> (getInt (&amp;s));
01614 
01615                   <font class="keywordflow">goto</font> nextiter;
01616         }
01617 
01618       <font class="keywordflow">if</font> (*s == <font class="charliteral">'$'</font>)
01619         {
01620           llfatalerror
01621             (cstring_makeLiteral 
01622              (<font class="stringliteral">"Library is in obsolete format.  Use lclint +whichlib "</font>
01623               <font class="stringliteral">"to see which library is being loaded."</font>));
01624         }
01625 
01626       ue = <a class="code" href="uentry_c.html#a151">uentry_undump</a> (kind, loc, &amp;s);
01627       DPRINTF ((<font class="stringliteral">"Load: %s"</font>, uentry_unparseFull (ue)));
01628 
01629       <font class="keywordflow">if</font> (uentry_isValid (ue))
01630         {       
01631           ue = usymtab_addEntryBase (utab, ue);
01632           <font class="comment">/*@-branchstate@*/</font> 
01633         } 
01634       <font class="comment">/*@=branchstate@*/</font>
01635 
01636       <font class="comment">/*</font>
01637 <font class="comment">      ** now, any other names are the same uentry</font>
01638 <font class="comment">      */</font>
01639 
01640       <font class="keywordflow">while</font> (*(s++) == <font class="charliteral">'#'</font>)
01641         {
01642           cstring name = cstring_fromCharsO (getWord (&amp;s));
01643           uentry nue = <a class="code" href="uentry_c.html#a224">uentry_nameCopy</a> (name, ue);
01644 
01645           DPRINTF ((<font class="stringliteral">"Name copy: %s"</font>, uentry_unparseFull (nue)));
01646           usymtab_addEntryBase (utab, nue);
01647         }
01648 
01649       <font class="keywordflow">while</font> ((c = *s) != <font class="charliteral">'\0'</font> &amp;&amp; (c !=<font class="charliteral">'\n'</font>))
01650         {
01651           <font class="keywordflow">if</font> (c != <font class="charliteral">' '</font> || c != <font class="charliteral">'\t'</font>) 
01652             {
01653               llbuglit (<font class="stringliteral">"Junk in load file"</font>);
01654             }
01655 
01656           s++;
01657         }
01658 
01659     nextiter:
01660       s = fgets (os, MAX_DUMP_LINE_LENGTH, f);
01661     }
01662 
01663   dbgload = FALSE;
01664   <a class="code" href="general_c.html#a0">sfree</a> (os);
01665 }
01666 
01667 <font class="comment">/*</font>
01668 <font class="comment">** file scope for static variables</font>
01669 <font class="comment">*/</font>
01670 
01671 <font class="keywordtype">void</font>
<a name="l01672"></a><a class="code" href="usymtab_c.html#a82">01672</a> <a class="code" href="usymtab_c.html#a82">usymtab_enterFile</a> ()
01673   <font class="comment">/*@globals utab, globtab, filetab@*/</font>
01674   <font class="comment">/*@modifies filetab@*/</font>
01675 {
01676   llassert (utab == globtab);
01677 
01678 <font class="preprocessor">  # if 0</font>
01679 <font class="preprocessor"></font>  <font class="comment">/* check globals */</font>
01680   
01681   usymtab_entries (globtab, ue)<font class="keyword"></font>
01682 <font class="keyword">    </font>{
01683       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a272">sRef_hasDerived</a> (uentry_getSref (ue)))
01684         {
01685           fprintf (g_msgstream, <font class="stringliteral">"Derived Global: %s\n"</font>, uentry_unparse (ue));
01686           fprintf (g_msgstream, <font class="stringliteral">"sRef: %s\n"</font>, sRef_unparseFull (ue-&gt;sref));
01687         }
01688     } end_usymtab_entries ;
01689 
01690 <font class="preprocessor">  # endif</font>
01691 <font class="preprocessor"></font>
01692   <a class="code" href="usymtab_c.html#a84">usymtab_enterScope</a> ();
01693   filetab = utab;
01694 }
01695 
01696 <font class="keywordtype">void</font>
<a name="l01697"></a><a class="code" href="usymtab_c.html#a83">01697</a> <a class="code" href="usymtab_c.html#a83">usymtab_exitFile</a> ()
01698    <font class="comment">/*@globals utab, filetab@*/</font>
01699    <font class="comment">/*@modifies filetab, utab@*/</font>
01700 {
01701   
01702   llassert (utab-&gt;lexlevel == 1);
01703 
01704   <a class="code" href="usymtab_c.html#a108">usymtab_exitScope</a> (exprNode_undefined);
01705   filetab = NULL;
01706 }
01707 
01708 <font class="keywordtype">void</font>
<a name="l01709"></a><a class="code" href="usymtab_c.html#a84">01709</a> <a class="code" href="usymtab_c.html#a84">usymtab_enterScope</a> ()
01710   <font class="comment">/*@globals utab, globtab, filetab@*/</font>
01711   <font class="comment">/*@modifies utab@*/</font>
01712 {
01713   usymtab t = usymtab_create (US_NORMAL, utab, TRUE);
01714           
01715   <font class="comment">/* unconditional scope: optimize to avoid copy */</font>
01716   t-&gt;aliases = <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (utab-&gt;aliases); 
01717   utab = t;
01718   
01719   llassert (usymtab_isDefined (t-&gt;env));
01720   
01721   <font class="keywordflow">if</font> (t-&gt;env-&gt;lexlevel == paramsScope &amp;&amp; <a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
01722     {
01723       noshadowerror = TRUE;
01724       usymtab_handleParams ();
01725       noshadowerror = FALSE;
01726     }
01727 }
01728 
01729 <font class="comment">/*</font>
01730 <font class="comment">** setup external references:</font>
01731 <font class="comment">**    o only, unique params alias external args</font>
01732 <font class="comment">**    o other params may alias anything of their type</font>
01733 <font class="comment">*/</font>
01734  
01735 <font class="keyword">static</font> <font class="keywordtype">void</font>
01736 usymtab_handleParams (<font class="keywordtype">void</font>)
01737   <font class="comment">/*@globals utab, globtab, filetab@*/</font>
01738   <font class="comment">/*@modifies utab, globtab@*/</font>
01739 {
01740   usymtab ptab = utab-&gt;env;
01741   uentry fcn = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
01742 
01743   
01744   usymtab_entries (ptab, param)<font class="keyword"></font>
01745 <font class="keyword">    </font>{
01746       uentry ue;
01747 
01748       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (param))
01749         {
01750           sRef uref;
01751           sRef pref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (param);
01752           
01753           llassertprint (uentry_isAnyParam (param), 
01754                          (<font class="stringliteral">"not param: %s"</font>, 
01755                           <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (param)));
01756           
01757           
01758           ue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (fixParamName (uentry_rawName (param)),
01759                                     <a class="code" href="uentry_c.html#a197">uentry_getType</a> (param),
01760                                     <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (uentry_whereDeclared (param)),
01761                                     FALSE);
01762 
01763           <a class="code" href="uentry_c.html#a268">uentry_copyState</a> (ue, param);
01764           <a class="code" href="uentry_c.html#a218">uentry_setRefParam</a> (ue);
01765           
01766           ue = <a class="code" href="usymtab_c.html#a53">usymtab_supEntrySrefReturn</a> (ue);
01767                   
01768           <font class="comment">/* must be after supercede! */</font>
01769           
01770           <font class="keywordflow">if</font> (!sRef_stateKnown (pref))
01771             {
01772               <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (ue, SS_DEFINED);
01773               <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (param, SS_DEFINED);
01774             }
01775           <font class="keywordflow">else</font>
01776             {
01777               <font class="keywordflow">if</font> (sRef_isStateSpecial (pref))
01778                 {
01779                   <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (ue, SS_ALLOCATED);
01780                 }
01781               <font class="keywordflow">else</font>
01782                 {
01783                   <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (ue, sRef_getDefState (pref));
01784                 }
01785             }
01786 
01787           uref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
01788           
01789           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a349">sRef_isStack</a> (uref))
01790             {
01791               alkind pkind = sRef_getAliasKind (pref);
01792 
01793               <font class="keywordflow">if</font> (alkind_isKnown (pkind) &amp;&amp; !alkind_isLocal (pkind)
01794                   &amp;&amp; !alkind_isStack (pkind))
01795                 {
01796                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (uref, pkind, fileloc_undefined);
01797                   <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (uref, pkind);
01798                 }
01799               <font class="keywordflow">else</font>
01800                 {
01801                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (uref, AK_IMPTEMP, fileloc_undefined);
01802                   <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (uref, AK_IMPTEMP);
01803 
01804                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a176">uentry_isOut</a> (param))
01805                     {
01806                       ;
01807                     }
01808                   <font class="keywordflow">else</font>
01809                     {
01810                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (uref, fileloc_undefined);
01811                     }
01812                 }
01813 
01814                     }
01815 
01816                   <a class="code" href="usymtab_c.html#a151">usymtab_addMustAlias</a> (uref, pref);   
01817 
01818           <font class="keywordflow">if</font> (!(<a class="code" href="uentry_c.html#a67">uentry_isOnly</a> (param) || <a class="code" href="uentry_c.html#a68">uentry_isUnique</a> (param)))
01819             {
01820               sRef s = <a class="code" href="sRef_c.html#a145">sRef_makeExternal</a> (uref);
01821 
01822                       <a class="code" href="usymtab_c.html#a151">usymtab_addMustAlias</a> (uref, s);   
01823             }
01824           
01825           <font class="keywordflow">if</font> (sRef_isKillRef (pref))
01826             {
01827               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (uref, AK_NEWREF, fileloc_undefined);
01828               <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (uref, AK_KILLREF);
01829             }
01830           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isRefCounted (uref))
01831             {
01832               <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (uref, AK_REFCOUNTED);
01833             }
01834           <font class="keywordflow">else</font>
01835             {
01836               <font class="comment">/* was AK_UNIQUE */</font>
01837               <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (uref, AK_LOCAL);
01838             }
01839         }
01840       <font class="keywordflow">else</font>
01841         {
01842                 }
01843     } end_usymtab_entries;
01844 
01845 
01846   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a143">uentry_hasSpecialClauses</a> (fcn))
01847     {
01848       specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (fcn);
01849 
01850       specialClauses_preElements (clauses, cl)<font class="keyword"></font>
01851 <font class="keyword">        </font>{
01852           sRefSet refs = specialClause_getRefs (cl);
01853           sRefMod modf = <a class="code" href="specialClauses_c.html#a12">specialClause_getEntryFunction</a> (cl);
01854 
01855           
01856           sRefSet_elements (refs, el)<font class="keyword"></font>
01857 <font class="keyword">            </font>{
01858               sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
01859               
01860               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (base))
01861                 {
01862                   ; <font class="comment">/* nothing to do before */</font>
01863                 }
01864               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (base))
01865                 {
01866                   <font class="keywordflow">if</font> (modf != NULL)
01867                     {
01868                       sRef sb = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (el);
01869                       sRefSet aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (sb);
01870                       
01871                                       modf (sb, fileloc_undefined);
01872                                       
01873                       sRefSet_elements (aliases, sr)<font class="keyword"></font>
01874 <font class="keyword">                        </font>{
01875                                                   modf (sr, fileloc_undefined);
01876                                                 } end_sRefSet_elements ;
01877 
01878                       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
01879                     }
01880                 }
01881               <font class="keywordflow">else</font>
01882                 {
01883                   <font class="keywordflow">if</font> (sRef_isValid (base))
01884                     {
01885                       BADBRANCH;
01886                     }
01887                 }
01888             } end_sRefSet_elements ;      
01889         } end_specialClauses_preElements ;
01890     }
01891   }
01892   
01893 <font class="keywordtype">void</font>
<a name="l01894"></a><a class="code" href="usymtab_c.html#a85">01894</a> <a class="code" href="usymtab_c.html#a85">usymtab_enterFunctionScope</a> (uentry fcn)
01895   <font class="comment">/*@globals utab, filetab, globtab@*/</font>
01896   <font class="comment">/*@modifies utab@*/</font>
01897 {
01898   usymtab t = usymtab_create (US_NORMAL, utab, TRUE);
01899 
01900   <font class="keywordflow">if</font> (utab-&gt;lexlevel != fileScope)
01901     {
01902       <font class="keywordflow">if</font> (utab-&gt;lexlevel &gt; fileScope)
01903         {
01904           <a class="code" href="llerror_c.html#a69">llparseerror</a> (cstring_makeLiteral (<font class="stringliteral">"New function scope inside function."</font>));
01905           
01906           <font class="keywordflow">while</font> (utab-&gt;lexlevel &gt; fileScope)
01907             {
01908               <font class="comment">/*@i@*/</font> utab = usymtab_dropEnv (utab);
01909               <font class="comment">/*@-branchstate@*/</font>
01910             }
01911           <font class="comment">/*@=branchstate@*/</font>
01912         }
01913       <font class="keywordflow">else</font>
01914         {
01915           <a class="code" href="llerror_c.html#a43">llfatalbug</a> (cstring_makeLiteral (<font class="stringliteral">"New function not inside file."</font>));
01916         }
01917     <font class="comment">/*@-branchstate@*/</font> } <font class="comment">/*@=branchstate@*/</font>
01918 
01919   globSet_allElements (uentry_getGlobs (fcn), el)
01920     {
01921       
01922       <font class="keywordflow">if</font> (sRef_isUndefGlob (el))
01923         {
01924           <font class="keywordtype">int</font> index = <a class="code" href="sRef_c.html#a166">sRef_getScopeIndex</a> (el);
01925           sRef sr = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (el);
01926           fileloc loc = <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (fcn);
01927           
01928           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (el))
01929             {
01930               ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (el);
01931               uentry ue;
01932               
01933               llassert (usymtab_isDefined (filetab));
01934 
01935               ue = usymtab_fetchIndex (filetab, index);
01936               
01937               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (ct) || <a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (ct))
01938                 {
01939                   <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (sr, loc);
01940                 }
01941               <font class="keywordflow">else</font>
01942                 {
01943                   <a class="code" href="sRef_c.html#a197">sRef_setUndefined</a> (sr, loc);
01944                 }
01945             }
01946           <font class="keywordflow">else</font>
01947             {
01948               uentry ue = globtab-&gt;entries[index];
01949               ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
01950               
01951               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ct) || ctype_isSU (ct))
01952                 {
01953                   <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (sr, loc);
01954                 }
01955               <font class="keywordflow">else</font>
01956                 {
01957                   <a class="code" href="sRef_c.html#a197">sRef_setUndefined</a> (sr, loc);
01958                 }
01959             }
01960         }
01961       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (el))
01962         {
01963           sRef sr = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (el);
01964           fileloc loc = <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (fcn);
01965           
01966           <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (sr, loc);
01967         }
01968       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isPartial (el))
01969         {
01970           sRef sr = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (el);
01971           fileloc loc = <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (fcn);
01972 
01973           <a class="code" href="sRef_c.html#a209">sRef_setPartial</a> (sr, loc);
01974         }
01975       <font class="keywordflow">else</font>
01976         {
01977           <font class="comment">/* defined */</font> ;
01978         }
01979     } end_globSet_allElements;
01980 
01981   utab = t;
01982 }
01983 
01984 <font class="keyword">static</font> <font class="keywordtype">void</font>
01985 usymtab_caseBranch (<font class="keywordtype">void</font>)
01986   <font class="comment">/*@modifies utab@*/</font>
01987 {
01988   usymtab t = usymtab_create (US_CBRANCH, utab, FALSE);
01989   utab = t;
01990 }
01991 
01992 <font class="keywordtype">void</font>
<a name="l01993"></a><a class="code" href="usymtab_c.html#a87">01993</a> <a class="code" href="usymtab_c.html#a87">usymtab_switchBranch</a> (<font class="comment">/*@unused@*/</font> exprNode s)
01994   <font class="comment">/*@modifies utab@*/</font>
01995 {
01996   usymtab t = usymtab_create (US_SWITCH, utab, FALSE);
01997 
01998   t-&gt;aliases = <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (utab-&gt;aliases);
01999     utab = t;
02000 }
02001 
02002 <font class="keywordtype">void</font>
<a name="l02003"></a><a class="code" href="usymtab_c.html#a88">02003</a> <a class="code" href="usymtab_c.html#a88">usymtab_trueBranch</a> (<font class="comment">/*@only@*/</font> guardSet guards)
02004   <font class="comment">/*@modifies utab@*/</font>
02005 {
02006   usymtab t = usymtab_create (US_TBRANCH, utab, FALSE);
02007 
02008   <font class="comment">/*</font>
02009 <font class="comment">  ** not true! (could be in a macro)</font>
02010 <font class="comment">  **</font>
02011 <font class="comment">  ** llassertprint (utab-&gt;lexlevel &gt; paramsScope,</font>
02012 <font class="comment">  ** ("not in scope: %s", usymtab_unparseLocal ()));</font>
02013 <font class="comment">  **</font>
02014 <font class="comment">  */</font>
02015 
02016   <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (t-&gt;guards);
02017   t-&gt;guards = guards;
02018 
02019     <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (t-&gt;aliases);
02020   t-&gt;aliases = <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (utab-&gt;aliases);
02021   
02022     utab = t;
02023 }
02024 
02025 <font class="comment">/*</font>
02026 <font class="comment">** consider,</font>
02027 <font class="comment">** </font>
02028 <font class="comment">**   { int a; if (...) a = 3; &lt; a may be undefined here!</font>
02029 <font class="comment">**</font>
02030 <font class="comment">*/</font>
02031 
02032 <font class="keywordtype">void</font>
<a name="l02033"></a><a class="code" href="usymtab_c.html#a89">02033</a> <a class="code" href="usymtab_c.html#a89">usymtab_popTrueBranch</a> (exprNode pred, exprNode expr, clause cl)<font class="keyword"></font>
02034 <font class="keyword"></font>{
02035   <font class="comment">/*</font>
02036 <font class="comment">  ** add a false branch</font>
02037 <font class="comment">  ** (could be done more efficiently as a special case, but</font>
02038 <font class="comment">  ** it is better to only maintain one version of the code)</font>
02039 <font class="comment">  */</font>
02040 
02041   <a class="code" href="usymtab_c.html#a99">usymtab_altBranch</a> (guardSet_invert (exprNode_getGuards (pred)));
02042   <a class="code" href="usymtab_c.html#a97">usymtab_popBranches</a> (pred, expr, exprNode_undefined, TRUE, cl);
02043 }
02044 
02045 <font class="keywordtype">void</font>
<a name="l02046"></a><a class="code" href="usymtab_c.html#a90">02046</a> <a class="code" href="usymtab_c.html#a90">usymtab_popCaseBranch</a> () <font class="comment">/*@modifies utab@*/</font>
02047 {
02048   llassert (utab-&gt;kind == US_CBRANCH);
02049   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02050 }
02051 
02052 <font class="keywordtype">void</font>
<a name="l02053"></a><a class="code" href="usymtab_c.html#a91">02053</a> <a class="code" href="usymtab_c.html#a91">usymtab_popTrueExecBranch</a> (exprNode pred, exprNode expr, clause cl)<font class="keyword"></font>
02054 <font class="keyword"></font>{
02055   <font class="comment">/*</font>
02056 <font class="comment">  ** add a false branch that must return --- that is,</font>
02057 <font class="comment">  ** the true branch is always executed!</font>
02058 <font class="comment">  */</font>
02059   
02060   <a class="code" href="usymtab_c.html#a99">usymtab_altBranch</a> (guardSet_invert (exprNode_getGuards (pred)));
02061   <a class="code" href="usymtab_c.html#a97">usymtab_popBranches</a> (pred, expr, exprNode_makeMustExit (), FALSE, cl);
02062 }
02063 
02064 <font class="keywordtype">void</font>
<a name="l02065"></a><a class="code" href="usymtab_c.html#a92">02065</a> <a class="code" href="usymtab_c.html#a92">usymtab_popOrBranch</a> (exprNode pred, exprNode expr)
02066   <font class="comment">/*@modifies utab@*/</font>
02067 {
02068   <font class="keywordtype">bool</font> mustReturn;
02069   usymtab env = utab-&gt;env;
02070   usymtab otab = utab;
02071   <font class="keywordtype">int</font> i = 0;
02072 
02073   llassert (env != NULL);
02074 
02075   <font class="keywordflow">if</font> (exprNode_isError (expr))
02076     {
02077       mustReturn = FALSE;
02078     }
02079   <font class="keywordflow">else</font>
02080     {
02081       mustReturn = <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (expr);
02082     }
02083 
02084   
02085   llassert (utab-&gt;kind == US_TBRANCH);
02086 
02087   <font class="comment">/*</font>
02088 <font class="comment">  ** merge each entry in table with its original</font>
02089 <font class="comment">  ** unless execution cannot continue after this branch</font>
02090 <font class="comment">  */</font>
02091 
02092   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02093     {
02094       uentry current = utab-&gt;entries[i];
02095       uentry old = usymtab_lookupAux (env, uentry_rawName (current));
02096 
02097       <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, exprNode_loc (expr), 
02098                          mustReturn, FALSE, TRUE, ORCLAUSE);
02099     }
02100   
02101   
02102   <font class="keywordflow">if</font> (mustReturn)
02103     {
02104       env-&gt;guards = <a class="code" href="guardSet_c.html#a9">guardSet_levelUnionFree</a> (env-&gt;guards, 
02105                                              guardSet_invert (exprNode_getGuards (pred)), 
02106                                              env-&gt;lexlevel);
02107     }
02108   <font class="keywordflow">else</font>
02109     {
02110       env-&gt;aliases = <a class="code" href="aliasTable_c.html#a18">aliasTable_levelUnion</a> (env-&gt;aliases, otab-&gt;aliases, env-&gt;lexlevel);
02111     }
02112  
02113   <font class="comment">/* env is now utab */</font>
02114   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02115 }
02116 
02117 <font class="comment">/*</font>
02118 <font class="comment">** case syntax in C is very unrestricted.  This is unfortunate.</font>
02119 <font class="comment">**</font>
02120 <font class="comment">** A switch case is ended either by a new case or default, or</font>
02121 <font class="comment">** a close } that may close the switch or some other control</font>
02122 <font class="comment">** structure.  </font>
02123 <font class="comment">*/</font>
02124 
02125 <font class="keywordtype">bool</font>
<a name="l02126"></a><a class="code" href="usymtab_c.html#a93">02126</a> <a class="code" href="usymtab_c.html#a93">usymtab_newCase</a> (<font class="comment">/*@unused@*/</font> exprNode pred, exprNode last)
02127   <font class="comment">/*@modifies utab@*/</font>
02128 {
02129   <font class="keywordtype">bool</font> mustBreak = usymtab_mustBreak (utab);
02130   <font class="keywordtype">bool</font> mustReturn = usymtab_mustEscape (utab);
02131   usymtab stab = utab;
02132 
02133   <font class="comment">/*</font>
02134 <font class="comment">  ** Find last case (or outer switch)</font>
02135 <font class="comment">  */</font>
02136 
02137   <font class="keywordflow">while</font> (stab-&gt;kind != US_CBRANCH &amp;&amp; stab-&gt;kind != US_SWITCH)
02138     {
02139       stab = stab-&gt;env;
02140       llassert (stab != GLOBAL_ENV);
02141     }
02142 
02143   <font class="comment">/* ??? */</font>
02144 
02145   <font class="keywordflow">while</font> (stab-&gt;kind == US_CBRANCH)
02146     {
02147       stab = stab-&gt;env;
02148       llassert (stab != GLOBAL_ENV);
02149     }
02150   
02151   <font class="comment">/*</font>
02152 <font class="comment">  ** if its a fall through case, merge in outside entries and last case.</font>
02153 <font class="comment">  **</font>
02154 <font class="comment">  ** e.g.,</font>
02155 <font class="comment">  **        ...</font>
02156 <font class="comment">  **        switch</font>
02157 <font class="comment">  **          case 1: x = 3; &lt;fall through&gt;</font>
02158 <font class="comment">  **          case 2: &lt;&lt; x may not be defined</font>
02159 <font class="comment">  **</font>
02160 <font class="comment">  */</font>
02161 
02162   <font class="keywordflow">if</font> (!mustBreak &amp;&amp; !mustReturn &amp;&amp; utab-&gt;kind == US_CBRANCH)
02163     {
02164       llassert (stab-&gt;kind == US_SWITCH || stab-&gt;kind == US_NORMAL);
02165 
02166       usymtab_entries (utab, ue)  <font class="comment">/* but, keep track of used variables */</font>
02167         {
02168           uentry old = usymtab_lookupAux (stab, uentry_rawName (ue));
02169 
02170           llassert (uentry_isValid (old));
02171 
02172           <font class="comment">/* modifies ue, not old */</font>
02173           
02174           <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (ue, old, exprNode_loc (last),
02175                              FALSE, FALSE, TRUE, CASECLAUSE); 
02176         } end_usymtab_entries;
02177 
02178       utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a18">aliasTable_levelUnion</a> (utab-&gt;aliases, 
02179                                              stab-&gt;aliases, utab-&gt;lexlevel);
02180       
02181       <font class="comment">/* </font>
02182 <font class="comment">      ** No need for a new branch.</font>
02183 <font class="comment">      */</font>
02184       
02185       <font class="keywordflow">return</font> FALSE;
02186     }
02187   <font class="keywordflow">else</font>
02188     {
02189       usymtab_caseBranch ();
02190       <font class="comment">/*@-mustfree@*/</font> <font class="comment">/*&lt; utab-&gt;aliases &gt;*/</font>
02191       utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (stab-&gt;aliases);
02192       <font class="comment">/*@=mustfree@*/</font>
02193       
02194       <font class="keywordflow">return</font> TRUE;
02195     }
02196 }
02197 
02198 <font class="comment">/*</font>
02199 <font class="comment">** for &amp;&amp; (both pred and expr are executed)</font>
02200 <font class="comment">*/</font>
02201 
02202 <font class="keywordtype">void</font>
<a name="l02203"></a><a class="code" href="usymtab_c.html#a94">02203</a> <a class="code" href="usymtab_c.html#a94">usymtab_popAndBranch</a> (exprNode pred, <font class="comment">/*@unused@*/</font> exprNode expr)
02204   <font class="comment">/*@modifies utab@*/</font>
02205 {
02206   usymtab env = utab-&gt;env;
02207   usymtab otab= utab;
02208   <font class="keywordtype">int</font> i = 0;
02209 
02210     llassert (utab-&gt;kind == US_TBRANCH);
02211 
02212   <font class="comment">/*</font>
02213 <font class="comment">  ** merge each entry in table with its original</font>
02214 <font class="comment">  ** unless execution cannot continue after this branch</font>
02215 <font class="comment">  */</font>
02216 
02217   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02218     {
02219       uentry current = utab-&gt;entries[i];
02220       sRef   tref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (current);
02221       uentry old = usymtab_lookupAux (env, uentry_rawName (current));
02222       sRef   oref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (old);
02223 
02224       <font class="comment">/* note that is current is in a nested branch,</font>
02225 <font class="comment">         it may create a "new" old entry. */</font>
02226 
02227       llassert (uentry_isValid (old));
02228       <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, exprNode_loc (expr), 
02229                          FALSE, FALSE, TRUE, ANDCLAUSE);
02230 
02231       <font class="comment">/*</font>
02232 <font class="comment">      ** if is it defined by the second clause, then it should be defined.</font>
02233 <font class="comment">      */</font>
02234 
02235       <font class="keywordflow">if</font> (sRef_isAnyDefined (tref)
02236           &amp;&amp; (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (oref) || <a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (oref)))
02237         {
02238           <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (oref, g_currentloc);
02239         }
02240     }
02241 
02242   utab-&gt;guards = <a class="code" href="guardSet_c.html#a9">guardSet_levelUnionFree</a> (utab-&gt;guards, 
02243                                           guardSet_invert (exprNode_getGuards (pred)), 
02244                                           utab-&gt;lexlevel);
02245   utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a18">aliasTable_levelUnion</a> (utab-&gt;aliases, otab-&gt;aliases, utab-&gt;lexlevel);
02246 
02247   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02248 
02249   }
02250 
02251 <font class="comment">/*</font>
02252 <font class="comment">** Stack should be [ US_CBRANCH+ US_SWITCH ]</font>
02253 <font class="comment">** Only branches which do not return (except possibly the last branch) are included.</font>
02254 <font class="comment">**</font>
02255 <font class="comment">** Conditionally merge state from all CBRANCHes.</font>
02256 <font class="comment">**</font>
02257 <font class="comment">** If allpaths is TRUE, then all possible executions go through some switch </font>
02258 <font class="comment">** case, and the original scope is not merged.</font>
02259 <font class="comment">*/</font>
02260 
02261 <font class="keywordtype">void</font>
<a name="l02262"></a><a class="code" href="usymtab_c.html#a95">02262</a> <a class="code" href="usymtab_c.html#a95">usymtab_exitSwitch</a> (<font class="comment">/*@unused@*/</font> exprNode sw, <font class="keywordtype">bool</font> allpaths)
02263   <font class="comment">/*@modifies utab@*/</font>
02264 {
02265   usymtab ttab = utab;
02266   usymtab stab = ttab;
02267   usymtab ltab = ttab;
02268   <font class="keywordtype">bool</font> lastMustReturn = usymtab_mustEscape (utab);
02269   <font class="keywordtype">int</font> i;
02270   
02271     
02272   <font class="keywordflow">while</font> (stab-&gt;kind == US_CBRANCH)
02273     {
02274       stab = stab-&gt;env;
02275       llassert (stab != GLOBAL_ENV);
02276     }
02277 
02278   <font class="keywordflow">while</font> (stab-&gt;kind == US_NORMAL)
02279     {
02280       stab = stab-&gt;env;
02281       llassert (stab != GLOBAL_ENV);
02282     }
02283 
02284   llassert (stab-&gt;kind == US_SWITCH);
02285 
02286   <font class="comment">/* go to the scope outside the switch (US_SWITCH is just a marker! */</font>
02287   stab = stab-&gt;env; 
02288   llassert (stab != GLOBAL_ENV);
02289 
02290   
02291   ttab = ttab-&gt;env;
02292   llassert (usymtab_isDefined (ttab));
02293   
02294   <font class="keywordflow">if</font> (ttab-&gt;kind == US_CBRANCH)
02295     {
02296       <font class="comment">/* was quietPlainExitScope --- but, can't free it yet! */</font>
02297       utab = utab-&gt;env;
02298       llassert (utab != GLOBAL_ENV);
02299 
02300       <font class="keywordflow">while</font> (ttab-&gt;kind == US_CBRANCH)
02301         {
02302           <font class="comment">/*</font>
02303 <font class="comment">          ** (from popTrueBranch)</font>
02304 <font class="comment">          */</font>      
02305           
02306           <font class="keywordtype">bool</font> mustReturn = usymtab_mustEscape (ttab);
02307           <font class="keywordtype">bool</font> mustBreak = usymtab_mustBreak (ttab);
02308           
02309           usymtab_entries (ttab, current)<font class="keyword"></font>
02310 <font class="keyword">            </font>{
02311               uentry old = <font class="comment">/*@-compmempass@*/</font> usymtab_lookupAux (ltab, uentry_rawName (current));
02312                            <font class="comment">/*@=compmempass@*/</font> 
02313               
02314               <font class="comment">/*</font>
02315 <font class="comment">              ** note that is this is in a nested branch,</font>
02316 <font class="comment">              ** it may create a "new" old entry. </font>
02317 <font class="comment">              */</font>
02318            
02319               <font class="keywordflow">if</font> (uentry_isValid (old))
02320                 {
02321                   <font class="keywordflow">if</font> (lastMustReturn)
02322                     {
02323                       <a class="code" href="uentry_c.html#a272">uentry_mergeUses</a> (current, old);
02324                       <a class="code" href="uentry_c.html#a271">uentry_setState</a> (old, current);
02325                     }
02326                   <font class="keywordflow">else</font>
02327                     {
02328                       <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, exprNode_loc (sw),
02329                                          mustReturn, FALSE, TRUE, SWITCHCLAUSE);
02330                     }
02331                 }
02332               <font class="keywordflow">else</font>
02333                 {
02334                   ;
02335                 }
02336             } end_usymtab_entries;
02337           
02338           <font class="comment">/*</font>
02339 <font class="comment">          ** if entry is not in symbol table for this case, merge with pre-switch</font>
02340 <font class="comment">          ** table</font>
02341 <font class="comment">          */</font>
02342           
02343           <font class="keywordflow">if</font> (!mustReturn &amp;&amp; !mustBreak)
02344             {
02345               usymtab_entries (stab, current)<font class="keyword"></font>
02346 <font class="keyword">                </font>{
02347                   <font class="keywordflow">if</font> (usymtab_getIndex (ttab, uentry_rawName (current)) == NOT_FOUND)
02348                     {
02349                       uentry old = <font class="comment">/*@-compmempass@*/</font>
02350                         usymtab_lookupAux (ltab, uentry_rawName (current));
02351                       <font class="comment">/*@=compmempass@*/</font>
02352 
02353                       llassert (uentry_isValid (old));
02354                       <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, exprNode_loc (sw),
02355                                          FALSE, FALSE, TRUE, SWITCHCLAUSE);
02356                     }
02357                 } end_usymtab_entries;
02358             }
02359           
02360           ltab-&gt;env = ttab-&gt;env; 
02361           ttab = ltab-&gt;env;
02362 
02363           <font class="comment">/*</font>
02364 <font class="comment">          ** Suprious error, becuase of environments.</font>
02365 <font class="comment">          */</font>
02366 
02367           <font class="comment">/*@i1@*/</font> utab = ltab;
02368 
02369           lastMustReturn = FALSE;
02370           <font class="comment">/*@-branchstate@*/</font> 
02371         }
02372     }
02373   <font class="comment">/*@=branchstate@*/</font>
02374 
02375   <font class="comment">/*</font>
02376 <font class="comment">  ** now, there is one US_CBRANCH.  Merge this with the stab.</font>
02377 <font class="comment">  */</font>
02378   
02379     
02380   <font class="keywordflow">for</font> (i = 0; i &lt; ltab-&gt;nentries; i++)
02381     {
02382       uentry current = ltab-&gt;entries[i];
02383       uentry old = usymtab_lookupAux (stab, uentry_rawName (current));
02384       
02385       <font class="comment">/* note that is this is in a nested branch,</font>
02386 <font class="comment">         it may create a "new" old entry. */</font>
02387       
02388          
02389       <font class="keywordflow">if</font> (uentry_isValid (old))
02390         {
02391           <font class="keywordflow">if</font> (allpaths)
02392             {
02393               <a class="code" href="uentry_c.html#a272">uentry_mergeUses</a> (current, old);
02394               <a class="code" href="uentry_c.html#a271">uentry_setState</a> (old, current);
02395             }
02396           <font class="keywordflow">else</font>
02397             {
02398               <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, exprNode_loc (sw), 
02399                                  FALSE, FALSE, TRUE, SWITCHCLAUSE);
02400             }
02401         }
02402       <font class="keywordflow">else</font>
02403         {
02404                 }
02405     }
02406   
02407   <font class="comment">/*</font>
02408 <font class="comment">  ** exit the switch</font>
02409 <font class="comment">  */</font>
02410   
02411   
02412   <font class="comment">/*</font>
02413 <font class="comment">  ** switch may or may not be followed by a new scope</font>
02414 <font class="comment">  */</font>
02415 
02416   <font class="keywordflow">if</font> (utab-&gt;kind == US_SWITCH)
02417     {
02418       <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();  
02419     }
02420   <font class="keywordflow">else</font>
02421     {
02422       <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02423       llassert (utab-&gt;kind == US_SWITCH);
02424       <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();   
02425     }
02426 
02427   }
02428 
02429 <font class="keyword">static</font> <font class="keywordtype">void</font> 
02430 updateNullState (sRef el, <font class="comment">/*@notnull@*/</font> usymtab ttab, 
02431                  <font class="comment">/*@notnull@*/</font> usymtab ftab, <font class="keywordtype">bool</font> trueGuard)<font class="keyword"></font>
02432 <font class="keyword"></font>{
02433   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
02434   <font class="keywordtype">int</font> level = <a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (base);
02435   
02436         
02437     
02438   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (base))
02439     {
02440       usymId index = <a class="code" href="sRef_c.html#a166">sRef_getScopeIndex</a> (base);
02441       uentry ue = usymtab_getRefTab (ttab, level, index);
02442 
02443       <font class="keywordflow">if</font> (!uentry_isLset (ue)) 
02444         {
02445           sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
02446 
02447           <font class="keywordflow">if</font> (trueGuard)
02448             {
02449               <a class="code" href="sRef_c.html#a317">sRef_setDerivNullState</a> (sr, el, NS_NOTNULL);
02450             }
02451           <font class="keywordflow">else</font> 
02452             {
02453               <font class="keywordflow">if</font> (!<a class="code" href="guardSet_c.html#a17">guardSet_isGuarded</a> (ttab-&gt;guards, el) 
02454                   &amp;&amp; !<a class="code" href="sRef_c.html#a350">sRef_isNotNull</a> (sr))
02455                 {
02456                   <a class="code" href="sRef_c.html#a317">sRef_setDerivNullState</a> (sr, el, NS_DEFNULL);
02457                                 }
02458             }
02459         }
02460       <font class="keywordflow">else</font>
02461         {
02462                 }
02463       
02464       ue = usymtab_getRefTab (ftab, level, index);
02465       
02466       <font class="keywordflow">if</font> (!uentry_isLset (ue)) 
02467         {
02468           sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
02469           
02470           
02471           <font class="keywordflow">if</font> (!trueGuard) <font class="comment">/* yikes!  forgot the ! */</font>
02472             {
02473               <a class="code" href="sRef_c.html#a317">sRef_setDerivNullState</a> (sr, el, NS_NOTNULL);
02474             }
02475           <font class="keywordflow">else</font> 
02476             {
02477               
02478               <font class="keywordflow">if</font> (!<a class="code" href="guardSet_c.html#a17">guardSet_isGuarded</a> (ftab-&gt;guards, el)
02479                   &amp;&amp; !<a class="code" href="sRef_c.html#a350">sRef_isNotNull</a> (sr))
02480                 {
02481                   <a class="code" href="sRef_c.html#a317">sRef_setDerivNullState</a> (sr, el, NS_DEFNULL);
02482                                 }
02483             }
02484         }
02485       <font class="keywordflow">else</font>
02486         {
02487                 }
02488       
02489           }
02490 
02491       }
02492 
02493 <font class="keywordtype">void</font>
<a name="l02494"></a><a class="code" href="usymtab_c.html#a97">02494</a> <a class="code" href="usymtab_c.html#a97">usymtab_popBranches</a> (exprNode pred, exprNode tbranch, exprNode fbranch, 
02495                      <font class="keywordtype">bool</font> isOpt, clause cl)
02496      <font class="comment">/*@modifies utab@*/</font>
02497 {
02498   <font class="keywordtype">int</font> i = 0;
02499   usymtab ftab = utab;
02500   usymtab ttab = utab-&gt;env;
02501 
02502   fileloc loc;
02503   usymtab env;
02504   guardSet guards = exprNode_getGuards (pred);
02505   sRefSet tguards = <a class="code" href="guardSet_c.html#a2">guardSet_getTrueGuards</a> (guards);
02506   sRefSet fguards = <a class="code" href="guardSet_c.html#a4">guardSet_getFalseGuards</a> (guards);
02507   <font class="keywordtype">bool</font> mustReturnT = <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (tbranch);
02508   <font class="keywordtype">bool</font> mustReturnF = <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (fbranch);
02509   
02510   <font class="keywordflow">if</font> (exprNode_isDefined (fbranch))
02511     {
02512       loc = <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fbranch);
02513     }
02514   <font class="keywordflow">else</font>
02515     {
02516       loc = <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (tbranch);
02517     }
02518 
02519   llassert (usymtab_isDefined (ttab));
02520   
02521   env = ttab-&gt;env;
02522   
02523   llassert (usymtab_isDefined (env));
02524   llassert (ftab-&gt;kind == US_FBRANCH);
02525   llassert (ttab-&gt;kind == US_TBRANCH);
02526 
02527   <font class="comment">/*</font>
02528 <font class="comment">  ** For each element that is true guarded (i.e., if (x != NULL)) </font>
02529 <font class="comment">  **          make x = null in false branch,</font>
02530 <font class="comment">  **          and x = notnull in true branch.</font>
02531 <font class="comment">  **          unless x was set locally in that branch.</font>
02532 <font class="comment">  ** For each element that is false guarded (x == NULL) </font>
02533 <font class="comment">  **          make x = null in true, notnull in false.</font>
02534 <font class="comment">  **                      </font>
02535 <font class="comment">  ** For each element that is either guarded (pred(x)) </font>
02536 <font class="comment">  **     </font>
02537 <font class="comment">  */</font>
02538   
02539   sRefSet_allElements (tguards, el)<font class="keyword"></font>
02540 <font class="keyword">    </font>{
02541       updateNullState (el, ttab, ftab, TRUE);
02542     } end_sRefSet_allElements;
02543     
02544   sRefSet_allElements (fguards, el)<font class="keyword"></font>
02545 <font class="keyword">    </font>{
02546       updateNullState (el, ttab, ftab, FALSE);
02547     } end_sRefSet_allElements;
02548 
02549   <font class="comment">/*</font>
02550 <font class="comment">  ** </font>
02551 <font class="comment">  ** if an entry is in both true and false, merge the entries,</font>
02552 <font class="comment">  ** then replace original with new state.</font>
02553 <font class="comment">  **</font>
02554 <font class="comment">  ** if an entry is in one table, merge it with the original.</font>
02555 <font class="comment">  */</font>
02556     
02557   <font class="keywordflow">for</font> (i = 0; i &lt; ftab-&gt;nentries; i++)
02558     {
02559       uentry fthis = ftab-&gt;entries[i];
02560       uentry old = usymtab_lookupAux (env, uentry_rawName (fthis));
02561       <font class="keywordtype">int</font>    tindex = usymtab_getIndex (ttab, uentry_rawName (fthis));
02562       
02563       <font class="keywordflow">if</font> (uentry_isUndefined (old))
02564         {
02565           <font class="comment">/* possible entry was added as an undefined id */</font>
02566           <font class="keywordflow">continue</font>;
02567         }
02568       
02569       <font class="keywordflow">if</font> (tindex != NOT_FOUND)
02570         {
02571           uentry tthis = ttab-&gt;entries[tindex];
02572           
02573           <font class="comment">/* note that is this is in a nested branch,</font>
02574 <font class="comment">             it may create a "new" old entry. */</font>
02575           
02576           <font class="keywordflow">if</font> (!mustReturnF)
02577             {
02578               <font class="keywordflow">if</font> (!mustReturnT)
02579                 {
02580                   
02581                   <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (fthis, tthis, loc,
02582                                      mustReturnT, FALSE, FALSE, cl);
02583                 }
02584               <font class="keywordflow">else</font>
02585                 {
02586                   <a class="code" href="uentry_c.html#a272">uentry_mergeUses</a> (fthis, tthis);
02587                 }
02588               
02589               <a class="code" href="uentry_c.html#a271">uentry_setState</a> (old, fthis);
02590               
02591               <font class="comment">/*@-mustfree@*/</font> 
02592             } 
02593           <font class="comment">/*@=mustfree@*/</font>
02594           <font class="keywordflow">else</font>
02595             {
02596               <a class="code" href="uentry_c.html#a271">uentry_setState</a> (old, tthis);
02597               <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, fthis, loc, mustReturnF, 
02598                                  TRUE, FALSE, cl);
02599             }
02600           
02601           ttab-&gt;entries[tindex] = uentry_undefined;
02602           <a class="code" href="uentry_c.html#a238">uentry_free</a> (tthis);
02603         }
02604       <font class="keywordflow">else</font>
02605         {
02606           <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, fthis, loc, mustReturnF, TRUE, FALSE, cl);
02607         }
02608     }
02609 
02610   <font class="keywordflow">for</font> (i = 0; i &lt; ttab-&gt;nentries; i++)
02611     {
02612       uentry current = ttab-&gt;entries[i];
02613       
02614       <font class="keywordflow">if</font> (!uentry_isUndefined (current)) 
02615         {
02616           uentry old = usymtab_lookupAux (env, uentry_rawName (current));
02617 
02618           llassertprint (!uentry_isUndefined (old), (<font class="stringliteral">"name: &lt;%s&gt;"</font>, 
02619                                                      <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (current)));
02620           <font class="keywordflow">if</font> (mustReturnF)
02621             {
02622               <a class="code" href="uentry_c.html#a272">uentry_mergeUses</a> (current, old); 
02623               <a class="code" href="uentry_c.html#a271">uentry_setState</a> (old, current);
02624             }
02625           <font class="keywordflow">else</font>
02626             {
02627               <font class="comment">/*</font>
02628 <font class="comment">              ** assumes false branch is a fall-through if</font>
02629 <font class="comment">              ** fbranch is not defined.  This is true, unless</font>
02630 <font class="comment">              ** where was some greivous error in processing</font>
02631 <font class="comment">              ** the else branch of an if-then, in which case</font>
02632 <font class="comment">              ** this is probably the right thing to do anyway.</font>
02633 <font class="comment">              */</font>
02634 
02635               <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, loc, mustReturnT, 
02636                                  FALSE, isOpt, cl);
02637             }
02638         }
02639     }
02640 
02641   
02642   <font class="comment">/*</font>
02643 <font class="comment">  ** Plain levelUnion doesn't work, since we need to use the sRef's in env-&gt;aliases</font>
02644 <font class="comment">  ** if they are present.</font>
02645 <font class="comment">  */</font>
02646 
02647   llassert (NOALIAS (env-&gt;aliases, ttab-&gt;aliases));
02648   llassert (NOALIAS (env-&gt;aliases, ftab-&gt;aliases));
02649 
02650   <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (env-&gt;aliases);  
02651 
02652   env-&gt;aliases = <a class="code" href="aliasTable_c.html#a19">aliasTable_levelUnionNew</a> (ttab-&gt;aliases, 
02653                                            ftab-&gt;aliases, env-&gt;lexlevel);
02654 
02655   <a class="code" href="aliasTable_c.html#a21">aliasTable_fixSrefs</a> (env-&gt;aliases);
02656   
02657   <font class="comment">/* exit true and false scopes */</font>
02658   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02659   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02660   
02661   <font class="keywordflow">if</font> (mustReturnT)
02662     {
02663       utab-&gt;guards = guardSet_levelUnionFree 
02664         (utab-&gt;guards, 
02665          <a class="code" href="guardSet_c.html#a11">guardSet_invert</a> (exprNode_getGuards (pred)), 
02666          utab-&gt;lexlevel);
02667     }
02668 
02669   <font class="keywordflow">if</font> (mustReturnF)
02670     {
02671       utab-&gt;guards = <a class="code" href="guardSet_c.html#a8">guardSet_levelUnion</a> (utab-&gt;guards, 
02672                                           exprNode_getGuards (pred), 
02673                                           utab-&gt;lexlevel);
02674     }
02675 
02676   DPRINTF ((<font class="stringliteral">"Here."</font>));
02677 }
02678 
02679 <font class="keyword">static</font> <font class="keywordtype">void</font> usymtab_fixCases (<font class="keywordtype">void</font>) <font class="comment">/*@modifies utab@*/</font> {
02680   <font class="keywordflow">while</font> (utab-&gt;kind == US_CBRANCH)
02681     {
02682       <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
02683     }
02684 
02685   llassert (utab-&gt;kind != US_CBRANCH);
02686 }
02687 
02688 <font class="keywordtype">void</font>
<a name="l02689"></a><a class="code" href="usymtab_c.html#a99">02689</a> <a class="code" href="usymtab_c.html#a99">usymtab_altBranch</a> (<font class="comment">/*@only@*/</font> guardSet guards)
02690   <font class="comment">/*@modifies utab@*/</font>
02691 {
02692   usymtab t = usymtab_create (US_FBRANCH, utab, FALSE);
02693   usymtab parent = utab-&gt;env;
02694 
02695   <font class="comment">/*</font>
02696 <font class="comment">  ** If we are in a case, need to close it.  The C syntax</font>
02697 <font class="comment">  ** is very liberal, so this kludge is necessary.</font>
02698 <font class="comment">  */</font>
02699 
02700   usymtab_fixCases ();
02701 
02702   DPRINTF ((<font class="stringliteral">"Current kind: %s"</font>, usymtab_unparseStack ()));
02703   llassert (utab-&gt;kind == US_TBRANCH);
02704   llassert (parent != GLOBAL_ENV);
02705 
02706   <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (t-&gt;guards);
02707   t-&gt;guards = guards;
02708 
02709   <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (t-&gt;aliases);
02710   t-&gt;aliases = <a class="code" href="aliasTable_c.html#a15">aliasTable_copy</a> (parent-&gt;aliases);
02711     
02712   utab = t;
02713 }
02714 
02715 <font class="keywordtype">void</font>
<a name="l02716"></a><a class="code" href="usymtab_c.html#a100">02716</a> <a class="code" href="usymtab_c.html#a100">usymtab_allDefined</a> (<font class="keywordtype">void</font>)
02717    <font class="comment">/*@globals utab, globtab@*/</font>
02718 {
02719   <font class="keywordtype">int</font> i;
02720 
02721   llassert (utab == globtab);
02722 
02723   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02724     {
02725       uentry e = utab-&gt;entries[i];
02726 
02727       <font class="keywordflow">if</font> (uentry_isPriv (e))
02728         {
02729          ; <font class="comment">/* no need to define it */</font>
02730         }
02731       <font class="keywordflow">else</font>
02732         {
02733           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SPECUNDECL))
02734             {
02735               fileloc sloc = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (e);
02736               fileloc dloc = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
02737 
02738               <font class="keywordflow">if</font> (fileloc_isDefined (sloc) 
02739                   &amp;&amp; !<a class="code" href="uentry_c.html#a162">uentry_isFakeTag</a> (e)
02740                   &amp;&amp; !fileloc_isDefined (dloc))
02741                 {
02742                   voptgenerror 
02743                     (FLG_SPECUNDECL,
02744                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified but not declared"</font>,
02745                               ekind_capName (uentry_getKind (e)),
02746                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
02747                      sloc);
02748                 }
02749             }
02750           
02751           <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a211">uentry_isCodeDefined</a> (e))
02752             {
02753               fileloc dloc = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
02754               
02755               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (dloc))
02756                 {
02757                  ;
02758                 }
02759               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (fileloc_isDefined (dloc))
02760                 {
02761                   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e))
02762                     {
02763                       <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (dloc))
02764                         {
02765                           voptgenerror 
02766                             (FLG_DECLUNDEF,
02767                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q declared but not defined"</font>,
02768                                       ekind_capName (uentry_getKind (e)),
02769                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
02770                              dloc);
02771                         }
02772                     }
02773                 }
02774               <font class="keywordflow">else</font>
02775                 {
02776                   fileloc sloc = <a class="code" href="uentry_c.html#a200">uentry_whereSpecified</a> (e);
02777 
02778                   <font class="keywordflow">if</font> (fileloc_isDefined (sloc) 
02779                       &amp;&amp; !fileloc_isImport (sloc)
02780                       &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (sloc)
02781                       &amp;&amp; !fileloc_isPreproc (sloc)
02782                       &amp;&amp; !<a class="code" href="uentry_c.html#a162">uentry_isFakeTag</a> (e))
02783                     {
02784                       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (e) || uentry_isFunction (e))
02785                         {
02786                           voptgenerror 
02787                             (FLG_SPECUNDEF,
02788                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified but not declared or defined"</font>,
02789                                       ekind_capName (uentry_getKind (e)),
02790                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
02791                              sloc);
02792                         }
02793                       <font class="keywordflow">else</font>
02794                         {
02795                           voptgenerror 
02796                             (FLG_SPECUNDEF,
02797                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q specified but not defined"</font>,
02798                                       ekind_capName (uentry_getKind (e)),
02799                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e)),
02800                              sloc);
02801                         }
02802                     }
02803                 }
02804             }
02805         }
02806     }
02807 }
02808 
<a name="l02809"></a><a class="code" href="usymtab_c.html#a101">02809</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a101">usymtab_exportHeader</a> (<font class="keywordtype">void</font>)
02810      <font class="comment">/*@globals utab@*/</font>
02811 {
02812   <font class="keywordtype">int</font> i;
02813 
02814   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02815     {
02816       uentry ce = utab-&gt;entries[i];
02817 
02818       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce) 
02819           &amp;&amp; !<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ce) 
02820           &amp;&amp; !uentry_isEitherConstant (ce) &amp;&amp; !uentry_isStatic (ce)
02821           &amp;&amp; !uentry_isExternal (ce)
02822           &amp;&amp; !<a class="code" href="uentry_c.html#a108">uentry_isForward</a> (ce))
02823         {
02824           fileloc fwhere = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ce);
02825 
02826           <font class="keywordflow">if</font> (fileloc_isUndefined (fwhere)
02827               &amp;&amp; uentry_isFunction (ce))
02828             {
02829               fwhere = <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (ce);
02830             }
02831 
02832           <font class="keywordflow">if</font> (fileloc_isDefined (fwhere) 
02833               &amp;&amp; !<a class="code" href="fileloc_c.html#a43">fileloc_isHeader</a> (fwhere)
02834               &amp;&amp; !(<a class="code" href="fileloc_c.html#a42">fileloc_isSpecialFile</a> (fwhere)
02835                    &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNUSEDSPECIAL)))
02836             {
02837               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ce))
02838                 {
02839                   <font class="keywordflow">if</font> (optgenerror
02840                       (FLG_EXPORTHEADERVAR,
02841                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q exported but not declared in header file"</font>, 
02842                                 ekind_capName (uentry_getKind (ce)),
02843                                 <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
02844                        fwhere))
02845                     {
02846                       <a class="code" href="uentry_c.html#a242">uentry_showDefSpecInfo</a> (ce, fwhere);
02847                     }
02848                 }
02849               <font class="keywordflow">else</font>
02850                 {
02851                   <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ce)
02852                       &amp;&amp; !<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ce)
02853                       &amp;&amp; !<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ce))
02854                     {
02855                       <font class="keywordflow">if</font> (uentry_isFunction (ce) 
02856                           &amp;&amp; cstring_equalLit (uentry_rawName (ce), <font class="stringliteral">"main"</font>))
02857                         {
02858                           ; <font class="comment">/* no error for main */</font>
02859                         }
02860                       <font class="keywordflow">else</font>
02861                         {
02862                           <font class="keywordflow">if</font> (optgenerror
02863                               (FLG_EXPORTHEADER,
02864                                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q exported but not declared "</font>
02865                                         <font class="stringliteral">"in header file"</font>, 
02866                                         ekind_capName (uentry_getKind (ce)),
02867                                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
02868                                fwhere))
02869                             {
02870                               <a class="code" href="uentry_c.html#a242">uentry_showDefSpecInfo</a> (ce, fwhere);
02871                             }
02872                         }
02873                     }
02874                 }
02875             }
02876         }
02877     }
02878 }
02879 
<a name="l02880"></a><a class="code" href="usymtab_c.html#a102">02880</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a102">usymtab_exportLocal</a> (<font class="keywordtype">void</font>)
02881    <font class="comment">/*@globals utab@*/</font>
02882 {
02883   <font class="keywordtype">int</font> i;
02884 
02885   
02886   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02887     {
02888       uentry ce = utab-&gt;entries[i];
02889 
02890       
02891       <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce) &amp;&amp; !<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ce) 
02892           &amp;&amp; !uentry_isEitherConstant (ce) 
02893           &amp;&amp; !<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ce)
02894           &amp;&amp; !<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ce)
02895           &amp;&amp; !<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ce)
02896           &amp;&amp; uentry_isUsed (ce))
02897         {
02898           <font class="comment">/* check static uses */</font>
02899           filelocList fuses = uentry_getUses (ce);
02900           fileloc mod = <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (ce);
02901           <font class="keywordtype">bool</font> ok = filelocList_isEmpty (fuses);
02902           fileloc fwhere = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ce);
02903 
02904           <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a42">fileloc_isSpecialFile</a> (fwhere)
02905               &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNUSEDSPECIAL))
02906             {
02907               ok = TRUE; <font class="comment">/* no errors for special files */</font>
02908             }
02909           <font class="keywordflow">else</font>
02910             {
02911               filelocList_elements (fuses, uloc)<font class="keyword"></font>
02912 <font class="keyword">                </font>{
02913                   <font class="keywordflow">if</font> (fileloc_isUndefined (uloc) || !<a class="code" href="fileloc_c.html#a18">fileloc_sameModule</a> (uloc, mod))
02914                     {
02915                       ok = TRUE;
02916                       <font class="comment">/*@innerbreak@*/</font> <font class="keywordflow">break</font>;
02917                     }
02918                 } end_filelocList_elements;
02919             }
02920 
02921           <font class="keywordflow">if</font> (!ok)
02922             {
02923               <font class="keywordflow">if</font> (optgenerror
02924                   (FLG_EXPORTLOCAL,
02925                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s exported but not used outside %s: %q"</font>, 
02926                             ekind_capName (uentry_getKind (ce)),
02927                             <a class="code" href="fileloc_c.html#a10">fileloc_getBase</a> (mod),
02928                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
02929                    fwhere))
02930                 {
02931                   <a class="code" href="uentry_c.html#a242">uentry_showDefSpecInfo</a> (ce, fwhere);
02932                 }
02933             }
02934         }
02935     }
02936 }
02937 
02938 <font class="keywordtype">void</font>
<a name="l02939"></a><a class="code" href="usymtab_c.html#a103">02939</a> <a class="code" href="usymtab_c.html#a103">usymtab_allUsed</a> (<font class="keywordtype">void</font>)
02940   <font class="comment">/*@globals utab@*/</font>
02941 {
02942   <font class="keywordtype">int</font> i;
02943   <font class="keywordtype">bool</font> isFileStatic = <a class="code" href="usymtab_c.html#a138">usymtab_inFileScope</a> ();
02944   cstring last_file = cstring_undefined;
02945 
02946   <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
02947     {
02948       <font class="keywordtype">bool</font> hasError = FALSE;
02949       uentry ce = utab-&gt;entries[i];
02950       fileloc fwhere = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (ce);
02951 
02952       <font class="keywordflow">if</font> (fileloc_isUndefined (fwhere))
02953         {
02954           fwhere = <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (ce);
02955         }
02956 
02957       <font class="keywordflow">if</font> (fileloc_isInvalid (fwhere) 
02958           || <a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (fwhere) 
02959           || fileloc_isBuiltin (fwhere)
02960           || ((<a class="code" href="fileloc_c.html#a42">fileloc_isSpecialFile</a> (fwhere)
02961                || <a class="code" href="fileloc_c.html#a42">fileloc_isSpecialFile</a> (uentry_whereDefined (ce)))
02962               &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNUSEDSPECIAL)))
02963         {
02964           ;
02965         }
02966       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!uentry_wasUsed (ce) &amp;&amp; !<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ce))
02967         {
02968           cstring fname = <a class="code" href="fileloc_c.html#a35">fileloc_filename</a> (fwhere);
02969 
02970           <font class="keywordflow">if</font> (cstring_isUndefined (last_file))
02971             {
02972               last_file = fname;
02973             }
02974           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (fname, last_file))
02975             {
02976             }
02977           <font class="keywordflow">else</font>
02978             {
02979               <a class="code" href="llerror_c.html#a32">cleanupMessages</a> ();
02980               last_file = fname;
02981             } 
02982           
02983           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a170">uentry_isParam</a> (ce))
02984             {
02985               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ())
02986                 {
02987                   sRef cref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ce);
02988 
02989                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (ce))
02990                     {
02991                       ; <font class="comment">/* no checks (for now) */</font>
02992                     }
02993                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isSafe (cref))
02994                     {
02995                       ; <font class="comment">/* no error */</font>
02996                     }
02997                   <font class="keywordflow">else</font>
02998                     {
02999                       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a188">uentry_hasRealName</a> (ce))
03000                         {
03001                           hasError = 
03002                             optgenerror (FLG_MACROPARAMS,
03003                                          message (<font class="stringliteral">"Macro parameter %q not used"</font>, 
03004                                                   uentry_getName (ce)),
03005                                          fwhere);
03006                         }
03007                     }
03008                 }
03009               <font class="keywordflow">else</font> 
03010                 {
03011                   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a17">cstring_equalFree</a> (uentry_getName (ce), 
03012                                          cstring_makeLiteral (<font class="stringliteral">"..."</font>)))
03013                     {
03014                       ;
03015                     }
03016                   <font class="keywordflow">else</font>
03017                     {
03018                       hasError = optgenerror (FLG_PARAMUNUSED,
03019                                               message (<font class="stringliteral">"Parameter %q not used"</font>,
03020                                                        uentry_getName (ce)),
03021                                               fwhere);
03022                     }
03023                 }
03024             } <font class="comment">/* isParam */</font>
03025           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isFunction (ce) || <a class="code" href="uentry_c.html#a184">uentry_isIter</a> (ce))
03026             {
03027               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03028                 {
03029                   hasError = optgenerror
03030                     (FLG_FUNCUNUSED, 
03031                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q declared but not used"</font>, 
03032                               cstring_makeLiteral 
03033                               (uentry_isIter (ce) ? <font class="stringliteral">"Iterator"</font> 
03034                                : (isFileStatic ? <font class="stringliteral">"File static function"</font> : <font class="stringliteral">"Function"</font>)),
03035                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
03036                      fwhere);
03037                 }
03038             }
03039           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a185">uentry_isEndIter</a> (ce))
03040             {
03041               ; <font class="comment">/* no error (already reported for iter */</font>
03042             }
03043           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isEnumConstant (ce))
03044             {
03045               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03046                 {
03047                   hasError = optgenerror
03048                     (FLG_ENUMMEMUNUSED,
03049                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enum member %q not used"</font>, 
03050                               uentry_getName (ce)),
03051                      fwhere);
03052                 }
03053             }
03054           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (uentry_isConstant (ce))
03055             {
03056               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03057                 {
03058                   hasError = optgenerror
03059                     (FLG_CONSTUNUSED,
03060                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Constant %q declared but not used"</font>, 
03061                               uentry_getName (ce)),
03062                      fwhere);
03063                 }
03064             }
03065           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce))
03066             {
03067               <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03068                 {
03069                   hasError = optgenerror
03070                     (FLG_TYPEUNUSED,
03071                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Type %q declared but not used"</font>, 
03072                               uentry_getName (ce)),
03073                      fwhere);
03074                 }
03075             }
03076           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (ce) &amp;&amp; !<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ce))
03077             { <font class="comment">/* errors for ref params will be reported in the next scope */</font>
03078               llassertprint (uentry_isVar (ce), 
03079                              (<font class="stringliteral">"ce: %s"</font>, <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (ce)));
03080 
03081               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ce)))
03082                 {
03083                   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03084                     {
03085                       hasError = optgenerror
03086                         (FLG_FUNCUNUSED,
03087                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q declared but not used"</font>, 
03088                                   cstring_makeLiteral 
03089                                   (isFileStatic ? <font class="stringliteral">"File static function"</font> 
03090                                    : <font class="stringliteral">"Function"</font>),
03091                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
03092                          fwhere);
03093                     }
03094                 }
03095               <font class="keywordflow">else</font> 
03096                 {
03097                   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a50">fileloc_isUser</a> (fwhere))
03098                     {
03099                       
03100                       
03101                       hasError = optgenerror 
03102                         (FLG_VARUNUSED,
03103                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q declared but not used"</font>, 
03104                                   cstring_makeLiteral 
03105                                   (isFileStatic ? <font class="stringliteral">"File static variable"</font> 
03106                                    : <font class="stringliteral">"Variable"</font>), 
03107                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
03108                          fwhere);
03109                     }
03110                 }
03111             }
03112           <font class="keywordflow">else</font>
03113             {
03114               ; <font class="comment">/* no errors */</font>
03115             }
03116         } <font class="comment">/* unused */</font>
03117       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce) || <a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ce))
03118         { <font class="comment">/* check all fields */</font>
03119           ctype ct = <a class="code" href="uentry_c.html#a222">uentry_getRealType</a> (ce); 
03120 
03121           
03122           <font class="keywordflow">while</font> (ctype_isAP (ct))
03123             {
03124               ct = <a class="code" href="ctype_c.html#a112">ctype_getBaseType</a> (ct);
03125             }
03126 
03127           
03128           <font class="keywordflow">if</font> (ctype_isSU (ct))
03129             {
03130               uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ct);
03131 
03132               uentryList_elements (fields, field)<font class="keyword"></font>
03133 <font class="keyword">                </font>{
03134                   <font class="keywordflow">if</font> (!uentry_isUsed (field))
03135                     {
03136                       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (ce))
03137                         {
03138                           hasError |= optgenerror 
03139                             (FLG_FIELDUNUSED,
03140                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Field %q of %s %q declared but not used"</font>, 
03141                                       uentry_getName (field),
03142                                       cstring_makeLiteralTemp
03143                                       (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct) ? <font class="stringliteral">"structure"</font> : <font class="stringliteral">"union"</font>),
03144                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce)),
03145                              <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (field));
03146                         }
03147                       <font class="keywordflow">else</font>
03148                         {
03149                           hasError |= optgenerror 
03150                             (FLG_FIELDUNUSED,
03151                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Field %q of unnamed %s declared but not used"</font>, 
03152                                       uentry_getName (field),
03153                                       cstring_makeLiteralTemp
03154                                       (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct) ? <font class="stringliteral">"structure"</font> : <font class="stringliteral">"union"</font>)),
03155                              <a class="code" href="uentry_c.html#a203">uentry_whereEarliest</a> (field));
03156                         }
03157                       
03158                       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (field, fileloc_undefined);
03159                     }
03160                 } end_uentryList_elements;
03161             }
03162         }
03163       <font class="keywordflow">else</font>
03164         {
03165           ; <font class="comment">/* no errors */</font>
03166         }
03167 
03168       <font class="keywordflow">if</font> (hasError)
03169         {
03170           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a170">uentry_isParam</a> (ce) &amp;&amp; <a class="code" href="context_c.html#a235">context_inMacro</a> ())
03171             {
03172               <font class="keywordflow">if</font> (fileloc_isDefined (uentry_whereSpecified (ce)))
03173                 {
03174                   <a class="code" href="uentry_c.html#a249">uentry_showWhereSpecified</a> (ce);
03175                 }
03176             }
03177           <font class="keywordflow">else</font>
03178             {
03179               <a class="code" href="uentry_c.html#a242">uentry_showDefSpecInfo</a> (ce, fwhere);
03180             }
03181 
03182           <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ce, fileloc_undefined);
03183         }
03184     }
03185 }
03186 
03187 <font class="keyword">static</font> <font class="keywordtype">void</font>
03188 checkGlobalReturn (uentry glob, sRef orig)<font class="keyword"></font>
03189 <font class="keyword"></font>{
03190   sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (glob);
03191   
03192   
03193   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_GLOBSTATE))
03194     {
03195       <font class="keywordflow">if</font> (sRef_isKilledGlob (orig))
03196         {
03197           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (sr)
03198               || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (sr)
03199               || sRef_isStateUnknown (sr)
03200               || <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr))
03201             {
03202               ;
03203             }
03204           <font class="keywordflow">else</font>
03205             {
03206               ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (glob));
03207 
03208               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (ct))
03209                 {
03210                   <font class="keywordflow">if</font> (optgenerror 
03211                       (FLG_GLOBSTATE,
03212                        message 
03213                        (<font class="stringliteral">"Killed global %q not released before return"</font>,
03214                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (glob)),
03215                        g_currentloc))
03216                     {
03217                       <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (sr);
03218                                     }
03219                 }
03220               <font class="keywordflow">else</font>
03221                 {
03222                                   <a class="code" href="sRef_c.html#a60">sRef_protectDerivs</a> ();
03223                   (<font class="keywordtype">void</font>) <a class="code" href="aliasChecks_c.html#a24">checkGlobalDestroyed</a> (sr, g_currentloc);
03224                   <a class="code" href="sRef_c.html#a61">sRef_clearProtectDerivs</a> ();
03225                 }
03226             }
03227         }
03228       <font class="keywordflow">else</font>
03229         {
03230           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (sr))
03231             {
03232               <font class="keywordflow">if</font> (optgenerror (FLG_GLOBSTATE,
03233                                message 
03234                                (<font class="stringliteral">"Function returns with global %q undefined"</font>,
03235                                 uentry_getName (glob)),
03236                                g_currentloc))
03237                 {
03238                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (sr);
03239                 }
03240             }
03241           <font class="keywordflow">else</font> 
03242             {
03243               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr))
03244                 {
03245                   <font class="keywordflow">if</font> (optgenerror 
03246                       (FLG_GLOBSTATE,
03247                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns with global %q "</font>
03248                                 <font class="stringliteral">"referencing released storage"</font>,
03249                                 uentry_getName (glob)),
03250                        g_currentloc))
03251                     {
03252                       <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (sr);
03253                       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sr, SS_UNKNOWN, fileloc_undefined);
03254                     }
03255                 }
03256               
03257               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (uentry_getType (glob)) &amp;&amp;
03258                   <a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (sr) &amp;&amp; !<a class="code" href="uentry_c.html#a181">uentry_possiblyNull</a> (glob))
03259                 {
03260                   <font class="keywordflow">if</font> (optgenerror 
03261                       (FLG_GLOBSTATE,
03262                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns with non-null global %q "</font>
03263                                 <font class="stringliteral">"referencing null storage"</font>,
03264                                 uentry_getName (glob)),
03265                        g_currentloc))
03266                     {
03267                       <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (sr);
03268                     }
03269                 }
03270               <font class="keywordflow">else</font>
03271                 {
03272                   <a class="code" href="aliasChecks_c.html#a30">checkGlobReturn</a> (glob);
03273                 }
03274             }
03275         }
03276     }
03277 }
03278 
03279 <font class="comment">/*</font>
03280 <font class="comment">** remember: check alias globals</font>
03281 <font class="comment">*/</font>
03282 
<a name="l03283"></a><a class="code" href="usymtab_c.html#a105">03283</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a105">usymtab_checkFinalScope</a> (<font class="keywordtype">bool</font> isReturn)
03284   <font class="comment">/*@globals utab@*/</font>
03285 {
03286   <font class="keywordtype">bool</font> mustFree = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTFREE);
03287   <font class="keywordtype">bool</font> mustDefine = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTDEFINE);
03288   <font class="comment">/* bool mustNotAlias = context_getFlag (FLG_MUSTNOTALIAS); */</font>
03289   sRefSet checked = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
03290   usymtab stab = utab;
03291   <font class="keywordtype">int</font> i;
03292     
03293   <font class="comment">/*</font>
03294 <font class="comment">  ** need to check all scopes out to function parameters.</font>
03295 <font class="comment">  */</font>
03296 
03297   <font class="keywordflow">do</font> 
03298     {
03299       <font class="keywordflow">for</font> (i = 0; i &lt; stab-&gt;nentries; i++)
03300         {
03301           uentry ce = stab-&gt;entries[i];
03302           sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ce);
03303           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sr);
03304 
03305           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (ce)))
03306             {
03307               <font class="comment">/*@innercontinue@*/</font> <font class="keywordflow">continue</font>;
03308             }
03309 
03310           <font class="keywordflow">if</font> (mustFree)
03311             {
03312               DPRINTF ((<font class="stringliteral">"Check entry: %s"</font>, uentry_unparseFull (ce)));
03313 
03314               <font class="keywordflow">if</font> (!<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (checked, sr) &amp;&amp; !<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (rb))
03315                 {
03316                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (uentry_getType (ce))
03317                       &amp;&amp; !<a class="code" href="uentry_c.html#a174">uentry_isAnyParam</a> (ce)
03318                       &amp;&amp; !<a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (ce)
03319                       &amp;&amp; !uentry_isStatic (ce)
03320                       &amp;&amp; !<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (sr)
03321                       &amp;&amp; !<a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (sr))
03322                     {
03323                       sRefSet als = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (sr);
03324 
03325                       
03326                       <font class="keywordflow">if</font> (sRefSet_isEmpty (als))
03327                         {
03328                           <a class="code" href="aliasChecks_c.html#a25">checkLocalDestroyed</a> (sr, g_currentloc);
03329                         }
03330                       <font class="keywordflow">else</font>
03331                         {
03332                           <font class="comment">/* aliased, no problem */</font> ;
03333                         }
03334 
03335                       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (als);
03336                     }
03337                   <font class="keywordflow">else</font> <font class="keywordflow">if</font>
03338                     (!uentry_isStatic (ce)
03339                      &amp;&amp; ((sRef_isNewRef (sr))
03340                          || (((<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (sr) || <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (sr) 
03341                                || <a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (sr) || <a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (sr))
03342                               &amp;&amp; !<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr))
03343                              &amp;&amp; (!<a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (sr))
03344                              &amp;&amp; (!<a class="code" href="usymtab_c.html#a146">usymtab_isProbableNull</a> (sr)))))
03345                       {
03346                         <font class="keywordtype">bool</font> hasError = TRUE;
03347                         
03348                         <font class="comment">/*</font>
03349 <font class="comment">                        ** If its a scope exit, check if there is an alias.</font>
03350 <font class="comment">                        ** If so, make it only.  If not, there is an error.</font>
03351 <font class="comment">                        */</font>
03352                         
03353                         <font class="keywordflow">if</font> (!isReturn)
03354                           {
03355                             <font class="keywordflow">if</font> (<a class="code" href="aliasChecks_c.html#a43">canLoseReference</a> (sr, g_currentloc))
03356                               {
03357                                 hasError = FALSE;
03358                               }
03359                           }
03360                         
03361                         <font class="keywordflow">if</font> (hasError)
03362                           {
03363                             <font class="keywordflow">if</font> (sRef_hasLastReference (sr))
03364                               {
03365                                 sRef ar = <a class="code" href="sRef_c.html#a80">sRef_getAliasInfoRef</a> (sr);
03366                                 
03367                                 <font class="keywordflow">if</font> (optgenerror 
03368                                     (FLG_MUSTFREE,
03369                                      message
03370                                      (<font class="stringliteral">"Last reference %q to %s storage %qnot %q before %q"</font>,
03371                                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr),
03372                                       <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (sr)),
03373                                       <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (ar),
03374                                       cstring_makeLiteral (sRef_isKeep (sr) 
03375                                                            ? <font class="stringliteral">"transferred"</font> : <font class="stringliteral">"released"</font>),
03376                                       cstring_makeLiteral (isReturn 
03377                                                            ? <font class="stringliteral">"return"</font> : <font class="stringliteral">"scope exit"</font>)),
03378                                      g_currentloc))
03379                                   {
03380                                     <a class="code" href="sRef_c.html#a296">sRef_showRefLost</a> (sr);
03381                                   }
03382                               }
03383                             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isNewRef (sr))
03384                               {
03385                                 <font class="keywordflow">if</font> (optgenerror
03386                                     (FLG_MUSTFREE,
03387                                      message 
03388                                      (<font class="stringliteral">"%q %q not released before %q"</font>,
03389                                       cstring_makeLiteral 
03390                                       (alkind_isKillRef (sRef_getOrigAliasKind (sr))
03391                                        ? <font class="stringliteral">"Kill reference parameter"</font> : <font class="stringliteral">"New reference"</font>),
03392                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce),
03393                                       cstring_makeLiteral (isReturn
03394                                                            ? <font class="stringliteral">"return"</font> : <font class="stringliteral">"scope exit"</font>)),
03395                                      g_currentloc))
03396                                   {
03397                                     <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (sr);
03398                                   }
03399                               }
03400                             <font class="keywordflow">else</font> 
03401                               {
03402                                 <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (sRef_getType (sr)))
03403                                   {
03404                                                                     <a class="code" href="aliasChecks_c.html#a26">checkStructDestroyed</a> (sr, g_currentloc);
03405                                   }
03406                                 <font class="keywordflow">else</font>
03407                                   {
03408                                     <font class="keywordflow">if</font> (optgenerror
03409                                         (FLG_MUSTFREE,
03410                                          message 
03411                                          (<font class="stringliteral">"%s storage %q not %q before %q"</font>,
03412                                           <a class="code" href="varKinds_c.html#a14">alkind_capName</a> (sRef_getAliasKind (sr)),
03413                                           <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce),
03414                                           cstring_makeLiteral (sRef_isKeep (sr) 
03415                                                                ? <font class="stringliteral">"transferred"</font> : <font class="stringliteral">"released"</font>),
03416                                           cstring_makeLiteral (isReturn 
03417                                                                ? <font class="stringliteral">"return"</font> : <font class="stringliteral">"scope exit"</font>)),
03418                                          g_currentloc))
03419                                       {
03420                                         <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (sr);
03421                                       }
03422                                   }
03423                               }
03424                           }
03425                       }
03426                   <font class="keywordflow">else</font>
03427                     {
03428                       ;
03429                     }
03430                 }
03431               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (mustDefine &amp;&amp; <a class="code" href="uentry_c.html#a176">uentry_isOut</a> (ce))
03432                 {
03433                   <font class="keywordflow">if</font> (!ynm_toBoolStrict (sRef_isReadable (sr)))
03434                     {
03435                       voptgenerror 
03436                         (FLG_MUSTDEFINE,
03437                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Out storage %q not defined before %q"</font>,
03438                                   uentry_getName (ce),
03439                                   cstring_makeLiteral 
03440                                   (isReturn ? <font class="stringliteral">"return"</font> : <font class="stringliteral">"scope exit"</font>)),
03441                          g_currentloc);
03442                       
03443                       <font class="comment">/* uentry_showWhereDeclared (ce); */</font>
03444                     }
03445                 }
03446               <font class="keywordflow">else</font>
03447                 {
03448                   ; 
03449                 }
03450               
03451               <font class="comment">/*</font>
03452 <font class="comment">              ** also check state is okay</font>
03453 <font class="comment">              */</font>
03454 
03455               <font class="keywordflow">if</font> (usymtab_lexicalLevel () &gt; functionScope
03456                   &amp;&amp; <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ce)
03457                   &amp;&amp; (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sr)
03458                       &amp;&amp; (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (sr) || <a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (sr))))
03459                 {
03460                   sRefSet ab = <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (sr);
03461 
03462                   <font class="comment">/* should do something more efficient here */</font>
03463 
03464                   <font class="keywordflow">if</font> (sRefSet_isEmpty (ab))
03465                     {
03466                       <font class="comment">/* and no local ref */</font>
03467                       <a class="code" href="aliasChecks_c.html#a32">checkLoseRef</a> (ce);
03468                     }
03469                   <font class="keywordflow">else</font>
03470                     {
03471                       ;
03472                     }
03473                   
03474                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (ab);
03475                 }
03476               <font class="keywordflow">else</font> 
03477                 {
03478                   ;
03479                 }
03480               
03481               checked = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (checked, sr);
03482             }
03483         }
03484       llassert (usymtab_isDefined (stab-&gt;env));
03485 
03486       <font class="keywordflow">if</font> (usymtab_isBranch (stab))
03487         {
03488           stab = usymtab_dropEnv (stab);
03489         }
03490       <font class="keywordflow">else</font>
03491         {
03492           stab = stab-&gt;env;
03493         }
03494 
03495       llassert (stab != usymtab_undefined);
03496     } <font class="keywordflow">while</font> (isReturn &amp;&amp; (stab-&gt;lexlevel &gt;= paramsScope));
03497 
03498     <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (checked);
03499 
03500   <font class="comment">/*</font>
03501 <font class="comment">  ** for returns:</font>
03502 <font class="comment">  **      all globals are appropriately defined</font>
03503 <font class="comment">  **      all parameters are appropriately defined</font>
03504 <font class="comment">  **      special clauses are followed</font>
03505 <font class="comment">  */</font>
03506 
03507   <font class="keywordflow">if</font> (isReturn || (utab-&gt;lexlevel == paramsScope))
03508     {
03509       uentry fcn = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
03510       uentryList params = <a class="code" href="context_c.html#a131">context_getParams</a> ();
03511       globSet uglobs = <a class="code" href="context_c.html#a132">context_getUsedGlobs</a> ();
03512       globSet sglobs = <a class="code" href="context_c.html#a134">context_getGlobs</a> ();
03513 
03514             
03515       <font class="keywordflow">if</font> (isReturn &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_GLOBALIAS))
03516         { 
03517           <a class="code" href="aliasTable_c.html#a23">aliasTable_checkGlobs</a> (utab-&gt;aliases); 
03518         }
03519 
03520       <font class="comment">/*</font>
03521 <font class="comment">      ** special clauses (defines, sets, allocates, releases) </font>
03522 <font class="comment">      */</font>
03523 
03524       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a143">uentry_hasSpecialClauses</a> (fcn))
03525         {
03526           specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (fcn);
03527 
03528           specialClauses_elements (clauses, cl)<font class="keyword"></font>
03529 <font class="keyword">            </font>{
03530               <font class="keywordflow">if</font> (<a class="code" href="specialClauses_c.html#a8">specialClause_isAfter</a> (cl)) 
03531                 { <font class="comment">/* evs - 2000 07 10 - added this */</font>
03532                   sRefTest tst = <a class="code" href="specialClauses_c.html#a10">specialClause_getPostTestFunction</a> (cl);
03533                   sRefSet rfs = specialClause_getRefs (cl);
03534                   
03535                   sRefSet_elements (rfs, el)<font class="keyword"></font>
03536 <font class="keyword">                    </font>{
03537                       sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
03538                       
03539                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (base))
03540                         {
03541                           ; 
03542                         }
03543                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (base))
03544                         {
03545                           sRef sr = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (base);
03546                           sr = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (el, sr);
03547                           
03548                           <font class="keywordflow">if</font> (tst != NULL &amp;&amp; !tst (sr))
03549                             {
03550                               <font class="keywordflow">if</font> (optgenerror 
03551                                   (<a class="code" href="specialClauses_c.html#a17">specialClause_postErrorCode</a> (cl),
03552                                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %qcorresponds to "</font>
03553                                             <font class="stringliteral">"storage listed in %q clause"</font>,
03554                                             specialClause_postErrorString (cl, sr),
03555                                             <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (sr),
03556                                             <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl)),
03557                                    g_currentloc))
03558                                 {
03559                                   sRefShower ss = <a class="code" href="specialClauses_c.html#a11">specialClause_getPostTestShower</a> (cl);
03560                                   
03561                                   <font class="keywordflow">if</font> (ss != NULL)
03562                                     {
03563                                       ss (sr);
03564                                     }
03565                                 }  
03566                             }
03567                         }
03568                       <font class="keywordflow">else</font>
03569                         {
03570                           <font class="keywordflow">if</font> (sRef_isMeaningful (el))
03571                             {
03572                               BADBRANCH;
03573                             }
03574                         }
03575                     } end_sRefSet_elements ;
03576                 }
03577             } end_specialClauses_elements ;
03578         }
03579       
03580       <font class="comment">/*</font>
03581 <font class="comment">      ** check parameters on return</font>
03582 <font class="comment">      */</font>
03583 
03584       uentryList_elements (params, arg)<font class="keyword"></font>
03585 <font class="keyword">        </font>{
03586           <font class="keywordflow">if</font> (!uentry_isElipsisMarker (arg))
03587             {
03588               ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (arg));
03589 
03590               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (rt) || ctype_isSU (rt))
03591                 {
03592                   uentry param = usymtab_lookupQuiet (utab, uentry_rawName (arg));
03593                   <a class="code" href="aliasChecks_c.html#a31">checkParamReturn</a> (param);
03594                 }
03595             }
03596         } end_uentryList_elements;
03597       
03598       globSet_allElements (sglobs, el)<font class="keyword"></font>
03599 <font class="keyword">        </font>{
03600           uentry current = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (el);
03601 
03602           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (current) &amp;&amp; !<a class="code" href="uentry_c.html#a186">uentry_isRealFunction</a> (current))
03603             {
03604               checkGlobalReturn (current, el);
03605             }
03606         } end_globSet_allElements;
03607 
03608       globSet_allElements (uglobs, el)<font class="keyword"></font>
03609 <font class="keyword">        </font>{
03610           <font class="keywordflow">if</font> (!<a class="code" href="globSet_c.html#a5">globSet_member</a> (sglobs, el))
03611             {
03612               uentry current = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (el);
03613               
03614                       
03615               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (current)
03616                   &amp;&amp; !<a class="code" href="uentry_c.html#a186">uentry_isRealFunction</a> (current))
03617                 {
03618                   checkGlobalReturn (current, sRef_undefined);
03619                 }
03620             }
03621         } end_globSet_allElements;
03622     }
03623   
03624   }
03625 
03626 <font class="keywordtype">void</font>
<a name="l03627"></a><a class="code" href="usymtab_c.html#a106">03627</a> <a class="code" href="usymtab_c.html#a106">usymtab_quietExitScope</a> (fileloc loc) 
03628    <font class="comment">/*@globals utab, globtab, filetab; @*/</font> 
03629    <font class="comment">/*@modifies utab@*/</font>
03630 {
03631   usymtab t = utab-&gt;env;
03632 
03633   <font class="keywordflow">if</font> (utab-&gt;reftable != NULL)
03634     {
03635       <font class="keywordtype">int</font> i;
03636 
03637       <font class="keywordflow">for</font> (i = 0; i &lt; utab-&gt;nentries; i++)
03638         {
03639           uentry current = utab-&gt;entries[i];      
03640           uentry old = usymtab_lookupAux (t, uentry_rawName (current));
03641 
03642           <a class="code" href="uentry_c.html#a277">uentry_mergeState</a> (old, current, loc, FALSE, FALSE, FALSE, NOCLAUSE);
03643         }
03644     }
03645 
03646   llassert (t != NULL);
03647 
03648   <font class="keywordflow">if</font> (t-&gt;lexlevel &gt; paramsScope)
03649     {
03650       t-&gt;guards = <a class="code" href="guardSet_c.html#a8">guardSet_levelUnion</a> (t-&gt;guards, utab-&gt;guards, t-&gt;lexlevel);
03651       t-&gt;aliases = <a class="code" href="aliasTable_c.html#a17">aliasTable_levelUnionSeq</a> (t-&gt;aliases, utab-&gt;aliases, 
03652                                              t-&gt;lexlevel);
03653       utab-&gt;aliases = aliasTable_undefined;
03654     }
03655 
03656   t-&gt;mustBreak = utab-&gt;mustBreak;
03657   t-&gt;exitCode = utab-&gt;exitCode;
03658 
03659   usymtab_freeLevel (utab);
03660 
03661   utab = t;
03662 }
03663 
03664 <font class="comment">/*</font>
03665 <font class="comment">** Exit a scope with no checking, lose alias states.</font>
03666 <font class="comment">** (When should this be used?)</font>
03667 <font class="comment">*/</font>
03668 
<a name="l03669"></a><a class="code" href="usymtab_c.html#a107">03669</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> (<font class="keywordtype">void</font>)
03670      <font class="comment">/*@globals utab, globtab, filetab@*/</font>
03671      <font class="comment">/*@modifies utab@*/</font>
03672 {
03673   usymtab t = utab-&gt;env;
03674 
03675   llassert (t != NULL);
03676   llassert (NOALIAS (utab-&gt;aliases, t-&gt;aliases));
03677   usymtab_freeLevel (utab);
03678   utab = t;
03679 }
03680 
<a name="l03681"></a><a class="code" href="usymtab_c.html#a108">03681</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a108">usymtab_exitScope</a> (exprNode expr)
03682   <font class="comment">/*@globals utab, filetab, globtab@*/</font>
03683   <font class="comment">/*@modifies utab, globtab@*/</font>
03684 {
03685   usymtab ctab = usymtab_undefined;
03686   usymtab lctab = usymtab_undefined;
03687   <font class="keywordtype">bool</font> mustReturn = <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (expr);
03688   
03689   <font class="keywordflow">if</font> (utab-&gt;kind == US_CBRANCH)
03690     {
03691       <font class="comment">/*</font>
03692 <font class="comment">      ** save the case branches, remove the first non-cbranch</font>
03693 <font class="comment">      */</font>
03694 
03695       ctab = utab;
03696 
03697       <font class="keywordflow">while</font> (utab-&gt;kind == US_CBRANCH) 
03698         {
03699           lctab = utab;
03700           utab = utab-&gt;env;
03701           llassert (utab != GLOBAL_ENV);
03702         }
03703     }
03704   
03705   <font class="keywordflow">if</font> (utab-&gt;kind == US_TBRANCH || utab-&gt;kind == US_FBRANCH
03706       || utab-&gt;kind == US_CBRANCH || utab-&gt;kind == US_SWITCH) {
03707    
03708     <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ()) {
03709       <font class="comment">/* evs 2000-07-25 */</font>
03710       <font class="comment">/* Unparseable macro may end inside nested scope.  Deal with it. */</font>
03711       
03712       llerror (FLG_SYNTAX, message (<font class="stringliteral">"Problem parsing macro body of %s (unbalanced scopes).  Attempting to recover, recommend /*@notfunction@*/ before macro definition."</font>, 
03713                                     context_inFunctionName ()));
03714       
03715       <font class="keywordflow">while</font> (utab-&gt;kind == US_TBRANCH
03716              || utab-&gt;kind == US_FBRANCH
03717              || utab-&gt;kind == US_CBRANCH
03718              || utab-&gt;kind == US_SWITCH) 
03719         {
03720           utab = utab-&gt;env;
03721           llassert (utab != GLOBAL_ENV);
03722         }
03723     } <font class="keywordflow">else</font> {
03724       llcontbug ((<font class="stringliteral">"exitScope: in branch: %s"</font>, usymtab_unparseStack ()));
03725       <font class="comment">/*@-branchstate@*/</font> 
03726     } <font class="comment">/*@=branchstate@*/</font>
03727   }
03728 
03729   <font class="comment">/*</font>
03730 <font class="comment">  ** check all variables in scope were used</font>
03731 <font class="comment">  */</font>
03732 
03733   <font class="comment">/*</font>
03734 <font class="comment">  ** bogus errors if this is the normal inside a switch,</font>
03735 <font class="comment">  ** since cases have not been merged yet.  Should probably</font>
03736 <font class="comment">  ** still check this, but I'm too lazy at the moment...</font>
03737 <font class="comment">  */</font>
03738 
03739   llassertfatal (utab-&gt;env != GLOBAL_ENV);
03740 
03741   <font class="keywordflow">if</font> (utab-&gt;env-&gt;kind != US_SWITCH)
03742     {
03743       <a class="code" href="usymtab_c.html#a103">usymtab_allUsed</a> ();
03744     }
03745 
03746   <font class="comment">/*</font>
03747 <font class="comment">  ** check aliasing: all only params are released (dead)</font>
03748 <font class="comment">  **     definition: all out params are defined, all modified params </font>
03749 <font class="comment">  **                     are completely defined</font>
03750 <font class="comment">  **</font>
03751 <font class="comment">  ** NOTE: note for exiting paramsScope, since checkReturn should be</font>
03752 <font class="comment">  ** called first.</font>
03753 <font class="comment">  */</font>
03754 
03755   <font class="keywordflow">if</font> (!mustReturn &amp;&amp; (usymtab_lexicalLevel () &gt; functionScope))
03756     {
03757       <font class="comment">/*</font>
03758 <font class="comment">      ** should only call this is end of scope is reachable...</font>
03759 <font class="comment">      */</font>
03760 
03761       <a class="code" href="usymtab_c.html#a105">usymtab_checkFinalScope</a> (FALSE);
03762     }
03763 
03764   <font class="keywordflow">if</font> (usymtab_lexicalLevel () == paramsScope &amp;&amp; <a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
03765     {
03766       <font class="comment">/*</font>
03767 <font class="comment">      ** leaving a function, need to fix up globals</font>
03768 <font class="comment">      */</font>
03769 
03770       uentryList params = <a class="code" href="context_c.html#a131">context_getParams</a> ();
03771       globSet    globs = <a class="code" href="context_c.html#a132">context_getUsedGlobs</a> ();
03772 
03773                   
03774       uentryList_elements (params, ue)<font class="keyword"></font>
03775 <font class="keyword">        </font>{
03776           <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (ue);
03777         } end_uentryList_elements;
03778 
03779       clearFunctionTypes ();
03780 
03781       
03782       globSet_allElements (globs, el)<font class="keyword"></font>
03783 <font class="keyword">        </font>{
03784           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (el))
03785             {
03786               uentry current;
03787               <font class="keywordtype">int</font> index = <a class="code" href="sRef_c.html#a166">sRef_getScopeIndex</a> (el);
03788               
03789               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (el))
03790                 {
03791                   llassert (usymtab_isDefined (filetab));
03792                   current = usymtab_fetchIndex (filetab, index);
03793                 }
03794               <font class="keywordflow">else</font>
03795                 {
03796                   current = usymtab_fetchIndex (globtab, index);
03797                 }
03798               
03799               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (current))
03800                 {
03801                   <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (current);
03802                 }
03803               <font class="keywordflow">else</font>
03804                 {
03805                   <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (uentry_getSref (current));
03806                 }
03807             }
03808         } end_globSet_allElements;
03809     }
03810   
03811   <a class="code" href="usymtab_c.html#a106">usymtab_quietExitScope</a> (exprNode_loc (expr));
03812   
03813   <font class="keywordflow">if</font> (lctab != usymtab_undefined)
03814     {
03815       <font class="comment">/*@i@*/</font> lctab-&gt;env = utab;  
03816       <font class="comment">/*@i@*/</font> utab = ctab;
03817     <font class="comment">/*@-branchstate@*/</font> } <font class="comment">/*@=branchstate@*/</font>
03818 <font class="comment">/*@-globstate@*/</font>
03819 }
03820 <font class="comment">/*@=globstate@*/</font>
03821 
03822 <font class="comment">/*</font>
03823 <font class="comment">** yikes!  don't let the '170 kids see this one...</font>
03824 <font class="comment">*/</font>
03825 
03826 <font class="keywordtype">int</font>
<a name="l03827"></a><a class="code" href="usymtab_c.html#a109">03827</a> <a class="code" href="usymtab_c.html#a109">uentry_directParamNo</a> (uentry ue)<font class="keyword"></font>
03828 <font class="keyword"></font>{
03829   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ue))
03830     {
03831       sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
03832 
03833       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (sr) == functionScope)
03834         {
03835           <font class="comment">/*@access sRef@*/</font> <font class="comment">/*@-null@*/</font>
03836           <font class="keywordtype">int</font> index = sr-&gt;info-&gt;cvar-&gt;index;
03837           <font class="comment">/*@noaccess sRef@*/</font> <font class="comment">/*@=null@*/</font>
03838 
03839           <font class="keywordflow">if</font> (index &lt; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (context_getParams ()))
03840             {
03841               <font class="keywordflow">return</font> index;
03842             }
03843         }
03844     }
03845   <font class="keywordflow">return</font> -1;
03846 }
03847 
03848 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry
<a name="l03849"></a><a class="code" href="usymtab_c.html#a110">03849</a>   <a class="code" href="usymtab_c.html#a110">usymtab_getParam</a> (<font class="keywordtype">int</font> paramno)
03850   <font class="comment">/*@globals utab@*/</font>
03851 {
03852   <font class="comment">/*</font>
03853 <font class="comment">  ** requires in a function context (checked)</font>
03854 <font class="comment">  **</font>
03855 <font class="comment">  ** depends on no nested functions --- the function</font>
03856 <font class="comment">  ** parameters are ALWAYS one scope inside the global scope</font>
03857 <font class="comment">  ** and entered in order!</font>
03858 <font class="comment">  */</font>
03859   usymtab s = utab;
03860 
03861   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
03862     <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"usymtab_getParam: not in function context: %q"</font>, 
03863                          context_unparse ()));
03864 
03865   <font class="keywordflow">while</font> (s-&gt;lexlevel &gt; paramsScope) 
03866     {
03867       s = s-&gt;env;
03868     }
03869 
03870   llassert (usymtab_isDefined (s));
03871 
03872   <font class="keywordflow">if</font> (paramno &gt;= s-&gt;nentries)
03873     {
03874       <font class="comment">/*  </font>
03875 <font class="comment">      ** Parse errors lead to this. </font>
03876 <font class="comment">      */</font>
03877 
03878       uentry err = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (cstring_makeLiteralTemp (<font class="stringliteral">"&lt;error&gt;"</font>),
03879                                            ctype_unknown);
03880       
03881       <a class="code" href="uentry_c.html#a237">uentry_markOwned</a> (err);
03882       <font class="keywordflow">return</font> (err);
03883     }
03884 
03885   <font class="keywordflow">return</font> (s-&gt;entries[paramno]);
03886 }
03887 
03888 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry 
03889 usymtab_getRefTab (<font class="comment">/*@notnull@*/</font> usymtab u, <font class="keywordtype">int</font> level, usymId index)<font class="keyword"></font>
03890 <font class="keyword"></font>{
03891   uentry ue;
03892 
03893   
03894   ue = usymtab_getRefNoisy (u, level, index);
03895 
03896   
03897   <font class="keywordflow">if</font> (uentry_isUndefined (ue))
03898     {
03899       llbug (message (<font class="stringliteral">"usymtab_getRef: out of range: %d. level = %d"</font>,
03900                     index, level));
03901     }
03902 
03903   
03904   <font class="keywordflow">return</font> ue;
03905 }
03906 
03907 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> usymtab 
03908   usymtab_dropEnv (<font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
03909 <font class="keyword"></font>{
03910   <font class="keywordflow">if</font> (s-&gt;kind == US_CBRANCH)
03911     {
03912       usymtab t = s;
03913 
03914       <font class="keywordflow">do</font> 
03915         {
03916           t = s;
03917           s = s-&gt;env;
03918           llassert (s != GLOBAL_ENV);
03919         } <font class="keywordflow">while</font> (s-&gt;kind == US_CBRANCH); 
03920       <font class="comment">/* drop all cases (except in nested scopes */</font> 
03921 
03922       s = t;
03923       llassert (s != GLOBAL_ENV);
03924     }
03925 
03926   <font class="keywordflow">if</font> (s-&gt;kind == US_FBRANCH)
03927     {
03928       s = s-&gt;env; <font class="comment">/* skip the true branch */</font>
03929       llassert (usymtab_isDefined (s));
03930       llassert (s-&gt;kind == US_TBRANCH);
03931     }
03932 
03933   llassert (s != GLOBAL_ENV);
03934   s = s-&gt;env;
03935 
03936   <font class="keywordflow">return</font> s;
03937 }
03938 
03939 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry
<a name="l03940"></a><a class="code" href="usymtab_c.html#a111">03940</a>   <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (<font class="keywordtype">int</font> level, usymId index)
03941   <font class="comment">/*@globals utab@*/</font>
03942 {
03943   usymtab s = utab;
03944   
03945   
03946   llassert (s != NULL);
03947   llassert (index &gt;= 0);
03948 
03949   <font class="keywordflow">if</font> (level &gt; s-&gt;lexlevel)
03950     {
03951             
03952       <font class="keywordflow">return</font> uentry_undefined;
03953     }
03954 
03955   llassertprint (level &lt;= s-&gt;lexlevel, (<font class="stringliteral">"level: %d / lexlevel: %d"</font>, 
03956                                         level, s-&gt;lexlevel)); 
03957 
03958   <font class="keywordflow">while</font> (s-&gt;lexlevel &gt; level)
03959     {
03960       <font class="keywordflow">if</font> (usymtab_isBranch (s))
03961         {
03962           <font class="keywordtype">int</font> eindex = refTable_lookup (s, level, index);
03963 
03964           <font class="keywordflow">if</font> (eindex != NOT_FOUND)
03965             {
03966               <font class="keywordflow">return</font> (s-&gt;entries[eindex]);
03967             }
03968         }
03969 
03970       s = usymtab_dropEnv (s);
03971     }
03972 
03973   <font class="keywordflow">while</font> (usymtab_isBranch (s) &amp;&amp; s-&gt;lexlevel == level)
03974     {
03975       <font class="keywordtype">int</font> eindex = refTable_lookup (s, level, index);
03976       
03977       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
03978         {
03979           <font class="keywordflow">return</font> (s-&gt;entries[eindex]);
03980         }
03981 
03982       s = usymtab_dropEnv (s);
03983     }
03984  
03985   <font class="keywordflow">if</font> (index &gt;= s-&gt;nentries)
03986     {
03987       <font class="keywordflow">return</font> uentry_undefined;
03988     }
03989 
03990   llassert (!uentry_isUndefined (s-&gt;entries[index]));
03991 
03992   <font class="keywordflow">return</font> s-&gt;entries[index];
03993 }
03994 
03995 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry
03996 usymtab_getRefNoisy (<font class="comment">/*@notnull@*/</font> usymtab s, <font class="keywordtype">int</font> level, usymId index)<font class="keyword"></font>
03997 <font class="keyword"></font>{
03998   usymtab otab = s;
03999   uentry ue = uentry_undefined;
04000 
04001   
04002   llassert (index &gt;= 0);
04003 
04004   
04005   <font class="keywordflow">while</font> (s-&gt;lexlevel &gt; level)
04006     {
04007       
04008       <font class="keywordflow">if</font> (usymtab_isBranch (s))
04009         {
04010           <font class="keywordtype">int</font> eindex = refTable_lookup (s, level, index);
04011 
04012           <font class="keywordflow">if</font> (eindex != NOT_FOUND)
04013             {
04014               ue = s-&gt;entries[eindex];
04015 
04016               <font class="keywordflow">if</font> (s != otab)
04017                 {
04018                   <font class="keywordflow">while</font> (!usymtab_isBranch (otab))
04019                     {
04020                       otab = usymtab_dropEnv (otab);
04021                       llassert (otab != GLOBAL_ENV);
04022                     }
04023                 
04024                   <font class="keywordflow">if</font> (refTable_lookup (otab, level, index) == NOT_FOUND)
04025                     {
04026                       ue = usymtab_addRefEntry (otab, uentry_rawName (ue));
04027                     }
04028                   <font class="keywordflow">else</font>
04029                     {
04030                       ;
04031                     }
04032                 }
04033               
04034               <font class="keywordflow">return</font> ue;
04035             }
04036         }
04037 
04038       s = usymtab_dropEnv (s);
04039     }
04040 
04041   llassert (usymtab_isDefined (s));
04042 
04043   <font class="keywordflow">while</font> (usymtab_isBranch (s) &amp;&amp; s-&gt;lexlevel == level)
04044     {
04045       <font class="keywordtype">int</font> eindex = refTable_lookup (s, level, index);
04046 
04047       
04048       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
04049         {
04050           ue = s-&gt;entries[eindex];
04051           
04052           <font class="keywordflow">if</font> (s != otab)
04053             {
04054               <font class="keywordflow">while</font> (!usymtab_isBranch (otab))
04055                 {
04056                   otab = usymtab_dropEnv (otab);
04057                   llassert (otab != GLOBAL_ENV);
04058                 }
04059 
04060               ue = usymtab_addRefEntry (otab, uentry_rawName (ue));
04061             }
04062           <font class="keywordflow">else</font>
04063             {
04064               ;
04065             } 
04066 
04067           <font class="keywordflow">return</font> ue;
04068         }
04069 
04070       s = usymtab_dropEnv (s);
04071           }
04072 
04073   <font class="keywordflow">if</font> (s-&gt;lexlevel == level &amp;&amp; (index &lt; s-&gt;nentries))
04074     {
04075       ue = s-&gt;entries[index];
04076       
04077       <font class="keywordflow">if</font> (uentry_isValid (ue))
04078         {
04079           <font class="keywordflow">if</font> (s != otab)
04080             {
04081               <font class="keywordflow">while</font> (!usymtab_isBranch (otab))
04082                 {
04083                   otab = usymtab_dropEnv (otab);
04084                   
04085                   <font class="keywordflow">if</font> (otab == GLOBAL_ENV)
04086                     {
04087                       <font class="keywordflow">return</font> ue;
04088                     }
04089                 }
04090               
04091               ue = usymtab_addRefEntry (otab, uentry_rawName (ue));
04092             }
04093           <font class="keywordflow">else</font>
04094             {
04095                     }
04096         }
04097 
04098       <font class="keywordflow">return</font> ue;
04099     }
04100 
04101   
04102   <font class="keywordflow">if</font> (index &gt;= s-&gt;nentries)
04103     {
04104       <font class="keywordflow">return</font> uentry_undefined;
04105     }
04106 
04107   llassert (!uentry_isUndefined (s-&gt;entries[index]));
04108 
04109   <font class="keywordflow">return</font> s-&gt;entries[index];
04110 }
04111 
04112 <font class="comment">/*</font>
04113 <font class="comment">** looking up entries</font>
04114 <font class="comment">**</font>
04115 <font class="comment">** If entry is inside a branch, then copy it, and put it into </font>
04116 <font class="comment">** the branch table.</font>
04117 <font class="comment">*/</font>
04118 
04119 <font class="keyword">static</font>
04120 <font class="keywordtype">int</font> refTable_lookup (<font class="comment">/*@notnull@*/</font> usymtab ut, <font class="keywordtype">int</font> level, <font class="keywordtype">int</font> index)<font class="keyword"></font>
04121 <font class="keyword"></font>{
04122   refTable rt = ut-&gt;reftable;
04123   <font class="keywordtype">int</font> i;
04124 
04125   llassert (rt != NULL);
04126 
04127   
04128   <font class="keywordflow">for</font> (i = 0; i &lt; ut-&gt;nentries; i++)
04129     {
04130       <font class="keywordflow">if</font> (rt[i]-&gt;level == level &amp;&amp; rt[i]-&gt;index == index)
04131         {
04132                   <font class="keywordflow">return</font> i;
04133         }
04134     }
04135 
04136     <font class="keywordflow">return</font> NOT_FOUND;
04137 }
04138   
04139 <font class="keyword">static</font>
04140 <font class="comment">/*@only@*/</font> refentry refentry_create (<font class="keywordtype">int</font> level, <font class="keywordtype">int</font> index)<font class="keyword"></font>
04141 <font class="keyword"></font>{
04142   refentry r = (refentry) dmalloc (<font class="keyword">sizeof</font> (*r));
04143 
04144   r-&gt;level = level;
04145   r-&gt;index = index;
04146 
04147   <font class="keywordflow">return</font> r;
04148 }
04149 
04150 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry
04151 usymtab_addRefEntry (<font class="comment">/*@notnull@*/</font> usymtab s, cstring k)<font class="keyword"></font>
04152 <font class="keyword"></font>{
04153   <font class="keywordtype">int</font> eindex;
04154   usymtab ut = s;
04155 
04156   llassert (ut-&gt;reftable != NULL);
04157 
04158   <font class="keywordflow">while</font> (s != GLOBAL_ENV)
04159     {
04160       eindex = usymtab_getIndex (s, k);
04161       
04162       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
04163         {
04164           uentry current = s-&gt;entries[eindex];
04165 
04166           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (current) &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (current)))
04167             {
04168               uentry ue;
04169 
04170               DPRINTF ((<font class="stringliteral">"Here: copying %s"</font>, uentry_unparseFull (current)));
04171 
04172               ue = <a class="code" href="uentry_c.html#a270">uentry_copy</a> (current);
04173 
04174               DPRINTF ((<font class="stringliteral">"Here: copying %s"</font>, uentry_unparseFull (ue)));
04175 
04176               usymtab_addEntryQuiet (ut, ue);
04177 
04178               <font class="keywordflow">if</font> (s-&gt;reftable != NULL)
04179                 {
04180                   refentry ref = s-&gt;reftable[eindex];
04181 
04182                   
04183                   ut-&gt;reftable[ut-&gt;nentries - 1] 
04184                     = refentry_create (ref-&gt;level, ref-&gt;index);
04185                 }
04186               <font class="keywordflow">else</font>
04187                 {
04188                   ut-&gt;reftable[ut-&gt;nentries - 1] 
04189                     = refentry_create (s-&gt;lexlevel, eindex);
04190                 }
04191               
04192               <font class="keywordflow">return</font> (ue);
04193             }
04194           <font class="keywordflow">else</font>
04195             {
04196               <font class="keywordflow">return</font> (current);
04197             }
04198         }
04199 
04200       s = usymtab_dropEnv (s);
04201     }
04202 
04203   <font class="keywordflow">return</font> uentry_undefined;
04204 }
04205 
04206 <font class="keyword">static</font> uentry usymtab_lookupAux (usymtab s, cstring k)<font class="keyword"></font>
04207 <font class="keyword"></font>{
04208   DPRINTF ((<font class="stringliteral">"Lookup: %s"</font>, k));
04209 
04210   <font class="keywordflow">while</font> (s != GLOBAL_ENV)
04211     {
04212       <font class="keywordtype">int</font> eindex = usymtab_getIndex (s, k);
04213 
04214       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
04215         {
04216           uentry ret = s-&gt;entries[eindex];
04217           
04218           DPRINTF ((<font class="stringliteral">"Found: %s"</font>, uentry_unparseFull (ret)));
04219           <font class="keywordflow">return</font> (ret);
04220         }
04221 
04222       <font class="keywordflow">if</font> (s-&gt;kind == US_TBRANCH || s-&gt;kind == US_FBRANCH 
04223           || s-&gt;kind == US_CBRANCH)
04224         {
04225           uentry ret = usymtab_addRefEntry (s, k);
04226           DPRINTF ((<font class="stringliteral">"Ref entry: %s"</font>, uentry_unparseFull (ret)));
04227           <font class="keywordflow">return</font> ret;
04228         }
04229       
04230       s = s-&gt;env;
04231     }
04232   
04233   <font class="keywordflow">return</font> uentry_undefined;
04234 }
04235 
04236 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> uentry
04237 usymtab_lookupQuiet (usymtab s, cstring k)<font class="keyword"></font>
04238 <font class="keyword"></font>{
04239   <font class="keywordtype">int</font> eindex;
04240 
04241   <font class="keywordflow">while</font> (s != GLOBAL_ENV)
04242     {
04243       eindex = usymtab_getIndex (s, k);
04244       
04245       <font class="keywordflow">if</font> (eindex != NOT_FOUND)
04246         {
04247           uentry ret = s-&gt;entries[eindex];
04248           <font class="keywordflow">return</font> (ret);
04249         }
04250       
04251       s = s-&gt;env;
04252     }
04253 
04254   <font class="keywordflow">return</font> uentry_undefined;
04255 }
04256 
04257 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@observer@*/</font> uentry
<a name="l04258"></a><a class="code" href="usymtab_c.html#a113">04258</a>   <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (cstring k)
04259   <font class="comment">/*@globals utab@*/</font>
04260 {
04261   DPRINTF ((<font class="stringliteral">"Lookup safe: %s"</font>, k));
04262   <font class="keywordflow">return</font> (usymtab_lookupAux (utab, k));
04263 }
04264 
04265 uentry
<a name="l04266"></a><a class="code" href="usymtab_c.html#a114">04266</a>   <a class="code" href="usymtab_c.html#a114">usymtab_lookupExpose</a> (cstring k)
04267   <font class="comment">/*@globals utab@*/</font>
04268 {
04269   uentry ce = usymtab_lookupAux (utab, k);
04270 
04271   <font class="keywordflow">if</font> (uentry_isUndefined (ce))
04272     {
04273       <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"usymtab_lookup: not found: *%s*"</font>, k));
04274     }
04275 
04276   <font class="keywordflow">if</font> (uentry_isPriv (ce))
04277     {
04278       <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"usymtab_lookup: private: *%s*"</font>, k));
04279     }
04280 
04281   <font class="keywordflow">return</font> ce;
04282 }
04283 
<a name="l04284"></a><a class="code" href="usymtab_c.html#a115">04284</a> uentry <a class="code" href="usymtab_c.html#a115">usymtab_lookupExposeGlob</a> (cstring k)<font class="keyword"></font>
04285 <font class="keyword"></font>{
04286   <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a117">usymtab_lookupGlobSafe</a> (k));
04287 }
04288 
<a name="l04289"></a><a class="code" href="usymtab_c.html#a116">04289</a> uentry <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (cstring k)
04290   <font class="comment">/*@globals globtab@*/</font>
04291 {
04292   uentry ce = usymtab_lookupAux (globtab, k);
04293 
04294   <font class="keywordflow">if</font> (uentry_isUndefined (ce))
04295     <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"usymtab_lookup: not found: %s"</font>, k));
04296 
04297   <font class="keywordflow">if</font> (uentry_isPriv (ce))
04298     <a class="code" href="llerror_c.html#a43">llfatalbug</a> (message (<font class="stringliteral">"usymtab_lookup: private: %s"</font>, k));
04299 
04300   <font class="keywordflow">return</font> ce;
04301 }
04302 
04303 <font class="comment">/*@observer@*/</font> uentry
<a name="l04304"></a><a class="code" href="usymtab_c.html#a117">04304</a>   <a class="code" href="usymtab_c.html#a117">usymtab_lookupGlobSafe</a> (cstring k)
04305   <font class="comment">/*@globals globtab@*/</font>
04306 {
04307   uentry ce = usymtab_lookupAux (globtab, k);
04308 
04309   <font class="keywordflow">return</font> ce;
04310 }
04311 
<a name="l04312"></a><a class="code" href="usymtab_c.html#a118">04312</a> uentry <a class="code" href="usymtab_c.html#a118">usymtab_lookupEither</a> (cstring k)
04313    <font class="comment">/*@globals utab@*/</font>
04314 {
04315   uentry ce = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (k);
04316 
04317   <font class="keywordflow">if</font> (uentry_isUndefined (ce))
04318     <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"usymtab_lookup: not found: %s"</font>, k));
04319 
04320   <font class="keywordflow">return</font> ce;
04321 }
04322 
04323 <font class="preprocessor"># ifndef NOLCL</font>
04324 <font class="preprocessor"></font>ctype
<a name="l04325"></a><a class="code" href="usymtab_c.html#a119">04325</a> <a class="code" href="usymtab_c.html#a119">usymtab_lookupType</a> (cstring k)
04326    <font class="comment">/*@globals globtab@*/</font>
04327 {
04328   usymId uid = <a class="code" href="usymtab_c.html#a64">usymtab_getTypeId</a> (k);
04329 
04330   <font class="keywordflow">if</font> (uid == USYMIDINVALID)
04331     {
04332       llcontbug (message (<font class="stringliteral">"usymtab_lookupType: not found: %s"</font>, k));
04333       <font class="keywordflow">return</font> ctype_unknown;
04334     }
04335   
04336   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a222">uentry_getRealType</a> (usymtab_getTypeEntry (uid)));
04337 }
04338 <font class="preprocessor"># endif</font>
04339 <font class="preprocessor"></font>
04340 ctype
<a name="l04341"></a><a class="code" href="usymtab_c.html#a120">04341</a> <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
04342 {
04343   usymId uid = <a class="code" href="usymtab_c.html#a64">usymtab_getTypeId</a> (k);
04344 
04345   <font class="keywordflow">if</font> (uid == USYMIDINVALID)
04346     {
04347       llcontbug (message (<font class="stringliteral">"usymtab_lookupType: not found: %s"</font>, k));
04348       <font class="keywordflow">return</font> ctype_unknown; 
04349     }
04350   
04351   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (usymtab_getTypeEntry (uid)));
04352 }
04353   
04354 <font class="comment">/*</font>
04355 <font class="comment">** if there is an unnamed lcl-specified struct tag matching</font>
04356 <font class="comment">** the uentryList, return its datatype.  Otherwise, returns</font>
04357 <font class="comment">** ctype_undefined.</font>
04358 <font class="comment">*/</font>
04359 
04360 ctype
<a name="l04361"></a><a class="code" href="usymtab_c.html#a121">04361</a> <a class="code" href="usymtab_c.html#a121">usymtab_structFieldsType</a> (uentryList f)
04362    <font class="comment">/*@globals globtab@*/</font>
04363 {
04364   <font class="keywordflow">return</font> (usymtab_suFieldsType (f, TRUE));
04365 }
04366 
04367 ctype
<a name="l04368"></a><a class="code" href="usymtab_c.html#a122">04368</a> <a class="code" href="usymtab_c.html#a122">usymtab_unionFieldsType</a> (uentryList f)
04369    <font class="comment">/*@globals globtab@*/</font>
04370 {
04371   <font class="keywordflow">return</font> (usymtab_suFieldsType (f, FALSE));
04372 }
04373 
04374 <font class="keyword">static</font> ctype
04375 usymtab_suFieldsType (uentryList f, <font class="keywordtype">bool</font> isStruct)
04376   <font class="comment">/*@globals globtab@*/</font>
04377 {
04378   <font class="keywordtype">int</font> i;
04379 
04380   <font class="keywordflow">if</font> (<a class="code" href="fileloc_c.html#a44">fileloc_isSpec</a> (g_currentloc)) <font class="keywordflow">return</font> (ctype_undefined);
04381 
04382   <font class="keywordflow">for</font> (i = 0; i &lt; globtab-&gt;nentries; i++)
04383     {
04384       uentry current = globtab-&gt;entries[i];
04385 
04386       <font class="keywordflow">if</font> ((isStruct 
04387            ? <a class="code" href="uentry_c.html#a125">uentry_isStructTag</a> (current) : uentry_isUnionTag (current)))
04388         {
04389           <font class="keywordflow">if</font> (<a class="code" href="structNames_c.html#a12">isFakeTag</a> (uentry_rawName (current)))
04390             {
04391               ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (current);
04392 
04393               <font class="keywordflow">if</font> ((isStruct ? <a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct) : ctype_isUnion (ct))
04394                   &amp;&amp; (uentryList_matchFields (f, ctype_getFields (ct))))
04395                 {
04396                                   <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (current);
04397                 }
04398             }
04399         }
04400     }
04401   
04402     <font class="keywordflow">return</font> ctype_undefined;
04403 }
04404 
04405 ctype
<a name="l04406"></a><a class="code" href="usymtab_c.html#a123">04406</a>   <a class="code" href="usymtab_c.html#a123">usymtab_enumEnumNameListType</a> (enumNameList f)
04407   <font class="comment">/*@globals globtab@*/</font>
04408 {
04409   <font class="keywordtype">int</font> i;
04410 
04411   <font class="keywordflow">for</font> (i = 0; i &lt; globtab-&gt;nentries; i++)
04412     {
04413       uentry current = globtab-&gt;entries[i];
04414 
04415       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a127">uentry_isEnumTag</a> (current))
04416         {
04417           <font class="keywordflow">if</font> (<a class="code" href="structNames_c.html#a12">isFakeTag</a> (uentry_rawName (current)))
04418             {
04419               ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (current);
04420 
04421               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (ct) &amp;&amp; (<a class="code" href="enumNameList_c.html#a2">enumNameList_match</a> (f, ctype_elist (ct))))
04422                 {
04423                   <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a197">uentry_getType</a> (current);
04424                 }
04425             }
04426         }
04427     }
04428   
04429   <font class="keywordflow">return</font> ctype_undefined;
04430 }
04431 
04432 <font class="keywordtype">bool</font>
<a name="l04433"></a><a class="code" href="usymtab_c.html#a124">04433</a> <a class="code" href="usymtab_c.html#a124">usymtab_exists</a> (cstring k)
04434    <font class="comment">/*@globals utab@*/</font>
04435 {
04436   uentry ce = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (k);
04437 
04438   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)));
04439 }
04440 
04441 <font class="keywordtype">bool</font>
<a name="l04442"></a><a class="code" href="usymtab_c.html#a125">04442</a> <a class="code" href="usymtab_c.html#a125">usymtab_existsReal</a> (cstring k)
04443    <font class="comment">/*@globals utab@*/</font>
04444 {
04445   uentry ce = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (k);
04446 
04447   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) 
04448           &amp;&amp; !(uentry_isPriv (ce))
04449           &amp;&amp; !(<a class="code" href="uentry_c.html#a171">uentry_isExpandedMacro</a> (ce)));
04450 }
04451 
04452 <font class="keywordtype">bool</font>
<a name="l04453"></a><a class="code" href="usymtab_c.html#a126">04453</a>   <a class="code" href="usymtab_c.html#a126">usymtab_existsGlob</a> (cstring k)
04454   <font class="comment">/*@globals globtab@*/</font>
04455 {
04456   uentry ce = usymtab_lookupAux (globtab, k);
04457 
04458   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)));
04459 }
04460 
04461 <font class="preprocessor"># ifndef NOLCL</font>
04462 <font class="preprocessor"></font><font class="keywordtype">bool</font>
<a name="l04463"></a><a class="code" href="usymtab_c.html#a127">04463</a> <a class="code" href="usymtab_c.html#a127">usymtab_existsEither</a> (cstring k)
04464   <font class="comment">/*@globals utab@*/</font>
04465 {
04466   uentry ce = usymtab_lookupAux (utab, k);
04467   
04468   <font class="keywordflow">return</font> (uentry_isValid (ce));
04469 }
04470 
04471 <font class="keywordtype">bool</font>
<a name="l04472"></a><a class="code" href="usymtab_c.html#a128">04472</a>   <a class="code" href="usymtab_c.html#a128">usymtab_existsGlobEither</a> (cstring k)
04473   <font class="comment">/*@globals globtab@*/</font>
04474 {
04475   uentry ce = usymtab_lookupAux (globtab, k);
04476   
04477   <font class="keywordflow">return</font> (uentry_isValid (ce));
04478 }
04479 <font class="preprocessor"># endif</font>
04480 <font class="preprocessor"></font>
04481 <font class="keywordtype">bool</font>
<a name="l04482"></a><a class="code" href="usymtab_c.html#a129">04482</a> <a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring k)
04483   <font class="comment">/*@globals globtab@*/</font>
04484 {
04485   uentry ce = usymtab_lookupAux (globtab, k);
04486 
04487   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)) &amp;&amp; <a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce));
04488 }
04489 
04490 <font class="keywordtype">bool</font>
<a name="l04491"></a><a class="code" href="usymtab_c.html#a130">04491</a> <a class="code" href="usymtab_c.html#a130">usymtab_existsTypeEither</a> (cstring k)
04492   <font class="comment">/*@globals globtab@*/</font>
04493 {
04494   uentry ce = usymtab_lookupAux (globtab, k);
04495 
04496     <font class="keywordflow">return</font> (uentry_isValid (ce) &amp;&amp; <a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ce));
04497 }
04498 
04499 <font class="keywordtype">bool</font>
<a name="l04500"></a><a class="code" href="usymtab_c.html#a131">04500</a> <a class="code" href="usymtab_c.html#a131">usymtab_existsStructTag</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
04501 {
04502   cstring sname = <a class="code" href="structNames_c.html#a8">makeStruct</a> (k);
04503   uentry ce = usymtab_lookupAux (globtab, sname);
04504 
04505   <a class="code" href="cstring_c.html#a27">cstring_free</a> (sname);
04506 
04507   
04508   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)));
04509 }
04510 
04511 <font class="keywordtype">bool</font>
<a name="l04512"></a><a class="code" href="usymtab_c.html#a132">04512</a> <a class="code" href="usymtab_c.html#a132">usymtab_existsUnionTag</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
04513 {
04514   cstring uname = <a class="code" href="structNames_c.html#a9">makeUnion</a> (k);
04515   uentry ce = usymtab_lookupAux (globtab, uname);
04516 
04517   <a class="code" href="cstring_c.html#a27">cstring_free</a> (uname);
04518 
04519   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)));
04520 }
04521 
04522 <font class="keywordtype">bool</font>
<a name="l04523"></a><a class="code" href="usymtab_c.html#a133">04523</a> <a class="code" href="usymtab_c.html#a133">usymtab_existsEnumTag</a> (cstring k) <font class="comment">/*@globals globtab@*/</font>
04524 {
04525   cstring ename = <a class="code" href="structNames_c.html#a10">makeEnum</a> (k);
04526   uentry ce = usymtab_lookupAux (globtab, ename);
04527 
04528   <a class="code" href="cstring_c.html#a27">cstring_free</a> (ename);
04529   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)));
04530 }
04531 
04532 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l04533"></a><a class="code" href="usymtab_c.html#a134">04533</a> <font class="preprocessor"></font><font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a134">usymtab_existsVar</a> (cstring k)
04534    <font class="comment">/*@globals utab@*/</font>
04535 {
04536   uentry ce = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (k);
04537 
04538   <font class="keywordflow">return</font> (!(uentry_isUndefined (ce)) &amp;&amp; !(uentry_isPriv (ce)) &amp;&amp; (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (ce)));
04539 }
04540 <font class="preprocessor"># endif</font>
04541 <font class="preprocessor"></font>
04542 <font class="comment">/*</font>
04543 <font class="comment">** destructors</font>
04544 <font class="comment">*/</font>
04545 
04546 <font class="keyword">static</font> <font class="keywordtype">void</font>
04547 refTable_free (<font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> refTable x, <font class="keywordtype">int</font> nentries)<font class="keyword"></font>
04548 <font class="keyword"></font>{
04549   <font class="keywordflow">if</font> (x != NULL)
04550     {
04551       <font class="keywordtype">int</font> i;
04552 
04553       <font class="keywordflow">for</font> (i = 0; i &lt; nentries; i++)
04554         {
04555           <a class="code" href="general_c.html#a0">sfree</a> (x[i]);
04556         }
04557       
04558       <a class="code" href="general_c.html#a0">sfree</a> (x);
04559     }
04560 }
04561   
04562 <font class="keyword">static</font> <font class="keywordtype">void</font>
04563 usymtab_freeLevel (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> usymtab u)
04564   <font class="comment">/*@globals globtab, utab, filetab@*/</font>
04565 {
04566   <font class="keywordtype">int</font> i;
04567 
04568   <a class="code" href="aliasTable_c.html#a22">aliasTable_free</a> (u-&gt;aliases);
04569 
04570   refTable_free (u-&gt;reftable, u-&gt;nentries);
04571 
04572   <font class="keywordflow">if</font> (u == filetab || u == globtab)
04573     {
04574       <font class="keywordflow">for</font> (i = 0; i &lt; u-&gt;nentries; i++)
04575         {
04576           <a class="code" href="uentry_c.html#a239">uentry_freeComplete</a> (u-&gt;entries[i]);
04577         }
04578     }
04579   <font class="keywordflow">else</font>
04580     {
04581       <font class="keywordflow">for</font> (i = 0; i &lt; u-&gt;nentries; i++)
04582         {
04583           <a class="code" href="uentry_c.html#a238">uentry_free</a> (u-&gt;entries[i]);
04584         }
04585     }
04586 
04587   <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (u-&gt;guards);
04588   <a class="code" href="general_c.html#a0">sfree</a> (u-&gt;entries);
04589 
04590   <font class="keywordflow">if</font> (u != globtab 
04591       &amp;&amp; u != utab
04592       &amp;&amp; u != filetab)
04593     {
04594       llassert (u-&gt;htable == NULL);
04595       <a class="code" href="general_c.html#a0">sfree</a> (u);
04596     }
04597 
04598 <font class="comment">/*@-mustfree@*/</font>
04599 } <font class="comment">/*@=mustfree@*/</font>
04600 
04601 <font class="keyword">static</font> <font class="keywordtype">void</font>
04602 usymtab_freeAux (<font class="comment">/*@only@*/</font> usymtab u)
04603    <font class="comment">/*@globals globtab, utab, filetab@*/</font>
04604    <font class="comment">/*@modifies u@*/</font>
04605 {
04606   <font class="keywordflow">while</font> (u != GLOBAL_ENV)
04607     {
04608       usymtab t = u-&gt;env;
04609       usymtab_freeLevel (u);
04610       u = t;
04611       <font class="comment">/*@-branchstate@*/</font> 
04612     } 
04613   <font class="comment">/*@=branchstate@*/</font>
04614 }
04615 
<a name="l04616"></a><a class="code" href="usymtab_c.html#a136">04616</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a136">usymtab_free</a> () 
04617   <font class="comment">/*@globals killed utab, globtab, filetab@*/</font> 
04618   <font class="comment">/*@modifies utab@*/</font>
04619 {
04620   dbgfree = TRUE;
04621   usymtab_freeAux (utab);
04622 }
04623 
04624 <font class="keyword">static</font> <font class="keywordtype">int</font> usymtab_lexicalLevel (<font class="keywordtype">void</font>) <font class="comment">/*@globals utab@*/</font>
04625 {
04626   <font class="keywordflow">return</font> (utab-&gt;lexlevel);
04627 }
04628 
<a name="l04629"></a><a class="code" href="usymtab_c.html#a137">04629</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a137">usymtab_inGlobalScope</a> () <font class="comment">/*@globals utab, globtab@*/</font>
04630 {
04631   <font class="keywordflow">return</font> (utab == globtab);
04632 }
04633 
<a name="l04634"></a><a class="code" href="usymtab_c.html#a138">04634</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a138">usymtab_inFileScope</a> () <font class="comment">/*@globals utab@*/</font>
04635 {
04636   <font class="keywordflow">return</font> (utab-&gt;lexlevel == fileScope);
04637 }
04638 
<a name="l04639"></a><a class="code" href="usymtab_c.html#a139">04639</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a139">usymtab_inFunctionScope</a> () <font class="comment">/*@globals utab@*/</font>
04640 {
04641   <font class="keywordflow">return</font> (utab-&gt;lexlevel == functionScope);
04642 }
04643 
04644 <font class="preprocessor"># ifndef NOLCL</font>
04645 <font class="preprocessor"></font><font class="keywordtype">void</font>
<a name="l04646"></a><a class="code" href="usymtab_c.html#a140">04646</a> <a class="code" href="usymtab_c.html#a140">usymtab_replaceEntry</a> (uentry s)
04647   <font class="comment">/*@globals utab, globtab@*/</font>
04648   <font class="comment">/*@modifies utab, s@*/</font>
04649 {
04650   usymtab_replaceEntryAux (utab, s);
04651 }
04652 <font class="preprocessor"># endif</font>
04653 <font class="preprocessor"></font>
04654 <font class="keywordtype">bool</font>
<a name="l04655"></a><a class="code" href="usymtab_c.html#a141">04655</a> <a class="code" href="usymtab_c.html#a141">usymtab_matchForwardStruct</a> (usymId u1, usymId u2)
04656    <font class="comment">/*@globals globtab@*/</font>
04657 {
04658   uentry ue1 = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (u1);
04659   uentry ue2 = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (u2);
04660 
04661   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (ue2))
04662     {
04663       ctype reptype = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue1);
04664       
04665       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (reptype))
04666         {
04667           ctype repbase = <a class="code" href="ctype_c.html#a112">ctype_getBaseType</a> (reptype);
04668   
04669           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (repbase))
04670             {
04671               typeId rtuid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (repbase);
04672 
04673               <font class="keywordflow">if</font> (u2 == rtuid) <font class="keywordflow">return</font> TRUE;
04674               
04675               <font class="keywordflow">if</font> (usymId_isValid (rtuid))
04676                 {
04677                   reptype = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (usymtab_getTypeEntry (rtuid));
04678                   
04679                   <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (reptype) &amp;&amp; (u2 == (<a class="code" href="ctype_c.html#a105">ctype_typeId</a> (reptype))));
04680                 }
04681             }
04682         }
04683     }
04684   
04685   <font class="keywordflow">return</font> FALSE;
04686 }
04687 
<a name="l04688"></a><a class="code" href="usymtab_c.html#a142">04688</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a142">usymtab_addGuards</a> (guardSet guards)
04689   <font class="comment">/*@modifies utab@*/</font>
04690 {
04691   utab-&gt;guards = <a class="code" href="guardSet_c.html#a7">guardSet_union</a> (utab-&gt;guards, guards);
04692   }
04693 
04694 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_isGuardedAux (sRef s)
04695   <font class="comment">/*@globals utab@*/</font>
04696 {
04697   usymtab tab = utab;
04698   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
04699   <font class="keywordtype">int</font> lowlevel = paramsScope;
04700   <font class="keywordtype">int</font> baselevel = <a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (base);
04701 
04702   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (base))
04703     {
04704       lowlevel = baselevel;
04705       <font class="keywordflow">if</font> (lowlevel &lt; paramsScope) lowlevel = paramsScope;
04706     }
04707   
04708   <font class="keywordflow">while</font> (tab-&gt;lexlevel &gt;= lowlevel)
04709     {
04710       <font class="keywordflow">if</font> (<a class="code" href="guardSet_c.html#a17">guardSet_isGuarded</a> (tab-&gt;guards, s))
04711         {
04712           <font class="comment">/*</font>
04713 <font class="comment">          if (!sRef_definitelyNull (s))</font>
04714 <font class="comment">            {</font>
04715 <font class="comment">              sRef_setNotNull (s, fileloc_undefined);</font>
04716 <font class="comment">            }</font>
04717 <font class="comment">            */</font>
04718           <font class="keywordflow">return</font> TRUE;
04719         }
04720 
04721       tab = usymtab_dropEnv (tab);
04722     }
04723   
04724   <font class="keywordflow">return</font> FALSE;
04725 }
04726 
<a name="l04727"></a><a class="code" href="usymtab_c.html#a144">04727</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a144">usymtab_unguard</a> (sRef s) <font class="comment">/*@modifies utab@*/</font>
04728 {
04729   usymtab tab = utab;
04730   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
04731   <font class="keywordtype">int</font> lowlevel = paramsScope;
04732   <font class="keywordtype">int</font> baselevel = <a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (base);
04733   
04734   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (base))
04735     {
04736       lowlevel = baselevel;
04737       <font class="keywordflow">if</font> (lowlevel &lt; paramsScope) lowlevel = paramsScope;
04738     }
04739 
04740   <font class="keywordflow">while</font> (tab-&gt;lexlevel &gt;= lowlevel)
04741     {
04742       <font class="keywordflow">if</font> (<a class="code" href="guardSet_c.html#a17">guardSet_isGuarded</a> (tab-&gt;guards, s))
04743         {
04744           <a class="code" href="guardSet_c.html#a3">guardSet_delete</a> (tab-&gt;guards, s);
04745         }
04746       
04747       tab = usymtab_dropEnv (tab);
04748     }
04749 }
04750 
<a name="l04751"></a><a class="code" href="usymtab_c.html#a145">04751</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (sRef s)<font class="keyword"></font>
04752 <font class="keyword"></font>{
04753   
04754   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a320">sRef_aliasCompleteSimplePred</a> (usymtab_isGuardedAux, s));
04755 }
04756 
<a name="l04757"></a><a class="code" href="usymtab_c.html#a146">04757</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a146">usymtab_isProbableNull</a> (sRef s)<font class="keyword"></font>
04758 <font class="keyword"></font>{
04759   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (usymtab_isProbableNullAux, s));
04760 }
04761 
<a name="l04762"></a><a class="code" href="usymtab_c.html#a147">04762</a> <font class="keywordtype">bool</font> <a class="code" href="usymtab_c.html#a147">usymtab_isProbableDeepNull</a> (sRef s)<font class="keyword"></font>
04763 <font class="keyword"></font>{
04764   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (usymtab_isProbableNull, s));
04765 }
04766 
04767 <font class="keyword">static</font> <font class="keywordtype">bool</font> usymtab_isProbableNullAux (sRef s)
04768   <font class="comment">/*@globals utab@*/</font>
04769 {
04770   usymtab tab = utab;
04771   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
04772   <font class="keywordtype">int</font>  lowlevel = paramsScope;
04773   
04774   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (base))
04775     {
04776       lowlevel = <a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (base);
04777       <font class="keywordflow">if</font> (lowlevel &lt; paramsScope) lowlevel = paramsScope;
04778     }
04779   
04780   <font class="keywordflow">while</font> (tab-&gt;lexlevel &gt;= lowlevel)
04781     {
04782       <font class="keywordflow">if</font> (<a class="code" href="guardSet_c.html#a18">guardSet_isProbableNull</a> (tab-&gt;guards, s))
04783         {
04784           <font class="keywordflow">return</font> TRUE;
04785         }
04786       
04787       <font class="keywordflow">while</font> (tab-&gt;kind == US_CBRANCH) 
04788         {
04789           tab = tab-&gt;env;
04790         }
04791 
04792       llassert (usymtab_isDefined (tab));
04793 
04794       <font class="keywordflow">if</font> (tab-&gt;kind == US_FBRANCH)
04795         {
04796           tab = tab-&gt;env;
04797           llassert (tab-&gt;kind == US_TBRANCH);
04798         }
04799       
04800       tab = tab-&gt;env;
04801     }
04802 
04803   <font class="keywordflow">return</font> FALSE;
04804 }
04805 
04806 <font class="keywordtype">void</font>
<a name="l04807"></a><a class="code" href="usymtab_c.html#a148">04807</a> <a class="code" href="usymtab_c.html#a148">usymtab_printGuards</a> ()
04808   <font class="comment">/*@globals utab, globtab@*/</font>
04809 {
04810   usymtab ttab = utab;
04811 
04812   <font class="keywordflow">while</font> (ttab != globtab)
04813     {
04814       <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Guards [%d]: %q"</font>, ttab-&gt;lexlevel,
04815                       guardSet_unparse (ttab-&gt;guards)));
04816       ttab = ttab-&gt;env;
04817     }
04818 }
04819 
04820 <font class="keywordtype">void</font>
<a name="l04821"></a><a class="code" href="usymtab_c.html#a149">04821</a> <a class="code" href="usymtab_c.html#a149">usymtab_displayAllUses</a> ()
04822   <font class="comment">/*@globals utab, globtab@*/</font>
04823 {
04824   usymtab copy;
04825 
04826   <font class="comment">/* only in top scope */</font>
04827   llassert (utab == globtab);
04828 
04829   <font class="comment">/* need a copy, so order is not messed up by sort! */</font>  
04830   copy = usymtab_shallowCopy (globtab); 
04831   
04832   qsort (copy-&gt;entries, (size_t)copy-&gt;nentries, 
04833          <font class="keyword">sizeof</font> (*copy-&gt;entries), (int (*)(<font class="keyword">const</font> <font class="keywordtype">void</font> *, <font class="keyword">const</font> <font class="keywordtype">void</font> *)) uentry_xcompareuses);
04834 
04835   usymtab_entries (copy, ue)<font class="keyword"></font>
04836 <font class="keyword">    </font>{
04837       <font class="keywordflow">if</font> (uentry_isValid (ue))
04838         {
04839           filelocList uses = uentry_getUses (ue);
04840           <font class="keywordtype">int</font> size = <a class="code" href="filelocList_c.html#a9">filelocList_realSize</a> (uses);
04841 
04842           <font class="keywordflow">if</font> (fileloc_isDefined (uentry_whereDefined (ue)) 
04843               &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (uentry_whereDefined (ue))
04844               &amp;&amp; (size &gt; 0))
04845             {
04846               <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"%q (%q), %d use%p:\n   %q"</font>, 
04847                               uentry_getName (ue),
04848                               <a class="code" href="fileloc_c.html#a39">fileloc_unparse</a> (uentry_whereDefined (ue)),
04849                               size, <a class="code" href="filelocList_c.html#a10">filelocList_unparseUses</a> (uses)));
04850             }
04851         }
04852     } end_usymtab_entries;
04853   
04854   usymtab_shallowFree (copy);
04855 }
04856 
04857 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@exposed@*/</font> usymtab
04858 usymtab_getFileTab ()
04859   <font class="comment">/*@globals filetab@*/</font>
04860 {
04861   llassert (filetab != NULL);
04862 
04863   <font class="keywordflow">return</font> filetab;
04864 }
04865 
04866 <font class="comment">/*@only@*/</font> cstring
<a name="l04867"></a><a class="code" href="usymtab_c.html#a150">04867</a> <a class="code" href="usymtab_c.html#a150">usymtab_unparseStack</a> ()
04868   <font class="comment">/*@globals utab@*/</font>
04869 {
04870   <font class="keywordflow">return</font> (usymtab_unparseStackTab (utab));
04871 }
04872  
04873 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
04874 usymtab_unparseStackTab (usymtab t)<font class="keyword"></font>
04875 <font class="keyword"></font>{
04876   <font class="keywordtype">bool</font> firstOne = TRUE;
04877   cstring ret = cstring_makeLiteral (<font class="stringliteral">"["</font>);
04878 
04879   <font class="keywordflow">while</font> (t != GLOBAL_ENV)
04880     {
04881       <font class="keywordflow">if</font> (firstOne)
04882         {
04883           ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q"</font>, ret, usymtab_typeName (t));
04884           firstOne = FALSE;
04885         }
04886       <font class="keywordflow">else</font>
04887         {
04888           ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q, %q"</font>, ret, usymtab_typeName (t));
04889         }
04890       t = t-&gt;env;
04891     }
04892 
04893   ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q ]"</font>, ret);
04894   <font class="keywordflow">return</font> ret;
04895 }
04896 
04897 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
04898 usymtab_typeName (<font class="comment">/*@notnull@*/</font> usymtab t)<font class="keyword"></font>
04899 <font class="keyword"></font>{
04900   <font class="keywordflow">switch</font> (t-&gt;kind)
04901     {
04902     <font class="keywordflow">case</font> US_GLOBAL:  <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"global"</font>);
04903     <font class="keywordflow">case</font> US_NORMAL:  <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"normal"</font>);
04904     <font class="keywordflow">case</font> US_TBRANCH: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"true"</font>);
04905     <font class="keywordflow">case</font> US_FBRANCH: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"false"</font>);
04906     <font class="keywordflow">case</font> US_CBRANCH: <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"case"</font>);
04907     <font class="keywordflow">case</font> US_SWITCH:  <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"switch"</font>);
04908     }
04909   
04910   BADEXIT;
04911 }
04912 
<a name="l04913"></a><a class="code" href="usymtab_c.html#a151">04913</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a151">usymtab_addMustAlias</a> (sRef s, sRef al)
04914   <font class="comment">/*@modifies utab@*/</font>
04915 {
04916   <font class="keywordflow">if</font> (sRef_isMeaningful (s) &amp;&amp; sRef_isMeaningful (al)
04917       &amp;&amp; !(<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s) || <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (al))
04918       &amp;&amp; !(<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (al) &amp;&amp; <a class="code" href="sRef_c.html#a247">sRef_isDirectParam</a> (sRef_getBase (al)))
04919       &amp;&amp; !(<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s, al)))
04920     {
04921       utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a8">aliasTable_addMustAlias</a> (utab-&gt;aliases, s, al); 
04922       DPRINTF ((<font class="stringliteral">"Must alias: %s"</font>, aliasTable_unparse (utab-&gt;aliases)));
04923 
04924       <font class="comment">/*</font>
04925 <font class="comment">      ** for local variable, aliasing is symmetric </font>
04926 <font class="comment">      */</font>
04927       
04928       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (s) &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (al))
04929         {
04930           utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a8">aliasTable_addMustAlias</a> (utab-&gt;aliases, al, s); 
04931         }
04932     }
04933   <font class="keywordflow">else</font>
04934     {
04935       ;
04936     }
04937 }
04938 
04939 <font class="comment">/*</font>
04940 <font class="comment">** Same as usymtab_addMustAlias, except does not check sRef_isSimilar.</font>
04941 <font class="comment">*/</font>
04942 
<a name="l04943"></a><a class="code" href="usymtab_c.html#a152">04943</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a152">usymtab_addForceMustAlias</a> (sRef s, sRef al)
04944   <font class="comment">/*@modifies utab@*/</font>
04945 {
04946   <font class="keywordflow">if</font> (sRef_isMeaningful (s) 
04947       &amp;&amp; sRef_isMeaningful (al)
04948       &amp;&amp; !(<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s) || <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (al))
04949       &amp;&amp; !(<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (al) &amp;&amp; <a class="code" href="sRef_c.html#a247">sRef_isDirectParam</a> (sRef_getBase (al))))
04950     {
04951       utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a8">aliasTable_addMustAlias</a> (utab-&gt;aliases, s, al); 
04952       DPRINTF ((<font class="stringliteral">"Must alias: %s"</font>, aliasTable_unparse (utab-&gt;aliases)));
04953 
04954       <font class="comment">/*</font>
04955 <font class="comment">      ** for local variable, aliasing is symmetric </font>
04956 <font class="comment">      */</font>
04957       
04958       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (s) &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (al))
04959         {
04960           utab-&gt;aliases = <a class="code" href="aliasTable_c.html#a8">aliasTable_addMustAlias</a> (utab-&gt;aliases, al, s); 
04961         }
04962     }
04963   <font class="keywordflow">else</font>
04964     {
04965       ;
04966     }
04967 }
04968 
<a name="l04969"></a><a class="code" href="usymtab_c.html#a153">04969</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a153">usymtab_clearAlias</a> (sRef s)
04970   <font class="comment">/*@modifies utab, s@*/</font>
04971 {
04972   
04973   <a class="code" href="aliasTable_c.html#a11">aliasTable_clearAliases</a> (utab-&gt;aliases, s); 
04974 }
04975 
<a name="l04976"></a><a class="code" href="usymtab_c.html#a154">04976</a> sRefSet <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (sRef s)
04977    <font class="comment">/*@globals utab@*/</font>  
04978 {
04979   <font class="keywordflow">if</font> (sRef_isMeaningful (s))
04980     {
04981       sRefSet ret;
04982 
04983             
04984       ret = <a class="code" href="sRefSet_c.html#a11">sRefSet_unionFree</a> (aliasTable_aliasedBy (utab-&gt;aliases, s),
04985                                <a class="code" href="aliasTable_c.html#a13">aliasTable_canAlias</a> (utab-&gt;aliases, s));
04986             <font class="keywordflow">return</font> (ret);
04987     }
04988   <font class="keywordflow">else</font>
04989     {
04990       <font class="keywordflow">return</font> sRefSet_undefined;
04991     }
04992 }
04993 
<a name="l04994"></a><a class="code" href="usymtab_c.html#a155">04994</a> <font class="comment">/*@only@*/</font> sRefSet <a class="code" href="usymtab_c.html#a155">usymtab_canAlias</a> (sRef s)
04995   <font class="comment">/*@globals utab@*/</font>
04996 {
04997   <font class="keywordflow">if</font> (sRef_isMeaningful (s))
04998     {
04999       sRefSet res = <a class="code" href="aliasTable_c.html#a13">aliasTable_canAlias</a> (utab-&gt;aliases, s);
05000 
05001       <font class="keywordflow">return</font> res;
05002     }
05003 
05004   <font class="keywordflow">return</font> sRefSet_undefined;
05005 }
05006 
<a name="l05007"></a><a class="code" href="usymtab_c.html#a156">05007</a> <font class="comment">/*@only@*/</font> sRefSet <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (sRef s)
05008   <font class="comment">/*@globals utab@*/</font>
05009 {
05010   <font class="keywordflow">return</font> (<a class="code" href="aliasTable_c.html#a12">aliasTable_aliasedBy</a> (utab-&gt;aliases, s));
05011 }
05012 
<a name="l05013"></a><a class="code" href="usymtab_c.html#a157">05013</a> <font class="comment">/*@only@*/</font> cstring <a class="code" href="usymtab_c.html#a157">usymtab_unparseAliases</a> ()
05014   <font class="comment">/*@globals utab@*/</font>
05015 {
05016   <font class="keywordflow">return</font> (<a class="code" href="aliasTable_c.html#a20">aliasTable_unparse</a> (utab-&gt;aliases));
05017 }
05018 
05019 <font class="comment">/*</font>
05020 <font class="comment">** Debugging routines:</font>
05021 <font class="comment">**    okay to leak storage here, only for debugging </font>
05022 <font class="comment">*/</font>
05023 
05024 <font class="comment">/*@-mustfree@*/</font> 
05025 
05026 <font class="keywordtype">void</font>
<a name="l05027"></a><a class="code" href="usymtab_c.html#a158">05027</a> <a class="code" href="usymtab_c.html#a158">usymtab_printOut</a> (<font class="keywordtype">void</font>)
05028   <font class="comment">/*@globals utab@*/</font>
05029 {
05030   <font class="keywordtype">int</font> i;
05031   usymtab s = utab;
05032   <font class="keywordtype">int</font> depth = 0;
05033   <font class="keywordtype">char</font> *ind = <a class="code" href="general_c.html#a27">mstring_copy</a> (<font class="stringliteral">"               "</font>);
05034 
05035   fprintf (g_msgstream, <font class="stringliteral">"&lt;&lt;&lt; [symbol table] &gt;&gt;&gt;\n"</font>);
05036   
05037   <font class="keywordflow">while</font> (s != GLOBAL_ENV &amp;&amp; s-&gt;env != GLOBAL_ENV)
05038     {
05039       cstring tname = usymtab_typeName (s);
05040 
05041       <font class="keywordflow">if</font> (depth &lt; 5)
05042         {
05043           ind[depth * 3 + 1] = <font class="charliteral">'\0'</font>;
05044         }
05045      
05046       fprintf (g_msgstream, <font class="stringliteral">"level: %d (%s)\n"</font>, s-&gt;lexlevel,
05047                cstring_toCharsSafe (tname));
05048 
05049       <a class="code" href="cstring_c.html#a27">cstring_free</a> (tname);
05050 
05051       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05052         {
05053           cstring us = <a class="code" href="uentry_c.html#a156">uentry_unparseFull</a> (s-&gt;entries[i]);
05054           fprintf (g_msgstream, <font class="stringliteral">"%s\n"</font>, cstring_toCharsSafe (us));
05055           <a class="code" href="cstring_c.html#a27">cstring_free</a> (us);
05056         }
05057       
05058       <font class="keywordflow">if</font> (s-&gt;reftable != NULL &amp;&amp; s-&gt;nentries &gt; 0)
05059         {
05060           fprintf (g_msgstream, <font class="stringliteral">"\t&lt;&lt; Ref table &gt;&gt;\n"</font>);
05061 
05062           <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05063             {
05064               fprintf (g_msgstream, <font class="stringliteral">"\t%s %3d: %d, %d\n"</font>, ind, i, 
05065                        s-&gt;reftable[i]-&gt;level,
05066                        s-&gt;reftable[i]-&gt;index);
05067             }
05068         }
05069 
05070       ind[depth * 3 + 1] = <font class="charliteral">' '</font>;
05071       depth++;
05072       s = s-&gt;env;
05073     }
05074   fprintf (g_msgstream, <font class="stringliteral">"&lt;&lt;&lt; end usymtab &gt;&gt;&gt;\n"</font>);
05075   mstring_free (ind);
05076   <font class="keywordflow">return</font>;
05077 }
05078 
05079 <font class="keywordtype">void</font>
<a name="l05080"></a><a class="code" href="usymtab_c.html#a159">05080</a> <a class="code" href="usymtab_c.html#a159">usymtab_printTypes</a> ()
05081   <font class="comment">/*@globals globtab@*/</font>
05082 {
05083   usymtab_printAllAux (globtab);
05084 }
05085 
05086 <font class="keywordtype">void</font> 
<a name="l05087"></a><a class="code" href="usymtab_c.html#a160">05087</a> <a class="code" href="usymtab_c.html#a160">usymtab_printAll</a> (<font class="keywordtype">void</font>)
05088   <font class="comment">/*@globals utab@*/</font>
05089 {
05090   usymtab_printAllAux (utab);
05091 }
05092 
05093 <font class="keyword">static</font> <font class="keywordtype">void</font>
05094 usymtab_printAllAux (usymtab s)
05095    <font class="comment">/*@modifies g_msgstream@*/</font>
05096 {
05097   <font class="keywordtype">int</font> i;
05098   <font class="keywordtype">int</font> depth = 0;
05099   <font class="keywordtype">char</font> *ind = <a class="code" href="general_c.html#a27">mstring_copy</a> (<font class="stringliteral">"               "</font>);
05100 
05101   printf (<font class="stringliteral">"[[[ usymtab ]]]"</font>);
05102 
05103   <font class="keywordflow">while</font> (s != GLOBAL_ENV)
05104     {
05105       <font class="keywordflow">if</font> (depth &lt; 5)
05106         ind[depth * 3 + 1] = <font class="charliteral">'\0'</font>;
05107       
05108       <font class="keywordflow">if</font> (s-&gt;env == GLOBAL_ENV)
05109         {
05110           <font class="keywordtype">int</font> looplow;
05111 
05112           printf (<font class="stringliteral">"level: %d / break: %s / exit: %s\n"</font>, s-&gt;lexlevel,
05113                   cstring_toCharsSafe (bool_unparse (s-&gt;mustBreak)), 
05114                   <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (exitkind_unparse (s-&gt;exitCode)));
05115 
05116           looplow = 0;
05117 
05118           <font class="keywordflow">for</font> (i = looplow; i &lt; s-&gt;nentries; i++)
05119             {
05120               printf (<font class="stringliteral">"%s%3d. %s\n"</font>, ind, i, 
05121                       cstring_toCharsSafe (uentry_unparseFull (s-&gt;entries[i])));
05122             }
05123         }
05124       <font class="keywordflow">else</font>
05125         {
05126           printf (<font class="stringliteral">"level: %d / break: %s / exit: %s\n"</font>, s-&gt;lexlevel,
05127                   cstring_toCharsSafe (bool_unparse (s-&gt;mustBreak)),
05128                   <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (exitkind_unparse (s-&gt;exitCode)));
05129 
05130           <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05131             {
05132               printf (<font class="stringliteral">"%s%3d %s\n"</font>, ind, i, 
05133                      cstring_toCharsSafe (uentry_unparseFull (s-&gt;entries[i])));
05134             }
05135         }
05136       
05137       ind[depth * 3 + 1] = <font class="charliteral">' '</font>;
05138       depth++;
05139       s = s-&gt;env;
05140     }
05141   printf (<font class="stringliteral">"----------\n"</font>);
05142 }
05143 
05144 <font class="keywordtype">void</font>
<a name="l05145"></a><a class="code" href="usymtab_c.html#a161">05145</a> <a class="code" href="usymtab_c.html#a161">usymtab_printComplete</a> ()
05146   <font class="comment">/*@globals utab@*/</font>
05147 {
05148   <font class="keywordtype">int</font> i;
05149   <font class="keywordtype">int</font> depth = 0;
05150   <font class="keywordtype">char</font> *ind = <a class="code" href="general_c.html#a27">mstring_copy</a> (<font class="stringliteral">"               "</font>);
05151   usymtab s = utab;
05152 
05153   <font class="keywordflow">while</font> (s != GLOBAL_ENV)
05154     {
05155       <font class="keywordflow">if</font> (depth &lt; 5)
05156         {
05157           ind[depth * 3 + 1] = <font class="charliteral">'\0'</font>;
05158         }
05159       
05160       <font class="keywordflow">if</font> (s-&gt;env == GLOBAL_ENV)
05161         {
05162           <font class="keywordtype">int</font> looplow;
05163 
05164           printf (<font class="stringliteral">"level: %d\n"</font>, s-&gt;lexlevel);
05165 
05166           looplow = 0;
05167 
05168           <font class="keywordflow">for</font> (i = looplow; i &lt; s-&gt;nentries; i++)
05169             {
05170               printf (<font class="stringliteral">"%s%3d %s\n"</font>, ind, i, 
05171                       cstring_toCharsSafe (uentry_unparse (s-&gt;entries[i])));
05172             }
05173         }
05174       <font class="keywordflow">else</font>
05175         {
05176           printf (<font class="stringliteral">"level: %d\n"</font>, s-&gt;lexlevel);
05177           <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05178             {
05179               printf (<font class="stringliteral">"%s%3d %s\n"</font>, ind, i, 
05180                      cstring_toCharsSafe (uentry_unparse (s-&gt;entries[i])));
05181             }
05182         }
05183       
05184       ind[depth * 3 + 1] = <font class="charliteral">' '</font>;
05185       depth++;
05186       s = s-&gt;env;
05187     }
05188 
05189   printf (<font class="stringliteral">"----------\n"</font>);
05190   mstring_free (ind);
05191 }
05192 
05193 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring <font class="comment">/*@unused@*/</font> 
05194 usymtab_unparseLocalAux (<font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
05195 <font class="keyword"></font>{
05196   cstring c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"lexlevel: %d\n"</font>, s-&gt;lexlevel);
05197   <font class="keywordtype">int</font> i;
05198 
05199   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05200     {
05201       c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q\n%q"</font>, c, uentry_unparseFull (s-&gt;entries[i]));
05202     }
05203 
05204   c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q\n========="</font>, c);
05205   <font class="keywordflow">return</font> (c);
05206 }
05207 
05208 <font class="keyword">static</font> cstring <font class="comment">/*@unused@*/</font> <font class="comment">/*@only@*/</font> 
05209 usymtab_unparseLocalList (<font class="comment">/*@notnull@*/</font> usymtab s)<font class="keyword"></font>
05210 <font class="keyword"></font>{
05211   cstring c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%d/%s/%s] "</font>, s-&gt;lexlevel, 
05212                        bool_unparse (s-&gt;mustBreak), 
05213                        <a class="code" href="varKinds_c.html#a23">exitkind_unparse</a> (s-&gt;exitCode));
05214   <font class="keywordtype">int</font> i;
05215 
05216   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05217     {
05218       sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (s-&gt;entries[i]);
05219 
05220       <font class="keywordflow">if</font> (i == 0)
05221         {
05222           c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q: %q [%b]"</font>, c, uentry_getName (s-&gt;entries[i]), 
05223                        sRef_isStateDefined (sr));
05224         }
05225       <font class="keywordflow">else</font>
05226         {
05227           c = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q, %q [%b]"</font>, c, uentry_getName (s-&gt;entries[i]), 
05228                        sRef_isStateDefined (sr));
05229         }
05230 
05231     }
05232 
05233   <font class="keywordflow">return</font> (c);
05234 }
05235 
05236 <font class="keywordtype">void</font>
<a name="l05237"></a><a class="code" href="usymtab_c.html#a162">05237</a> <a class="code" href="usymtab_c.html#a162">usymtab_printLocal</a> (<font class="keywordtype">void</font>)
05238   <font class="comment">/*@globals utab@*/</font>
05239 {
05240   <font class="keywordtype">int</font> i;
05241   usymtab s = utab;
05242 
05243   printf (<font class="stringliteral">"lexlevel: %d\n"</font>, s-&gt;lexlevel);
05244 
05245   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05246     {
05247       printf (<font class="stringliteral">"%s\n"</font>, cstring_toCharsSafe (uentry_unparseFull (s-&gt;entries[i])));
05248     }
05249   
05250   <font class="keywordflow">while</font> (s-&gt;lexlevel &gt; 1)
05251     {
05252       s = s-&gt;env;
05253     }
05254 
05255   llassert (usymtab_isDefined (s));
05256 
05257   printf (<font class="stringliteral">"Params:\n"</font>);
05258 
05259   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nentries; i++)
05260     {
05261       printf (<font class="stringliteral">"%d: %s\n"</font>, i, 
05262               cstring_toCharsSafe (uentry_unparseFull (s-&gt;entries[i])));
05263     }
05264 }
05265 <font class="comment">/*@=mustfree@*/</font>
05266 
05267 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkDistinctExternalName (uentry e)
05268   <font class="comment">/*@globals globtab@*/</font>
05269   <font class="comment">/*@modifies *g_msgstream@*/</font>
05270 {
05271   <font class="keywordtype">int</font> checklen = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_EXTERNALNAMELEN);
05272   <font class="keywordtype">bool</font> ignorecase = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_EXTERNALNAMECASEINSENSITIVE);
05273   <font class="keywordtype">bool</font> gotone = FALSE;
05274   <font class="keywordtype">bool</font> extras = FALSE;
05275   <font class="keywordtype">bool</font> hasError = FALSE;
05276   cstring name = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e);
05277   usymtab st = globtab;
05278 
05279   <font class="keywordflow">if</font> (checklen == 0)
05280     {
05281       ;
05282     }
05283   <font class="keywordflow">else</font>
05284     {
05285       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e)) 
05286         {
05287           checklen++;  <font class="comment">/* the tag marker doesn't count */</font>
05288         }
05289     }
05290 
05291   usymtab_entries (st, oe)<font class="keyword"></font>
05292 <font class="keyword">    </font>{
05293       <font class="keywordflow">if</font> (uentry_sameObject (oe, e))
05294         {
05295           <font class="keywordflow">continue</font>;
05296         }
05297 
05298       <font class="keywordflow">if</font> (checklen == 0)
05299         {
05300           <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a20">cstring_equalCaseInsensitive</a> (uentry_rawName (oe), name))
05301             {
05302               <font class="keywordflow">if</font> (gotone)
05303                 {
05304                   extras = TRUE;
05305                   <font class="keywordflow">break</font>;
05306                 }
05307               
05308               <font class="keywordflow">if</font> (optgenerror 
05309                   (FLG_DISTINCTEXTERNALNAMES,
05310                    message 
05311                    (<font class="stringliteral">"External identifier %q is not distinguishable from %q "</font>
05312                     <font class="stringliteral">"because alphabetical case is ignored"</font>,
05313                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05314                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe)),
05315                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05316                 {
05317                   <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05318                   <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05319                   gotone = TRUE;
05320                 }
05321             }
05322         }
05323       <font class="keywordflow">else</font>
05324         {
05325           <font class="keywordflow">if</font> (ignorecase)
05326             {
05327               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a21">cstring_equalLenCaseInsensitive</a> (uentry_rawName (oe),
05328                                                    name, checklen))
05329                 {
05330                   <font class="keywordflow">if</font> (gotone)
05331                     {
05332                       extras = TRUE;
05333                       <font class="keywordflow">break</font>;
05334                     }
05335                   
05336                   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a19">cstring_equalLen</a> (uentry_rawName (oe), name, checklen))
05337                     {
05338                       <font class="keywordflow">if</font> (optgenerror 
05339                           (FLG_DISTINCTEXTERNALNAMES,
05340                            <font class="comment">/*@-sefparams@*/</font>
05341                            message 
05342                            (<font class="stringliteral">"External identifier %q is not distinguishable from %q "</font>
05343                             <font class="stringliteral">"in the first %d characters (%q)"</font>,
05344                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05345                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05346                             checklen,
05347                             <a class="code" href="cstring_c.html#a33">cstring_clip</a> (uentry_getName (e), checklen)),
05348                            <font class="comment">/*@=sefparams@*/</font>
05349                            <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05350                         {
05351                           <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05352                           <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05353                           gotone = TRUE;
05354                         }
05355                     }
05356                   <font class="keywordflow">else</font>
05357                     {
05358                       <font class="keywordflow">if</font> (gotone)
05359                         {
05360                           extras = TRUE;
05361                           <font class="keywordflow">break</font>;
05362                         }
05363                       
05364                       <font class="keywordflow">if</font> (optgenerror 
05365                           (FLG_DISTINCTEXTERNALNAMES,
05366                            message 
05367                            (<font class="stringliteral">"External identifier %q is not distinguishable from %q "</font>
05368                             <font class="stringliteral">"in the first %d characters because alphabetical case "</font>
05369                             <font class="stringliteral">"is ignored"</font>,
05370                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05371                             <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05372                             checklen),
05373                            <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05374                         {
05375                           <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05376                           <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05377                           gotone = TRUE;
05378                         }
05379                     }
05380                 }
05381             }
05382           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a19">cstring_equalLen</a> (uentry_rawName (oe), name, checklen))
05383             {
05384               <font class="keywordflow">if</font> (gotone)
05385                 {
05386                   extras = TRUE;
05387                   <font class="keywordflow">break</font>;
05388                 }
05389               
05390               <font class="keywordflow">if</font> (optgenerror 
05391                   (FLG_DISTINCTEXTERNALNAMES,
05392                    <font class="comment">/*@-sefparams@*/</font>
05393                    message 
05394                    (<font class="stringliteral">"External identifier %q is not distinguishable from %q "</font>
05395                     <font class="stringliteral">"in the first %d characters (%q)"</font>,
05396                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05397                     <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05398                     checklen,
05399                     <a class="code" href="cstring_c.html#a33">cstring_clip</a> (uentry_getName (e), checklen)),
05400                    <font class="comment">/*@=sefparams@*/</font>
05401                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05402                 {
05403                   <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05404                   <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05405                   gotone = TRUE;
05406                 }
05407             }
05408           <font class="keywordflow">else</font>
05409             {
05410               ; <font class="comment">/* okay */</font>
05411             }
05412         }
05413     } end_usymtab_entries ;
05414 
05415   hasError = gotone;
05416   
05417   <font class="keywordflow">if</font> (extras)
05418     {
05419       llgenindentmsgnoloc
05420         (cstring_makeLiteral (<font class="stringliteral">"One or more additional "</font>
05421                               <font class="stringliteral">"indistinguishable external "</font>
05422                               <font class="stringliteral">"names not reported"</font>));
05423     }
05424 
05425   <font class="keywordflow">return</font> hasError;
05426 }
05427 
05428 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkDistinctInternalName (uentry e)
05429   <font class="comment">/*@globals utab@*/</font>
05430   <font class="comment">/*@modifies *g_msgstream@*/</font>
05431 {
05432   usymtab ttab = utab;
05433   cstring name = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (e);
05434   <font class="keywordtype">int</font> numchars = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_INTERNALNAMELEN);
05435   <font class="keywordtype">bool</font> caseinsensitive = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INTERNALNAMECASEINSENSITIVE);
05436   <font class="keywordtype">bool</font> lookalike = <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INTERNALNAMELOOKALIKE);
05437 
05438   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a128">uentry_isAnyTag</a> (e) &amp;&amp; (numchars != 0))
05439     {
05440       numchars++;  <font class="comment">/* the tag marker doesn't count */</font>
05441     }
05442   
05443   <font class="keywordflow">while</font> (usymtab_isDefined (ttab))
05444     {
05445       usymtab_entries (ttab, oe)<font class="keyword"></font>
05446 <font class="keyword">        </font>{
05447           <font class="keywordflow">if</font> (uentry_sameObject (oe, e))
05448             {
05449               <font class="comment">/*@innercontinue@*/</font> <font class="keywordflow">continue</font>;
05450             }
05451 
05452           <font class="keywordflow">switch</font> (cstring_genericEqual
05453                   (name, <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (oe),
05454                    numchars, caseinsensitive, lookalike))
05455             {
05456             <font class="keywordflow">case</font> CGE_DISTINCT: <font class="comment">/* okay */</font>
05457               <font class="comment">/*@switchbreak@*/</font> 
05458               <font class="keywordflow">break</font>;
05459             <font class="keywordflow">case</font> CGE_SAME:
05460               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (name, uentry_rawName (oe)))
05461                 {
05462                   ; <font class="comment">/* got a shadow error */</font>
05463                 }
05464               <font class="keywordflow">else</font>
05465                 {
05466                   <font class="keywordflow">if</font> (optgenerror 
05467                       (FLG_DISTINCTINTERNALNAMES,
05468                        <font class="comment">/*@-sefparams@*/</font>
05469                        message 
05470                        (<font class="stringliteral">"Internal identifier %q is not distinguishable from %q "</font>
05471                         <font class="stringliteral">"in the first %d characters (%q)"</font>,
05472                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05473                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05474                         numchars,
05475                         <a class="code" href="cstring_c.html#a33">cstring_clip</a> (uentry_getName (e), numchars)),
05476                        <font class="comment">/*@=sefparams@*/</font>
05477                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05478                     {
05479                       <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05480                       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05481                       <font class="keywordflow">return</font> TRUE;
05482                     }
05483                 }
05484               <font class="comment">/*@switchbreak@*/</font>
05485               <font class="keywordflow">break</font>;
05486             <font class="keywordflow">case</font> CGE_CASE:
05487               <font class="keywordflow">if</font> (numchars == 0 
05488                   || (<a class="code" href="cstring_c.html#a30">cstring_length</a> (name) &lt;= numchars))
05489                 {
05490                   <font class="keywordflow">if</font> (optgenerror 
05491                       (FLG_DISTINCTINTERNALNAMES,
05492                        message 
05493                        (<font class="stringliteral">"Internal identifier %q is not distinguishable from %q "</font>
05494                         <font class="stringliteral">"without case sensitivity"</font>,
05495                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05496                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe)),
05497                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05498                     {
05499                       <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05500                       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05501                       <font class="keywordflow">return</font> TRUE;
05502                     }
05503                 }
05504               <font class="keywordflow">else</font> 
05505                 {
05506                   <font class="keywordflow">if</font> (optgenerror 
05507                       (FLG_DISTINCTINTERNALNAMES,
05508                        message 
05509                        (<font class="stringliteral">"Internal identifier %q is not distinguishable from %q "</font>
05510                         <font class="stringliteral">"in the first %d characters without case sensitivity"</font>,
05511                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05512                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05513                         numchars),
05514                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05515                     {
05516                       <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05517                       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05518                       <font class="keywordflow">return</font> TRUE;
05519                     }
05520                 }
05521               <font class="comment">/*@switchbreak@*/</font> 
05522               <font class="keywordflow">break</font>;
05523             <font class="keywordflow">case</font> CGE_LOOKALIKE:
05524               <font class="keywordflow">if</font> (numchars == 0 
05525                   || (<a class="code" href="cstring_c.html#a30">cstring_length</a> (name) &lt;= numchars))
05526                 {
05527                   <font class="keywordflow">if</font> (optgenerror 
05528                       (FLG_DISTINCTINTERNALNAMES,
05529                        message 
05530                        (<font class="stringliteral">"Internal identifier %q is not distinguishable from %q "</font>
05531                         <font class="stringliteral">"except by lookalike characters"</font>,
05532                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05533                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe)),
05534                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05535                     {
05536                       <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05537                       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05538                       <font class="keywordflow">return</font> TRUE;
05539                     }
05540                 }
05541               <font class="keywordflow">else</font> 
05542                 {
05543                   <font class="keywordflow">if</font> (optgenerror 
05544                       (FLG_DISTINCTINTERNALNAMES,
05545                        message 
05546                        (<font class="stringliteral">"Internal identifier %q is not distinguishable from %q "</font>
05547                         <font class="stringliteral">"in the first %d characters except by lookalike characters"</font>,
05548                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e),
05549                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (oe),
05550                         numchars),
05551                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e)))
05552                     {
05553                       <a class="code" href="uentry_c.html#a245">uentry_showWhereAny</a> (oe);
05554                       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (oe);
05555                       <font class="keywordflow">return</font> TRUE;
05556                     }
05557                 }
05558             }
05559         } end_usymtab_entries ;
05560       
05561       ttab = ttab-&gt;env;
05562     }
05563 
05564   <font class="keywordflow">return</font> FALSE;
05565 }
05566 
<a name="l05567"></a><a class="code" href="usymtab_c.html#a165">05567</a> <font class="keywordtype">void</font> <a class="code" href="usymtab_c.html#a165">usymtab_checkDistinctName</a> (uentry e, <font class="keywordtype">int</font> scope)
05568    <font class="comment">/*@globals utab, globtab@*/</font>
05569 {
05570   <font class="keywordtype">bool</font> hasError = FALSE;
05571   fileloc where = <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e);
05572 
05573   <font class="keywordflow">if</font> (!fileloc_isPreproc (where)  &amp;&amp; !fileloc_isBuiltin (where))
05574     {
05575       <font class="keywordflow">if</font> (scope == globScope)
05576         {
05577           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_DISTINCTEXTERNALNAMES))
05578             {
05579               hasError = checkDistinctExternalName (e);
05580             }
05581         }
05582       
05583       <font class="keywordflow">if</font> (!hasError &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_DISTINCTINTERNALNAMES))
05584         {
05585           hasError = checkDistinctInternalName (e);
05586         }
05587     }
05588 
05589   <font class="keywordflow">if</font> (hasError)
05590     {
05591             <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (e);
05592     }
05593 }
05594 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:46 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
