<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>general.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:41 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>general.c</h1><a href="general_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** general.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 <font class="preprocessor"># undef malloc</font>
00031 <font class="preprocessor"></font><font class="preprocessor"># undef realloc</font>
00032 <font class="preprocessor"></font><font class="preprocessor"># undef calloc</font>
00033 <font class="preprocessor"></font>
00034 <font class="preprocessor"># ifdef USEDMALLOC</font>
00035 <font class="preprocessor"></font><font class="preprocessor"># include "dmalloc.h"</font>
00036 <font class="preprocessor"># endif</font>
00037 <font class="preprocessor"></font>
00038 <font class="preprocessor"># include "portab.h"</font>
00039 
00040 <font class="comment">/*</font>
00041 <font class="comment">** redefine undef'd memory ops</font>
00042 <font class="comment">*/</font>
00043 
00044 <font class="preprocessor"># ifndef USEDMALLOC</font>
00045 <font class="preprocessor"></font><font class="preprocessor"># include &lt;stdlib.h&gt;</font> 
00046 
00047 <font class="comment">/*@-mustdefine@*/</font>
00048 
<a name="l00049"></a><a class="code" href="general_c.html#a0">00049</a> <font class="keywordtype">void</font> <a class="code" href="general_c.html#a0">sfree</a> (<font class="keywordtype">void</font> *x)<font class="keyword"></font>
00050 <font class="keyword"></font>{
00051   <font class="keywordflow">if</font> (x != NULL)
00052     {
00053       <font class="comment">/*</font>
00054 <font class="comment">      fprintf (stderr, "Freeing: %ld\n", x);</font>
00055 <font class="comment">      if ((unsigned long) x &lt; 136000000 &amp;&amp; (unsigned long) x &gt; 135000000) {</font>
00056 <font class="comment">        fprintf (stderr, "Looks bad!\n");</font>
00057 <font class="comment">      }</font>
00058 <font class="comment">      */</font>
00059       free (x);
00060       <font class="comment">/* fprintf (stderr, "Done.\n"); */</font>
00061     }
00062 }
00063 <font class="preprocessor"># endif</font>
00064 <font class="preprocessor"></font>
<a name="l00065"></a><a class="code" href="general_c.html#a1">00065</a> <font class="keywordtype">void</font> <a class="code" href="general_c.html#a1">sfreeEventually</a> (<font class="keywordtype">void</font> *x)<font class="keyword"></font>
00066 <font class="keyword"></font>{
00067   <font class="keywordflow">if</font> (x != NULL)
00068     {
00069       ; <font class="comment">/* should keep in a table */</font>
00070     }
00071 <font class="comment">/*@-mustfree@*/</font>
00072 } <font class="comment">/*@=mustfree@*/</font>
00073 
00074 <font class="comment">/*</font>
00075 <font class="comment">** all memory should be allocated from dimalloc</font>
00076 <font class="comment">*/</font>
00077 
00078 <font class="keyword">static</font> <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> size_toLongUnsigned (size_t x)<font class="keyword"></font>
00079 <font class="keyword"></font>{
00080   <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> res = (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) x;
00081 
00082   llassert ((size_t) res == x);
00083   <font class="keywordflow">return</font> res;
00084 }
00085 
<a name="l00086"></a><a class="code" href="general_c.html#a3">00086</a> <font class="comment">/*@out@*/</font> <font class="keywordtype">void</font> *<a class="code" href="general_c.html#a3">dimalloc</a> (size_t size, <font class="keywordtype">char</font> *name, <font class="keywordtype">int</font> line)<font class="keyword"></font>
00087 <font class="keyword"></font>{
00088   <font class="comment">/*</font>
00089 <font class="comment">  static void *lastaddr = 0;</font>
00090 <font class="comment">  static int numallocs = 0;</font>
00091 <font class="comment">  static int numbad = 0;</font>
00092 <font class="comment">  */</font>
00093 
00094   <font class="comment">/* was malloc, use calloc to initialize to zero */</font>
00095   <font class="keywordtype">void</font> *ret = (<font class="keywordtype">void</font> *) calloc (1, size);
00096 
00097   <font class="comment">/*</font>
00098 <font class="comment">  numallocs++;</font>
00099 <font class="comment"></font>
00100 <font class="comment">  if (ret &lt; lastaddr)</font>
00101 <font class="comment">    {</font>
00102 <font class="comment">      numbad++;</font>
00103 <font class="comment">      fprintf (stderr, "Bad alloc: %d / %d\n", numbad, numallocs);</font>
00104 <font class="comment">    }</font>
00105 <font class="comment"></font>
00106 <font class="comment">  lastaddr = ret;</font>
00107 <font class="comment">  */</font>
00108 
00109   <font class="keywordflow">if</font> (ret == NULL)
00110     {
00111       <font class="keywordflow">if</font> (size == 0)
00112         {
00113           llbug (message (<font class="stringliteral">"Zero allocation at %q."</font>,
00114                           fileloc_unparseRaw (cstring_fromChars (name), line)));
00115         }
00116       <font class="keywordflow">else</font>
00117         {
00118           llfatalerrorLoc
00119             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Out of memory.  Allocating %w bytes at %s:%d."</font>, 
00120                       size_toLongUnsigned (size),
00121                       <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (name), line));
00122         }
00123     }
00124       
00125   <font class="comment">/*@-null@*/</font> <font class="comment">/* null okay for size = 0 */</font>
00126   <font class="keywordflow">return</font> ret; 
00127   <font class="comment">/*@=null@*/</font>
00128 }
00129 
<a name="l00130"></a><a class="code" href="general_c.html#a4">00130</a> <font class="keywordtype">void</font> *<a class="code" href="general_c.html#a4">dicalloc</a> (size_t num, size_t size, <font class="keywordtype">char</font> *name, <font class="keywordtype">int</font> line)<font class="keyword"></font>
00131 <font class="keyword"></font>{
00132   <font class="keywordtype">void</font> *ret = (<font class="keywordtype">void</font> *) calloc (num, size);
00133 
00134   <font class="keywordflow">if</font> (ret == NULL)
00135     {
00136       llfatalerrorLoc 
00137         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Out of memory.  Allocating %w bytes at %s:%d."</font>, 
00138                   size_toLongUnsigned (size),
00139                   <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (name), line));
00140     }
00141   
00142   <font class="keywordflow">return</font> ret;
00143 }
00144 
<a name="l00145"></a><a class="code" href="general_c.html#a5">00145</a> <font class="keywordtype">void</font> *<a class="code" href="general_c.html#a5">direalloc</a> (<font class="comment">/*@out@*/</font> <font class="comment">/*@null@*/</font> <font class="keywordtype">void</font> *x, size_t size, 
00146                  <font class="keywordtype">char</font> *name, <font class="keywordtype">int</font> line)<font class="keyword"></font>
00147 <font class="keyword"></font>{
00148   <font class="keywordtype">void</font> *ret;
00149 
00150   <font class="keywordflow">if</font> (x == NULL)
00151     {                                  
00152       ret = (<font class="keywordtype">void</font> *) dmalloc (size);
00153     }
00154   <font class="keywordflow">else</font>
00155     {
00156       ret = (<font class="keywordtype">void</font> *) realloc (x, size);
00157     }
00158 
00159   <font class="keywordflow">if</font> (ret == NULL)
00160     {
00161       llfatalerrorLoc
00162         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Out of memory.  Allocating %w bytes at %s:%d."</font>, 
00163                   size_toLongUnsigned (size),
00164                   <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (name), line));
00165     }
00166   
00167   <font class="keywordflow">return</font> ret;
00168 }
00169 
00170 <font class="comment">/*@=mustdefine@*/</font>
00171 
00172 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00173"></a><a class="code" href="general_c.html#a6">00173</a> <font class="preprocessor"></font><font class="keywordtype">char</font> *<a class="code" href="general_c.html#a6">FormatInt</a> (<font class="keywordtype">int</font> i)<font class="keyword"></font>
00174 <font class="keyword"></font>{
00175   <font class="keywordtype">char</font> temp[255]; <font class="comment">/* assume the integer has at most 254 digits */</font>
00176   <font class="keywordtype">char</font> *outs;
00177 
00178   sprintf (temp, <font class="stringliteral">"%i"</font>, i);
00179   outs = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*outs) * (1 + strlen (temp)));
00180   strcpy (outs, temp);
00181 
00182   <font class="keywordflow">return</font> (outs);
00183 }
00184 <font class="preprocessor"># endif</font>
00185 <font class="preprocessor"></font>
00186 <font class="keywordtype">bool</font>
<a name="l00187"></a><a class="code" href="general_c.html#a7">00187</a> <a class="code" href="general_c.html#a7">isCext</a> (<font class="keywordtype">char</font> *ext)<font class="keyword"></font>
00188 <font class="keyword"></font>{
00189   <font class="keywordflow">return</font> (!<a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".lcl"</font>) &amp;&amp; 
00190           !<a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".spc"</font>) &amp;&amp;
00191           !<a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".ll"</font>));
00192 }
00193 
00194 <font class="keywordtype">bool</font>
<a name="l00195"></a><a class="code" href="general_c.html#a8">00195</a> <a class="code" href="general_c.html#a8">isLCLfile</a> (cstring s)<font class="keyword"></font>
00196 <font class="keyword"></font>{
00197   <font class="keywordtype">char</font> *ext;
00198 
00199   ext = <a class="code" href="general_c.html#a41">filenameExtension</a> (cstring_toCharsSafe (s));
00200 
00201   <font class="keywordflow">if</font> (ext != NULL)
00202     {
00203       <font class="keywordflow">return</font> (!(<a class="code" href="general_c.html#a7">isCext</a> (ext)));
00204     }
00205 
00206   <font class="keywordflow">return</font> (TRUE);
00207 }
00208 
<a name="l00209"></a><a class="code" href="general_c.html#a9">00209</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a9">removeExtension</a> (<font class="comment">/*@temp@*/</font> <font class="keywordtype">char</font> *s, <font class="keyword">const</font> <font class="keywordtype">char</font> *suffix)<font class="keyword"></font>
00210 <font class="keyword"></font>{
00211   <font class="keywordtype">char</font> *t = strrchr (s, <font class="charliteral">'.'</font>);
00212   <font class="keywordtype">char</font> *s2;
00213 
00214   <font class="keywordflow">if</font> (t == (<font class="keywordtype">char</font> *) 0 || !<a class="code" href="general_c.html#a40">mstring_equal</a> (t, suffix))
00215     {
00216       <font class="keywordflow">return</font> <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
00217     }
00218 
00219   <font class="comment">/*@-mods@*/</font> 
00220   *t = <font class="charliteral">'\0'</font>;
00221   s2 = <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
00222   *t = <font class="charliteral">'.'</font>;
00223   <font class="comment">/*@=mods@*/</font>  <font class="comment">/* Modification is undone. */</font>
00224   <font class="keywordflow">return</font> s2;
00225 }
00226 
00227 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00228"></a><a class="code" href="general_c.html#a10">00228</a> <font class="preprocessor"></font><font class="keywordtype">bool</font> <a class="code" href="general_c.html#a10">firstWord</a> (<font class="keywordtype">char</font> *s, <font class="keywordtype">char</font> *w)<font class="keyword"></font>
00229 <font class="keyword"></font>{
00230   llassert (s != NULL);
00231   llassert (w != NULL);
00232   
00233   <font class="keywordflow">for</font> (; *w != <font class="charliteral">'\0'</font>; w++, s++)
00234     {
00235       <font class="keywordflow">if</font> (*w != *s || *s == <font class="charliteral">'\0'</font>)
00236         <font class="keywordflow">return</font> FALSE;
00237     }
00238   <font class="keywordflow">return</font> TRUE;
00239 }
00240 <font class="preprocessor"># endif</font>
00241 <font class="preprocessor"></font>
00242 <font class="preprocessor"># ifndef NOLCL</font>
<a name="l00243"></a><a class="code" href="general_c.html#a11">00243</a> <font class="preprocessor"></font><font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a11">removePath</a> (<font class="keywordtype">char</font> *s)<font class="keyword"></font>
00244 <font class="keyword"></font>{
00245   <font class="keywordtype">char</font> *t = strrchr (s, CONNECTCHAR);
00246 
00247   <font class="keywordflow">if</font> (t == NULL) <font class="keywordflow">return</font> (<a class="code" href="general_c.html#a27">mstring_copy</a> (s));
00248   <font class="keywordflow">else</font> <font class="keywordflow">return</font> (<a class="code" href="general_c.html#a27">mstring_copy</a> (t + 1));
00249 }
00250 <font class="preprocessor"># endif</font>
00251 <font class="preprocessor"></font>
00252 <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00253"></a><a class="code" href="general_c.html#a12">00253</a> <a class="code" href="general_c.html#a12">removePathFree</a> (<font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *s)<font class="keyword"></font>
00254 <font class="keyword"></font>{
00255   <font class="keywordtype">char</font> *t = strrchr (s, CONNECTCHAR);
00256 
00257 <font class="preprocessor"># ifdef ALTCONNECTCHAR</font>
00258 <font class="preprocessor"></font>  {
00259     <font class="keywordtype">char</font> *at = strrchr (s, ALTCONNECTCHAR);
00260     <font class="keywordflow">if</font> (t == NULL || (at &gt; t)) {
00261       t = at;
00262     }
00263   }
00264 <font class="preprocessor"># endif</font>
00265 <font class="preprocessor"></font>
00266   <font class="keywordflow">if</font> (t == NULL) 
00267     {
00268       <font class="keywordflow">return</font> (s);
00269     }
00270   <font class="keywordflow">else</font>
00271     {
00272       <font class="keywordtype">char</font> *res = <a class="code" href="general_c.html#a27">mstring_copy</a> (t + 1);
00273       mstring_free (s);
00274       <font class="keywordflow">return</font> res;
00275     }
00276 }
00277 
<a name="l00278"></a><a class="code" href="general_c.html#a13">00278</a> <font class="keywordtype">void</font> <a class="code" href="general_c.html#a13">mstring_markFree</a> (<font class="keywordtype">char</font> *s)<font class="keyword"></font>
00279 <font class="keyword"></font>{
00280     <a class="code" href="general_c.html#a1">sfreeEventually</a> (s);
00281 }
00282 
00283 <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00284"></a><a class="code" href="general_c.html#a14">00284</a> <a class="code" href="general_c.html#a14">removeAnyExtension</a> (<font class="keywordtype">char</font> *s)<font class="keyword"></font>
00285 <font class="keyword"></font>{
00286   <font class="keywordtype">char</font> *ret;
00287   <font class="keywordtype">char</font> *t = strrchr (s, <font class="charliteral">'.'</font>);
00288 
00289   <font class="keywordflow">if</font> (t == (<font class="keywordtype">char</font> *) 0)
00290     {
00291       <font class="keywordflow">return</font> <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
00292     }
00293 
00294   <font class="comment">/*@-mods@*/</font>
00295   *t = <font class="charliteral">'\0'</font>;
00296   ret = <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
00297   *t = <font class="charliteral">'.'</font>;
00298   <font class="comment">/*@=mods@*/</font> <font class="comment">/* modification is undone */</font>
00299 
00300   <font class="keywordflow">return</font> ret;
00301 }
00302 
00303 <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00304"></a><a class="code" href="general_c.html#a15">00304</a> <a class="code" href="general_c.html#a15">addExtension</a> (<font class="keywordtype">char</font> *s, <font class="keyword">const</font> <font class="keywordtype">char</font> *suffix)<font class="keyword"></font>
00305 <font class="keyword"></font>{
00306   <font class="keywordflow">if</font> (strrchr (s, <font class="charliteral">'.'</font>) == (<font class="keywordtype">char</font> *) 0)
00307     {
00308       <font class="comment">/* &lt;&lt;&lt; was mstring_concatFree1 --- bug detected by lclint &gt;&gt;&gt; */</font>
00309       <font class="keywordflow">return</font> (<a class="code" href="general_c.html#a23">mstring_concat</a> (s, suffix));
00310     }
00311   <font class="keywordflow">else</font>
00312     {
00313       <font class="keywordflow">return</font> <a class="code" href="general_c.html#a27">mstring_copy</a> (s);
00314     }
00315 }
00316 
00317 <font class="keywordtype">int</font>
<a name="l00318"></a><a class="code" href="general_c.html#a16">00318</a> <a class="code" href="general_c.html#a16">getInt</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00319 <font class="keyword"></font>{
00320   <font class="keywordtype">bool</font> gotOne = FALSE;
00321   <font class="keywordtype">int</font> i = 0;
00322 
00323   <font class="keywordflow">while</font> (**s == <font class="charliteral">' '</font>)
00324     {
00325       (*s)++;
00326     }
00327 
00328   <font class="keywordflow">if</font> (**s == <font class="charliteral">'-'</font>)
00329     {
00330       (*s)++;
00331       <font class="keywordflow">if</font> (**s &lt; '0' || **s &gt; <font class="charliteral">'9'</font>)
00332         {
00333           llbug (message (<font class="stringliteral">"getInt: bad int: %s"</font>, cstring_fromChars (*s))); 
00334         }
00335       <font class="keywordflow">else</font>
00336         {
00337           i = -1 * (<font class="keywordtype">int</font>) (**s - <font class="charliteral">'0'</font>);
00338           gotOne = TRUE;
00339         }
00340 
00341       (*s)++;
00342     }
00343 
00344   <font class="keywordflow">while</font> (**s &gt;= <font class="charliteral">'0'</font> &amp;&amp; **s &lt;= <font class="charliteral">'9'</font>)
00345     {
00346       i *= 10;
00347       i += (<font class="keywordtype">int</font>) (**s - <font class="charliteral">'0'</font>);
00348       (*s)++;
00349       gotOne = TRUE;
00350     }
00351 
00352   <font class="keywordflow">if</font> (!gotOne)
00353     {
00354       llbug (message (<font class="stringliteral">"No int to read: %s"</font>, cstring_fromChars (*s)));
00355     }
00356 
00357   <font class="keywordflow">while</font> (**s == <font class="charliteral">'\n'</font> || **s == <font class="charliteral">' '</font> || **s == <font class="charliteral">'\t'</font>)
00358     {
00359       (*s)++;
00360     }
00361 
00362   <font class="keywordflow">return</font> i;
00363 }
00364 
00365 <font class="keywordtype">char</font>
<a name="l00366"></a><a class="code" href="general_c.html#a17">00366</a> <a class="code" href="general_c.html#a17">loadChar</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00367 <font class="keyword"></font>{
00368   <font class="keywordtype">char</font> ret;
00369 
00370   <font class="keywordflow">while</font> (**s == <font class="charliteral">' '</font>)
00371     {
00372       (*s)++;
00373     }
00374   
00375   ret = **s;
00376   (*s)++;
00377   <font class="keywordflow">return</font> ret;
00378 }
00379 
00380 <font class="comment">/*</font>
00381 <font class="comment">** not sure if this works...</font>
00382 <font class="comment">*/</font>
00383 
00384 <font class="keywordtype">double</font>
<a name="l00385"></a><a class="code" href="general_c.html#a18">00385</a> <a class="code" href="general_c.html#a18">getDouble</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00386 <font class="keyword"></font>{
00387   <font class="keywordtype">char</font> *end = mstring_createEmpty ();
00388   <font class="keywordtype">double</font> ret;
00389 
00390   ret = strtod (*s, &amp;end);
00391 
00392   *s = end;
00393   <font class="keywordflow">return</font> ret;
00394 }
00395 
00396 <font class="comment">/*</font>
00397 <font class="comment">** read to ' ', '\t'. '\n', '#', ',' or '\0'</font>
00398 <font class="comment">*/</font>
00399 
00400 <font class="keywordtype">char</font> *
<a name="l00401"></a><a class="code" href="general_c.html#a19">00401</a> <a class="code" href="general_c.html#a19">getWord</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00402 <font class="keyword"></font>{
00403   <font class="keywordtype">char</font> *res;
00404   <font class="keywordtype">char</font> *t = *s;
00405   <font class="keywordtype">char</font> c;
00406 
00407   <font class="keywordflow">while</font> ((c = **s) != <font class="charliteral">'\0'</font> &amp;&amp; (c != <font class="charliteral">' '</font>) &amp;&amp; (c != <font class="charliteral">','</font>) 
00408          &amp;&amp; (c != <font class="charliteral">'\n'</font>) &amp;&amp; (c != <font class="charliteral">'\t'</font>) &amp;&amp; (c != <font class="charliteral">'#'</font>))
00409     {
00410       (*s)++;
00411     }
00412 
00413   <font class="keywordflow">if</font> (*s == t)  
00414     {
00415       <font class="keywordflow">return</font> NULL;
00416     }
00417 
00418   **s = <font class="charliteral">'\0'</font>;
00419   res = <a class="code" href="general_c.html#a27">mstring_copy</a> (t);
00420   **s = c;
00421   <font class="keywordflow">return</font> res;
00422 }
00423 
00424 <font class="keywordtype">bool</font>
<a name="l00425"></a><a class="code" href="general_c.html#a20">00425</a> <a class="code" href="general_c.html#a20">optCheckChar</a> (<font class="keywordtype">char</font> **s, <font class="keywordtype">char</font> c)<font class="keyword"></font>
00426 <font class="keyword"></font>{
00427   <font class="keywordflow">if</font> (**s == c)
00428     {
00429       (*s)++;
00430       <font class="keywordflow">return</font> TRUE;
00431     }
00432   <font class="keywordflow">else</font>
00433     {
00434       <font class="keywordflow">return</font> FALSE;
00435     }
00436 }
00437 
00438 <font class="keywordtype">void</font>
<a name="l00439"></a><a class="code" href="general_c.html#a21">00439</a> <a class="code" href="general_c.html#a21">docheckChar</a> (<font class="keywordtype">char</font> **s, <font class="keywordtype">char</font> c, <font class="keywordtype">char</font> *file, <font class="keywordtype">int</font> line)<font class="keyword"></font>
00440 <font class="keyword"></font>{
00441   <font class="comment">/*@unchecked@*/</font> <font class="keyword">static</font> <font class="keywordtype">int</font> nbadchars = 0;
00442 
00443   <font class="keywordflow">if</font> (**s == c)
00444     {
00445       (*s)++;
00446     }
00447   <font class="keywordflow">else</font>
00448     {
00449       nbadchars++;
00450 
00451       <font class="keywordflow">if</font> (nbadchars &gt; 5)
00452         {
00453           <a class="code" href="llerror_c.html#a43">llfatalbug</a> (cstring_makeLiteral 
00454                       (<font class="stringliteral">"checkChar: Too many errors.  Check library is up to date."</font>));
00455         }
00456       <font class="keywordflow">else</font>
00457         {
00458           llbug (message (<font class="stringliteral">"checkChar: %q: Bad char, expecting %h: %s"</font>,
00459                           fileloc_unparseRaw (cstring_fromChars (file), line),
00460                           c,
00461                           <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (*s)));
00462         }
00463     }
00464 }
00465 
<a name="l00466"></a><a class="code" href="general_c.html#a22">00466</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a22">mstring_spaces</a> (<font class="keywordtype">int</font> n)<font class="keyword"></font>
00467 <font class="keyword"></font>{
00468   <font class="keywordtype">int</font> i;
00469   <font class="keywordtype">char</font> *ret;
00470   <font class="keywordtype">char</font> *ptr;
00471 
00472   llassert (n &gt;= 0);
00473 
00474   ret = (<font class="keywordtype">char</font> *) dmalloc (size_fromInt (n + 1));
00475   ptr = ret;
00476 
00477   <font class="keywordflow">for</font> (i = 0; i &lt; n; i++)
00478     {
00479       *ptr++ = <font class="charliteral">' '</font>;
00480     }
00481 
00482   *ptr = <font class="charliteral">'\0'</font>;
00483 
00484   <font class="keywordflow">return</font> ret;
00485 }
00486  
<a name="l00487"></a><a class="code" href="general_c.html#a23">00487</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a23">mstring_concat</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *s1, <font class="keyword">const</font> <font class="keywordtype">char</font> *s2)<font class="keyword"></font>
00488 <font class="keyword"></font>{
00489   <font class="keywordtype">char</font> *s = (<font class="keywordtype">char</font> *) dmalloc (strlen (s1) + strlen (s2) + 1);
00490   strcpy (s, s1);
00491   strcat (s, s2);
00492   <font class="keywordflow">return</font> s;
00493 }
00494 
00495 <font class="keyword">extern</font> <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00496"></a><a class="code" href="general_c.html#a24">00496</a> <a class="code" href="general_c.html#a24">mstring_concatFree</a> (<font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *s1, <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *s2)<font class="keyword"></font>
00497 <font class="keyword"></font>{
00498   <font class="comment">/* like mstring_concat but deallocates old strings */</font>
00499   <font class="keywordtype">char</font> *s = (<font class="keywordtype">char</font> *) dmalloc (strlen (s1) + strlen (s2) + 1);
00500   strcpy (s, s1);
00501   strcat (s, s2);
00502 
00503   <a class="code" href="general_c.html#a0">sfree</a> (s1);
00504   <a class="code" href="general_c.html#a0">sfree</a> (s2);
00505   <font class="keywordflow">return</font> s;
00506 }
00507 
00508 <font class="keyword">extern</font> <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00509"></a><a class="code" href="general_c.html#a25">00509</a> <a class="code" href="general_c.html#a25">mstring_concatFree1</a> (<font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *s1, <font class="keyword">const</font> <font class="keywordtype">char</font> *s2)<font class="keyword"></font>
00510 <font class="keyword"></font>{
00511   <font class="keywordtype">char</font> *s = (<font class="keywordtype">char</font> *) dmalloc (strlen (s1) + strlen (s2) + 1);
00512   strcpy (s, s1);
00513   strcat (s, s2);
00514   <a class="code" href="general_c.html#a0">sfree</a> (s1);
00515 
00516   <font class="keywordflow">return</font> s;
00517 }
00518 
00519 <font class="keyword">extern</font> <font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *
<a name="l00520"></a><a class="code" href="general_c.html#a26">00520</a> <a class="code" href="general_c.html#a26">mstring_append</a> (<font class="comment">/*@only@*/</font> <font class="keywordtype">char</font> *s1, <font class="keywordtype">char</font> c)<font class="keyword"></font>
00521 <font class="keyword"></font>{
00522   size_t l = strlen (s1);
00523   <font class="keywordtype">char</font> *s;
00524 
00525   s = (<font class="keywordtype">char</font> *) dmalloc (<font class="keyword">sizeof</font> (*s) * (l + 2));
00526 
00527   strcpy (s, s1);
00528   *(s + l) = c;
00529   *(s + l + 1) = <font class="charliteral">'\0'</font>;
00530   <a class="code" href="general_c.html#a0">sfree</a> (s1); 
00531   <font class="keywordflow">return</font> s;
00532 }
00533 
00534 <font class="keyword">extern</font> 
<a name="l00535"></a><a class="code" href="general_c.html#a27">00535</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a27">mstring_copy</a> (<font class="keywordtype">char</font> *s1)<font class="keyword"></font>
00536 <font class="keyword"></font>{
00537   <font class="keywordflow">if</font> (s1 == NULL)
00538     {
00539       <font class="keywordflow">return</font> NULL;
00540     }
00541   <font class="keywordflow">else</font>
00542     {
00543       <font class="keywordtype">char</font> *s = (<font class="keywordtype">char</font> *) dmalloc ((strlen (s1) + 1) * <font class="keyword">sizeof</font> (*s));
00544       strcpy (s, s1);
00545       <font class="keywordflow">return</font> s;
00546     }
00547 }
00548 
00549 <font class="keyword">extern</font>
<a name="l00550"></a><a class="code" href="general_c.html#a28">00550</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a28">mstring_safePrint</a> (<font class="keywordtype">char</font> *s)<font class="keyword"></font>
00551 <font class="keyword"></font>{
00552   <font class="keywordflow">if</font> (s == NULL)
00553     {
00554       <font class="keywordflow">return</font> (<font class="stringliteral">"&lt;undefined&gt;"</font>);
00555     }
00556   <font class="keywordflow">else</font>
00557     {
00558       <font class="keywordflow">return</font> s;
00559     }
00560 }
00561 
00562 <font class="keyword">extern</font>
<a name="l00563"></a><a class="code" href="general_c.html#a29">00563</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a29">mstring_create</a> (<font class="keywordtype">int</font> n)<font class="keyword"></font>
00564 <font class="keyword"></font>{
00565   <font class="keywordtype">char</font> *s;
00566 
00567   s = dmalloc (<font class="keyword">sizeof</font> (*s) * (n + 1));
00568   *s = <font class="charliteral">'\0'</font>;
00569   <font class="keywordflow">return</font> s;
00570 }
00571 
00572 <font class="keywordtype">void</font>
<a name="l00573"></a><a class="code" href="general_c.html#a30">00573</a> <a class="code" href="general_c.html#a30">fputline</a> (FILE *out, <font class="keywordtype">char</font> *s)<font class="keyword"></font>
00574 <font class="keyword"></font>{
00575   <font class="keywordflow">if</font> (strlen (s) &gt; 0) 
00576     {
00577       check (fputs (s, out) != EOF);
00578     }
00579 
00580   check (fputc (<font class="charliteral">'\n'</font>, out) == (<font class="keywordtype">int</font>) <font class="charliteral">'\n'</font>);
00581 }
00582 
<a name="l00583"></a><a class="code" href="general_c.html#a31">00583</a> <font class="keywordtype">int</font> <a class="code" href="general_c.html#a31">int_log</a> (<font class="keywordtype">int</font> x)<font class="keyword"></font>
00584 <font class="keyword"></font>{
00585   <font class="keywordtype">int</font> ret = 1;
00586 
00587   <font class="keywordflow">while</font> (x &gt; 10)
00588     {
00589       ret++;
00590       x /= 10;
00591     }
00592 
00593   <font class="keywordflow">return</font> ret;
00594 }
00595 
00596 <font class="comment">/*@-czechfcns@*/</font>
00597 <font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> 
<a name="l00598"></a><a class="code" href="general_c.html#a32">00598</a> <a class="code" href="general_c.html#a32">longUnsigned_fromInt</a> (<font class="keywordtype">int</font> x)<font class="keyword"></font>
00599 <font class="keyword"></font>{
00600   llassert (x &gt;= 0);
00601   
00602   <font class="keywordflow">return</font> (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) x;
00603 }
00604 
<a name="l00605"></a><a class="code" href="general_c.html#a33">00605</a> size_t <a class="code" href="general_c.html#a33">size_fromInt</a> (<font class="keywordtype">int</font> x)<font class="keyword"></font>
00606 <font class="keyword"></font>{
00607   size_t res = (size_t) x;
00608 
00609   llassert ((<font class="keywordtype">int</font>) res == x);
00610   <font class="keywordflow">return</font> res;
00611 }
00612 
<a name="l00613"></a><a class="code" href="general_c.html#a34">00613</a> <font class="keywordtype">int</font> <a class="code" href="general_c.html#a34">size_toInt</a> (size_t x)<font class="keyword"></font>
00614 <font class="keyword"></font>{
00615   <font class="keywordtype">int</font> res = (<font class="keywordtype">int</font>) x;
00616 
00617   llassert ((size_t) res == x);
00618   <font class="keywordflow">return</font> res;
00619 }
00620 
<a name="l00621"></a><a class="code" href="general_c.html#a35">00621</a> <font class="keywordtype">long</font> <a class="code" href="general_c.html#a35">size_toLong</a> (size_t x)<font class="keyword"></font>
00622 <font class="keyword"></font>{
00623   <font class="keywordtype">long</font> res = (<font class="keywordtype">long</font>) x;
00624 
00625   llassert ((size_t) res == x);
00626   <font class="keywordflow">return</font> res;
00627 }
00628 
00629 <font class="comment">/*@=czechfcns@*/</font>
00630 
00631 <font class="keywordtype">char</font>
<a name="l00632"></a><a class="code" href="general_c.html#a36">00632</a> <a class="code" href="general_c.html#a36">char_fromInt</a> (<font class="keywordtype">int</font> x)<font class="keyword"></font>
00633 <font class="keyword"></font>{
00634   llassert ((x &gt;= (<font class="keywordtype">int</font>)<font class="charliteral">'\0'</font>) &amp;&amp; (x &lt;= (<font class="keywordtype">int</font>)<font class="charliteral">'~'</font>));
00635 
00636   <font class="keywordflow">return</font> ((<font class="keywordtype">char</font>) x);
00637 }
00638 
00639 <font class="comment">/*@-czechfcns@*/</font>
00640 <font class="keywordtype">int</font>
<a name="l00641"></a><a class="code" href="general_c.html#a37">00641</a> <a class="code" href="general_c.html#a37">longUnsigned_toInt</a> (<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> x)<font class="keyword"></font>
00642 <font class="keyword"></font>{
00643   <font class="keywordtype">int</font> res = (<font class="keywordtype">int</font>) x;
00644 
00645   llassert ((<font class="keywordtype">long</font> <font class="keywordtype">unsigned</font>) res == x);
00646   <font class="keywordflow">return</font> res;
00647 }
00648 
00649 <font class="keywordtype">int</font>
<a name="l00650"></a><a class="code" href="general_c.html#a38">00650</a> <a class="code" href="general_c.html#a38">long_toInt</a> (<font class="keywordtype">long</font> <font class="keywordtype">int</font> x)<font class="keyword"></font>
00651 <font class="keyword"></font>{
00652   <font class="keywordtype">int</font> res = (<font class="keywordtype">int</font>) x;
00653 
00654   <font class="comment">/*@+ignorequals@*/</font> llassert (res == x); <font class="comment">/*@=ignorequals@*/</font>
00655   <font class="keywordflow">return</font> res;
00656 }
00657 
00658 <font class="comment">/*@+czechfcns@*/</font>
00659 
<a name="l00660"></a><a class="code" href="general_c.html#a39">00660</a> <font class="keywordtype">bool</font> <a class="code" href="general_c.html#a39">mstring_equalPrefix</a> (<font class="keyword">const</font> <font class="keywordtype">char</font> *c1, <font class="keyword">const</font> <font class="keywordtype">char</font> *c2)<font class="keyword"></font>
00661 <font class="keyword"></font>{
00662   llassert (c1 != NULL);
00663   llassert (c2 != NULL);
00664 
00665   <font class="keywordflow">if</font> (strncmp(c1, c2, strlen(c2)) == 0)
00666     {
00667       <font class="keywordflow">return</font> TRUE;
00668     }
00669   <font class="keywordflow">else</font>
00670     {
00671       <font class="keywordflow">return</font> FALSE;
00672     }
00673 }
00674 
<a name="l00675"></a><a class="code" href="general_c.html#a40">00675</a> <font class="keywordtype">bool</font> <a class="code" href="general_c.html#a40">mstring_equal</a> (<font class="comment">/*@null@*/</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *s1, <font class="comment">/*@null@*/</font> <font class="keyword">const</font> <font class="keywordtype">char</font> *s2)<font class="keyword"></font>
00676 <font class="keyword"></font>{
00677   <font class="keywordflow">if</font> (s1 == NULL)
00678     {
00679       <font class="keywordflow">return</font> (s2 == NULL);
00680     }
00681   <font class="keywordflow">else</font>
00682     {
00683       <font class="keywordflow">if</font> (s2 == NULL)
00684         {
00685           <font class="keywordflow">return</font> FALSE;
00686         }
00687       <font class="keywordflow">else</font>
00688         {
00689           <font class="keywordflow">return</font> (strcmp(s1, s2) == 0);
00690         }
00691     }
00692 }
00693 
<a name="l00694"></a><a class="code" href="general_c.html#a41">00694</a> <font class="comment">/*@observer@*/</font> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a41">filenameExtension</a> (<font class="comment">/*@returned@*/</font> <font class="keywordtype">char</font> *s)<font class="keyword"></font>
00695 <font class="keyword"></font>{
00696   llassert (s != NULL);
00697 
00698   <font class="keywordflow">return</font> (strrchr(s, <font class="charliteral">'.'</font>));
00699 }
00700 
<a name="l00701"></a><a class="code" href="general_c.html#a42">00701</a> <font class="keywordtype">char</font> *<a class="code" href="general_c.html#a42">removePreDirs</a> (<font class="keywordtype">char</font> *s)<font class="keyword"></font>
00702 <font class="keyword"></font>{
00703   <font class="keywordflow">while</font> (*s == <font class="charliteral">'.'</font> &amp;&amp; *(s + 1) == CONNECTCHAR) 
00704     {
00705       s += 2;
00706     }
00707 
00708 <font class="preprocessor"># if defined(OS2) || defined(MSDOS)</font>
00709 <font class="preprocessor"></font>  <font class="comment">/* remove remainders from double path delimiters... */</font>
00710   <font class="keywordflow">while</font> (*s == CONNECTCHAR) 
00711     {
00712       ++s;
00713     }
00714 <font class="preprocessor"># endif </font><font class="comment">/* !defined(OS2) &amp;&amp; !defined(MSDOS) */</font>
00715 
00716   <font class="keywordflow">return</font> s;
00717 }
00718 
<a name="l00719"></a><a class="code" href="general_c.html#a43">00719</a> <font class="keywordtype">void</font> <a class="code" href="general_c.html#a43">checkUngetc</a> (<font class="keywordtype">int</font> c, FILE *f)<font class="keyword"></font>
00720 <font class="keyword"></font>{
00721   <font class="keywordtype">int</font> res;
00722 
00723   llassert (c != EOF);
00724   res = ungetc (c, f);
00725   llassert (res == c);
00726 }
00727 
<a name="l00728"></a><a class="code" href="general_c.html#a44">00728</a> <font class="keywordtype">bool</font> <a class="code" href="general_c.html#a44">isHeaderFile</a> (cstring fname)<font class="keyword"></font>
00729 <font class="keyword"></font>{
00730   <font class="keywordtype">char</font> *ext = <a class="code" href="general_c.html#a41">filenameExtension</a> (cstring_toCharsSafe (fname));
00731   
00732   <font class="keywordflow">return</font> (<a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".h"</font>)
00733           || <a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".H"</font>)
00734           || <a class="code" href="general_c.html#a40">mstring_equal</a> (ext, <font class="stringliteral">".lh"</font>));
00735 }
00736 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:41 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
