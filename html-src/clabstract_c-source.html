<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>clabstract.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:39 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>clabstract.c</h1><a href="clabstract_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** clabstract.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** ASTs for C grammar</font>
00028 <font class="comment">**</font>
00029 <font class="comment">*/</font>
00030 
00031 <font class="preprocessor"># include "lclintMacros.nf"</font>
00032 <font class="preprocessor"># include "llbasic.h"</font>
00033 <font class="preprocessor"># include "cgrammar.h"</font>
00034 
00035 <font class="preprocessor"># ifndef NOLCL</font>
00036 <font class="preprocessor"></font><font class="preprocessor"># include "usymtab_interface.h"</font>
00037 <font class="preprocessor"># endif</font>
00038 <font class="preprocessor"></font>
00039 <font class="preprocessor"># include "structNames.h"</font>
00040 <font class="preprocessor"># include "nameChecks.h"</font>
00041 
00042 <font class="preprocessor"># ifdef SANITIZER</font>
00043 <font class="preprocessor"></font><font class="preprocessor"># include "sgrammar_tokens.h"</font>
00044 <font class="preprocessor"># else</font>
00045 <font class="preprocessor"></font><font class="preprocessor"># include "cgrammar_tokens.h"</font>
00046 <font class="preprocessor"># endif</font>
00047 <font class="preprocessor"></font>
00048 <font class="comment">/*</font>
00049 <font class="comment">** Lots of variables are needed because of interactions with the</font>
00050 <font class="comment">** parser.  This is easier than restructuring the grammar so the</font>
00051 <font class="comment">** right values are available in the right place.</font>
00052 <font class="comment">*/</font>
00053 
00054 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet fcnModifies = sRefSet_undefined;
00055 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@null@*/</font> specialClauses specClauses = specialClauses_undefined;
00056 <font class="keyword">static</font> <font class="keywordtype">bool</font> fcnNoGlobals = FALSE;
00057 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingVars = FALSE;
00058 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingParams = FALSE;
00059 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingGlobals = FALSE;
00060 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingTypedef = FALSE;
00061 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingIterVars = FALSE;
00062 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> qtype processingType = qtype_undefined;
00063 <font class="keyword">static</font> uentry currentIter = uentry_undefined;
00064 <font class="keyword">static</font> globSet currentGlobals = globSet_undefined;
00065 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> uentryList saveParamList;  <font class="comment">/* for old style functions */</font>
00066 <font class="keyword">static</font> <font class="comment">/*@owned@*/</font> uentry saveFunction = uentry_undefined;
00067 <font class="keyword">static</font> <font class="keywordtype">int</font> saveIterParamNo;
00068 <font class="keyword">static</font> idDecl fixStructDecl (<font class="comment">/*@returned@*/</font> idDecl p_d);
00069 <font class="keyword">static</font> <font class="keywordtype">void</font> checkTypeDecl (uentry p_e, ctype p_rep);
00070 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> fileloc saveStoreLoc = fileloc_undefined;
00071 <font class="keyword">static</font> storageClassCode storageClass = SCNONE;
00072 <font class="keyword">static</font> <font class="keywordtype">void</font> declareEnumList (<font class="comment">/*@temp@*/</font> enumNameList p_el, ctype p_c, fileloc p_loc);
00073 <font class="keyword">static</font> <font class="keywordtype">void</font> resetGlobals (<font class="keywordtype">void</font>);
00074 <font class="keyword">static</font> qual specialFunctionCode = QU_UNKNOWN;
00075 <font class="keyword">static</font> <font class="keywordtype">bool</font> argsUsed = FALSE;
00076 
00077 <font class="keyword">static</font> <font class="keywordtype">bool</font> hasSpecialCode (<font class="keywordtype">void</font>)<font class="keyword"></font>
00078 <font class="keyword"></font>{
00079   <font class="keywordflow">return</font> (specialFunctionCode != QU_UNKNOWN);
00080 }
00081 
<a name="l00082"></a><a class="code" href="clabstract_c.html#a27">00082</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a27">setArgsUsed</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00083 <font class="keyword"></font>{
00084   <font class="keywordflow">if</font> (argsUsed)
00085     {
00086       voptgenerror
00087         (FLG_SYNTAX,
00088          cstring_makeLiteral (<font class="stringliteral">"Multiple ARGSUSED comments for one function"</font>),
00089          g_currentloc);
00090     }
00091 
00092   argsUsed = TRUE;
00093 }
00094 
00095 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectArgsUsed (uentry ue)<font class="keyword"></font>
00096 <font class="keyword"></font>{
00097   <font class="keywordflow">if</font> (argsUsed)
00098     {
00099       <font class="keywordflow">if</font> (uentry_isFunction (ue))
00100         {
00101           uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (ue);
00102 
00103           uentryList_elements (params, el)<font class="keyword"></font>
00104 <font class="keyword">            </font>{
00105               <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (el, fileloc_undefined);
00106             } end_uentryList_elements ;
00107         }
00108 
00109       argsUsed = FALSE;
00110     }
00111 }
00112               
<a name="l00113"></a><a class="code" href="clabstract_c.html#a29">00113</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a29">setSpecialFunction</a> (qual qu)<font class="keyword"></font>
00114 <font class="keyword"></font>{
00115   <font class="keywordflow">if</font> (specialFunctionCode != QU_UNKNOWN)
00116     {
00117       voptgenerror (FLG_SYNTAX,
00118                     message (<font class="stringliteral">"Multiple special function codes: %s, %s "</font>
00119                              <font class="stringliteral">"(first code is ignored)"</font>,
00120                              qual_unparse (specialFunctionCode),
00121                              <a class="code" href="qual_c.html#a2">qual_unparse</a> (qu)),
00122                     g_currentloc);
00123     }
00124 
00125   specialFunctionCode = qu;
00126 }
00127 
00128 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectSpecialCode (uentry ue)<font class="keyword"></font>
00129 <font class="keyword"></font>{
00130   <font class="keywordflow">switch</font> (specialFunctionCode)
00131     {
00132     <font class="keywordflow">case</font> QU_UNKNOWN: <font class="keywordflow">break</font>;
00133     <font class="keywordflow">case</font> QU_PRINTFLIKE:
00134       <a class="code" href="uentry_c.html#a77">uentry_setPrintfLike</a> (ue);
00135       <font class="keywordflow">break</font>;
00136     <font class="keywordflow">case</font> QU_SCANFLIKE:
00137       <a class="code" href="uentry_c.html#a78">uentry_setScanfLike</a> (ue);
00138       <font class="keywordflow">break</font>;
00139     <font class="keywordflow">case</font> QU_MESSAGELIKE:
00140       <a class="code" href="uentry_c.html#a79">uentry_setMessageLike</a> (ue);
00141       <font class="keywordflow">break</font>;
00142     BADDEFAULT;
00143     }
00144 
00145   specialFunctionCode = QU_UNKNOWN;
00146 }
00147 
00148 <font class="keyword">static</font> <font class="keywordtype">void</font> resetStorageClass (<font class="keywordtype">void</font>)<font class="keyword"></font>
00149 <font class="keyword"></font>{
00150   <a class="code" href="qtype_c.html#a1">qtype_free</a> (processingType);
00151   processingType = qtype_undefined;
00152   storageClass = SCNONE;
00153 }
00154 
00155 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectModGlobs (uentry ue)<font class="keyword"></font>
00156 <font class="keyword"></font>{
00157   <font class="keywordflow">if</font> (fcnNoGlobals)
00158     {
00159       llassert (globSet_isUndefined (currentGlobals));
00160 
00161       <a class="code" href="uentry_c.html#a101">uentry_setGlobals</a> (ue, globSet_undefined);
00162       fcnNoGlobals = FALSE;
00163     }
00164   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (globSet_isDefined (currentGlobals))
00165     {
00166       <a class="code" href="uentry_c.html#a101">uentry_setGlobals</a> (ue, currentGlobals);
00167       currentGlobals = globSet_undefined;
00168     }
00169   <font class="keywordflow">else</font>
00170     {
00171       ; <font class="comment">/* no globals */</font>
00172     }
00173 
00174   <font class="keywordflow">if</font> (sRefSet_isDefined (fcnModifies))
00175     {
00176       <a class="code" href="uentry_c.html#a59">uentry_setModifies</a> (ue, fcnModifies);
00177       fcnModifies = sRefSet_undefined;
00178     }
00179 
00180   <font class="keywordflow">if</font> (uentry_isFunction (ue))
00181     {
00182       <a class="code" href="uentry_c.html#a58">uentry_setSpecialClauses</a> (ue, specClauses);
00183       specClauses = NULL;
00184       DPRINTF ((<font class="stringliteral">"Done with spec clauses"</font>));
00185     }
00186 }
00187 
00188 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectStorageClass (uentry u)<font class="keyword"></font>
00189 <font class="keyword"></font>{
00190   <font class="keywordflow">if</font> (storageClass == SCSTATIC)
00191     {
00192       <a class="code" href="uentry_c.html#a53">uentry_setStatic</a> (u);
00193     }
00194   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (storageClass == SCEXTERN)
00195     {
00196       <a class="code" href="uentry_c.html#a54">uentry_setExtern</a> (u);
00197     }
00198   <font class="keywordflow">else</font>
00199     {
00200       ; <font class="comment">/* no storage class */</font>
00201     }
00202 
00203   }
00204 
<a name="l00205"></a><a class="code" href="clabstract_c.html#a34">00205</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a34">storeLoc</a> ()<font class="keyword"></font>
00206 <font class="keyword"></font>{
00207   saveStoreLoc = g_currentloc;
00208 }
00209 
<a name="l00210"></a><a class="code" href="clabstract_c.html#a35">00210</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a35">setFunctionNoGlobals</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00211 <font class="keyword"></font>{
00212   llassert (globSet_isUndefined (currentGlobals));
00213   fcnNoGlobals = TRUE;
00214 }
00215 
00216 <font class="keywordtype">void</font>
<a name="l00217"></a><a class="code" href="clabstract_c.html#a36">00217</a>   <a class="code" href="clabstract_c.html#a36">setFunctionStateSpecialClause</a> (lltok stok, specialClauseKind kind, 
00218                                  sRefSet s, 
00219                                  <font class="comment">/*@unused@*/</font> lltok etok)<font class="keyword"></font>
00220 <font class="keyword"></font>{
00221   <font class="keywordtype">int</font> tok = lltok_getTok (stok);
00222 
00223   <font class="keywordflow">switch</font> (tok)
00224     {
00225     <font class="keywordflow">case</font> QPRECLAUSE:
00226       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, 
00227                                         specialClause_create (TK_BEFORE, kind, s));
00228       <font class="keywordflow">break</font>;
00229     <font class="keywordflow">case</font> QPOSTCLAUSE:
00230       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, 
00231                                         specialClause_create (TK_AFTER, kind, s));
00232       <font class="keywordflow">break</font>;
00233     <font class="keywordflow">default</font>:
00234       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (s);
00235       BADBRANCH;
00236     }
00237 
00238   DPRINTF ((<font class="stringliteral">"Added to specclauses: %s"</font>, specialClauses_unparse (specClauses)));
00239 }
00240 
<a name="l00241"></a><a class="code" href="clabstract_c.html#a37">00241</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a37">setFunctionSpecialClause</a> (lltok stok, sRefSet s, 
00242                                <font class="comment">/*@unused@*/</font> lltok etok)<font class="keyword"></font>
00243 <font class="keyword"></font>{
00244   <font class="keywordtype">int</font> tok = lltok_getTok (stok);
00245 
00246   <font class="keywordflow">switch</font> (tok)
00247     {
00248     <font class="keywordflow">case</font> QUSES:
00249       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, specialClause_createUses (s));
00250       <font class="keywordflow">break</font>;
00251     <font class="keywordflow">case</font> QDEFINES:
00252       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, specialClause_createDefines (s));
00253       <font class="keywordflow">break</font>;
00254     <font class="keywordflow">case</font> QALLOCATES:
00255       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, specialClause_createAllocates (s));
00256       <font class="keywordflow">break</font>;
00257     <font class="keywordflow">case</font> QSETS:
00258       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, specialClause_createSets (s));
00259       <font class="keywordflow">break</font>;
00260     <font class="keywordflow">case</font> QRELEASES:
00261       specClauses = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specClauses, specialClause_createReleases (s));
00262       <font class="keywordflow">break</font>;
00263     <font class="keywordflow">default</font>:
00264       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (s);
00265       BADBRANCH;
00266     }
00267 
00268   DPRINTF ((<font class="stringliteral">"Added to specclauses: %s"</font>, specialClauses_unparse (specClauses)));
00269 }
00270 
<a name="l00271"></a><a class="code" href="clabstract_c.html#a38">00271</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a38">setFunctionModifies</a> (sRefSet s)<font class="keyword"></font>
00272 <font class="keyword"></font>{
00273   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (fcnModifies);
00274   fcnModifies = s;
00275 }
00276 
00277 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectGlobalQualifiers (sRef sr, qualList quals)<font class="keyword"></font>
00278 <font class="keyword"></font>{
00279   qualList_elements (quals, qel)<font class="keyword"></font>
00280 <font class="keyword">    </font>{
00281       <font class="keywordflow">if</font> (qual_isGlobalQual (qel)) <font class="comment">/* undef, killed */</font>
00282         {
00283           sstate oldstate = <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (sr);
00284           sstate defstate = <a class="code" href="varKinds_c.html#a16">sstate_fromQual</a> (qel);
00285           
00286           <font class="keywordflow">if</font> ((oldstate == SS_UNDEFGLOB &amp;&amp; defstate == SS_KILLED)
00287               || (oldstate == SS_KILLED &amp;&amp; defstate == SS_UNDEFGLOB))
00288             {
00289               defstate = SS_UNDEFKILLED;
00290             }
00291           <font class="keywordflow">else</font> 
00292             {
00293               ; <font class="comment">/* any errors? */</font>
00294             }
00295           
00296           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sr, defstate, fileloc_undefined);
00297         }
00298       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isAllocQual (qel)) <font class="comment">/* out, partial, reldef, etc. */</font>
00299         {
00300           ctype realType = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (sr);
00301           sstate defstate = <a class="code" href="varKinds_c.html#a16">sstate_fromQual</a> (qel);
00302           
00303           <font class="keywordflow">if</font> (qual_isRelDef (qel))
00304             {
00305               ; <font class="comment">/* okay anywhere */</font>
00306             }
00307           <font class="keywordflow">else</font>
00308             {
00309               <font class="keywordflow">if</font> (!ctype_isAP (realType) 
00310                   &amp;&amp; !ctype_isSU (realType)
00311                   &amp;&amp; !ctype_isUnknown (realType)
00312                   &amp;&amp; !<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (sRef_getType (sr)))
00313                 {
00314                   llerror 
00315                     (FLG_SYNTAX, 
00316                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Qualifier %s used on non-pointer or struct: %q"</font>,
00317                               qual_unparse (qel), <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr)));
00318                   
00319                 }
00320             }
00321           
00322           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sr, defstate, fileloc_undefined);
00323         }
00324       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isNull (qel))
00325         {
00326           <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sr, NS_POSNULL, fileloc_undefined);
00327         }
00328       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isRelNull (qel))
00329         {
00330           <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sr, NS_RELNULL, fileloc_undefined);
00331         }
00332       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isNotNull (qel))
00333         {
00334           <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sr, NS_MNOTNULL, fileloc_undefined);
00335         }
00336       <font class="keywordflow">else</font>
00337         {
00338           <font class="keywordflow">if</font> (qual_isCQual (qel))
00339             {
00340               ; <font class="comment">/* okay */</font>
00341             }
00342           <font class="keywordflow">else</font>
00343             {
00344               llerror (FLG_SYNTAX,
00345                        message (<font class="stringliteral">"Qualifier %s cannot be used in a globals list"</font>,
00346                                 qual_unparse (qel)));
00347             }
00348         }
00349     } end_qualList_elements;
00350 }
00351 
<a name="l00352"></a><a class="code" href="clabstract_c.html#a40">00352</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a40">globListAdd</a> (sRef sr, qualList quals)<font class="keyword"></font>
00353 <font class="keyword"></font>{
00354   <font class="keywordflow">if</font> (sRef_isValid (sr))
00355     {
00356       sRef sc = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (sr);
00357 
00358       reflectGlobalQualifiers (sc, quals);
00359       currentGlobals = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (currentGlobals, sc);
00360     }
00361 }
00362 
<a name="l00363"></a><a class="code" href="clabstract_c.html#a41">00363</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a41">declareCIter</a> (cstring name, <font class="comment">/*@owned@*/</font> uentryList params)<font class="keyword"></font>
00364 <font class="keyword"></font>{
00365   uentry ue;
00366 
00367   ue = <a class="code" href="uentry_c.html#a115">uentry_makeIter</a> (name, 
00368                         ctype_makeFunction (ctype_void, params), 
00369                         <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc));
00370 
00371   <a class="code" href="usymtab_c.html#a50">usymtab_supEntry</a> (uentry_makeEndIter (name, fileloc_copy (g_currentloc)));
00372 
00373   reflectModGlobs (ue);
00374 
00375   ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00376 }
00377 
<a name="l00378"></a><a class="code" href="clabstract_c.html#a42">00378</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a42">nextIterParam</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00379 <font class="keyword"></font>{
00380   llassert (ProcessingIterVars);
00381   saveIterParamNo++;
00382 }
00383 
<a name="l00384"></a><a class="code" href="clabstract_c.html#a43">00384</a> <font class="keyword">extern</font> <font class="keywordtype">int</font> <a class="code" href="clabstract_c.html#a43">iterParamNo</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00385 <font class="keyword"></font>{
00386   llassert (ProcessingIterVars);
00387   <font class="keywordflow">return</font> saveIterParamNo;
00388 }
00389 
00390 <font class="comment">/*</font>
00391 <font class="comment">** yucky hacks to put it in the right place</font>
00392 <font class="comment">*/</font>
00393 
00394 <font class="comment">/*@only@*/</font> uentry 
<a name="l00395"></a><a class="code" href="clabstract_c.html#a44">00395</a> <a class="code" href="clabstract_c.html#a44">makeCurrentParam</a> (idDecl t)<font class="keyword"></font>
00396 <font class="keyword"></font>{
00397   uentry ue;
00398 
00399   saveStoreLoc = fileloc_undefined;
00400 
00401   <font class="comment">/* param number unknown */</font>
00402 
00403   ue = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (t, 0);
00404   <font class="keywordflow">return</font> ue;
00405 }
00406 
00407 ctype
<a name="l00408"></a><a class="code" href="clabstract_c.html#a45">00408</a> <a class="code" href="clabstract_c.html#a45">declareUnnamedEnum</a> (enumNameList el)<font class="keyword"></font>
00409 <font class="keyword"></font>{
00410   ctype ret = <a class="code" href="usymtab_c.html#a123">usymtab_enumEnumNameListType</a> (el);
00411   ctype rt;
00412   uentry e;
00413 
00414   <font class="keywordflow">if</font> (ctype_isDefined (ret))
00415     {
00416       rt = ret;
00417       e = <a class="code" href="uentry_c.html#a124">uentry_makeEnumTagLoc</a> (ctype_enumTag (rt), ret);
00418 
00419       reflectStorageClass (e);
00420       <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (e);
00421       
00422       declareEnumList (el, ret, g_currentloc);    
00423       <a class="code" href="enumNameList_c.html#a13">enumNameList_free</a> (el);
00424     }
00425   <font class="keywordflow">else</font>
00426     {
00427       ctype ct = <a class="code" href="ctype_c.html#a116">ctype_createEnum</a> (fakeTag (), el);
00428 
00429       e = <a class="code" href="uentry_c.html#a124">uentry_makeEnumTagLoc</a> (ctype_enumTag (ctype_realType (ct)), ct);
00430       reflectStorageClass (e);
00431 
00432       e = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (e);
00433       rt = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (e);
00434       declareEnumList (el, ct, g_currentloc);    
00435     }
00436   
00437   <font class="keywordflow">return</font> (rt);
00438 }
00439 
00440 ctype
<a name="l00441"></a><a class="code" href="clabstract_c.html#a46">00441</a> <a class="code" href="clabstract_c.html#a46">declareEnum</a> (cstring ename, enumNameList el)<font class="keyword"></font>
00442 <font class="keyword"></font>{
00443   ctype cet;
00444   uentry e;
00445 
00446   llassert (cstring_isDefined (ename));
00447 
00448   cet = <a class="code" href="ctype_c.html#a116">ctype_createEnum</a> (ename, el);
00449   e = <a class="code" href="uentry_c.html#a124">uentry_makeEnumTagLoc</a> (ename, cet);
00450   reflectStorageClass (e);
00451   e = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (e);
00452   cet = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
00453   declareEnumList (el, cet, uentry_whereLast (e));    
00454   <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (e));
00455 }
00456 
00457 <font class="keyword">static</font> <font class="keywordtype">void</font>
00458 declareEnumList (enumNameList el, ctype c, fileloc loc)<font class="keyword"></font>
00459 <font class="keyword"></font>{
00460   <font class="keywordtype">bool</font> boolnames = FALSE;
00461   <font class="keywordtype">bool</font> othernames = FALSE;
00462 
00463   (<font class="keywordtype">void</font>) <a class="code" href="context_c.html#a183">context_getSaveLocation</a> (); <font class="comment">/* undefine it */</font>
00464 
00465   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NUMENUMMEMBERS))
00466     {
00467       <font class="keywordtype">int</font> maxnum = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_NUMENUMMEMBERS);
00468       <font class="keywordtype">int</font> num = enumNameList_size (el);
00469 
00470       <font class="keywordflow">if</font> (num &gt; maxnum)
00471         {
00472           voptgenerror 
00473             (FLG_NUMENUMMEMBERS,
00474              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enumerator %s declared with %d members (limit is set to %d)"</font>,
00475                       ctype_unparse (c), num, maxnum),
00476              loc);
00477         }
00478     }
00479 
00480   enumNameList_elements (el, e)<font class="keyword"></font>
00481 <font class="keyword">    </font>{
00482       uentry ue = <a class="code" href="usymtab_c.html#a115">usymtab_lookupExposeGlob</a> (e);
00483       ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
00484 
00485       llassert (uentry_isEnumConstant (ue));
00486 
00487       <font class="keywordflow">if</font> (ctype_isUnknown (ct))
00488         {
00489           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (ue, c);
00490         }
00491       <font class="keywordflow">else</font>
00492         {
00493           <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (e, context_getFalseName ())
00494               || <a class="code" href="cstring_c.html#a18">cstring_equal</a> (e, context_getTrueName ()))
00495             {
00496               <font class="keywordflow">if</font> (othernames) 
00497                 {
00498                   <font class="keywordflow">if</font> (optgenerror 
00499                       (FLG_INCONDEFS,
00500                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enumerator mixes boolean name (%s) with "</font>
00501                                 <font class="stringliteral">"non-boolean names"</font>,
00502                                 e),
00503                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00504                     {
00505                       ;
00506                     }
00507                 }
00508               
00509               boolnames = TRUE;
00510               <a class="code" href="uentry_c.html#a216">uentry_setType</a> (ue, ctype_bool);
00511               DPRINTF ((<font class="stringliteral">"Set type: %s / %s"</font>,
00512                         uentry_unparse (ue), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ctype_bool)));
00513             }
00514           <font class="keywordflow">else</font> 
00515             {
00516               <font class="keywordflow">if</font> (boolnames) 
00517                 {
00518                   <font class="keywordflow">if</font> (optgenerror 
00519                       (FLG_INCONDEFS,
00520                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enumerator mixes boolean names (%s, %s) with "</font>
00521                                 <font class="stringliteral">"non-boolean name: %s"</font>,
00522                                 context_getTrueName (),
00523                                 <a class="code" href="context_c.html#a247">context_getFalseName</a> (),
00524                                 e),
00525                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00526                     {
00527                       ;
00528                     }
00529                 }
00530 
00531               othernames = TRUE;
00532             }
00533 
00534           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (c, ct))
00535             {
00536               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (ct))
00537                 {
00538                   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (e, context_getFalseName ())
00539                       || <a class="code" href="cstring_c.html#a18">cstring_equal</a> (e, context_getTrueName ()))
00540                     {
00541                       DPRINTF ((<font class="stringliteral">"Here we are!"</font>));
00542                     }
00543                   <font class="keywordflow">else</font>
00544                     {
00545                       <font class="keywordflow">if</font> (optgenerror 
00546                           (FLG_INCONDEFS,
00547                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enumerator member %s declared with "</font>
00548                                     <font class="stringliteral">"inconsistent type: %s"</font>,
00549                                     e, ctype_unparse (c)),
00550                            <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00551                         {
00552                           uentry_showWhereSpecifiedExtra 
00553                             (ue, <a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (ct)));
00554                         }
00555                     }
00556                 }
00557               <font class="keywordflow">else</font>
00558                 {
00559                   <font class="keywordflow">if</font> (optgenerror 
00560                       (FLG_INCONDEFS,
00561                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Enumerator member %s declared with "</font>
00562                                 <font class="stringliteral">"inconsistent type: %s"</font>,
00563                                 e, ctype_unparse (c)),
00564                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue)))
00565                     {
00566                       uentry_showWhereSpecifiedExtra 
00567                         (ue, <a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (ct)));
00568                     }
00569                 }
00570             }
00571         }
00572     } end_enumNameList_elements;
00573 }
00574 
00575 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> uentryList currentParamList;
00576 
<a name="l00577"></a><a class="code" href="clabstract_c.html#a47">00577</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a47">setCurrentParams</a> (<font class="comment">/*@dependent@*/</font> uentryList ue)<font class="keyword"></font>
00578 <font class="keyword"></font>{
00579   currentParamList = ue;
00580 }
00581 
<a name="l00582"></a><a class="code" href="clabstract_c.html#a48">00582</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a48">clearCurrentParams</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00583 <font class="keyword"></font>{
00584     currentParamList = uentryList_undefined;
00585 }
00586 
00587 <font class="comment">/*</font>
00588 <font class="comment">** requires: uentry_isFunction (e)</font>
00589 <font class="comment">**           parameter names for current function are in currentParamList</font>
00590 <font class="comment">*/</font>
00591 
00592 <font class="keyword">static</font> <font class="keywordtype">void</font> enterFunctionParams (uentryList params)<font class="keyword"></font>
00593 <font class="keyword"></font>{
00594   <font class="keywordtype">int</font> paramno = 0;
00595 
00596   uentryList_elements (params, current)<font class="keyword"></font>
00597 <font class="keyword">    </font>{
00598       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (current)) 
00599         {
00600           <a class="code" href="uentry_c.html#a55">uentry_setParamNo</a> (current, paramno);
00601           <a class="code" href="usymtab_c.html#a50">usymtab_supEntry</a> (uentry_copy (current));
00602         }
00603       
00604       paramno++;
00605     } end_uentryList_elements; 
00606 }
00607  
00608 
<a name="l00609"></a><a class="code" href="clabstract_c.html#a50">00609</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a50">enterParamsTemp</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00610 <font class="keyword"></font>{
00611   <a class="code" href="usymtab_c.html#a84">usymtab_enterScope</a> ();
00612   enterFunctionParams (currentParamList);
00613 }
00614 
<a name="l00615"></a><a class="code" href="clabstract_c.html#a51">00615</a> <font class="keyword">extern</font> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a51">exitParamsTemp</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00616 <font class="keyword"></font>{
00617   <a class="code" href="usymtab_c.html#a107">usymtab_quietPlainExitScope</a> ();
00618 }
00619 
00620 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> uentry globalDeclareFunction (idDecl tid)<font class="keyword"> </font>
00621 <font class="keyword"></font>{
00622   ctype deftype = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (tid);
00623   ctype rettype;
00624   uentry ue;
00625   
00626   DPRINTF ((<font class="stringliteral">"Global function: %s"</font>, idDecl_unparse (tid)));
00627   
00628   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (deftype))
00629     {
00630       rettype = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (deftype);
00631     }
00632   <font class="keywordflow">else</font>
00633     {
00634       rettype = ctype_unknown;
00635     }
00636 
00637   <font class="comment">/*</font>
00638 <font class="comment">  ** check has been moved here...</font>
00639 <font class="comment">  */</font>
00640 
00641   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (idDecl_getCtype (tid)))
00642     {
00643       ue = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (tid);
00644       reflectSpecialCode (ue);
00645       reflectArgsUsed (ue);
00646     }
00647   <font class="keywordflow">else</font>
00648     {    
00649       <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Inconsistent function declaration: %q"</font>,
00650                              idDecl_unparse (tid)));
00651 
00652       tid = idDecl_replaceCtype 
00653         (tid, <a class="code" href="ctype_c.html#a46">ctype_makeFunction</a> (ctype_unknown, uentryList_undefined));
00654       ue = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (tid);
00655     }
00656   
00657   reflectStorageClass (ue);
00658 
00659   <a class="code" href="uentry_c.html#a46">uentry_checkParams</a> (ue);
00660   reflectModGlobs (ue);
00661 
00662   ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00663   <a class="code" href="context_c.html#a98">context_enterFunction</a> (ue);
00664   enterFunctionParams (uentry_getParams (ue));
00665 
00666   resetStorageClass ();
00667   <font class="keywordflow">return</font> (ue);
00668 }
00669 
00670 <font class="comment">/*</font>
00671 <font class="comment">** for now, no type checking</font>
00672 <font class="comment">** (must check later though!)</font>
00673 <font class="comment">*/</font>
00674 
00675 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry globalDeclareOldStyleFunction (idDecl tid)<font class="keyword"></font>
00676 <font class="keyword"></font>{
00677   uentry ue;
00678 
00679   <font class="comment">/*</font>
00680 <font class="comment">  ** check has been moved here...</font>
00681 <font class="comment">  */</font>
00682 
00683   <font class="keywordflow">if</font> (cstring_equalLit (idDecl_observeId (tid), <font class="stringliteral">"main"</font>))
00684     {
00685       <a class="code" href="context_c.html#a187">context_setFlagTemp</a> (FLG_MAINTYPE, FALSE);
00686     }
00687 
00688   ue = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (tid);
00689   reflectStorageClass (ue);
00690   reflectSpecialCode (ue);
00691   reflectArgsUsed (ue);
00692   <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (ue, g_currentloc);
00693 
00694     <a class="code" href="uentry_c.html#a46">uentry_checkParams</a> (ue);
00695   
00696   <font class="keywordflow">if</font> (ProcessingGlobals)
00697     {
00698       <a class="code" href="uentry_c.html#a101">uentry_setGlobals</a> (ue, currentGlobals);
00699     }
00700 
00701   resetStorageClass ();
00702   <font class="keywordflow">return</font> (ue);
00703 }
00704 
00705 <font class="keyword">static</font> <font class="keywordtype">void</font> oldStyleDeclareFunction (<font class="comment">/*@only@*/</font> uentry e)<font class="keyword"></font>
00706 <font class="keyword"></font>{
00707   uentryList params = saveParamList;
00708   ctype rt = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (e);
00709 
00710   llassert (ctype_isFunction (rt));
00711 
00712   e = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (e);
00713 
00714   <a class="code" href="context_c.html#a98">context_enterFunction</a> (e);
00715   enterFunctionParams (params);
00716   saveParamList = uentryList_undefined;
00717   resetStorageClass ();
00718 }
00719 
<a name="l00720"></a><a class="code" href="clabstract_c.html#a55">00720</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a55">declareFunction</a> (idDecl tid) <font class="comment">/*@globals undef saveFunction; @*/</font>
00721 {
00722   uentry ue;
00723 
00724   DPRINTF ((<font class="stringliteral">"Declare function: %s"</font>, idDecl_unparse (tid)));
00725   
00726   <font class="keywordflow">if</font> (ProcessingParams)
00727     {
00728       ue = globalDeclareOldStyleFunction (tid);
00729       saveFunction = ue;
00730     }
00731   <font class="keywordflow">else</font>
00732     {
00733       saveFunction = uentry_undefined;
00734 
00735       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a176">context_inRealFunction</a> ())
00736         {
00737           ue = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (idDecl_observeId (tid), ctype_unknown);
00738 
00739           <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Function declared inside function: %q"</font>,
00740                                  idDecl_unparse (tid)));
00741           
00742           <a class="code" href="context_c.html#a130">context_quietExitFunction</a> ();
00743           ue = <a class="code" href="usymtab_c.html#a52">usymtab_supEntryReturn</a> (ue);
00744         }
00745       <font class="keywordflow">else</font>
00746         {
00747           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a203">context_inInnerScope</a> ())
00748             {
00749               <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Declaration in inner context: %q"</font>,
00750                                      idDecl_unparse (tid)));
00751               
00752               <a class="code" href="sRef_c.html#a81">sRef_setGlobalScope</a> ();
00753               ue = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (idDecl_observeId (tid), 
00754                                            ctype_unknown);
00755               ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00756               <a class="code" href="sRef_c.html#a82">sRef_clearGlobalScope</a> ();
00757             }
00758           <font class="keywordflow">else</font>
00759             {
00760               ue = globalDeclareFunction (tid);
00761             }
00762         }
00763       
00764       resetGlobals ();
00765     }
00766 
00767   resetStorageClass ();
00768   <a class="code" href="idDecl_c.html#a1">idDecl_free</a> (tid);
00769 }
00770 
<a name="l00771"></a><a class="code" href="clabstract_c.html#a56">00771</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a56">declareStaticFunction</a> (idDecl tid) <font class="comment">/*@globals undef saveFunction; @*/</font>
00772 {
00773   uentry ue;
00774 
00775   DPRINTF ((<font class="stringliteral">"Declare static funciton: %s"</font>, idDecl_unparse (tid)));
00776 
00777   <font class="keywordflow">if</font> (ProcessingParams)
00778     {
00779       ue = globalDeclareOldStyleFunction (tid);
00780       saveFunction = ue;
00781     }
00782   <font class="keywordflow">else</font>
00783     {
00784       saveFunction = uentry_undefined;
00785 
00786       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a176">context_inRealFunction</a> ())
00787         {
00788           ue = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (idDecl_observeId (tid), ctype_unknown);
00789 
00790           <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Function declared inside function: %q"</font>,
00791                                  idDecl_unparse (tid)));
00792           
00793           <a class="code" href="context_c.html#a130">context_quietExitFunction</a> ();
00794           ue = <a class="code" href="usymtab_c.html#a52">usymtab_supEntryReturn</a> (ue);
00795         }
00796       <font class="keywordflow">else</font>
00797         {
00798           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a203">context_inInnerScope</a> ())
00799             {
00800               <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Declaration in inner context: %q"</font>,
00801                                      idDecl_unparse (tid)));
00802               
00803               <a class="code" href="sRef_c.html#a81">sRef_setGlobalScope</a> ();
00804               ue = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (idDecl_observeId (tid), 
00805                                            ctype_unknown);
00806               ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00807               <a class="code" href="sRef_c.html#a82">sRef_clearGlobalScope</a> ();
00808             }
00809           <font class="keywordflow">else</font>
00810             {
00811               ctype deftype = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (tid);
00812               ctype rettype;
00813               
00814               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (deftype))
00815                 {
00816                   rettype = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (deftype);
00817                 }
00818               <font class="keywordflow">else</font>
00819                 {
00820                   rettype = ctype_unknown;
00821                 }
00822               
00823               <font class="comment">/*</font>
00824 <font class="comment">              ** check has been moved here...</font>
00825 <font class="comment">              */</font>
00826               
00827               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (idDecl_getCtype (tid)))
00828                 {
00829                   ue = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (tid);
00830                   reflectSpecialCode (ue);
00831                   reflectArgsUsed (ue);
00832                 }
00833               <font class="keywordflow">else</font>
00834                 {    
00835                   <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Inconsistent function declaration: %q"</font>,
00836                                          idDecl_unparse (tid)));
00837                   
00838                   tid = idDecl_replaceCtype 
00839                     (tid, <a class="code" href="ctype_c.html#a46">ctype_makeFunction</a> (ctype_unknown, uentryList_undefined));
00840                   ue = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (tid);
00841                 }
00842               
00843               reflectStorageClass (ue);
00844               <a class="code" href="uentry_c.html#a53">uentry_setStatic</a> (ue);
00845 
00846               <a class="code" href="uentry_c.html#a46">uentry_checkParams</a> (ue);
00847               reflectModGlobs (ue);
00848         
00849               DPRINTF ((<font class="stringliteral">"Sub global entry: %s"</font>, uentry_unparse (ue)));
00850               ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00851 
00852               <a class="code" href="context_c.html#a98">context_enterFunction</a> (ue);
00853               enterFunctionParams (uentry_getParams (ue));
00854               resetStorageClass ();
00855             }
00856         }
00857       
00858       resetGlobals ();
00859     }
00860   
00861   resetStorageClass ();
00862   <a class="code" href="idDecl_c.html#a1">idDecl_free</a> (tid);
00863 }
00864 
00865 <font class="keywordtype">void</font>
00866 checkTypeDecl (uentry e, ctype rep)<font class="keyword"></font>
00867 <font class="keyword"></font>{
00868   cstring n = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (e);
00869 
00870   DPRINTF ((<font class="stringliteral">"Check type decl: %s"</font>, n));
00871 
00872   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (context_getBoolName (), n))
00873     {
00874       ctype rrep = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (rep);
00875       
00876       <font class="comment">/*</font>
00877 <font class="comment">      ** for abstract enum types, we need to fix the enum members:</font>
00878 <font class="comment">      ** they should have the abstract type, not the rep type.</font>
00879 <font class="comment">      */</font>
00880       
00881       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (ctype_realType (rrep)))
00882         {
00883           enumNameList el = <a class="code" href="ctype_c.html#a114">ctype_elist</a> (rrep);
00884           
00885           enumNameList_elements (el, ye)<font class="keyword"></font>
00886 <font class="keyword">            </font>{
00887               <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a126">usymtab_existsGlob</a> (ye))
00888                 {
00889                   uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (ye);
00890                   <a class="code" href="uentry_c.html#a216">uentry_setType</a> (ue, ctype_bool);
00891                 }
00892 
00893               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (context_getTrueName (), ye)
00894                   || <a class="code" href="cstring_c.html#a18">cstring_equal</a> (context_getFalseName (), ye))
00895                 {
00896                   ;
00897                 }
00898               <font class="keywordflow">else</font>
00899                 {
00900                   vgenhinterror 
00901                     (FLG_SYNTAX,
00902                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Member of boolean enumerated type definition "</font>
00903                               <font class="stringliteral">"does not match name set to represent TRUE "</font>
00904                               <font class="stringliteral">"or FALSE: %s"</font>,
00905                               ye),
00906                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Use -boolfalse and -booltrue to set the "</font>
00907                               <font class="stringliteral">"name of false and true boolean values."</font>),
00908                      <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (e));
00909                 }
00910             } end_enumNameList_elements;
00911         }
00912     }
00913 
00914   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a124">usymtab_exists</a> (n))
00915     {
00916       usymId llm = <a class="code" href="usymtab_c.html#a68">usymtab_getId</a> (n);
00917       uentry le  = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (llm);
00918 
00919       <a class="code" href="uentry_c.html#a208">uentry_setDeclared</a> (e, g_currentloc); 
00920       <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (e, sRef_makeGlobal (llm, uentry_getType (le)));
00921 
00922       DPRINTF ((<font class="stringliteral">"Here we are: %s / %s"</font>,
00923                 n, context_getBoolName ()));
00924       
00925       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a166">uentry_isAbstractDatatype</a> (le))
00926         {
00927           ctype rrep = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (rep);
00928 
00929           <font class="comment">/*</font>
00930 <font class="comment">          ** for abstract enum types, we need to fix the enum members:</font>
00931 <font class="comment">          ** they should have the abstract type, not the rep type.</font>
00932 <font class="comment">          */</font>
00933 
00934           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (ctype_realType (rrep)))
00935             {
00936               ctype at = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (le);
00937               enumNameList el = <a class="code" href="ctype_c.html#a114">ctype_elist</a> (rrep);
00938 
00939               enumNameList_elements (el, ye)<font class="keyword"></font>
00940 <font class="keyword">                </font>{
00941                   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a126">usymtab_existsGlob</a> (ye))
00942                     {
00943                       uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (ye);
00944 
00945                       llassert (uentry_isEitherConstant (ue));
00946                       llassertprint (ctype_match (uentry_getType (ue), rrep),
00947                                      (<font class="stringliteral">"Bad enum: %s / %s"</font>,
00948                                       <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (ue),
00949                                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (rrep)));
00950                       
00951                       <a class="code" href="uentry_c.html#a216">uentry_setType</a> (ue, at);
00952                     }
00953                 } end_enumNameList_elements;
00954             }
00955           
00956           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a168">uentry_isMutableDatatype</a> (le))
00957             {
00958               <font class="comment">/* maybe more complicated if abstract and immutable ? */</font>
00959 
00960               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (rep) &amp;&amp; !<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (rep))
00961                 {
00962                   voptgenerror 
00963                     (FLG_MUTREP,
00964                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Mutable abstract type %s declared without pointer "</font>
00965                               <font class="stringliteral">"indirection: %s (violates assignment semantics)"</font>,
00966                               n, ctype_unparse (rep)),
00967                      <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (e));
00968                   
00969                   <a class="code" href="uentry_c.html#a63">uentry_setMutable</a> (e);
00970                 }
00971             }
00972         }
00973     }
00974   <font class="keywordflow">else</font>
00975     {
00976       fileloc fl = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
00977 
00978       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_LIKELYBOOL)
00979           &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_BOOLINT))
00980         {
00981           <font class="keywordflow">if</font> ((cstring_equalLit (n, <font class="stringliteral">"BOOL"</font>)
00982                || cstring_equalLit (n, <font class="stringliteral">"Bool"</font>)
00983                || cstring_equalLit (n, <font class="stringliteral">"bool"</font>)
00984                || cstring_equalLit (n, <font class="stringliteral">"boolean"</font>)
00985                || cstring_equalLit (n, <font class="stringliteral">"Boolean"</font>)
00986                || cstring_equalLit (n, <font class="stringliteral">"BOOLEAN"</font>))
00987               &amp;&amp; !(<a class="code" href="cstring_c.html#a18">cstring_equal</a> (n, context_getBoolName ())))
00988             {
00989               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a244">context_setBoolName</a> ()) {
00990                 voptgenerror 
00991                   (FLG_LIKELYBOOL,
00992                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Type %s is probably meant as a boolean type, but does "</font>
00993                             <font class="stringliteral">"not match the boolean type name \"%s\"."</font>,
00994                             n,
00995                             context_getBoolName ()),
00996                    fl);
00997               } <font class="keywordflow">else</font>
00998                 voptgenerror 
00999                   (FLG_LIKELYBOOL,
01000                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Type %s is probably meant as a boolean type, "</font>
01001                             <font class="stringliteral">"but the boolean type name is not set. "</font>
01002                             <font class="stringliteral">"Use -booltype %s to set it."</font>,
01003                             n,
01004                             n),
01005                    fl);
01006                 }
01007         }
01008 
01009       <font class="keywordflow">if</font> (!uentry_isStatic (e)
01010           &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (e)) 
01011           &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (fl) 
01012           &amp;&amp; !fileloc_isImport (fl)
01013           &amp;&amp; <a class="code" href="fileloc_c.html#a43">fileloc_isHeader</a> (fl))
01014         {
01015           voptgenerror (FLG_EXPORTTYPE,
01016                         message (<font class="stringliteral">"Type exported, but not specified: %s\n"</font>, n),
01017                         fl);
01018         }
01019     }
01020 
01021   <a class="code" href="cstring_c.html#a27">cstring_free</a> (n);
01022 }
01023 
01024 uentryList
<a name="l01025"></a><a class="code" href="clabstract_c.html#a57">01025</a> <a class="code" href="clabstract_c.html#a57">fixUentryList</a> (idDeclList tl, qtype q)<font class="keyword"></font>
01026 <font class="keyword"></font>{
01027   uentryList f = <a class="code" href="uentryList_c.html#a0">uentryList_new</a> ();
01028   
01029   idDeclList_elements (tl, i)<font class="keyword"></font>
01030 <font class="keyword">  </font>{
01031     <font class="keywordflow">if</font> (idDecl_isDefined (i))
01032       {
01033         uentry ue;
01034         uentry old;
01035         ctype rt;
01036 
01037         (<font class="keywordtype">void</font>) <a class="code" href="idDecl_c.html#a10">idDecl_fixBase</a> (i, q);
01038 
01039         <font class="comment">/*</font>
01040 <font class="comment">        ** implicit annotations </font>
01041 <font class="comment">        */</font>
01042 
01043         (<font class="keywordtype">void</font>) fixStructDecl (i);
01044 
01045         ue = <a class="code" href="uentry_c.html#a82">uentry_makeIdVariable</a> (i);
01046         rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (ue));
01047 
01048         <font class="comment">/*</font>
01049 <font class="comment">        ** where is this here???</font>
01050 <font class="comment"></font>
01051 <font class="comment">        if (ctype_isArray (rt) || ctype_isSU (rt))</font>
01052 <font class="comment">          {</font>
01053 <font class="comment">            sRef_setAllocated (uentry_getSref (ue), uentry_whereDefined (ue));</font>
01054 <font class="comment">          }</font>
01055 <font class="comment"></font>
01056 <font class="comment">        **</font>
01057 <font class="comment">        */</font>
01058 
01059         <font class="keywordflow">if</font> (uentry_isValid (old = uentryList_lookupField (f, uentry_rawName (ue))))
01060           {
01061             <font class="keywordflow">if</font> (optgenerror (FLG_SYNTAX,
01062                              message (<font class="stringliteral">"Field name reused: %s"</font>, uentry_rawName (ue)),
01063                              <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (ue)))
01064               {
01065                 <a class="code" href="llerror_c.html#a33">llgenmsg</a> (message (<font class="stringliteral">"Previous use of %s"</font>, uentry_rawName (ue)),
01066                           <a class="code" href="uentry_c.html#a201">uentry_whereDefined</a> (old));
01067               }
01068           }
01069         
01070         f = <a class="code" href="uentryList_c.html#a4">uentryList_add</a> (f, ue);
01071       }
01072   } end_idDeclList_elements;
01073 
01074   <a class="code" href="idDeclList_c.html#a4">idDeclList_free</a> (tl);
01075   <font class="keywordflow">return</font> (f);
01076 }
01077 
01078 <font class="comment">/*</font>
01079 <font class="comment">** This is a hack to support unnamed struct/union fields as done by</font>
01080 <font class="comment">** Microsoft VC++.  It is not supported by the ANSI standard.  </font>
01081 <font class="comment">**</font>
01082 <font class="comment">** The inner fields are added to the outer structure.  This is meaningful</font>
01083 <font class="comment">** for nesting structs inside unions, but lclint does no related </font>
01084 <font class="comment">** checking.</font>
01085 <font class="comment">*/</font>
01086 
01087 uentryList
<a name="l01088"></a><a class="code" href="clabstract_c.html#a58">01088</a> <a class="code" href="clabstract_c.html#a58">fixUnnamedDecl</a> (qtype q)<font class="keyword"></font>
01089 <font class="keyword"></font>{
01090   ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (qtype_getType (q));
01091 
01092   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct) || <a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ct))
01093     {
01094       uentryList res = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ct);
01095 
01096       <font class="keywordflow">return</font> (<a class="code" href="uentryList_c.html#a12">uentryList_copy</a> (res));
01097     }
01098   <font class="keywordflow">else</font>
01099     {      
01100       BADBRANCHCONT;
01101     }
01102 
01103   <font class="keywordflow">return</font> uentryList_undefined;
01104 }
01105 
<a name="l01106"></a><a class="code" href="clabstract_c.html#a59">01106</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a59">setStorageClass</a> (storageClassCode sc)<font class="keyword"></font>
01107 <font class="keyword"></font>{
01108   storageClass = sc;
01109 }
01110 
01111 <font class="keywordtype">void</font>
<a name="l01112"></a><a class="code" href="clabstract_c.html#a60">01112</a> <a class="code" href="clabstract_c.html#a60">setProcessingIterVars</a> (uentry iter)<font class="keyword"></font>
01113 <font class="keyword"></font>{
01114   ProcessingIterVars = TRUE;
01115   currentIter = iter;
01116   saveIterParamNo = 0;
01117 }
01118 
01119 <font class="keywordtype">void</font>
<a name="l01120"></a><a class="code" href="clabstract_c.html#a61">01120</a> <a class="code" href="clabstract_c.html#a61">setProcessingGlobalsList</a> ()<font class="keyword"></font>
01121 <font class="keyword"></font>{
01122   ProcessingGlobals = TRUE;
01123 
01124   llassert (globSet_isUndefined (currentGlobals));
01125   currentGlobals = globSet_undefined;
01126 
01127   llassert (sRefSet_isUndefined (fcnModifies));
01128   fcnModifies = sRefSet_undefined;
01129   
01130   <font class="comment">/*</font>
01131 <font class="comment">  ** No, special clauses might have been processed first!  </font>
01132 <font class="comment">  llassert (specialClauses_isUndefined (specClauses));</font>
01133 <font class="comment">  specClauses = specialClauses_undefined;</font>
01134 <font class="comment">  */</font>
01135 
01136   fcnNoGlobals = FALSE;
01137 }
01138 
01139 <font class="keyword">static</font> <font class="keywordtype">bool</font> ProcessingGlobMods = FALSE;
01140 
01141 <font class="keywordtype">void</font>
<a name="l01142"></a><a class="code" href="clabstract_c.html#a62">01142</a> <a class="code" href="clabstract_c.html#a62">setProcessingGlobMods</a> ()<font class="keyword"></font>
01143 <font class="keyword"></font>{
01144   ProcessingGlobMods = TRUE;
01145 }
01146 
01147 <font class="keywordtype">void</font>
<a name="l01148"></a><a class="code" href="clabstract_c.html#a63">01148</a> <a class="code" href="clabstract_c.html#a63">clearProcessingGlobMods</a> ()<font class="keyword"></font>
01149 <font class="keyword"></font>{
01150   ProcessingGlobMods = FALSE;
01151 }
01152 
01153 <font class="keywordtype">bool</font>
<a name="l01154"></a><a class="code" href="clabstract_c.html#a64">01154</a> <a class="code" href="clabstract_c.html#a64">isProcessingGlobMods</a> ()<font class="keyword"></font>
01155 <font class="keyword"></font>{
01156   <font class="keywordflow">return</font> (ProcessingGlobMods);
01157 }
01158 
01159 <font class="keyword">static</font> <font class="keywordtype">void</font> resetGlobals (<font class="keywordtype">void</font>)<font class="keyword"></font>
01160 <font class="keyword"></font>{
01161   ProcessingGlobals = FALSE;
01162   currentGlobals = globSet_undefined;
01163   llassert (sRefSet_isUndefined (fcnModifies));
01164   fcnModifies = sRefSet_undefined;
01165   fcnNoGlobals = FALSE;
01166 }
01167 
01168 <font class="keywordtype">void</font>
<a name="l01169"></a><a class="code" href="clabstract_c.html#a65">01169</a> <a class="code" href="clabstract_c.html#a65">unsetProcessingGlobals</a> ()<font class="keyword"></font>
01170 <font class="keyword"></font>{
01171   ProcessingGlobals = FALSE;
01172 }
01173 
01174 <font class="keywordtype">void</font>
<a name="l01175"></a><a class="code" href="clabstract_c.html#a66">01175</a> <a class="code" href="clabstract_c.html#a66">setProcessingVars</a> (<font class="comment">/*@only@*/</font> qtype q)<font class="keyword"></font>
01176 <font class="keyword"></font>{
01177   ProcessingVars = TRUE;
01178   <a class="code" href="qtype_c.html#a1">qtype_free</a> (processingType);
01179   processingType = q;
01180 }
01181 
01182 <font class="keyword">static</font> <font class="keywordtype">void</font>
01183 setGenericParamList (<font class="comment">/*@dependent@*/</font> uentryList pm)<font class="keyword"></font>
01184 <font class="keyword"></font>{
01185   ProcessingParams = TRUE;
01186   saveParamList = pm;
01187 }
01188 
01189 <font class="keywordtype">void</font>
<a name="l01190"></a><a class="code" href="clabstract_c.html#a68">01190</a> <a class="code" href="clabstract_c.html#a68">setProcessingTypedef</a> (<font class="comment">/*@only@*/</font> qtype q)<font class="keyword"></font>
01191 <font class="keyword"></font>{
01192   ProcessingTypedef = TRUE;
01193 
01194   <a class="code" href="qtype_c.html#a1">qtype_free</a> (processingType);
01195   processingType = q;
01196 }
01197 
01198 <font class="keywordtype">void</font>
<a name="l01199"></a><a class="code" href="clabstract_c.html#a69">01199</a> <a class="code" href="clabstract_c.html#a69">unsetProcessingVars</a> ()<font class="keyword"></font>
01200 <font class="keyword"></font>{
01201   resetStorageClass ();
01202   ProcessingVars = FALSE;
01203 }
01204 
01205 <font class="keywordtype">void</font> 
<a name="l01206"></a><a class="code" href="clabstract_c.html#a70">01206</a> <a class="code" href="clabstract_c.html#a70">doneParams</a> ()<font class="keyword"></font>
01207 <font class="keyword"></font>{  
01208   <font class="keywordflow">if</font> (ProcessingParams)
01209     {
01210       <font class="keywordflow">if</font> (uentry_isInvalid (saveFunction))
01211         {
01212           llbuglit (<font class="stringliteral">"unsetProcessingVars: no saved function\n"</font>);
01213           
01214           <font class="keywordflow">if</font> (sRefSet_isDefined (fcnModifies)) {
01215             <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (fcnModifies);
01216             fcnModifies = sRefSet_undefined;
01217           }
01218         }
01219       <font class="keywordflow">else</font>
01220         {
01221           ctype ct = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (uentry_getType (saveFunction));
01222           uentryList params = <a class="code" href="uentryList_c.html#a12">uentryList_copy</a> (saveParamList);
01223           ctype ct2 = <a class="code" href="ctype_c.html#a46">ctype_makeFunction</a> (ct, params);
01224 
01225           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (saveFunction, ct2);
01226           ProcessingParams = FALSE;
01227 
01228           reflectModGlobs (saveFunction);
01229           oldStyleDeclareFunction (saveFunction);
01230           saveFunction = uentry_undefined;
01231           resetGlobals ();
01232         }
01233     }
01234   <font class="keywordflow">else</font>
01235     {
01236       <font class="comment">/*</font>
01237 <font class="comment">      ** If the paramlist used a type name, we could be here.</font>
01238 <font class="comment">      */</font>
01239 
01240       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"%q: Old-style function parameter list uses a "</font>
01241                              <font class="stringliteral">"type name."</font>, fileloc_unparse (g_currentloc)));
01242     }
01243 }
01244 
01245 <font class="keywordtype">void</font> 
<a name="l01246"></a><a class="code" href="clabstract_c.html#a71">01246</a> <a class="code" href="clabstract_c.html#a71">checkDoneParams</a> ()<font class="keyword"></font>
01247 <font class="keyword"></font>{
01248   <font class="keywordflow">if</font> (uentry_isValid (saveFunction))
01249     {
01250       <font class="comment">/*</font>
01251 <font class="comment">      ** old style declaration</font>
01252 <font class="comment">      */</font>
01253 
01254       ctype ct = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (uentry_getType (saveFunction));
01255       ctype ct2;
01256 
01257       uentryList_elements (saveParamList, current)<font class="keyword"></font>
01258 <font class="keyword">        </font>{
01259           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (current, ctype_int); <font class="comment">/* all params are ints */</font>
01260         } end_uentryList_elements; 
01261 
01262       ct2 = <a class="code" href="ctype_c.html#a44">ctype_makeParamsFunction</a> (ct, uentryList_copy (saveParamList));
01263       
01264       <a class="code" href="uentry_c.html#a216">uentry_setType</a> (saveFunction, ct2);
01265       ProcessingParams = FALSE;
01266       
01267       oldStyleDeclareFunction (saveFunction);
01268       saveFunction = uentry_undefined;
01269     }
01270 }
01271 
01272 <font class="keywordtype">void</font>
<a name="l01273"></a><a class="code" href="clabstract_c.html#a72">01273</a> <a class="code" href="clabstract_c.html#a72">unsetProcessingTypedef</a> ()<font class="keyword"></font>
01274 <font class="keyword"></font>{
01275   ProcessingTypedef = FALSE;
01276 }
01277 
<a name="l01278"></a><a class="code" href="clabstract_c.html#a73">01278</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a73">checkConstant</a> (qtype t, idDecl id)<font class="keyword"> </font>
01279 <font class="keyword"></font>{
01280   uentry e;
01281 
01282   id = <a class="code" href="idDecl_c.html#a10">idDecl_fixBase</a> (id, t);
01283   e = <a class="code" href="uentry_c.html#a86">uentry_makeIdConstant</a> (id);
01284 
01285   reflectStorageClass (e);
01286   resetStorageClass ();
01287 
01288   <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (e);
01289 }
01290 
<a name="l01291"></a><a class="code" href="clabstract_c.html#a74">01291</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a74">checkValueConstant</a> (qtype t, idDecl id, exprNode e)<font class="keyword"> </font>
01292 <font class="keyword"></font>{
01293   uentry ue;
01294 
01295   id = <a class="code" href="idDecl_c.html#a10">idDecl_fixBase</a> (id, t);
01296   ue = <a class="code" href="uentry_c.html#a86">uentry_makeIdConstant</a> (id);
01297   reflectStorageClass (ue);
01298   resetStorageClass ();
01299 
01300   <font class="keywordflow">if</font> (exprNode_isDefined (e))
01301     {
01302       <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (uentry_getType (ue), e))
01303         {
01304           (<font class="keywordtype">void</font>) gentypeerror 
01305             (exprNode_getType (e), e,
01306              <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue), exprNode_undefined,
01307              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Constant %q initialized to type %t, expects %t: %s"</font>,
01308                       uentry_getName (ue),  
01309                       exprNode_getType (e), 
01310                       <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue),
01311                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
01312              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
01313         }
01314       <font class="keywordflow">else</font>
01315         {
01316           <font class="keywordflow">if</font> (exprNode_hasValue (e))
01317             {
01318               <a class="code" href="uentry_c.html#a259">uentry_mergeConstantValue</a> (ue, multiVal_copy (exprNode_getValue (e)));
01319             }
01320         }
01321     }
01322 
01323   <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (ue);
01324 }
01325 
01326 
<a name="l01327"></a><a class="code" href="clabstract_c.html#a75">01327</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a75">processNamedDecl</a> (idDecl t)<font class="keyword"></font>
01328 <font class="keyword"></font>{
01329   <font class="keywordflow">if</font> (qtype_isUndefined (processingType))
01330     {
01331       <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"No type before declaration name: %q"</font>, idDecl_unparse (t)));
01332 
01333       processingType = <a class="code" href="qtype_c.html#a0">qtype_create</a> (ctype_unknown);
01334     }
01335 
01336   t = <a class="code" href="idDecl_c.html#a10">idDecl_fixBase</a> (t, processingType);
01337 
01338   DPRINTF ((<font class="stringliteral">"Declare: %s"</font>, idDecl_unparse (t)));
01339 
01340   <font class="keywordflow">if</font> (ProcessingGlobals)
01341     {
01342       cstring id = idDecl_getName (t);
01343       uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (id);
01344 
01345       <font class="keywordflow">if</font> (!uentry_isValid (ue))
01346         {
01347           llerror (FLG_UNRECOG,
01348                    message (<font class="stringliteral">"Variable used in globals list is undeclared: %s"</font>, id));
01349         }
01350       <font class="keywordflow">else</font>
01351         {
01352           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (uentry_getType (ue), <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (t)))
01353             {
01354               voptgenerror 
01355                 (FLG_INCONDEFS,
01356                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Variable %s used in globals list declared %s, "</font>
01357                           <font class="stringliteral">"but listed as %s"</font>, 
01358                           id, ctype_unparse (uentry_getType (ue)), 
01359                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (idDecl_getCtype (t))),
01360                  g_currentloc);
01361             }
01362           <font class="keywordflow">else</font>
01363             {
01364               sRef sr = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (uentry_getSref (ue));
01365 
01366               reflectGlobalQualifiers (sr, idDecl_getQuals (t));
01367 
01368               currentGlobals = <a class="code" href="globSet_c.html#a2">globSet_insert</a> (currentGlobals, sr);
01369             }
01370         }
01371     }
01372   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ProcessingVars)
01373     {
01374       uentry e;
01375       ctype ct;
01376       
01377       ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (idDecl_getCtype (t));
01378 
01379       <font class="keywordflow">if</font> (ProcessingParams)
01380         {
01381           cstring id = idDecl_getName (t);
01382           <font class="keywordtype">int</font> paramno = <a class="code" href="uentryList_c.html#a11">uentryList_lookupRealName</a> (saveParamList, id);
01383 
01384           <font class="keywordflow">if</font> (paramno &gt;= 0)
01385             {
01386               uentry cparam = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (saveParamList, paramno);
01387 
01388               <a class="code" href="uentry_c.html#a216">uentry_setType</a> (cparam, idDecl_getCtype (t));
01389               <a class="code" href="uentry_c.html#a66">uentry_reflectQualifiers</a> (cparam, idDecl_getQuals (t));
01390               <a class="code" href="uentry_c.html#a207">uentry_setDeclaredOnly</a> (cparam, context_getSaveLocation ());
01391             }
01392           <font class="keywordflow">else</font>
01393             {
01394               llfatalerrorLoc
01395                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Old style declaration uses unlisted parameter: %s"</font>, 
01396                           id));
01397             }
01398         }
01399       <font class="keywordflow">else</font>
01400         {
01401           fileloc loc;
01402 
01403           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> ())
01404             {
01405               cstring pname = <a class="code" href="structNames_c.html#a6">makeParam</a> (idDecl_observeId (t));
01406               uentry p = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (pname);
01407 
01408               <a class="code" href="cstring_c.html#a27">cstring_free</a> (pname);
01409 
01410               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (p))
01411                 {
01412                   e = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (t, sRef_getParam (uentry_getSref (p)));
01413                   
01414                   <a class="code" href="uentry_c.html#a281">uentry_checkYieldParam</a> (p, e);
01415                   
01416                   <a class="code" href="usymtab_c.html#a60">usymtab_supEntrySref</a> (e);
01417                   <font class="keywordflow">return</font>;
01418                 }
01419             }
01420 
01421           <font class="keywordflow">if</font> ((hasSpecialCode () || argsUsed)
01422               &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (idDecl_getCtype (t)))
01423             {
01424               e = <a class="code" href="uentry_c.html#a49">uentry_makeIdFunction</a> (t);
01425               reflectSpecialCode (e);
01426               reflectArgsUsed (e);
01427             }
01428           <font class="keywordflow">else</font>
01429             {
01430               e = <a class="code" href="uentry_c.html#a82">uentry_makeIdVariable</a> (t);
01431             }
01432 
01433           loc = <a class="code" href="uentry_c.html#a202">uentry_whereDeclared</a> (e);
01434 
01435           <font class="comment">/*</font>
01436 <font class="comment">          if (context_inGlobalScope ())</font>
01437 <font class="comment">            {</font>
01438 <font class="comment">            uentry_checkParams was here!</font>
01439 <font class="comment">            }</font>
01440 <font class="comment">            */</font>
01441 
01442           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (e)))
01443             {
01444               reflectModGlobs (e);
01445             }
01446           <font class="keywordflow">else</font>
01447             {
01448               llassert (!globSet_isDefined (currentGlobals)
01449                         &amp;&amp; !sRefSet_isDefined (fcnModifies));
01450             }
01451           
01452           e = <a class="code" href="usymtab_c.html#a53">usymtab_supEntrySrefReturn</a> (e);
01453 
01454           <font class="keywordflow">if</font> (uentry_isExtern (e) &amp;&amp; !<a class="code" href="context_c.html#a202">context_inGlobalScope</a> ())
01455             {
01456               voptgenerror 
01457                 (FLG_NESTEDEXTERN,
01458                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Declaration using extern inside function scope: %q"</font>,
01459                           uentry_unparse (e)),
01460                  g_currentloc);
01461               
01462               <a class="code" href="uentry_c.html#a210">uentry_setDefined</a> (e, fileloc_getExternal ());
01463               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (uentry_getSref (e), <a class="code" href="fileloc_c.html#a26">fileloc_getExternal</a> ());
01464             }
01465 
01466           <font class="keywordflow">if</font> (uentry_isFunction (e))
01467             {
01468               <a class="code" href="uentry_c.html#a46">uentry_checkParams</a> (e);
01469               <a class="code" href="nameChecks_c.html#a19">checkParamNames</a> (e);
01470             }
01471 
01472           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (e) 
01473               &amp;&amp; <a class="code" href="uentry_c.html#a88">uentry_isCheckedUnknown</a> (e))
01474             {
01475               sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (e);
01476 
01477               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sr))
01478                 {
01479                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKMODINTERNALS))
01480                     {
01481                       <a class="code" href="uentry_c.html#a96">uentry_setCheckMod</a> (e);
01482                     }
01483                   <font class="keywordflow">else</font>
01484                     {
01485                       <a class="code" href="uentry_c.html#a94">uentry_setUnchecked</a> (e);
01486                     }
01487                 }
01488               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (sr))
01489                 {
01490                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKEDSTRICTSTATICS))
01491                     {
01492                       <a class="code" href="uentry_c.html#a97">uentry_setCheckedStrict</a> (e);
01493                     }
01494                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKEDSTATICS))
01495                     {
01496                       <a class="code" href="uentry_c.html#a95">uentry_setChecked</a> (e);
01497                     }
01498                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKMODSTATICS))
01499                     {
01500                       <a class="code" href="uentry_c.html#a96">uentry_setCheckMod</a> (e);
01501                     }
01502                   <font class="keywordflow">else</font>
01503                     {
01504                       ;
01505                     }
01506                 }
01507               <font class="keywordflow">else</font> <font class="comment">/* real global */</font>
01508                 {
01509                   llassert (sRef_isRealGlobal (sr));
01510 
01511                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKEDSTRICTGLOBALS))
01512                     {
01513                       <a class="code" href="uentry_c.html#a97">uentry_setCheckedStrict</a> (e);
01514                     }
01515                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKEDGLOBALS))
01516                     {
01517                       <a class="code" href="uentry_c.html#a95">uentry_setChecked</a> (e);
01518                     }
01519                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPCHECKMODGLOBALS))
01520                     {
01521                       <a class="code" href="uentry_c.html#a96">uentry_setCheckMod</a> (e);
01522                     }
01523                   <font class="keywordflow">else</font>
01524                     {
01525                       ;
01526                     }
01527                 }
01528             }
01529         }
01530     }
01531   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ProcessingTypedef)
01532     {
01533       ctype ct = <a class="code" href="idDecl_c.html#a5">idDecl_getCtype</a> (t);
01534       uentry e;
01535 
01536       DPRINTF ((<font class="stringliteral">"Processing typedef: %s"</font>, ctype_unparse (ct)));
01537       
01538       e = <a class="code" href="uentry_c.html#a45">uentry_makeIdDatatype</a> (t);
01539 
01540       <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (idDecl_getName (t), <a class="code" href="context_c.html#a246">context_getBoolName</a> ())) {
01541         ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
01542         
01543         <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (rt)) {
01544           ;
01545         } <font class="keywordflow">else</font> {
01546           <font class="keywordflow">if</font> (!(<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (rt)
01547                 || ctype_isUnknown (rt)
01548                 || <a class="code" href="ctype_c.html#a58">ctype_isChar</a> (rt))) {
01549             (<font class="keywordtype">void</font>) llgenerror
01550               (FLG_BOOLTYPE, 
01551                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Boolean type %s defined using non-standard type %s (integral, char or enum type expected)"</font>,
01552                         context_getBoolName (),
01553                         <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct)),
01554                <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (e));
01555           }
01556           
01557           ct = ctype_bool;
01558           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (e, ct);
01559         }
01560       }
01561 
01562       reflectStorageClass (e);
01563       checkTypeDecl (e, ct);
01564       
01565       e = <a class="code" href="usymtab_c.html#a56">usymtab_supReturnTypeEntry</a> (e);
01566 
01567       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a167">uentry_isMaybeAbstract</a> (e))
01568         {
01569           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPABSTRACT))
01570             {
01571               <a class="code" href="uentry_c.html#a164">uentry_setAbstract</a> (e);
01572             }
01573           <font class="keywordflow">else</font>
01574             {
01575               <a class="code" href="uentry_c.html#a165">uentry_setConcrete</a> (e);
01576             }
01577         }
01578     }
01579   <font class="keywordflow">else</font>
01580     {
01581       <a class="code" href="llerror_c.html#a69">llparseerror</a> (message (<font class="stringliteral">"Suspect missing struct or union keyword: %q"</font>,
01582                              idDecl_unparse (t)));
01583     }
01584 
01585   }
01586 
01587 <font class="comment">/*</font>
01588 <font class="comment">** moved from grammar</font>
01589 <font class="comment">*/</font>
01590 
01591 <font class="keyword">static</font> idDecl fixStructDecl (<font class="comment">/*@returned@*/</font> idDecl d)<font class="keyword"></font>
01592 <font class="keyword"></font>{
01593   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (idDecl_getCtype (d)) 
01594       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRUCTIMPONLY))
01595     {
01596       <font class="keywordflow">if</font> (!<a class="code" href="qualList_c.html#a9">qualList_hasAliasQualifier</a> (idDecl_getQuals (d)))
01597         {
01598           <font class="keywordflow">if</font> (<a class="code" href="qualList_c.html#a10">qualList_hasExposureQualifier</a> (idDecl_getQuals (d)))
01599             {
01600               <a class="code" href="idDecl_c.html#a7">idDecl_addQual</a> (d, qual_createDependent ());
01601             }
01602           <font class="keywordflow">else</font>
01603             {
01604               <a class="code" href="idDecl_c.html#a7">idDecl_addQual</a> (d, qual_createImpOnly ());
01605             }
01606         }
01607     }
01608 
01609   <font class="keywordflow">return</font> d;
01610 }
01611 
01612 ctype
<a name="l01613"></a><a class="code" href="clabstract_c.html#a76">01613</a> <a class="code" href="clabstract_c.html#a76">declareUnnamedStruct</a> (<font class="comment">/*@only@*/</font> uentryList f)<font class="keyword"></font>
01614 <font class="keyword"></font>{
01615   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NUMSTRUCTFIELDS))
01616     {
01617       <font class="keywordtype">int</font> num = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (f);
01618       <font class="keywordtype">int</font> max = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_NUMSTRUCTFIELDS);
01619 
01620       <font class="keywordflow">if</font> (num &gt; max)
01621         {
01622           voptgenerror 
01623             (FLG_NUMSTRUCTFIELDS,
01624              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Structure declared with %d fields "</font>
01625                       <font class="stringliteral">"(limit is set to %d)"</font>,
01626                       num, max),
01627              g_currentloc);
01628         }
01629     }
01630 
01631   <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a124">ctype_createUnnamedStruct</a> (f));
01632 }
01633 
01634 ctype
<a name="l01635"></a><a class="code" href="clabstract_c.html#a77">01635</a> <a class="code" href="clabstract_c.html#a77">declareUnnamedUnion</a> (<font class="comment">/*@only@*/</font> uentryList f)<font class="keyword"></font>
01636 <font class="keyword"></font>{
01637   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NUMSTRUCTFIELDS))
01638     {
01639       <font class="keywordtype">int</font> num = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (f);
01640       <font class="keywordtype">int</font> max = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_NUMSTRUCTFIELDS);
01641 
01642       <font class="keywordflow">if</font> (num &gt; max)
01643         {
01644           voptgenerror 
01645             (FLG_NUMSTRUCTFIELDS,
01646              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Union declared with %d fields "</font>
01647                       <font class="stringliteral">"(limit is set to %d)"</font>,
01648                       num, max),
01649              g_currentloc);
01650         }
01651     }
01652 
01653   <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a125">ctype_createUnnamedUnion</a> (f));
01654 }
01655 
<a name="l01656"></a><a class="code" href="clabstract_c.html#a78">01656</a> ctype <a class="code" href="clabstract_c.html#a78">declareStruct</a> (cstring id, <font class="comment">/*@only@*/</font> uentryList f)<font class="keyword"></font>
01657 <font class="keyword"></font>{
01658   ctype ct; 
01659   uentry ue;
01660   <font class="keywordtype">int</font> num = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (f);
01661 
01662   ct = <a class="code" href="ctype_c.html#a88">ctype_createStruct</a> (cstring_copy (id), f);
01663   ue = <a class="code" href="uentry_c.html#a119">uentry_makeStructTagLoc</a> (id, ct);
01664 
01665   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NUMSTRUCTFIELDS))
01666     {
01667       <font class="keywordtype">int</font> max = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_NUMSTRUCTFIELDS);
01668 
01669       <font class="keywordflow">if</font> (num &gt; max)
01670         {
01671           voptgenerror 
01672             (FLG_NUMSTRUCTFIELDS,
01673              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Structure %q declared with %d fields "</font>
01674                       <font class="stringliteral">"(limit is set to %d)"</font>,
01675                       uentry_getName (ue), num, max),
01676              <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
01677         }
01678     }
01679 
01680   <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a55">usymtab_supTypeEntry</a> (ue));
01681 }
01682 
<a name="l01683"></a><a class="code" href="clabstract_c.html#a79">01683</a> ctype <a class="code" href="clabstract_c.html#a79">declareUnion</a> (cstring id, uentryList f)<font class="keyword"></font>
01684 <font class="keyword"></font>{
01685   ctype ct; 
01686   uentry ue;
01687   <font class="keywordtype">int</font> num = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (f);
01688 
01689   ct = <a class="code" href="ctype_c.html#a90">ctype_createUnion</a> (cstring_copy (id), f);
01690   ue = <a class="code" href="uentry_c.html#a123">uentry_makeUnionTagLoc</a> (id, ct);
01691 
01692   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_NUMSTRUCTFIELDS))
01693     {
01694       <font class="keywordtype">int</font> max = <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_NUMSTRUCTFIELDS);
01695 
01696       <font class="keywordflow">if</font> (num &gt; max)
01697         {
01698           voptgenerror 
01699             (FLG_NUMSTRUCTFIELDS,
01700              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Union %q declared with %d fields "</font>
01701                       <font class="stringliteral">"(limit is set to %d)"</font>,
01702                       uentry_getName (ue), num, max),
01703              <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
01704         }
01705     }
01706 
01707   <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a55">usymtab_supTypeEntry</a> (ue));
01708 }
01709 
<a name="l01710"></a><a class="code" href="clabstract_c.html#a80">01710</a> ctype <a class="code" href="clabstract_c.html#a80">handleStruct</a> (<font class="comment">/*@only@*/</font> cstring id)<font class="keyword"></font>
01711 <font class="keyword"></font>{
01712   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a131">usymtab_existsStructTag</a> (id))
01713     {
01714       ctype ct = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (usymtab_lookupStructTag (id));
01715 
01716       <a class="code" href="cstring_c.html#a27">cstring_free</a> (id);
01717       <font class="keywordflow">return</font> ct;
01718     }
01719   <font class="keywordflow">else</font>
01720     {
01721       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a126">ctype_createForwardStruct</a> (id));
01722     }
01723 }
01724 
<a name="l01725"></a><a class="code" href="clabstract_c.html#a81">01725</a> ctype <a class="code" href="clabstract_c.html#a81">handleUnion</a> (<font class="comment">/*@only@*/</font> cstring id)<font class="keyword"></font>
01726 <font class="keyword"></font>{
01727   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a132">usymtab_existsUnionTag</a> (id))
01728     {
01729       ctype ret = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (usymtab_lookupUnionTag (id));
01730       <a class="code" href="cstring_c.html#a27">cstring_free</a> (id);
01731       <font class="keywordflow">return</font> (ret);
01732     }
01733   <font class="keywordflow">else</font>
01734     {
01735       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a127">ctype_createForwardUnion</a> (id));
01736     }
01737 }
01738 
01739 ctype
<a name="l01740"></a><a class="code" href="clabstract_c.html#a82">01740</a> <a class="code" href="clabstract_c.html#a82">handleEnum</a> (cstring id)<font class="keyword"></font>
01741 <font class="keyword"></font>{
01742   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a133">usymtab_existsEnumTag</a> (id))
01743     {
01744       ctype ret = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (usymtab_lookupEnumTag (id));
01745       <a class="code" href="cstring_c.html#a27">cstring_free</a> (id);
01746       <font class="keywordflow">return</font> ret;
01747     }
01748   <font class="keywordflow">else</font>
01749     {
01750       <font class="keywordflow">return</font> (<a class="code" href="clabstract_c.html#a46">declareEnum</a> (id, enumNameList_new ()));
01751     }
01752 }
01753 
<a name="l01754"></a><a class="code" href="clabstract_c.html#a83">01754</a> <font class="keywordtype">bool</font> <a class="code" href="clabstract_c.html#a83">processingIterVars</a> (<font class="keywordtype">void</font>)<font class="keyword"> </font>
01755 <font class="keyword"></font>{ 
01756   <font class="keywordflow">return</font> ProcessingIterVars; 
01757 }
01758 
<a name="l01759"></a><a class="code" href="clabstract_c.html#a84">01759</a> uentry <a class="code" href="clabstract_c.html#a84">getCurrentIter</a> (<font class="keywordtype">void</font>)<font class="keyword"> </font>
01760 <font class="keyword"></font>{
01761   <font class="keywordflow">return</font> currentIter; 
01762 }
01763 
01764 <font class="keyword">static</font> <font class="keywordtype">bool</font> flipOldStyle = FALSE;
01765 <font class="keyword">static</font> <font class="keywordtype">bool</font> flipNewStyle = TRUE;
01766 
<a name="l01767"></a><a class="code" href="clabstract_c.html#a85">01767</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a85">setFlipOldStyle</a> ()<font class="keyword">          </font>{ flipOldStyle = TRUE; }
<a name="l01768"></a><a class="code" href="clabstract_c.html#a86">01768</a> <font class="keywordtype">bool</font> <a class="code" href="clabstract_c.html#a86">isFlipOldStyle</a> ()<font class="keyword">           </font>{ <font class="keywordflow">return</font> flipOldStyle; }
<a name="l01769"></a><a class="code" href="clabstract_c.html#a87">01769</a> <font class="keywordtype">bool</font> <a class="code" href="clabstract_c.html#a87">isNewStyle</a> ()<font class="keyword">               </font>{ <font class="keywordflow">return</font> flipNewStyle; }
<a name="l01770"></a><a class="code" href="clabstract_c.html#a88">01770</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a88">setNewStyle</a> ()<font class="keyword">              </font>{ flipNewStyle = TRUE; }
01771 
<a name="l01772"></a><a class="code" href="clabstract_c.html#a89">01772</a> <font class="comment">/*@dependent@*/</font> uentryList <a class="code" href="clabstract_c.html#a89">handleParamIdList</a> (<font class="comment">/*@dependent@*/</font> uentryList params)<font class="keyword"></font>
01773 <font class="keyword"></font>{  
01774   <font class="keywordtype">int</font> paramno = 0;
01775 
01776   <font class="comment">/*</font>
01777 <font class="comment">  ** this is a really YUCKY hack to handle old style</font>
01778 <font class="comment">  ** declarations.</font>
01779 <font class="comment">  */</font>
01780   
01781   voptgenerror (FLG_OLDSTYLE,
01782                 cstring_makeLiteral (<font class="stringliteral">"Old style function declaration"</font>),
01783                 g_currentloc); 
01784 
01785   uentryList_elements (params, current)<font class="keyword"></font>
01786 <font class="keyword">    </font>{
01787       <a class="code" href="uentry_c.html#a219">uentry_setParam</a> (current);
01788       <a class="code" href="uentry_c.html#a220">uentry_setSref</a> (current, sRef_makeParam (paramno, ctype_unknown));
01789       paramno++;
01790     } end_uentryList_elements;
01791 
01792   setGenericParamList (params);
01793   g_expectingTypeName = TRUE; 
01794 
01795   <font class="keywordflow">return</font> params;
01796 }
01797 
<a name="l01798"></a><a class="code" href="clabstract_c.html#a90">01798</a> <font class="comment">/*@dependent@*/</font> uentryList <a class="code" href="clabstract_c.html#a90">handleParamTypeList</a> (<font class="comment">/*@returned@*/</font> uentryList params)<font class="keyword"></font>
01799 <font class="keyword"></font>{
01800   <font class="keywordflow">if</font> (flipOldStyle)
01801     {
01802       <a class="code" href="uentryList_c.html#a16">uentryList_fixMissingNames</a> (params);
01803 
01804       voptgenerror (FLG_OLDSTYLE, 
01805                     cstring_makeLiteral (<font class="stringliteral">"Old style function declaration."</font>), 
01806                     g_currentloc); 
01807       
01808       setGenericParamList (params);
01809       flipOldStyle = FALSE;
01810       g_expectingTypeName = TRUE; 
01811     }
01812  
01813   <font class="keywordflow">return</font> (params); 
01814 }
01815 
01816 <font class="keywordtype">void</font>
<a name="l01817"></a><a class="code" href="clabstract_c.html#a91">01817</a> <a class="code" href="clabstract_c.html#a91">doVaDcl</a> ()<font class="keyword"></font>
01818 <font class="keyword"></font>{
01819   ctype c = ctype_unknown;
01820   cstring id = cstring_makeLiteral (<font class="stringliteral">"va_alist"</font>);
01821   uentry e;
01822 
01823   <font class="keywordflow">if</font> (ProcessingParams)
01824     {
01825       <font class="keywordtype">int</font> i = <a class="code" href="uentryList_c.html#a11">uentryList_lookupRealName</a> (saveParamList, id);
01826       
01827       <font class="keywordflow">if</font> (i &gt;= 0)
01828         {
01829           e = <a class="code" href="uentry_c.html#a56">uentry_makeVariableSrefParam</a> (id, c, sRef_makeParam (i, c));
01830         }
01831       <font class="keywordflow">else</font>
01832         {
01833           e = uentry_undefined; <font class="comment">/* suppress gcc message */</font>
01834           <a class="code" href="llerror_c.html#a49">llfatalerrorLoc</a> (cstring_makeLiteral (<font class="stringliteral">"va_dcl used without va_alist"</font>));
01835         }
01836     }
01837   <font class="keywordflow">else</font>
01838     {    
01839       llerror (FLG_SYNTAX, cstring_makeLiteral (<font class="stringliteral">"va_dcl used outside of function declaration"</font>));
01840       e = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (id, c);
01841     }
01842 
01843   <a class="code" href="cstring_c.html#a27">cstring_free</a> (id);
01844   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (e, g_currentloc);  
01845   <a class="code" href="usymtab_c.html#a60">usymtab_supEntrySref</a> (e);
01846 }
01847 
<a name="l01848"></a><a class="code" href="clabstract_c.html#a92">01848</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="clabstract_c.html#a92">modListPointer</a> (sRef s)<font class="keyword"></font>
01849 <font class="keyword"></font>{
01850   ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (s);
01851   ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
01852   
01853   <font class="keywordflow">if</font> (ctype_isAP (rt))
01854     {
01855       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a219">context_inHeader</a> () &amp;&amp; <a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct))
01856         {
01857           voptgenerror 
01858             (FLG_ABSTRACT,
01859              message
01860              (<font class="stringliteral">"Modifies clause in header file dereferences abstract "</font>
01861               <font class="stringliteral">"type %s (interface modifies clause should not depend "</font>
01862               <font class="stringliteral">"on or expose type representation): %q"</font>,
01863               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
01864               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
01865              g_currentloc);
01866         }
01867 
01868       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (s));
01869     }
01870   <font class="keywordflow">else</font>
01871     {
01872       <font class="keywordflow">if</font> (ctype_isKnown (rt))
01873         {
01874           voptgenerror 
01875             (FLG_TYPE,
01876              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Implementation modifies clause dereferences non-pointer (type %s): %q"</font>,
01877                       ctype_unparse (rt),
01878                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
01879              g_currentloc);
01880         }
01881 
01882       <font class="keywordflow">return</font> s;
01883     }
01884 }
01885 
<a name="l01886"></a><a class="code" href="clabstract_c.html#a93">01886</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="clabstract_c.html#a93">modListFieldAccess</a> (sRef s, cstring f)<font class="keyword"></font>
01887 <font class="keyword"></font>{
01888   ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (s);
01889   ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
01890   
01891   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (rt))
01892     {
01893       uentry tf = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (rt), f);
01894       
01895       <font class="keywordflow">if</font> (uentry_isUndefined (tf))
01896         {
01897           voptgenerror (FLG_TYPE,
01898                         message (<font class="stringliteral">"Modifies list accesses non-existent "</font>
01899                                  <font class="stringliteral">"field %s of %t: %q"</font>, f, ct, 
01900                                  sRef_unparse (s)),
01901                         g_currentloc);
01902           
01903           <a class="code" href="cstring_c.html#a27">cstring_free</a> (f);
01904           <font class="keywordflow">return</font> sRef_undefined;
01905         }
01906       <font class="keywordflow">else</font> 
01907         {
01908           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct) &amp;&amp; <a class="code" href="context_c.html#a219">context_inHeader</a> ())
01909             {
01910               voptgenerror 
01911                 (FLG_ABSTRACT,
01912                  message
01913                  (<font class="stringliteral">"Modifies clause in header file accesses abstract "</font>
01914                   <font class="stringliteral">"type %s (interface modifies clause should not depend "</font>
01915                   <font class="stringliteral">"on or expose type representation): %q"</font>,
01916                   <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
01917                   <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
01918                  g_currentloc);
01919             }
01920         }
01921       
01922       <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (f);
01923       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a279">sRef_makeField</a> (s, f));
01924     }
01925   <font class="keywordflow">else</font>
01926     {
01927       voptgenerror 
01928         (FLG_TYPE,
01929          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies clause dereferences non-pointer (type %s): %q"</font>,
01930                   ctype_unparse (rt),
01931                   <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
01932          g_currentloc);
01933       
01934       <a class="code" href="cstring_c.html#a27">cstring_free</a> (f);
01935       <font class="keywordflow">return</font> s;
01936     }
01937 }
01938 
<a name="l01939"></a><a class="code" href="clabstract_c.html#a94">01939</a> sRef <a class="code" href="clabstract_c.html#a94">globListUnrecognized</a> (cstring s)<font class="keyword"></font>
01940 <font class="keyword"></font>{
01941   <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"nothing"</font>))
01942     {
01943       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a155">sRef_makeNothing</a> ();
01944     }
01945   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"internalState"</font>))
01946     {
01947       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a156">sRef_makeInternalState</a> ();
01948     }
01949   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"fileSystem"</font>)
01950            || cstring_equalLit (s, <font class="stringliteral">"systemState"</font>))
01951     {
01952       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a158">sRef_makeSystemState</a> ();
01953     }
01954   <font class="keywordflow">else</font>
01955     {
01956       voptgenerror 
01957         (FLG_UNRECOG, 
01958          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized identifier in globals list: %s"</font>, s), 
01959          g_currentloc);
01960       
01961       <font class="keywordflow">return</font> sRef_undefined;
01962     }
01963 }
01964 
<a name="l01965"></a><a class="code" href="clabstract_c.html#a95">01965</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="clabstract_c.html#a95">modListArrowAccess</a> (sRef s, cstring f)<font class="keyword"></font>
01966 <font class="keyword"></font>{
01967   ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (s);
01968   ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
01969 
01970   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (rt))
01971     {
01972       ctype b = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (rt);
01973       ctype rb = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (b);
01974 
01975       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (rb))
01976         {
01977           uentry tf = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (rb), f);
01978       
01979           <font class="keywordflow">if</font> (uentry_isUndefined (tf))
01980             {
01981               voptgenerror (FLG_TYPE,
01982                             message (<font class="stringliteral">"Modifies list arrow accesses non-existent "</font>
01983                                      <font class="stringliteral">"field %s of %t: %q"</font>, f, b, 
01984                                      sRef_unparse (s)),
01985                             g_currentloc);
01986               
01987               <a class="code" href="cstring_c.html#a27">cstring_free</a> (f);
01988               <font class="keywordflow">return</font> sRef_undefined;
01989             }
01990           <font class="keywordflow">else</font> 
01991             {
01992               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a219">context_inHeader</a> ())
01993                 {
01994                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (b))
01995                     {
01996                       voptgenerror 
01997                         (FLG_ABSTRACT,
01998                          message
01999                          (<font class="stringliteral">"Modifies clause in header file arrow accesses abstract "</font>
02000                           <font class="stringliteral">"type %s (interface modifies clause should not depend "</font>
02001                           <font class="stringliteral">"on or expose type representation): %q"</font>,
02002                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (b),
02003                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02004                          g_currentloc);
02005                     }
02006                 }
02007               <font class="keywordflow">else</font> 
02008                 {
02009                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct))
02010                     {
02011                       voptgenerror 
02012                         (FLG_ABSTRACT,
02013                          message
02014                          (<font class="stringliteral">"Modifies clause in header file arrow accesses abstract "</font>
02015                           <font class="stringliteral">"type %s (interface modifies clause should not depend "</font>
02016                           <font class="stringliteral">"on or expose type representation): %q"</font>,
02017                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
02018                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02019                          g_currentloc);
02020                     }
02021                 }
02022             }
02023 
02024           <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (f);
02025           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (s, f));
02026         }
02027       <font class="keywordflow">else</font>
02028         {
02029           voptgenerror 
02030             (FLG_TYPE,
02031              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies clause arrow accesses pointer to "</font>
02032                       <font class="stringliteral">"non-structure (type %s): %q"</font>,
02033                       ctype_unparse (rt),
02034                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02035              g_currentloc);
02036         }
02037     }
02038   <font class="keywordflow">else</font>
02039     {
02040       voptgenerror 
02041         (FLG_TYPE,
02042          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies clause arrow accesses non-pointer (type %s): %q"</font>,
02043                   ctype_unparse (rt),
02044                   <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02045          g_currentloc);
02046     }
02047 
02048   <a class="code" href="cstring_c.html#a27">cstring_free</a> (f);
02049   <font class="keywordflow">return</font> s;
02050 }
02051 
<a name="l02052"></a><a class="code" href="clabstract_c.html#a96">02052</a> sRef <a class="code" href="clabstract_c.html#a96">checkSpecClausesId</a> (uentry ue)<font class="keyword"></font>
02053 <font class="keyword"></font>{
02054   cstring s = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue);
02055 
02056   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (uentry_getSref (ue)))
02057     {
02058       voptgenerror 
02059         (FLG_SYNTAX, 
02060          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Global variable %s used special clause.  (Global variables "</font>
02061                   <font class="stringliteral">"are not recognized in special clauses.  If there is "</font>
02062                   <font class="stringliteral">"sufficient interest in support for this, it may be "</font>
02063                   <font class="stringliteral">"added to a future release.  Send mail to "</font>
02064                   <font class="stringliteral">"lclint@cs.virginia.edu.)"</font>,
02065                   s),
02066          g_currentloc);
02067       
02068       <font class="keywordflow">return</font> sRef_undefined;
02069     }
02070   <font class="keywordflow">else</font>
02071     {
02072       <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"result"</font>))
02073         {
02074           <font class="keywordflow">if</font> (optgenerror 
02075               (FLG_SYNTAX, 
02076                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Special clause list uses %s which is a variable and has special "</font>
02077                         <font class="stringliteral">"meaning in a modifies list.  (Special meaning assumed.)"</font>, s), 
02078                g_currentloc))
02079             {
02080               <a class="code" href="uentry_c.html#a244">uentry_showWhereDeclared</a> (ue);
02081             }
02082         }
02083 
02084       <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
02085     }
02086 }
02087 
02088 
<a name="l02089"></a><a class="code" href="clabstract_c.html#a97">02089</a> <font class="keywordtype">void</font> <a class="code" href="clabstract_c.html#a97">checkModifiesId</a> (uentry ue)<font class="keyword"></font>
02090 <font class="keyword"></font>{
02091   cstring s = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue);
02092 
02093   <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"nothing"</font>)
02094       || cstring_equalLit (s, <font class="stringliteral">"internalState"</font>)
02095       || cstring_equalLit (s, <font class="stringliteral">"systemState"</font>)
02096       || (cstring_equalLit (s, <font class="stringliteral">"fileSystem"</font>)))
02097     {
02098       <font class="keywordflow">if</font> (optgenerror 
02099           (FLG_SYNTAX, 
02100            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies list uses %s which is a variable and has special "</font>
02101                     <font class="stringliteral">"meaning in a modifies list.  (Special meaning assumed.)"</font>, s), 
02102            g_currentloc))
02103         {
02104           <a class="code" href="uentry_c.html#a244">uentry_showWhereDeclared</a> (ue);
02105         }
02106     }
02107 }
02108 
<a name="l02109"></a><a class="code" href="clabstract_c.html#a98">02109</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="clabstract_c.html#a98">fixModifiesId</a> (cstring s)<font class="keyword"> </font>
02110 <font class="keyword"></font>{
02111   sRef ret;
02112   cstring pname = <a class="code" href="structNames_c.html#a6">makeParam</a> (s);
02113   uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (pname);
02114 
02115   <a class="code" href="cstring_c.html#a27">cstring_free</a> (pname);
02116 
02117   <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"nothing"</font>))
02118     {
02119       ret = <a class="code" href="sRef_c.html#a155">sRef_makeNothing</a> ();
02120     }
02121   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"internalState"</font>))
02122     {
02123       ret = <a class="code" href="sRef_c.html#a156">sRef_makeInternalState</a> ();
02124     }
02125   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"fileSystem"</font>)
02126            || cstring_equalLit (s, <font class="stringliteral">"systemState"</font>))
02127     {
02128       ret = <a class="code" href="sRef_c.html#a158">sRef_makeSystemState</a> ();
02129     }
02130   <font class="keywordflow">else</font>
02131     {
02132       ret = sRef_undefined;
02133     }
02134 
02135   <font class="keywordflow">if</font> (sRef_isValid (ret))
02136     {
02137       <font class="keywordflow">if</font> (uentry_isValid (ue))
02138         {
02139           voptgenerror 
02140             (FLG_SYNTAX, 
02141              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Modifies list uses %s which is a parameter and has special "</font>
02142                       <font class="stringliteral">"meaning in a modifies list.  (Special meaning assumed.)"</font>, s), 
02143              g_currentloc);
02144         }
02145     }
02146   <font class="keywordflow">else</font>
02147     {
02148       <font class="keywordflow">if</font> (uentry_isValid (ue))
02149         {
02150           ret = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
02151         }
02152       <font class="keywordflow">else</font>
02153         {
02154           fileloc loc = <a class="code" href="fileloc_c.html#a2">fileloc_decColumn</a> (g_currentloc, cstring_length (s));
02155           ret = sRef_undefined;
02156 
02157           voptgenerror 
02158             (FLG_UNRECOG, 
02159              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized identifier in modifies comment: %s"</font>, s), 
02160              loc);
02161 
02162           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (loc);
02163         }
02164     }
02165   
02166   <font class="keywordflow">return</font> ret;
02167 }
02168 
<a name="l02169"></a><a class="code" href="clabstract_c.html#a99">02169</a> sRef <a class="code" href="clabstract_c.html#a99">fixSpecClausesId</a> (cstring s)<font class="keyword"> </font>
02170 <font class="keyword"></font>{
02171   sRef ret;
02172   cstring pname = <a class="code" href="structNames_c.html#a6">makeParam</a> (s);
02173   uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (pname);
02174 
02175   <a class="code" href="cstring_c.html#a27">cstring_free</a> (pname);
02176 
02177   <font class="keywordflow">if</font> (cstring_equalLit (s, <font class="stringliteral">"result"</font>))
02178     {
02179       ret = <a class="code" href="sRef_c.html#a159">sRef_makeResult</a> ();
02180     }
02181   <font class="keywordflow">else</font>
02182     {
02183       ret = sRef_undefined;
02184     }
02185 
02186   <font class="keywordflow">if</font> (sRef_isValid (ret))
02187     {
02188       <font class="keywordflow">if</font> (uentry_isValid (ue))
02189         {
02190           voptgenerror 
02191             (FLG_SYNTAX, 
02192              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Special clause uses %s which is a parameter and has special "</font>
02193                       <font class="stringliteral">"meaning in a special clause.  (Special meaning assumed.)"</font>, s), 
02194              g_currentloc);
02195         }
02196     }
02197   <font class="keywordflow">else</font>
02198     {
02199       <font class="keywordflow">if</font> (uentry_isValid (ue))
02200         {
02201           ret = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
02202 
02203           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (ret))
02204             {
02205               voptgenerror 
02206                 (FLG_SYNTAX, 
02207                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Global variable %s used special clause.  (Global variables "</font>
02208                           <font class="stringliteral">"are not recognized in special clauses.  If there is "</font>
02209                           <font class="stringliteral">"sufficient interest in support for this, it may be "</font>
02210                           <font class="stringliteral">"added to a future release.  Send mail to "</font>
02211                           <font class="stringliteral">"lclint@cs.virginia.edu.)"</font>,
02212                           s), 
02213                  g_currentloc);
02214               
02215               ret = sRef_undefined;
02216             }
02217         }
02218       <font class="keywordflow">else</font>
02219         {
02220           fileloc loc = <a class="code" href="fileloc_c.html#a2">fileloc_decColumn</a> (g_currentloc, cstring_length (s));
02221           ret = sRef_undefined; 
02222           
02223           voptgenerror 
02224             (FLG_UNRECOG, 
02225              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized identifier in special clause: %s"</font>, s), 
02226              loc);
02227 
02228           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (loc);
02229         }
02230     }
02231   
02232   <font class="keywordflow">return</font> ret;
02233 }
02234 
<a name="l02235"></a><a class="code" href="clabstract_c.html#a100">02235</a> sRef <a class="code" href="clabstract_c.html#a100">modListArrayFetch</a> (sRef s, <font class="comment">/*@unused@*/</font> sRef mexp)<font class="keyword"></font>
02236 <font class="keyword"></font>{
02237   ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (s);
02238   ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
02239 
02240   <font class="keywordflow">if</font> (ctype_isAP (rt))
02241     {
02242       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a219">context_inHeader</a> () &amp;&amp; <a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct))
02243         {
02244           voptgenerror 
02245             (FLG_ABSTRACT,
02246              message
02247              (<font class="stringliteral">"Modifies clause in header file indexes abstract "</font>
02248               <font class="stringliteral">"type %s (interface modifies clause should not depend "</font>
02249               <font class="stringliteral">"on or expose type representation): %q"</font>,
02250               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
02251               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02252              g_currentloc);
02253         }
02254       
02255       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a276">sRef_makeAnyArrayFetch</a> (s));
02256     }
02257   <font class="keywordflow">else</font>
02258     {
02259       voptgenerror
02260         (FLG_TYPE,
02261          message
02262          (<font class="stringliteral">"Implementation modifies clause uses array fetch on non-array (type %s): %q"</font>,
02263           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct), <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)),
02264          g_currentloc);
02265       <font class="keywordflow">return</font> s;
02266     }
02267 }
02268 
02269 
02270 
02271 
02272 
02273 
02274 
02275 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:39 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
