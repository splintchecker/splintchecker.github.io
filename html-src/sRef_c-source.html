<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>sRef.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:44 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>sRef.c</h1><a href="sRef_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** storeRef.c</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** Memory management:</font>
00028 <font class="comment">**    storeRef's are kept in allRefs for each function scope, and all are</font>
00029 <font class="comment">**    free'd at the end of the function.  This relies on the constraint that</font>
00030 <font class="comment">**    no storeRef created while checking a function is used outside that</font>
00031 <font class="comment">**    function.</font>
00032 <font class="comment">**</font>
00033 <font class="comment">**    storeRefs in the file and global scopes are free'd by the uentry.</font>
00034 <font class="comment">**</font>
00035 <font class="comment">*/</font>
00036 
00037 <font class="preprocessor"># include "lclintMacros.nf"</font>
00038 <font class="preprocessor"># include "basic.h"</font>
00039 <font class="preprocessor"># include "exprChecks.h"</font>
00040 <font class="preprocessor"># include "aliasChecks.h"</font>
00041 <font class="preprocessor"># include "sRefTable.h"</font>
00042 <font class="preprocessor"># include "structNames.h"</font>
00043 
00044 <font class="comment">/*</font>
00045 <font class="comment">** Predicate functions that evaluate both arguments in order.</font>
00046 <font class="comment">*/</font>
00047 
00048 <font class="comment">/*@notfunction@*/</font>
<a name="l00049"></a><a class="code" href="sRef_c.html#a0">00049</a> <font class="preprocessor"># define OR(a,b)  (a ? (b, TRUE) : b)</font>
00050 <font class="preprocessor"></font>
00051 <font class="comment">/*@notfunction@*/</font>
<a name="l00052"></a><a class="code" href="sRef_c.html#a1">00052</a> <font class="preprocessor"># define AND(a,b) (a ? b : (b, FALSE))</font>
00053 <font class="preprocessor"></font>
00054 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isDerived (sRef p_s) <font class="comment">/*@*/</font> ;
00055 
00056 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef sRef_fixDirectBase (sRef p_s, sRef p_base) 
00057    <font class="comment">/*@modifies p_base@*/</font> ;
00058 
00059 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isAllocatedStorage (sRef p_s) <font class="comment">/*@*/</font> ;
00060 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setNullErrorLoc (sRef p_s, fileloc) <font class="comment">/*@*/</font> ;
00061 
00062 <font class="keyword">static</font> <font class="keywordtype">void</font>
00063   sRef_aliasSetComplete (<font class="keywordtype">void</font> (p_predf) (sRef, fileloc), sRef p_s, fileloc p_loc)
00064   <font class="comment">/*@modifies p_s@*/</font> ;
00065 
00066 <font class="keyword">static</font> <font class="keywordtype">int</font> sRef_depth (sRef p_s) <font class="comment">/*@*/</font> ;
00067 
00068 <font class="keyword">static</font> <font class="keywordtype">void</font>
00069   sRef_innerAliasSetComplete (<font class="keywordtype">void</font> (p_predf) (sRef, fileloc), sRef p_s, 
00070                               fileloc p_loc)
00071   <font class="comment">/*@modifies p_s@*/</font> ;
00072 
00073 <font class="keyword">static</font> <font class="keywordtype">void</font>
00074   sRef_innerAliasSetCompleteParam (<font class="keywordtype">void</font> (p_predf) (sRef, sRef), sRef p_s, sRef p_t)
00075   <font class="comment">/*@modifies p_s@*/</font> ;
00076 
00077 <font class="keyword">static</font> <font class="keywordtype">void</font>
00078   sRef_aliasSetCompleteParam (<font class="keywordtype">void</font> (p_predf) (sRef, alkind, fileloc), sRef p_s, 
00079                               alkind p_kind, fileloc p_loc)
00080   <font class="comment">/*@modifies p_s@*/</font> ;
00081 
00082 <font class="keyword">static</font> speckind speckind_fromInt (<font class="keywordtype">int</font> p_i);
00083 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_equivalent (sRef p_s1, sRef p_s2);
00084 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isDeepUnionField (sRef p_s);
00085 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_addDeriv (<font class="comment">/*@notnull@*/</font> sRef p_s, <font class="comment">/*@notnull@*/</font> sRef p_t);
00086 <font class="keyword">static</font> sRef sRef_makeResultType (ctype p_ct) <font class="comment">/*@*/</font> ;
00087 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_checkModify (sRef p_s, sRefSet p_sl) <font class="comment">/*@*/</font> ;
00088 
00089 <font class="keyword">static</font> <font class="keywordtype">bool</font> skind_isSimple (skind sk)<font class="keyword"></font>
00090 <font class="keyword"></font>{
00091   <font class="keywordflow">switch</font> (sk)
00092     {
00093     <font class="keywordflow">case</font> SK_PARAM: <font class="keywordflow">case</font> SK_CVAR: <font class="keywordflow">case</font> SK_CONST:
00094     <font class="keywordflow">case</font> SK_OBJECT: <font class="keywordflow">case</font> SK_UNKNOWN: <font class="keywordflow">case</font> SK_NEW:
00095       <font class="keywordflow">return</font> TRUE;
00096     <font class="keywordflow">default</font>:
00097       <font class="keywordflow">return</font> FALSE;
00098     }
00099 }
00100 
00101 <font class="keyword">static</font> <font class="keywordtype">void</font> sinfo_free (<font class="comment">/*@special@*/</font> <font class="comment">/*@temp@*/</font> <font class="comment">/*@notnull@*/</font> sRef p_s)
00102    <font class="comment">/*@uses p_s-&gt;kind, p_s-&gt;info@*/</font>
00103    <font class="comment">/*@releases p_s-&gt;info@*/</font> ;
00104 
00105 <font class="keyword">static</font> <font class="comment">/*@null@*/</font> sinfo sinfo_copy (<font class="comment">/*@notnull@*/</font> sRef p_s) <font class="comment">/*@*/</font> ;
00106 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setPartsFromUentry (sRef p_s, uentry p_ue)
00107    <font class="comment">/*@modifies p_s@*/</font> ;
00108 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkDeadState (<font class="comment">/*@notnull@*/</font> sRef p_el, <font class="keywordtype">bool</font> p_tbranch, fileloc p_loc);
00109 <font class="keyword">static</font> sRef sRef_constructPointerAux (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef p_t) <font class="comment">/*@*/</font> ;
00110 
00111 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00112   sRef_combineExKinds (<font class="comment">/*@notnull@*/</font> sRef p_res, <font class="comment">/*@notnull@*/</font> sRef p_other)
00113   <font class="comment">/*@modifies p_res@*/</font> ;
00114 
00115 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00116   sRef_combineAliasKinds (<font class="comment">/*@notnull@*/</font> sRef p_res, <font class="comment">/*@notnull@*/</font> sRef p_other, 
00117                           clause p_cl, fileloc p_loc)
00118   <font class="comment">/*@modifies p_res@*/</font> ;
00119 
00120 <font class="keyword">static</font> <font class="keywordtype">void</font>
00121   sRef_combineNullState (<font class="comment">/*@notnull@*/</font> sRef p_res, <font class="comment">/*@notnull@*/</font> sRef p_other)
00122   <font class="comment">/*@modifies p_res@*/</font> ;
00123 
00124 <font class="keyword">static</font> <font class="keywordtype">void</font>
00125   sRef_combineDefState (<font class="comment">/*@notnull@*/</font> sRef p_res, <font class="comment">/*@notnull@*/</font> sRef p_other)
00126   <font class="comment">/*@modifies p_res@*/</font> ;
00127 
00128 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setStateFromAbstractUentry (sRef p_s, uentry p_ue) 
00129   <font class="comment">/*@modifies p_s@*/</font> ;
00130 
00131 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00132   sinfo_update (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef p_res, 
00133                 <font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef p_other);
00134 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo alinfo_makeRefLoc (<font class="comment">/*@exposed@*/</font> sRef p_ref, fileloc p_loc);
00135 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setDefinedAux (sRef p_s, fileloc p_loc, <font class="keywordtype">bool</font> p_clear)
00136    <font class="comment">/*@modifies p_s@*/</font> ;
00137 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setDefinedNoClear (sRef p_s, fileloc p_loc)
00138    <font class="comment">/*@modifies p_s@*/</font> ;
00139 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setStateAux (sRef p_s, sstate p_ss, fileloc p_loc)
00140    <font class="comment">/*@modifies p_s@*/</font>;
00141 
00142 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef 
00143   sRef_buildNCField (<font class="comment">/*@exposed@*/</font> sRef p_rec, <font class="comment">/*@exposed@*/</font> cstring p_f);
00144 
00145 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00146   sRef_mergeStateAux (<font class="comment">/*@notnull@*/</font> sRef p_res, <font class="comment">/*@notnull@*/</font> sRef p_other, 
00147                       clause p_cl, <font class="keywordtype">bool</font> p_opt, fileloc p_loc,
00148                       <font class="keywordtype">bool</font> p_doDerivs)
00149   <font class="comment">/*@modifies p_res, p_other@*/</font> ;
00150 
00151 <font class="keyword">static</font> <font class="comment">/*@null@*/</font> sinfo sinfo_fullCopy (<font class="comment">/*@notnull@*/</font> sRef p_s);
00152 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_doModify (sRef p_s, sRefSet p_sl) <font class="comment">/*@modifies p_s@*/</font> ;
00153 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_doModifyVal (sRef p_s, sRefSet p_sl) <font class="comment">/*@modifies p_s@*/</font>;
00154 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_checkModifyVal (sRef p_s, sRefSet p_sl) <font class="comment">/*@*/</font> ;
00155 
00156 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet
00157   sRef_mergeDerivs (<font class="comment">/*@only@*/</font> sRefSet p_res, sRefSet p_other, 
00158                     <font class="keywordtype">bool</font> p_opt, clause p_cl, fileloc p_loc);
00159 
00160 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet
00161   sRef_mergeUnionDerivs (<font class="comment">/*@only@*/</font> sRefSet p_res, 
00162                          <font class="comment">/*@exposed@*/</font> sRefSet p_other,
00163                          <font class="keywordtype">bool</font> p_opt, clause p_cl, fileloc p_loc);
00164 
00165 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet 
00166   sRef_mergePdefinedDerivs (<font class="comment">/*@only@*/</font> sRefSet p_res, sRefSet p_other, <font class="keywordtype">bool</font> p_opt,
00167                             clause p_cl, fileloc p_loc);
00168 
00169 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring sRef_unparseWithArgs (sRef p_s, uentryList p_args);
00170 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring sRef_unparseNoArgs (sRef p_s);
00171 
00172 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef sRef_findDerivedPointer (sRef p_s);
00173 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef sRef_findDerivedField (<font class="comment">/*@notnull@*/</font> sRef p_rec, cstring p_f);
00174 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
00175   sRef_getDeriv (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@returned@*/</font> sRef p_set, sRef p_guide);
00176 
00177 <font class="keyword">static</font> <font class="keywordtype">bool</font> inFunction = FALSE;
00178 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefTable allRefs;
00179 
00180 <font class="comment">/* # define DEBUGREFS  */</font>
00181 
00182 <font class="preprocessor"># ifdef DEBUGREFS</font>
00183 <font class="preprocessor"></font><font class="keyword">static</font> nsrefs = 0;
00184 <font class="keyword">static</font> totnsrefs = 0;
00185 <font class="keyword">static</font> maxnsrefs = 0;
00186 <font class="keyword">static</font> ntotrefers = 0;
00187 <font class="keyword">static</font> nrefers = 0;
00188 <font class="preprocessor"># endif</font>
00189 <font class="preprocessor"></font>
00190 <font class="comment">/*@constant null alinfo alinfo_undefined; @*/</font>
<a name="l00191"></a><a class="code" href="sRef_c.html#a2">00191</a> <font class="preprocessor"># define alinfo_undefined ((alinfo) NULL)</font>
00192 <font class="preprocessor"></font>
00193 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> alinfo alinfo_makeLoc (fileloc p_loc);
00194 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo alinfo_copy (alinfo p_a);
00195 
00196 <font class="keyword">static</font> <font class="comment">/*@checked@*/</font> <font class="keywordtype">bool</font> protectDerivs = FALSE;
00197 
<a name="l00198"></a><a class="code" href="sRef_c.html#a60">00198</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a60">sRef_protectDerivs</a> (<font class="keywordtype">void</font>) <font class="comment">/*@modifies protectDerivs@*/</font>
00199 {
00200   llassert (!protectDerivs);
00201   protectDerivs = TRUE;
00202 }
00203 
<a name="l00204"></a><a class="code" href="sRef_c.html#a61">00204</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a61">sRef_clearProtectDerivs</a> (<font class="keywordtype">void</font>) <font class="comment">/*@modifies protectDerivs@*/</font>
00205 {
00206   llassert (protectDerivs);
00207   protectDerivs = FALSE;
00208 }
00209 
00210 <font class="comment">/*</font>
00211 <font class="comment">** hmmm...here be kind of a hack.  This function mysteriously appeared</font>
00212 <font class="comment">** in my code, but I'm sure I didn't write it.</font>
00213 <font class="comment">*/</font>
00214 
00215 <font class="keywordtype">bool</font>
<a name="l00216"></a><a class="code" href="sRef_c.html#a62">00216</a> <a class="code" href="sRef_c.html#a62">sRef_isRecursiveField</a> (sRef s)<font class="keyword"></font>
00217 <font class="keyword"></font>{
00218   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (s))
00219     {
00220       <font class="keywordflow">if</font> (sRef_depth (s) &gt; 13)
00221         {
00222           sRef base;
00223           cstring fieldname;
00224           
00225           fieldname = <a class="code" href="sRef_c.html#a138">sRef_getField</a> (s);
00226           base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (s);
00227           
00228           <font class="keywordflow">while</font> (sRef_isValid (base))
00229             {
00230               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (base))
00231                 {
00232                   <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (fieldname, sRef_getField (base)))
00233                     {
00234                       <font class="keywordflow">return</font> TRUE;
00235                     }
00236                 }
00237               
00238               base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base);
00239             }
00240         }
00241     }
00242 
00243   <font class="keywordflow">return</font> FALSE;
00244 }
00245 
00246 <font class="keyword">static</font> <font class="keywordtype">void</font>
00247 sRef_addDeriv (<font class="comment">/*@notnull@*/</font> sRef s, <font class="comment">/*@notnull@*/</font> sRef t)<font class="keyword"></font>
00248 <font class="keyword"></font>{
00249   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a216">context_inProtectVars</a> () 
00250       &amp;&amp; !protectDerivs
00251       &amp;&amp; sRef_isValid (s)
00252       &amp;&amp; sRef_isValid (t)
00253       &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s))
00254     {
00255       <font class="keywordtype">int</font> sd = sRef_depth (s);
00256       <font class="keywordtype">int</font> td = sRef_depth (t);
00257       
00258       <font class="keywordflow">if</font> (sd &gt;= td)
00259         {
00260           <font class="keywordflow">return</font>;
00261         }
00262 
00263       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
00264         {
00265           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a175">context_inFunctionLike</a> () 
00266               &amp;&amp; ctype_isKnown (sRef_getType (s))
00267               &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (sRef_getType (s)))
00268             {
00269               globSet g = <a class="code" href="context_c.html#a132">context_getUsedGlobs</a> ();
00270 
00271               <font class="keywordflow">if</font> (!<a class="code" href="globSet_c.html#a5">globSet_member</a> (g, s))
00272                 {
00273                   <font class="comment">/* </font>
00274 <font class="comment">                  ** don't report as a bug </font>
00275 <font class="comment">                  ** </font>
00276 <font class="comment"></font>
00277 <font class="comment">                  llcontbug </font>
00278 <font class="comment">                        (message ("sRef_addDeriv: global variable not in used "</font>
00279 <font class="comment">                                  "globs: %q / %s / %q",</font>
00280 <font class="comment">                                  sRef_unparse (s), </font>
00281 <font class="comment">                                  ctype_unparse (sRef_getType (s)),</font>
00282 <font class="comment">                                  sRefSet_unparse (s-&gt;deriv)));</font>
00283 <font class="comment">                  */</font>
00284                 }
00285               <font class="keywordflow">else</font>
00286                 {
00287                   s-&gt;deriv = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (s-&gt;deriv, t);
00288                 }
00289             }
00290         }
00291       <font class="keywordflow">else</font>
00292         {
00293           s-&gt;deriv = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (s-&gt;deriv, t);
00294         }
00295     }
00296 }
00297 
00298 <font class="keywordtype">bool</font>
<a name="l00299"></a><a class="code" href="sRef_c.html#a63">00299</a> <a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (<font class="keywordtype">bool</font> (predf) (sRef), sRef s)
00300 {
00301   <font class="keywordflow">if</font> (sRef_isValid (s))
00302     {
00303       <font class="keywordflow">if</font> ((*predf)(s)) <font class="keywordflow">return</font> TRUE;
00304 
00305       <font class="keywordflow">switch</font>  (s-&gt;kind)
00306         {
00307         <font class="keywordflow">case</font> SK_PTR:
00308           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (predf, s-&gt;info-&gt;ref));
00309         <font class="keywordflow">case</font> SK_ARRAYFETCH:
00310           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (predf, s-&gt;info-&gt;arrayfetch-&gt;arr));
00311         <font class="keywordflow">case</font> SK_FIELD:
00312           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (predf, s-&gt;info-&gt;field-&gt;rec));
00313         <font class="keywordflow">case</font> SK_CONJ:
00314           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (predf, s-&gt;info-&gt;conj-&gt;a)
00315                   || <a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (predf, s-&gt;info-&gt;conj-&gt;b));
00316         <font class="keywordflow">default</font>:
00317           <font class="keywordflow">return</font> FALSE;
00318         }
00319     }
00320 
00321   <font class="keywordflow">return</font> FALSE;
00322 }
00323 
<a name="l00324"></a><a class="code" href="sRef_c.html#a64">00324</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a64">sRef_modInFunction</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00325 <font class="keyword"></font>{
00326   <font class="keywordflow">return</font> inFunction;
00327 }
00328 
<a name="l00329"></a><a class="code" href="sRef_c.html#a65">00329</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (sRef s, ctype ct)<font class="keyword"></font>
00330 <font class="keyword"></font>{
00331   <font class="keywordflow">if</font> (sRef_isValid (s))
00332     {
00333       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a32">ctype_isUser</a> (ct))
00334         {
00335           sRef_setStateFromUentry 
00336             (s, <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (ctype_typeId (ct)));
00337         }
00338       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct))
00339         {
00340           sRef_setStateFromAbstractUentry 
00341             (s, <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (ctype_typeId (ct)));
00342         }
00343       <font class="keywordflow">else</font>
00344         {
00345           ; <font class="comment">/* not a user type */</font>
00346         }
00347     }
00348 }
00349 
00350 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setTypeState (sRef s)<font class="keyword"></font>
00351 <font class="keyword"></font>{
00352   <font class="keywordflow">if</font> (sRef_isValid (s))
00353     {
00354       <a class="code" href="sRef_c.html#a65">sRef_setStateFromType</a> (s, s-&gt;type);
00355     }
00356 }
00357 
00358 <font class="keyword">static</font> <font class="keywordtype">void</font> alinfo_free (<font class="comment">/*@only@*/</font> alinfo a)<font class="keyword"></font>
00359 <font class="keyword"></font>{
00360   <font class="keywordflow">if</font> (a != NULL)
00361     {
00362       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (a-&gt;loc);
00363       <a class="code" href="general_c.html#a0">sfree</a> (a);
00364     }
00365 }
00366 
00367 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo alinfo_update (<font class="comment">/*@only@*/</font> alinfo old, alinfo newinfo)
00368 <font class="comment">/*</font>
00369 <font class="comment">** returns an alinfo with the same value as new.  May reuse the</font>
00370 <font class="comment">** storage of old.  (i.e., same effect as copy, but more</font>
00371 <font class="comment">** efficient.)</font>
00372 <font class="comment">*/</font>
00373 {
00374   <font class="keywordflow">if</font> (old == NULL) 
00375     {
00376       old = alinfo_copy (newinfo);
00377     }
00378   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (newinfo == NULL)
00379     {
00380       alinfo_free (old);
00381       <font class="keywordflow">return</font> NULL;
00382     }
00383   <font class="keywordflow">else</font>
00384     {
00385       old-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;loc, newinfo-&gt;loc);
00386       old-&gt;ref = newinfo-&gt;ref;
00387       old-&gt;ue = newinfo-&gt;ue;
00388     }
00389 
00390   <font class="keywordflow">return</font> old;
00391 }
00392 
00393 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo alinfo_updateLoc (<font class="comment">/*@only@*/</font> alinfo old, fileloc loc)<font class="keyword"></font>
00394 <font class="keyword"></font>{
00395   <font class="keywordflow">if</font> (old == NULL) 
00396     {
00397       old = alinfo_makeLoc (loc);
00398     }
00399   <font class="keywordflow">else</font>
00400     {
00401       old-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;loc, loc);
00402       old-&gt;ue = uentry_undefined;
00403       old-&gt;ref = sRef_undefined;
00404     }
00405 
00406   <font class="keywordflow">return</font> old;
00407 }
00408 
00409 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo 
00410   alinfo_updateRefLoc (<font class="comment">/*@only@*/</font> alinfo old, <font class="comment">/*@dependent@*/</font> sRef ref, fileloc loc)<font class="keyword"></font>
00411 <font class="keyword"></font>{
00412   <font class="keywordflow">if</font> (old == NULL) 
00413     {
00414       old = alinfo_makeRefLoc (ref, loc);
00415     }
00416   <font class="keywordflow">else</font>
00417     {
00418       old-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (old-&gt;loc, loc);
00419       old-&gt;ue = uentry_undefined;
00420       old-&gt;ref = ref;
00421     }
00422 
00423   <font class="keywordflow">return</font> old;
00424 }
00425 
00426 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo
00427 alinfo_copy (alinfo a)<font class="keyword"></font>
00428 <font class="keyword"></font>{
00429   <font class="keywordflow">if</font> (a == NULL)
00430     {
00431       <font class="keywordflow">return</font> NULL;
00432     }
00433   <font class="keywordflow">else</font>
00434     {
00435       alinfo ret = (alinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
00436       
00437       ret-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (a-&gt;loc); <font class="comment">/*&lt; should report bug without copy! &gt;*/</font>
00438       ret-&gt;ue = a-&gt;ue;
00439       ret-&gt;ref = a-&gt;ref;
00440 
00441       <font class="keywordflow">return</font> ret;
00442     }
00443 }
00444 
00445 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00446   sRef_hasAliasInfoLoc (sRef s)<font class="keyword"></font>
00447 <font class="keyword"></font>{
00448   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliasinfo != NULL)
00449           &amp;&amp; (fileloc_isDefined (s-&gt;aliasinfo-&gt;loc)));
00450 }
00451 
00452 <font class="keyword">static</font> <font class="comment">/*@falsenull@*/</font> <font class="keywordtype">bool</font>
00453 sRef_hasStateInfoLoc (sRef s)<font class="keyword"></font>
00454 <font class="keyword"></font>{
00455   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;definfo != NULL) 
00456           &amp;&amp; (fileloc_isDefined (s-&gt;definfo-&gt;loc)));
00457 }
00458 
00459 <font class="keyword">static</font> <font class="comment">/*@falsenull@*/</font> <font class="keywordtype">bool</font>
00460 sRef_hasExpInfoLoc (sRef s)<font class="keyword"></font>
00461 <font class="keyword"></font>{
00462   <font class="keywordflow">return</font> (sRef_isValid (s) 
00463           &amp;&amp; (s-&gt;expinfo != NULL) &amp;&amp; (fileloc_isDefined (s-&gt;expinfo-&gt;loc)));
00464 }
00465 
00466 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00467 sRef_hasNullInfoLoc (sRef s)<font class="keyword"></font>
00468 <font class="keyword"></font>{
00469   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;nullinfo != NULL) 
00470           &amp;&amp; (fileloc_isDefined (s-&gt;nullinfo-&gt;loc)));
00471 }
00472 
00473 <font class="keywordtype">bool</font>
<a name="l00474"></a><a class="code" href="sRef_c.html#a75">00474</a> <a class="code" href="sRef_c.html#a75">sRef_hasAliasInfoRef</a> (sRef s)<font class="keyword"></font>
00475 <font class="keyword"></font>{
00476   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliasinfo != NULL) 
00477           &amp;&amp; (sRef_isValid (s-&gt;aliasinfo-&gt;ref)));
00478 }
00479 
00480 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> fileloc
00481 sRef_getAliasInfoLoc (<font class="comment">/*@exposed@*/</font> sRef s)<font class="keyword"></font>
00482 <font class="keyword"></font>{
00483   llassert (sRef_isValid (s) &amp;&amp; s-&gt;aliasinfo != NULL
00484             &amp;&amp; (fileloc_isDefined (s-&gt;aliasinfo-&gt;loc)));
00485   <font class="keywordflow">return</font> (s-&gt;aliasinfo-&gt;loc);
00486 }
00487 
00488 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> fileloc
00489 sRef_getStateInfoLoc (<font class="comment">/*@exposed@*/</font> sRef s)<font class="keyword"></font>
00490 <font class="keyword"></font>{
00491   llassert (sRef_isValid (s) &amp;&amp; s-&gt;definfo != NULL 
00492             &amp;&amp; (fileloc_isDefined (s-&gt;definfo-&gt;loc)));
00493   <font class="keywordflow">return</font> (s-&gt;definfo-&gt;loc);
00494 }
00495 
00496 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> fileloc
00497 sRef_getExpInfoLoc (<font class="comment">/*@exposed@*/</font> sRef s)<font class="keyword"></font>
00498 <font class="keyword"></font>{
00499   llassert (sRef_isValid (s) &amp;&amp; s-&gt;expinfo != NULL 
00500             &amp;&amp; (fileloc_isDefined (s-&gt;expinfo-&gt;loc)));
00501   <font class="keywordflow">return</font> (s-&gt;expinfo-&gt;loc);
00502 }
00503 
00504 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> fileloc
00505 sRef_getNullInfoLoc (<font class="comment">/*@exposed@*/</font> sRef s)<font class="keyword"></font>
00506 <font class="keyword"></font>{
00507   llassert (sRef_isValid (s) &amp;&amp; s-&gt;nullinfo != NULL 
00508             &amp;&amp; (fileloc_isDefined (s-&gt;nullinfo-&gt;loc)));
00509   <font class="keywordflow">return</font> (s-&gt;nullinfo-&gt;loc);
00510 }
00511 
00512 <font class="comment">/*@observer@*/</font> sRef
<a name="l00513"></a><a class="code" href="sRef_c.html#a80">00513</a>   <a class="code" href="sRef_c.html#a80">sRef_getAliasInfoRef</a> (<font class="comment">/*@exposed@*/</font> sRef s)<font class="keyword"></font>
00514 <font class="keyword"></font>{
00515   llassert (sRef_isValid (s) &amp;&amp; s-&gt;aliasinfo != NULL);
00516   <font class="keywordflow">return</font> (s-&gt;aliasinfo-&gt;ref);
00517 }
00518 
00519 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> alinfo
00520 alinfo_makeLoc (fileloc loc)<font class="keyword"></font>
00521 <font class="keyword"></font>{
00522   alinfo ret = (alinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
00523 
00524   ret-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (loc); <font class="comment">/* don't need to copy! */</font>
00525   ret-&gt;ue = uentry_undefined;
00526   ret-&gt;ref = sRef_undefined;
00527   
00528   <font class="keywordflow">return</font> ret;
00529 }
00530 
00531 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> alinfo
00532 alinfo_makeRefLoc (<font class="comment">/*@exposed@*/</font> sRef ref, fileloc loc)<font class="keyword"></font>
00533 <font class="keyword"></font>{
00534   alinfo ret = (alinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
00535 
00536   ret-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (loc);
00537   ret-&gt;ref = ref;
00538   ret-&gt;ue  = uentry_undefined;
00539   
00540   <font class="keywordflow">return</font> ret;
00541 }
00542 
00543 <font class="comment">/*</font>
00544 <font class="comment">** This function should be called before new sRefs are created</font>
00545 <font class="comment">** somewhere where they will have a lifetime greater than the</font>
00546 <font class="comment">** current function scope.</font>
00547 <font class="comment">*/</font>
00548 
<a name="l00549"></a><a class="code" href="sRef_c.html#a81">00549</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a81">sRef_setGlobalScope</a> ()<font class="keyword"></font>
00550 <font class="keyword"></font>{
00551   llassert (inFunction);
00552   inFunction = FALSE;
00553 }
00554 
<a name="l00555"></a><a class="code" href="sRef_c.html#a82">00555</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a82">sRef_clearGlobalScope</a> ()<font class="keyword"></font>
00556 <font class="keyword"></font>{
00557   llassert (!inFunction);
00558   inFunction = TRUE;
00559 }
00560 
00561 <font class="keyword">static</font> <font class="keywordtype">bool</font> oldInFunction = FALSE;
00562 
<a name="l00563"></a><a class="code" href="sRef_c.html#a83">00563</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a83">sRef_setGlobalScopeSafe</a> ()<font class="keyword"></font>
00564 <font class="keyword"></font>{
00565     oldInFunction = inFunction;
00566   inFunction = FALSE;
00567 }
00568 
<a name="l00569"></a><a class="code" href="sRef_c.html#a84">00569</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a84">sRef_clearGlobalScopeSafe</a> ()<font class="keyword"></font>
00570 <font class="keyword"></font>{
00571     inFunction = oldInFunction;
00572 }
00573 
<a name="l00574"></a><a class="code" href="sRef_c.html#a85">00574</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a85">sRef_enterFunctionScope</a> ()<font class="keyword"></font>
00575 <font class="keyword"></font>{
00576   llassert (!inFunction);
00577   llassert (sRefTable_isEmpty (allRefs));
00578   inFunction = TRUE;
00579 }
00580 
<a name="l00581"></a><a class="code" href="sRef_c.html#a86">00581</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a86">sRef_exitFunctionScope</a> ()<font class="keyword"></font>
00582 <font class="keyword"></font>{
00583   
00584   <font class="keywordflow">if</font> (inFunction)
00585     {
00586       <a class="code" href="sRefTable_c.html#a3">sRefTable_clear</a> (allRefs);
00587       inFunction = FALSE;
00588     }
00589   <font class="keywordflow">else</font>
00590     {
00591       llbuglit (<font class="stringliteral">"sRef_exitFunctionScope: not in function"</font>);
00592     }
00593 }
00594   
<a name="l00595"></a><a class="code" href="sRef_c.html#a87">00595</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a87">sRef_destroyMod</a> () <font class="comment">/*@globals killed allRefs;@*/</font>
00596 {
00597 <font class="preprocessor"># ifdef DEBUGREFS  </font>
00598 <font class="preprocessor"></font>  <a class="code" href="llerror_c.html#a21">llmsg</a> (message (<font class="stringliteral">"Live: %d / %d "</font>, nsrefs, totnsrefs));  
00599 <font class="preprocessor"># endif</font>
00600 <font class="preprocessor"></font>
00601   <a class="code" href="sRefTable_c.html#a6">sRefTable_free</a> (allRefs);
00602 }
00603 
00604 <font class="comment">/*</font>
00605 <font class="comment">** Result of sRef_alloc is dependent since allRefs may</font>
00606 <font class="comment">** reference it.  It is only if !inFunction.</font>
00607 <font class="comment">*/</font>
00608 
00609 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@out@*/</font> <font class="comment">/*@notnull@*/</font> sRef
00610 sRef_alloc (<font class="keywordtype">void</font>)<font class="keyword"></font>
00611 <font class="keyword"></font>{
00612   sRef s = (sRef) dmalloc (<font class="keyword">sizeof</font> (*s));
00613 
00614   <font class="keywordflow">if</font> (inFunction)
00615     {
00616       allRefs = <a class="code" href="sRefTable_c.html#a2">sRefTable_add</a> (allRefs, s);
00617       <font class="comment">/*@-branchstate@*/</font> 
00618     } 
00619   <font class="comment">/*@=branchstate@*/</font>
00620 
00621 <font class="preprocessor"># ifdef DEBUGREFS</font>
00622 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (nsrefs &gt;= maxnsrefs)
00623     {
00624       maxnsrefs = nsrefs;
00625     }
00626 
00627   totnsrefs++;
00628   nsrefs++;
00629 <font class="preprocessor"># endif</font>
00630 <font class="preprocessor"></font>
00631   <font class="comment">/*@-mustfree@*/</font> <font class="comment">/*@-freshtrans@*/</font>
00632   <font class="keywordflow">return</font> s;
00633   <font class="comment">/*@=mustfree@*/</font> <font class="comment">/*@=freshtrans@*/</font>
00634 }
00635 
00636 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> sRef
00637   sRef_new (<font class="keywordtype">void</font>)
00638   <font class="comment">/*@defines result@*/</font>
00639   <font class="comment">/*@post:isnull result-&gt;aliasinfo, result-&gt;definfo, result-&gt;nullinfo, </font>
00640 <font class="comment">                 result-&gt;expinfo, result-&gt;info, result-&gt;deriv@*/</font>
00641 {
00642   sRef s = sRef_alloc ();
00643 
00644   s-&gt;kind = SK_UNKNOWN;
00645   s-&gt;safe = TRUE;
00646   s-&gt;modified = FALSE;
00647   s-&gt;type = ctype_unknown;
00648   s-&gt;defstate = SS_UNKNOWN;
00649 
00650   s-&gt;aliaskind = AK_UNKNOWN;
00651   s-&gt;oaliaskind = AK_UNKNOWN;
00652 
00653   s-&gt;nullstate = NS_UNKNOWN;
00654 
00655   s-&gt;expkind = XO_UNKNOWN;
00656   s-&gt;oexpkind = XO_UNKNOWN;
00657 
00658   s-&gt;aliasinfo = alinfo_undefined;
00659   s-&gt;definfo = alinfo_undefined;
00660   s-&gt;nullinfo = alinfo_undefined;
00661   s-&gt;expinfo = alinfo_undefined;
00662 
00663   s-&gt;info = NULL;
00664   s-&gt;deriv = sRefSet_undefined;
00665 
00666   <font class="keywordflow">return</font> s;
00667 }
00668 
00669 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef
00670 sRef_fixConj (<font class="comment">/*@notnull@*/</font> sRef s)<font class="keyword"></font>
00671 <font class="keyword"></font>{
00672   <font class="keywordflow">if</font> (sRef_isConj (s))
00673     {
00674       <font class="keywordflow">do</font> {
00675         s = <a class="code" href="sRef_c.html#a326">sRef_getConjA</a> (s);
00676       } <font class="keywordflow">while</font> (sRef_isConj (s));
00677       
00678       llassert (sRef_isValid (s));
00679       <font class="keywordflow">return</font> s; <font class="comment">/* don't need to ref */</font>
00680     }
00681   <font class="keywordflow">else</font>
00682     {
00683       <font class="keywordflow">return</font> s;
00684     }
00685 }
00686 
00687 <font class="keyword">static</font> <font class="keywordtype">bool</font> 
00688 sRef_isExternallyVisibleAux (sRef s)<font class="keyword"></font>
00689 <font class="keyword"></font>{
00690   <font class="keywordtype">bool</font> res = FALSE;
00691   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
00692 
00693   <font class="keywordflow">if</font> (sRef_isValid (base))
00694     {
00695       res = <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (base) || <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (base) || <a class="code" href="sRef_c.html#a242">sRef_isExternal</a> (base);
00696     }
00697 
00698   <font class="keywordflow">return</font> res;
00699 }
00700 
00701 <font class="keywordtype">bool</font> 
<a name="l00702"></a><a class="code" href="sRef_c.html#a92">00702</a>   <a class="code" href="sRef_c.html#a92">sRef_isExternallyVisible</a> (sRef s)<font class="keyword"></font>
00703 <font class="keyword"></font>{
00704   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRef_isExternallyVisibleAux, s));
00705 }
00706 
00707 <font class="comment">/*@exposed@*/</font> uentry
<a name="l00708"></a><a class="code" href="sRef_c.html#a93">00708</a> <a class="code" href="sRef_c.html#a93">sRef_getBaseUentry</a> (sRef s)<font class="keyword"></font>
00709 <font class="keyword"></font>{
00710   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
00711   uentry res = uentry_undefined;
00712   
00713   <font class="keywordflow">if</font> (sRef_isValid (base))
00714     {
00715       <font class="keywordflow">switch</font> (base-&gt;kind)
00716         {
00717         <font class="keywordflow">case</font> SK_PARAM:
00718           res = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (paramsScope, base-&gt;info-&gt;paramno);
00719           <font class="keywordflow">break</font>;
00720 
00721         <font class="keywordflow">case</font> SK_CVAR:
00722           res = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (base-&gt;info-&gt;cvar-&gt;lexlevel, 
00723                                      base-&gt;info-&gt;cvar-&gt;index);
00724           <font class="keywordflow">break</font>;
00725 
00726         <font class="keywordflow">default</font>:
00727           <font class="keywordflow">break</font>;
00728         }  
00729     }
00730 
00731   <font class="keywordflow">return</font> res;
00732 }
00733 
00734 <font class="comment">/*</font>
00735 <font class="comment">** lookup the current uentry corresponding to s, and return the corresponding sRef.</font>
00736 <font class="comment">** yuk yuk yuk yuk yuk yuk yuk yuk</font>
00737 <font class="comment">*/</font>
00738 
00739 <font class="comment">/*@exposed@*/</font> sRef
<a name="l00740"></a><a class="code" href="sRef_c.html#a94">00740</a> <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (sRef s)<font class="keyword"></font>
00741 <font class="keyword"></font>{
00742   sRef inner;
00743   sRef ret;
00744   sRef res;
00745 
00746   <font class="keywordflow">if</font> (!sRef_isValid (s)) <font class="keywordflow">return</font> sRef_undefined;
00747 
00748   
00749   <font class="keywordflow">switch</font> (s-&gt;kind)
00750     {
00751     <font class="keywordflow">case</font> SK_UNKNOWN:
00752     <font class="keywordflow">case</font> SK_OBJECT:
00753     <font class="keywordflow">case</font> SK_NEW:
00754     <font class="keywordflow">case</font> SK_TYPE:
00755     <font class="keywordflow">case</font> SK_EXTERNAL:
00756     <font class="keywordflow">case</font> SK_DERIVED:
00757     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
00758     <font class="keywordflow">case</font> SK_CONST:
00759     <font class="keywordflow">case</font> SK_SPECIAL:
00760     <font class="keywordflow">case</font> SK_RESULT:
00761       <font class="keywordflow">return</font> s; 
00762     <font class="keywordflow">case</font> SK_PARAM:
00763     <font class="keywordflow">case</font> SK_CVAR:
00764       {
00765         uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s);
00766 
00767         <font class="comment">/* must be raw name!  (need the marker) */</font>
00768         ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (uentry_rawName (ue));
00769         
00770         <font class="keywordflow">if</font> (uentry_isUndefined (ue))
00771           {
00772                     <font class="keywordflow">return</font> s;
00773           }
00774         <font class="keywordflow">else</font>
00775           {
00776                     <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue));
00777           }
00778       }
00779     <font class="keywordflow">case</font> SK_ARRAYFETCH:
00780       <font class="comment">/* special case if ind known */</font>
00781       inner = s-&gt;info-&gt;arrayfetch-&gt;arr;
00782       ret = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (inner);
00783 
00784       <font class="keywordflow">if</font> (ret == inner) 
00785         {
00786           res = s; 
00787         }
00788       <font class="keywordflow">else</font> 
00789         {
00790           res = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (ret);
00791         }
00792 
00793       <font class="keywordflow">return</font> res;
00794 
00795     <font class="keywordflow">case</font> SK_FIELD:
00796       inner = s-&gt;info-&gt;field-&gt;rec;
00797       ret = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (inner);
00798 
00799       <font class="keywordflow">if</font> (ret == inner) 
00800         {
00801           res = s; 
00802         }
00803       <font class="keywordflow">else</font> 
00804         {
00805           res = (<a class="code" href="sRef_c.html#a279">sRef_makeField</a> (ret, s-&gt;info-&gt;field-&gt;field));
00806         }
00807 
00808       <font class="keywordflow">return</font> (res);
00809     <font class="keywordflow">case</font> SK_PTR:
00810       inner = s-&gt;info-&gt;ref;
00811       ret = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (inner);
00812       <font class="keywordflow">if</font> (ret == inner) 
00813         {
00814           res = s; 
00815         }
00816       <font class="keywordflow">else</font>
00817         {
00818           res = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (ret);
00819         }
00820 
00821       <font class="keywordflow">return</font> (res);
00822 
00823     <font class="keywordflow">case</font> SK_ADR:
00824       inner = s-&gt;info-&gt;ref;
00825       ret = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (inner);
00826 
00827       <font class="keywordflow">if</font> (ret == inner)
00828         {
00829           res = s; 
00830         }
00831       <font class="keywordflow">else</font> 
00832         {
00833           res = <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (ret);
00834         }
00835 
00836       <font class="keywordflow">return</font> (res);
00837 
00838     <font class="keywordflow">case</font> SK_CONJ:
00839       {
00840         sRef innera = s-&gt;info-&gt;conj-&gt;a;
00841         sRef innerb = s-&gt;info-&gt;conj-&gt;b;
00842         sRef reta = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (innera);
00843         sRef retb = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (innerb);
00844 
00845         <font class="keywordflow">if</font> (innera == reta &amp;&amp; innerb == retb)
00846           {
00847             res = s;
00848           }
00849         <font class="keywordflow">else</font> 
00850           {
00851             res = <a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (reta, retb);
00852           }
00853 
00854         <font class="keywordflow">return</font> (res);
00855       }
00856     }
00857   
00858   BADEXIT;
00859 }
00860 
00861 uentry
<a name="l00862"></a><a class="code" href="sRef_c.html#a95">00862</a> <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (sRef s)<font class="keyword"></font>
00863 <font class="keyword"></font>{
00864   llassert (sRef_isValid (s));
00865 
00866   <font class="keywordflow">switch</font> (s-&gt;kind)
00867     {
00868     <font class="keywordflow">case</font> SK_PARAM:
00869       <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (paramsScope, s-&gt;info-&gt;paramno));
00870     <font class="keywordflow">case</font> SK_CVAR:
00871       <font class="keywordflow">return</font> (<a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s-&gt;info-&gt;cvar-&gt;lexlevel, s-&gt;info-&gt;cvar-&gt;index));
00872     <font class="keywordflow">case</font> SK_CONJ:
00873       {
00874         <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s-&gt;info-&gt;conj-&gt;a) || <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (s-&gt;info-&gt;conj-&gt;a)
00875             || sRef_isConj (s-&gt;info-&gt;conj-&gt;a))
00876           {
00877             <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s-&gt;info-&gt;conj-&gt;a);
00878           }
00879         <font class="keywordflow">else</font> 
00880           {
00881             <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s-&gt;info-&gt;conj-&gt;b);
00882           }
00883       }
00884     <font class="keywordflow">case</font> SK_UNKNOWN:
00885     <font class="keywordflow">case</font> SK_SPECIAL:
00886       <font class="keywordflow">return</font> uentry_undefined;
00887     BADDEFAULT;
00888     }
00889 }
00890 
00891 <font class="keywordtype">int</font>
<a name="l00892"></a><a class="code" href="sRef_c.html#a96">00892</a> <a class="code" href="sRef_c.html#a96">sRef_getParam</a> (sRef s)<font class="keyword"></font>
00893 <font class="keyword"></font>{
00894   llassert (sRef_isValid (s));
00895   llassert (s-&gt;kind == SK_PARAM);
00896 
00897   <font class="keywordflow">return</font> s-&gt;info-&gt;paramno;
00898 }
00899 
00900 <font class="keywordtype">bool</font>
<a name="l00901"></a><a class="code" href="sRef_c.html#a97">00901</a> <a class="code" href="sRef_c.html#a97">sRef_isModified</a> (sRef s)<font class="keyword"></font>
00902 <font class="keyword"></font>{
00903     <font class="keywordflow">return</font> (!sRef_isValid (s) || s-&gt;modified);
00904 }
00905 
<a name="l00906"></a><a class="code" href="sRef_c.html#a98">00906</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a98">sRef_setModified</a> (sRef s)<font class="keyword"></font>
00907 <font class="keyword"></font>{
00908   <font class="keywordflow">if</font> (sRef_isValid (s))
00909     {
00910       s-&gt;modified = TRUE;
00911 
00912       
00913       <font class="keywordflow">if</font> (sRef_isRefsField (s))
00914         {
00915           sRef base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (s);
00916 
00917           
00918           llassert (s-&gt;kind == SK_FIELD);
00919 
00920           
00921           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (base))
00922             {
00923               base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (base);
00924                     }
00925 
00926           <font class="keywordflow">if</font> (sRef_isRefCounted (base))
00927             {
00928               base-&gt;aliaskind = AK_NEWREF;
00929                     }
00930         }
00931 
00932           }
00933 }
00934 
00935 <font class="comment">/*</font>
00936 <font class="comment">** note: this side-effects sRefSet to set modified to TRUE</font>
00937 <font class="comment">** for any sRef similar to s.</font>
00938 <font class="comment">*/</font>
00939 
00940 <font class="keywordtype">bool</font>
<a name="l00941"></a><a class="code" href="sRef_c.html#a99">00941</a> <a class="code" href="sRef_c.html#a99">sRef_canModifyVal</a> (sRef s, sRefSet sl)<font class="keyword"></font>
00942 <font class="keyword"></font>{
00943   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTMOD))
00944     {
00945       <font class="keywordflow">return</font> (sRef_doModifyVal (s, sl));
00946     }
00947   <font class="keywordflow">else</font>
00948     {
00949       <font class="keywordflow">return</font> (sRef_checkModifyVal (s, sl));
00950     }
00951 }
00952 
00953 <font class="keywordtype">bool</font>
<a name="l00954"></a><a class="code" href="sRef_c.html#a100">00954</a> <a class="code" href="sRef_c.html#a100">sRef_canModify</a> (sRef s, sRefSet sl)<font class="keyword"></font>
00955 <font class="keyword"></font>{
00956   
00957   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTMOD))
00958     {
00959       <font class="keywordflow">return</font> (sRef_doModify (s, sl));
00960     }
00961   <font class="keywordflow">else</font>
00962     {
00963       <font class="keywordflow">return</font> (sRef_checkModify (s, sl));
00964     }
00965 }
00966 
00967 <font class="comment">/*</font>
00968 <font class="comment">** No side-effects</font>
00969 <font class="comment">*/</font>
00970 
00971 <font class="keyword">static</font>
00972 <font class="keywordtype">bool</font> sRef_checkModifyVal (sRef s, sRefSet sl)<font class="keyword"></font>
00973 <font class="keyword"></font>{
00974   <font class="keywordflow">if</font> (sRef_isInvalid (s))
00975     {
00976       <font class="keywordflow">return</font> TRUE;
00977     }
00978   
00979   <font class="keywordflow">switch</font> (s-&gt;kind)
00980     {
00981     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
00982     <font class="keywordflow">case</font> SK_CONST:
00983       <font class="keywordflow">return</font> TRUE;
00984     <font class="keywordflow">case</font> SK_CVAR:
00985       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
00986         {
00987           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a108">context_checkGlobMod</a> (s))
00988             {
00989               <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
00990             }
00991 
00992           <font class="keywordflow">return</font> TRUE;
00993         }
00994       <font class="keywordflow">else</font>
00995         {
00996           <font class="keywordflow">return</font> TRUE;
00997         }
00998     <font class="keywordflow">case</font> SK_PARAM:
00999             <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) 
01000               || alkind_isOnly (sRef_getOrigAliasKind (s)));
01001     <font class="keywordflow">case</font> SK_ARRAYFETCH: 
01002       <font class="comment">/* special case if ind known */</font>
01003       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) ||
01004               sRef_checkModifyVal (s-&gt;info-&gt;arrayfetch-&gt;arr, sl));
01005     <font class="keywordflow">case</font> SK_FIELD:
01006       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) || sRef_checkModifyVal (s-&gt;info-&gt;field-&gt;rec, sl));
01007     <font class="keywordflow">case</font> SK_PTR:
01008       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) || sRef_checkModifyVal (s-&gt;info-&gt;ref, sl));
01009     <font class="keywordflow">case</font> SK_ADR:
01010       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) || sRef_checkModifyVal (s-&gt;info-&gt;ref, sl));
01011     <font class="keywordflow">case</font> SK_CONJ:
01012       <font class="keywordflow">return</font> ((sRef_checkModifyVal (s-&gt;info-&gt;conj-&gt;a, sl)) &amp;&amp;
01013               (sRef_checkModifyVal (s-&gt;info-&gt;conj-&gt;b, sl)));
01014     <font class="keywordflow">case</font> SK_UNKNOWN:
01015     <font class="keywordflow">case</font> SK_OBJECT:
01016     <font class="keywordflow">case</font> SK_NEW:
01017     <font class="keywordflow">case</font> SK_TYPE:
01018     <font class="keywordflow">case</font> SK_DERIVED:
01019       <font class="keywordflow">return</font> TRUE;
01020     <font class="keywordflow">case</font> SK_EXTERNAL:
01021       <font class="keywordflow">return</font> TRUE;
01022     <font class="keywordflow">case</font> SK_SPECIAL:
01023       {
01024         <font class="keywordflow">switch</font> (s-&gt;info-&gt;spec)
01025           {
01026           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> TRUE;
01027           <font class="keywordflow">case</font> SR_INTERNAL:  
01028             <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INTERNALGLOBS))
01029               {
01030                 <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
01031               }
01032             <font class="keywordflow">else</font>
01033               {
01034                 <font class="keywordflow">return</font> TRUE;
01035               }
01036           <font class="keywordflow">case</font> SR_SPECSTATE: <font class="keywordflow">return</font> TRUE;
01037           <font class="keywordflow">case</font> SR_SYSTEM:    <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
01038           }
01039       }
01040     <font class="keywordflow">case</font> SK_RESULT: BADBRANCH;
01041     }
01042   BADEXIT;
01043 }
01044 
01045 <font class="comment">/*</font>
01046 <font class="comment">** this should probably be elsewhere...</font>
01047 <font class="comment">**</font>
01048 <font class="comment">** returns TRUE iff sl indicates that s can be modified</font>
01049 <font class="comment">*/</font>
01050 
01051 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_checkModify (sRef s, sRefSet sl)<font class="keyword"></font>
01052 <font class="keyword"></font>{
01053   llassert (sRef_isValid (s));
01054 
01055   <font class="keywordflow">switch</font> (s-&gt;kind)
01056     {
01057     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01058     <font class="keywordflow">case</font> SK_CONST:
01059       <font class="keywordflow">return</font> TRUE;
01060     <font class="keywordflow">case</font> SK_CVAR:
01061       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
01062         {
01063           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a108">context_checkGlobMod</a> (s))
01064             {
01065               <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
01066             }
01067 
01068           <font class="keywordflow">return</font> TRUE;
01069         }
01070       <font class="keywordflow">else</font>
01071         {
01072           <font class="keywordflow">return</font> TRUE;
01073         }
01074     <font class="keywordflow">case</font> SK_PARAM:
01075       <font class="keywordflow">return</font> TRUE;
01076     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01077       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) ||
01078               sRef_checkModifyVal (s-&gt;info-&gt;arrayfetch-&gt;arr, sl));
01079     <font class="keywordflow">case</font> SK_FIELD:
01080       {
01081         sRef sr = s-&gt;info-&gt;field-&gt;rec;
01082 
01083         <font class="keywordflow">if</font> (sr-&gt;kind == SK_PARAM)
01084           <font class="keywordflow">return</font> TRUE; <font class="comment">/* structs are copied on call */</font>
01085 
01086         <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) || sRef_checkModifyVal (s-&gt;info-&gt;field-&gt;rec, sl));
01087       }
01088     <font class="keywordflow">case</font> SK_PTR:
01089       {
01090         <font class="keywordtype">bool</font> sm;
01091 
01092         sm = <a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s);
01093 
01094         <font class="keywordflow">if</font> (sm)
01095           <font class="keywordflow">return</font> TRUE;
01096         <font class="keywordflow">else</font>
01097           <font class="keywordflow">return</font> (sRef_checkModifyVal (s-&gt;info-&gt;ref, sl));
01098       }
01099     <font class="keywordflow">case</font> SK_ADR:
01100       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s) || sRef_checkModifyVal (s-&gt;info-&gt;ref, sl));
01101     <font class="keywordflow">case</font> SK_CONJ:
01102       <font class="keywordflow">return</font> ((sRef_checkModify (s-&gt;info-&gt;conj-&gt;a, sl)) &amp;&amp;
01103               (sRef_checkModify (s-&gt;info-&gt;conj-&gt;b, sl)));
01104     <font class="keywordflow">case</font> SK_NEW:
01105     <font class="keywordflow">case</font> SK_OBJECT:
01106     <font class="keywordflow">case</font> SK_UNKNOWN:
01107     <font class="keywordflow">case</font> SK_TYPE:
01108     <font class="keywordflow">case</font> SK_DERIVED:
01109     <font class="keywordflow">case</font> SK_EXTERNAL:
01110       <font class="keywordflow">return</font> TRUE;
01111     <font class="keywordflow">case</font> SK_SPECIAL:
01112       {
01113         <font class="keywordflow">switch</font> (s-&gt;info-&gt;spec)
01114           {
01115           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> TRUE;
01116           <font class="keywordflow">case</font> SR_INTERNAL:  
01117             <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INTERNALGLOBS))
01118               {
01119                 <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
01120               }
01121             <font class="keywordflow">else</font>
01122               {
01123                 <font class="keywordflow">return</font> TRUE;
01124               }
01125           <font class="keywordflow">case</font> SR_SPECSTATE: <font class="keywordflow">return</font> TRUE;
01126           <font class="keywordflow">case</font> SR_SYSTEM:    <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sl, s));
01127           }
01128       }
01129     <font class="keywordflow">case</font> SK_RESULT: BADBRANCH;
01130     }
01131   BADEXIT;
01132 }
01133 
<a name="l01134"></a><a class="code" href="sRef_c.html#a101">01134</a> cstring <a class="code" href="sRef_c.html#a101">sRef_stateVerb</a> (sRef s)<font class="keyword"></font>
01135 <font class="keyword"></font>{
01136   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (s))
01137     {
01138       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"released"</font>);
01139     }
01140   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isKept (s))
01141     {
01142       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"kept"</font>);
01143     }
01144   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (s))
01145     {
01146       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"dependent"</font>);
01147     }
01148   <font class="keywordflow">else</font>
01149     {
01150       BADEXIT;
01151     }
01152 }
01153 
<a name="l01154"></a><a class="code" href="sRef_c.html#a102">01154</a> cstring <a class="code" href="sRef_c.html#a102">sRef_stateAltVerb</a> (sRef s)<font class="keyword"></font>
01155 <font class="keyword"></font>{
01156   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (s))
01157     {
01158       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"live"</font>);
01159     }
01160   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isKept (s))
01161     {
01162       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"not kept"</font>);
01163     }
01164   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (s))
01165     {
01166       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"independent"</font>);
01167     }
01168   <font class="keywordflow">else</font>
01169     {
01170       BADEXIT;
01171     }
01172 }
01173 
01174 <font class="keyword">static</font> 
01175 <font class="keywordtype">bool</font> sRef_doModifyVal (sRef s, sRefSet sl)<font class="keyword"></font>
01176 <font class="keyword"></font>{
01177   llassert (sRef_isValid (s));
01178 
01179   
01180   <font class="keywordflow">switch</font> (s-&gt;kind)
01181     {
01182     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01183     <font class="keywordflow">case</font> SK_CONST:
01184       <font class="keywordflow">return</font> TRUE;
01185     <font class="keywordflow">case</font> SK_CVAR:
01186       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
01187         {
01188           
01189           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a108">context_checkGlobMod</a> (s))
01190             {
01191               <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s));
01192             }
01193           <font class="keywordflow">else</font>
01194             {
01195               (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s);
01196             }
01197 
01198                   <font class="keywordflow">return</font> TRUE;
01199         }
01200       <font class="keywordflow">else</font>
01201         {
01202           <font class="keywordflow">return</font> TRUE;
01203         }      
01204     <font class="keywordflow">case</font> SK_PARAM:
01205       <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s) 
01206               || alkind_isOnly (sRef_getOrigAliasKind (s)));
01207     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01208       <font class="comment">/* special case if ind known */</font>
01209       <font class="comment">/* unconditional OR, need side effect */</font>
01210       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01211                   sRef_doModifyVal (s-&gt;info-&gt;arrayfetch-&gt;arr, sl)));
01212     <font class="keywordflow">case</font> SK_FIELD:
01213       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01214                   sRef_doModifyVal (s-&gt;info-&gt;field-&gt;rec, sl)));
01215     <font class="keywordflow">case</font> SK_PTR:
01216       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01217                   sRef_doModifyVal (s-&gt;info-&gt;ref, sl)));
01218     <font class="keywordflow">case</font> SK_ADR:
01219       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01220                   sRef_doModifyVal (s-&gt;info-&gt;ref, sl)));
01221     <font class="keywordflow">case</font> SK_CONJ:
01222       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a1">AND</a> (sRef_doModifyVal (s-&gt;info-&gt;conj-&gt;a, sl) ,
01223                    sRef_doModifyVal (s-&gt;info-&gt;conj-&gt;b, sl)));
01224     <font class="keywordflow">case</font> SK_OBJECT:
01225     <font class="keywordflow">case</font> SK_DERIVED:
01226     <font class="keywordflow">case</font> SK_EXTERNAL:
01227     <font class="keywordflow">case</font> SK_UNKNOWN:
01228     <font class="keywordflow">case</font> SK_NEW:
01229     <font class="keywordflow">case</font> SK_TYPE:
01230       <font class="keywordflow">return</font> TRUE;
01231     <font class="keywordflow">case</font> SK_SPECIAL:
01232       {
01233         <font class="keywordflow">switch</font> (s-&gt;info-&gt;spec)
01234           {
01235           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> TRUE;
01236           <font class="keywordflow">case</font> SR_INTERNAL:  
01237             <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_INTERNALGLOBS))
01238               {
01239                 <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s));
01240               }
01241             <font class="keywordflow">else</font>
01242               {
01243                 (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s);
01244                 <font class="keywordflow">return</font> TRUE;
01245               }
01246           <font class="keywordflow">case</font> SR_SPECSTATE: 
01247             {
01248               <font class="keywordflow">return</font> TRUE;
01249             }
01250           <font class="keywordflow">case</font> SR_SYSTEM:
01251             {
01252               <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s));
01253             }
01254           }
01255       }
01256     <font class="keywordflow">case</font> SK_RESULT: BADBRANCH;
01257     }
01258   BADEXIT;
01259 }
01260 
01261 <font class="comment">/*</font>
01262 <font class="comment">** this should probably be elsewhere...</font>
01263 <font class="comment">**</font>
01264 <font class="comment">** returns TRUE iff sl indicates that s can be modified</font>
01265 <font class="comment">*/</font>
01266 
01267 <font class="keyword">static</font> 
01268 <font class="keywordtype">bool</font> sRef_doModify (sRef s, sRefSet sl)<font class="keyword"></font>
01269 <font class="keyword"></font>{
01270     llassert (sRef_isValid (s));
01271   
01272   <font class="keywordflow">switch</font> (s-&gt;kind)
01273     {
01274     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01275     <font class="keywordflow">case</font> SK_CONST:
01276       <font class="keywordflow">return</font> TRUE;
01277     <font class="keywordflow">case</font> SK_CVAR:
01278       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
01279         {
01280           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a108">context_checkGlobMod</a> (s))
01281             {
01282               <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s));
01283             }
01284           <font class="keywordflow">else</font>
01285             {
01286               (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s);
01287             }
01288 
01289           <font class="keywordflow">return</font> TRUE;
01290         }
01291       <font class="keywordflow">else</font>
01292         {
01293           <font class="keywordflow">return</font> TRUE;
01294         }
01295     <font class="keywordflow">case</font> SK_PARAM:
01296       <font class="keywordflow">return</font> TRUE;
01297     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01298             <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01299                   sRef_doModifyVal (s-&gt;info-&gt;arrayfetch-&gt;arr, sl)));
01300     <font class="keywordflow">case</font> SK_FIELD:
01301       {
01302         sRef sr = s-&gt;info-&gt;field-&gt;rec;
01303 
01304         <font class="keywordflow">if</font> (sr-&gt;kind == SK_PARAM)
01305           {
01306             <font class="keywordflow">return</font> TRUE; <font class="comment">/* structs are shallow-copied on call */</font>
01307           }
01308         
01309         <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01310                     sRef_doModifyVal (s-&gt;info-&gt;field-&gt;rec, sl)));
01311       }
01312     <font class="keywordflow">case</font> SK_PTR:
01313       {
01314         <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01315                     sRef_doModifyVal (s-&gt;info-&gt;ref, sl)));
01316       }
01317     <font class="keywordflow">case</font> SK_ADR:
01318       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a0">OR</a> (sRefSet_modifyMember (sl, s),
01319                   sRef_doModifyVal (s-&gt;info-&gt;ref, sl)));
01320     <font class="keywordflow">case</font> SK_CONJ:
01321       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a1">AND</a> (sRef_doModify (s-&gt;info-&gt;conj-&gt;a, sl),
01322                   (sRef_doModify (s-&gt;info-&gt;conj-&gt;b, sl))));
01323     <font class="keywordflow">case</font> SK_UNKNOWN:
01324     <font class="keywordflow">case</font> SK_NEW:
01325     <font class="keywordflow">case</font> SK_TYPE:
01326       <font class="keywordflow">return</font> TRUE;
01327     <font class="keywordflow">case</font> SK_OBJECT:
01328     <font class="keywordflow">case</font> SK_DERIVED:
01329     <font class="keywordflow">case</font> SK_EXTERNAL:
01330       <font class="keywordflow">return</font> TRUE;
01331     <font class="keywordflow">case</font> SK_SPECIAL:
01332       {
01333         <font class="keywordflow">switch</font> (s-&gt;info-&gt;spec)
01334           {
01335           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> TRUE;
01336           <font class="keywordflow">case</font> SR_INTERNAL:  <font class="keywordflow">return</font> TRUE;
01337           <font class="keywordflow">case</font> SR_SPECSTATE: <font class="keywordflow">return</font> TRUE;
01338           <font class="keywordflow">case</font> SR_SYSTEM:    <font class="keywordflow">return</font> (<a class="code" href="sRefSet_c.html#a32">sRefSet_modifyMember</a> (sl, s));
01339           }
01340       }
01341     <font class="keywordflow">case</font> SK_RESULT: BADBRANCH;
01342     }
01343   BADEXIT;
01344 }
01345 
01346 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
01347   sRef_leastCommon (<font class="comment">/*@exposed@*/</font> sRef s1, sRef s2)<font class="keyword"></font>
01348 <font class="keyword"></font>{
01349   llassert (sRef_similar (s1, s2));
01350   
01351   <font class="keywordflow">if</font> (!sRef_isValid (s1)) <font class="keywordflow">return</font> s1;
01352   <font class="keywordflow">if</font> (!sRef_isValid (s2)) <font class="keywordflow">return</font> s1;
01353 
01354   sRef_combineDefState (s1, s2);
01355   sRef_combineNullState (s1, s2);
01356   sRef_combineExKinds (s1, s2);
01357   
01358   <font class="keywordflow">if</font> (s1-&gt;aliaskind != s2-&gt;aliaskind)
01359     {
01360       <font class="keywordflow">if</font> (s1-&gt;aliaskind == AK_UNKNOWN)
01361         {
01362           s1-&gt;aliaskind = s2-&gt;aliaskind;
01363         }
01364       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s2-&gt;aliaskind == AK_UNKNOWN)
01365         {
01366           ;
01367         }
01368       <font class="keywordflow">else</font>
01369         {
01370           s1-&gt;aliaskind = AK_ERROR;
01371         }
01372     }
01373 
01374   <font class="keywordflow">return</font> s1;
01375 }
01376 
<a name="l01377"></a><a class="code" href="sRef_c.html#a104">01377</a> <font class="keywordtype">int</font> <a class="code" href="sRef_c.html#a104">sRef_compare</a> (sRef s1, sRef s2)<font class="keyword"></font>
01378 <font class="keyword"></font>{
01379   <font class="keywordflow">if</font> (s1 == s2) <font class="keywordflow">return</font> 0;
01380 
01381   <font class="keywordflow">if</font> (sRef_isInvalid (s1)) <font class="keywordflow">return</font> -1;
01382   <font class="keywordflow">if</font> (sRef_isInvalid (s2)) <font class="keywordflow">return</font> 1;
01383       
01384   INTCOMPARERETURN (s1-&gt;kind, s2-&gt;kind);
01385   INTCOMPARERETURN (s1-&gt;defstate, s2-&gt;defstate);
01386   INTCOMPARERETURN (s1-&gt;aliaskind, s2-&gt;aliaskind);
01387 
01388   COMPARERETURN (nstate_compare (s1-&gt;nullstate, s2-&gt;nullstate));
01389 
01390   <font class="keywordflow">switch</font> (s1-&gt;kind)
01391     {
01392     <font class="keywordflow">case</font> SK_PARAM:
01393       <font class="keywordflow">return</font> (int_compare (s1-&gt;info-&gt;paramno, s2-&gt;info-&gt;paramno));
01394     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01395       {
01396         COMPARERETURN (sRef_compare (s1-&gt;info-&gt;arrayfetch-&gt;arr, 
01397                                      s2-&gt;info-&gt;arrayfetch-&gt;arr));
01398         
01399         <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01400           {
01401             <font class="keywordflow">return</font> (int_compare (s1-&gt;info-&gt;arrayfetch-&gt;ind, 
01402                                  s2-&gt;info-&gt;arrayfetch-&gt;ind));
01403           }
01404         <font class="keywordflow">if</font> (!s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; !s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01405           <font class="keywordflow">return</font> 0;
01406         
01407         <font class="keywordflow">return</font> 1;
01408       }
01409     <font class="keywordflow">case</font> SK_FIELD:
01410       {
01411         COMPARERETURN (sRef_compare (s1-&gt;info-&gt;field-&gt;rec, s2-&gt;info-&gt;field-&gt;rec));
01412         
01413         <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field, s2-&gt;info-&gt;field-&gt;field))
01414           <font class="keywordflow">return</font> 0;
01415 
01416         <font class="keywordflow">return</font> 1;
01417       }
01418     <font class="keywordflow">case</font> SK_PTR:
01419     <font class="keywordflow">case</font> SK_ADR:
01420       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a104">sRef_compare</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01421     <font class="keywordflow">case</font> SK_CONJ:
01422       COMPARERETURN (sRef_compare (s1-&gt;info-&gt;conj-&gt;a, s2-&gt;info-&gt;conj-&gt;a));
01423       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a104">sRef_compare</a> (s1-&gt;info-&gt;conj-&gt;b, s2-&gt;info-&gt;conj-&gt;b));
01424     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01425       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a25">cstring_compare</a> (s1-&gt;info-&gt;fname, s2-&gt;info-&gt;fname));
01426     <font class="keywordflow">case</font> SK_NEW:
01427     <font class="keywordflow">case</font> SK_CVAR:
01428     <font class="keywordflow">case</font> SK_UNKNOWN:
01429     <font class="keywordflow">case</font> SK_OBJECT:
01430     <font class="keywordflow">case</font> SK_TYPE:
01431     <font class="keywordflow">case</font> SK_DERIVED:
01432     <font class="keywordflow">case</font> SK_EXTERNAL:
01433     <font class="keywordflow">case</font> SK_CONST:
01434     <font class="keywordflow">case</font> SK_RESULT:
01435       <font class="keywordflow">return</font> 0;
01436     <font class="keywordflow">case</font> SK_SPECIAL:
01437       <font class="keywordflow">return</font> (generic_compare (s1-&gt;info-&gt;spec, s2-&gt;info-&gt;spec));
01438     }
01439   BADEXIT;
01440 }
01441 
01442 <font class="keyword">static</font> <font class="keywordtype">bool</font> cref_equal (cref c1, cref c2)<font class="keyword"></font>
01443 <font class="keyword"></font>{
01444   <font class="keywordflow">return</font> ((c1-&gt;lexlevel == c2-&gt;lexlevel) &amp;&amp;
01445           (usymId_equal (c1-&gt;index, c2-&gt;index)));
01446 }
01447 
01448 <font class="comment">/*</font>
01449 <font class="comment">** returns true if s1 could be the same storage as s2.</font>
01450 <font class="comment">** i.e., a[?] ~ a[3].  Note its not symmetric ... s1</font>
01451 <font class="comment">** should be more specific.</font>
01452 <font class="comment">*/</font>
01453 
01454 <font class="comment">/*</font>
01455 <font class="comment">** like similar, but matches objects &lt;-&gt; non-objects</font>
01456 <font class="comment">*/</font>
01457 
01458 <font class="keyword">static</font> <font class="keywordtype">bool</font> 
01459 sRef_uniqueReference (sRef s)<font class="keyword"></font>
01460 <font class="keyword"></font>{
01461   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (s) || <a class="code" href="sRef_c.html#a342">sRef_isUnique</a> (s) 
01462           || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (s) || <a class="code" href="sRef_c.html#a349">sRef_isStack</a> (s)
01463           || <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (s)); 
01464 }
01465 
01466 <font class="keyword">static</font> <font class="keywordtype">bool</font>
01467 sRef_similarRelaxedAux (sRef s1, sRef s2)<font class="keyword"></font>
01468 <font class="keyword"></font>{
01469   <font class="keywordflow">if</font> (s1 == s2)
01470     {
01471       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a260">sRef_isUnknownArrayFetch</a> (s1))
01472         {
01473           <font class="keywordflow">return</font> FALSE;
01474         }
01475       <font class="keywordflow">else</font>
01476         {
01477           <font class="keywordflow">return</font> TRUE;
01478         }
01479     }
01480 
01481   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01482 
01483   <font class="keywordflow">if</font> (sRef_isConj (s2)) 
01484     <font class="keywordflow">return</font> (sRef_similarRelaxedAux (s1, sRef_getConjA (s2)) ||
01485             sRef_similarRelaxedAux (s1, sRef_getConjB (s2)));
01486 
01487   <font class="keywordflow">switch</font> (s1-&gt;kind)
01488     {
01489     <font class="keywordflow">case</font> SK_CVAR:
01490       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_CVAR)
01491               &amp;&amp; (cref_equal (s1-&gt;info-&gt;cvar, s2-&gt;info-&gt;cvar)));
01492     <font class="keywordflow">case</font> SK_PARAM:
01493       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PARAM)
01494               &amp;&amp; (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno));
01495     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01496       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01497         {
01498           <font class="keywordflow">if</font> (sRef_similarRelaxedAux (s1-&gt;info-&gt;arrayfetch-&gt;arr,
01499                                       s2-&gt;info-&gt;arrayfetch-&gt;arr))
01500             {
01501               <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown)
01502                 {
01503                   <font class="keywordflow">if</font> (s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01504                     {
01505                       <font class="keywordflow">return</font> (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind);
01506                     }
01507                   <font class="keywordflow">else</font> 
01508                     {
01509                       <font class="keywordflow">return</font> FALSE;
01510                     }
01511                 }
01512               <font class="keywordflow">else</font>
01513                 {
01514                   <font class="keywordflow">return</font> FALSE;
01515                 }
01516             }
01517         }
01518       <font class="keywordflow">return</font> FALSE;
01519     <font class="keywordflow">case</font> SK_FIELD:
01520       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_FIELD
01521                &amp;&amp; (sRef_similarRelaxedAux (s1-&gt;info-&gt;field-&gt;rec,
01522                                            s2-&gt;info-&gt;field-&gt;rec)
01523                    &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field,
01524                                      s2-&gt;info-&gt;field-&gt;field))));
01525     <font class="keywordflow">case</font> SK_PTR:
01526       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PTR)
01527               &amp;&amp; sRef_similarRelaxedAux (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01528     <font class="keywordflow">case</font> SK_ADR:
01529       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_ADR)
01530               &amp;&amp; sRef_similarRelaxedAux (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01531     <font class="keywordflow">case</font> SK_CONJ:
01532       <font class="keywordflow">return</font> ((sRef_similarRelaxedAux (s1-&gt;info-&gt;conj-&gt;a, s2) ||
01533               (sRef_similarRelaxedAux (s1-&gt;info-&gt;conj-&gt;b, s2))));
01534     <font class="keywordflow">case</font> SK_SPECIAL:
01535       <font class="keywordflow">return</font> (s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec);
01536     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01537       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;fname, s2-&gt;info-&gt;fname));
01538     <font class="keywordflow">case</font> SK_DERIVED:
01539     <font class="keywordflow">case</font> SK_CONST:
01540     <font class="keywordflow">case</font> SK_TYPE:
01541     <font class="keywordflow">case</font> SK_NEW:
01542     <font class="keywordflow">case</font> SK_UNKNOWN:
01543     <font class="keywordflow">case</font> SK_OBJECT:
01544     <font class="keywordflow">case</font> SK_EXTERNAL:
01545     <font class="keywordflow">case</font> SK_RESULT:
01546       <font class="keywordflow">return</font> FALSE;
01547     }
01548   BADEXIT;
01549 }
01550 
01551 <font class="keywordtype">bool</font>
<a name="l01552"></a><a class="code" href="sRef_c.html#a108">01552</a> <a class="code" href="sRef_c.html#a108">sRef_similarRelaxed</a> (sRef s1, sRef s2)<font class="keyword"></font>
01553 <font class="keyword"></font>{
01554   <font class="keywordtype">bool</font> us1, us2;
01555 
01556   <font class="keywordflow">if</font> (s1 == s2) 
01557     {
01558       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (s1))
01559         {
01560           <font class="keywordflow">return</font> FALSE;
01561         }
01562       <font class="keywordflow">else</font>
01563         {
01564           <font class="keywordflow">return</font> TRUE;
01565         }
01566     }
01567 
01568   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01569 
01570   us1 = sRef_uniqueReference (s1);
01571   us2 = sRef_uniqueReference (s2);
01572 
01573   <font class="keywordflow">if</font> ((s1-&gt;kind == SK_EXTERNAL &amp;&amp; (s2-&gt;kind != SK_EXTERNAL &amp;&amp; !us2))
01574       || (s2-&gt;kind == SK_EXTERNAL &amp;&amp; (s1-&gt;kind != SK_EXTERNAL &amp;&amp; !us1)))
01575     {
01576       <font class="comment">/*</font>
01577 <font class="comment">      ** Previously, also:</font>
01578 <font class="comment">      **   || (sRef_isExposed (s1) &amp;&amp; !us2) || (sRef_isExposed (s2) &amp;&amp; !us1)) ???? </font>
01579 <font class="comment">      **</font>
01580 <font class="comment">      ** No clue why this was there?!</font>
01581 <font class="comment">      */</font>
01582 
01583 
01584       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s1) &amp;&amp; <a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s1))
01585         {
01586           uentry ue1 = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s1);
01587 
01588           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (ue1))
01589             {
01590               <font class="keywordflow">return</font> sRef_similarRelaxedAux (s1, s2);
01591             }
01592         }
01593       
01594       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s2) &amp;&amp; <a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s2))
01595         {
01596           uentry ue2 = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s2);
01597 
01598           <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (ue2))
01599             {
01600               <font class="keywordflow">return</font> sRef_similarRelaxedAux (s1, s2);
01601             }
01602         }
01603       
01604             <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (s1-&gt;type, s2-&gt;type));
01605     }
01606   <font class="keywordflow">else</font>
01607     {
01608             <font class="keywordflow">return</font> sRef_similarRelaxedAux (s1, s2);
01609     }
01610 }
01611 
01612 <font class="keywordtype">bool</font>
<a name="l01613"></a><a class="code" href="sRef_c.html#a109">01613</a> <a class="code" href="sRef_c.html#a109">sRef_similar</a> (sRef s1, sRef s2)<font class="keyword"></font>
01614 <font class="keyword"></font>{
01615   <font class="keywordflow">if</font> (s1 == s2) <font class="keywordflow">return</font> TRUE;
01616   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01617 
01618   <font class="keywordflow">if</font> (sRef_isConj (s2)) 
01619     {
01620       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1, sRef_getConjA (s2)) ||
01621               <a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1, sRef_getConjB (s2)));
01622     }
01623 
01624   <font class="keywordflow">if</font> (sRef_isDerived (s2))
01625    {
01626      <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (s1, s2-&gt;info-&gt;ref));
01627    }
01628 
01629   <font class="keywordflow">switch</font> (s1-&gt;kind)
01630     {
01631     <font class="keywordflow">case</font> SK_CVAR:
01632       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_CVAR)
01633               &amp;&amp; (cref_equal (s1-&gt;info-&gt;cvar, s2-&gt;info-&gt;cvar)));
01634     <font class="keywordflow">case</font> SK_PARAM:
01635       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PARAM)
01636               &amp;&amp; (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno));
01637     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01638       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01639         {
01640           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;arrayfetch-&gt;arr,
01641                             s2-&gt;info-&gt;arrayfetch-&gt;arr))
01642             {
01643               <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown)
01644                 {
01645                   <font class="keywordflow">if</font> (s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01646                     {
01647                       <font class="keywordflow">return</font> (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind);
01648                     }
01649                   <font class="keywordflow">else</font> 
01650                     {
01651                       <font class="keywordflow">return</font> TRUE;
01652                     }
01653                 }
01654               <font class="keywordflow">else</font>
01655                 {
01656                   <font class="keywordflow">return</font> TRUE;
01657                 }
01658             }
01659         }
01660       <font class="keywordflow">else</font> 
01661         {
01662           <font class="keywordflow">if</font> (s2-&gt;kind == SK_PTR)
01663             {
01664               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;arrayfetch-&gt;arr,
01665                                 s2-&gt;info-&gt;ref))
01666                 {
01667                   <font class="keywordflow">return</font> TRUE; 
01668                 }
01669             }
01670         }
01671 
01672       <font class="keywordflow">return</font> FALSE;
01673     <font class="keywordflow">case</font> SK_FIELD:
01674       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_FIELD
01675                &amp;&amp; (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;field-&gt;rec,
01676                                  s2-&gt;info-&gt;field-&gt;rec)
01677                    &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field,
01678                                      s2-&gt;info-&gt;field-&gt;field))));
01679     <font class="keywordflow">case</font> SK_PTR:
01680       <font class="keywordflow">if</font> (s2-&gt;kind == SK_PTR)
01681         {
01682           <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref);
01683         }
01684       <font class="keywordflow">else</font> 
01685         {
01686           <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01687             {
01688               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s2-&gt;info-&gt;arrayfetch-&gt;arr,
01689                                 s1-&gt;info-&gt;ref))
01690                 {
01691                   <font class="keywordflow">return</font> TRUE; 
01692                 }
01693             }
01694         }
01695 
01696       <font class="keywordflow">return</font> FALSE;
01697     <font class="keywordflow">case</font> SK_ADR:
01698       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_ADR)
01699               &amp;&amp; <a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01700     <font class="keywordflow">case</font> SK_CONJ:
01701       <font class="keywordflow">return</font> ((<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;conj-&gt;a, s2) ||
01702               (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1-&gt;info-&gt;conj-&gt;b, s2))));
01703     <font class="keywordflow">case</font> SK_DERIVED:
01704       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (s2, s1-&gt;info-&gt;ref));
01705     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01706       <font class="keywordflow">return</font> (s2-&gt;kind == SK_UNCONSTRAINED
01707               &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;fname, s2-&gt;info-&gt;fname));
01708     <font class="keywordflow">case</font> SK_CONST:
01709     <font class="keywordflow">case</font> SK_TYPE:
01710     <font class="keywordflow">case</font> SK_NEW:
01711     <font class="keywordflow">case</font> SK_UNKNOWN:
01712     <font class="keywordflow">case</font> SK_OBJECT:
01713     <font class="keywordflow">case</font> SK_EXTERNAL:
01714     <font class="keywordflow">case</font> SK_RESULT:
01715       <font class="keywordflow">return</font> FALSE;
01716     <font class="keywordflow">case</font> SK_SPECIAL:
01717       <font class="keywordflow">return</font> (s2-&gt;kind == SK_SPECIAL 
01718               &amp;&amp; (s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec));
01719     }
01720 
01721   <font class="comment">/*@notreached@*/</font> DPRINTF ((<font class="stringliteral">"Fell through for: %s / %s"</font>, sRef_unparse (s1), <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s2)));
01722   BADEXIT;
01723 }
01724 
01725 <font class="comment">/*</font>
01726 <font class="comment">** return TRUE iff small can be derived from big.</font>
01727 <font class="comment">**</font>
01728 <font class="comment">** (e.g. x, x.a is includedBy x;</font>
01729 <font class="comment">**       x.a is included By x.a;</font>
01730 <font class="comment">*/</font>
01731 
01732 <font class="keywordtype">bool</font>
<a name="l01733"></a><a class="code" href="sRef_c.html#a110">01733</a> <a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (sRef small, sRef big)<font class="keyword"></font>
01734 <font class="keyword"></font>{
01735   <font class="keywordflow">if</font> (small == big) <font class="keywordflow">return</font> TRUE;
01736   <font class="keywordflow">if</font> (sRef_isInvalid (small) || sRef_isInvalid (big)) <font class="keywordflow">return</font> FALSE;
01737 
01738   <font class="keywordflow">if</font> (sRef_isConj (big)) 
01739     <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (small, sRef_getConjA (big)) ||
01740             <a class="code" href="sRef_c.html#a109">sRef_similar</a> (small, sRef_getConjB (big)));
01741 
01742   <font class="keywordflow">switch</font> (small-&gt;kind)
01743     {
01744     <font class="keywordflow">case</font> SK_CVAR:
01745     <font class="keywordflow">case</font> SK_PARAM:
01746       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a112">sRef_same</a> (small, big));
01747     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01748       <font class="keywordflow">if</font> (big-&gt;kind == SK_ARRAYFETCH)
01749         {
01750           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a112">sRef_same</a> (small-&gt;info-&gt;arrayfetch-&gt;arr, big-&gt;info-&gt;arrayfetch-&gt;arr))
01751             {
01752               <font class="keywordflow">if</font> (small-&gt;info-&gt;arrayfetch-&gt;indknown)
01753                 {
01754                   <font class="keywordflow">if</font> (big-&gt;info-&gt;arrayfetch-&gt;indknown)
01755                     {
01756                       <font class="keywordflow">return</font> (small-&gt;info-&gt;arrayfetch-&gt;ind == big-&gt;info-&gt;arrayfetch-&gt;ind);
01757                     }
01758                   <font class="keywordflow">else</font> 
01759                     {
01760                       <font class="keywordflow">return</font> TRUE;
01761                     }
01762                 }
01763               <font class="keywordflow">else</font>
01764                 {
01765                   <font class="keywordflow">return</font> TRUE;
01766                 }
01767             }
01768         }
01769       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;arrayfetch-&gt;arr, big));
01770     <font class="keywordflow">case</font> SK_FIELD:
01771       <font class="keywordflow">if</font> (big-&gt;kind == SK_FIELD)
01772         {
01773           <font class="keywordflow">return</font> 
01774             (<a class="code" href="sRef_c.html#a112">sRef_same</a> (small-&gt;info-&gt;field-&gt;rec, big-&gt;info-&gt;field-&gt;rec) &amp;&amp;
01775              <a class="code" href="cstring_c.html#a18">cstring_equal</a> (small-&gt;info-&gt;field-&gt;field, big-&gt;info-&gt;field-&gt;field));
01776         }
01777       <font class="keywordflow">else</font>
01778         {
01779           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;field-&gt;rec, big));
01780         }
01781 
01782     <font class="keywordflow">case</font> SK_PTR:
01783       <font class="keywordflow">if</font> (big-&gt;kind == SK_PTR)
01784         {
01785           <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a112">sRef_same</a> (small-&gt;info-&gt;ref, big-&gt;info-&gt;ref);
01786         }
01787       <font class="keywordflow">else</font>
01788         {
01789           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;ref, big));
01790         }
01791 
01792     <font class="keywordflow">case</font> SK_ADR:
01793       <font class="keywordflow">return</font> ((big-&gt;kind == SK_ADR) &amp;&amp; <a class="code" href="sRef_c.html#a109">sRef_similar</a> (small-&gt;info-&gt;ref, big-&gt;info-&gt;ref));
01794     <font class="keywordflow">case</font> SK_CONJ:
01795       <font class="keywordflow">return</font> ((<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;conj-&gt;a, big) ||
01796               (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;conj-&gt;b, big))));
01797     <font class="keywordflow">case</font> SK_DERIVED:
01798       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a110">sRef_includedBy</a> (small-&gt;info-&gt;ref, big));
01799     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01800     <font class="keywordflow">case</font> SK_CONST:
01801     <font class="keywordflow">case</font> SK_TYPE:
01802     <font class="keywordflow">case</font> SK_NEW:
01803     <font class="keywordflow">case</font> SK_UNKNOWN:
01804     <font class="keywordflow">case</font> SK_OBJECT:
01805     <font class="keywordflow">case</font> SK_EXTERNAL:
01806     <font class="keywordflow">case</font> SK_RESULT:
01807       <font class="keywordflow">return</font> FALSE;
01808     <font class="keywordflow">case</font> SK_SPECIAL:
01809       <font class="keywordflow">switch</font> (small-&gt;info-&gt;spec)
01810         {
01811         <font class="keywordflow">case</font> SR_NOTHING: <font class="keywordflow">return</font> TRUE;
01812         <font class="keywordflow">case</font> SR_SPECSTATE:
01813         <font class="keywordflow">case</font> SR_INTERNAL: <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a162">sRef_isSpecInternalState</a> (big) ||
01814                                   <a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (big));
01815         <font class="keywordflow">case</font> SR_SYSTEM: <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (big));
01816         }
01817     }
01818   BADEXIT;
01819 }
01820 
01821 <font class="comment">/*</font>
01822 <font class="comment">** Same is similar to similar, but not quite the same. </font>
01823 <font class="comment">** same and realSame aren't the same, but they are really similar.</font>
01824 <font class="comment">** similarly, same is the same as same. but realSame is</font>
01825 <font class="comment">** not really the same as same, or similar to similar.</font>
01826 <font class="comment">**</font>
01827 <font class="comment">** Similarly to similar, same checks if two sRefs are the same.</font>
01828 <font class="comment">** The similarities end, however, when same compares arrays</font>
01829 <font class="comment">** with unknown indexes.  Similar returns false; same returns true.</font>
01830 <font class="comment">**</font>
01831 <font class="comment">** Similarly to similar and same, realSame is the same as same,</font>
01832 <font class="comment">** except they do not behave the same when face with unknown</font>
01833 <font class="comment">** sRefs.  Same thinks they are not the same, but realSame thinks</font>
01834 <font class="comment">** the are.</font>
01835 <font class="comment">**</font>
01836 <font class="comment">*/</font>
01837 
01838 <font class="keywordtype">bool</font>
<a name="l01839"></a><a class="code" href="sRef_c.html#a111">01839</a> <a class="code" href="sRef_c.html#a111">sRef_realSame</a> (sRef s1, sRef s2)<font class="keyword"></font>
01840 <font class="keyword"></font>{
01841   <font class="keywordflow">if</font> (s1 == s2) <font class="keywordflow">return</font> TRUE;  
01842   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01843 
01844   <font class="keywordflow">switch</font> (s1-&gt;kind)
01845     {
01846     <font class="keywordflow">case</font> SK_CVAR:
01847       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_CVAR) &amp;&amp; (cref_equal (s1-&gt;info-&gt;cvar, s2-&gt;info-&gt;cvar)));
01848     <font class="keywordflow">case</font> SK_PARAM:
01849       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PARAM) &amp;&amp; (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno));
01850     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01851       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01852         {
01853           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;arrayfetch-&gt;arr, s2-&gt;info-&gt;arrayfetch-&gt;arr))
01854             {
01855               <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01856                 {
01857                   <font class="keywordflow">return</font> (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind);
01858                 }
01859               <font class="keywordflow">if</font> (!s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; !s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01860                 {
01861                   <font class="keywordflow">return</font> TRUE;
01862                 }
01863               <font class="keywordflow">return</font> FALSE;
01864             }
01865         }
01866       <font class="keywordflow">return</font> FALSE;
01867     <font class="keywordflow">case</font> SK_FIELD:
01868       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_FIELD &amp;&amp;
01869                (<a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;field-&gt;rec, s2-&gt;info-&gt;field-&gt;rec) &amp;&amp;
01870                 <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field, s2-&gt;info-&gt;field-&gt;field))));
01871     <font class="keywordflow">case</font> SK_PTR:
01872       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PTR) &amp;&amp; <a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01873     <font class="keywordflow">case</font> SK_ADR:
01874       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_ADR) &amp;&amp; <a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01875     <font class="keywordflow">case</font> SK_CONJ:
01876       <font class="keywordflow">return</font> ((<a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;conj-&gt;a, s2) ||
01877               (<a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;conj-&gt;b, s2))));
01878     <font class="keywordflow">case</font> SK_OBJECT:
01879       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_OBJECT) 
01880               &amp;&amp; <a class="code" href="ctype_c.html#a96">ctype_match</a> (s1-&gt;info-&gt;object, s2-&gt;info-&gt;object));
01881     <font class="keywordflow">case</font> SK_EXTERNAL:
01882       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_EXTERNAL) 
01883               &amp;&amp; <a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01884     <font class="keywordflow">case</font> SK_SPECIAL:
01885       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_SPECIAL) &amp;&amp; s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec);
01886     <font class="keywordflow">case</font> SK_DERIVED:
01887       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_DERIVED) &amp;&amp; <a class="code" href="sRef_c.html#a111">sRef_realSame</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01888     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01889       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_UNCONSTRAINED) 
01890               &amp;&amp; (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;fname, s2-&gt;info-&gt;fname)));
01891     <font class="keywordflow">case</font> SK_TYPE:
01892     <font class="keywordflow">case</font> SK_CONST:
01893     <font class="keywordflow">case</font> SK_NEW:
01894     <font class="keywordflow">case</font> SK_UNKNOWN:
01895     <font class="keywordflow">case</font> SK_RESULT:
01896       <font class="keywordflow">return</font> TRUE; <font class="comment">/* changed this! was false */</font>
01897     }
01898   BADEXIT;
01899 }
01900 
01901 <font class="comment">/*</font>
01902 <font class="comment">** same is similar to similar, but not quite the same. </font>
01903 <font class="comment">**</font>
01904 <font class="comment">** Similarly to similar, same checks is two sRefs are the same.</font>
01905 <font class="comment">** The similarities end, however, when same compares arrays</font>
01906 <font class="comment">** with unknown indexes.  Similar returns false; same returns true.</font>
01907 <font class="comment">*/</font>
01908 
01909 <font class="keywordtype">bool</font>
<a name="l01910"></a><a class="code" href="sRef_c.html#a112">01910</a> <a class="code" href="sRef_c.html#a112">sRef_same</a> (sRef s1, sRef s2)<font class="keyword"></font>
01911 <font class="keyword"></font>{
01912   <font class="keywordflow">if</font> (s1 == s2) <font class="keywordflow">return</font> TRUE;
01913   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01914 
01915   <font class="keywordflow">switch</font> (s1-&gt;kind)
01916     {
01917     <font class="keywordflow">case</font> SK_CVAR:
01918       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_CVAR) &amp;&amp; (cref_equal (s1-&gt;info-&gt;cvar, s2-&gt;info-&gt;cvar)));
01919     <font class="keywordflow">case</font> SK_PARAM:
01920       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PARAM) &amp;&amp; (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno));
01921     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01922       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01923         {
01924           llassert (s1-&gt;info-&gt;field-&gt;rec != s1);
01925           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;arrayfetch-&gt;arr, s2-&gt;info-&gt;arrayfetch-&gt;arr))
01926             {
01927               <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; s2-&gt;info-&gt;arrayfetch-&gt;indknown)
01928                 {
01929                   <font class="keywordflow">return</font> (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind);
01930                 }
01931               <font class="keywordflow">return</font> TRUE;
01932             }
01933         }
01934       <font class="keywordflow">return</font> FALSE;
01935     <font class="keywordflow">case</font> SK_FIELD:
01936       {
01937         llassert (s1-&gt;info-&gt;field-&gt;rec != s1);
01938         <font class="keywordflow">return</font> ((s2-&gt;kind == SK_FIELD &amp;&amp;
01939                  (<a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;field-&gt;rec, s2-&gt;info-&gt;field-&gt;rec) &amp;&amp;
01940                   <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field, s2-&gt;info-&gt;field-&gt;field))));
01941       }
01942     <font class="keywordflow">case</font> SK_PTR:
01943       {
01944         llassert (s1-&gt;info-&gt;ref != s1);
01945         <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PTR) &amp;&amp; <a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01946       }
01947     <font class="keywordflow">case</font> SK_ADR:
01948       {
01949         llassert (s1-&gt;info-&gt;ref != s1);
01950         <font class="keywordflow">return</font> ((s2-&gt;kind == SK_ADR) &amp;&amp; <a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01951       }
01952     <font class="keywordflow">case</font> SK_CONJ:
01953       llassert (s1-&gt;info-&gt;conj-&gt;a != s1);
01954       llassert (s1-&gt;info-&gt;conj-&gt;b != s1);
01955       <font class="keywordflow">return</font> ((<a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;conj-&gt;a, s2)) &amp;&amp; <font class="comment">/* or or and? */</font>
01956               (<a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;conj-&gt;b, s2)));
01957     <font class="keywordflow">case</font> SK_SPECIAL:
01958       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_SPECIAL) &amp;&amp; s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec);
01959     <font class="keywordflow">case</font> SK_DERIVED:
01960       llassert (s1-&gt;info-&gt;ref != s1);
01961       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_DERIVED) &amp;&amp; <a class="code" href="sRef_c.html#a112">sRef_same</a> (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
01962     <font class="keywordflow">case</font> SK_CONST:
01963     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01964     <font class="keywordflow">case</font> SK_TYPE:
01965     <font class="keywordflow">case</font> SK_UNKNOWN:
01966     <font class="keywordflow">case</font> SK_NEW:
01967     <font class="keywordflow">case</font> SK_OBJECT:
01968     <font class="keywordflow">case</font> SK_EXTERNAL:
01969     <font class="keywordflow">case</font> SK_RESULT:
01970       <font class="keywordflow">return</font> FALSE; 
01971     }
01972   BADEXIT;
01973 }
01974 
01975 <font class="comment">/*</font>
01976 <font class="comment">** sort of similar, for use in def/use</font>
01977 <font class="comment">*/</font>
01978 
01979 <font class="keyword">static</font> <font class="keywordtype">bool</font>
01980 sRef_closeEnough (sRef s1, sRef s2)<font class="keyword"></font>
01981 <font class="keyword"></font>{
01982   <font class="keywordflow">if</font> (s1 == s2) <font class="keywordflow">return</font> TRUE;
01983   <font class="keywordflow">if</font> (sRef_isInvalid (s1) || sRef_isInvalid (s2)) <font class="keywordflow">return</font> FALSE;
01984 
01985   <font class="keywordflow">switch</font> (s1-&gt;kind)
01986     {
01987     <font class="keywordflow">case</font> SK_CVAR:
01988       <font class="keywordflow">return</font> (((s2-&gt;kind == SK_CVAR) &amp;&amp;
01989                (cref_equal (s1-&gt;info-&gt;cvar, s2-&gt;info-&gt;cvar))) ||
01990               (s2-&gt;kind == SK_UNCONSTRAINED &amp;&amp; s1-&gt;info-&gt;cvar-&gt;lexlevel == 0));
01991     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
01992       <font class="keywordflow">return</font> (s2-&gt;kind == SK_UNCONSTRAINED
01993               || ((s2-&gt;kind == SK_CVAR) &amp;&amp; (s2-&gt;info-&gt;cvar-&gt;lexlevel == 0)));
01994     <font class="keywordflow">case</font> SK_PARAM:
01995       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PARAM) 
01996               &amp;&amp; (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno));
01997     <font class="keywordflow">case</font> SK_ARRAYFETCH:
01998       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
01999         {
02000           <font class="keywordflow">if</font> (sRef_closeEnough (s1-&gt;info-&gt;arrayfetch-&gt;arr, s2-&gt;info-&gt;arrayfetch-&gt;arr))
02001             {
02002               <font class="keywordflow">if</font> (s1-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; s2-&gt;info-&gt;arrayfetch-&gt;indknown)
02003                 {
02004                   <font class="keywordflow">return</font> (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind);
02005                 }
02006               <font class="keywordflow">return</font> TRUE;
02007             }
02008         }
02009       <font class="keywordflow">return</font> FALSE;
02010     <font class="keywordflow">case</font> SK_FIELD:
02011       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_FIELD &amp;&amp;
02012                (sRef_closeEnough (s1-&gt;info-&gt;field-&gt;rec, s2-&gt;info-&gt;field-&gt;rec) &amp;&amp;
02013                 <a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field, s2-&gt;info-&gt;field-&gt;field))));
02014     <font class="keywordflow">case</font> SK_PTR:
02015       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_PTR) &amp;&amp; sRef_closeEnough (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
02016     <font class="keywordflow">case</font> SK_ADR:
02017       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_ADR) &amp;&amp; sRef_closeEnough (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
02018     <font class="keywordflow">case</font> SK_DERIVED:
02019       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_DERIVED) &amp;&amp; sRef_closeEnough (s1-&gt;info-&gt;ref, s2-&gt;info-&gt;ref));
02020     <font class="keywordflow">case</font> SK_CONJ:
02021       <font class="keywordflow">return</font> ((sRef_closeEnough (s1-&gt;info-&gt;conj-&gt;a, s2)) ||
02022               (sRef_closeEnough (s1-&gt;info-&gt;conj-&gt;b, s2)));
02023     <font class="keywordflow">case</font> SK_SPECIAL:
02024       <font class="keywordflow">return</font> ((s2-&gt;kind == SK_SPECIAL) &amp;&amp; s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec);
02025     <font class="keywordflow">case</font> SK_TYPE:
02026     <font class="keywordflow">case</font> SK_CONST:
02027     <font class="keywordflow">case</font> SK_UNKNOWN:
02028     <font class="keywordflow">case</font> SK_NEW:
02029     <font class="keywordflow">case</font> SK_OBJECT:
02030     <font class="keywordflow">case</font> SK_EXTERNAL:
02031     <font class="keywordflow">case</font> SK_RESULT:
02032 
02033       <font class="keywordflow">return</font> FALSE;
02034     }
02035   BADEXIT;
02036 }
02037 
02038 <font class="comment">/*@exposed@*/</font> sRef
<a name="l02039"></a><a class="code" href="sRef_c.html#a114">02039</a> <a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (<font class="comment">/*@returned@*/</font> sRef s, exprNodeList args)<font class="keyword"></font>
02040 <font class="keyword"></font>{
02041   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (sRef_undefined);
02042 
02043   <font class="keywordflow">switch</font> (s-&gt;kind)
02044     {
02045     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02046     <font class="keywordflow">case</font> SK_CVAR:
02047       <font class="keywordflow">return</font> s;
02048     <font class="keywordflow">case</font> SK_PARAM:
02049       {
02050         <font class="keywordflow">if</font> (exprNodeList_size (args) &gt; s-&gt;info-&gt;paramno)
02051           {
02052             exprNode e = <a class="code" href="exprNodeList_c.html#a10">exprNodeList_nth</a> (args, s-&gt;info-&gt;paramno);
02053 
02054             <font class="keywordflow">if</font> (exprNode_isError (e))
02055               {
02056                 <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02057               }
02058             
02059             <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (e));
02060           }
02061         <font class="keywordflow">else</font>
02062           {
02063             <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02064           }
02065       }
02066     <font class="keywordflow">case</font> SK_ARRAYFETCH:
02067 
02068       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
02069         {
02070           <font class="keywordflow">return</font> (sRef_makeArrayFetchKnown 
02071                   (<a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, args),
02072                    s-&gt;info-&gt;arrayfetch-&gt;ind));
02073         }
02074       <font class="keywordflow">else</font>
02075         {
02076           <font class="keywordflow">return</font> (sRef_makeArrayFetch 
02077                   (<a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, args)));
02078         }
02079     <font class="keywordflow">case</font> SK_FIELD:
02080       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a279">sRef_makeField</a> (sRef_fixBaseParam (s-&gt;info-&gt;field-&gt;rec, args),
02081                               s-&gt;info-&gt;field-&gt;field));
02082 
02083     <font class="keywordflow">case</font> SK_PTR:
02084       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (sRef_fixBaseParam (s-&gt;info-&gt;ref, args)));
02085 
02086     <font class="keywordflow">case</font> SK_ADR:
02087       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (sRef_fixBaseParam (s-&gt;info-&gt;ref, args)));
02088 
02089     <font class="keywordflow">case</font> SK_CONJ:
02090       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (sRef_fixBaseParam (s-&gt;info-&gt;conj-&gt;a, args),
02091                              <a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s-&gt;info-&gt;conj-&gt;b, args)));
02092     <font class="keywordflow">case</font> SK_DERIVED:
02093     <font class="keywordflow">case</font> SK_SPECIAL:
02094     <font class="keywordflow">case</font> SK_TYPE:
02095     <font class="keywordflow">case</font> SK_CONST:
02096     <font class="keywordflow">case</font> SK_NEW:
02097     <font class="keywordflow">case</font> SK_UNKNOWN:
02098     <font class="keywordflow">case</font> SK_OBJECT:
02099     <font class="keywordflow">case</font> SK_EXTERNAL:
02100     <font class="keywordflow">case</font> SK_RESULT:
02101       <font class="keywordflow">return</font> s;
02102     }
02103   BADEXIT;
02104 }
02105 
02106 <font class="comment">/*@exposed@*/</font> sRef
<a name="l02107"></a><a class="code" href="sRef_c.html#a115">02107</a> <a class="code" href="sRef_c.html#a115">sRef_undumpGlobal</a> (<font class="keywordtype">char</font> **c)<font class="keyword"></font>
02108 <font class="keyword"></font>{
02109   <font class="keywordtype">char</font> p = **c;
02110 
02111   (*c)++;
02112 
02113   <font class="keywordflow">switch</font> (p)
02114     {
02115     <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
02116       {
02117         usymId uid = usymId_fromInt (getInt (c));
02118         sstate defstate;
02119         nstate nullstate;
02120         sRef ret;
02121 
02122         checkChar (c, <font class="charliteral">'@'</font>);
02123         defstate = <a class="code" href="varKinds_c.html#a2">sstate_fromInt</a> (getInt (c));
02124 
02125         checkChar (c, <font class="charliteral">'@'</font>);
02126         nullstate = <a class="code" href="varKinds_c.html#a1">nstate_fromInt</a> (getInt (c));
02127 
02128         ret = <a class="code" href="sRef_c.html#a131">sRef_makeGlobal</a> (uid, ctype_unknown);
02129         ret-&gt;nullstate = nullstate;
02130         ret-&gt;defstate = defstate;
02131         <font class="keywordflow">return</font> ret;
02132       }
02133     <font class="keywordflow">case</font> <font class="charliteral">'s'</font>:
02134       {
02135         <font class="keywordtype">int</font> i = <a class="code" href="general_c.html#a16">getInt</a> (c);
02136         speckind sk = speckind_fromInt (i);
02137 
02138         <font class="keywordflow">switch</font> (sk)
02139           {
02140           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a155">sRef_makeNothing</a> ());
02141           <font class="keywordflow">case</font> SR_INTERNAL:  <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a156">sRef_makeInternalState</a> ());
02142           <font class="keywordflow">case</font> SR_SPECSTATE: <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a157">sRef_makeSpecState</a> ());
02143           <font class="keywordflow">case</font> SR_SYSTEM:    <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a158">sRef_makeSystemState</a> ());
02144           }
02145         BADEXIT;
02146       }
02147     <font class="keywordflow">case</font> <font class="charliteral">'-'</font>:
02148       <font class="keywordflow">return</font> sRef_undefined;
02149     <font class="keywordflow">case</font> <font class="charliteral">'u'</font>:
02150       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02151     <font class="keywordflow">case</font> <font class="charliteral">'x'</font>:
02152       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02153     <font class="keywordflow">default</font>:
02154       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"sRef_undumpGlobal: bad line: %s"</font>,
02155                              cstring_fromChars (*c)));
02156     }
02157   BADEXIT;
02158 }
02159 
02160 <font class="comment">/*@exposed@*/</font> sRef
<a name="l02161"></a><a class="code" href="sRef_c.html#a116">02161</a> <a class="code" href="sRef_c.html#a116">sRef_undump</a> (<font class="keywordtype">char</font> **c)<font class="keyword"></font>
02162 <font class="keyword"></font>{
02163   <font class="keywordtype">char</font> p = **c;
02164 
02165   (*c)++;
02166 
02167   <font class="keywordflow">switch</font> (p)
02168     {
02169     <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
02170       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a131">sRef_makeGlobal</a> (usymId_fromInt (getInt (c)), ctype_unknown));
02171     <font class="keywordflow">case</font> <font class="charliteral">'p'</font>:
02172       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a133">sRef_makeParam</a> (getInt (c), ctype_unknown));
02173     <font class="keywordflow">case</font> <font class="charliteral">'r'</font>:
02174       <font class="keywordflow">return</font> (sRef_makeResultType (ctype_undump (c)));
02175     <font class="keywordflow">case</font> <font class="charliteral">'a'</font>:
02176       {
02177         <font class="keywordflow">if</font> ((**c &gt;= <font class="charliteral">'0'</font> &amp;&amp; **c &lt;= <font class="charliteral">'9'</font>) || **c == <font class="charliteral">'-'</font>)
02178           {
02179             <font class="keywordtype">int</font> i = <a class="code" href="general_c.html#a16">getInt</a> (c);
02180             sRef arr = <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c);
02181             sRef ret = <a class="code" href="sRef_c.html#a265">sRef_buildArrayFetchKnown</a> (arr, i);
02182 
02183             <font class="keywordflow">return</font> ret;
02184           }
02185         <font class="keywordflow">else</font>
02186           {
02187             sRef arr = <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c);
02188             sRef ret = <a class="code" href="sRef_c.html#a264">sRef_buildArrayFetch</a> (arr);
02189 
02190             <font class="keywordflow">return</font> ret;
02191           }
02192       }
02193     <font class="keywordflow">case</font> <font class="charliteral">'f'</font>:
02194       {
02195         cstring fname = cstring_undefined;
02196         sRef ret;
02197 
02198         <font class="keywordflow">while</font> (**c != <font class="charliteral">'.'</font>)
02199           {
02200             fname = <a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (fname, **c);
02201             (*c)++;
02202           }
02203         (*c)++;
02204 
02205         ret = <a class="code" href="sRef_c.html#a258">sRef_buildField</a> (sRef_undump (c), fname);
02206         <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (fname);
02207         <font class="keywordflow">return</font> (ret);
02208       }
02209     <font class="keywordflow">case</font> <font class="charliteral">'s'</font>:
02210       {
02211         <font class="keywordtype">int</font> i = <a class="code" href="general_c.html#a16">getInt</a> (c);
02212         speckind sk = speckind_fromInt (i);
02213 
02214         <font class="keywordflow">switch</font> (sk)
02215           {
02216           <font class="keywordflow">case</font> SR_NOTHING:   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a155">sRef_makeNothing</a> ());
02217           <font class="keywordflow">case</font> SR_INTERNAL:  <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a156">sRef_makeInternalState</a> ());
02218           <font class="keywordflow">case</font> SR_SPECSTATE: <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a157">sRef_makeSpecState</a> ());
02219           <font class="keywordflow">case</font> SR_SYSTEM:    <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a158">sRef_makeSystemState</a> ());
02220           }
02221         BADEXIT;
02222       }
02223     <font class="keywordflow">case</font> <font class="charliteral">'t'</font>:
02224       {
02225         sRef ptr = <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c);
02226         sRef ret = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (ptr);
02227 
02228         <font class="keywordflow">return</font> (ret);
02229       }
02230     <font class="keywordflow">case</font> <font class="charliteral">'d'</font>:
02231       {
02232         sRef adr = <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c);
02233         sRef ret = <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (adr);
02234 
02235         <font class="keywordflow">return</font> (ret);
02236       }
02237     <font class="keywordflow">case</font> <font class="charliteral">'o'</font>:
02238       {
02239         <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a144">sRef_makeObject</a> (ctype_undump (c)));
02240       }
02241     <font class="keywordflow">case</font> <font class="charliteral">'c'</font>:
02242       {
02243         sRef s1 = <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c);
02244         sRef s2 = ((*c)++, <a class="code" href="sRef_c.html#a116">sRef_undump</a> (c));
02245         sRef ret = <a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (s1, s2);
02246 
02247         <font class="keywordflow">return</font> (ret);
02248       }
02249     <font class="keywordflow">case</font> <font class="charliteral">'-'</font>:
02250       <font class="keywordflow">return</font> sRef_undefined;
02251     <font class="keywordflow">case</font> <font class="charliteral">'u'</font>:
02252       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02253     <font class="keywordflow">case</font> <font class="charliteral">'x'</font>:
02254       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
02255     <font class="keywordflow">default</font>:
02256       <a class="code" href="llerror_c.html#a48">llfatalerror</a> (message (<font class="stringliteral">"sRef_undump: bad line: %s"</font>, cstring_fromChars (*c)));
02257     }
02258   BADEXIT;
02259 }
02260 
02261 <font class="comment">/*@only@*/</font> cstring
<a name="l02262"></a><a class="code" href="sRef_c.html#a117">02262</a> <a class="code" href="sRef_c.html#a117">sRef_dump</a> (sRef s)<font class="keyword"></font>
02263 <font class="keyword"></font>{
02264   <font class="keywordflow">if</font> (sRef_isInvalid (s))
02265     {
02266       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"-"</font>));
02267     }
02268   <font class="keywordflow">else</font>
02269     {
02270       <font class="keywordflow">switch</font> (s-&gt;kind)
02271         {
02272         <font class="keywordflow">case</font> SK_PARAM:
02273           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"p%d"</font>, s-&gt;info-&gt;paramno));
02274         <font class="keywordflow">case</font> SK_ARRAYFETCH:
02275           <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
02276             {
02277               <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"a%d%q"</font>, s-&gt;info-&gt;arrayfetch-&gt;ind,
02278                                sRef_dump (s-&gt;info-&gt;arrayfetch-&gt;arr)));
02279             }
02280           <font class="keywordflow">else</font>
02281             {
02282               <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"a%q"</font>, sRef_dump (s-&gt;info-&gt;arrayfetch-&gt;arr)));
02283             }
02284         <font class="keywordflow">case</font> SK_FIELD:
02285           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"f%s.%q"</font>, s-&gt;info-&gt;field-&gt;field, 
02286                            sRef_dump (s-&gt;info-&gt;field-&gt;rec)));
02287         <font class="keywordflow">case</font> SK_PTR:
02288           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"t%q"</font>, sRef_dump (s-&gt;info-&gt;ref)));
02289         <font class="keywordflow">case</font> SK_ADR:
02290           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"d%q"</font>, sRef_dump (s-&gt;info-&gt;ref)));
02291         <font class="keywordflow">case</font> SK_OBJECT:
02292           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"o%q"</font>, ctype_dump (s-&gt;info-&gt;object)));
02293         <font class="keywordflow">case</font> SK_SPECIAL:
02294           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"s%d"</font>, (<font class="keywordtype">int</font>) s-&gt;info-&gt;spec));
02295         <font class="keywordflow">case</font> SK_CONJ:
02296           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"c%q.%q"</font>,
02297                            sRef_dump (s-&gt;info-&gt;conj-&gt;a),
02298                            <a class="code" href="sRef_c.html#a117">sRef_dump</a> (s-&gt;info-&gt;conj-&gt;b)));
02299         <font class="keywordflow">case</font> SK_CVAR:
02300           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
02301             {
02302               <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"g%d"</font>, 
02303                                usymtab_convertId (s-&gt;info-&gt;cvar-&gt;index)));
02304             }
02305           <font class="keywordflow">else</font>
02306             {
02307               llcontbug (message (<font class="stringliteral">"Dumping local variable: %q"</font>,
02308                                   sRef_unparseDebug (s)));
02309               <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"u"</font>));
02310             }
02311         <font class="keywordflow">case</font> SK_UNKNOWN:
02312           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"u"</font>));
02313         <font class="keywordflow">case</font> SK_RESULT:
02314           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"r%q"</font>, ctype_dump (s-&gt;type)));
02315         <font class="keywordflow">case</font> SK_TYPE:
02316         <font class="keywordflow">case</font> SK_CONST:
02317         <font class="keywordflow">case</font> SK_EXTERNAL:
02318         <font class="keywordflow">case</font> SK_DERIVED:
02319         <font class="keywordflow">case</font> SK_NEW:
02320         <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02321           llcontbug (message (<font class="stringliteral">"sRef_dump: bad kind: %q"</font>,
02322                               sRef_unparseFull (s)));
02323           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"x"</font>));
02324         }
02325     }
02326      
02327   BADEXIT;
02328 }
02329 
<a name="l02330"></a><a class="code" href="sRef_c.html#a118">02330</a> cstring <a class="code" href="sRef_c.html#a118">sRef_dumpGlobal</a> (sRef s)<font class="keyword"></font>
02331 <font class="keyword"></font>{
02332   <font class="keywordflow">if</font> (sRef_isInvalid (s))
02333     {
02334       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"-"</font>));
02335     }
02336   <font class="keywordflow">else</font>
02337     {
02338       <font class="keywordflow">switch</font> (s-&gt;kind)
02339         {
02340         <font class="keywordflow">case</font> SK_CVAR:
02341           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
02342             {
02343               <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"g%d@%d@%d"</font>, 
02344                                usymtab_convertId (s-&gt;info-&gt;cvar-&gt;index),
02345                                (<font class="keywordtype">int</font>) s-&gt;defstate,
02346                                (<font class="keywordtype">int</font>) s-&gt;nullstate));
02347             }
02348           <font class="keywordflow">else</font>
02349             {
02350               llcontbug (message (<font class="stringliteral">"Dumping local variable: %q"</font>,
02351                                   sRef_unparseDebug (s)));
02352               <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"u"</font>));
02353             }
02354         <font class="keywordflow">case</font> SK_UNKNOWN:
02355           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"u"</font>));
02356         <font class="keywordflow">case</font> SK_SPECIAL:
02357           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"s%d"</font>, (<font class="keywordtype">int</font>) s-&gt;info-&gt;spec));
02358         <font class="keywordflow">default</font>:
02359           llcontbug (message (<font class="stringliteral">"sRef_dumpGlobal: bad kind: %q"</font>,
02360                               sRef_unparseFull (s)));
02361           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"x"</font>));
02362         }
02363     }
02364      
02365   BADEXIT;
02366 }
02367 
02368 ctype
<a name="l02369"></a><a class="code" href="sRef_c.html#a119">02369</a> <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (sRef s, uentryList cl)<font class="keyword"></font>
02370 <font class="keyword"></font>{
02371   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> ctype_unknown;
02372 
02373   <font class="keywordflow">switch</font> (s-&gt;kind)
02374     {
02375     <font class="keywordflow">case</font> SK_CVAR:
02376       <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a197">uentry_getType</a> (usymtab_getRefQuiet (s-&gt;info-&gt;cvar-&gt;lexlevel, 
02377                                               s-&gt;info-&gt;cvar-&gt;index)));
02378     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02379       <font class="keywordflow">return</font> (ctype_unknown);
02380     <font class="keywordflow">case</font> SK_PARAM:
02381       <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a197">uentry_getType</a> (uentryList_getN (cl, s-&gt;info-&gt;paramno));
02382     <font class="keywordflow">case</font> SK_ARRAYFETCH:
02383       {
02384         ctype ca = <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, cl);
02385         
02386         <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ca))
02387           {
02388             <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (ca));
02389           }
02390         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ctype_isUnknown (ca))
02391           {
02392             <font class="keywordflow">return</font> (ca);
02393           }
02394         <font class="keywordflow">else</font>
02395           {
02396             llcontbuglit (<font class="stringliteral">"sRef_deriveType: inconsistent array type"</font>);
02397             <font class="keywordflow">return</font> ca;
02398           }
02399       }
02400     <font class="keywordflow">case</font> SK_FIELD:
02401       {
02402         ctype ct = <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;field-&gt;rec, cl);
02403         
02404         <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (ct))
02405           {
02406             uentry ue = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (ct), 
02407                                                s-&gt;info-&gt;field-&gt;field);
02408             
02409             <font class="keywordflow">if</font> (uentry_isValid (ue))
02410               {
02411                 <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue));
02412               }
02413             <font class="keywordflow">else</font>
02414               {
02415                 llcontbuglit (<font class="stringliteral">"sRef_deriveType: bad field"</font>);
02416                 <font class="keywordflow">return</font> ctype_unknown;
02417               }
02418           }
02419         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ctype_isUnknown (ct))
02420           {
02421             <font class="keywordflow">return</font> (ct);
02422           }
02423         <font class="keywordflow">else</font>
02424           {
02425             llcontbuglit (<font class="stringliteral">"sRef_deriveType: inconsistent field type"</font>);
02426             <font class="keywordflow">return</font> (ct);
02427           }
02428       }
02429     <font class="keywordflow">case</font> SK_PTR:
02430       {
02431         ctype ct = <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;ref, cl);
02432         
02433         <font class="keywordflow">if</font> (ctype_isUnknown (ct)) <font class="keywordflow">return</font> ct;
02434         <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct)) <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (ct));
02435         <font class="keywordflow">else</font>
02436           {
02437             llcontbuglit (<font class="stringliteral">"sRef_deriveType: inconsistent pointer type"</font>);
02438             <font class="keywordflow">return</font> (ct);
02439           }
02440       }
02441     <font class="keywordflow">case</font> SK_ADR:
02442       {
02443         ctype ct = <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;ref, cl);
02444         
02445         <font class="keywordflow">if</font> (ctype_isUnknown (ct)) <font class="keywordflow">return</font> ct;
02446         <font class="keywordflow">return</font> <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ct);
02447       }
02448     <font class="keywordflow">case</font> SK_DERIVED:
02449       {
02450         <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;ref, cl);
02451       }
02452     <font class="keywordflow">case</font> SK_OBJECT:
02453       {
02454         <font class="keywordflow">return</font> (s-&gt;info-&gt;object);
02455       }
02456     <font class="keywordflow">case</font> SK_CONJ:
02457       {
02458         <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (sRef_deriveType (s-&gt;info-&gt;conj-&gt;a, cl),
02459                                <a class="code" href="sRef_c.html#a119">sRef_deriveType</a> (s-&gt;info-&gt;conj-&gt;b, cl)));
02460       }
02461     <font class="keywordflow">case</font> SK_RESULT:
02462     <font class="keywordflow">case</font> SK_CONST:
02463     <font class="keywordflow">case</font> SK_TYPE:
02464       {
02465         <font class="keywordflow">return</font> (s-&gt;type);
02466       }
02467     <font class="keywordflow">case</font> SK_SPECIAL:
02468     <font class="keywordflow">case</font> SK_UNKNOWN:
02469     <font class="keywordflow">case</font> SK_EXTERNAL:
02470     <font class="keywordflow">case</font> SK_NEW:
02471       <font class="keywordflow">return</font> ctype_unknown;
02472     }
02473   BADEXIT;
02474 }
02475 
02476 ctype
<a name="l02477"></a><a class="code" href="sRef_c.html#a120">02477</a> <a class="code" href="sRef_c.html#a120">sRef_getType</a> (sRef s)<font class="keyword"></font>
02478 <font class="keyword"></font>{
02479   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> ctype_unknown;
02480   <font class="keywordflow">return</font> s-&gt;type;
02481 }
02482 
02483 
02484 <font class="comment">/*@only@*/</font> cstring
<a name="l02485"></a><a class="code" href="sRef_c.html#a121">02485</a> <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (sRef s)<font class="keyword"></font>
02486 <font class="keyword"></font>{
02487   sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
02488 
02489   <font class="keywordflow">if</font> (sRef_isMeaningful (rb) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (rb))
02490     {
02491       cstring ret = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s);
02492       
02493       llassertprint (!cstring_equalLit (ret, <font class="stringliteral">"?"</font>), (<font class="stringliteral">"print: %s"</font>, <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s)));
02494 
02495       <font class="keywordflow">if</font> (!cstring_isEmpty (ret))
02496         {
02497           <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a37">cstring_appendChar</a> (ret, <font class="charliteral">' '</font>));
02498         }
02499       <font class="keywordflow">else</font>
02500         {
02501           <font class="keywordflow">return</font> ret;
02502         }
02503     }
02504 
02505   <font class="keywordflow">return</font> cstring_undefined;
02506 }
02507 
02508 cstring
<a name="l02509"></a><a class="code" href="sRef_c.html#a122">02509</a> <a class="code" href="sRef_c.html#a122">sRef_unparsePreOpt</a> (sRef s)<font class="keyword"></font>
02510 <font class="keyword"></font>{
02511   sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
02512 
02513   <font class="keywordflow">if</font> (sRef_isMeaningful (rb) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (rb))
02514     {
02515       cstring ret = <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s);
02516       
02517       llassertprint (!cstring_equalLit (ret, <font class="stringliteral">"?"</font>), (<font class="stringliteral">"print: %s"</font>, <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s)));
02518       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a43">cstring_prependCharO</a> (<font class="charliteral">' '</font>, ret));
02519     }
02520 
02521   <font class="keywordflow">return</font> cstring_undefined;
02522 }
02523 
02524 <font class="comment">/*@only@*/</font> cstring
<a name="l02525"></a><a class="code" href="sRef_c.html#a123">02525</a> <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef s)<font class="keyword"></font>
02526 <font class="keyword"></font>{
02527   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"?"</font>));
02528 
02529   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
02530     {
02531       <font class="keywordflow">return</font> (sRef_unparseWithArgs (s, context_getParams ()));
02532     }
02533   <font class="keywordflow">else</font>
02534     {
02535       <font class="keywordflow">return</font> (sRef_unparseNoArgs (s));
02536     }
02537 }
02538 
02539 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
02540 sRef_unparseWithArgs (sRef s, uentryList args)<font class="keyword"></font>
02541 <font class="keyword"></font>{
02542   <font class="keywordflow">if</font> (sRef_isInvalid (s))
02543     {
02544       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"?"</font>));
02545     }
02546 
02547   <font class="keywordflow">switch</font> (s-&gt;kind)
02548     {
02549     <font class="keywordflow">case</font> SK_CVAR:
02550       <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a195">uentry_getName</a> (usymtab_getRefQuiet (s-&gt;info-&gt;cvar-&gt;lexlevel,
02551                                                    s-&gt;info-&gt;cvar-&gt;index)));
02552     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02553       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (s-&gt;info-&gt;fname));
02554     <font class="keywordflow">case</font> SK_PARAM:
02555       {
02556         <font class="keywordflow">if</font> (s-&gt;info-&gt;paramno &lt; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (args))
02557           {
02558             uentry ue = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (args, s-&gt;info-&gt;paramno);
02559             
02560             <font class="keywordflow">if</font> (uentry_isValid (ue))
02561               <font class="keywordflow">return</font> <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue);
02562           }
02563 
02564         <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;bad param: %q / args %q"</font>,
02565                          sRef_unparseDebug (s),
02566                          <a class="code" href="uentryList_c.html#a5">uentryList_unparse</a> (args)));
02567       }
02568     <font class="keywordflow">case</font> SK_ARRAYFETCH:
02569       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
02570         {
02571           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[%d]"</font>, sRef_unparseWithArgs (s-&gt;info-&gt;arrayfetch-&gt;arr, args),
02572                                 s-&gt;info-&gt;arrayfetch-&gt;ind));
02573         }
02574       <font class="keywordflow">else</font>
02575         {
02576           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[]"</font>, sRef_unparseWithArgs (s-&gt;info-&gt;arrayfetch-&gt;arr, args)));
02577         }
02578     <font class="keywordflow">case</font> SK_FIELD:
02579       <font class="keywordflow">if</font> (s-&gt;info-&gt;field-&gt;rec-&gt;kind == SK_PTR)
02580         {
02581           sRef ptr = s-&gt;info-&gt;field-&gt;rec;
02582 
02583           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q-&gt;%s"</font>, sRef_unparseWithArgs (ptr-&gt;info-&gt;ref, args),
02584                            s-&gt;info-&gt;field-&gt;field));       
02585         }
02586       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q.%s"</font>, sRef_unparseWithArgs (s-&gt;info-&gt;field-&gt;rec, args),
02587                        s-&gt;info-&gt;field-&gt;field));
02588 
02589     <font class="keywordflow">case</font> SK_PTR:
02590       {
02591         sRef ref = sRef_fixConj (s-&gt;info-&gt;ref);
02592         skind sk = ref-&gt;kind;
02593         cstring ret;
02594 
02595         <font class="keywordflow">if</font> (sk == SK_NEW)
02596           {
02597             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"storage pointed to by %q"</font>,
02598                            sRef_unparseWithArgs (ref, args));
02599           }
02600         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (skind_isSimple (sk) || sk == SK_PTR)
02601           {
02602             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"*%q"</font>, sRef_unparseWithArgs (ref, args));
02603           }
02604         <font class="keywordflow">else</font>
02605           {
02606             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"*(%q)"</font>, sRef_unparseWithArgs (ref, args));
02607           }
02608 
02609         <font class="keywordflow">return</font> ret;
02610       }
02611     <font class="keywordflow">case</font> SK_ADR:
02612       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&amp;%q"</font>, sRef_unparseWithArgs (s-&gt;info-&gt;ref, args)));
02613     <font class="keywordflow">case</font> SK_OBJECT:
02614       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (s-&gt;info-&gt;object)));
02615     <font class="keywordflow">case</font> SK_CONJ:
02616       <font class="keywordflow">return</font> (sRef_unparseWithArgs (sRef_getConjA (s), args));
02617     <font class="keywordflow">case</font> SK_NEW:
02618       <font class="keywordflow">if</font> (cstring_isDefined (s-&gt;info-&gt;fname))
02619         {
02620           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[result of %s]"</font>, s-&gt;info-&gt;fname));
02621         }
02622       <font class="keywordflow">else</font>
02623         {
02624           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;new&gt;"</font>));
02625         }
02626     <font class="keywordflow">case</font> SK_UNKNOWN:
02627       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"?"</font>));
02628     <font class="keywordflow">case</font> SK_DERIVED:
02629       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;derived %q&gt;"</font>, sRef_unparse (s-&gt;info-&gt;ref)));
02630     <font class="keywordflow">case</font> SK_EXTERNAL:
02631       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;external %q&gt;"</font>, sRef_unparse (s-&gt;info-&gt;ref)));
02632     <font class="keywordflow">case</font> SK_TYPE:
02633       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;type %s&gt;"</font>, ctype_unparse (s-&gt;type)));
02634     <font class="keywordflow">case</font> SK_CONST:
02635       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;const %s&gt;"</font>, ctype_unparse (s-&gt;type)));
02636     <font class="keywordflow">case</font> SK_SPECIAL:
02637       <font class="keywordflow">return</font> (cstring_makeLiteral
02638               (s-&gt;info-&gt;spec == SR_NOTHING ? <font class="stringliteral">"nothing"</font>
02639                : s-&gt;info-&gt;spec == SR_INTERNAL ? <font class="stringliteral">"internal state"</font>
02640                : s-&gt;info-&gt;spec == SR_SPECSTATE ? <font class="stringliteral">"spec state"</font>
02641                : s-&gt;info-&gt;spec == SR_SYSTEM ? <font class="stringliteral">"file system state"</font>
02642                : <font class="stringliteral">"&lt;spec error&gt;"</font>));
02643     <font class="keywordflow">case</font> SK_RESULT:
02644       <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"result"</font>);
02645     <font class="keywordflow">default</font>:
02646       {
02647         llbug (message (<font class="stringliteral">"Bad sref, kind = %d"</font>, (<font class="keywordtype">int</font>) s-&gt;kind));
02648       }
02649     }
02650 
02651   BADEXIT;
02652 }
02653 
02654 <font class="comment">/*@only@*/</font> cstring
<a name="l02655"></a><a class="code" href="sRef_c.html#a124">02655</a> <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (sRef s)<font class="keyword"></font>
02656 <font class="keyword"></font>{
02657   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;undef&gt;"</font>));
02658 
02659   <font class="keywordflow">switch</font> (s-&gt;kind)
02660     {
02661     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02662       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;unconstrained %s&gt;"</font>, s-&gt;info-&gt;fname));
02663     <font class="keywordflow">case</font> SK_CVAR:
02664       {
02665         uentry ce;
02666 
02667         ce = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s-&gt;info-&gt;cvar-&gt;lexlevel, s-&gt;info-&gt;cvar-&gt;index);
02668 
02669         <font class="keywordflow">if</font> (uentry_isInvalid (ce))
02670           {
02671             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;scope: %d.%d *invalid*&gt;"</font>, 
02672                              s-&gt;info-&gt;cvar-&gt;lexlevel,
02673                              s-&gt;info-&gt;cvar-&gt;index));
02674           }
02675         <font class="keywordflow">else</font>
02676           {
02677             <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;scope: %d.%d *%q*&gt;"</font>, 
02678                              s-&gt;info-&gt;cvar-&gt;lexlevel,
02679                              s-&gt;info-&gt;cvar-&gt;index,
02680                              uentry_getName (ce)));
02681           }
02682 
02683       }
02684     <font class="keywordflow">case</font> SK_PARAM:
02685       {
02686         <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;parameter %d&gt;"</font>, s-&gt;info-&gt;paramno + 1));
02687       }
02688     <font class="keywordflow">case</font> SK_ARRAYFETCH:
02689       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
02690         {
02691           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[%d]"</font>, sRef_unparseDebug (s-&gt;info-&gt;arrayfetch-&gt;arr),
02692                            s-&gt;info-&gt;arrayfetch-&gt;ind));
02693         }
02694       <font class="keywordflow">else</font>
02695         {
02696           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[]"</font>, sRef_unparseDebug (s-&gt;info-&gt;arrayfetch-&gt;arr)));
02697         }
02698     <font class="keywordflow">case</font> SK_FIELD:
02699       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q.%s"</font>, sRef_unparseDebug (s-&gt;info-&gt;field-&gt;rec),
02700                        s-&gt;info-&gt;field-&gt;field));
02701     <font class="keywordflow">case</font> SK_PTR:
02702       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"*(%q)"</font>, sRef_unparseDebug (s-&gt;info-&gt;ref)));
02703     <font class="keywordflow">case</font> SK_ADR:
02704       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&amp;%q"</font>, sRef_unparseDebug (s-&gt;info-&gt;ref)));
02705     <font class="keywordflow">case</font> SK_OBJECT:
02706       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;object type %s&gt;"</font>, ctype_unparse (s-&gt;info-&gt;object)));
02707     <font class="keywordflow">case</font> SK_CONJ:
02708       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q | %q"</font>, sRef_unparseDebug (s-&gt;info-&gt;conj-&gt;a),
02709                        <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s-&gt;info-&gt;conj-&gt;b)));
02710     <font class="keywordflow">case</font> SK_NEW:
02711       <font class="keywordflow">return</font> <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;new: %s&gt;"</font>, s-&gt;info-&gt;fname);
02712     <font class="keywordflow">case</font> SK_DERIVED:
02713       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;derived %q&gt;"</font>, sRef_unparseDebug (s-&gt;info-&gt;ref)));
02714     <font class="keywordflow">case</font> SK_EXTERNAL:
02715       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;external %q&gt;"</font>, sRef_unparseDebug (s-&gt;info-&gt;ref)));
02716     <font class="keywordflow">case</font> SK_TYPE:
02717       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;type %s&gt;"</font>, ctype_unparse (s-&gt;type)));
02718     <font class="keywordflow">case</font> SK_CONST:
02719       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;const %s&gt;"</font>, ctype_unparse (s-&gt;type)));
02720     <font class="keywordflow">case</font> SK_RESULT:
02721       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;result %s&gt;"</font>, ctype_unparse (s-&gt;type)));
02722     <font class="keywordflow">case</font> SK_SPECIAL:
02723       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;spec %s&gt;"</font>,
02724                        cstring_makeLiteralTemp
02725                        (s-&gt;info-&gt;spec == SR_NOTHING ? "nothing"
02726                         : s-&gt;info-&gt;spec == SR_INTERNAL ? "internalState"
02727                         : s-&gt;info-&gt;spec == SR_SPECSTATE ? "spec state"
02728                         : s-&gt;info-&gt;spec == SR_SYSTEM ? "fileSystem"
02729                         : "error")));
02730     <font class="keywordflow">case</font> SK_UNKNOWN:
02731       <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"&lt;unknown&gt;"</font>);
02732     }
02733 
02734   BADEXIT;
02735 }
02736 
02737 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
02738 sRef_unparseNoArgs (sRef s)<font class="keyword"></font>
02739 <font class="keyword"></font>{
02740   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"?"</font>));
02741 
02742   <font class="keywordflow">switch</font> (s-&gt;kind)
02743     {
02744     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
02745       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (s-&gt;info-&gt;fname));
02746     <font class="keywordflow">case</font> SK_CVAR:
02747       {
02748         uentry ce = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s-&gt;info-&gt;cvar-&gt;lexlevel, 
02749                                          s-&gt;info-&gt;cvar-&gt;index);
02750 
02751         <font class="keywordflow">if</font> (uentry_isInvalid (ce))
02752           {
02753             llcontbug (message (<font class="stringliteral">"sRef_unparseNoArgs: bad cvar: %q"</font>, sRef_unparseDebug (s)));
02754             <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s)); 
02755           }
02756         <font class="keywordflow">else</font>
02757           {
02758             <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a195">uentry_getName</a> (ce));
02759           }
02760       }
02761     <font class="keywordflow">case</font> SK_ARRAYFETCH:
02762       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
02763         {
02764           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[%d]"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;arrayfetch-&gt;arr),
02765                            s-&gt;info-&gt;arrayfetch-&gt;ind));
02766         }
02767       <font class="keywordflow">else</font>
02768         {
02769           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q[]"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;arrayfetch-&gt;arr)));
02770         }
02771     <font class="keywordflow">case</font> SK_FIELD:
02772       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q.%s"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;field-&gt;rec),
02773                        s-&gt;info-&gt;field-&gt;field));
02774     <font class="keywordflow">case</font> SK_PTR:
02775       {
02776         sRef ref = sRef_fixConj (s-&gt;info-&gt;ref);
02777         skind sk = ref-&gt;kind;
02778         cstring ret;
02779 
02780         <font class="keywordflow">if</font> (skind_isSimple (sk) || sk == SK_PTR)
02781           {
02782             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"*%q"</font>, sRef_unparseNoArgs (ref));
02783           }
02784         <font class="keywordflow">else</font>
02785           {
02786             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"*(%q)"</font>, sRef_unparseNoArgs (ref));
02787           }
02788 
02789         <font class="keywordflow">return</font> (ret);
02790       }
02791     <font class="keywordflow">case</font> SK_ADR:
02792       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&amp;%q"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;ref)));
02793     <font class="keywordflow">case</font> SK_OBJECT:
02794       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (ctype_unparse (s-&gt;info-&gt;object)));
02795     <font class="keywordflow">case</font> SK_CONJ:
02796       <font class="keywordflow">return</font> (sRef_unparseNoArgs (s-&gt;info-&gt;conj-&gt;a));
02797     <font class="keywordflow">case</font> SK_NEW:
02798       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"result of %s"</font>, s-&gt;info-&gt;fname));
02799     <font class="keywordflow">case</font> SK_DERIVED:
02800       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;der %q&gt;"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;ref)));
02801     <font class="keywordflow">case</font> SK_EXTERNAL:
02802       <font class="keywordflow">return</font> <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;ext %q&gt;"</font>, sRef_unparseNoArgs (s-&gt;info-&gt;ref));
02803     <font class="keywordflow">case</font> SK_SPECIAL:
02804       <font class="keywordflow">return</font> (cstring_makeLiteral
02805               (s-&gt;info-&gt;spec == SR_NOTHING ? <font class="stringliteral">"nothing"</font>
02806                : s-&gt;info-&gt;spec == SR_INTERNAL ? <font class="stringliteral">"internal state"</font>
02807                : s-&gt;info-&gt;spec == SR_SPECSTATE ? <font class="stringliteral">"spec state"</font>
02808                : s-&gt;info-&gt;spec == SR_SYSTEM ? <font class="stringliteral">"file system state"</font>
02809                : <font class="stringliteral">"&lt;spec error&gt;"</font>));
02810     <font class="keywordflow">case</font> SK_RESULT:
02811       <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"result"</font>);
02812     <font class="keywordflow">case</font> SK_CONST:
02813     <font class="keywordflow">case</font> SK_TYPE:
02814     <font class="keywordflow">case</font> SK_UNKNOWN:
02815       <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"?"</font>);
02816     <font class="keywordflow">case</font> SK_PARAM:
02817       <font class="comment">/* llcontbug (message ("sRef_unparseNoArgs: bad case: %q", sRef_unparseDebug (s))); */</font>
02818       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s));
02819     }
02820   BADEXIT;
02821 }
02822 
<a name="l02823"></a><a class="code" href="sRef_c.html#a125">02823</a> <font class="comment">/*@dependent@*/</font> sRef <a class="code" href="sRef_c.html#a125">sRef_makeUnconstrained</a> (cstring fname)<font class="keyword"></font>
02824 <font class="keyword"></font>{
02825   sRef s = sRef_new ();
02826 
02827   s-&gt;kind = SK_UNCONSTRAINED;
02828   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
02829   s-&gt;info-&gt;fname = fname;
02830 
02831   <font class="keywordflow">return</font> (s);
02832 }
02833 
<a name="l02834"></a><a class="code" href="sRef_c.html#a126">02834</a> cstring <a class="code" href="sRef_c.html#a126">sRef_unconstrainedName</a> (sRef s)<font class="keyword"></font>
02835 <font class="keyword"></font>{
02836   llassert (sRef_isUnconstrained (s));
02837 
02838   <font class="keywordflow">return</font> s-&gt;info-&gt;fname;
02839 }
02840 
<a name="l02841"></a><a class="code" href="sRef_c.html#a127">02841</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (sRef s)<font class="keyword"> </font>
02842 <font class="keyword"></font>{
02843   <font class="keywordflow">return</font> (sRef_isValid(s) &amp;&amp; s-&gt;kind == SK_UNCONSTRAINED);
02844 }
02845 
02846 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> <font class="comment">/*@notnull@*/</font> sRef 
02847   sRef_makeCvarAux (<font class="keywordtype">int</font> level, usymId index, ctype ct)<font class="keyword"></font>
02848 <font class="keyword"></font>{
02849   sRef s = sRef_new ();
02850 
02851     s-&gt;kind = SK_CVAR;
02852   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
02853 
02854   s-&gt;info-&gt;cvar = (cref) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info-&gt;cvar));
02855   s-&gt;info-&gt;cvar-&gt;lexlevel = level;
02856   s-&gt;info-&gt;cvar-&gt;index = index;
02857 
02858   <font class="comment">/* for now, all globals are defined; all locals, aren't */</font>
02859 
02860   <font class="keywordflow">if</font> (level &lt;= fileScope)
02861     {
02862       s-&gt;defstate = SS_UNKNOWN;
02863     }
02864   <font class="keywordflow">else</font> 
02865     {
02866       ctype rct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
02867 
02868       <font class="keywordflow">if</font> (level != paramsScope
02869           &amp;&amp; (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (rct) || <a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (rct)))
02870         {
02871           s-&gt;defstate = SS_ALLOCATED; 
02872           s-&gt;oaliaskind = s-&gt;aliaskind = AK_STACK;
02873         }
02874       <font class="keywordflow">else</font>
02875         {
02876           s-&gt;defstate = SS_UNDEFINED;
02877           s-&gt;oaliaskind = s-&gt;aliaskind = AK_LOCAL;
02878         }
02879     }
02880 
02881   s-&gt;type = ct;
02882 
02883   llassert (level &gt;= globScope);
02884   llassert (usymId_isValid (index));
02885 
02886   <font class="keywordflow">return</font> s;
02887 }
02888 
<a name="l02889"></a><a class="code" href="sRef_c.html#a129">02889</a> <font class="comment">/*@dependent@*/</font> sRef <a class="code" href="sRef_c.html#a129">sRef_makeCvar</a> (<font class="keywordtype">int</font> level, usymId index, ctype ct)<font class="keyword"></font>
02890 <font class="keyword"></font>{
02891   <font class="keywordflow">return</font> (sRef_makeCvarAux (level, index, ct));
02892 }
02893 
<a name="l02894"></a><a class="code" href="sRef_c.html#a130">02894</a> <font class="keywordtype">int</font> <a class="code" href="sRef_c.html#a130">sRef_lexLevel</a> (sRef s)<font class="keyword"></font>
02895 <font class="keyword"></font>{
02896   <font class="keywordflow">if</font> (sRef_isValid (s))
02897     {
02898       sRef conj;
02899 
02900       conj = sRef_fixConj (s);
02901       s = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (conj);
02902       
02903       <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; s-&gt;kind == SK_CVAR)
02904         {
02905           <font class="keywordflow">return</font> (s-&gt;info-&gt;cvar-&gt;lexlevel);
02906         }
02907     }
02908 
02909   <font class="keywordflow">return</font> globScope;
02910 }
02911 
02912 sRef
<a name="l02913"></a><a class="code" href="sRef_c.html#a131">02913</a> <a class="code" href="sRef_c.html#a131">sRef_makeGlobal</a> (usymId l, ctype ct)<font class="keyword"></font>
02914 <font class="keyword"></font>{
02915   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a129">sRef_makeCvar</a> (globScope, l, ct));
02916 }
02917 
02918 <font class="keywordtype">void</font>
<a name="l02919"></a><a class="code" href="sRef_c.html#a132">02919</a> <a class="code" href="sRef_c.html#a132">sRef_setParamNo</a> (sRef s, <font class="keywordtype">int</font> l)<font class="keyword"></font>
02920 <font class="keyword"></font>{
02921   llassert (sRef_isValid (s) &amp;&amp; s-&gt;kind == SK_PARAM);
02922   s-&gt;info-&gt;paramno = l;
02923 }
02924 
02925 <font class="comment">/*@dependent@*/</font> sRef
<a name="l02926"></a><a class="code" href="sRef_c.html#a133">02926</a> <a class="code" href="sRef_c.html#a133">sRef_makeParam</a> (<font class="keywordtype">int</font> l, ctype ct)<font class="keyword"></font>
02927 <font class="keyword"></font>{
02928   sRef s = sRef_new ();
02929 
02930   s-&gt;kind = SK_PARAM;
02931   s-&gt;type = ct;
02932 
02933   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
02934   s-&gt;info-&gt;paramno = l; 
02935   s-&gt;defstate = SS_UNKNOWN; <font class="comment">/* (probably defined, unless its an out parameter) */</font>
02936 
02937   <font class="keywordflow">return</font> s;
02938 }
02939 
02940 <font class="keywordtype">bool</font>
<a name="l02941"></a><a class="code" href="sRef_c.html#a134">02941</a> <a class="code" href="sRef_c.html#a134">sRef_isIndexKnown</a> (sRef arr)<font class="keyword"></font>
02942 <font class="keyword"></font>{
02943   <font class="keywordtype">bool</font> res;
02944 
02945   llassert (sRef_isValid (arr));
02946   arr = sRef_fixConj (arr);
02947   
02948   llassert (arr-&gt;kind == SK_ARRAYFETCH);  
02949   res = arr-&gt;info-&gt;arrayfetch-&gt;indknown;
02950   <font class="keywordflow">return</font> (res);
02951 }
02952 
02953 <font class="keywordtype">int</font>
<a name="l02954"></a><a class="code" href="sRef_c.html#a135">02954</a> <a class="code" href="sRef_c.html#a135">sRef_getIndex</a> (sRef arr)<font class="keyword"></font>
02955 <font class="keyword"></font>{
02956   <font class="keywordtype">int</font> result;
02957 
02958   llassert (sRef_isValid (arr));
02959   arr = sRef_fixConj (arr);
02960 
02961   llassert (arr-&gt;kind == SK_ARRAYFETCH);  
02962 
02963   <font class="keywordflow">if</font> (!arr-&gt;info-&gt;arrayfetch-&gt;indknown)
02964     {
02965       llcontbug (message (<font class="stringliteral">"sRef_getIndex: unknown: %q"</font>, sRef_unparse (arr)));
02966       result = 0; 
02967     }
02968   <font class="keywordflow">else</font>
02969     {
02970       result = arr-&gt;info-&gt;arrayfetch-&gt;ind;
02971     }
02972 
02973   <font class="keywordflow">return</font> result;
02974 }
02975 
02976 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isZerothArrayFetch (<font class="comment">/*@notnull@*/</font> sRef s)<font class="keyword"></font>
02977 <font class="keyword"></font>{
02978   <font class="keywordflow">return</font> (s-&gt;kind == SK_ARRAYFETCH
02979           &amp;&amp; s-&gt;info-&gt;arrayfetch-&gt;indknown
02980           &amp;&amp; (s-&gt;info-&gt;arrayfetch-&gt;ind == 0));
02981 }
02982 
<a name="l02983"></a><a class="code" href="sRef_c.html#a137">02983</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (<font class="comment">/*@exposed@*/</font> sRef t)<font class="keyword"></font>
02984 <font class="keyword"></font>{
02985   
02986   <font class="keywordflow">if</font> (sRef_isInvalid (t)) <font class="keywordflow">return</font> sRef_undefined;
02987 
02988   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (t))
02989     {
02990       <font class="keywordflow">return</font> (t-&gt;info-&gt;ref);
02991     }
02992   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isZerothArrayFetch (t))
02993     {
02994       <font class="keywordflow">return</font> (t-&gt;info-&gt;arrayfetch-&gt;arr);
02995     }
02996   <font class="keywordflow">else</font>
02997     {
02998       sRef s = sRef_new ();
02999       
03000       s-&gt;kind = SK_ADR;
03001       s-&gt;type = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (t-&gt;type);
03002       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
03003       s-&gt;info-&gt;ref = t;
03004       
03005       <font class="keywordflow">if</font> (t-&gt;defstate == SS_UNDEFINED) 
03006         <font class="comment">/* no! it is allocated even still: &amp;&amp; !ctype_isPointer (t-&gt;type)) */</font>
03007         {
03008           s-&gt;defstate = SS_ALLOCATED;
03009         }
03010       <font class="keywordflow">else</font>
03011         {
03012           s-&gt;defstate = t-&gt;defstate;
03013         }
03014 
03015       <font class="keywordflow">if</font> (t-&gt;aliaskind == AK_LOCAL)
03016         {
03017           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (t))
03018             {
03019               s-&gt;aliaskind = AK_STACK;
03020             }
03021         }
03022 
03023       <font class="keywordflow">return</font> s;
03024     }
03025 }
03026 
<a name="l03027"></a><a class="code" href="sRef_c.html#a138">03027</a> cstring <a class="code" href="sRef_c.html#a138">sRef_getField</a> (sRef s)<font class="keyword"></font>
03028 <font class="keyword"></font>{
03029   cstring res;
03030 
03031   llassert (sRef_isValid (s));
03032   s = sRef_fixConj (s);
03033 
03034   llassertprint (sRef_isValid (s) &amp;&amp; (s-&gt;kind == SK_FIELD),
03035                  (<font class="stringliteral">"s = %s"</font>, <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s)));
03036 
03037   res = s-&gt;info-&gt;field-&gt;field;
03038   <font class="keywordflow">return</font> (res);
03039 }
03040 
<a name="l03041"></a><a class="code" href="sRef_c.html#a139">03041</a> sRef <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (sRef s)<font class="keyword"></font>
03042 <font class="keyword"></font>{
03043   sRef res;
03044 
03045   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (sRef_undefined);
03046 
03047   s = sRef_fixConj (s);
03048 
03049   <font class="keywordflow">switch</font> (s-&gt;kind)
03050     {
03051     <font class="keywordflow">case</font> SK_ADR:
03052     <font class="keywordflow">case</font> SK_PTR:
03053     <font class="keywordflow">case</font> SK_DERIVED:
03054     <font class="keywordflow">case</font> SK_EXTERNAL:
03055       res = s-&gt;info-&gt;ref;
03056       <font class="keywordflow">break</font>;
03057     <font class="keywordflow">case</font> SK_FIELD:
03058       res = s-&gt;info-&gt;field-&gt;rec;
03059       <font class="keywordflow">break</font>;
03060 
03061     <font class="keywordflow">case</font> SK_ARRAYFETCH:
03062       res = s-&gt;info-&gt;arrayfetch-&gt;arr;
03063       <font class="keywordflow">break</font>;
03064 
03065     <font class="keywordflow">default</font>:
03066       res = sRef_undefined; <font class="comment">/* shouldn't need it */</font>
03067     }
03068 
03069   <font class="keywordflow">return</font> (res);
03070 }
03071 
03072 <font class="comment">/*</font>
03073 <font class="comment">** same as getBase, except returns invalid</font>
03074 <font class="comment">** (and doesn't use adr's)                   </font>
03075 <font class="comment">*/</font>
03076 
03077 sRef
<a name="l03078"></a><a class="code" href="sRef_c.html#a140">03078</a> <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (sRef s)<font class="keyword"></font>
03079 <font class="keyword"></font>{
03080   sRef res;
03081 
03082   <font class="keywordflow">if</font> (sRef_isInvalid (s)) { <font class="keywordflow">return</font> sRef_undefined; }
03083 
03084   s = sRef_fixConj (s);
03085 
03086   <font class="keywordflow">switch</font> (s-&gt;kind)
03087     {
03088     <font class="keywordflow">case</font> SK_PTR:
03089             res = s-&gt;info-&gt;ref; 
03090       <font class="keywordflow">break</font>;
03091     <font class="keywordflow">case</font> SK_FIELD:
03092             res = s-&gt;info-&gt;field-&gt;rec; <font class="keywordflow">break</font>;
03093     <font class="keywordflow">case</font> SK_ARRAYFETCH:
03094             res = s-&gt;info-&gt;arrayfetch-&gt;arr; 
03095       <font class="keywordflow">break</font>;
03096     <font class="keywordflow">default</font>:
03097       res = sRef_undefined; <font class="keywordflow">break</font>;
03098     }
03099 
03100   <font class="keywordflow">return</font> res;
03101 }
03102 
03103 <font class="comment">/*@constant int MAXBASEDEPTH;@*/</font>
<a name="l03104"></a><a class="code" href="sRef_c.html#a3">03104</a> <font class="preprocessor"># define MAXBASEDEPTH 25</font>
03105 <font class="preprocessor"></font>
03106 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef 
03107 sRef_getRootBaseAux (sRef s, <font class="keywordtype">int</font> depth)<font class="keyword"></font>
03108 <font class="keyword"></font>{
03109   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> sRef_undefined;
03110 
03111   <font class="keywordflow">if</font> (depth &gt; MAXBASEDEPTH)
03112     {
03113       <a class="code" href="llerror_c.html#a33">llgenmsg</a> (message 
03114                 (<font class="stringliteral">"Warning: reference base limit exceeded for %q. "</font>
03115                  <font class="stringliteral">"This either means there is a variable with at least "</font>
03116                  <font class="stringliteral">"%d indirections from this reference, or "</font>
03117                  <font class="stringliteral">"there is a bug in LCLint."</font>,
03118                  sRef_unparse (s),
03119                  MAXBASEDEPTH),
03120                 g_currentloc);
03121 
03122       <font class="keywordflow">return</font> sRef_undefined;
03123     }
03124 
03125   <font class="keywordflow">switch</font> (s-&gt;kind)
03126     {
03127     <font class="keywordflow">case</font> SK_ADR:
03128     <font class="keywordflow">case</font> SK_PTR:
03129       <font class="keywordflow">return</font> (sRef_getRootBaseAux (s-&gt;info-&gt;ref, depth + 1));
03130     <font class="keywordflow">case</font> SK_FIELD:
03131       <font class="keywordflow">return</font> (sRef_getRootBaseAux (s-&gt;info-&gt;field-&gt;rec, depth + 1));
03132     <font class="keywordflow">case</font> SK_ARRAYFETCH:
03133       <font class="keywordflow">return</font> (sRef_getRootBaseAux (s-&gt;info-&gt;arrayfetch-&gt;arr, depth + 1));
03134     <font class="keywordflow">case</font> SK_CONJ:
03135       <font class="keywordflow">return</font> (sRef_getRootBaseAux (sRef_fixConj (s), depth + 1));
03136     <font class="keywordflow">default</font>:
03137       <font class="keywordflow">return</font> s;
03138     }
03139 }
03140 
<a name="l03141"></a><a class="code" href="sRef_c.html#a142">03141</a> sRef <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sRef s)<font class="keyword"></font>
03142 <font class="keyword"></font>{
03143   <font class="keywordflow">return</font> (sRef_getRootBaseAux (s, 0));
03144 }
03145 
03146 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isDeep (sRef s)<font class="keyword"></font>
03147 <font class="keyword"></font>{
03148   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> FALSE;
03149   
03150   <font class="keywordflow">switch</font> (s-&gt;kind)
03151     {
03152     <font class="keywordflow">case</font> SK_ADR:
03153     <font class="keywordflow">case</font> SK_PTR:
03154     <font class="keywordflow">case</font> SK_FIELD:
03155     <font class="keywordflow">case</font> SK_ARRAYFETCH:
03156       <font class="keywordflow">return</font> TRUE;
03157     <font class="keywordflow">case</font> SK_CONJ:
03158       <font class="keywordflow">return</font> (sRef_isDeep (sRef_fixConj (s)));
03159     <font class="keywordflow">default</font>:
03160       <font class="keywordflow">return</font> FALSE;
03161     }
03162 }
03163 
03164 <font class="keyword">static</font> <font class="keywordtype">int</font> sRef_depth (sRef s)<font class="keyword"></font>
03165 <font class="keyword"></font>{
03166   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> 0;
03167   
03168   <font class="keywordflow">switch</font> (s-&gt;kind)
03169     {
03170     <font class="keywordflow">case</font> SK_ADR:
03171     <font class="keywordflow">case</font> SK_PTR:
03172     <font class="keywordflow">case</font> SK_DERIVED:
03173     <font class="keywordflow">case</font> SK_EXTERNAL:
03174       <font class="keywordflow">return</font> 1 + sRef_depth (s-&gt;info-&gt;ref);
03175     <font class="keywordflow">case</font> SK_FIELD:
03176       <font class="keywordflow">return</font> 1 + sRef_depth (s-&gt;info-&gt;field-&gt;rec);
03177     <font class="keywordflow">case</font> SK_ARRAYFETCH:
03178       <font class="keywordflow">return</font> 1 + sRef_depth (s-&gt;info-&gt;arrayfetch-&gt;arr);
03179     <font class="keywordflow">case</font> SK_CONJ:
03180       <font class="keywordflow">return</font> (sRef_depth (sRef_fixConj (s)));
03181     <font class="keywordflow">default</font>:
03182       <font class="keywordflow">return</font> 1;
03183     }
03184 }
03185 
03186 sRef
<a name="l03187"></a><a class="code" href="sRef_c.html#a144">03187</a> <a class="code" href="sRef_c.html#a144">sRef_makeObject</a> (ctype o)<font class="keyword"></font>
03188 <font class="keyword"></font>{
03189   sRef s = sRef_new ();
03190 
03191   s-&gt;kind = SK_OBJECT;
03192   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
03193   s-&gt;info-&gt;object = o;
03194   <font class="keywordflow">return</font> s;
03195 }
03196 
<a name="l03197"></a><a class="code" href="sRef_c.html#a145">03197</a> sRef <a class="code" href="sRef_c.html#a145">sRef_makeExternal</a> (<font class="comment">/*@exposed@*/</font> sRef t)<font class="keyword"></font>
03198 <font class="keyword"></font>{
03199   sRef s = sRef_new ();
03200 
03201   llassert (sRef_isValid (t));
03202 
03203   s-&gt;kind = SK_EXTERNAL;
03204   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
03205   s-&gt;type = t-&gt;type;
03206   s-&gt;info-&gt;ref = t;
03207   <font class="keywordflow">return</font> s;
03208 }
03209 
<a name="l03210"></a><a class="code" href="sRef_c.html#a146">03210</a> sRef <a class="code" href="sRef_c.html#a146">sRef_makeDerived</a> (<font class="comment">/*@exposed@*/</font> sRef t)<font class="keyword"></font>
03211 <font class="keyword"></font>{
03212   <font class="keywordflow">if</font> (sRef_isValid (t))
03213     {
03214       sRef s = sRef_new ();
03215       
03216       s-&gt;kind = SK_DERIVED;
03217       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
03218       s-&gt;info-&gt;ref = t;
03219       
03220       s-&gt;type = t-&gt;type;
03221       <font class="keywordflow">return</font> s;
03222     }
03223   <font class="keywordflow">else</font>
03224     {
03225       <font class="keywordflow">return</font> sRef_undefined;
03226     }
03227 }
03228 
03229 <font class="comment">/*</font>
03230 <font class="comment">** definitely NOT symmetric:</font>
03231 <font class="comment">**</font>
03232 <font class="comment">**   res fills in unknown state information from other</font>
03233 <font class="comment">*/</font>
03234 
03235 <font class="keywordtype">void</font>
<a name="l03236"></a><a class="code" href="sRef_c.html#a147">03236</a> <a class="code" href="sRef_c.html#a147">sRef_mergeStateQuiet</a> (sRef res, sRef other)<font class="keyword"></font>
03237 <font class="keyword"></font>{
03238   llassert (sRef_isValid (res));
03239   llassert (sRef_isValid (other));
03240 
03241   res-&gt;modified = res-&gt;modified || other-&gt;modified;
03242   res-&gt;safe = res-&gt;safe &amp;&amp; other-&gt;safe;
03243 
03244   <font class="keywordflow">if</font> (res-&gt;defstate == SS_UNKNOWN) 
03245     {
03246       res-&gt;defstate = other-&gt;defstate;
03247       res-&gt;definfo = alinfo_update (res-&gt;definfo, other-&gt;definfo);
03248     }
03249 
03250   <font class="keywordflow">if</font> (res-&gt;aliaskind == AK_UNKNOWN || 
03251       (res-&gt;aliaskind == AK_LOCAL &amp;&amp; alkind_isKnown (other-&gt;aliaskind)))
03252     {
03253       res-&gt;aliaskind = other-&gt;aliaskind;
03254       res-&gt;oaliaskind = other-&gt;oaliaskind;
03255       res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
03256     }
03257 
03258   <font class="keywordflow">if</font> (res-&gt;expkind == XO_UNKNOWN)
03259     {
03260       res-&gt;expkind = other-&gt;expkind;
03261       res-&gt;oexpkind = other-&gt;oexpkind;
03262       res-&gt;expinfo = alinfo_update (res-&gt;expinfo, other-&gt;expinfo);
03263     }
03264   
03265   <font class="comment">/* out takes precedence over implicitly defined */</font>
03266   <font class="keywordflow">if</font> (res-&gt;defstate == SS_DEFINED &amp;&amp; other-&gt;defstate != SS_UNKNOWN) 
03267     {
03268       res-&gt;defstate = other-&gt;defstate;
03269       res-&gt;definfo = alinfo_update (res-&gt;definfo, other-&gt;definfo);
03270     }
03271 
03272   <font class="keywordflow">if</font> (other-&gt;nullstate == NS_ERROR || res-&gt;nullstate == NS_ERROR) 
03273     {
03274       res-&gt;nullstate = NS_ERROR;
03275     }
03276   <font class="keywordflow">else</font>
03277     {
03278       <font class="keywordflow">if</font> (other-&gt;nullstate != NS_UNKNOWN 
03279           &amp;&amp; (res-&gt;nullstate == NS_UNKNOWN || res-&gt;nullstate == NS_NOTNULL 
03280               || res-&gt;nullstate == NS_MNOTNULL))
03281         {
03282           res-&gt;nullstate = other-&gt;nullstate;
03283           res-&gt;nullinfo = alinfo_update (res-&gt;nullinfo, other-&gt;nullinfo);
03284         }
03285     }
03286 }
03287 
03288 <font class="comment">/*</font>
03289 <font class="comment">** definitely NOT symmetric:</font>
03290 <font class="comment">**</font>
03291 <font class="comment">**   res fills in known state information from other</font>
03292 <font class="comment">*/</font>
03293 
03294 <font class="keywordtype">void</font>
<a name="l03295"></a><a class="code" href="sRef_c.html#a148">03295</a> <a class="code" href="sRef_c.html#a148">sRef_mergeStateQuietReverse</a> (sRef res, sRef other)<font class="keyword"></font>
03296 <font class="keyword"></font>{
03297   <font class="keywordtype">bool</font> changed = FALSE;
03298 
03299   llassert (sRef_isValid (res));
03300   llassert (sRef_isValid (other));
03301 
03302   <font class="keywordflow">if</font> (res-&gt;kind != other-&gt;kind)
03303     {
03304       changed = TRUE;
03305 
03306       sinfo_free (res);
03307 
03308       res-&gt;kind = other-&gt;kind;
03309       res-&gt;type = other-&gt;type;
03310       res-&gt;info = sinfo_fullCopy (other);
03311     }
03312   <font class="keywordflow">else</font>
03313     {
03314       <font class="keywordflow">if</font> (!ctype_equal (res-&gt;type, other-&gt;type))
03315         {
03316           changed = TRUE;
03317           res-&gt;type = other-&gt;type;
03318         }
03319       
03320       sinfo_update (res, other);
03321     }
03322 
03323   res-&gt;modified = res-&gt;modified || other-&gt;modified;
03324   res-&gt;safe = res-&gt;safe &amp;&amp; other-&gt;safe;
03325 
03326   <font class="keywordflow">if</font> (res-&gt;aliaskind != other-&gt;aliaskind
03327       &amp;&amp; (res-&gt;aliaskind == AK_UNKNOWN
03328           || ((res-&gt;aliaskind == AK_LOCAL 
03329                || (res-&gt;aliaskind == AK_REFCOUNTED
03330                    &amp;&amp; other-&gt;aliaskind != AK_LOCAL))
03331               &amp;&amp; other-&gt;aliaskind != AK_UNKNOWN)))
03332     {
03333       changed = TRUE;
03334       res-&gt;aliaskind = other-&gt;aliaskind;
03335       res-&gt;oaliaskind = other-&gt;oaliaskind;
03336       res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
03337           }
03338 
03339   <font class="keywordflow">if</font> (other-&gt;expkind != XO_UNKNOWN &amp;&amp; other-&gt;expkind != res-&gt;expkind)
03340     {
03341       changed = TRUE;
03342       res-&gt;expkind = other-&gt;expkind;
03343       res-&gt;expinfo = alinfo_update (res-&gt;expinfo, other-&gt;expinfo);
03344     }
03345 
03346   <font class="keywordflow">if</font> (other-&gt;oexpkind != XO_UNKNOWN)
03347     {
03348       res-&gt;oexpkind = other-&gt;oexpkind;
03349     }
03350 
03351   <font class="comment">/* out takes precedence over implicitly defined */</font>
03352 
03353   <font class="keywordflow">if</font> (res-&gt;defstate != other-&gt;defstate)
03354     {
03355       <font class="keywordflow">if</font> (other-&gt;defstate != SS_UNKNOWN)
03356         {
03357           res-&gt;defstate = other-&gt;defstate;
03358         }
03359     }
03360 
03361   <font class="keywordflow">if</font> (other-&gt;nullstate == NS_ERROR || res-&gt;nullstate == NS_ERROR)
03362     {
03363       <font class="keywordflow">if</font> (res-&gt;nullstate != NS_ERROR)
03364         {
03365           res-&gt;nullstate = NS_ERROR;
03366           changed = TRUE;
03367         }
03368     }
03369   <font class="keywordflow">else</font>
03370     {
03371       <font class="keywordflow">if</font> (other-&gt;nullstate != NS_UNKNOWN &amp;&amp; other-&gt;nullstate != res-&gt;nullstate)
03372         {
03373           changed = TRUE;
03374           res-&gt;nullstate = other-&gt;nullstate;
03375           res-&gt;nullinfo = alinfo_update (res-&gt;nullinfo, other-&gt;nullinfo);
03376         }
03377     }
03378 
03379   <font class="keywordflow">if</font> (changed)
03380     {
03381       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res); 
03382     }
03383 }
03384 
03385 <font class="keywordtype">void</font> 
<a name="l03386"></a><a class="code" href="sRef_c.html#a149">03386</a> <a class="code" href="sRef_c.html#a149">sRef_mergeState</a> (sRef res, sRef other, clause cl, fileloc loc)<font class="keyword"></font>
03387 <font class="keyword"></font>{
03388   <font class="keywordflow">if</font> (sRef_isValid (res) &amp;&amp; sRef_isValid (other))
03389     {
03390       sRef_mergeStateAux (res, other, cl, FALSE, loc, TRUE);
03391     }
03392   <font class="keywordflow">else</font>
03393     {
03394       <font class="keywordflow">if</font> (sRef_isInvalid (res))
03395         {
03396           llbug (message (<font class="stringliteral">"sRef_mergeState: invalid res sRef: %q"</font>, 
03397                           sRef_unparseDebug (other)));
03398         }
03399       <font class="keywordflow">else</font> 
03400         {
03401           llbug (message (<font class="stringliteral">"sRef_mergeState: invalid other sRef: %q"</font>, 
03402                           sRef_unparseDebug (res)));
03403         }
03404     }
03405 }
03406 
03407 <font class="keywordtype">void</font> 
<a name="l03408"></a><a class="code" href="sRef_c.html#a150">03408</a> <a class="code" href="sRef_c.html#a150">sRef_mergeOptState</a> (sRef res, sRef other, clause cl, fileloc loc)<font class="keyword"></font>
03409 <font class="keyword"></font>{
03410   <font class="keywordflow">if</font> (sRef_isValid (res) &amp;&amp; sRef_isValid (other))
03411     {
03412       sRef_mergeStateAux (res, other, cl, TRUE, loc, TRUE);
03413     }
03414   <font class="keywordflow">else</font>
03415     {
03416       <font class="keywordflow">if</font> (sRef_isInvalid (res))
03417         {
03418           llbug (message (<font class="stringliteral">"sRef_mergeOptState: invalid res sRef: %q"</font>, 
03419                           sRef_unparseDebug (other)));
03420         }
03421       <font class="keywordflow">else</font> 
03422         {
03423           llbug (message (<font class="stringliteral">"sRef_mergeOptState: invalid other sRef: %q"</font>, 
03424                           sRef_unparseDebug (res)));
03425         }
03426     }
03427 }
03428 
03429 <font class="keyword">static</font> <font class="keywordtype">void</font>
03430 sRef_mergeStateAux (<font class="comment">/*@notnull@*/</font> sRef res, <font class="comment">/*@notnull@*/</font> sRef other, 
03431                     clause cl, <font class="keywordtype">bool</font> opt, fileloc loc,
03432                     <font class="keywordtype">bool</font> doDerivs)
03433    <font class="comment">/*@modifies res@*/</font> 
03434 {
03435   llassertfatal (sRef_isValid (res));
03436   llassertfatal (sRef_isValid (other));
03437   
03438   res-&gt;modified = res-&gt;modified || other-&gt;modified;
03439 
03440   <font class="keywordflow">if</font> (res-&gt;kind == other-&gt;kind 
03441       || (other-&gt;kind == SK_UNKNOWN || res-&gt;kind == SK_UNKNOWN))
03442     {
03443       sstate odef = other-&gt;defstate;
03444       sstate rdef = res-&gt;defstate;
03445       nstate onull = other-&gt;nullstate;
03446       
03447       <font class="comment">/*</font>
03448 <font class="comment">      ** yucky stuff to handle </font>
03449 <font class="comment">      **</font>
03450 <font class="comment">      **   if (s) free (s);</font>
03451 <font class="comment">      */</font>
03452 
03453       <font class="keywordflow">if</font> (other-&gt;defstate == SS_DEAD 
03454           &amp;&amp; ((<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (res) &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (res))
03455               || (res-&gt;defstate == SS_UNDEFINED
03456                   || res-&gt;defstate == SS_UNUSEABLE)))
03457         {
03458           <font class="keywordflow">if</font> (res-&gt;defstate == SS_UNDEFINED
03459               || res-&gt;defstate == SS_UNUSEABLE)
03460             {
03461               res-&gt;defstate = SS_UNUSEABLE;
03462             }
03463           <font class="keywordflow">else</font>
03464             {
03465               res-&gt;defstate = SS_DEAD;
03466             }
03467 
03468           res-&gt;definfo = alinfo_update (res-&gt;definfo, other-&gt;definfo);
03469           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (other);
03470           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res);
03471         }
03472       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (res-&gt;defstate == SS_DEAD 
03473                &amp;&amp; ((<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (other) &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (other))
03474                    || (other-&gt;defstate == SS_UNDEFINED
03475                        || other-&gt;defstate == SS_UNUSEABLE)))
03476         {
03477           <font class="keywordflow">if</font> (other-&gt;defstate == SS_UNDEFINED
03478               || other-&gt;defstate == SS_UNUSEABLE)
03479             {
03480               res-&gt;defstate = SS_UNUSEABLE;
03481             }
03482           <font class="keywordflow">else</font>
03483             {
03484               res-&gt;defstate = SS_DEAD;
03485             }
03486           
03487           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (other);
03488           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res);
03489         }
03490       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (res-&gt;defstate == SS_DEFINED 
03491                &amp;&amp; (other-&gt;defstate == SS_ALLOCATED 
03492                    &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (other)))
03493         {
03494           other-&gt;defstate = SS_DEFINED; <font class="comment">/* definitely null! */</font>
03495         }
03496       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (other-&gt;defstate == SS_DEFINED
03497                &amp;&amp; (res-&gt;defstate == SS_ALLOCATED &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (res)))
03498         {
03499           res-&gt;defstate = SS_DEFINED;
03500           res-&gt;definfo = alinfo_update (res-&gt;definfo, other-&gt;definfo);
03501         }
03502       <font class="keywordflow">else</font>
03503         {
03504           ; <font class="comment">/* okay */</font>
03505         }
03506 
03507       <font class="keywordflow">if</font> (res-&gt;defstate == SS_DEAD &amp;&amp; other-&gt;defstate == SS_DEAD)
03508         {
03509           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (other);
03510           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res);
03511         }
03512 
03513       <font class="comment">/*</font>
03514 <font class="comment">      ** only &amp; dead isn't really an only!</font>
03515 <font class="comment">      */</font>
03516 
03517       <font class="keywordflow">if</font> (alkind_isOnly (other-&gt;aliaskind) &amp;&amp; other-&gt;defstate == SS_DEAD)
03518         {
03519           other-&gt;aliaskind = AK_UNKNOWN;
03520         }
03521 
03522       <font class="keywordflow">if</font> (alkind_isOnly (res-&gt;aliaskind) &amp;&amp; res-&gt;defstate == SS_DEAD)
03523         {
03524           res-&gt;aliaskind = AK_UNKNOWN;
03525         }
03526 
03527       <font class="comment">/*</font>
03528 <font class="comment">      ** Dead and dependent -&gt; dead</font>
03529 <font class="comment">      */</font>
03530       
03531       <font class="keywordflow">if</font> (alkind_isDependent (other-&gt;aliaskind) &amp;&amp; res-&gt;defstate == SS_DEAD)
03532         {
03533           other-&gt;aliaskind = AK_UNKNOWN;
03534           other-&gt;defstate = SS_DEAD;
03535           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res);
03536           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (other);
03537                 }
03538 
03539       <font class="keywordflow">if</font> (alkind_isDependent (res-&gt;aliaskind) &amp;&amp; other-&gt;defstate == SS_DEAD)
03540         {
03541           res-&gt;aliaskind = AK_UNKNOWN;
03542           res-&gt;defstate = SS_DEAD;
03543           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (res);
03544           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (other);
03545         }
03546 
03547       <font class="comment">/*</font>
03548 <font class="comment">      ** must do alias combine first, since it depends on </font>
03549 <font class="comment">      ** original values of state and null.</font>
03550 <font class="comment">      */</font>
03551 
03552       sRef_combineAliasKinds (res, other, cl, loc);
03553       sRef_combineDefState (res, other);
03554       sRef_combineNullState (res, other);
03555 
03556       <font class="keywordflow">if</font> (rdef == SS_ALLOCATED || rdef == SS_SPECIAL)
03557         {
03558           <font class="keywordflow">if</font> (odef == SS_DEFINED)
03559             {
03560               <font class="keywordflow">if</font> (onull == NS_DEFNULL || onull == NS_CONSTNULL)
03561                 {
03562                   res-&gt;deriv = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (res-&gt;deriv, other-&gt;deriv);
03563                 }
03564 
03565                               ; 
03566             }
03567           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (odef == SS_ALLOCATED
03568                    || odef == SS_SPECIAL)
03569             {
03570               
03571               <font class="keywordflow">if</font> (doDerivs)
03572                 {
03573                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ctype_realType (sRef_getType (res))))
03574                     {
03575                       res-&gt;deriv = sRef_mergeUnionDerivs (res-&gt;deriv, 
03576                                                           other-&gt;deriv, 
03577                                                           opt, cl, loc);
03578                     }
03579                   <font class="keywordflow">else</font>
03580                     {
03581                                       res-&gt;deriv = sRef_mergeDerivs (res-&gt;deriv, other-&gt;deriv, 
03582                                                      opt, cl, loc);
03583                     }
03584                 }
03585             }
03586           <font class="keywordflow">else</font>
03587             {
03588               <font class="keywordflow">if</font> (doDerivs)
03589                 {
03590                                   res-&gt;deriv = sRef_mergeDerivs (res-&gt;deriv, other-&gt;deriv, 
03591                                                  opt, cl, loc);
03592                 }
03593               <font class="keywordflow">else</font>
03594                 {
03595                                 }
03596             }
03597         }
03598       <font class="keywordflow">else</font>
03599         {
03600           <font class="keywordflow">if</font> (rdef == SS_PDEFINED
03601               || (rdef == SS_DEFINED &amp;&amp; odef == SS_PDEFINED))
03602             {
03603               <font class="keywordflow">if</font> (doDerivs)
03604                 {
03605                                   res-&gt;deriv = sRef_mergePdefinedDerivs (res-&gt;deriv, other-&gt;deriv, 
03606                                                          opt, cl, loc);
03607                 }
03608             }
03609           <font class="keywordflow">else</font>
03610             {
03611               <font class="keywordflow">if</font> ((rdef == SS_DEFINED  || rdef == SS_UNKNOWN)
03612                   &amp;&amp; res-&gt;defstate == SS_ALLOCATED)
03613                 {
03614                                   res-&gt;deriv = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (res-&gt;deriv, other-&gt;deriv);
03615                 }
03616               <font class="keywordflow">else</font>
03617                 {
03618                   <font class="keywordflow">if</font> (doDerivs)
03619                     {
03620                                       res-&gt;deriv = sRef_mergeDerivs (res-&gt;deriv, other-&gt;deriv, 
03621                                                      opt, cl, loc);
03622                     }
03623                 }
03624             }
03625         }
03626 
03627       
03628       sRef_combineExKinds (res, other);
03629     }
03630   <font class="keywordflow">else</font>
03631     {
03632       <font class="keywordflow">if</font> (res-&gt;kind == SK_ARRAYFETCH &amp;&amp; other-&gt;kind == SK_PTR)
03633         {
03634           sRef nother = <a class="code" href="sRef_c.html#a265">sRef_buildArrayFetchKnown</a> (sRef_getBase (other), 0);
03635 
03636           <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (nother, other);
03637           sRef_mergeStateAux (res, nother, cl, opt, loc, doDerivs);
03638         }
03639       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (res-&gt;kind == SK_PTR &amp;&amp; other-&gt;kind == SK_ARRAYFETCH)
03640         {
03641           sRef nother = <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (sRef_getBase (other));
03642 
03643           <font class="keywordflow">if</font> (sRef_isValid (nother))
03644             {
03645               <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (nother, other);
03646               sRef_mergeStateAux (res, nother, cl, opt, loc, doDerivs);
03647             }
03648         }
03649       <font class="keywordflow">else</font>
03650         {
03651           llcontbug (message (<font class="stringliteral">"merge conj: %q / %q"</font>, sRef_unparseFull (res), 
03652                               <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (other)));
03653           
03654         }
03655     }
03656   
03657   }
03658 
03659 <font class="keyword">static</font> sRefSet
03660 sRef_mergeUnionDerivs (<font class="comment">/*@only@*/</font> sRefSet res, 
03661                        <font class="comment">/*@exposed@*/</font> sRefSet other, <font class="keywordtype">bool</font> opt,
03662                        clause cl, fileloc loc)<font class="keyword"></font>
03663 <font class="keyword"></font>{
03664   <font class="keywordflow">if</font> (sRefSet_isEmpty (res))
03665     {
03666       <font class="keywordflow">return</font> <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (res, other);
03667     }
03668   <font class="keywordflow">else</font>
03669     {
03670       sRefSet_allElements (other, el)<font class="keyword"></font>
03671 <font class="keyword">        </font>{
03672           <font class="keywordflow">if</font> (sRef_isValid (el))
03673             {
03674               sRef e2 = <a class="code" href="sRefSet_c.html#a33">sRefSet_lookupMember</a> (other, el);
03675               
03676               <font class="keywordflow">if</font> (sRef_isValid (e2))
03677                 {
03678                   sRef_mergeStateAux (el, e2, cl, opt, loc, FALSE);
03679                 }
03680               <font class="keywordflow">else</font>
03681                 {
03682                   res = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (res, el);
03683                 }
03684             }
03685         } end_sRefSet_allElements ;
03686 
03687       <font class="keywordflow">return</font> res;
03688     }
03689 }
03690 
03691 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> sRefSet
03692 sRef_mergeDerivs (<font class="comment">/*@only@*/</font> sRefSet res, sRefSet other, 
03693                   <font class="keywordtype">bool</font> opt, clause cl, fileloc loc)<font class="keyword"></font>
03694 <font class="keyword"></font>{
03695   sRefSet ret = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
03696   
03697     
03698   sRefSet_allElements (res, el)<font class="keyword"></font>
03699 <font class="keyword">    </font>{
03700       <font class="keywordflow">if</font> (sRef_isValid (el))
03701         {
03702           sRef e2 = <a class="code" href="sRefSet_c.html#a33">sRefSet_lookupMember</a> (other, el);
03703 
03704           <font class="keywordflow">if</font> (sRef_isValid (e2))
03705             {
03706               <font class="keywordflow">if</font> (el-&gt;defstate == SS_ALLOCATED &amp;&amp;
03707                   e2-&gt;defstate == SS_PDEFINED)
03708                 {
03709                   e2-&gt;defstate = SS_ALLOCATED;
03710                 }
03711               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e2-&gt;defstate == SS_ALLOCATED &amp;&amp;
03712                        el-&gt;defstate == SS_PDEFINED)
03713                 {
03714                   el-&gt;defstate = SS_ALLOCATED;
03715                   <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (el);
03716                 }
03717               <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((el-&gt;defstate == SS_DEAD || sRef_isKept (el)) &amp;&amp;
03718                        (e2-&gt;defstate == SS_DEFINED &amp;&amp; !sRef_isKept (e2)))
03719                 {
03720                   
03721                   <font class="keywordflow">if</font> (checkDeadState (el, TRUE, loc))
03722                     {
03723                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (el))
03724                         {
03725                           <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (el, loc);
03726                           <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (e2, loc);
03727                         }
03728                     }
03729                 }
03730               <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((e2-&gt;defstate == SS_DEAD || sRef_isKept (e2)) &amp;&amp;
03731                        (el-&gt;defstate == SS_DEFINED &amp;&amp; !sRef_isKept (el)))
03732                 {
03733                   
03734                   <font class="keywordflow">if</font> (checkDeadState (e2, FALSE, loc))
03735                     {
03736                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (el))
03737                         {
03738                           <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (el, loc);
03739                           <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (e2, loc);
03740                         }
03741                     }
03742                 }
03743               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (el-&gt;defstate == SS_DEFINED &amp;&amp;
03744                        e2-&gt;defstate == SS_PDEFINED)
03745                 {
03746                   el-&gt;defstate = SS_PDEFINED;
03747                 }
03748               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e2-&gt;defstate == SS_DEFINED &amp;&amp;
03749                        el-&gt;defstate == SS_PDEFINED)
03750                 {
03751                   e2-&gt;defstate = SS_PDEFINED;
03752                 }
03753               <font class="keywordflow">else</font>
03754                 {
03755                   ; <font class="comment">/* okay */</font>
03756                 }
03757 
03758               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ctype_realType (sRef_getType (el))))
03759                 {
03760                   el-&gt;deriv = sRef_mergeUnionDerivs (el-&gt;deriv, e2-&gt;deriv, 
03761                                                      opt, cl, loc); 
03762                 }
03763               <font class="keywordflow">else</font>
03764                 {
03765                   el-&gt;deriv = sRef_mergeDerivs (el-&gt;deriv, e2-&gt;deriv, opt, cl, loc); 
03766                 }
03767               
03768               <font class="keywordflow">if</font> (sRef_equivalent (el, e2))
03769                 {
03770                                   ret = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (ret, el);
03771                 }
03772               <font class="keywordflow">else</font>
03773                 {
03774                   sRef sr = sRef_leastCommon (el, e2);
03775 
03776                   <font class="keywordflow">if</font> (sRef_isValid (sr))
03777                     {
03778                       ret = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (ret, sr);
03779                     }
03780                   <font class="keywordflow">else</font>
03781                     {
03782                       ;
03783                     }
03784                 }
03785               
03786               (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a7">sRefSet_delete</a> (other, e2);
03787             }
03788           <font class="keywordflow">else</font> <font class="comment">/* not defined */</font>
03789             {
03790                       (<font class="keywordtype">void</font>) checkDeadState (el, TRUE, loc);
03791             }
03792         }
03793     } end_sRefSet_allElements;
03794 
03795   sRefSet_allElements (other, el)<font class="keyword"></font>
03796 <font class="keyword">    </font>{
03797       <font class="keywordflow">if</font> (sRef_isValid (el))
03798         {
03799           (<font class="keywordtype">void</font>) checkDeadState (el, FALSE, loc);
03800         }
03801     } end_sRefSet_allElements;
03802   
03803   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (res); 
03804   <font class="keywordflow">return</font> (ret);
03805 }
03806 
03807 <font class="comment">/*</font>
03808 <font class="comment">** Returns TRUE is there is an error.</font>
03809 <font class="comment">*/</font>
03810 
03811 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkDeadState (<font class="comment">/*@notnull@*/</font> sRef el, <font class="keywordtype">bool</font> tbranch, fileloc loc)<font class="keyword"></font>
03812 <font class="keyword"></font>{
03813   <font class="comment">/*</font>
03814 <font class="comment">  ** usymtab_isGuarded --- the utab should still be in the</font>
03815 <font class="comment">  ** state of the alternate branch.</font>
03816 <font class="comment">  **</font>
03817 <font class="comment">  ** tbranch TRUE means el is released in the last branch, e.g.</font>
03818 <font class="comment">  **     if (x != NULL) { ; } else { sfree (x); }</font>
03819 <font class="comment">  ** so, if x is null in the other branch no error is reported.</font>
03820 <font class="comment">  **</font>
03821 <font class="comment">  ** tbranch FALSE means this is the other branch:</font>
03822 <font class="comment">  **     if (x != NULL) { sfree (x); } else { ; }</font>
03823 <font class="comment">  ** so, if x is null in this branch there is no error.</font>
03824 <font class="comment">  */</font>
03825 
03826   
03827   <font class="keywordflow">if</font> ((<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (el) || sRef_isKept (el))
03828       &amp;&amp; !sRef_isDeepUnionField (el) &amp;&amp; !<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (el))
03829     {
03830        
03831       <font class="keywordflow">if</font> (!tbranch)
03832         {
03833           <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a147">usymtab_isProbableDeepNull</a> (el))
03834             {
03835                       <font class="keywordflow">return</font> TRUE;
03836             }
03837         }
03838       <font class="keywordflow">else</font>
03839         {
03840           <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a37">usymtab_isAltProbablyDeepNull</a> (el))
03841             {
03842                       <font class="keywordflow">return</font> TRUE;
03843             }
03844         }
03845 
03846       <font class="keywordflow">if</font> (optgenerror
03847           (FLG_BRANCHSTATE,
03848            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %q is %q in one path, but live in another."</font>,
03849                     sRef_unparse (el),
03850                     cstring_makeLiteral (sRef_isKept (el) 
03851                                          ? <font class="stringliteral">"kept"</font> : <font class="stringliteral">"released"</font>)),
03852            loc))
03853         {
03854                   
03855           <font class="keywordflow">if</font> (sRef_isKept (el))
03856             {
03857               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (el);      
03858             }
03859           <font class="keywordflow">else</font>
03860             {
03861               <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (el);
03862             }
03863 
03864           <font class="comment">/* prevent further errors */</font>
03865           el-&gt;defstate = SS_UNKNOWN; 
03866           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (el, AK_ERROR, fileloc_undefined);
03867           
03868           <font class="keywordflow">return</font> FALSE;
03869         }
03870     }
03871 
03872   <font class="keywordflow">return</font> TRUE;
03873 }
03874 
03875 <font class="keyword">static</font> <font class="keywordtype">void</font> 
03876 checkDerivDeadState (<font class="comment">/*@notnull@*/</font> sRef el, <font class="keywordtype">bool</font> tbranch, fileloc loc)<font class="keyword"></font>
03877 <font class="keyword"></font>{
03878   
03879   <font class="keywordflow">if</font> (checkDeadState (el, tbranch, loc))
03880     {
03881       sRefSet_allElements (el-&gt;deriv, t)<font class="keyword"></font>
03882 <font class="keyword">        </font>{
03883           <font class="keywordflow">if</font> (sRef_isValid (t))
03884             {
03885                       checkDerivDeadState (t, tbranch, loc);
03886             }
03887         } end_sRefSet_allElements;
03888     }
03889 }
03890 
03891 <font class="keyword">static</font> sRefSet
03892   sRef_mergePdefinedDerivs (sRefSet res, sRefSet other, <font class="keywordtype">bool</font> opt, 
03893                             clause cl, fileloc loc)<font class="keyword"></font>
03894 <font class="keyword"></font>{
03895   sRefSet ret = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
03896 
03897   sRefSet_allElements (res, el)<font class="keyword"></font>
03898 <font class="keyword">    </font>{
03899       <font class="keywordflow">if</font> (sRef_isValid (el))
03900         {
03901           sRef e2 = <a class="code" href="sRefSet_c.html#a33">sRefSet_lookupMember</a> (other, el);
03902           
03903           <font class="keywordflow">if</font> (sRef_isValid (e2))
03904             {
03905               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (el) &amp;&amp; !<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (e2))
03906                 {
03907                   ;
03908                 }
03909               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (e2) &amp;&amp; !<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (el))
03910                 {
03911                   el-&gt;deriv = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (el-&gt;deriv, e2-&gt;deriv); 
03912                 }
03913               <font class="keywordflow">else</font>
03914                 {
03915                   el-&gt;deriv = sRef_mergePdefinedDerivs (el-&gt;deriv, e2-&gt;deriv, 
03916                                                         opt, cl, loc);
03917                 }
03918 
03919               sRef_mergeStateAux (el, e2, cl, opt, loc, FALSE);
03920               
03921               ret = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (ret, el);
03922               (<font class="keywordtype">void</font>) <a class="code" href="sRefSet_c.html#a7">sRefSet_delete</a> (other, e2);
03923             }
03924           <font class="keywordflow">else</font>
03925             {
03926               <font class="keywordflow">if</font> (!opt)
03927                 {
03928                                   checkDerivDeadState (el, (cl == FALSECLAUSE), loc);
03929                 }
03930 
03931               ret = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (ret, el);
03932             }
03933         }
03934     } end_sRefSet_allElements;
03935   
03936   sRefSet_allElements (other, el)<font class="keyword"></font>
03937 <font class="keyword">    </font>{
03938       <font class="keywordflow">if</font> (sRef_isValid (el))
03939         {
03940           <font class="keywordflow">if</font> (!<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (ret, el))
03941             {
03942                               <font class="comment">/* was cl == FALSECLAUSE */</font>
03943               checkDerivDeadState (el, FALSE, loc);
03944               ret = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (ret, el);
03945             }
03946           <font class="keywordflow">else</font>
03947             {
03948               <font class="comment">/*</font>
03949 <font class="comment">              ** it's okay --- member is a different equality test </font>
03950 <font class="comment">              */</font>
03951             }
03952         }
03953     } end_sRefSet_allElements;
03954 
03955   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (res);
03956   <font class="keywordflow">return</font> (ret);
03957 }
03958 
<a name="l03959"></a><a class="code" href="sRef_c.html#a152">03959</a> sRef <a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (<font class="comment">/*@exposed@*/</font> <font class="comment">/*@returned@*/</font> sRef a, <font class="comment">/*@exposed@*/</font> sRef b)<font class="keyword"></font>
03960 <font class="keyword"></font>{
03961   llassert (sRef_isValid (a));
03962   llassert (sRef_isValid (b));
03963       
03964   <font class="keywordflow">if</font> (!sRef_equivalent (a, b))
03965     {
03966       sRef s = sRef_new ();
03967       
03968       s-&gt;kind = SK_CONJ;
03969       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
03970       s-&gt;info-&gt;conj = (cjinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info-&gt;conj));
03971       s-&gt;info-&gt;conj-&gt;a = a;
03972       s-&gt;info-&gt;conj-&gt;b = b;
03973       
03974       <font class="keywordflow">if</font> (ctype_equal (a-&gt;type, b-&gt;type)) s-&gt;type = a-&gt;type;
03975       <font class="keywordflow">else</font> s-&gt;type = <a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (a-&gt;type, b-&gt;type);
03976       
03977       <font class="keywordflow">if</font> (a-&gt;defstate == b-&gt;defstate)
03978         {
03979           s-&gt;defstate = a-&gt;defstate;
03980         }
03981       <font class="keywordflow">else</font>
03982         {
03983           s-&gt;defstate = SS_UNKNOWN; 
03984         }
03985       
03986       s-&gt;nullstate = NS_UNKNOWN;
03987       
03988       s-&gt;safe = a-&gt;safe &amp;&amp; b-&gt;safe;
03989       s-&gt;aliaskind = <a class="code" href="aliasChecks_c.html#a14">alkind_resolve</a> (a-&gt;aliaskind, b-&gt;aliaskind);
03990 
03991       <font class="keywordflow">return</font> s;
03992     }
03993   <font class="keywordflow">else</font>
03994     {
03995       <font class="comment">/*@-exposetrans@*/</font> <font class="keywordflow">return</font> a; <font class="comment">/*@=exposetrans@*/</font>
03996     }
03997 }
03998 
03999 sRef
<a name="l04000"></a><a class="code" href="sRef_c.html#a153">04000</a> <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ()<font class="keyword"></font>
04001 <font class="keyword"></font>{
04002   sRef s = sRef_new ();
04003 
04004   s-&gt;kind = SK_UNKNOWN;
04005   <font class="keywordflow">return</font> s;
04006 }
04007 
04008 <font class="keyword">static</font> sRef
04009 sRef_makeSpecial (speckind sk) <font class="comment">/*@*/</font>
04010 {
04011   sRef s = sRef_new ();
04012 
04013   s-&gt;kind = SK_SPECIAL;
04014   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
04015   s-&gt;info-&gt;spec = sk;
04016   <font class="keywordflow">return</font> s;
04017 }
04018 
04019 <font class="keyword">static</font> sRef srnothing = sRef_undefined;
04020 <font class="keyword">static</font> sRef srinternal = sRef_undefined;
04021 <font class="keyword">static</font> sRef srsystem = sRef_undefined;
04022 <font class="keyword">static</font> sRef srspec = sRef_undefined;
04023 
04024 sRef
<a name="l04025"></a><a class="code" href="sRef_c.html#a155">04025</a> <a class="code" href="sRef_c.html#a155">sRef_makeNothing</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
04026 <font class="keyword"></font>{
04027   <font class="keywordflow">if</font> (sRef_isInvalid (srnothing))
04028     {
04029       srnothing = sRef_makeSpecial (SR_NOTHING);
04030     }
04031 
04032   <font class="comment">/*@-retalias@*/</font>
04033   <font class="keywordflow">return</font> srnothing;
04034   <font class="comment">/*@=retalias@*/</font>
04035 }
04036 
04037 sRef
<a name="l04038"></a><a class="code" href="sRef_c.html#a156">04038</a> <a class="code" href="sRef_c.html#a156">sRef_makeInternalState</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
04039 <font class="keyword"></font>{
04040   <font class="keywordflow">if</font> (sRef_isInvalid (srinternal))
04041     {
04042       srinternal = sRef_makeSpecial (SR_INTERNAL);
04043     }
04044 
04045   <font class="comment">/*@-retalias@*/</font>
04046   <font class="keywordflow">return</font> srinternal;
04047   <font class="comment">/*@=retalias@*/</font>
04048 }
04049 
04050 sRef
<a name="l04051"></a><a class="code" href="sRef_c.html#a157">04051</a> <a class="code" href="sRef_c.html#a157">sRef_makeSpecState</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
04052 <font class="keyword"></font>{
04053   <font class="keywordflow">if</font> (sRef_isInvalid (srspec))
04054     {
04055       srspec = sRef_makeSpecial (SR_SPECSTATE);
04056     }
04057 
04058   <font class="comment">/*@-retalias@*/</font>
04059   <font class="keywordflow">return</font> srspec;
04060   <font class="comment">/*@=retalias@*/</font>
04061 }
04062 
04063 sRef
<a name="l04064"></a><a class="code" href="sRef_c.html#a158">04064</a> <a class="code" href="sRef_c.html#a158">sRef_makeSystemState</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
04065 <font class="keyword"></font>{
04066   <font class="keywordflow">if</font> (sRef_isInvalid (srsystem))
04067     {
04068       srsystem = sRef_makeSpecial (SR_SYSTEM);
04069     }
04070 
04071   <font class="comment">/*@-retalias@*/</font>
04072   <font class="keywordflow">return</font> (srsystem);
04073   <font class="comment">/*@=retalias@*/</font>
04074 }
04075 
04076 <font class="keyword">static</font> sRef
04077 sRef_makeResultType (ctype ct)<font class="keyword"></font>
04078 <font class="keyword"></font>{
04079   sRef res = <a class="code" href="sRef_c.html#a159">sRef_makeResult</a> ();
04080 
04081   res-&gt;type = ct;
04082   <font class="keywordflow">return</font> res;
04083 }
04084 
04085 sRef
<a name="l04086"></a><a class="code" href="sRef_c.html#a159">04086</a> <a class="code" href="sRef_c.html#a159">sRef_makeResult</a> ()<font class="keyword"></font>
04087 <font class="keyword"></font>{
04088   sRef s = sRef_new ();
04089   
04090   s-&gt;kind = SK_RESULT;
04091   s-&gt;type = ctype_unknown;
04092   s-&gt;defstate = SS_UNKNOWN; 
04093   s-&gt;aliaskind = AK_UNKNOWN;
04094   s-&gt;nullstate = NS_UNKNOWN;
04095   
04096   <font class="keywordflow">return</font> s;
04097 }
04098 
04099 
04100 <font class="keywordtype">bool</font>
<a name="l04101"></a><a class="code" href="sRef_c.html#a160">04101</a> <a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (sRef s)<font class="keyword"></font>
04102 <font class="keyword"></font>{
04103   <font class="keywordflow">return</font> (sRef_isKindSpecial (s) &amp;&amp; s-&gt;info-&gt;spec == SR_NOTHING);
04104 }
04105 
04106 <font class="keywordtype">bool</font>
<a name="l04107"></a><a class="code" href="sRef_c.html#a161">04107</a> <a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (sRef s)<font class="keyword"></font>
04108 <font class="keyword"></font>{
04109   <font class="keywordflow">return</font> (sRef_isKindSpecial (s) &amp;&amp; s-&gt;info-&gt;spec == SR_INTERNAL);
04110 }
04111 
04112 <font class="keywordtype">bool</font>
<a name="l04113"></a><a class="code" href="sRef_c.html#a162">04113</a> <a class="code" href="sRef_c.html#a162">sRef_isSpecInternalState</a> (sRef s)<font class="keyword"></font>
04114 <font class="keyword"></font>{
04115   <font class="keywordflow">return</font> (sRef_isKindSpecial (s) 
04116           &amp;&amp; (s-&gt;info-&gt;spec == SR_INTERNAL || s-&gt;info-&gt;spec == SR_SPECSTATE));
04117 }
04118 
04119 <font class="keywordtype">bool</font>
<a name="l04120"></a><a class="code" href="sRef_c.html#a163">04120</a> <a class="code" href="sRef_c.html#a163">sRef_isSpecState</a> (sRef s)<font class="keyword"></font>
04121 <font class="keyword"></font>{
04122   <font class="keywordflow">return</font> (sRef_isKindSpecial (s) &amp;&amp; s-&gt;info-&gt;spec == SR_SPECSTATE);
04123 }
04124 
04125 <font class="keywordtype">bool</font>
<a name="l04126"></a><a class="code" href="sRef_c.html#a164">04126</a> <a class="code" href="sRef_c.html#a164">sRef_isResult</a> (sRef s)<font class="keyword"></font>
04127 <font class="keyword"></font>{
04128   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; s-&gt;kind == SK_RESULT);
04129 }
04130 
04131 <font class="keywordtype">bool</font>
<a name="l04132"></a><a class="code" href="sRef_c.html#a165">04132</a> <a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (sRef s)<font class="keyword"></font>
04133 <font class="keyword"></font>{
04134   <font class="keywordflow">return</font> (sRef_isKindSpecial (s) &amp;&amp; s-&gt;info-&gt;spec == SR_SYSTEM);
04135 }
04136 
04137 usymId
<a name="l04138"></a><a class="code" href="sRef_c.html#a166">04138</a> <a class="code" href="sRef_c.html#a166">sRef_getScopeIndex</a> (sRef s)<font class="keyword"></font>
04139 <font class="keyword"></font>{
04140   llassert (sRef_isValid (s));
04141   llassert (sRef_isCvar (s));
04142 
04143   <font class="keywordflow">return</font> (s-&gt;info-&gt;cvar-&gt;index);
04144 }
04145 
04146 <font class="keywordtype">void</font>
<a name="l04147"></a><a class="code" href="sRef_c.html#a167">04147</a> <a class="code" href="sRef_c.html#a167">sRef_makeSafe</a> (sRef s)<font class="keyword"></font>
04148 <font class="keyword"></font>{
04149   <font class="keywordflow">if</font> (sRef_isValid (s)) 
04150     {
04151       s-&gt;safe = TRUE;
04152     }
04153 }
04154 
04155 <font class="keywordtype">void</font>
<a name="l04156"></a><a class="code" href="sRef_c.html#a168">04156</a> <a class="code" href="sRef_c.html#a168">sRef_makeUnsafe</a> (sRef s)<font class="keyword"></font>
04157 <font class="keyword"></font>{
04158   <font class="keywordflow">if</font> (sRef_isValid (s)) 
04159     {
04160       s-&gt;safe = FALSE;
04161     }
04162 }
04163 
04164 <font class="comment">/*</font>
04165 <font class="comment">** memory state operations</font>
04166 <font class="comment">*/</font>
04167 
<a name="l04168"></a><a class="code" href="sRef_c.html#a169">04168</a> <font class="comment">/*@only@*/</font> cstring <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (sRef s)<font class="keyword"></font>
04169 <font class="keyword"></font>{
04170   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (cstring_undefined);
04171 
04172   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"[%d] %q - %q [%s] { %q }"</font>, 
04173                    (<font class="keywordtype">int</font>) s,
04174                    <a class="code" href="sRef_c.html#a124">sRef_unparseDebug</a> (s), 
04175                    <a class="code" href="sRef_c.html#a171">sRef_unparseState</a> (s),
04176                    <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (s-&gt;oexpkind),
04177                    <a class="code" href="sRefSet_c.html#a37">sRefSet_unparseDebug</a> (s-&gt;deriv)));
04178 }
04179 
<a name="l04180"></a><a class="code" href="sRef_c.html#a170">04180</a> <font class="comment">/*@unused@*/</font> cstring <a class="code" href="sRef_c.html#a170">sRef_unparseDeep</a> (sRef s)<font class="keyword"></font>
04181 <font class="keyword"></font>{
04182   cstring st = cstring_undefined;
04183 
04184   st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q:"</font>, sRef_unparseFull (s));
04185 
04186   <font class="keywordflow">if</font> (sRef_isValid (s))
04187     {
04188       sRefSet_allElements (s-&gt;deriv, el)<font class="keyword"></font>
04189 <font class="keyword">        </font>{
04190           st = <a class="code" href="message_c.html#a18">message</a>(<font class="stringliteral">"%q\n%q"</font>, st, sRef_unparseDeep (el));
04191         } end_sRefSet_allElements ;
04192     }
04193 
04194   <font class="keywordflow">return</font> st;
04195 }
04196 
<a name="l04197"></a><a class="code" href="sRef_c.html#a171">04197</a> <font class="comment">/*@only@*/</font> cstring <a class="code" href="sRef_c.html#a171">sRef_unparseState</a> (sRef s)<font class="keyword"></font>
04198 <font class="keyword"></font>{
04199   <font class="keywordflow">if</font> (sRef_isConj (s))
04200     {
04201       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q | %q"</font>, 
04202                        sRef_unparseState (s-&gt;info-&gt;conj-&gt;a),
04203                        <a class="code" href="sRef_c.html#a171">sRef_unparseState</a> (s-&gt;info-&gt;conj-&gt;b)));
04204     }
04205 
04206   <font class="keywordflow">if</font> (sRef_isInvalid (s))
04207     {
04208       <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"&lt;invalid&gt;"</font>));
04209     }
04210 
04211   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s.%s.%s.%s"</font>, 
04212                    alkind_unparse (s-&gt;aliaskind), 
04213                    <a class="code" href="varKinds_c.html#a7">nstate_unparse</a> (s-&gt;nullstate),
04214                    <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (s-&gt;expkind),
04215                    <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (s-&gt;defstate)));
04216 }
04217 
<a name="l04218"></a><a class="code" href="sRef_c.html#a172">04218</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a172">sRef_isNotUndefined</a> (sRef s)<font class="keyword"></font>
04219 <font class="keyword"></font>{
04220   <font class="keywordflow">return</font> (sRef_isInvalid (s)
04221           || (s-&gt;defstate != SS_UNDEFINED
04222               &amp;&amp; s-&gt;defstate != SS_UNUSEABLE
04223               &amp;&amp; s-&gt;defstate != SS_DEAD));
04224 }
04225 
<a name="l04226"></a><a class="code" href="sRef_c.html#a173">04226</a> ynm <a class="code" href="sRef_c.html#a173">sRef_isWriteable</a> (sRef s)<font class="keyword"></font>
04227 <font class="keyword"></font>{
04228   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> MAYBE;
04229 
04230   <font class="keywordflow">if</font> (sRef_isConj (s) &amp;&amp; s-&gt;defstate == SS_UNKNOWN)
04231     {
04232       <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isWriteable (sRef_getConjA (s))))
04233         {
04234           <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isWriteable (sRef_getConjB (s))))
04235             {
04236               <font class="keywordflow">return</font> YES;
04237             }
04238           <font class="keywordflow">return</font> MAYBE;
04239         }
04240       <font class="keywordflow">else</font>
04241         {
04242           <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isWriteable (sRef_getConjB (s))))
04243             {
04244               <font class="keywordflow">return</font> MAYBE;
04245             }
04246           <font class="keywordflow">return</font> NO;
04247         }
04248     }
04249 
04250   <font class="keywordflow">return</font> (ynm_fromBool (s-&gt;defstate != SS_UNUSEABLE));
04251 }
04252 
<a name="l04253"></a><a class="code" href="sRef_c.html#a174">04253</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a174">sRef_hasNoStorage</a> (sRef s)<font class="keyword"></font>
04254 <font class="keyword"></font>{
04255   <font class="keywordflow">return</font> (!sRef_isAllocatedStorage (s) || <a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (s));
04256 }
04257 
<a name="l04258"></a><a class="code" href="sRef_c.html#a175">04258</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a175">sRef_isStrictReadable</a> (sRef s)<font class="keyword"></font>
04259 <font class="keyword"></font>{
04260   <font class="keywordflow">return</font> (ynm_toBoolStrict (sRef_isReadable (s)));
04261 }
04262 
<a name="l04263"></a><a class="code" href="sRef_c.html#a176">04263</a> ynm <a class="code" href="sRef_c.html#a176">sRef_isReadable</a> (sRef s)<font class="keyword"></font>
04264 <font class="keyword"></font>{
04265   sstate ss;
04266 
04267   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> YES;
04268 
04269   ss = s-&gt;defstate;
04270   
04271   <font class="keywordflow">if</font> (sRef_isConj (s) &amp;&amp; s-&gt;defstate == SS_UNKNOWN)
04272     {
04273       <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isReadable (sRef_getConjA (s))))
04274         {
04275           <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isReadable (sRef_getConjB (s))))
04276             {
04277               <font class="keywordflow">return</font> YES;
04278             }
04279           <font class="keywordflow">return</font> MAYBE;
04280         }
04281       <font class="keywordflow">else</font>
04282         {
04283           <font class="keywordflow">if</font> (ynm_toBoolStrict (sRef_isReadable (sRef_getConjB (s))))
04284             {
04285               <font class="keywordflow">return</font> MAYBE;
04286             }
04287           <font class="keywordflow">return</font> NO;
04288         }
04289     }
04290   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ss == SS_HOFFA)
04291     {
04292       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTUSERELEASED))
04293         {
04294           <font class="keywordflow">return</font> MAYBE;
04295         }
04296       <font class="keywordflow">else</font>
04297         {
04298           <font class="keywordflow">return</font> YES;
04299         }
04300     }
04301   <font class="keywordflow">else</font>
04302     {
04303       <font class="keywordflow">return</font> (ynm_fromBool (ss == SS_DEFINED 
04304                             || ss == SS_FIXED 
04305                             || ss == SS_RELDEF 
04306                             || ss == SS_PDEFINED 
04307                             || ss == SS_PARTIAL
04308                             || ss == SS_SPECIAL
04309                             || ss == SS_ALLOCATED
04310                             || ss == SS_UNKNOWN));
04311     }
04312 }
04313 
04314 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef whatUndefined (<font class="comment">/*@exposed@*/</font> sRef fref, <font class="keywordtype">int</font> depth)<font class="keyword"></font>
04315 <font class="keyword"></font>{
04316   ctype ct;
04317 
04318   
04319   <font class="keywordflow">if</font> (depth &gt; MAXDEPTH)
04320     {
04321       <a class="code" href="llerror_c.html#a33">llgenmsg</a> (message 
04322                 (<font class="stringliteral">"Warning: check definition limit exceeded, checking %q. "</font>
04323                  <font class="stringliteral">"This either means there is a variable with at least "</font>
04324                  <font class="stringliteral">"%d indirections apparent in the program text, or "</font>
04325                  <font class="stringliteral">"there is a bug in LCLint."</font>,
04326                  sRef_unparse (fref),
04327                  MAXDEPTH),
04328                 g_currentloc);
04329 
04330       <font class="keywordflow">return</font> sRef_undefined;
04331     }
04332 
04333   <font class="keywordflow">if</font> (!sRef_isKnown (fref) || sRef_isAnyDefined (fref))
04334     {
04335       <font class="keywordflow">return</font> sRef_undefined;
04336     }
04337 
04338   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref) || <a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref))
04339     {
04340       <font class="keywordflow">return</font> fref;
04341     }
04342 
04343   ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (fref));
04344   
04345   <font class="keywordflow">if</font> (ctype_isUnknown (ct))
04346     {
04347       <font class="keywordflow">return</font> sRef_undefined;
04348     }
04349   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct) || <a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ct))
04350     {
04351       <font class="keywordflow">if</font> (sRef_isStateUnknown (fref))
04352         {
04353           <font class="keywordflow">return</font> sRef_undefined;
04354         }
04355       <font class="keywordflow">else</font>
04356         {
04357           sRef fptr = <a class="code" href="sRef_c.html#a270">sRef_constructDeref</a> (fref);
04358 
04359           <font class="keywordflow">return</font> (whatUndefined (fptr, depth + 1));
04360         }
04361     }
04362   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct))
04363     {
04364       <font class="keywordtype">bool</font> hasOneDefined = FALSE;
04365       
04366       <font class="keywordflow">if</font> (sRef_isStateUnknown (fref))
04367         {
04368           <font class="keywordflow">return</font> fref;
04369         }
04370           
04371       <font class="keywordflow">if</font> (sRef_isPdefined (fref) || sRef_isAnyDefined (fref))
04372         {
04373           sRefSet_realElements (sRef_derivedFields (fref), sr)
04374             {
04375               hasOneDefined = TRUE;
04376               
04377               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
04378                 {
04379                   cstring fieldname = <a class="code" href="sRef_c.html#a138">sRef_getField</a> (sr);
04380                   sRef fldref = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (fref, fieldname);
04381                   <font class="keywordtype">bool</font> shouldCheck = !<a class="code" href="sRef_c.html#a62">sRef_isRecursiveField</a> (fldref);
04382                   
04383                   <font class="keywordflow">if</font> (shouldCheck)
04384                     {
04385                       sRef wdef = whatUndefined (fldref, depth + 1);
04386 
04387                       <font class="keywordflow">if</font> (sRef_isValid (wdef))
04388                         {
04389                           <font class="keywordflow">return</font> wdef;
04390                         }
04391                     }
04392                 }
04393             } end_sRefSet_realElements;
04394         }
04395       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (fref))
04396         {
04397           <font class="comment">/*</font>
04398 <font class="comment">          ** for structures, each field must be completely defined</font>
04399 <font class="comment">          */</font>
04400           
04401           uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ct);
04402               
04403           uentryList_elements (fields, ue)<font class="keyword"></font>
04404 <font class="keyword">            </font>{
04405               cstring name = <a class="code" href="uentry_c.html#a196">uentry_getRealName</a> (ue);
04406               sRef ffield = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (fref, name);
04407               <font class="keywordtype">bool</font> shouldCheck = !<a class="code" href="sRef_c.html#a62">sRef_isRecursiveField</a> (ffield);
04408 
04409               <font class="keywordflow">if</font> (sRef_isRelDef (uentry_getSref (ue)))
04410                 {
04411                   ; <font class="comment">/* no error */</font>
04412                 }
04413               <font class="keywordflow">else</font>
04414                 {
04415                   <font class="keywordflow">if</font> (shouldCheck)
04416                     {
04417                       sRef wdef = whatUndefined (ffield, depth + 1);
04418 
04419                       <font class="keywordflow">if</font> (sRef_isInvalid (wdef))
04420                         {
04421                           <font class="keywordflow">return</font> wdef;
04422                         }
04423                     }
04424                 }
04425             } end_uentryList_elements;
04426         }
04427       <font class="keywordflow">else</font>
04428         {
04429           ;
04430         }
04431     }
04432   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ct))
04433     {
04434       ; 
04435     }
04436   <font class="keywordflow">else</font>
04437     {
04438       ;
04439     }
04440 
04441   <font class="keywordflow">return</font> sRef_undefined;
04442 }
04443 
04444 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkDefined (sRef sr)<font class="keyword"></font>
04445 <font class="keyword"></font>{
04446   <font class="keywordflow">return</font> (sRef_isInvalid (whatUndefined (sr, 0)));
04447 }
04448 
<a name="l04449"></a><a class="code" href="sRef_c.html#a179">04449</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a179">sRef_isReallyDefined</a> (sRef s)<font class="keyword"></font>
04450 <font class="keyword"></font>{
04451   <font class="keywordflow">if</font> (sRef_isValid (s))
04452     {
04453       <font class="keywordflow">if</font> (sRef_isAnyDefined (s))
04454         {
04455           <font class="keywordflow">return</font> TRUE;
04456         }
04457       <font class="keywordflow">else</font>
04458         {
04459           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s) || sRef_isPdefined (s))
04460             {
04461               <font class="keywordflow">return</font> checkDefined (s);
04462             }
04463           <font class="keywordflow">else</font>
04464             {
04465               <font class="keywordflow">return</font> FALSE;
04466             }
04467         }
04468     }
04469   <font class="keywordflow">else</font>
04470     {
04471       <font class="keywordflow">return</font> TRUE;
04472     }
04473 }
04474 
<a name="l04475"></a><a class="code" href="sRef_c.html#a180">04475</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a180">sRef_showNotReallyDefined</a> (sRef s)<font class="keyword"></font>
04476 <font class="keyword"></font>{
04477   <font class="keywordflow">if</font> (sRef_isValid (s))
04478     {
04479       <font class="keywordflow">if</font> (sRef_isAnyDefined (s))
04480         {
04481           BADBRANCH;
04482         }
04483       <font class="keywordflow">else</font>
04484         {
04485           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s) || sRef_isPdefined (s))
04486             {
04487               sRef ref = whatUndefined (s, 0);
04488 
04489               llassert (sRef_isValid (ref));
04490 
04491               <font class="keywordflow">if</font> (ref != s)
04492                 {
04493                   llgenindentmsgnoloc
04494                     (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"This sub-reference is %s: %q"</font>,
04495                               sstate_unparse (sRef_getDefState (ref)),
04496                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (ref)));
04497                 }
04498             }
04499           <font class="keywordflow">else</font>
04500             {
04501               ;
04502             }
04503         }
04504     }
04505   <font class="keywordflow">else</font>
04506     {
04507       BADBRANCH;
04508     }
04509 }
04510 
<a name="l04511"></a><a class="code" href="sRef_c.html#a181">04511</a> sstate <a class="code" href="sRef_c.html#a181">sRef_getDefState</a> (sRef s)<font class="keyword"></font>
04512 <font class="keyword"></font>{
04513   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> (SS_UNKNOWN);
04514   <font class="keywordflow">return</font> (s-&gt;defstate);
04515 }
04516 
<a name="l04517"></a><a class="code" href="sRef_c.html#a182">04517</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (sRef s, sstate defstate, fileloc loc)<font class="keyword"></font>
04518 <font class="keyword"></font>{
04519   sRef_setStateAux (s, defstate, loc);
04520 }
04521 
04522 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_clearAliasStateAux (sRef s, fileloc loc)<font class="keyword"></font>
04523 <font class="keyword"></font>{
04524   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (s, AK_ERROR, loc);
04525 }
04526 
<a name="l04527"></a><a class="code" href="sRef_c.html#a184">04527</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a184">sRef_clearAliasState</a> (sRef s, fileloc loc)<font class="keyword"></font>
04528 <font class="keyword"></font>{
04529   sRef_aliasSetComplete (sRef_clearAliasStateAux, s, loc);
04530 }
04531 
<a name="l04532"></a><a class="code" href="sRef_c.html#a185">04532</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a185">sRef_setAliasKindComplete</a> (sRef s, alkind kind, fileloc loc)<font class="keyword"></font>
04533 <font class="keyword"></font>{
04534   sRef_aliasSetCompleteParam (sRef_setAliasKind, s, kind, loc);
04535 }
04536 
<a name="l04537"></a><a class="code" href="sRef_c.html#a186">04537</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (sRef s, alkind kind, fileloc loc)<font class="keyword"></font>
04538 <font class="keyword"></font>{
04539   <font class="keywordflow">if</font> (sRef_isValid (s))
04540     {
04541       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s);
04542 
04543       <font class="keywordflow">if</font> ((kind != s-&gt;aliaskind &amp;&amp; kind != s-&gt;oaliaskind)
04544           &amp;&amp; fileloc_isDefined (loc))
04545         {
04546           s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
04547         }
04548       
04549       s-&gt;aliaskind = kind;
04550     }
04551 }
04552 
<a name="l04553"></a><a class="code" href="sRef_c.html#a187">04553</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a187">sRef_setOrigAliasKind</a> (sRef s, alkind kind)<font class="keyword"></font>
04554 <font class="keyword"></font>{
04555   <font class="keywordflow">if</font> (sRef_isValid (s))
04556     {
04557       s-&gt;oaliaskind = kind;
04558     }
04559 }
04560 
<a name="l04561"></a><a class="code" href="sRef_c.html#a188">04561</a> exkind <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (sRef s)<font class="keyword"></font>
04562 <font class="keyword"></font>{
04563   <font class="keywordflow">if</font> (sRef_isValid (s))
04564     {
04565       <font class="keywordflow">return</font> (s-&gt;expkind);
04566     }
04567   <font class="keywordflow">else</font>
04568     {
04569       <font class="keywordflow">return</font> XO_UNKNOWN;
04570     }
04571 }
04572 
<a name="l04573"></a><a class="code" href="sRef_c.html#a189">04573</a> exkind <a class="code" href="sRef_c.html#a189">sRef_getOrigExKind</a> (sRef s)<font class="keyword"></font>
04574 <font class="keyword"></font>{
04575   <font class="keywordflow">if</font> (sRef_isValid (s))
04576     {
04577       <font class="keywordflow">return</font> (s-&gt;oexpkind);
04578     }
04579   <font class="keywordflow">else</font>
04580     {
04581       <font class="keywordflow">return</font> XO_UNKNOWN;
04582     }
04583 }
04584 
04585 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_clearExKindAux (sRef s, fileloc loc)<font class="keyword"></font>
04586 <font class="keyword"></font>{
04587   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, XO_UNKNOWN, loc);
04588 }
04589 
<a name="l04590"></a><a class="code" href="sRef_c.html#a191">04590</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a191">sRef_setObserver</a> (sRef s, fileloc loc)<font class="keyword"> </font>
04591 <font class="keyword"></font>{
04592   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, XO_OBSERVER, loc);
04593 }
04594 
<a name="l04595"></a><a class="code" href="sRef_c.html#a192">04595</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a192">sRef_setExposed</a> (sRef s, fileloc loc)<font class="keyword"> </font>
04596 <font class="keyword"></font>{
04597   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, XO_EXPOSED, loc);
04598 }
04599 
<a name="l04600"></a><a class="code" href="sRef_c.html#a193">04600</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a193">sRef_clearExKindComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04601 <font class="keyword"></font>{
04602   (<font class="keywordtype">void</font>) sRef_aliasSetComplete (sRef_clearExKindAux, s, loc);
04603 }
04604 
<a name="l04605"></a><a class="code" href="sRef_c.html#a194">04605</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (sRef s, exkind exp, fileloc loc)<font class="keyword"></font>
04606 <font class="keyword"></font>{
04607   <font class="keywordflow">if</font> (sRef_isValid (s))
04608     {
04609       <font class="keywordflow">if</font> (s-&gt;expkind != exp)
04610         {
04611           s-&gt;expinfo = alinfo_updateLoc (s-&gt;expinfo, loc);
04612         }
04613       
04614       s-&gt;expkind = exp;
04615     }
04616 }
04617 
04618 <font class="comment">/*</font>
04619 <font class="comment">** s1-&gt;derived = s2-&gt;derived</font>
04620 <font class="comment">*/</font>
04621 
04622 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_copyRealDerived (sRef s1, sRef s2)<font class="keyword"></font>
04623 <font class="keyword"></font>{
04624   <font class="keywordflow">if</font> (sRef_isValid (s1) &amp;&amp; sRef_isValid (s2))
04625     {
04626       sRef sb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s1);
04627 
04628       <a class="code" href="sRefSet_c.html#a5">sRefSet_clear</a> (s1-&gt;deriv);
04629 
04630       sRefSet_allElements (s2-&gt;deriv, el)<font class="keyword"></font>
04631 <font class="keyword">        </font>{
04632           <font class="keywordflow">if</font> (sRef_isValid (el))
04633             {
04634               sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
04635               
04636               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a112">sRef_same</a> (rb, sb))
04637                 {
04638                   sRef fb = sRef_fixDirectBase (el, s1);
04639                   
04640                   <font class="keywordflow">if</font> (sRef_isValid (fb))
04641                     {
04642                       sRef_copyRealDerived (fb, el);
04643                       sRef_addDeriv (s1, fb);
04644                     }
04645                 }
04646               <font class="keywordflow">else</font>
04647                 {
04648                   sRef_addDeriv (s1, el);
04649                 }
04650             }
04651         } end_sRefSet_allElements ;
04652     }
04653   
04654   }
04655 
<a name="l04656"></a><a class="code" href="sRef_c.html#a196">04656</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a196">sRef_copyRealDerivedComplete</a> (sRef s1, sRef s2)<font class="keyword"></font>
04657 <font class="keyword"></font>{
04658   sRef_innerAliasSetCompleteParam (sRef_copyRealDerived, s1, s2);
04659 }
04660 
<a name="l04661"></a><a class="code" href="sRef_c.html#a197">04661</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a197">sRef_setUndefined</a> (sRef s, fileloc loc)<font class="keyword"></font>
04662 <font class="keyword"></font>{
04663   <font class="keywordflow">if</font> (sRef_isValid (s))
04664     {
04665       s-&gt;defstate = SS_UNDEFINED;
04666 
04667       <font class="keywordflow">if</font> (fileloc_isDefined (loc))
04668         {
04669           s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
04670         }
04671 
04672       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s);
04673     }
04674 }
04675 
04676 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setDefinedAux (sRef s, fileloc loc, <font class="keywordtype">bool</font> clear)<font class="keyword"></font>
04677 <font class="keyword"></font>{
04678   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font>;
04679 
04680   <font class="keywordflow">if</font> (s-&gt;defstate != SS_DEFINED &amp;&amp; fileloc_isDefined (loc))
04681     {
04682       s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
04683     }
04684   
04685   s-&gt;defstate = SS_DEFINED;
04686   
04687   <font class="comment">/* e.g., if x is allocated, *x = 3 defines x */</font>
04688   
04689   <font class="keywordflow">if</font> (s-&gt;kind == SK_PTR)
04690     {
04691       sRef p = s-&gt;info-&gt;ref;
04692       
04693       <font class="keywordflow">if</font> (p-&gt;defstate == SS_ALLOCATED)
04694         {
04695           sRef_setDefinedAux (p, loc, clear);
04696         }
04697     }
04698   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s-&gt;kind == SK_ARRAYFETCH) 
04699     {
04700       <font class="keywordflow">if</font> (!s-&gt;info-&gt;arrayfetch-&gt;indknown
04701           || (s-&gt;info-&gt;arrayfetch-&gt;ind == 0))
04702         {
04703           sRef p = s-&gt;info-&gt;arrayfetch-&gt;arr;
04704           sRef ptr = <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (p);
04705           
04706           <font class="keywordflow">if</font> (sRef_isValid (ptr))
04707             {
04708               <font class="keywordflow">if</font> (ptr-&gt;defstate == SS_ALLOCATED 
04709                   || ptr-&gt;defstate == SS_UNDEFINED)
04710                 {
04711                   sRef_setDefinedAux (ptr, loc, clear);
04712                 }
04713             }
04714           
04715           <font class="keywordflow">if</font> (p-&gt;defstate == SS_RELDEF) 
04716             {
04717               ;
04718             }
04719           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (p-&gt;defstate == SS_ALLOCATED || p-&gt;defstate == SS_PDEFINED)
04720             {
04721               p-&gt;defstate = SS_DEFINED;
04722             }
04723           <font class="keywordflow">else</font>
04724             {
04725             }
04726         }
04727     }
04728   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s-&gt;kind == SK_FIELD)
04729     {
04730       sRef parent = s-&gt;info-&gt;field-&gt;rec;
04731       
04732       <font class="keywordflow">if</font> (sRef_isValid (parent))
04733         {
04734           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ctype_realType (parent-&gt;type)))
04735             {
04736               <font class="comment">/*</font>
04737 <font class="comment">              ** Should not clear derived from here.</font>
04738 <font class="comment">              */</font>
04739               
04740               sRef_setDefinedNoClear (parent, loc);
04741             }
04742           <font class="keywordflow">else</font>
04743             {
04744               ; <font class="comment">/* Nothing to do for structures. */</font>
04745             }
04746         }
04747 
04748           }
04749   <font class="keywordflow">else</font>
04750     {
04751       ;
04752     }
04753 
04754   <font class="keywordflow">if</font> (clear)
04755     {
04756       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s);
04757     }  
04758 }
04759 
04760 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setPartialDefined (sRef s, fileloc loc)<font class="keyword"></font>
04761 <font class="keyword"></font>{
04762   <font class="keywordflow">if</font> (!sRef_isPartial (s))
04763     {
04764       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (s, loc);
04765     }
04766 }
04767 
<a name="l04768"></a><a class="code" href="sRef_c.html#a199">04768</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a199">sRef_setPartialDefinedComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04769 <font class="keyword"></font>{
04770   sRef_innerAliasSetComplete (sRef_setPartialDefined, s, loc);
04771 }
04772 
<a name="l04773"></a><a class="code" href="sRef_c.html#a200">04773</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04774 <font class="keyword"></font>{
04775   sRef_innerAliasSetComplete (sRef_setDefined, s, loc);
04776 }
04777 
<a name="l04778"></a><a class="code" href="sRef_c.html#a201">04778</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sRef s, fileloc loc)<font class="keyword"></font>
04779 <font class="keyword"></font>{
04780   sRef_setDefinedAux (s, loc, TRUE);
04781 }
04782 
04783 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setDefinedNoClear (sRef s, fileloc loc)<font class="keyword"></font>
04784 <font class="keyword"></font>{
04785   DPRINTF ((<font class="stringliteral">"Defining: %s"</font>, sRef_unparseFull (s)));
04786   sRef_setDefinedAux (s, loc, FALSE);
04787   DPRINTF ((<font class="stringliteral">"==&gt; %s"</font>, sRef_unparseFull (s)));
04788 }
04789 
<a name="l04790"></a><a class="code" href="sRef_c.html#a202">04790</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a202">sRef_setDefinedNCComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04791 <font class="keyword"></font>{
04792   DPRINTF ((<font class="stringliteral">"Set Defined Complete: %s"</font>, sRef_unparseFull (s)));
04793   sRef_innerAliasSetComplete (sRef_setDefinedNoClear, s, loc);
04794   DPRINTF ((<font class="stringliteral">"==&gt; %s"</font>, sRef_unparseFull (s)));
04795 }
04796 
04797 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isDeepUnionField (sRef s)<font class="keyword"></font>
04798 <font class="keyword"></font>{
04799   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a63">sRef_deepPred</a> (sRef_isUnionField, s));
04800 }
04801 
<a name="l04802"></a><a class="code" href="sRef_c.html#a203">04802</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a203">sRef_isUnionField</a> (sRef s)<font class="keyword"></font>
04803 <font class="keyword"></font>{
04804   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; s-&gt;kind == SK_FIELD)
04805     {
04806       <font class="comment">/*</font>
04807 <font class="comment">       ** defining one field of a union defines the union</font>
04808 <font class="comment">       */</font>
04809       
04810       sRef base = s-&gt;info-&gt;field-&gt;rec;
04811 
04812       <font class="keywordflow">if</font> (sRef_isValid (base))
04813         {
04814           <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ctype_realType (base-&gt;type)));
04815         }
04816     }
04817 
04818   <font class="keywordflow">return</font> FALSE;
04819 }
04820 
<a name="l04821"></a><a class="code" href="sRef_c.html#a204">04821</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a204">sRef_setPdefined</a> (sRef s, fileloc loc)<font class="keyword"></font>
04822 <font class="keyword"></font>{
04823   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !sRef_isPartial (s))
04824     {
04825       sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);
04826 
04827       <font class="keywordflow">if</font> (s-&gt;defstate == SS_ALLOCATED)
04828         {
04829           <font class="keywordflow">return</font>;
04830         }
04831       
04832       <font class="keywordflow">if</font> (s-&gt;defstate != SS_PDEFINED &amp;&amp; fileloc_isDefined (loc))
04833         {
04834           s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
04835         }
04836 
04837       s-&gt;defstate = SS_PDEFINED;
04838       
04839       <font class="comment">/* e.g., if x is allocated, *x = 3 defines x */</font>
04840       
04841       <font class="keywordflow">while</font> (sRef_isValid (base) &amp;&amp; sRef_isKnown (base))
04842         {
04843           <font class="keywordflow">if</font> (base-&gt;defstate == SS_DEFINED)
04844             { 
04845               sRef nb;
04846 
04847                       base-&gt;defstate = SS_PDEFINED; 
04848               nb = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base); 
04849               base = nb;
04850             }
04851           <font class="keywordflow">else</font> 
04852             { 
04853               <font class="keywordflow">break</font>; 
04854             }
04855         }      
04856     }
04857 }
04858 
04859 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setStateAux (sRef s, sstate ss, fileloc loc)<font class="keyword"></font>
04860 <font class="keyword"></font>{
04861   <font class="keywordflow">if</font> (sRef_isValid (s))
04862     {
04863       <font class="comment">/* if (s-&gt;defstate == SS_RELDEF) return; */</font>
04864 
04865       <font class="keywordflow">if</font> (s-&gt;defstate != ss &amp;&amp; fileloc_isDefined (loc))
04866         {
04867           s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
04868         }
04869 
04870       s-&gt;defstate = ss;
04871       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s); 
04872 
04873       <font class="keywordflow">if</font> (ss == SS_ALLOCATED)
04874         {
04875           sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);
04876           
04877           <font class="keywordflow">while</font> (sRef_isValid (base) &amp;&amp; sRef_isKnown (base))
04878             {
04879               <font class="keywordflow">if</font> (base-&gt;defstate == SS_DEFINED) 
04880                 { 
04881                   sRef nb;
04882                   
04883                   base-&gt;defstate = SS_PDEFINED; 
04884                   
04885                   nb = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base); 
04886                   base = nb;
04887                 }
04888               <font class="keywordflow">else</font> 
04889                 { 
04890                   <font class="keywordflow">break</font>; 
04891                 }
04892             }
04893         }
04894 
04895           }
04896 }
04897 
<a name="l04898"></a><a class="code" href="sRef_c.html#a205">04898</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a205">sRef_setAllocatedComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04899 <font class="keyword"></font>{
04900   sRef_innerAliasSetComplete (sRef_setAllocated, s, loc);
04901 }
04902 
04903 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setAllocatedShallow (sRef s, fileloc loc)<font class="keyword"></font>
04904 <font class="keyword"></font>{
04905   <font class="keywordflow">if</font> (sRef_isValid (s))
04906     {
04907       <font class="keywordflow">if</font> (s-&gt;defstate == SS_DEAD || s-&gt;defstate == SS_UNDEFINED)
04908         {
04909           s-&gt;defstate = SS_ALLOCATED;
04910           
04911           <font class="keywordflow">if</font> (fileloc_isDefined (loc))
04912             {
04913               s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
04914             }
04915         }
04916     }
04917 }
04918 
<a name="l04919"></a><a class="code" href="sRef_c.html#a207">04919</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a207">sRef_setAllocatedShallowComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
04920 <font class="keyword"></font>{
04921   sRef_innerAliasSetComplete (sRef_setAllocatedShallow, s, loc);
04922 }
04923 
<a name="l04924"></a><a class="code" href="sRef_c.html#a208">04924</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (sRef s, fileloc loc)<font class="keyword"></font>
04925 <font class="keyword"></font>{
04926   sRef_setStateAux (s, SS_ALLOCATED, loc);
04927   }
04928 
<a name="l04929"></a><a class="code" href="sRef_c.html#a209">04929</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a209">sRef_setPartial</a> (sRef s, fileloc loc)<font class="keyword"></font>
04930 <font class="keyword"></font>{
04931   sRef_setStateAux (s, SS_PARTIAL, loc);
04932   }
04933 
<a name="l04934"></a><a class="code" href="sRef_c.html#a210">04934</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a210">sRef_setShared</a> (sRef s, fileloc loc)<font class="keyword"></font>
04935 <font class="keyword"></font>{
04936   <font class="keywordflow">if</font> (sRef_isValid (s))
04937     {
04938       <font class="keywordflow">if</font> (s-&gt;aliaskind != AK_SHARED &amp;&amp; fileloc_isDefined (loc))
04939         {
04940           s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
04941         }
04942 
04943       s-&gt;aliaskind = AK_SHARED;
04944       <font class="comment">/* don't! sRef_clearDerived (s); */</font>
04945     }
04946 }
04947 
<a name="l04948"></a><a class="code" href="sRef_c.html#a211">04948</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a211">sRef_setLastReference</a> (sRef s, sRef ref, fileloc loc)<font class="keyword"></font>
04949 <font class="keyword"></font>{
04950   <font class="keywordflow">if</font> (sRef_isValid (s))
04951     {
04952       s-&gt;aliaskind = sRef_getAliasKind (ref);
04953       s-&gt;aliasinfo = alinfo_updateRefLoc (s-&gt;aliasinfo, ref, loc);
04954     }
04955 }
04956 
04957 <font class="keyword">static</font>
04958 <font class="keywordtype">void</font> sRef_setNullStateAux (<font class="comment">/*@notnull@*/</font> sRef s, nstate ns, fileloc loc)<font class="keyword"></font>
04959 <font class="keyword"></font>{
04960  s-&gt;nullstate = ns;
04961 
04962  <font class="keywordflow">if</font> (fileloc_isDefined (loc))
04963    {
04964      s-&gt;nullinfo = alinfo_updateLoc (s-&gt;nullinfo, loc);
04965    }
04966 }
04967 
<a name="l04968"></a><a class="code" href="sRef_c.html#a213">04968</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a213">sRef_setNotNull</a> (sRef s, fileloc loc)<font class="keyword"></font>
04969 <font class="keyword"></font>{
04970   <font class="keywordflow">if</font> (sRef_isValid (s))
04971     {
04972       sRef_setNullStateAux (s, NS_NOTNULL, loc);
04973     }
04974 }
04975 
<a name="l04976"></a><a class="code" href="sRef_c.html#a214">04976</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (sRef s, nstate n, fileloc loc)<font class="keyword"></font>
04977 <font class="keyword"></font>{
04978   <font class="keywordflow">if</font> (sRef_isValid (s))
04979     {
04980       sRef_setNullStateAux (s, n, loc);
04981     }
04982 }
04983 
<a name="l04984"></a><a class="code" href="sRef_c.html#a215">04984</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a215">sRef_setNullStateInnerComplete</a> (sRef s, nstate n, fileloc loc)<font class="keyword"></font>
04985 <font class="keyword"></font>{
04986   <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (s, n, loc);
04987 
04988   <font class="keywordflow">switch</font> (n)
04989     {
04990     <font class="keywordflow">case</font> NS_POSNULL:
04991       sRef_innerAliasSetComplete (sRef_setPosNull, s, loc);
04992       <font class="keywordflow">break</font>;
04993     <font class="keywordflow">case</font> NS_DEFNULL:
04994       sRef_innerAliasSetComplete (sRef_setDefNull, s, loc);
04995       <font class="keywordflow">break</font>;
04996     <font class="keywordflow">case</font> NS_UNKNOWN:
04997       sRef_innerAliasSetComplete (sRef_setNullUnknown, s, loc);
04998       <font class="keywordflow">break</font>;
04999     <font class="keywordflow">case</font> NS_NOTNULL:
05000       sRef_innerAliasSetComplete (sRef_setNotNull, s, loc);
05001       <font class="keywordflow">break</font>;
05002     <font class="keywordflow">case</font> NS_MNOTNULL:
05003       sRef_innerAliasSetComplete (sRef_setNotNull, s, loc);
05004       <font class="keywordflow">break</font>;
05005     <font class="keywordflow">case</font> NS_RELNULL:
05006       sRef_innerAliasSetComplete (sRef_setNullUnknown, s, loc);
05007       <font class="keywordflow">break</font>;
05008     <font class="keywordflow">case</font> NS_CONSTNULL:
05009       sRef_innerAliasSetComplete (sRef_setDefNull, s, loc);
05010       <font class="keywordflow">break</font>;
05011     <font class="keywordflow">case</font> NS_ABSNULL:
05012       sRef_innerAliasSetComplete (sRef_setNullUnknown, s, loc);
05013       <font class="keywordflow">break</font>;
05014     <font class="keywordflow">case</font> NS_ERROR:
05015       sRef_innerAliasSetComplete (sRef_setNullErrorLoc, s, loc);
05016       <font class="keywordflow">break</font>;
05017     }
05018 }
05019 
<a name="l05020"></a><a class="code" href="sRef_c.html#a216">05020</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a216">sRef_setPosNull</a> (sRef s, fileloc loc)<font class="keyword"></font>
05021 <font class="keyword"></font>{
05022   <font class="keywordflow">if</font> (sRef_isValid (s))
05023     {
05024       sRef_setNullStateAux (s, NS_POSNULL, loc);
05025     }
05026 }
05027   
<a name="l05028"></a><a class="code" href="sRef_c.html#a217">05028</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a217">sRef_setDefNull</a> (sRef s, fileloc loc)<font class="keyword"></font>
05029 <font class="keyword"></font>{
05030   <font class="keywordflow">if</font> (sRef_isValid (s))
05031     {
05032       sRef_setNullStateAux (s, NS_DEFNULL, loc);
05033     }
05034 }
05035 
<a name="l05036"></a><a class="code" href="sRef_c.html#a218">05036</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a218">sRef_setNullUnknown</a> (sRef s, fileloc loc)<font class="keyword"></font>
05037 <font class="keyword"></font>{
05038   <font class="keywordflow">if</font> (sRef_isValid (s))
05039     {
05040       sRef_setNullStateAux (s, NS_UNKNOWN, loc);
05041     }
05042 }
05043 
<a name="l05044"></a><a class="code" href="sRef_c.html#a219">05044</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (sRef s)<font class="keyword"></font>
05045 <font class="keyword"></font>{
05046   <font class="keywordflow">if</font> (sRef_isValid (s))
05047     {
05048       sRef_setNullStateAux (s, NS_UNKNOWN, fileloc_undefined);
05049     }
05050 }
05051 
05052 <font class="keywordtype">void</font> sRef_setNullErrorLoc (sRef s, <font class="comment">/*@unused@*/</font> fileloc loc)<font class="keyword"></font>
05053 <font class="keyword"></font>{
05054   <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (s);
05055 }
05056 
<a name="l05057"></a><a class="code" href="sRef_c.html#a220">05057</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a220">sRef_setOnly</a> (sRef s, fileloc loc)<font class="keyword"></font>
05058 <font class="keyword"></font>{
05059   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; s-&gt;aliaskind != AK_ONLY)
05060     {
05061       s-&gt;aliaskind = AK_ONLY;
05062       s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
05063           }
05064 }
05065 
<a name="l05066"></a><a class="code" href="sRef_c.html#a221">05066</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (sRef s, fileloc loc)<font class="keyword"></font>
05067 <font class="keyword"></font>{
05068   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s) &amp;&amp; (s-&gt;aliaskind != AK_DEPENDENT))
05069     {
05070       s-&gt;aliaskind = AK_DEPENDENT;
05071       s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
05072           }
05073 }
05074 
<a name="l05075"></a><a class="code" href="sRef_c.html#a222">05075</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a222">sRef_setOwned</a> (sRef s, fileloc loc)<font class="keyword"></font>
05076 <font class="keyword"></font>{
05077   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s) &amp;&amp; (s-&gt;aliaskind != AK_OWNED))
05078     {
05079       s-&gt;aliaskind = AK_OWNED;
05080       s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
05081           }
05082 }
05083 
<a name="l05084"></a><a class="code" href="sRef_c.html#a223">05084</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (sRef s, fileloc loc)<font class="keyword"></font>
05085 <font class="keyword"></font>{
05086   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s) &amp;&amp; (s-&gt;aliaskind != AK_KEPT))
05087     {
05088       sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);  
05089       
05090       <font class="keywordflow">while</font> (sRef_isValid (base) &amp;&amp; sRef_isKnown (base))
05091         {
05092           <font class="keywordflow">if</font> (base-&gt;defstate == SS_DEFINED) 
05093             {
05094               base-&gt;defstate = SS_PDEFINED; 
05095                       base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base); 
05096             }
05097           <font class="keywordflow">else</font> 
05098             {
05099               <font class="keywordflow">break</font>; 
05100             }
05101 
05102         }
05103 
05104       s-&gt;aliaskind = AK_KEPT;
05105       s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
05106           }
05107 }
05108 
05109 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setKeptAux (sRef s, fileloc loc)<font class="keyword"></font>
05110 <font class="keyword"></font>{
05111   <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (s))
05112     {
05113       <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (s, loc);
05114     }
05115 }
05116 
05117 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_setDependentAux (sRef s, fileloc loc)<font class="keyword"></font>
05118 <font class="keyword"></font>{
05119   <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (s))
05120     {
05121       <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (s, loc);
05122     }
05123 }
05124 
<a name="l05125"></a><a class="code" href="sRef_c.html#a226">05125</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
05126 <font class="keyword"></font>{
05127   sRef_aliasSetComplete (sRef_setKeptAux, s, loc);
05128 }
05129 
<a name="l05130"></a><a class="code" href="sRef_c.html#a227">05130</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a227">sRef_setDependentComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
05131 <font class="keyword"></font>{
05132   sRef_aliasSetComplete (sRef_setDependentAux, s, loc);
05133 }
05134 
<a name="l05135"></a><a class="code" href="sRef_c.html#a228">05135</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a228">sRef_setFresh</a> (sRef s, fileloc loc)<font class="keyword"></font>
05136 <font class="keyword"></font>{
05137   <font class="keywordflow">if</font> (sRef_isValid (s))
05138     {
05139       s-&gt;aliaskind = AK_FRESH;
05140       s-&gt;aliasinfo = alinfo_updateLoc (s-&gt;aliasinfo, loc);
05141     }
05142 }
05143 
<a name="l05144"></a><a class="code" href="sRef_c.html#a229">05144</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a229">sRef_kill</a> (sRef s, fileloc loc)<font class="keyword"></font>
05145 <font class="keyword"></font>{
05146   DPRINTF ((<font class="stringliteral">"Kill: %s"</font>, sRef_unparseFull (s)));
05147 
05148   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (s) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s))
05149     {
05150       sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);  
05151       
05152       <font class="keywordflow">while</font> (sRef_isValid (base) &amp;&amp; sRef_isKnown (base))
05153         {
05154           <font class="keywordflow">if</font> (base-&gt;defstate == SS_DEFINED) 
05155             {
05156               base-&gt;defstate = SS_PDEFINED; 
05157               base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base); 
05158             }
05159           <font class="keywordflow">else</font> 
05160             {
05161               <font class="keywordflow">break</font>; 
05162             }
05163 
05164         }
05165       
05166       s-&gt;aliaskind = s-&gt;oaliaskind;
05167       s-&gt;defstate = SS_DEAD;
05168       s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
05169 
05170       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s);
05171     }
05172 }
05173 
<a name="l05174"></a><a class="code" href="sRef_c.html#a230">05174</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (sRef s, fileloc loc)<font class="keyword"></font>
05175 <font class="keyword"></font>{
05176         
05177   <font class="keywordflow">if</font> (sRef_isValid (s))
05178     {
05179       sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);  
05180 
05181             
05182       <font class="keywordflow">while</font> (sRef_isValid (base) &amp;&amp; sRef_isKnown (base))
05183         {
05184           <font class="keywordflow">if</font> (base-&gt;defstate == SS_DEFINED || base-&gt;defstate == SS_RELDEF)
05185             {
05186               base-&gt;defstate = SS_PDEFINED; 
05187                       base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base); 
05188             }
05189           <font class="keywordflow">else</font> 
05190             {
05191                       <font class="keywordflow">break</font>; 
05192             }
05193           
05194         }
05195       
05196       s-&gt;aliaskind = s-&gt;oaliaskind;
05197       s-&gt;defstate = SS_HOFFA; 
05198       s-&gt;definfo = alinfo_updateLoc (s-&gt;definfo, loc);
05199       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s); 
05200     }
05201 
05202   }
05203 
05204 <font class="comment">/*</font>
05205 <font class="comment">** just for type checking...</font>
05206 <font class="comment">*/</font>
05207 
05208 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_killAux (sRef s, fileloc loc)<font class="keyword"></font>
05209 <font class="keyword"></font>{
05210   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a343">sRef_isShared</a> (s))
05211     {
05212       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a260">sRef_isUnknownArrayFetch</a> (s))
05213         {
05214           <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (s, loc);
05215         }
05216       <font class="keywordflow">else</font>
05217         {
05218                   <a class="code" href="sRef_c.html#a229">sRef_kill</a> (s, loc);
05219                 }
05220     }
05221 }
05222 
05223 <font class="comment">/*</font>
05224 <font class="comment">** kills s and all aliases to s</font>
05225 <font class="comment">*/</font>
05226 
<a name="l05227"></a><a class="code" href="sRef_c.html#a232">05227</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (sRef s, fileloc loc)<font class="keyword"></font>
05228 <font class="keyword"></font>{
05229   DPRINTF ((<font class="stringliteral">"Kill complete: %s"</font>, sRef_unparseFull (s)));
05230   sRef_aliasSetComplete (sRef_killAux, s, loc);
05231 }
05232 
05233 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_equivalent (sRef s1, sRef s2)<font class="keyword"></font>
05234 <font class="keyword"></font>{
05235   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a104">sRef_compare</a> (s1, s2) == 0);
05236 }
05237 
05238 <font class="comment">/*</font>
05239 <font class="comment">** returns an sRef that will not be free'd on function exit.</font>
05240 <font class="comment">*/</font>
05241 
<a name="l05242"></a><a class="code" href="sRef_c.html#a233">05242</a> <font class="comment">/*@only@*/</font> sRef <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (sRef s)<font class="keyword"></font>
05243 <font class="keyword"></font>{
05244   sRef ret;
05245 
05246   <font class="keywordflow">if</font> (sRef_isValid (s))
05247     {
05248       <font class="keywordtype">bool</font> old = inFunction;
05249 
05250       <font class="comment">/*</font>
05251 <font class="comment">      ** Exit the function scope, so this sRef is not</font>
05252 <font class="comment">      ** stored in the deallocation table.</font>
05253 <font class="comment">      */</font>
05254       
05255       inFunction = FALSE;
05256       DPRINTF ((<font class="stringliteral">"Copying sref: %s"</font>, <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a>(s)));
05257       ret = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (s);
05258       DPRINTF ((<font class="stringliteral">"Copying ===&gt;: %s"</font>, <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a>(ret)));
05259       inFunction = old;
05260     }
05261   <font class="keywordflow">else</font>
05262     {
05263       ret = sRef_undefined;
05264     }
05265 
05266   <font class="comment">/*@-dependenttrans@*/</font> 
05267   <font class="keywordflow">return</font> ret;
05268   <font class="comment">/*@=dependenttrans@*/</font> 
05269 }
05270 
<a name="l05271"></a><a class="code" href="sRef_c.html#a234">05271</a> sRef <a class="code" href="sRef_c.html#a234">sRef_copy</a> (sRef s)<font class="keyword"></font>
05272 <font class="keyword"></font>{
05273   <font class="keywordflow">if</font> (sRef_isKindSpecial (s))
05274     {
05275       <font class="comment">/*@-retalias@*/</font>
05276       <font class="keywordflow">return</font> s; <font class="comment">/* don't copy specials */</font>
05277       <font class="comment">/*@=retalias@*/</font>
05278     }
05279   
05280   <font class="keywordflow">if</font> (sRef_isValid (s))
05281     {
05282       sRef t = sRef_alloc ();
05283 
05284       t-&gt;kind = s-&gt;kind;
05285       t-&gt;safe = s-&gt;safe;
05286       t-&gt;modified = s-&gt;modified;
05287       t-&gt;type = s-&gt;type;
05288 
05289             t-&gt;info = sinfo_copy (s);
05290       
05291       t-&gt;defstate = s-&gt;defstate;
05292 
05293       t-&gt;nullstate = s-&gt;nullstate;
05294 
05295       t-&gt;aliaskind = s-&gt;aliaskind;
05296       t-&gt;oaliaskind = s-&gt;oaliaskind;
05297 
05298       t-&gt;expkind = s-&gt;expkind;
05299       t-&gt;oexpkind = s-&gt;oexpkind;
05300 
05301       t-&gt;aliasinfo = alinfo_copy (s-&gt;aliasinfo);
05302       t-&gt;definfo = alinfo_copy (s-&gt;definfo);
05303       t-&gt;nullinfo = alinfo_copy (s-&gt;nullinfo);
05304       t-&gt;expinfo = alinfo_copy (s-&gt;expinfo);
05305 
05306       t-&gt;deriv = <a class="code" href="sRefSet_c.html#a21">sRefSet_newDeepCopy</a> (s-&gt;deriv);
05307       
05308       <font class="keywordflow">return</font> t;
05309     }
05310   <font class="keywordflow">else</font>
05311     {
05312       <font class="keywordflow">return</font> sRef_undefined;
05313     }
05314 }
05315 
05316 <font class="comment">/*@notfunction@*/</font>
<a name="l05317"></a><a class="code" href="sRef_c.html#a4">05317</a> <font class="preprocessor"># define PREDTEST(func,s) \</font>
05318 <font class="preprocessor">   do { if (sRef_isInvalid (s)) { return FALSE; } \</font>
05319 <font class="preprocessor">        else { if (sRef_isConj (s)) \</font>
05320 <font class="preprocessor">                  { return (func (sRef_getConjA (s)) \</font>
05321 <font class="preprocessor">                            || func (sRef_getConjB (s))); }}} while (FALSE);</font>
05322 <font class="preprocessor"></font>
<a name="l05323"></a><a class="code" href="sRef_c.html#a235">05323</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (sRef s)<font class="keyword"></font>
05324 <font class="keyword"></font>{
05325   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isAddress, s);
05326   <font class="keywordflow">return</font> (s-&gt;kind == SK_ADR);
05327 }
05328           
05329 <font class="comment">/*</font>
05330 <font class="comment">** pretty weak... maybe a flag should control this.</font>
05331 <font class="comment">*/</font>
05332 
<a name="l05333"></a><a class="code" href="sRef_c.html#a236">05333</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (sRef s)<font class="keyword"></font>
05334 <font class="keyword"></font>{
05335   <font class="keywordflow">if</font> (sRef_isValid (s))
05336     {
05337       sRef tref = s;
05338 
05339       <font class="keywordflow">do</font> 
05340         {
05341           sRef lt;
05342 
05343           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (tref)) 
05344             {
05345                       <font class="keywordflow">return</font> TRUE;
05346             }
05347           
05348           lt = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (tref);
05349           tref = lt;
05350         } <font class="keywordflow">while</font> (sRef_isValid (tref));
05351     } 
05352 
05353   <font class="keywordflow">return</font> FALSE;
05354 }
05355 
<a name="l05356"></a><a class="code" href="sRef_c.html#a237">05356</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (sRef s)<font class="keyword"></font>
05357 <font class="keyword"></font>{
05358   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isArrayFetch, s);
05359   <font class="keywordflow">return</font> (s-&gt;kind == SK_ARRAYFETCH);
05360 }
05361 
<a name="l05362"></a><a class="code" href="sRef_c.html#a238">05362</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (sRef s)<font class="keyword"></font>
05363 <font class="keyword"></font>{
05364   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> () &amp;&amp; <a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s))
05365     {
05366       uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s);
05367       cstring pname = <a class="code" href="structNames_c.html#a6">makeParam</a> (uentry_rawName (ue));
05368       uentry mac = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (pname);
05369 
05370       <a class="code" href="cstring_c.html#a27">cstring_free</a> (pname);
05371       <font class="keywordflow">return</font> (uentry_isValid (mac));
05372     }
05373 
05374   <font class="keywordflow">return</font> FALSE;
05375 }
05376       
<a name="l05377"></a><a class="code" href="sRef_c.html#a239">05377</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (sRef s)<font class="keyword"> </font>
05378 <font class="keyword"></font>{
05379   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isCvar, s);
05380   <font class="keywordflow">return</font> (s-&gt;kind == SK_CVAR);
05381 }
05382 
<a name="l05383"></a><a class="code" href="sRef_c.html#a240">05383</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (sRef s)<font class="keyword"> </font>
05384 <font class="keyword"></font>{
05385   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isConst, s);
05386   <font class="keywordflow">return</font> (s-&gt;kind == SK_CONST);
05387 }
05388 
<a name="l05389"></a><a class="code" href="sRef_c.html#a241">05389</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a241">sRef_isObject</a> (sRef s)<font class="keyword"> </font>
05390 <font class="keyword"></font>{
05391   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isObject, s);
05392   <font class="keywordflow">return</font> (s-&gt;kind == SK_OBJECT);
05393 }
05394 
<a name="l05395"></a><a class="code" href="sRef_c.html#a242">05395</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a242">sRef_isExternal</a> (sRef s)<font class="keyword"> </font>
05396 <font class="keyword"></font>{
05397   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isExternal, s);
05398   <font class="keywordflow">return</font> (s-&gt;kind == SK_EXTERNAL);
05399 }
05400 
05401 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isDerived (sRef s)<font class="keyword"> </font>
05402 <font class="keyword"></font>{
05403   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isDerived, s);
05404   <font class="keywordflow">return</font> (s-&gt;kind == SK_DERIVED);
05405 }
05406 
<a name="l05407"></a><a class="code" href="sRef_c.html#a243">05407</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a243">sRef_isField</a> (sRef s)<font class="keyword"></font>
05408 <font class="keyword"></font>{
05409   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isField, s);
05410   <font class="keywordflow">return</font> (s-&gt;kind == SK_FIELD);
05411 }
05412 
05413 <font class="keyword">static</font> <font class="keywordtype">bool</font> sRef_isIndex (sRef s)<font class="keyword"></font>
05414 <font class="keyword"></font>{
05415   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isIndex, s);
05416   <font class="keywordflow">return</font> (s-&gt;kind == SK_ARRAYFETCH);
05417 }
05418 
<a name="l05419"></a><a class="code" href="sRef_c.html#a245">05419</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (sRef s)<font class="keyword"></font>
05420 <font class="keyword"></font>{
05421   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isAnyParam, s);
05422   <font class="keywordflow">return</font> (s-&gt;kind == SK_PARAM);  
05423 }
05424 
<a name="l05425"></a><a class="code" href="sRef_c.html#a246">05425</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (sRef s)<font class="keyword"></font>
05426 <font class="keyword"></font>{
05427   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isParam, s);
05428   <font class="keywordflow">return</font> (s-&gt;kind == SK_PARAM);
05429 }
05430 
<a name="l05431"></a><a class="code" href="sRef_c.html#a247">05431</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a247">sRef_isDirectParam</a> (sRef s)<font class="keyword"></font>
05432 <font class="keyword"></font>{
05433   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isDirectParam, s);
05434 
05435   <font class="keywordflow">return</font> ((s-&gt;kind == SK_CVAR) &amp;&amp;
05436           (s-&gt;info-&gt;cvar-&gt;lexlevel == functionScope) &amp;&amp;
05437           (<a class="code" href="context_c.html#a174">context_inFunction</a> () &amp;&amp; 
05438            (s-&gt;info-&gt;cvar-&gt;index &lt;= <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (context_getParams ()))));
05439 }
05440 
<a name="l05441"></a><a class="code" href="sRef_c.html#a248">05441</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (sRef s)<font class="keyword"></font>
05442 <font class="keyword"></font>{
05443   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isPointer, s);
05444   <font class="keywordflow">return</font> (s-&gt;kind == SK_PTR);
05445 }
05446 
05447 <font class="comment">/*</font>
05448 <font class="comment">** returns true if storage referenced by s is visible</font>
05449 <font class="comment">*/</font>
05450 
<a name="l05451"></a><a class="code" href="sRef_c.html#a249">05451</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a249">sRef_isReference</a> (sRef s)<font class="keyword"></font>
05452 <font class="keyword"></font>{
05453   <a class="code" href="sRef_c.html#a4">PREDTEST</a> (sRef_isReference, s);
05454 
05455   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (s) || sRef_isIndex (s) || <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s)
05456           || (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (s) &amp;&amp; (<a class="code" href="sRef_c.html#a249">sRef_isReference</a> (s-&gt;info-&gt;field-&gt;rec))));
05457 }
05458 
<a name="l05459"></a><a class="code" href="sRef_c.html#a250">05459</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a250">sRef_isIReference</a> (sRef s)<font class="keyword"></font>
05460 <font class="keyword"></font>{
05461   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (s) || <a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (s) || sRef_isIndex (s)
05462           || <a class="code" href="sRef_c.html#a243">sRef_isField</a> (s) || <a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (s));
05463 }
05464 
<a name="l05465"></a><a class="code" href="sRef_c.html#a251">05465</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef s)<font class="keyword"></font>
05466 <font class="keyword"></font>{
05467   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s) &amp;&amp; (s-&gt;info-&gt;cvar-&gt;lexlevel &lt;= fileScope));
05468 }
05469 
<a name="l05470"></a><a class="code" href="sRef_c.html#a252">05470</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a252">sRef_isRealGlobal</a> (sRef s)<font class="keyword"></font>
05471 <font class="keyword"></font>{
05472   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s) &amp;&amp; (s-&gt;info-&gt;cvar-&gt;lexlevel == globScope));
05473 }
05474 
<a name="l05475"></a><a class="code" href="sRef_c.html#a253">05475</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (sRef s)<font class="keyword"></font>
05476 <font class="keyword"></font>{
05477   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s) &amp;&amp; (s-&gt;info-&gt;cvar-&gt;lexlevel == fileScope));
05478 }
05479 
<a name="l05480"></a><a class="code" href="sRef_c.html#a254">05480</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a254">sRef_isAliasCheckedGlobal</a> (sRef s)<font class="keyword"></font>
05481 <font class="keyword"></font>{
05482   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s))
05483     {
05484       uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s);
05485 
05486       <font class="keywordflow">return</font> <a class="code" href="context_c.html#a106">context_checkAliasGlob</a> (ue);
05487     }
05488   <font class="keywordflow">else</font>
05489     {
05490       <font class="keywordflow">return</font> FALSE;
05491     }
05492 }
05493 
<a name="l05494"></a><a class="code" href="sRef_c.html#a255">05494</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a255">sRef_free</a> (<font class="comment">/*@only@*/</font> sRef s)<font class="keyword"></font>
05495 <font class="keyword"></font>{
05496   <font class="keywordflow">if</font> (s != sRef_undefined &amp;&amp; s-&gt;kind != SK_SPECIAL)
05497     {
05498       alinfo_free (s-&gt;expinfo);
05499       alinfo_free (s-&gt;aliasinfo);
05500       alinfo_free (s-&gt;definfo);
05501       alinfo_free (s-&gt;nullinfo);
05502       
05503       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (s-&gt;deriv);
05504       s-&gt;deriv = sRefSet_undefined;
05505       sinfo_free (s);
05506       
05507       <a class="code" href="general_c.html#a0">sfree</a> (s); 
05508     }
05509 }
05510 
<a name="l05511"></a><a class="code" href="sRef_c.html#a256">05511</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a256">sRef_setType</a> (sRef s, ctype t)<font class="keyword"></font>
05512 <font class="keyword"></font>{
05513   <font class="keywordflow">if</font> (sRef_isValid (s))
05514     {
05515       s-&gt;type = t;
05516     }
05517 }
05518 
<a name="l05519"></a><a class="code" href="sRef_c.html#a257">05519</a> <font class="keywordtype">void</font> <a class="code" href="sRef_c.html#a257">sRef_setTypeFull</a> (sRef s, ctype t)<font class="keyword"></font>
05520 <font class="keyword"></font>{
05521   <font class="keywordflow">if</font> (sRef_isValid (s))
05522     {
05523       s-&gt;type = t;
05524 
05525       sRefSet_allElements (s-&gt;deriv, current)<font class="keyword"></font>
05526 <font class="keyword">        </font>{
05527           <a class="code" href="sRef_c.html#a257">sRef_setTypeFull</a> (current, ctype_unknown);
05528         } end_sRefSet_allElements ;
05529     }
05530 }
05531 
05532 <font class="comment">/*@exposed@*/</font> sRef
<a name="l05533"></a><a class="code" href="sRef_c.html#a258">05533</a>   <a class="code" href="sRef_c.html#a258">sRef_buildField</a> (sRef rec, <font class="comment">/*@dependent@*/</font> cstring f)<font class="keyword"></font>
05534 <font class="keyword"></font>{
05535   <font class="keywordflow">return</font> (sRef_buildNCField (rec, f)); 
05536 }
05537 
05538 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
05539 sRef_findDerivedField (<font class="comment">/*@notnull@*/</font> sRef rec, cstring f)<font class="keyword"></font>
05540 <font class="keyword"></font>{
05541   sRefSet_allElements (rec-&gt;deriv, sr)<font class="keyword"></font>
05542 <font class="keyword">    </font>{
05543       <font class="keywordflow">if</font> (sRef_isValid (sr))
05544         {
05545           <font class="keywordflow">if</font> (sr-&gt;kind == SK_FIELD &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (sr-&gt;info-&gt;field-&gt;field, f))
05546             {
05547               <font class="keywordflow">return</font> sr;
05548             }
05549         }
05550     } end_sRefSet_allElements;
05551 
05552   <font class="keywordflow">return</font> sRef_undefined;
05553 }
05554 
05555 <font class="comment">/*@dependent@*/</font> <font class="comment">/*@observer@*/</font> sRefSet
<a name="l05556"></a><a class="code" href="sRef_c.html#a259">05556</a>   <a class="code" href="sRef_c.html#a259">sRef_derivedFields</a> (sRef rec)<font class="keyword"></font>
05557 <font class="keyword"></font>{
05558   <font class="keywordflow">if</font> (sRef_isValid (rec))
05559     {
05560       sRefSet ret;
05561       ret = rec-&gt;deriv;
05562       <font class="keywordflow">return</font> (ret);
05563     }
05564   <font class="keywordflow">else</font>
05565     {
05566       <font class="keywordflow">return</font> (sRefSet_undefined);
05567     }
05568 }
05569 
05570 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
05571   sRef_findDerivedPointer (sRef s)<font class="keyword"></font>
05572 <font class="keyword"></font>{
05573   <font class="keywordflow">if</font> (sRef_isValid (s))
05574     {
05575       sRefSet_realElements (s-&gt;deriv, sr)<font class="keyword"></font>
05576 <font class="keyword">        </font>{
05577           <font class="keywordflow">if</font> (sRef_isValid (sr) &amp;&amp; sr-&gt;kind == SK_PTR)
05578             {
05579               <font class="keywordflow">return</font> sr;
05580             }
05581         } end_sRefSet_realElements;
05582     }
05583 
05584   <font class="keywordflow">return</font> sRef_undefined;
05585 }
05586 
05587 <font class="keywordtype">bool</font>
<a name="l05588"></a><a class="code" href="sRef_c.html#a260">05588</a> <a class="code" href="sRef_c.html#a260">sRef_isUnknownArrayFetch</a> (sRef s)<font class="keyword"></font>
05589 <font class="keyword"></font>{
05590   <font class="keywordflow">return</font> (sRef_isValid (s) 
05591           &amp;&amp; s-&gt;kind == SK_ARRAYFETCH
05592           &amp;&amp; !s-&gt;info-&gt;arrayfetch-&gt;indknown);
05593 }
05594 
05595 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
05596 sRef_findDerivedArrayFetch (<font class="comment">/*@notnull@*/</font> sRef s, <font class="keywordtype">bool</font> isknown, <font class="keywordtype">int</font> idx, <font class="keywordtype">bool</font> dead)<font class="keyword"></font>
05597 <font class="keyword"></font>{
05598   
05599   <font class="keywordflow">if</font> (isknown) 
05600     {
05601       sRefSet_realElements (s-&gt;deriv, sr)<font class="keyword"></font>
05602 <font class="keyword">        </font>{
05603           <font class="keywordflow">if</font> (sRef_isValid (sr)
05604               &amp;&amp; sr-&gt;kind == SK_ARRAYFETCH
05605               &amp;&amp; sr-&gt;info-&gt;arrayfetch-&gt;indknown
05606               &amp;&amp; (sr-&gt;info-&gt;arrayfetch-&gt;ind == idx))
05607             {
05608               <font class="keywordflow">return</font> sr;
05609             }
05610         } end_sRefSet_realElements;
05611     }
05612   <font class="keywordflow">else</font>
05613     {
05614       sRefSet_realElements (s-&gt;deriv, sr)<font class="keyword"></font>
05615 <font class="keyword">        </font>{
05616           <font class="keywordflow">if</font> (sRef_isValid (sr)
05617               &amp;&amp; sr-&gt;kind == SK_ARRAYFETCH
05618               &amp;&amp; (!sr-&gt;info-&gt;arrayfetch-&gt;indknown
05619                   || (sr-&gt;info-&gt;arrayfetch-&gt;indknown &amp;&amp; 
05620                       sr-&gt;info-&gt;arrayfetch-&gt;ind == 0)))
05621             {
05622               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr) || sRef_isKept (sr))
05623                 {
05624                   <font class="keywordflow">if</font> (dead || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTUSERELEASED))
05625                     {
05626                       <font class="keywordflow">return</font> sr;
05627                     }
05628                 }
05629               <font class="keywordflow">else</font>
05630                 {
05631                   <font class="keywordflow">return</font> sr;
05632                 }
05633             }
05634         } end_sRefSet_realElements;
05635     }
05636 
05637   <font class="keywordflow">return</font> sRef_undefined;
05638 }
05639 
05640 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef 
05641 sRef_buildNCField (<font class="comment">/*@exposed@*/</font> sRef rec, <font class="comment">/*@exposed@*/</font> cstring f)<font class="keyword"></font>
05642 <font class="keyword"></font>{
05643   sRef s;
05644 
05645   <font class="keywordflow">if</font> (sRef_isInvalid (rec))
05646     {
05647       <font class="keywordflow">return</font> sRef_undefined;
05648     }
05649       
05650   <font class="comment">/*</font>
05651 <font class="comment">  ** check if the field already has been referenced </font>
05652 <font class="comment">  */</font>
05653 
05654   s = sRef_findDerivedField (rec, f);
05655   
05656   <font class="keywordflow">if</font> (sRef_isValid (s))
05657     {
05658             <font class="keywordflow">return</font> s;
05659     }
05660   <font class="keywordflow">else</font>
05661     {
05662       ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (rec-&gt;type);
05663 
05664       s = sRef_new ();      
05665       s-&gt;kind = SK_FIELD;
05666       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
05667       s-&gt;info-&gt;field = (fldinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info-&gt;field));
05668       s-&gt;info-&gt;field-&gt;rec = rec;
05669       s-&gt;info-&gt;field-&gt;field = f; <font class="comment">/* doesn't copy f */</font>
05670       
05671       
05672       <font class="keywordflow">if</font> (ctype_isKnown (ct) &amp;&amp; ctype_isSU (ct))
05673         {
05674           uentry ue = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (ct), f);
05675         
05676           <font class="keywordflow">if</font> (!uentry_isUndefined (ue))
05677             {
05678               s-&gt;type = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
05679 
05680               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (s-&gt;type)
05681                   &amp;&amp; rec-&gt;aliaskind != AK_STACK 
05682                   &amp;&amp; !alkind_isStatic (rec-&gt;aliaskind))
05683                 {
05684                   s-&gt;aliaskind = rec-&gt;aliaskind;
05685                 }
05686               <font class="keywordflow">else</font>
05687                 {
05688                   s-&gt;aliaskind = AK_UNKNOWN;
05689                 }
05690 
05691               <font class="keywordflow">if</font> (sRef_isStateDefined (rec) || sRef_isStateUnknown (rec) 
05692                   || sRef_isPdefined (rec))
05693                 {
05694                                   <a class="code" href="sRef_c.html#a266">sRef_setStateFromUentry</a> (s, ue);
05695                                 }
05696               <font class="keywordflow">else</font>
05697                 {
05698                   sRef_setPartsFromUentry (s, ue);
05699                                 }
05700 
05701               s-&gt;oaliaskind = s-&gt;aliaskind;
05702               s-&gt;oexpkind = s-&gt;expkind;
05703             }
05704           <font class="keywordflow">else</font>
05705             {
05706               <font class="comment">/*</font>
05707 <font class="comment">                Never report this as an error.  It can happen whenever there</font>
05708 <font class="comment">                is casting involved.</font>
05709 <font class="comment"></font>
05710 <font class="comment">              if (report)</font>
05711 <font class="comment">                {</font>
05712 <font class="comment">                  llcontbug (message ("buildNCField --- no field %s: %q / %s",</font>
05713 <font class="comment">                                      f, sRef_unparse (s), ctype_unparse (ct)));</font>
05714 <font class="comment">                }</font>
05715 <font class="comment">                */</font>
05716 
05717               <font class="keywordflow">return</font> sRef_undefined;
05718             }
05719         }
05720       
05721       <font class="keywordflow">if</font> (rec-&gt;defstate == SS_DEFINED 
05722           &amp;&amp; (s-&gt;defstate == SS_UNDEFINED || s-&gt;defstate == SS_UNKNOWN))
05723         {
05724           s-&gt;defstate = SS_DEFINED;
05725         }
05726       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (rec-&gt;defstate == SS_PARTIAL)
05727         {
05728           s-&gt;defstate = SS_PARTIAL;
05729         }
05730       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (rec-&gt;defstate == SS_ALLOCATED) 
05731         {
05732           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a139">ctype_isStackAllocated</a> (ct) &amp;&amp; <a class="code" href="ctype_c.html#a139">ctype_isStackAllocated</a> (s-&gt;type))
05733             {
05734               s-&gt;defstate = SS_ALLOCATED;
05735             }
05736           <font class="keywordflow">else</font>
05737             {
05738               s-&gt;defstate = SS_UNDEFINED;
05739             }
05740         }
05741       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s-&gt;defstate == SS_UNKNOWN)
05742         {
05743           s-&gt;defstate = rec-&gt;defstate;
05744         }
05745       <font class="keywordflow">else</font>
05746         {
05747           ; <font class="comment">/* no change */</font>
05748         }
05749 
05750       <font class="keywordflow">if</font> (s-&gt;defstate == SS_UNDEFINED)
05751         {
05752           ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (s-&gt;type);
05753           
05754           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (rt) || ctype_isSU (rt))
05755             {
05756                       s-&gt;defstate = SS_ALLOCATED;
05757             }
05758         }
05759 
05760       sRef_addDeriv (rec, s);
05761 
05762       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (s-&gt;type) &amp;&amp; <a class="code" href="cstring_c.html#a18">cstring_equal</a> (f, REFSNAME))
05763         {
05764           s-&gt;aliaskind = AK_REFS;
05765           s-&gt;oaliaskind = AK_REFS;
05766         }
05767 
05768             <font class="keywordflow">return</font> s;
05769     }
05770 }
05771 
05772 <font class="keywordtype">bool</font>
<a name="l05773"></a><a class="code" href="sRef_c.html#a262">05773</a> <a class="code" href="sRef_c.html#a262">sRef_isStackAllocated</a> (sRef s)<font class="keyword"></font>
05774 <font class="keyword"></font>{
05775   <font class="keywordflow">return</font> (sRef_isValid(s) 
05776           &amp;&amp; s-&gt;defstate == SS_ALLOCATED &amp;&amp; <a class="code" href="ctype_c.html#a139">ctype_isStackAllocated</a> (s-&gt;type));
05777 }
05778           
05779 <font class="keyword">static</font>
05780 <font class="keywordtype">void</font> sRef_setArrayFetchState (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef s, 
05781                               <font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef arr)<font class="keyword"></font>
05782 <font class="keyword"></font>{
05783   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (arr-&gt;type))
05784     {
05785       s-&gt;type = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (arr-&gt;type);
05786     }
05787 
05788   <font class="comment">/* a hack, methinks... makeArrayFetch (&amp;a[0]) ==&gt; a[] */</font>
05789   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (arr)) 
05790     {
05791       sRef t = arr-&gt;info-&gt;ref;
05792       
05793       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (t))
05794         {
05795           s-&gt;info-&gt;arrayfetch-&gt;arr = t-&gt;info-&gt;arrayfetch-&gt;arr;
05796         }
05797     }
05798   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (arr-&gt;type))
05799     {
05800       sRef sp = sRef_findDerivedPointer (arr);
05801 
05802       
05803       <font class="keywordflow">if</font> (sRef_isValid (sp))
05804         {
05805           
05806           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (s-&gt;type))
05807             {
05808               <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (sp), fileloc_undefined);
05809 
05810                       
05811               s-&gt;aliaskind = sp-&gt;aliaskind;
05812             }
05813 
05814           s-&gt;defstate = sp-&gt;defstate;
05815 
05816           <font class="keywordflow">if</font> (s-&gt;defstate == SS_DEFINED) 
05817             {
05818               <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTDESTROY))
05819                 {
05820                   s-&gt;defstate = SS_PARTIAL;
05821                 }
05822             }
05823 
05824           s-&gt;nullstate = sp-&gt;nullstate;
05825         }
05826       <font class="keywordflow">else</font>
05827         {
05828           <font class="keywordflow">if</font> (arr-&gt;defstate == SS_UNDEFINED)
05829             {
05830               s-&gt;defstate = SS_UNUSEABLE;
05831             }
05832           <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((arr-&gt;defstate == SS_ALLOCATED) &amp;&amp; !ctype_isSU (s-&gt;type))
05833             {
05834               s-&gt;defstate = SS_UNDEFINED;
05835             }
05836           <font class="keywordflow">else</font>
05837             {
05838               <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTDESTROY))
05839                 {
05840                   s-&gt;defstate = SS_PARTIAL;
05841                 }
05842               <font class="keywordflow">else</font>
05843                 {
05844                   s-&gt;defstate = SS_DEFINED;
05845                 }
05846 
05847               <font class="comment">/*</font>
05848 <font class="comment">              ** Very weak checking for array elements.</font>
05849 <font class="comment">              ** Was:</font>
05850 <font class="comment">              **     s-&gt;defstate = arr-&gt;defstate;</font>
05851 <font class="comment">              */</font>
05852             }
05853 
05854           <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (arr), g_currentloc);
05855 
05856           <font class="keywordflow">if</font> (arr-&gt;aliaskind == AK_LOCAL || arr-&gt;aliaskind == AK_FRESH)
05857             {
05858               s-&gt;aliaskind = AK_LOCAL;
05859             }
05860           <font class="keywordflow">else</font>
05861             {
05862               s-&gt;aliaskind = AK_UNKNOWN;
05863             }
05864           
05865           sRef_setTypeState (s);
05866         }
05867     }
05868   <font class="keywordflow">else</font>
05869     {
05870       <font class="keywordflow">if</font> (arr-&gt;defstate == SS_DEFINED)
05871         {
05872           <font class="comment">/*</font>
05873 <font class="comment">          ** Very weak checking for array elements.</font>
05874 <font class="comment">          ** Was:</font>
05875 <font class="comment">          **     s-&gt;defstate = arr-&gt;defstate;</font>
05876 <font class="comment">          */</font>
05877 
05878           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTDESTROY))
05879             {
05880               s-&gt;defstate = SS_DEFINED;
05881             }
05882           <font class="keywordflow">else</font>
05883             {
05884               s-&gt;defstate = SS_PARTIAL;
05885             }
05886         }
05887       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (arr-&gt;defstate == SS_ALLOCATED)
05888         {
05889           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (s-&gt;type))
05890             {
05891               s-&gt;defstate = SS_ALLOCATED;
05892             }
05893           <font class="keywordflow">else</font> 
05894             {
05895               <font class="keywordflow">if</font> (!s-&gt;info-&gt;arrayfetch-&gt;indknown)
05896                 {
05897                   <font class="comment">/*</font>
05898 <font class="comment">                  ** is index is unknown, elements is defined or </font>
05899 <font class="comment">                  ** allocated is any element is!</font>
05900 <font class="comment">                  */</font>
05901                   
05902                   s-&gt;defstate = SS_UNDEFINED;
05903                   
05904                   sRefSet_allElements (arr-&gt;deriv, sr)<font class="keyword"></font>
05905 <font class="keyword">                    </font>{
05906                       <font class="keywordflow">if</font> (sRef_isValid (sr))
05907                         {
05908                           <font class="keywordflow">if</font> (sr-&gt;defstate == SS_ALLOCATED)
05909                             {
05910                               s-&gt;defstate = SS_ALLOCATED;
05911                             }
05912                           <font class="keywordflow">else</font> 
05913                             {
05914                               <font class="keywordflow">if</font> (sr-&gt;defstate == SS_DEFINED)
05915                                 {
05916                                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTDESTROY))
05917                                     {
05918                                       s-&gt;defstate = SS_DEFINED;
05919                                     }
05920                                   <font class="keywordflow">else</font>
05921                                     {
05922                                       s-&gt;defstate = SS_PARTIAL;
05923                                     }
05924 
05925                                   <font class="keywordflow">break</font>;
05926                                 }
05927                             }
05928                         }
05929                     } end_sRefSet_allElements;
05930                   
05931                                 }
05932               <font class="keywordflow">else</font>
05933                 {
05934                   s-&gt;defstate = SS_UNDEFINED;
05935                 }
05936             }
05937         }
05938       <font class="keywordflow">else</font>
05939         {
05940           s-&gt;defstate = arr-&gt;defstate;
05941         }
05942       
05943       
05944       <font class="comment">/*</font>
05945 <font class="comment">      ** kludgey way to guess where aliaskind applies</font>
05946 <font class="comment">      */</font>
05947       
05948       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (s-&gt;type) 
05949           &amp;&amp; !<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (arr-&gt;type) 
05950           &amp;&amp; !alkind_isStatic (arr-&gt;aliaskind)
05951           &amp;&amp; !alkind_isStack (arr-&gt;aliaskind)) <font class="comment">/* evs - 2000-06-20: don't pass stack allocation to members */</font>
05952         {
05953           s-&gt;aliaskind = arr-&gt;aliaskind;
05954         }
05955       <font class="keywordflow">else</font>
05956         {
05957           s-&gt;aliaskind = AK_UNKNOWN;
05958         }
05959     
05960       sRef_setTypeState (s);
05961     }
05962 
05963   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (arr)) 
05964     {
05965       s-&gt;expkind = XO_OBSERVER;
05966     }
05967 }  
05968 
<a name="l05969"></a><a class="code" href="sRef_c.html#a264">05969</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="sRef_c.html#a264">sRef_buildArrayFetch</a> (<font class="comment">/*@exposed@*/</font> sRef arr)<font class="keyword"></font>
05970 <font class="keyword"></font>{
05971   sRef s;
05972 
05973   <font class="keywordflow">if</font> (!sRef_isValid (arr)) {
05974     <font class="comment">/*@-nullret@*/</font> <font class="keywordflow">return</font> arr <font class="comment">/*@=nullret@*/</font>;
05975   }
05976 
05977   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (arr-&gt;type))
05978     {
05979       (<font class="keywordtype">void</font>) <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (arr); <font class="comment">/* do this to define arr! */</font>
05980     }
05981   
05982   s = sRef_findDerivedArrayFetch (arr, FALSE, 0, FALSE);
05983   
05984   <font class="keywordflow">if</font> (sRef_isValid (s))
05985     {
05986       <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (arr), g_currentloc);
05987       <font class="keywordflow">return</font> s;
05988     }
05989   <font class="keywordflow">else</font>
05990     {
05991       s = sRef_new ();
05992 
05993       s-&gt;kind = SK_ARRAYFETCH;
05994       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
05995       s-&gt;info-&gt;arrayfetch = (ainfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info-&gt;arrayfetch));
05996       s-&gt;info-&gt;arrayfetch-&gt;indknown = FALSE;
05997       s-&gt;info-&gt;arrayfetch-&gt;ind = 0;
05998       s-&gt;info-&gt;arrayfetch-&gt;arr = arr;
05999       sRef_setArrayFetchState (s, arr);
06000       s-&gt;oaliaskind = s-&gt;aliaskind;
06001       s-&gt;oexpkind = s-&gt;expkind;
06002 
06003       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
06004         {
06005           sRef_addDeriv (arr, s);
06006         }
06007       
06008       <font class="keywordflow">return</font> (s);
06009     }
06010 }
06011 
06012 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06013"></a><a class="code" href="sRef_c.html#a265">06013</a>   <a class="code" href="sRef_c.html#a265">sRef_buildArrayFetchKnown</a> (<font class="comment">/*@exposed@*/</font> sRef arr, <font class="keywordtype">int</font> i)<font class="keyword"></font>
06014 <font class="keyword"></font>{
06015   sRef s;
06016 
06017   <font class="keywordflow">if</font> (!sRef_isValid (arr)) {
06018     <font class="comment">/*@-nullret@*/</font> <font class="keywordflow">return</font> arr <font class="comment">/*@=nullret@*/</font>;
06019   }
06020 
06021   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (arr-&gt;type))
06022     {
06023        (<font class="keywordtype">void</font>) <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (arr); <font class="comment">/* do this to define arr! */</font>
06024     }
06025 
06026   s = sRef_findDerivedArrayFetch (arr, TRUE, i, FALSE);
06027       
06028   <font class="keywordflow">if</font> (sRef_isValid (s))
06029     {
06030       <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (arr), g_currentloc);      
06031       <font class="keywordflow">return</font> s;
06032     }
06033   <font class="keywordflow">else</font>
06034     {
06035       s = sRef_new ();
06036       
06037       s-&gt;kind = SK_ARRAYFETCH;
06038       s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
06039       s-&gt;info-&gt;arrayfetch = (ainfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info-&gt;arrayfetch));
06040       s-&gt;info-&gt;arrayfetch-&gt;arr = arr;
06041       s-&gt;info-&gt;arrayfetch-&gt;indknown = TRUE;
06042       s-&gt;info-&gt;arrayfetch-&gt;ind = i;
06043       
06044       sRef_setArrayFetchState (s, arr);
06045       
06046       s-&gt;oaliaskind = s-&gt;aliaskind;
06047       s-&gt;oexpkind = s-&gt;expkind;
06048       sRef_addDeriv (arr, s);
06049 
06050       <font class="keywordflow">return</font> (s);
06051     }
06052 }
06053 
06054 <font class="comment">/*</font>
06055 <font class="comment">** sets everything except for defstate</font>
06056 <font class="comment">*/</font>
06057 
06058 <font class="keyword">static</font> <font class="keywordtype">void</font>
06059 sRef_setPartsFromUentry (sRef s, uentry ue)<font class="keyword"></font>
06060 <font class="keyword"></font>{
06061     
06062   llassert (sRef_isValid (s));
06063 
06064   s-&gt;aliaskind = <a class="code" href="varKinds_c.html#a9">alkind_derive</a> (s-&gt;aliaskind, uentry_getAliasKind (ue));
06065   s-&gt;oaliaskind = s-&gt;aliaskind;
06066 
06067   <font class="keywordflow">if</font> (s-&gt;expkind == XO_UNKNOWN)
06068     {
06069       s-&gt;expkind = <a class="code" href="uentry_c.html#a183">uentry_getExpKind</a> (ue);
06070     }
06071 
06072   s-&gt;oexpkind = s-&gt;expkind;
06073 
06074   <font class="keywordflow">if</font> (s-&gt;nullstate == NS_UNKNOWN)
06075     {
06076       s-&gt;nullstate = sRef_getNullState (uentry_getSref (ue));
06077     }
06078 
06079   <font class="keywordflow">if</font> (s-&gt;aliaskind == AK_IMPONLY 
06080       &amp;&amp; (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (s)))
06081     {
06082       s-&gt;oaliaskind = s-&gt;aliaskind = AK_IMPDEPENDENT;
06083     }
06084 
06085 }
06086 
06087 <font class="keyword">static</font> <font class="keywordtype">void</font>
06088 sRef_setStateFromAbstractUentry (sRef s, uentry ue)<font class="keyword"></font>
06089 <font class="keyword"></font>{
06090   llassert (sRef_isValid (s));
06091   
06092   sRef_setPartsFromUentry (s, ue);
06093 
06094   s-&gt;aliaskind = <a class="code" href="varKinds_c.html#a9">alkind_derive</a> (s-&gt;aliaskind, uentry_getAliasKind (ue));
06095   s-&gt;oaliaskind = s-&gt;aliaskind;
06096 
06097   <font class="keywordflow">if</font> (s-&gt;expkind == XO_UNKNOWN)
06098     {
06099       s-&gt;expkind = <a class="code" href="uentry_c.html#a183">uentry_getExpKind</a> (ue);
06100     }
06101 
06102   s-&gt;oexpkind = s-&gt;expkind;
06103 }
06104 
06105 <font class="keywordtype">void</font>
<a name="l06106"></a><a class="code" href="sRef_c.html#a266">06106</a> <a class="code" href="sRef_c.html#a266">sRef_setStateFromUentry</a> (sRef s, uentry ue)<font class="keyword"></font>
06107 <font class="keyword"></font>{
06108   sstate defstate;
06109 
06110   llassert (sRef_isValid (s));
06111   
06112   sRef_setPartsFromUentry (s, ue);
06113 
06114   defstate = <a class="code" href="uentry_c.html#a175">uentry_getDefState</a> (ue);
06115 
06116   <font class="keywordflow">if</font> (sstate_isKnown (defstate))
06117     {
06118       s-&gt;defstate = defstate;
06119     }
06120   <font class="keywordflow">else</font>
06121     {
06122       ;
06123     }
06124 }
06125 
06126 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06127"></a><a class="code" href="sRef_c.html#a267">06127</a>   <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (<font class="comment">/*@exposed@*/</font> sRef t)<font class="keyword"></font>
06128 <font class="keyword"></font>{
06129   DPRINTF ((<font class="stringliteral">"build pointer: %s"</font>, sRef_unparse (t)));
06130 
06131   <font class="keywordflow">if</font> (sRef_isInvalid (t)) <font class="keywordflow">return</font> sRef_undefined;
06132 
06133   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (t))
06134     {
06135       DPRINTF ((<font class="stringliteral">"Return ref: %s"</font>, sRef_unparse (t-&gt;info-&gt;ref)));
06136       <font class="keywordflow">return</font> (t-&gt;info-&gt;ref);
06137     }
06138   <font class="keywordflow">else</font>
06139     {
06140       sRef s = sRef_findDerivedPointer (t);
06141 
06142       DPRINTF ((<font class="stringliteral">"find derived: %s"</font>, sRef_unparse (s)));
06143 
06144       <font class="keywordflow">if</font> (sRef_isValid (s))
06145         {
06146           
06147           <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (t), g_currentloc);
06148           s-&gt;oaliaskind = s-&gt;aliaskind;
06149           s-&gt;oexpkind = s-&gt;expkind;
06150 
06151           <font class="keywordflow">return</font> s;
06152         }
06153       <font class="keywordflow">else</font>
06154         {
06155           s = sRef_constructPointerAux (t);
06156           
06157           DPRINTF ((<font class="stringliteral">"construct: %s"</font>, sRef_unparse (s)));
06158 
06159           <font class="keywordflow">if</font> (sRef_isValid (s))
06160             {
06161               sRef_addDeriv (t, s);
06162 
06163               s-&gt;oaliaskind = s-&gt;aliaskind;
06164               s-&gt;oexpkind = s-&gt;expkind;
06165             }
06166           
06167           <font class="keywordflow">return</font> s;
06168         }
06169     }
06170 }
06171 
06172 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06173"></a><a class="code" href="sRef_c.html#a268">06173</a> <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (sRef t)
06174    <font class="comment">/*@modifies t@*/</font>
06175 {
06176   <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (t);
06177 }
06178 
06179 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef sRef_constructDerefAux (sRef t, <font class="keywordtype">bool</font> isdead)<font class="keyword"></font>
06180 <font class="keyword"></font>{
06181   <font class="keywordflow">if</font> (sRef_isValid (t))
06182     {
06183       sRef s;
06184       
06185       <font class="comment">/*</font>
06186 <font class="comment">      ** if there is a derived t[?], return that.  Otherwise, *t.</font>
06187 <font class="comment">      */</font>
06188       
06189             
06190       s = sRef_findDerivedArrayFetch (t, FALSE, 0, isdead);
06191       
06192       <font class="keywordflow">if</font> (sRef_isValid (s))
06193         {
06194                   <font class="keywordflow">return</font> s;
06195         }
06196       <font class="keywordflow">else</font>
06197         {
06198           sRef ret = <a class="code" href="sRef_c.html#a268">sRef_constructPointer</a> (t);
06199 
06200           <font class="comment">/*</font>
06201 <font class="comment">          ** This is necessary to prevent infinite depth</font>
06202 <font class="comment">          ** in checking complete destruction.  </font>
06203 <font class="comment">          */</font>
06204 
06205           
06206           <font class="keywordflow">if</font> (isdead)
06207             {
06208               <font class="comment">/* ret-&gt;defstate = SS_UNKNOWN;  */</font>
06209               <font class="keywordflow">return</font> ret; 
06210             }
06211           <font class="keywordflow">else</font>
06212             {
06213               <font class="keywordflow">return</font> ret;
06214             }
06215         }
06216     }
06217   <font class="keywordflow">else</font>
06218     {
06219       <font class="keywordflow">return</font> sRef_undefined;
06220     }
06221 }
06222 
<a name="l06223"></a><a class="code" href="sRef_c.html#a270">06223</a> sRef <a class="code" href="sRef_c.html#a270">sRef_constructDeref</a> (sRef t)<font class="keyword"></font>
06224 <font class="keyword"></font>{
06225   <font class="keywordflow">return</font> sRef_constructDerefAux (t, FALSE);
06226 }
06227 
<a name="l06228"></a><a class="code" href="sRef_c.html#a271">06228</a> sRef <a class="code" href="sRef_c.html#a271">sRef_constructDeadDeref</a> (sRef t)<font class="keyword"></font>
06229 <font class="keyword"></font>{
06230   <font class="keywordflow">return</font> sRef_constructDerefAux (t, TRUE);
06231 }
06232 
06233 <font class="keyword">static</font> sRef
06234 sRef_constructPointerAux (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef t)<font class="keyword"></font>
06235 <font class="keyword"></font>{
06236   sRef s = sRef_new ();
06237   ctype rt = t-&gt;type;
06238   ctype st;
06239   
06240   s-&gt;kind = SK_PTR;
06241   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
06242   s-&gt;info-&gt;ref = t;
06243   
06244   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (rt))
06245     {
06246       s-&gt;type = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (rt);
06247     }
06248   
06249   st = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (s-&gt;type);
06250   
06251     
06252   <font class="keywordflow">if</font> (t-&gt;defstate == SS_UNDEFINED)
06253     {
06254       s-&gt;defstate = SS_UNUSEABLE;
06255     }
06256   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((t-&gt;defstate == SS_ALLOCATED) &amp;&amp; !ctype_isSU (st))
06257     {
06258       s-&gt;defstate = SS_UNDEFINED;
06259     }
06260   <font class="keywordflow">else</font>
06261     {
06262       s-&gt;defstate = t-&gt;defstate;
06263     }
06264   
06265   <font class="keywordflow">if</font> (t-&gt;aliaskind == AK_LOCAL || t-&gt;aliaskind == AK_FRESH)
06266     {
06267       s-&gt;aliaskind = AK_LOCAL;
06268     }
06269   <font class="keywordflow">else</font>
06270     {
06271       s-&gt;aliaskind = AK_UNKNOWN;
06272     }
06273   
06274   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (s, sRef_getExKind (t), fileloc_undefined);
06275   sRef_setTypeState (s);
06276   
06277   s-&gt;oaliaskind = s-&gt;aliaskind;
06278   s-&gt;oexpkind = s-&gt;expkind;
06279 
06280   <font class="keywordflow">return</font> s;
06281 }
06282 
<a name="l06283"></a><a class="code" href="sRef_c.html#a272">06283</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a272">sRef_hasDerived</a> (sRef s)<font class="keyword"></font>
06284 <font class="keyword"></font>{
06285   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; !sRefSet_isEmpty (s-&gt;deriv));
06286 }
06287 
06288 <font class="keywordtype">void</font>
<a name="l06289"></a><a class="code" href="sRef_c.html#a273">06289</a> <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (sRef s)<font class="keyword"></font>
06290 <font class="keyword"></font>{
06291   <font class="keywordflow">if</font> (sRef_isValid (s))
06292     {
06293             <a class="code" href="sRefSet_c.html#a5">sRefSet_clear</a> (s-&gt;deriv); 
06294     }
06295 }
06296 
06297 <font class="keywordtype">void</font>
<a name="l06298"></a><a class="code" href="sRef_c.html#a274">06298</a> <a class="code" href="sRef_c.html#a274">sRef_clearDerivedComplete</a> (sRef s)<font class="keyword"></font>
06299 <font class="keyword"></font>{
06300   
06301   <font class="keywordflow">if</font> (sRef_isValid (s))
06302     {
06303       sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);
06304 
06305       <font class="keywordflow">while</font> (sRef_isValid (base))
06306         {
06307           <a class="code" href="sRefSet_c.html#a5">sRefSet_clear</a> (base-&gt;deriv); 
06308           base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (base);
06309         }
06310 
06311       <a class="code" href="sRefSet_c.html#a5">sRefSet_clear</a> (s-&gt;deriv); 
06312     }
06313 }
06314 
06315 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06316"></a><a class="code" href="sRef_c.html#a275">06316</a> <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (sRef s)
06317    <font class="comment">/*@modifies s@*/</font>
06318 {
06319   sRef res = <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (s); 
06320 
06321   DPRINTF ((<font class="stringliteral">"Res: %s"</font>, sRef_unparse (res)));
06322   <font class="keywordflow">return</font> res;
06323 }
06324 
06325 <font class="comment">/*</font>
06326 <font class="comment">** &amp;a[] =&gt; a (this is for out params)</font>
06327 <font class="comment">*/</font>
06328 
06329 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06330"></a><a class="code" href="sRef_c.html#a276">06330</a> <a class="code" href="sRef_c.html#a276">sRef_makeAnyArrayFetch</a> (<font class="comment">/*@exposed@*/</font> sRef arr)<font class="keyword"></font>
06331 <font class="keyword"></font>{
06332   
06333   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (arr))
06334     {
06335             <font class="keywordflow">return</font> (arr-&gt;info-&gt;ref);
06336     }
06337   <font class="keywordflow">else</font>
06338     {
06339       <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a264">sRef_buildArrayFetch</a> (arr));
06340     }
06341 }
06342 
06343 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06344"></a><a class="code" href="sRef_c.html#a277">06344</a> <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (sRef arr)<font class="keyword"></font>
06345 <font class="keyword"></font>{
06346   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a264">sRef_buildArrayFetch</a> (arr));
06347 }
06348 
06349 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06350"></a><a class="code" href="sRef_c.html#a278">06350</a> <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (sRef arr, <font class="keywordtype">int</font> i)<font class="keyword"></font>
06351 <font class="keyword"></font>{
06352   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a265">sRef_buildArrayFetchKnown</a> (arr, i));
06353 }
06354 
06355 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06356"></a><a class="code" href="sRef_c.html#a279">06356</a> <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (sRef rec, <font class="comment">/*@dependent@*/</font> cstring f)<font class="keyword"></font>
06357 <font class="keyword"></font>{
06358   sRef ret;
06359   ret = <a class="code" href="sRef_c.html#a258">sRef_buildField</a> (rec, f);
06360   <font class="keywordflow">return</font> ret;
06361 }
06362 
06363 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06364"></a><a class="code" href="sRef_c.html#a280">06364</a> <a class="code" href="sRef_c.html#a280">sRef_makeNCField</a> (sRef rec, <font class="comment">/*@dependent@*/</font> cstring f)<font class="keyword"></font>
06365 <font class="keyword"></font>{
06366     <font class="keywordflow">return</font> (sRef_buildNCField (rec, f));
06367 }
06368 
06369 <font class="comment">/*@only@*/</font> cstring
<a name="l06370"></a><a class="code" href="sRef_c.html#a281">06370</a> <a class="code" href="sRef_c.html#a281">sRef_unparseKindName</a> (sRef s)<font class="keyword"></font>
06371 <font class="keyword"></font>{
06372   cstring result;
06373 
06374   <font class="keywordflow">if</font> (s == sRef_undefined) <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"&lt;invalid&gt;"</font>);
06375 
06376   s = sRef_fixConj (s);
06377 
06378   <font class="keywordflow">switch</font> (s-&gt;kind)
06379     {
06380     <font class="keywordflow">case</font> SK_CVAR: 
06381       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (s)) 
06382         {
06383           result = cstring_makeLiteral (<font class="stringliteral">"Variable"</font>);
06384         }
06385       <font class="keywordflow">else</font>
06386         {
06387           result = cstring_makeLiteral (<font class="stringliteral">"Undef global"</font>);
06388         }
06389       <font class="keywordflow">break</font>;
06390     <font class="keywordflow">case</font> SK_PARAM:
06391       result = cstring_makeLiteral (<font class="stringliteral">"Out parameter"</font>);
06392       <font class="keywordflow">break</font>;
06393     <font class="keywordflow">case</font> SK_ARRAYFETCH:
06394       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (s-&gt;info-&gt;arrayfetch-&gt;arr)) 
06395         {
06396           result = cstring_makeLiteral (<font class="stringliteral">"Out parameter"</font>);
06397         }
06398       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a134">sRef_isIndexKnown</a> (s))
06399         {
06400           result = cstring_makeLiteral (<font class="stringliteral">"Array element"</font>);
06401         }
06402       <font class="keywordflow">else</font>
06403         {
06404           result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06405         }
06406       <font class="keywordflow">break</font>;
06407     <font class="keywordflow">case</font> SK_PTR:
06408       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (s-&gt;info-&gt;ref)) 
06409         {
06410           result = cstring_makeLiteral (<font class="stringliteral">"Out parameter"</font>);
06411         }
06412       <font class="keywordflow">else</font>
06413         {
06414           result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06415         }
06416       <font class="keywordflow">break</font>;
06417     <font class="keywordflow">case</font> SK_ADR:
06418       result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06419       <font class="keywordflow">break</font>;
06420     <font class="keywordflow">case</font> SK_FIELD:
06421       result = cstring_makeLiteral (<font class="stringliteral">"Field"</font>);
06422       <font class="keywordflow">break</font>;
06423     <font class="keywordflow">case</font> SK_OBJECT:
06424       result = cstring_makeLiteral (<font class="stringliteral">"Object"</font>);
06425       <font class="keywordflow">break</font>;
06426     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
06427       result = cstring_makeLiteral (<font class="stringliteral">"&lt;anything&gt;"</font>);
06428       <font class="keywordflow">break</font>;
06429     <font class="keywordflow">case</font> SK_RESULT:
06430     <font class="keywordflow">case</font> SK_SPECIAL:
06431     <font class="keywordflow">case</font> SK_UNKNOWN:
06432     <font class="keywordflow">case</font> SK_EXTERNAL:
06433     <font class="keywordflow">case</font> SK_DERIVED:
06434     <font class="keywordflow">case</font> SK_CONST:
06435     <font class="keywordflow">case</font> SK_TYPE:
06436       result = cstring_makeLiteral (<font class="stringliteral">"&lt;unknown&gt;"</font>);
06437       <font class="keywordflow">break</font>;
06438     <font class="keywordflow">case</font> SK_CONJ:
06439       result = cstring_makeLiteral (<font class="stringliteral">"&lt;conj&gt;"</font>);
06440       <font class="keywordflow">break</font>;
06441     <font class="keywordflow">case</font> SK_NEW:
06442       result = cstring_makeLiteral (<font class="stringliteral">"Storage"</font>);
06443       <font class="keywordflow">break</font>;
06444     }
06445   
06446   <font class="keywordflow">return</font> result;
06447 }
06448 
06449 <font class="comment">/*@only@*/</font> cstring
<a name="l06450"></a><a class="code" href="sRef_c.html#a282">06450</a> <a class="code" href="sRef_c.html#a282">sRef_unparseKindNamePlain</a> (sRef s)<font class="keyword"></font>
06451 <font class="keyword"></font>{
06452   cstring result;
06453 
06454   <font class="keywordflow">if</font> (s == sRef_undefined) <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">"&lt;invalid&gt;"</font>);
06455 
06456   s = sRef_fixConj (s);
06457 
06458   <font class="keywordflow">switch</font> (s-&gt;kind)
06459     {
06460     <font class="keywordflow">case</font> SK_CVAR: 
06461       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (s)) 
06462         {
06463           result = cstring_makeLiteral (<font class="stringliteral">"Variable"</font>);
06464         }
06465       <font class="keywordflow">else</font> 
06466         {
06467           result = cstring_makeLiteral (<font class="stringliteral">"Global"</font>);
06468         }
06469       <font class="keywordflow">break</font>;
06470     <font class="keywordflow">case</font> SK_PARAM:
06471       result = cstring_makeLiteral (<font class="stringliteral">"Parameter"</font>);
06472       <font class="keywordflow">break</font>;
06473     <font class="keywordflow">case</font> SK_ARRAYFETCH:
06474       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (s-&gt;info-&gt;arrayfetch-&gt;arr)) 
06475         {
06476           result = cstring_makeLiteral (<font class="stringliteral">"Parameter"</font>);
06477         }
06478       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a134">sRef_isIndexKnown</a> (s))
06479         {
06480           result = cstring_makeLiteral (<font class="stringliteral">"Array element"</font>);
06481         }
06482       <font class="keywordflow">else</font> 
06483         {
06484           result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06485         }
06486       <font class="keywordflow">break</font>;
06487     <font class="keywordflow">case</font> SK_PTR:
06488       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (s-&gt;info-&gt;ref))
06489         {
06490           result = cstring_makeLiteral (<font class="stringliteral">"Parameter"</font>);
06491         }
06492       <font class="keywordflow">else</font>
06493         {
06494           result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06495         }
06496       <font class="keywordflow">break</font>;
06497     <font class="keywordflow">case</font> SK_ADR:
06498       result = cstring_makeLiteral (<font class="stringliteral">"Value"</font>);
06499       <font class="keywordflow">break</font>;
06500     <font class="keywordflow">case</font> SK_FIELD:
06501       result = cstring_makeLiteral (<font class="stringliteral">"Field"</font>);
06502       <font class="keywordflow">break</font>;
06503     <font class="keywordflow">case</font> SK_OBJECT:
06504       result = cstring_makeLiteral (<font class="stringliteral">"Object"</font>);
06505       <font class="keywordflow">break</font>;
06506     <font class="keywordflow">case</font> SK_NEW:
06507       result = cstring_makeLiteral (<font class="stringliteral">"Storage"</font>);
06508       <font class="keywordflow">break</font>;
06509     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
06510       result = cstring_makeLiteral (<font class="stringliteral">"&lt;anything&gt;"</font>);
06511       <font class="keywordflow">break</font>;
06512     <font class="keywordflow">case</font> SK_RESULT:
06513     <font class="keywordflow">case</font> SK_TYPE:
06514     <font class="keywordflow">case</font> SK_CONST:
06515     <font class="keywordflow">case</font> SK_EXTERNAL:
06516     <font class="keywordflow">case</font> SK_DERIVED:
06517     <font class="keywordflow">case</font> SK_UNKNOWN:
06518     <font class="keywordflow">case</font> SK_SPECIAL:
06519       result = cstring_makeLiteral (<font class="stringliteral">"&lt;unknown&gt;"</font>);
06520       <font class="keywordflow">break</font>;
06521     <font class="keywordflow">case</font> SK_CONJ:
06522       result = cstring_makeLiteral (<font class="stringliteral">"&lt;conj&gt;"</font>);
06523       <font class="keywordflow">break</font>;
06524     }
06525   
06526   <font class="keywordflow">return</font> result;
06527 }
06528 
06529 <font class="comment">/*</font>
06530 <font class="comment">** s1 &lt;- s2</font>
06531 <font class="comment">*/</font>
06532 
06533 <font class="keywordtype">void</font>
<a name="l06534"></a><a class="code" href="sRef_c.html#a283">06534</a> <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (sRef s1, sRef s2)<font class="keyword"></font>
06535 <font class="keyword"></font>{
06536   <font class="keywordflow">if</font> (sRef_isValid (s1) &amp;&amp; sRef_isValid (s2))
06537     {
06538       s1-&gt;defstate = s2-&gt;defstate;
06539       
06540       s1-&gt;nullstate = s2-&gt;nullstate;
06541       s1-&gt;nullinfo = alinfo_update (s1-&gt;nullinfo, s2-&gt;nullinfo);
06542 
06543       s1-&gt;aliaskind = s2-&gt;aliaskind;
06544       s1-&gt;aliasinfo = alinfo_update (s1-&gt;aliasinfo, s2-&gt;aliasinfo);
06545 
06546       s1-&gt;expkind = s2-&gt;expkind;
06547       s1-&gt;expinfo = alinfo_update (s1-&gt;expinfo, s2-&gt;expinfo);
06548 
06549       s1-&gt;safe = s2-&gt;safe;
06550           }
06551 }
06552 
06553 sRef
<a name="l06554"></a><a class="code" href="sRef_c.html#a284">06554</a> <a class="code" href="sRef_c.html#a284">sRef_makeNew</a> (ctype ct, sRef t, cstring name)<font class="keyword"></font>
06555 <font class="keyword"></font>{
06556   sRef s = sRef_new ();
06557 
06558   s-&gt;kind = SK_NEW;
06559   s-&gt;type = ct;
06560 
06561   llassert (sRef_isValid (t));
06562   s-&gt;defstate = t-&gt;defstate;
06563 
06564   s-&gt;aliaskind = t-&gt;aliaskind;
06565   s-&gt;oaliaskind = s-&gt;aliaskind;
06566 
06567   s-&gt;nullstate = t-&gt;nullstate;
06568 
06569   s-&gt;expkind = t-&gt;expkind;
06570   s-&gt;oexpkind = s-&gt;expkind;
06571 
06572   s-&gt;info = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*s-&gt;info));
06573   s-&gt;info-&gt;fname = name;
06574 
06575     <font class="keywordflow">return</font> s;
06576 }
06577 
06578 sRef
<a name="l06579"></a><a class="code" href="sRef_c.html#a285">06579</a> <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ctype ct)<font class="keyword"></font>
06580 <font class="keyword"></font>{
06581   sRef s = sRef_new ();
06582   
06583   s-&gt;kind = SK_TYPE;
06584   s-&gt;type = ct;
06585 
06586   s-&gt;defstate = SS_UNKNOWN; 
06587   s-&gt;aliaskind = AK_UNKNOWN;
06588   s-&gt;nullstate = NS_UNKNOWN;
06589 
06590     
06591   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ct))
06592     {
06593       typeId uid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
06594       uentry ue = <a class="code" href="usymtab_c.html#a72">usymtab_getTypeEntrySafe</a> (uid);
06595 
06596       <font class="keywordflow">if</font> (uentry_isValid (ue))
06597         {
06598           <a class="code" href="sRef_c.html#a147">sRef_mergeStateQuiet</a> (s, uentry_getSref (ue));
06599         }
06600     }
06601 
06602     s-&gt;oaliaskind = s-&gt;aliaskind;
06603   s-&gt;oexpkind = s-&gt;expkind;
06604 
06605   <font class="keywordflow">return</font> s;
06606 }
06607 
06608 sRef
<a name="l06609"></a><a class="code" href="sRef_c.html#a286">06609</a> <a class="code" href="sRef_c.html#a286">sRef_makeConst</a> (ctype ct)<font class="keyword"></font>
06610 <font class="keyword"></font>{
06611   sRef s = sRef_new ();
06612   
06613   s-&gt;kind = SK_CONST;
06614   s-&gt;type = ct;
06615 
06616   s-&gt;defstate = SS_UNKNOWN;
06617   s-&gt;aliaskind = AK_UNKNOWN;
06618   s-&gt;nullstate = NS_UNKNOWN;
06619 
06620   
06621   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (ct))
06622     {
06623       typeId uid = <a class="code" href="ctype_c.html#a105">ctype_typeId</a> (ct);
06624       uentry te = <a class="code" href="usymtab_c.html#a72">usymtab_getTypeEntrySafe</a> (uid);
06625       
06626       <font class="keywordflow">if</font> (uentry_isValid (te))
06627         {
06628           <a class="code" href="sRef_c.html#a147">sRef_mergeStateQuiet</a> (s, uentry_getSref (te));
06629         }
06630     }
06631 
06632   
06633   s-&gt;oaliaskind = s-&gt;aliaskind;
06634   s-&gt;oexpkind = s-&gt;expkind;
06635 
06636   <font class="keywordflow">return</font> s;
06637 }
06638 
<a name="l06639"></a><a class="code" href="sRef_c.html#a287">06639</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a287">sRef_hasName</a> (sRef s)<font class="keyword"></font>
06640 <font class="keyword"></font>{
06641   <font class="keywordflow">if</font> (sRef_isInvalid (s))
06642     {
06643       <font class="keywordflow">return</font> (FALSE);
06644     }
06645 
06646   <font class="keywordflow">switch</font> (s-&gt;kind)
06647     {
06648     <font class="keywordflow">case</font> SK_CVAR:
06649       {
06650         uentry u = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s-&gt;info-&gt;cvar-&gt;lexlevel,
06651                                          s-&gt;info-&gt;cvar-&gt;index);
06652         <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (u));
06653       }
06654     <font class="keywordflow">case</font> SK_PARAM:
06655       {
06656         uentry u = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (context_getParams (), 
06657                                     s-&gt;info-&gt;paramno);
06658 
06659         <font class="keywordflow">return</font> (<a class="code" href="uentry_c.html#a187">uentry_hasName</a> (u));
06660       }
06661     <font class="keywordflow">default</font>:
06662       <font class="keywordflow">return</font> TRUE;
06663     }
06664 }
06665 
06666 <font class="keywordtype">bool</font>
<a name="l06667"></a><a class="code" href="sRef_c.html#a288">06667</a> <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (sRef s1, sRef s2)<font class="keyword"></font>
06668 <font class="keyword"></font>{
06669   <font class="keywordflow">if</font> (sRef_isInvalid (s1))
06670     {
06671       <font class="keywordflow">return</font> sRef_isInvalid (s2);
06672     }
06673 
06674   <font class="keywordflow">if</font> (sRef_isInvalid (s2))
06675     {
06676       <font class="keywordflow">return</font> (FALSE);
06677     }
06678 
06679   <font class="keywordflow">switch</font> (s1-&gt;kind)
06680     {
06681     <font class="keywordflow">case</font> SK_CVAR:
06682       <font class="keywordflow">if</font> (s2-&gt;kind == SK_CVAR)
06683         {
06684           <font class="keywordflow">return</font> (s1-&gt;info-&gt;cvar-&gt;lexlevel == s2-&gt;info-&gt;cvar-&gt;lexlevel
06685                   &amp;&amp; s1-&gt;info-&gt;cvar-&gt;index == s2-&gt;info-&gt;cvar-&gt;index);
06686         }
06687       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s2-&gt;kind == SK_PARAM)
06688         {
06689           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
06690             {
06691               uentry u1 = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s1-&gt;info-&gt;cvar-&gt;lexlevel,
06692                                                s1-&gt;info-&gt;cvar-&gt;index);
06693               uentry u2 = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (context_getParams (), 
06694                                            s2-&gt;info-&gt;paramno);
06695           
06696               <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a17">cstring_equalFree</a> (uentry_getName (u1),
06697                                          <a class="code" href="uentry_c.html#a195">uentry_getName</a> (u2)));
06698             }
06699           <font class="keywordflow">else</font> 
06700             {
06701               <font class="keywordflow">return</font> FALSE;
06702             }
06703         }
06704       <font class="keywordflow">else</font>
06705         {
06706           <font class="keywordflow">return</font> FALSE;
06707         }
06708     <font class="keywordflow">case</font> SK_PARAM:
06709       {
06710         <font class="keywordflow">if</font> (s2-&gt;kind == SK_PARAM)
06711           {
06712             <font class="keywordflow">return</font> (s1-&gt;info-&gt;paramno == s2-&gt;info-&gt;paramno);
06713           }
06714         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s2-&gt;kind == SK_CVAR)
06715           {
06716             <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
06717               {
06718                 uentry u1 = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (context_getParams (), 
06719                                              s1-&gt;info-&gt;paramno);
06720                 uentry u2 = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (s2-&gt;info-&gt;cvar-&gt;lexlevel,
06721                                                  s2-&gt;info-&gt;cvar-&gt;index);
06722 
06723                 
06724                 <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a17">cstring_equalFree</a> (uentry_getName (u1),
06725                                            <a class="code" href="uentry_c.html#a195">uentry_getName</a> (u2)));
06726               }
06727             <font class="keywordflow">else</font> 
06728               {
06729                 <font class="keywordflow">return</font> FALSE;
06730               }
06731           }
06732         <font class="keywordflow">else</font>
06733           {
06734             <font class="keywordflow">return</font> FALSE;
06735           }
06736       }
06737 
06738     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
06739       <font class="keywordflow">return</font> FALSE;
06740 
06741     <font class="keywordflow">case</font> SK_ARRAYFETCH:
06742       <font class="keywordflow">if</font> (s2-&gt;kind == SK_ARRAYFETCH)
06743         {
06744           <font class="keywordflow">if</font> (bool_equal (s1-&gt;info-&gt;arrayfetch-&gt;indknown,
06745                           s2-&gt;info-&gt;arrayfetch-&gt;indknown))
06746             {
06747               <font class="keywordflow">if</font> (!s1-&gt;info-&gt;arrayfetch-&gt;indknown 
06748                   || (s1-&gt;info-&gt;arrayfetch-&gt;ind == s2-&gt;info-&gt;arrayfetch-&gt;ind))
06749                 {
06750                   <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s1-&gt;info-&gt;arrayfetch-&gt;arr,
06751                                         s2-&gt;info-&gt;arrayfetch-&gt;arr);
06752                 }
06753             }
06754         }
06755 
06756       <font class="keywordflow">return</font> FALSE;
06757     <font class="keywordflow">case</font> SK_FIELD:
06758       <font class="keywordflow">if</font> (s2-&gt;kind == SK_FIELD)
06759         {
06760           <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (s1-&gt;info-&gt;field-&gt;field,
06761                              s2-&gt;info-&gt;field-&gt;field))
06762             {
06763               <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s1-&gt;info-&gt;field-&gt;rec,
06764                                     s2-&gt;info-&gt;field-&gt;rec);
06765             }
06766 
06767         }
06768       <font class="keywordflow">return</font> FALSE;
06769     <font class="keywordflow">case</font> SK_PTR:
06770     <font class="keywordflow">case</font> SK_ADR:
06771     <font class="keywordflow">case</font> SK_DERIVED:
06772     <font class="keywordflow">case</font> SK_EXTERNAL:
06773       <font class="keywordflow">if</font> (s2-&gt;kind == s1-&gt;kind)
06774         {
06775           <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (s1-&gt;info-&gt;ref,
06776                                 s2-&gt;info-&gt;ref);
06777         }
06778 
06779       <font class="keywordflow">return</font> FALSE;
06780     <font class="keywordflow">case</font> SK_OBJECT:
06781       <font class="keywordflow">return</font> FALSE;
06782     <font class="keywordflow">case</font> SK_CONJ:
06783       <font class="keywordflow">return</font> <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (sRef_getConjA (s1), s2);
06784     <font class="keywordflow">case</font> SK_NEW:
06785       <font class="keywordflow">return</font> FALSE;
06786     <font class="keywordflow">case</font> SK_UNKNOWN:
06787       <font class="keywordflow">return</font> (s2-&gt;kind == SK_UNKNOWN);
06788     <font class="keywordflow">case</font> SK_TYPE:
06789     <font class="keywordflow">case</font> SK_CONST:
06790       <font class="keywordflow">if</font> (s2-&gt;kind == s1-&gt;kind)
06791         {
06792           <font class="keywordflow">return</font> (ctype_equal (s1-&gt;type, s2-&gt;type));
06793         }
06794       
06795       <font class="keywordflow">return</font> FALSE;
06796     <font class="keywordflow">case</font> SK_SPECIAL:
06797       <font class="keywordflow">if</font> (s2-&gt;kind == SK_SPECIAL)
06798         {
06799           <font class="keywordflow">return</font> (s1-&gt;info-&gt;spec == s2-&gt;info-&gt;spec);
06800         }
06801       <font class="keywordflow">return</font> FALSE;
06802     <font class="keywordflow">case</font> SK_RESULT:
06803       <font class="keywordflow">return</font> (s2-&gt;kind == SK_RESULT);
06804     <font class="keywordflow">default</font>:
06805       <font class="keywordflow">return</font> FALSE;
06806     }
06807   BADEXIT;
06808 }
06809                 
06810 sRef
<a name="l06811"></a><a class="code" href="sRef_c.html#a289">06811</a> <a class="code" href="sRef_c.html#a289">sRef_fixOuterRef</a> (<font class="comment">/*@returned@*/</font> sRef s)<font class="keyword"></font>
06812 <font class="keyword"></font>{
06813   sRef root = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
06814 
06815   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (root))
06816     {
06817       uentry ue = <a class="code" href="usymtab_c.html#a111">usymtab_getRefQuiet</a> (root-&gt;info-&gt;cvar-&gt;lexlevel, 
06818                                        root-&gt;info-&gt;cvar-&gt;index);
06819 
06820       <font class="keywordflow">if</font> (uentry_isValid (ue))
06821         {
06822           sRef uref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);
06823           sRef sr = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s, uref);
06824 
06825           <font class="keywordflow">return</font> (sr);
06826         }
06827       <font class="keywordflow">else</font>
06828         {
06829           llcontbug (message (<font class="stringliteral">"sRef_fixOuterRef: undefined: %q"</font>, sRef_unparseDebug (s)));
06830           <font class="keywordflow">return</font> (s);
06831         }
06832     }
06833 
06834   <font class="keywordflow">return</font> (s);
06835 }
06836 
06837 <font class="keywordtype">void</font>
<a name="l06838"></a><a class="code" href="sRef_c.html#a290">06838</a> <a class="code" href="sRef_c.html#a290">sRef_storeState</a> (sRef s)<font class="keyword"></font>
06839 <font class="keyword"></font>{
06840   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font>;
06841 
06842   s-&gt;oaliaskind = s-&gt;aliaskind;
06843   s-&gt;oexpkind = s-&gt;expkind;
06844 }
06845   
06846 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_resetStateAux (sRef s, <font class="comment">/*@unused@*/</font> fileloc loc)<font class="keyword"></font>
06847 <font class="keyword"></font>{
06848   <a class="code" href="sRef_c.html#a292">sRef_resetState</a> (s);
06849 }
06850 
06851 <font class="keywordtype">void</font>
<a name="l06852"></a><a class="code" href="sRef_c.html#a292">06852</a> <a class="code" href="sRef_c.html#a292">sRef_resetState</a> (sRef s)<font class="keyword"></font>
06853 <font class="keyword"></font>{
06854   <font class="keywordtype">bool</font> changed = FALSE;
06855   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font>;
06856 
06857   
06858   <font class="keywordflow">if</font> (s-&gt;oaliaskind == AK_KILLREF &amp;&amp; !<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (s))
06859     {
06860       <font class="comment">/*</font>
06861 <font class="comment">      ** killref is used in a kludgey way, to save having to add</font>
06862 <font class="comment">      ** another alias kind (see usymtab_handleParams)</font>
06863 <font class="comment">      */</font>
06864  
06865       <font class="keywordflow">if</font> (s-&gt;expkind != s-&gt;oexpkind)
06866         {
06867           changed = TRUE;
06868           s-&gt;expkind = s-&gt;oexpkind;
06869         }
06870     }
06871   <font class="keywordflow">else</font>
06872     {
06873       <font class="keywordflow">if</font> (s-&gt;expkind != s-&gt;oexpkind)
06874         {
06875           changed = TRUE;
06876           s-&gt;expkind = s-&gt;oexpkind;       
06877         }
06878 
06879       <font class="keywordflow">if</font> (s-&gt;aliaskind != s-&gt;oaliaskind
06880           &amp;&amp; s-&gt;aliaskind != AK_REFCOUNTED
06881           &amp;&amp; s-&gt;aliaskind != AK_REFS)
06882         {
06883           changed = TRUE;
06884           s-&gt;aliaskind = s-&gt;oaliaskind;
06885                 }
06886     }
06887 
06888   <font class="keywordflow">if</font> (changed)
06889     {
06890       <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (s);
06891     }
06892   
06893   }
06894 
06895 <font class="keywordtype">void</font>
<a name="l06896"></a><a class="code" href="sRef_c.html#a293">06896</a> <a class="code" href="sRef_c.html#a293">sRef_resetStateComplete</a> (sRef s)<font class="keyword"></font>
06897 <font class="keyword"></font>{
06898   sRef_innerAliasSetComplete (sRef_resetStateAux, s, fileloc_undefined);
06899 }
06900 
06901 <font class="comment">/*@exposed@*/</font> sRef
<a name="l06902"></a><a class="code" href="sRef_c.html#a294">06902</a> <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (<font class="comment">/*@returned@*/</font> sRef s, <font class="comment">/*@returned@*/</font> sRef base)<font class="keyword"></font>
06903 <font class="keyword"></font>{
06904   sRef tmp = sRef_undefined;
06905   sRef ret;
06906 
06907   <font class="keywordflow">if</font> (sRef_isInvalid (s)) <font class="keywordflow">return</font> s;
06908   <font class="keywordflow">if</font> (sRef_isInvalid (base)) <font class="keywordflow">return</font> base;
06909 
06910   <font class="keywordflow">switch</font> (s-&gt;kind)
06911     {
06912     <font class="keywordflow">case</font> SK_RESULT:
06913     <font class="keywordflow">case</font> SK_PARAM:
06914     <font class="keywordflow">case</font> SK_CVAR:
06915       ret = base;
06916       <font class="keywordflow">break</font>;
06917     <font class="keywordflow">case</font> SK_ARRAYFETCH:
06918       tmp = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, base);
06919 
06920       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
06921         {
06922           ret = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (tmp, s-&gt;info-&gt;arrayfetch-&gt;ind);
06923         }
06924       <font class="keywordflow">else</font>
06925         {
06926           ret = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (tmp);
06927         }
06928       <font class="keywordflow">break</font>;
06929     <font class="keywordflow">case</font> SK_FIELD:
06930       tmp = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;field-&gt;rec, base);
06931       ret = sRef_buildNCField (tmp, s-&gt;info-&gt;field-&gt;field);
06932       <font class="keywordflow">break</font>;
06933     <font class="keywordflow">case</font> SK_PTR:
06934       tmp = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;ref, base);
06935       ret = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (tmp);
06936       <font class="keywordflow">break</font>;
06937     <font class="keywordflow">case</font> SK_ADR:
06938       tmp = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;ref, base);
06939       ret = <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (tmp);
06940       <font class="keywordflow">break</font>;
06941     <font class="keywordflow">case</font> SK_CONJ:
06942       {
06943         sRef tmpb;
06944 
06945         tmp = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;conj-&gt;a, base);
06946         tmpb = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (s-&gt;info-&gt;conj-&gt;b, base);
06947 
06948         ret = <a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (tmp, tmpb);
06949         <font class="keywordflow">break</font>;
06950       }
06951       BADDEFAULT;
06952     }
06953 
06954   <font class="keywordflow">return</font> ret;
06955 }
06956 
06957 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef 
06958 sRef_fixDirectBase (sRef s, sRef base)<font class="keyword"></font>
06959 <font class="keyword"></font>{
06960   sRef ret;
06961 
06962   
06963   <font class="keywordflow">if</font> (sRef_isInvalid (s))
06964     {
06965             <font class="keywordflow">return</font> sRef_undefined;
06966     }
06967 
06968   <font class="keywordflow">switch</font> (s-&gt;kind)
06969     {
06970     <font class="keywordflow">case</font> SK_ARRAYFETCH:
06971       <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
06972         {
06973           ret = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (base, s-&gt;info-&gt;arrayfetch-&gt;ind);
06974         }
06975       <font class="keywordflow">else</font>
06976         {
06977           ret = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (base);
06978         }
06979       <font class="keywordflow">break</font>;
06980     <font class="keywordflow">case</font> SK_FIELD:
06981       ret = sRef_buildNCField (base, s-&gt;info-&gt;field-&gt;field);
06982       <font class="keywordflow">break</font>;
06983     <font class="keywordflow">case</font> SK_PTR:
06984             ret = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (base);
06985             <font class="keywordflow">break</font>;
06986     <font class="keywordflow">case</font> SK_ADR:
06987       ret = <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (base);
06988       <font class="keywordflow">break</font>;
06989     <font class="keywordflow">case</font> SK_CONJ:
06990       {
06991         sRef tmpa, tmpb;
06992 
06993         tmpa = sRef_fixDirectBase (s-&gt;info-&gt;conj-&gt;a, base);
06994         tmpb = sRef_fixDirectBase (s-&gt;info-&gt;conj-&gt;b, base);
06995 
06996         ret = <a class="code" href="sRef_c.html#a152">sRef_makeConj</a> (tmpa, tmpb);
06997         <font class="keywordflow">break</font>;
06998       }
06999       BADDEFAULT;
07000     }
07001 
07002     <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (ret, s);
07003     <font class="keywordflow">return</font> ret;
07004 }
07005 
07006 <font class="keywordtype">bool</font>
<a name="l07007"></a><a class="code" href="sRef_c.html#a295">07007</a> <a class="code" href="sRef_c.html#a295">sRef_isAllocIndexRef</a> (sRef s)<font class="keyword"></font>
07008 <font class="keyword"></font>{
07009   <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a237">sRef_isArrayFetch</a> (s) &amp;&amp; !(s-&gt;info-&gt;arrayfetch-&gt;indknown) 
07010           &amp;&amp; <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s-&gt;info-&gt;arrayfetch-&gt;arr));
07011 }
07012 
07013 <font class="keywordtype">void</font>
<a name="l07014"></a><a class="code" href="sRef_c.html#a296">07014</a> <a class="code" href="sRef_c.html#a296">sRef_showRefLost</a> (sRef s)<font class="keyword"></font>
07015 <font class="keyword"></font>{
07016   <font class="keywordflow">if</font> (sRef_hasAliasInfoLoc (s))
07017     {
07018       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Original reference lost"</font>),
07019                 sRef_getAliasInfoLoc (s));
07020     }
07021 }
07022 
07023 <font class="keywordtype">void</font>
<a name="l07024"></a><a class="code" href="sRef_c.html#a297">07024</a> <a class="code" href="sRef_c.html#a297">sRef_showRefKilled</a> (sRef s)<font class="keyword"></font>
07025 <font class="keyword"></font>{
07026   <font class="keywordflow">if</font> (sRef_hasStateInfoLoc (s))
07027     {
07028       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Storage %q released"</font>, 
07029                                sRef_unparse (s)), sRef_getStateInfoLoc (s));
07030     }
07031 }
07032 
07033 <font class="keywordtype">void</font>
<a name="l07034"></a><a class="code" href="sRef_c.html#a298">07034</a> <a class="code" href="sRef_c.html#a298">sRef_showStateInconsistent</a> (sRef s)<font class="keyword"></font>
07035 <font class="keyword"></font>{
07036   <font class="keywordflow">if</font> (sRef_hasStateInfoLoc (s))
07037     {
07038       llgenindentmsg
07039         (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qbecomes inconsistent (released on one branch)"</font>,
07040                   sRef_unparseOpt (s)), 
07041          sRef_getStateInfoLoc (s));
07042     }
07043 }
07044 
07045 <font class="keywordtype">void</font>
<a name="l07046"></a><a class="code" href="sRef_c.html#a299">07046</a> <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (sRef s)<font class="keyword"></font>
07047 <font class="keyword"></font>{
07048   <font class="keywordflow">if</font> (sRef_hasStateInfoLoc (s))
07049     {
07050       <font class="keywordflow">if</font> (s-&gt;defstate == SS_DEAD)
07051         {
07052           llgenindentmsg 
07053             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qis released"</font>, sRef_unparseOpt (s)),
07054              sRef_getStateInfoLoc (s));
07055         }
07056       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s-&gt;defstate == SS_ALLOCATED || s-&gt;defstate == SS_DEFINED)
07057         {
07058           llgenindentmsg 
07059             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qis %s"</font>, sRef_unparseOpt (s), 
07060                       <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (s-&gt;defstate)),
07061              sRef_getStateInfoLoc (s));
07062         }
07063       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s-&gt;defstate == SS_UNUSEABLE)
07064         {
07065           llgenindentmsg 
07066             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qbecomes inconsistent (clauses merge with"</font>
07067                       <font class="stringliteral">"%qreleased on one branch)"</font>,
07068                       sRef_unparseOpt (s), 
07069                       <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (s)),
07070              sRef_getStateInfoLoc (s));
07071         }
07072       <font class="keywordflow">else</font> 
07073         {
07074           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Storage %qbecomes %s"</font>, 
07075                                    sRef_unparseOpt (s), 
07076                                    <a class="code" href="varKinds_c.html#a4">sstate_unparse</a> (s-&gt;defstate)),
07077                           sRef_getStateInfoLoc (s));
07078         }
07079     }
07080 }
07081 
07082 <font class="keywordtype">void</font>
<a name="l07083"></a><a class="code" href="sRef_c.html#a300">07083</a> <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (sRef s)<font class="keyword"></font>
07084 <font class="keyword"></font>{
07085   <font class="keywordflow">if</font> (sRef_hasExpInfoLoc (s))
07086     {
07087       <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Storage %qbecomes %s"</font>, sRef_unparseOpt (s), 
07088                                <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (s-&gt;expkind)),
07089                       sRef_getExpInfoLoc (s));
07090     }
07091 }
07092 
07093 <font class="keywordtype">void</font>
<a name="l07094"></a><a class="code" href="sRef_c.html#a301">07094</a> <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (sRef s)<font class="keyword"></font>
07095 <font class="keyword"></font>{
07096   <font class="keywordflow">if</font> (sRef_hasNullInfoLoc (s) &amp;&amp; sRef_isKnown (s))
07097     {
07098       <font class="keywordflow">switch</font> (s-&gt;nullstate)
07099         {
07100         <font class="keywordflow">case</font> NS_CONSTNULL:
07101           {
07102             fileloc loc = sRef_getNullInfoLoc (s);
07103             
07104             <font class="keywordflow">if</font> (fileloc_isDefined (loc) &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (loc))
07105               {
07106                 llgenindentmsg 
07107                   (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qbecomes null"</font>, sRef_unparseOpt (s)),
07108                    loc);
07109               }
07110             <font class="keywordflow">break</font>;
07111           }
07112         <font class="keywordflow">case</font> NS_DEFNULL:
07113           {
07114             fileloc loc = sRef_getNullInfoLoc (s);
07115             
07116             <font class="keywordflow">if</font> (fileloc_isDefined (loc) &amp;&amp; !<a class="code" href="fileloc_c.html#a47">fileloc_isLib</a> (loc))
07117               {
07118                 <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (message (<font class="stringliteral">"Storage %qbecomes null"</font>, sRef_unparseOpt (s)),
07119                                 loc);
07120               }
07121             <font class="keywordflow">break</font>;
07122           }
07123         <font class="keywordflow">case</font> NS_ABSNULL:
07124         <font class="keywordflow">case</font> NS_POSNULL:
07125           llgenindentmsg
07126             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qmay become null"</font>, sRef_unparseOpt (s)),
07127              sRef_getNullInfoLoc (s));
07128           <font class="keywordflow">break</font>;
07129         <font class="keywordflow">case</font> NS_NOTNULL:
07130         <font class="keywordflow">case</font> NS_MNOTNULL:
07131           llgenindentmsg
07132             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qbecomes not null"</font>, sRef_unparseOpt (s)),
07133              sRef_getNullInfoLoc (s));
07134           <font class="keywordflow">break</font>;
07135         <font class="keywordflow">case</font> NS_UNKNOWN:
07136           llgenindentmsg
07137             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qnull state becomes unknown"</font>,
07138                       sRef_unparseOpt (s)),
07139              sRef_getNullInfoLoc (s));
07140           <font class="keywordflow">break</font>;
07141 
07142         <font class="keywordflow">case</font> NS_ERROR:
07143           BADBRANCHCONT;
07144           <font class="keywordflow">break</font>;
07145 
07146         <font class="keywordflow">default</font>:
07147           llgenindentmsg
07148             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;error case&gt; Storage %q becomes %s"</font>,
07149                       sRef_unparse (s), 
07150                       <a class="code" href="varKinds_c.html#a7">nstate_unparse</a> (s-&gt;nullstate)),
07151              sRef_getNullInfoLoc (s));
07152           
07153           <font class="keywordflow">break</font>;
07154         }
07155     }
07156 }
07157 
07158 <font class="keywordtype">void</font>
<a name="l07159"></a><a class="code" href="sRef_c.html#a302">07159</a> <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (sRef s)<font class="keyword"></font>
07160 <font class="keyword"></font>{
07161   <font class="keywordflow">if</font> (sRef_hasAliasInfoLoc (s))
07162     {
07163       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (s))
07164         {
07165           llgenindentmsg 
07166             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Fresh storage %qallocated"</font>, sRef_unparseOpt (s)),
07167              sRef_getAliasInfoLoc (s));
07168         }
07169       <font class="keywordflow">else</font> 
07170         {
07171           <font class="keywordflow">if</font> (!sRef_isRefCounted (s))
07172             {
07173               llgenindentmsg 
07174                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qbecomes %s"</font>, 
07175                           sRef_unparseOpt (s),
07176                           <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (s))),
07177                  sRef_getAliasInfoLoc (s));
07178             }
07179         }
07180     }
07181 }
07182 
07183 <font class="keywordtype">void</font>
<a name="l07184"></a><a class="code" href="sRef_c.html#a303">07184</a> <a class="code" href="sRef_c.html#a303">sRef_mergeNullState</a> (sRef s, nstate n)<font class="keyword"></font>
07185 <font class="keyword"></font>{
07186   <font class="keywordflow">if</font> (sRef_isValid (s))
07187     {
07188       nstate old;
07189       
07190       old = s-&gt;nullstate;
07191       
07192       <font class="keywordflow">if</font> (n != old &amp;&amp; n != NS_UNKNOWN)
07193         {
07194                   
07195           s-&gt;nullstate = n;
07196           s-&gt;nullinfo = alinfo_updateLoc (s-&gt;nullinfo, g_currentloc);
07197         }
07198     }
07199   <font class="keywordflow">else</font>
07200     {
07201       llbuglit (<font class="stringliteral">"sRef_mergeNullState: invalid"</font>);
07202     }
07203 }
07204 
07205 <font class="keywordtype">bool</font>
<a name="l07206"></a><a class="code" href="sRef_c.html#a304">07206</a> <a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (sRef s)<font class="keyword"></font>
07207 <font class="keyword"></font>{
07208   <font class="keywordflow">if</font> (sRef_isValid (s))
07209     {
07210       <font class="keywordflow">if</font> (s-&gt;nullstate == NS_ABSNULL)
07211         {
07212           ctype rct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (s-&gt;type);
07213 
07214           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (rct))
07215             {
07216               <font class="keywordflow">return</font> FALSE;
07217             }
07218           <font class="keywordflow">else</font>
07219             {
07220               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a32">ctype_isUser</a> (rct))
07221                 {
07222                   uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (ctype_typeId (rct));
07223                   
07224                   <font class="keywordflow">return</font> (nstate_possiblyNull
07225                           (sRef_getNullState (uentry_getSref (ue))));
07226                 }
07227               <font class="keywordflow">else</font>
07228                 {
07229                   <font class="keywordflow">return</font> FALSE;
07230                 }
07231             }
07232         }
07233       <font class="keywordflow">else</font>
07234         {
07235           <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a5">nstate_possiblyNull</a> (s-&gt;nullstate);
07236         }
07237     }
07238 
07239   <font class="keywordflow">return</font> FALSE;
07240 }
07241 
07242 cstring
<a name="l07243"></a><a class="code" href="sRef_c.html#a305">07243</a> <a class="code" href="sRef_c.html#a305">sRef_getScopeName</a> (sRef s)<font class="keyword"></font>
07244 <font class="keyword"></font>{
07245   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
07246 
07247   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a252">sRef_isRealGlobal</a> (base))
07248     {
07249       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Global"</font>));
07250     }
07251   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (base))
07252     {
07253       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Static"</font>));
07254     }
07255   <font class="keywordflow">else</font>
07256     {
07257       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Local"</font>));
07258     }
07259 }
07260 
07261 cstring
<a name="l07262"></a><a class="code" href="sRef_c.html#a306">07262</a> <a class="code" href="sRef_c.html#a306">sRef_unparseScope</a> (sRef s)<font class="keyword"></font>
07263 <font class="keyword"></font>{
07264   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
07265 
07266   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a252">sRef_isRealGlobal</a> (base))
07267     {
07268       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"global"</font>));
07269     }
07270   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (base))
07271     {
07272       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"file static"</font>));
07273     }
07274   <font class="keywordflow">else</font>
07275     {
07276       BADEXIT;
07277     }
07278 }
07279 
07280 <font class="keywordtype">int</font>
<a name="l07281"></a><a class="code" href="sRef_c.html#a307">07281</a> <a class="code" href="sRef_c.html#a307">sRef_getScope</a> (sRef s)<font class="keyword"></font>
07282 <font class="keyword"></font>{
07283   llassert (sRef_isValid (s));
07284 
07285   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (s))
07286     {
07287       <font class="keywordflow">return</font> s-&gt;info-&gt;cvar-&gt;lexlevel;
07288     }
07289   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (s))
07290     {
07291       <font class="keywordflow">return</font> paramsScope;
07292     }
07293   <font class="keywordflow">else</font>
07294     {
07295       <font class="keywordflow">return</font> fileScope;
07296     }
07297 }
07298 
07299 <font class="keywordtype">bool</font>
<a name="l07300"></a><a class="code" href="sRef_c.html#a308">07300</a> <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sRef s)<font class="keyword"></font>
07301 <font class="keyword"></font>{
07302   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s)-&gt;defstate == SS_DEAD);
07303 }
07304 
07305 <font class="keywordtype">bool</font>
<a name="l07306"></a><a class="code" href="sRef_c.html#a309">07306</a> <a class="code" href="sRef_c.html#a309">sRef_isDeadStorage</a> (sRef s)<font class="keyword"></font>
07307 <font class="keyword"></font>{
07308   <font class="keywordflow">if</font> (sRef_isValid (s))
07309     {
07310       <font class="keywordflow">if</font> (s-&gt;defstate == SS_DEAD
07311           || s-&gt;defstate == SS_UNUSEABLE
07312           || s-&gt;defstate == SS_UNDEFINED
07313           || s-&gt;defstate == SS_UNKNOWN)
07314         {
07315           <font class="keywordflow">return</font> TRUE;
07316         }
07317       <font class="keywordflow">else</font> 
07318         {
07319           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (s));
07320         }
07321     }
07322   <font class="keywordflow">else</font>
07323     {
07324       <font class="keywordflow">return</font> FALSE;
07325     }
07326 }
07327 
07328 <font class="keywordtype">bool</font>
<a name="l07329"></a><a class="code" href="sRef_c.html#a310">07329</a> <a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (sRef s)<font class="keyword"></font>
07330 <font class="keyword"></font>{
07331   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; s-&gt;defstate == SS_HOFFA);
07332 }
07333 
<a name="l07334"></a><a class="code" href="sRef_c.html#a311">07334</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a311">sRef_isStateLive</a> (sRef s)<font class="keyword"></font>
07335 <font class="keyword"></font>{
07336   <font class="keywordflow">if</font> (sRef_isValid (s))
07337     {
07338       sstate ds = s-&gt;defstate;
07339 
07340       <font class="keywordflow">return</font> (!(ds == SS_UNDEFINED 
07341                 || ds == SS_DEAD
07342                 || ds == SS_UNUSEABLE
07343                 || ds == SS_HOFFA));
07344     }
07345   <font class="keywordflow">else</font>
07346     {
07347       <font class="keywordflow">return</font> FALSE;
07348     }
07349 }
07350 
07351 
<a name="l07352"></a><a class="code" href="sRef_c.html#a312">07352</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (sRef s)<font class="keyword"></font>
07353 <font class="keyword"></font>{
07354   <font class="keywordflow">return</font> ((sRef_isValid(s)) &amp;&amp; ((s)-&gt;defstate == SS_UNDEFINED));
07355 }
07356 
<a name="l07357"></a><a class="code" href="sRef_c.html#a313">07357</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a313">sRef_isJustAllocated</a> (sRef s)<font class="keyword"></font>
07358 <font class="keyword"></font>{
07359   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s))
07360     {
07361       sRefSet_allElements (s-&gt;deriv, el)<font class="keyword"></font>
07362 <font class="keyword">        </font>{
07363           <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (el) || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (el)))
07364             {
07365               <font class="keywordflow">return</font> FALSE;
07366             }
07367         } end_sRefSet_allElements ;
07368 
07369       <font class="keywordflow">return</font> TRUE;
07370     }
07371 
07372   <font class="keywordflow">return</font> FALSE;
07373 }
07374 
07375 <font class="keyword">static</font> <font class="keywordtype">bool</font>
07376 sRef_isAllocatedStorage (sRef s)<font class="keyword"></font>
07377 <font class="keyword"></font>{
07378   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; ynm_toBoolStrict (sRef_isReadable (s)))
07379     {
07380       <font class="keywordflow">return</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (sRef_getType (s)));
07381     }
07382   <font class="keywordflow">else</font>
07383     {
07384       <font class="keywordflow">return</font> FALSE;
07385     }
07386 }
07387 
07388 <font class="keywordtype">bool</font>
<a name="l07389"></a><a class="code" href="sRef_c.html#a314">07389</a> <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (sRef s)<font class="keyword"></font>
07390 <font class="keyword"></font>{
07391   <font class="keywordflow">return</font> ((sRef_isValid(s)) &amp;&amp; ((s)-&gt;defstate == SS_UNUSEABLE));
07392 }
07393 
07394 <font class="keywordtype">bool</font>
<a name="l07395"></a><a class="code" href="sRef_c.html#a315">07395</a> <a class="code" href="sRef_c.html#a315">sRef_perhapsNull</a> (sRef s)<font class="keyword"></font>
07396 <font class="keyword"></font>{
07397   <font class="keywordflow">if</font> (sRef_isValid (s))
07398     {
07399       <font class="keywordflow">if</font> (s-&gt;nullstate == NS_ABSNULL)
07400         {
07401           ctype rct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (s-&gt;type);
07402 
07403           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (rct))
07404             {
07405               <font class="keywordflow">return</font> FALSE;
07406             }
07407           <font class="keywordflow">else</font>
07408             {
07409               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a32">ctype_isUser</a> (rct))
07410                 {
07411                   uentry ue = <a class="code" href="usymtab_c.html#a71">usymtab_getTypeEntry</a> (ctype_typeId (rct));
07412 
07413                   <font class="keywordflow">return</font> (nstate_perhapsNull 
07414                           (sRef_getNullState (uentry_getSref (ue))));
07415                 }
07416               <font class="keywordflow">else</font>
07417                 {
07418                   <font class="keywordflow">return</font> FALSE;
07419                 }
07420             }
07421         }
07422       <font class="keywordflow">else</font>
07423         {
07424           <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a6">nstate_perhapsNull</a> (s-&gt;nullstate);
07425         }
07426     }
07427 
07428   <font class="keywordflow">return</font> FALSE;
07429 }
07430 
07431 <font class="comment">/*</font>
07432 <font class="comment">** definitelyNull --- called when TRUE is good</font>
07433 <font class="comment">*/</font>
07434 
07435 <font class="keywordtype">bool</font> 
<a name="l07436"></a><a class="code" href="sRef_c.html#a316">07436</a> <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (sRef s)<font class="keyword"></font>
07437 <font class="keyword"></font>{
07438   <font class="keywordflow">return</font> (sRef_isValid (s)
07439           &amp;&amp; (s-&gt;nullstate == NS_DEFNULL || s-&gt;nullstate == NS_CONSTNULL));
07440 }
07441 
07442 <font class="comment">/*</font>
07443 <font class="comment">** based on sRef_similar</font>
07444 <font class="comment">*/</font>
07445 
07446 <font class="keywordtype">void</font>
<a name="l07447"></a><a class="code" href="sRef_c.html#a317">07447</a> <a class="code" href="sRef_c.html#a317">sRef_setDerivNullState</a> (sRef set, sRef guide, nstate ns)<font class="keyword"></font>
07448 <font class="keyword"></font>{
07449   <font class="keywordflow">if</font> (sRef_isValid (set))
07450     {
07451       sRef deriv = sRef_getDeriv (set, guide);
07452       
07453       <font class="keywordflow">if</font> (sRef_isValid (deriv))
07454         {
07455           deriv-&gt;nullstate = ns;
07456         }
07457     }
07458 }
07459 
07460 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef
07461 sRef_getDeriv (<font class="comment">/*@returned@*/</font> <font class="comment">/*@notnull@*/</font> sRef set, sRef guide)<font class="keyword"></font>
07462 <font class="keyword"></font>{
07463   llassert (sRef_isValid (set));
07464   llassert (sRef_isValid (guide));
07465 
07466   <font class="keywordflow">switch</font> (guide-&gt;kind)
07467     {
07468     <font class="keywordflow">case</font> SK_CVAR:
07469       llassert (set-&gt;kind == SK_CVAR);
07470       
07471       <font class="keywordflow">return</font> set;
07472 
07473     <font class="keywordflow">case</font> SK_PARAM:
07474       llassert (set-&gt;kind == guide-&gt;kind);
07475       llassert (set-&gt;info-&gt;paramno == guide-&gt;info-&gt;paramno);
07476 
07477       <font class="keywordflow">return</font> set;
07478 
07479     <font class="keywordflow">case</font> SK_ARRAYFETCH:
07480 
07481       <font class="keywordflow">if</font> (set-&gt;kind == SK_ARRAYFETCH
07482           &amp;&amp; (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (set-&gt;info-&gt;arrayfetch-&gt;arr,
07483                             guide-&gt;info-&gt;arrayfetch-&gt;arr)))
07484         {
07485           <font class="keywordflow">return</font> set;
07486         }
07487       <font class="keywordflow">else</font>
07488         {
07489           <font class="keywordflow">return</font> (sRef_makeAnyArrayFetch 
07490                   (sRef_getDeriv (set, guide-&gt;info-&gt;arrayfetch-&gt;arr)));
07491         }
07492 
07493     <font class="keywordflow">case</font> SK_PTR:
07494       
07495       <font class="keywordflow">if</font> (set-&gt;kind == SK_PTR &amp;&amp; <a class="code" href="sRef_c.html#a109">sRef_similar</a> (set-&gt;info-&gt;ref, guide-&gt;info-&gt;ref))
07496         {
07497           <font class="keywordflow">return</font> set;
07498         }
07499       <font class="keywordflow">else</font>
07500         {
07501           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (sRef_getDeriv (set, guide-&gt;info-&gt;ref)));
07502         }
07503       
07504     <font class="keywordflow">case</font> SK_FIELD:
07505       
07506       <font class="keywordflow">if</font> ((set-&gt;kind == SK_FIELD &amp;&amp;
07507            (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (set-&gt;info-&gt;field-&gt;rec, guide-&gt;info-&gt;field-&gt;rec) &amp;&amp;
07508             <a class="code" href="cstring_c.html#a18">cstring_equal</a> (set-&gt;info-&gt;field-&gt;field, guide-&gt;info-&gt;field-&gt;field))))
07509         {
07510           <font class="keywordflow">return</font> set;
07511         }
07512       <font class="keywordflow">else</font>
07513         {
07514           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a279">sRef_makeField</a> (sRef_getDeriv (set, guide-&gt;info-&gt;field-&gt;rec),
07515                                   guide-&gt;info-&gt;field-&gt;field));
07516         }
07517     <font class="keywordflow">case</font> SK_ADR:
07518       
07519       <font class="keywordflow">if</font> ((set-&gt;kind == SK_ADR) &amp;&amp; <a class="code" href="sRef_c.html#a109">sRef_similar</a> (set-&gt;info-&gt;ref, guide-&gt;info-&gt;ref))
07520         {
07521           <font class="keywordflow">return</font> set;
07522         }
07523       <font class="keywordflow">else</font>
07524         {
07525           <font class="keywordflow">return</font> (<a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (sRef_getDeriv (set, guide-&gt;info-&gt;ref)));
07526         }
07527 
07528     <font class="keywordflow">case</font> SK_CONJ:
07529       
07530             <font class="keywordflow">return</font> sRef_undefined;
07531 
07532     <font class="keywordflow">case</font> SK_RESULT:
07533     <font class="keywordflow">case</font> SK_SPECIAL:
07534     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
07535     <font class="keywordflow">case</font> SK_TYPE:
07536     <font class="keywordflow">case</font> SK_CONST:
07537     <font class="keywordflow">case</font> SK_NEW:
07538     <font class="keywordflow">case</font> SK_UNKNOWN:
07539     <font class="keywordflow">case</font> SK_OBJECT:
07540     <font class="keywordflow">case</font> SK_DERIVED:
07541     <font class="keywordflow">case</font> SK_EXTERNAL:
07542       <font class="keywordflow">return</font> sRef_undefined;
07543     }
07544 
07545   BADEXIT;
07546 }
07547       
07548 <font class="comment">/*</font>
07549 <font class="comment">** sRef_aliasCheckPred</font>
07550 <font class="comment">**</font>
07551 <font class="comment">** A confusing but spiffy function:</font>
07552 <font class="comment">**</font>
07553 <font class="comment">**    Calls predf (s, e, text, &lt;alias&gt;) on s and all of s's aliases</font>
07554 <font class="comment">**    (unless checkAliases (s) is FALSE).</font>
07555 <font class="comment">**</font>
07556 <font class="comment">**    For alias calls, calls as</font>
07557 <font class="comment">**          predf (alias, e, text, s)</font>
07558 <font class="comment">*/</font>
07559 
07560 <font class="keywordtype">void</font>
<a name="l07561"></a><a class="code" href="sRef_c.html#a318">07561</a> <a class="code" href="sRef_c.html#a318">sRef_aliasCheckPred</a> (<font class="keywordtype">bool</font> (predf) (sRef, exprNode, sRef, exprNode),
07562                      <font class="comment">/*@null@*/</font> bool (checkAliases) (sRef),
07563                      sRef s, exprNode e, exprNode err)
07564 {
07565   <font class="keywordtype">bool</font> error = (*predf)(s, e, sRef_undefined, err);
07566   
07567   
07568   <font class="keywordflow">if</font> (checkAliases != NULL &amp;&amp; !(checkAliases (s)))
07569     {
07570       <font class="comment">/* don't check aliases */</font>
07571     }
07572   <font class="keywordflow">else</font>
07573     {
07574       sRefSet aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (s);
07575 
07576       
07577       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07578 <font class="keyword">        </font>{
07579           <font class="keywordflow">if</font> (sRef_isValid (current))
07580             {
07581               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a109">sRef_similar</a> (current, s)
07582                   || (error &amp;&amp; <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (current, s)))
07583                 {
07584                   (<font class="keywordtype">void</font>) (*predf)(current, e, s, err);
07585                 }
07586               }
07587         } end_sRefSet_realElements;
07588 
07589       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07590     }
07591 }
07592 
07593 <font class="comment">/*</font>
07594 <font class="comment">** return TRUE iff predf (s) is true for s or any alias of s</font>
07595 <font class="comment">*/</font>
07596 
07597 <font class="keywordtype">bool</font>
<a name="l07598"></a><a class="code" href="sRef_c.html#a319">07598</a> <a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRefTest predf, sRef s)<font class="keyword"></font>
07599 <font class="keyword"></font>{
07600     
07601   <font class="keywordflow">if</font> ((*predf)(s))
07602     {
07603       <font class="keywordflow">return</font> TRUE;
07604     }
07605   <font class="keywordflow">else</font>
07606     {
07607       sRefSet aliases;
07608 
07609       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (s);
07610       
07611       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07612 <font class="keyword">        </font>{
07613           <font class="keywordflow">if</font> (sRef_isValid (current))
07614             {
07615               sRef cref = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07616               
07617               <font class="comment">/* Whoa! a very kludgey way to make sure the right sref is used</font>
07618 <font class="comment">              ** where there is a conditional symbol table.  I am beginning</font>
07619 <font class="comment">              ** to think that having a conditional symbol table wasn't such</font>
07620 <font class="comment">              ** a great idea.  ;(</font>
07621 <font class="comment">              */</font>
07622               
07623                       
07624               <font class="keywordflow">if</font> ((*predf)(cref))
07625                 {
07626                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07627                   <font class="keywordflow">return</font> TRUE;
07628                 }
07629             }
07630         } end_sRefSet_realElements;
07631 
07632       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07633     }
07634   <font class="keywordflow">return</font> FALSE;
07635 }
07636 
07637 <font class="keywordtype">bool</font>
<a name="l07638"></a><a class="code" href="sRef_c.html#a320">07638</a> <a class="code" href="sRef_c.html#a320">sRef_aliasCompleteSimplePred</a> (<font class="keywordtype">bool</font> (predf) (sRef), sRef s)
07639 {
07640   sRefSet aliases;
07641   <font class="keywordtype">bool</font> result = FALSE;
07642   
07643   
07644   aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (s);
07645   
07646   <font class="keywordflow">if</font> ((*predf)(s)) result = TRUE;
07647 
07648   
07649   sRefSet_realElements (aliases, current)<font class="keyword"></font>
07650 <font class="keyword">    </font>{
07651       <font class="keywordflow">if</font> (sRef_isValid (current))
07652         {
07653                   current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07654                   <font class="keywordflow">if</font> ((*predf)(current)) result = TRUE;
07655         }
07656     } end_sRefSet_realElements;
07657   
07658   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07659   <font class="keywordflow">return</font> result;
07660 }
07661 
07662 <font class="keyword">static</font> <font class="keywordtype">void</font>
07663 sRef_aliasSetComplete (<font class="keywordtype">void</font> (predf) (sRef, fileloc), sRef s, fileloc loc)
07664 {
07665   sRefSet aliases;
07666   
07667   aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (s);
07668 
07669   (*predf)(s, loc);
07670 
07671   sRefSet_realElements (aliases, current)<font class="keyword"></font>
07672 <font class="keyword">    </font>{
07673       <font class="keywordflow">if</font> (sRef_isValid (current))
07674         {
07675           current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07676                   ((*predf)(current, loc));
07677         }
07678     } end_sRefSet_realElements;
07679 
07680   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07681 }
07682 
07683 <font class="keyword">static</font> <font class="keywordtype">void</font>
07684 sRef_aliasSetCompleteParam (<font class="keywordtype">void</font> (predf) (sRef, alkind, fileloc), sRef s, 
07685                             alkind kind, fileloc loc)
07686 {
07687   sRefSet aliases;
07688 
07689   
07690   <font class="keywordflow">if</font> (sRef_isDeep (s))
07691     {
07692       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (s);
07693     }
07694   <font class="keywordflow">else</font>
07695     {
07696       aliases = <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (s);
07697     }
07698 
07699   (*predf)(s, kind, loc);
07700 
07701   sRefSet_realElements (aliases, current)<font class="keyword"></font>
07702 <font class="keyword">    </font>{
07703       <font class="keywordflow">if</font> (sRef_isValid (current))
07704         {
07705           current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07706                   ((*predf)(current, kind, loc));
07707         }
07708     } end_sRefSet_realElements;
07709 
07710   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07711 }
07712 
07713 <font class="keyword">static</font> <font class="keywordtype">void</font>
07714 sRef_innerAliasSetComplete (<font class="keywordtype">void</font> (predf) (sRef, fileloc), sRef s, fileloc loc)
07715 {
07716   sRef inner;
07717   sRefSet aliases;
07718   ctype ct;
07719 
07720   <font class="keywordflow">if</font> (!sRef_isValid (s)) <font class="keywordflow">return</font>;
07721 
07722   
07723   <font class="comment">/*</font>
07724 <font class="comment">  ** Type equivalence checking is necessary --- there might be casting.</font>
07725 <font class="comment">  */</font>
07726 
07727   (*predf)(s, loc);
07728 
07729   <font class="keywordflow">switch</font> (s-&gt;kind)
07730     {
07731     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
07732     <font class="keywordflow">case</font> SK_CVAR:
07733     <font class="keywordflow">case</font> SK_PARAM:
07734       <font class="keywordflow">break</font>;
07735     <font class="keywordflow">case</font> SK_PTR:
07736       inner = s-&gt;info-&gt;ref;
07737       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07738       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07739 
07740       
07741       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07742 <font class="keyword">        </font>{
07743           <font class="keywordflow">if</font> (sRef_isValid (current))
07744             {
07745               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07746               
07747               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07748                 {
07749                   sRef ptr = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (current);
07750                   
07751                   ((*predf)(ptr, loc));
07752                 }
07753             }
07754         } end_sRefSet_realElements;
07755 
07756       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07757       <font class="keywordflow">break</font>;
07758     <font class="keywordflow">case</font> SK_ARRAYFETCH:
07759       inner = s-&gt;info-&gt;arrayfetch-&gt;arr;
07760       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07761       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07762 
07763       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07764 <font class="keyword">        </font>{
07765           <font class="keywordflow">if</font> (sRef_isValid (current))
07766             {
07767               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07768               
07769               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07770                 {
07771                                   
07772                   <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
07773                     {
07774                       sRef af = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (current, s-&gt;info-&gt;arrayfetch-&gt;ind);
07775                       
07776                       ((*predf)(af, loc));
07777                     }
07778                   <font class="keywordflow">else</font>
07779                     {
07780                       sRef af = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (current);
07781                       
07782                       ((*predf)(af, loc));
07783                     }
07784                 }
07785             }
07786         } end_sRefSet_realElements;
07787 
07788       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07789       <font class="keywordflow">break</font>;
07790     <font class="keywordflow">case</font> SK_FIELD:
07791       inner = s-&gt;info-&gt;field-&gt;rec;
07792       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07793       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07794 
07795       
07796       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07797 <font class="keyword">        </font>{
07798           <font class="keywordflow">if</font> (sRef_isValid (current))
07799             {
07800               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07801               
07802               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07803                 {
07804                   sRef f = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (current, s-&gt;info-&gt;field-&gt;field);
07805                   
07806                   ((*predf)(f, loc));
07807                 }
07808             }
07809         } end_sRefSet_realElements;
07810       
07811       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07812       <font class="keywordflow">break</font>;
07813     <font class="keywordflow">case</font> SK_CONJ:
07814       sRef_innerAliasSetComplete (predf, s-&gt;info-&gt;conj-&gt;a, loc);
07815       sRef_innerAliasSetComplete (predf, s-&gt;info-&gt;conj-&gt;b, loc);
07816       <font class="keywordflow">break</font>;
07817     <font class="keywordflow">case</font> SK_SPECIAL:
07818     <font class="keywordflow">case</font> SK_ADR:
07819     <font class="keywordflow">case</font> SK_TYPE:
07820     <font class="keywordflow">case</font> SK_CONST:
07821     <font class="keywordflow">case</font> SK_NEW:
07822     <font class="keywordflow">case</font> SK_UNKNOWN:
07823     <font class="keywordflow">case</font> SK_OBJECT:
07824     <font class="keywordflow">case</font> SK_DERIVED:
07825     <font class="keywordflow">case</font> SK_EXTERNAL:
07826     <font class="keywordflow">case</font> SK_RESULT:
07827       <font class="keywordflow">break</font>;
07828     }
07829 }
07830 
07831 <font class="keyword">static</font> <font class="keywordtype">void</font>
07832 sRef_innerAliasSetCompleteParam (<font class="keywordtype">void</font> (predf) (sRef, sRef), sRef s, sRef t)
07833 {
07834   sRef inner;
07835   sRefSet aliases;
07836   ctype ct;
07837 
07838   <font class="keywordflow">if</font> (!sRef_isValid (s)) <font class="keywordflow">return</font>;
07839 
07840   
07841   <font class="comment">/*</font>
07842 <font class="comment">  ** Type equivalence checking is necessary --- there might be casting.</font>
07843 <font class="comment">  */</font>
07844 
07845   (*predf)(s, t);
07846 
07847   <font class="keywordflow">switch</font> (s-&gt;kind)
07848     {
07849     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
07850     <font class="keywordflow">case</font> SK_CVAR:
07851     <font class="keywordflow">case</font> SK_PARAM:
07852       <font class="keywordflow">break</font>;
07853     <font class="keywordflow">case</font> SK_PTR:
07854       inner = s-&gt;info-&gt;ref;
07855       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07856       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07857       
07858       
07859       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07860 <font class="keyword">        </font>{
07861           <font class="keywordflow">if</font> (sRef_isValid (current))
07862             {
07863               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07864               
07865               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07866                 {
07867                   sRef ptr = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (current);
07868                   
07869                   ((*predf)(ptr, t));
07870                 }
07871             }
07872         } end_sRefSet_realElements;
07873 
07874       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07875       <font class="keywordflow">break</font>;
07876     <font class="keywordflow">case</font> SK_ARRAYFETCH:
07877       inner = s-&gt;info-&gt;arrayfetch-&gt;arr;
07878       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07879       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07880 
07881       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07882 <font class="keyword">        </font>{
07883           <font class="keywordflow">if</font> (sRef_isValid (current))
07884             {
07885               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07886               
07887               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07888                 {
07889                                   
07890                   <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
07891                     {
07892                       sRef af = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (current, s-&gt;info-&gt;arrayfetch-&gt;ind);
07893                       
07894                       ((*predf)(af, t));
07895                     }
07896                   <font class="keywordflow">else</font>
07897                     {
07898                       sRef af = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (current);
07899                       
07900                       ((*predf)(af, t));
07901                     }
07902                 }
07903             }
07904         } end_sRefSet_realElements;
07905 
07906       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07907       <font class="keywordflow">break</font>;
07908     <font class="keywordflow">case</font> SK_FIELD:
07909       inner = s-&gt;info-&gt;field-&gt;rec;
07910       aliases = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (inner);
07911       ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (inner);
07912 
07913       
07914       sRefSet_realElements (aliases, current)<font class="keyword"></font>
07915 <font class="keyword">        </font>{
07916           <font class="keywordflow">if</font> (sRef_isValid (current))
07917             {
07918               current = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (current);
07919               
07920               <font class="keywordflow">if</font> (ctype_equal (ct, sRef_getType (current)))
07921                 {
07922                   sRef f = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (current, s-&gt;info-&gt;field-&gt;field);
07923                   
07924                   ((*predf)(f, t));
07925                 }
07926             }
07927         } end_sRefSet_realElements;
07928       
07929       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
07930       <font class="keywordflow">break</font>;
07931     <font class="keywordflow">case</font> SK_CONJ:
07932       sRef_innerAliasSetCompleteParam (predf, s-&gt;info-&gt;conj-&gt;a, t);
07933       sRef_innerAliasSetCompleteParam (predf, s-&gt;info-&gt;conj-&gt;b, t);
07934       <font class="keywordflow">break</font>;
07935     <font class="keywordflow">case</font> SK_SPECIAL:
07936     <font class="keywordflow">case</font> SK_ADR:
07937     <font class="keywordflow">case</font> SK_TYPE:
07938     <font class="keywordflow">case</font> SK_CONST:
07939     <font class="keywordflow">case</font> SK_NEW:
07940     <font class="keywordflow">case</font> SK_UNKNOWN:
07941     <font class="keywordflow">case</font> SK_OBJECT:
07942     <font class="keywordflow">case</font> SK_DERIVED:
07943     <font class="keywordflow">case</font> SK_EXTERNAL:
07944     <font class="keywordflow">case</font> SK_RESULT:
07945       <font class="keywordflow">break</font>;
07946     }
07947 }
07948 
07949 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_combineExKinds (<font class="comment">/*@notnull@*/</font> sRef res, <font class="comment">/*@notnull@*/</font> sRef other)<font class="keyword"></font>
07950 <font class="keyword"></font>{
07951   exkind a1 = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (res);
07952   exkind a2 = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (other);
07953 
07954   <font class="keywordflow">if</font> (a1 == a2 || a2 == XO_UNKNOWN) 
07955     {
07956       ;
07957     }
07958   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (a1 == XO_UNKNOWN) 
07959     { 
07960       res-&gt;expinfo = alinfo_update (res-&gt;expinfo, other-&gt;expinfo);
07961       res-&gt;expkind = a2;
07962     }
07963   <font class="keywordflow">else</font>
07964     {
07965       res-&gt;expkind = XO_OBSERVER;
07966     }
07967 }
07968 
07969 <font class="comment">/*</font>
07970 <font class="comment">** Currently, this is a very ad hoc implementation, with lots of fixes to</font>
07971 <font class="comment">** make real code work okay.  I need to come up with some more general</font>
07972 <font class="comment">** rules or principles here.</font>
07973 <font class="comment">*/</font>
07974 
07975 <font class="keyword">static</font> <font class="keywordtype">void</font> 
07976   sRef_combineAliasKindsError (<font class="comment">/*@notnull@*/</font> sRef res, 
07977                                <font class="comment">/*@notnull@*/</font> sRef other, 
07978                                clause cl, fileloc loc)<font class="keyword"></font>
07979 <font class="keyword"></font>{
07980   <font class="keywordtype">bool</font> hasError = FALSE;
07981   alkind ares = sRef_getAliasKind (res);
07982   alkind aother = sRef_getAliasKind (other);
07983 
07984   <font class="keywordflow">if</font> (alkind_isDependent (ares))
07985     {
07986       <font class="keywordflow">if</font> (aother == AK_KEPT)
07987         {
07988           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
07989           res-&gt;aliaskind = AK_KEPT;      
07990         }
07991       <font class="keywordflow">else</font> 
07992         {
07993           <font class="keywordflow">if</font> (aother == AK_LOCAL || aother == AK_STATIC 
07994               || alkind_isTemp (aother))
07995             {
07996               res-&gt;aliaskind = AK_DEPENDENT;
07997             }
07998         }
07999     }
08000   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isDependent (aother))
08001     {
08002       <font class="keywordflow">if</font> (ares == AK_KEPT)
08003         {
08004           res-&gt;aliaskind = AK_KEPT;      
08005         }
08006       <font class="keywordflow">else</font> 
08007         {
08008           <font class="keywordflow">if</font> (ares == AK_LOCAL || ares == AK_STATIC || alkind_isTemp (ares))
08009             {
08010               res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08011               res-&gt;aliaskind = AK_DEPENDENT;
08012             }
08013         }
08014     }
08015   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_LOCAL || ares == AK_UNIQUE
08016             || ares == AK_STATIC || alkind_isTemp (ares))
08017            &amp;&amp; <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (other))
08018     {
08019       <font class="comment">/*</font>
08020 <font class="comment">      ** cases like: if (s == NULL) s = malloc...;</font>
08021 <font class="comment">      **    don't generate errors</font>
08022 <font class="comment">      */</font>
08023       
08024       <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a37">usymtab_isAltProbablyDeepNull</a> (res))
08025         {
08026           res-&gt;aliaskind = ares;
08027         }
08028       <font class="keywordflow">else</font>
08029         {
08030           hasError = TRUE; 
08031         }
08032     }
08033   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((aother == AK_LOCAL || aother == AK_UNIQUE
08034             || aother == AK_STATIC || alkind_isTemp (aother))
08035            &amp;&amp; <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (res))
08036     {
08037       <font class="comment">/*</font>
08038 <font class="comment">      ** cases like: if (s == NULL) s = malloc...;</font>
08039 <font class="comment">      **    don't generate errors</font>
08040 <font class="comment">      */</font>
08041       
08042       <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a147">usymtab_isProbableDeepNull</a> (other))
08043         {
08044           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08045           res-&gt;aliaskind = aother;
08046         }
08047       <font class="keywordflow">else</font>
08048         {
08049           hasError = TRUE;
08050         }
08051     }
08052   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ares == AK_NEWREF &amp;&amp; aother == AK_REFCOUNTED 
08053            &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (other))
08054     {
08055       res-&gt;aliaskind = AK_NEWREF;
08056     }
08057   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (aother == AK_NEWREF &amp;&amp; ares == AK_REFCOUNTED
08058            &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (res))
08059     {
08060       res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08061       res-&gt;aliaskind = AK_NEWREF;
08062     }
08063   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (res)
08064            &amp;&amp; ((ares == AK_KEPT &amp;&amp; aother == AK_LOCAL)
08065                || (aother == AK_KEPT &amp;&amp; ares == AK_LOCAL)))
08066     {
08067       res-&gt;aliaskind = AK_KEPT;
08068     }
08069   <font class="keywordflow">else</font>
08070     {
08071       hasError = TRUE;
08072     }
08073 
08074   <font class="keywordflow">if</font> (hasError)
08075     {
08076       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (res))
08077         {
08078           <font class="keywordflow">if</font> (optgenerror2 
08079               (FLG_BRANCHSTATE, FLG_STRICTBRANCHSTATE,
08080                message
08081                (<font class="stringliteral">"Clauses exit with %q possibly referencing %s storage %s, "</font>
08082                 <font class="stringliteral">"%s storage %s"</font>, 
08083                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (res),
08084                 <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (aother),
08085                 <a class="code" href="clause_c.html#a1">clause_nameTaken</a> (cl),
08086                 <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (ares),
08087                 <a class="code" href="clause_c.html#a2">clause_nameAlternate</a> (cl)),
08088                loc))
08089             {
08090               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (res);
08091               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (other);
08092               res-&gt;aliaskind = AK_ERROR;
08093             }
08094           <font class="keywordflow">else</font>
08095             {
08096               <font class="keywordflow">if</font> (ares == AK_KEPT || aother == AK_KEPT)
08097                 {
08098                   <a class="code" href="sRef_c.html#a230">sRef_maybeKill</a> (res, loc);
08099                                 }
08100             }
08101         }
08102       <font class="keywordflow">else</font> 
08103         {
08104           <font class="keywordflow">if</font> (optgenerror 
08105               (FLG_BRANCHSTATE,
08106                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Clauses exit with %q referencing %s storage %s, "</font>
08107                         <font class="stringliteral">"%s storage %s"</font>, 
08108                         sRef_unparse (res),
08109                         <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (aother),
08110                         <a class="code" href="clause_c.html#a1">clause_nameTaken</a> (cl),
08111                         <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (ares),
08112                         <a class="code" href="clause_c.html#a2">clause_nameAlternate</a> (cl)),
08113                loc))
08114             {
08115               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (res);
08116               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (other);
08117               
08118               res-&gt;aliaskind = AK_ERROR;
08119             }
08120         }
08121       
08122       res-&gt;aliaskind = (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (res) ? AK_LOCAL : AK_UNKNOWN);
08123     }
08124 }
08125 
08126 <font class="keyword">static</font> <font class="keywordtype">void</font> 
08127   sRef_combineAliasKinds (<font class="comment">/*@notnull@*/</font> sRef res, <font class="comment">/*@notnull@*/</font> sRef other, 
08128                           clause cl, fileloc loc)<font class="keyword"></font>
08129 <font class="keyword"></font>{
08130   alkind ares = sRef_getAliasKind (res);
08131   alkind aother = sRef_getAliasKind (other);
08132 
08133   <font class="keywordflow">if</font> (<a class="code" href="varKinds_c.html#a21">alkind_equal</a> (ares, aother)
08134       || aother == AK_UNKNOWN
08135       || aother == AK_ERROR)
08136     {
08137       ; <font class="comment">/* keep current state */</font>
08138     }
08139   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (res) || <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (other))
08140     {
08141       <font class="comment">/* dead error reported (or storage is dead) */</font>
08142       res -&gt;aliaskind = AK_ERROR; 
08143     }
08144   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ares == AK_UNKNOWN || ares == AK_ERROR
08145            || <a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (res))
08146     { 
08147       res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08148       res-&gt;aliaskind = aother;  
08149     }
08150   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (other))
08151     {
08152       ;
08153     }
08154   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (((ares == AK_UNIQUE || alkind_isTemp (ares))
08155             &amp;&amp; aother == AK_LOCAL) 
08156            || ((aother == AK_UNIQUE || alkind_isTemp (aother))
08157                &amp;&amp; ares == AK_LOCAL))
08158     {
08159       <font class="keywordflow">if</font> (ares != AK_LOCAL)
08160         {
08161           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08162         }
08163 
08164       res-&gt;aliaskind = AK_LOCAL;
08165     }
08166   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_OWNED &amp;&amp; aother == AK_FRESH) 
08167            || (aother == AK_OWNED &amp;&amp; ares == AK_FRESH))
08168     {
08169       <font class="keywordflow">if</font> (ares != AK_FRESH)
08170         {
08171           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08172         }
08173       
08174       res-&gt;aliaskind = AK_FRESH;
08175     }
08176   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_KEEP &amp;&amp; aother == AK_FRESH) ||
08177            (aother == AK_KEEP &amp;&amp; ares == AK_FRESH))
08178     {
08179       <font class="keywordflow">if</font> (ares != AK_KEEP)
08180         {
08181           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08182         }
08183       
08184       res-&gt;aliaskind = AK_KEEP;
08185     }
08186   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_LOCAL &amp;&amp; aother == AK_STACK) ||
08187            (aother == AK_LOCAL &amp;&amp; ares == AK_STACK))
08188     {
08189       <font class="keywordflow">if</font> (ares != AK_STACK)
08190         {
08191           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08192         }
08193 
08194       res-&gt;aliaskind = AK_STACK;
08195     }
08196   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_LOCAL
08197             &amp;&amp; (aother == AK_OWNED &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (other)))
08198            || (aother == AK_LOCAL 
08199                &amp;&amp; (ares == AK_OWNED &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (res))))
08200     {
08201       <font class="keywordflow">if</font> (ares != AK_LOCAL)
08202         {
08203           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08204         }
08205 
08206       res-&gt;aliaskind = AK_LOCAL;
08207     }
08208   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((ares == AK_FRESH &amp;&amp; alkind_isOnly (aother))
08209            || (aother == AK_FRESH &amp;&amp; alkind_isOnly (ares)))
08210     {
08211       res-&gt;aliaskind = AK_FRESH;
08212     }
08213   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((aother == AK_FRESH &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (res))
08214            || (ares == AK_FRESH &amp;&amp; <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (other)))
08215     {
08216       <font class="keywordflow">if</font> (ares != AK_FRESH)
08217         {
08218           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08219           res-&gt;aliaskind = AK_FRESH;
08220         }
08221     }
08222   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (res) &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (other))
08223            || (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (other) &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (res)))
08224     {
08225       <font class="comment">/*</font>
08226 <font class="comment">      ** for NULL constantants</font>
08227 <font class="comment">      ** this is bogus!</font>
08228 <font class="comment">      */</font>
08229 
08230       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (res))
08231         {
08232           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08233         }
08234 
08235       res-&gt;aliaskind = AK_FRESH;
08236     }
08237   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((alkind_isStatic (aother) &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (res))
08238            || (alkind_isStatic (ares) &amp;&amp; <a class="code" href="sRef_c.html#a240">sRef_isConst</a> (other)))
08239     {
08240       <font class="keywordflow">if</font> (!alkind_isStatic (ares))
08241         {
08242           res-&gt;aliasinfo = alinfo_update (res-&gt;aliasinfo, other-&gt;aliasinfo);
08243           res-&gt;aliaskind = AK_STATIC;
08244         }
08245     }
08246   <font class="keywordflow">else</font>
08247     {
08248       sRef_combineAliasKindsError (res, other, cl, loc);
08249     }
08250 }
08251 
08252 <font class="keyword">static</font> <font class="keywordtype">void</font> sRef_combineDefState (<font class="comment">/*@notnull@*/</font> sRef res, 
08253                                   <font class="comment">/*@notnull@*/</font> sRef other)<font class="keyword"></font>
08254 <font class="keyword"></font>{
08255   sstate s1 = res-&gt;defstate;
08256   sstate s2 = other-&gt;defstate;
08257   <font class="keywordtype">bool</font> flip = FALSE;
08258 
08259   <font class="keywordflow">if</font> (s1 == s2 || s2 == SS_UNKNOWN)
08260     {
08261       ;
08262     }
08263   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (s1 == SS_UNKNOWN)
08264     {
08265       flip = TRUE;
08266     }
08267   <font class="keywordflow">else</font>
08268     {
08269       <font class="keywordflow">switch</font> (s1)
08270         {
08271         <font class="keywordflow">case</font> SS_FIXED:   
08272           <font class="keywordflow">if</font> (s2 == SS_DEFINED) 
08273             {
08274               <font class="keywordflow">break</font>;
08275             }
08276           <font class="keywordflow">else</font>
08277             {
08278               llcontbuglit (<font class="stringliteral">"ssfixed: not implemented"</font>);
08279               flip = TRUE;
08280             }
08281           <font class="keywordflow">break</font>;
08282         <font class="keywordflow">case</font> SS_DEFINED: 
08283           flip = TRUE;
08284           <font class="keywordflow">break</font>;
08285         <font class="keywordflow">case</font> SS_PDEFINED:
08286         <font class="keywordflow">case</font> SS_ALLOCATED: 
08287           flip = (s2 != SS_DEFINED);
08288           <font class="keywordflow">break</font>;
08289         <font class="keywordflow">case</font> SS_HOFFA:
08290         <font class="keywordflow">case</font> SS_RELDEF:
08291         <font class="keywordflow">case</font> SS_UNUSEABLE: 
08292         <font class="keywordflow">case</font> SS_UNDEFINED: 
08293         <font class="keywordflow">case</font> SS_PARTIAL:
08294         <font class="keywordflow">case</font> SS_UNDEFGLOB:
08295         <font class="keywordflow">case</font> SS_KILLED:
08296         <font class="keywordflow">case</font> SS_DEAD:      
08297         <font class="keywordflow">case</font> SS_SPECIAL: 
08298           <font class="keywordflow">break</font>;
08299         BADDEFAULT;
08300         }
08301     }
08302 
08303   <font class="keywordflow">if</font> (flip)
08304     {
08305       res-&gt;definfo = alinfo_update (res-&gt;definfo, other-&gt;definfo);
08306       res-&gt;defstate = s2;
08307     }
08308 }
08309 
<a name="l08310"></a><a class="code" href="sRef_c.html#a326">08310</a> <font class="keyword">extern</font> <font class="comment">/*@notnull@*/</font> sRef <a class="code" href="sRef_c.html#a326">sRef_getConjA</a> (sRef s)<font class="keyword"></font>
08311 <font class="keyword"></font>{
08312   sRef ret;
08313   llassert (sRef_isConj (s));
08314 
08315   ret = s-&gt;info-&gt;conj-&gt;a;
08316   llassert (ret != NULL);
08317   <font class="keywordflow">return</font> ret;
08318 }
08319 
<a name="l08320"></a><a class="code" href="sRef_c.html#a327">08320</a> <font class="keyword">extern</font> <font class="comment">/*@notnull@*/</font> sRef <a class="code" href="sRef_c.html#a327">sRef_getConjB</a> (sRef s)<font class="keyword"></font>
08321 <font class="keyword"></font>{
08322   sRef ret;
08323   llassert (sRef_isConj (s));
08324 
08325   ret = s-&gt;info-&gt;conj-&gt;b;
08326   llassert (ret != NULL);
08327   <font class="keywordflow">return</font> ret;
08328 }
08329   
<a name="l08330"></a><a class="code" href="sRef_c.html#a328">08330</a> <font class="keyword">extern</font> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (sRef s, <font class="comment">/*@dependent@*/</font> cstring f)<font class="keyword"></font>
08331 <font class="keyword"></font>{
08332   sRef p;
08333   sRef ret;
08334 
08335     p = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (s);
08336   ret = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (p, f);
08337     <font class="keywordflow">return</font> ret;
08338 }
08339 
<a name="l08340"></a><a class="code" href="sRef_c.html#a329">08340</a> <font class="keyword">extern</font> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="sRef_c.html#a329">sRef_buildArrow</a> (sRef s, cstring f)<font class="keyword"></font>
08341 <font class="keyword"></font>{
08342   sRef p;
08343   sRef ret;
08344 
08345   p = <a class="code" href="sRef_c.html#a267">sRef_buildPointer</a> (s);
08346   ret = <a class="code" href="sRef_c.html#a258">sRef_buildField</a> (p, f);
08347   
08348   <font class="keywordflow">return</font> ret;
08349 }
08350 
08351 <font class="keyword">static</font> <font class="comment">/*@null@*/</font> sinfo sinfo_copy (<font class="comment">/*@notnull@*/</font> sRef s)<font class="keyword"></font>
08352 <font class="keyword"></font>{
08353   sinfo ret;
08354 
08355   <font class="keywordflow">switch</font> (s-&gt;kind)
08356     {
08357     <font class="keywordflow">case</font> SK_CVAR:
08358       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08359       ret-&gt;cvar = (cref) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;cvar));
08360       ret-&gt;cvar-&gt;lexlevel = s-&gt;info-&gt;cvar-&gt;lexlevel; 
08361       ret-&gt;cvar-&gt;index = s-&gt;info-&gt;cvar-&gt;index; 
08362       <font class="keywordflow">break</font>;
08363 
08364     <font class="keywordflow">case</font> SK_PARAM:
08365       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08366       ret-&gt;paramno = s-&gt;info-&gt;paramno; 
08367       <font class="keywordflow">break</font>;
08368 
08369     <font class="keywordflow">case</font> SK_ARRAYFETCH:
08370       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08371       ret-&gt;arrayfetch = (ainfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;arrayfetch));
08372       ret-&gt;arrayfetch-&gt;indknown = s-&gt;info-&gt;arrayfetch-&gt;indknown;
08373       ret-&gt;arrayfetch-&gt;ind = s-&gt;info-&gt;arrayfetch-&gt;ind;
08374       ret-&gt;arrayfetch-&gt;arr = s-&gt;info-&gt;arrayfetch-&gt;arr;
08375       <font class="keywordflow">break</font>;
08376 
08377     <font class="keywordflow">case</font> SK_FIELD:
08378       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08379       ret-&gt;field = (fldinfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;field));
08380       ret-&gt;field-&gt;rec = s-&gt;info-&gt;field-&gt;rec;
08381       ret-&gt;field-&gt;field = s-&gt;info-&gt;field-&gt;field; 
08382       <font class="keywordflow">break</font>;
08383 
08384     <font class="keywordflow">case</font> SK_OBJECT:
08385       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08386       ret-&gt;object = s-&gt;info-&gt;object;
08387       <font class="keywordflow">break</font>;
08388 
08389     <font class="keywordflow">case</font> SK_PTR:
08390     <font class="keywordflow">case</font> SK_ADR:
08391     <font class="keywordflow">case</font> SK_DERIVED:
08392     <font class="keywordflow">case</font> SK_EXTERNAL:
08393       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08394       ret-&gt;ref = s-&gt;info-&gt;ref;   
08395       <font class="keywordflow">break</font>;
08396 
08397     <font class="keywordflow">case</font> SK_CONJ:
08398       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08399       ret-&gt;conj = (cjinfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;conj));
08400       ret-&gt;conj-&gt;a = s-&gt;info-&gt;conj-&gt;a;
08401       ret-&gt;conj-&gt;b = s-&gt;info-&gt;conj-&gt;b;
08402       <font class="keywordflow">break</font>;
08403     <font class="keywordflow">case</font> SK_SPECIAL:
08404       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08405       ret-&gt;spec = s-&gt;info-&gt;spec;
08406       <font class="keywordflow">break</font>;
08407     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
08408     <font class="keywordflow">case</font> SK_NEW:
08409       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08410       ret-&gt;fname = s-&gt;info-&gt;fname;
08411       <font class="keywordflow">break</font>;
08412     <font class="keywordflow">case</font> SK_RESULT:
08413     <font class="keywordflow">case</font> SK_CONST:
08414     <font class="keywordflow">case</font> SK_TYPE:
08415     <font class="keywordflow">case</font> SK_UNKNOWN:
08416       llassertprint (s-&gt;info == NULL, ("s = %s", sRef_unparse (s)));
08417       ret = NULL;
08418       <font class="keywordflow">break</font>;
08419     }
08420 
08421   <font class="keywordflow">return</font> ret;
08422 }
08423 
08424 <font class="keyword">static</font> <font class="comment">/*@null@*/</font> sinfo sinfo_fullCopy (<font class="comment">/*@notnull@*/</font> sRef s)<font class="keyword"></font>
08425 <font class="keyword"></font>{
08426   sinfo ret;
08427 
08428   <font class="comment">/*</font>
08429 <font class="comment">  ** Since its a full copy, only storage is assigned</font>
08430 <font class="comment">  ** to dependent fields.</font>
08431 <font class="comment">  */</font>
08432   <font class="comment">/*@-onlytrans@*/</font>
08433 
08434   <font class="keywordflow">switch</font> (s-&gt;kind)
08435     {
08436     <font class="keywordflow">case</font> SK_CVAR:
08437       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08438       ret-&gt;cvar = (cref) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;cvar));
08439       ret-&gt;cvar-&gt;lexlevel = s-&gt;info-&gt;cvar-&gt;lexlevel; 
08440       ret-&gt;cvar-&gt;index = s-&gt;info-&gt;cvar-&gt;index; 
08441       <font class="keywordflow">break</font>;
08442 
08443     <font class="keywordflow">case</font> SK_PARAM:
08444       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08445       ret-&gt;paramno = s-&gt;info-&gt;paramno; 
08446       <font class="keywordflow">break</font>;
08447 
08448     <font class="keywordflow">case</font> SK_ARRAYFETCH:
08449       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08450       ret-&gt;arrayfetch = (ainfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;arrayfetch));
08451       ret-&gt;arrayfetch-&gt;indknown = s-&gt;info-&gt;arrayfetch-&gt;indknown;
08452       ret-&gt;arrayfetch-&gt;ind = s-&gt;info-&gt;arrayfetch-&gt;ind;
08453       ret-&gt;arrayfetch-&gt;arr = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s-&gt;info-&gt;arrayfetch-&gt;arr);
08454       <font class="keywordflow">break</font>;
08455 
08456     <font class="keywordflow">case</font> SK_FIELD:
08457       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08458       ret-&gt;field = (fldinfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;field));
08459       ret-&gt;field-&gt;rec = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s-&gt;info-&gt;field-&gt;rec);
08460       ret-&gt;field-&gt;field = s-&gt;info-&gt;field-&gt;field; 
08461       <font class="keywordflow">break</font>;
08462 
08463     <font class="keywordflow">case</font> SK_OBJECT:
08464       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08465       ret-&gt;object = s-&gt;info-&gt;object;
08466       <font class="keywordflow">break</font>;
08467 
08468     <font class="keywordflow">case</font> SK_PTR:
08469     <font class="keywordflow">case</font> SK_ADR:
08470     <font class="keywordflow">case</font> SK_DERIVED:
08471     <font class="keywordflow">case</font> SK_EXTERNAL:
08472       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08473       ret-&gt;ref = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s-&gt;info-&gt;ref);   
08474       <font class="keywordflow">break</font>;
08475 
08476     <font class="keywordflow">case</font> SK_CONJ:
08477       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08478       ret-&gt;conj = (cjinfo) dmalloc (<font class="keyword">sizeof</font> (*ret-&gt;conj));
08479       ret-&gt;conj-&gt;a = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s-&gt;info-&gt;conj-&gt;a);
08480       ret-&gt;conj-&gt;b = <a class="code" href="sRef_c.html#a233">sRef_saveCopy</a> (s-&gt;info-&gt;conj-&gt;b);
08481       <font class="keywordflow">break</font>;
08482     <font class="keywordflow">case</font> SK_SPECIAL:
08483       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08484       ret-&gt;spec = s-&gt;info-&gt;spec;
08485       <font class="keywordflow">break</font>;
08486     <font class="keywordflow">case</font> SK_NEW:
08487     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
08488       ret = (sinfo) dmalloc (<font class="keyword">sizeof</font> (*ret));
08489       ret-&gt;fname = s-&gt;info-&gt;fname;
08490       <font class="keywordflow">break</font>;
08491     <font class="keywordflow">case</font> SK_CONST:
08492     <font class="keywordflow">case</font> SK_TYPE:
08493     <font class="keywordflow">case</font> SK_RESULT:
08494     <font class="keywordflow">case</font> SK_UNKNOWN:
08495       llassert (s-&gt;info == NULL);
08496       ret = NULL;
08497       <font class="keywordflow">break</font>;
08498     }
08499   <font class="comment">/*@=onlytrans@*/</font> 
08500   <font class="keywordflow">return</font> ret;
08501 }
08502 
08503 
08504 <font class="keyword">static</font> <font class="keywordtype">void</font> 
08505   sinfo_update (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef res, 
08506                 <font class="comment">/*@notnull@*/</font> <font class="comment">/*@exposed@*/</font> sRef other)<font class="keyword"></font>
08507 <font class="keyword"></font>{
08508   llassert (res-&gt;kind == other-&gt;kind);
08509 
08510   <font class="keywordflow">switch</font> (res-&gt;kind)
08511     {
08512     <font class="keywordflow">case</font> SK_CVAR:
08513       res-&gt;info-&gt;cvar-&gt;lexlevel = other-&gt;info-&gt;cvar-&gt;lexlevel; 
08514       res-&gt;info-&gt;cvar-&gt;index = other-&gt;info-&gt;cvar-&gt;index; 
08515       <font class="keywordflow">break</font>;
08516 
08517     <font class="keywordflow">case</font> SK_PARAM:
08518       res-&gt;info-&gt;paramno = other-&gt;info-&gt;paramno; 
08519       <font class="keywordflow">break</font>;
08520 
08521     <font class="keywordflow">case</font> SK_ARRAYFETCH:
08522       res-&gt;info-&gt;arrayfetch-&gt;indknown = other-&gt;info-&gt;arrayfetch-&gt;indknown;
08523       res-&gt;info-&gt;arrayfetch-&gt;ind = other-&gt;info-&gt;arrayfetch-&gt;ind;
08524       res-&gt;info-&gt;arrayfetch-&gt;arr = other-&gt;info-&gt;arrayfetch-&gt;arr;
08525       <font class="keywordflow">break</font>;
08526 
08527     <font class="keywordflow">case</font> SK_FIELD:
08528       res-&gt;info-&gt;field-&gt;rec = other-&gt;info-&gt;field-&gt;rec;
08529       res-&gt;info-&gt;field-&gt;field = other-&gt;info-&gt;field-&gt;field; 
08530       <font class="keywordflow">break</font>;
08531 
08532     <font class="keywordflow">case</font> SK_OBJECT:
08533       res-&gt;info-&gt;object = other-&gt;info-&gt;object;
08534       <font class="keywordflow">break</font>;
08535 
08536     <font class="keywordflow">case</font> SK_PTR:
08537     <font class="keywordflow">case</font> SK_ADR:
08538     <font class="keywordflow">case</font> SK_DERIVED:
08539     <font class="keywordflow">case</font> SK_EXTERNAL:
08540       res-&gt;info-&gt;ref = other-&gt;info-&gt;ref;         
08541       <font class="keywordflow">break</font>;
08542 
08543     <font class="keywordflow">case</font> SK_CONJ:
08544       res-&gt;info-&gt;conj-&gt;a = other-&gt;info-&gt;conj-&gt;a;
08545       res-&gt;info-&gt;conj-&gt;b = other-&gt;info-&gt;conj-&gt;b;
08546       <font class="keywordflow">break</font>;
08547 
08548     <font class="keywordflow">case</font> SK_SPECIAL:
08549       res-&gt;info-&gt;spec = other-&gt;info-&gt;spec;
08550       <font class="keywordflow">break</font>;
08551 
08552     <font class="keywordflow">case</font> SK_NEW:
08553     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
08554       res-&gt;info-&gt;fname = other-&gt;info-&gt;fname;
08555       <font class="keywordflow">break</font>;
08556 
08557     <font class="keywordflow">case</font> SK_CONST:
08558     <font class="keywordflow">case</font> SK_TYPE:
08559     <font class="keywordflow">case</font> SK_UNKNOWN:
08560     <font class="keywordflow">case</font> SK_RESULT:
08561       llassert (res-&gt;info == NULL);
08562       <font class="keywordflow">break</font>;
08563     }
08564 }
08565 
08566 <font class="keyword">static</font> <font class="keywordtype">void</font> sinfo_free (<font class="comment">/*@special@*/</font> <font class="comment">/*@temp@*/</font> <font class="comment">/*@notnull@*/</font> sRef s)
08567    <font class="comment">/*@uses s-&gt;kind, s-&gt;info@*/</font>
08568    <font class="comment">/*@releases s-&gt;info@*/</font> 
08569 {
08570   <font class="keywordflow">switch</font> (s-&gt;kind)
08571     {
08572     <font class="keywordflow">case</font> SK_CVAR:
08573       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;info-&gt;cvar);
08574       <font class="keywordflow">break</font>;
08575 
08576     <font class="keywordflow">case</font> SK_PARAM:
08577       <font class="keywordflow">break</font>;
08578 
08579     <font class="keywordflow">case</font> SK_ARRAYFETCH:
08580       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;info-&gt;arrayfetch);
08581       <font class="keywordflow">break</font>;
08582 
08583     <font class="keywordflow">case</font> SK_FIELD:
08584       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;info-&gt;field); 
08585       <font class="keywordflow">break</font>;
08586 
08587     <font class="keywordflow">case</font> SK_OBJECT:
08588       <font class="keywordflow">break</font>;
08589 
08590     <font class="keywordflow">case</font> SK_PTR:
08591     <font class="keywordflow">case</font> SK_ADR:
08592     <font class="keywordflow">case</font> SK_DERIVED:
08593     <font class="keywordflow">case</font> SK_EXTERNAL:
08594       <font class="keywordflow">break</font>;
08595 
08596     <font class="keywordflow">case</font> SK_CONJ:
08597       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;info-&gt;conj);
08598       <font class="keywordflow">break</font>;
08599 
08600     <font class="keywordflow">case</font> SK_UNCONSTRAINED:
08601     <font class="keywordflow">case</font> SK_SPECIAL:
08602     <font class="keywordflow">case</font> SK_CONST:
08603     <font class="keywordflow">case</font> SK_NEW:
08604     <font class="keywordflow">case</font> SK_TYPE:
08605     <font class="keywordflow">case</font> SK_UNKNOWN:
08606     <font class="keywordflow">case</font> SK_RESULT:
08607       <font class="keywordflow">break</font>;
08608     }
08609 
08610   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;info);
08611 }
08612 
<a name="l08613"></a><a class="code" href="sRef_c.html#a330">08613</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (sRef s)<font class="keyword">  </font>
08614 <font class="keyword"></font>{
08615   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (s))
08616     {
08617       uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s);
08618 
08619       <font class="keywordflow">return</font> (!uentry_isStatic (ue));
08620     }
08621   <font class="keywordflow">else</font>
08622     {
08623       <font class="keywordflow">return</font> FALSE;
08624     }
08625 }
08626 
<a name="l08627"></a><a class="code" href="sRef_c.html#a331">08627</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sRef s)<font class="keyword">  </font>
08628 <font class="keyword"></font>{
08629   <font class="keywordflow">if</font> (sRef_isValid(s))
08630     {
08631       <font class="keywordflow">return</font> (s-&gt;kind == SK_CVAR 
08632               &amp;&amp; (s-&gt;info-&gt;cvar-&gt;lexlevel &gt; fileScope));
08633     }
08634   
08635   <font class="keywordflow">return</font> FALSE;
08636 }
08637 
<a name="l08638"></a><a class="code" href="sRef_c.html#a332">08638</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a332">sRef_isRealLocalVar</a> (sRef s)<font class="keyword">  </font>
08639 <font class="keyword"></font>{
08640   <font class="keywordflow">if</font> (sRef_isValid(s))
08641     {
08642       <font class="keywordflow">if</font> (s-&gt;kind == SK_CVAR)
08643         {
08644           <font class="keywordflow">if</font> (s-&gt;info-&gt;cvar-&gt;lexlevel == functionScope)
08645             {
08646               uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (s);
08647 
08648               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a174">uentry_isAnyParam</a> (ue)
08649                   || <a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (ue))
08650                 {
08651                   <font class="keywordflow">return</font> FALSE;
08652                 }
08653               <font class="keywordflow">else</font>
08654                 {
08655                   <font class="keywordflow">return</font> TRUE;
08656                 }
08657             }
08658           <font class="keywordflow">else</font>
08659             {
08660               <font class="keywordflow">return</font> (s-&gt;info-&gt;cvar-&gt;lexlevel &gt; functionScope);
08661             }
08662         }
08663     }
08664   
08665   <font class="keywordflow">return</font> FALSE;
08666 }
08667 
<a name="l08668"></a><a class="code" href="sRef_c.html#a333">08668</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a333">sRef_isLocalParamVar</a> (sRef s)<font class="keyword">  </font>
08669 <font class="keyword"></font>{
08670   <font class="keywordflow">if</font> (sRef_isValid(s))
08671     {
08672       <font class="keywordflow">return</font> (s-&gt;kind == SK_PARAM
08673               || (s-&gt;kind == SK_CVAR 
08674                   &amp;&amp; (s-&gt;info-&gt;cvar-&gt;lexlevel &gt; fileScope)));
08675     }
08676   
08677   <font class="keywordflow">return</font> FALSE;
08678 }
08679 
08680 <font class="keyword">static</font> speckind speckind_fromInt (<font class="keywordtype">int</font> i)<font class="keyword"></font>
08681 <font class="keyword"></font>{
08682   <font class="comment">/*@+enumint@*/</font> 
08683   llassert (i &gt;= SR_NOTHING &amp;&amp; i &lt;= SR_SYSTEM); 
08684   <font class="comment">/*@=enumint@*/</font>
08685 
08686   <font class="keywordflow">return</font> ((speckind) i);
08687 }
08688 
08689 <font class="keywordtype">void</font> sRef_combineNullState (<font class="comment">/*@notnull@*/</font> sRef res, <font class="comment">/*@notnull@*/</font> sRef other)<font class="keyword"></font>
08690 <font class="keyword"></font>{
08691   nstate n1 = res-&gt;nullstate;
08692   nstate n2 = other-&gt;nullstate;
08693   <font class="keywordtype">bool</font> flip = FALSE;
08694   nstate nn = n1;
08695 
08696   <font class="keywordflow">if</font> (n1 == n2 || n2 == NS_UNKNOWN)
08697     {
08698       ;
08699     }
08700   <font class="keywordflow">else</font>
08701     {
08702       <font class="comment">/* note: n2 is not unknown or defnull */</font>
08703 
08704       <font class="keywordflow">switch</font> (n1)
08705         {
08706         <font class="keywordflow">case</font> NS_ERROR:   nn = NS_ERROR; <font class="keywordflow">break</font>;
08707         <font class="keywordflow">case</font> NS_UNKNOWN: flip = TRUE; nn = n2; <font class="keywordflow">break</font>; 
08708         <font class="keywordflow">case</font> NS_POSNULL: <font class="keywordflow">break</font>;
08709         <font class="keywordflow">case</font> NS_DEFNULL: nn = NS_POSNULL; <font class="keywordflow">break</font>;
08710         <font class="keywordflow">case</font> NS_RELNULL: <font class="keywordflow">break</font>;
08711         <font class="keywordflow">case</font> NS_NOTNULL:  
08712           <font class="keywordflow">if</font> (n2 == NS_MNOTNULL)
08713             {
08714               ;
08715             }
08716           <font class="keywordflow">else</font> 
08717             { 
08718               flip = TRUE;
08719               nn = NS_POSNULL; 
08720             }
08721           <font class="keywordflow">break</font>;
08722         <font class="keywordflow">case</font> NS_MNOTNULL: 
08723           <font class="keywordflow">if</font> (n2 == NS_NOTNULL) 
08724             {
08725               nn = NS_NOTNULL; 
08726             }
08727           <font class="keywordflow">else</font> 
08728             {
08729               flip = TRUE;
08730               nn = NS_POSNULL; 
08731             }
08732           <font class="keywordflow">break</font>;
08733         <font class="keywordflow">case</font> NS_CONSTNULL:
08734         <font class="keywordflow">case</font> NS_ABSNULL:
08735           flip = TRUE;
08736           nn = n2;
08737         }
08738     }
08739   
08740   <font class="keywordflow">if</font> (flip)
08741     {
08742       res-&gt;nullinfo = alinfo_update (res-&gt;nullinfo, other-&gt;nullinfo);      
08743     }
08744 
08745   res-&gt;nullstate = nn;
08746 }
08747 
<a name="l08748"></a><a class="code" href="sRef_c.html#a334">08748</a> cstring <a class="code" href="sRef_c.html#a334">sRef_nullMessage</a> (sRef s)<font class="keyword"></font>
08749 <font class="keyword"></font>{
08750   llassert (sRef_isValid (s));
08751 
08752   <font class="keywordflow">switch</font> (s-&gt;nullstate)
08753     {
08754     <font class="keywordflow">case</font> NS_DEFNULL:
08755     <font class="keywordflow">case</font> NS_CONSTNULL:
08756       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"null"</font>));
08757     <font class="keywordflow">default</font>:
08758       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"possibly null"</font>));
08759     }
08760   BADEXIT;
08761 }
08762 
<a name="l08763"></a><a class="code" href="sRef_c.html#a335">08763</a> sRef <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (<font class="comment">/*@returned@*/</font> sRef s, ctype typ, uentry ue)<font class="keyword"></font>
08764 <font class="keyword"></font>{
08765   sRef tmp = sRef_undefined;
08766   sRef ret;
08767 
08768   llassert (sRef_isValid (s));
08769 
08770   <font class="keywordflow">switch</font> (s-&gt;kind)
08771     {
08772     <font class="keywordflow">case</font> SK_RESULT:
08773       s-&gt;type = typ;
08774       ret = s;
08775       <font class="keywordflow">break</font>;
08776     <font class="keywordflow">case</font> SK_ARRAYFETCH:
08777       {
08778         ctype ct;
08779         tmp = <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, typ, ue);
08780 
08781         ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tmp));
08782 
08783         
08784         <font class="keywordflow">if</font> (ctype_isKnown (ct))
08785           {
08786             <font class="keywordflow">if</font> (ctype_isAP (ct))
08787               {
08788                 ;
08789               }
08790             <font class="keywordflow">else</font>
08791               {
08792                 voptgenerror 
08793                   (FLG_TYPE,
08794                    message
08795                    (<font class="stringliteral">"Special clause indexes non-array (%t): *%q"</font>,
08796                     ct, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s-&gt;info-&gt;arrayfetch-&gt;arr)),
08797                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
08798               }
08799           }
08800 
08801         tmp = <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (s-&gt;info-&gt;arrayfetch-&gt;arr, typ, ue);
08802 
08803         <font class="keywordflow">if</font> (s-&gt;info-&gt;arrayfetch-&gt;indknown)
08804           {
08805             ret = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (tmp, s-&gt;info-&gt;arrayfetch-&gt;ind);
08806           }
08807         <font class="keywordflow">else</font>
08808           {
08809             ret = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (tmp);
08810           }
08811       }
08812       <font class="keywordflow">break</font>;
08813     <font class="keywordflow">case</font> SK_FIELD:
08814       {
08815         sRef rec = <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (s-&gt;info-&gt;field-&gt;rec, typ, ue);
08816         ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (rec));
08817 
08818         <font class="keywordflow">if</font> (ctype_isKnown (ct))
08819           {
08820             <font class="keywordflow">if</font> (ctype_isSU (ct))
08821               {
08822                 <font class="keywordflow">if</font> (uentry_isValid (uentryList_lookupField (ctype_getFields (ct), 
08823                                                             s-&gt;info-&gt;field-&gt;field)))
08824                   {
08825                     ;
08826                   }
08827                 <font class="keywordflow">else</font>
08828                   {
08829                     voptgenerror 
08830                       (FLG_TYPE,
08831                        message
08832                        (<font class="stringliteral">"Special clause accesses non-existent field of result: %q.%s"</font>,
08833                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (rec), s-&gt;info-&gt;field-&gt;field),
08834                        <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
08835                   }
08836               }
08837             <font class="keywordflow">else</font>
08838               {
08839                 voptgenerror 
08840                   (FLG_TYPE,
08841                    message
08842                    (<font class="stringliteral">"Special clause accesses field of non-struct or union result (%t): %q.%s"</font>,
08843                     ct, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (rec), s-&gt;info-&gt;field-&gt;field),
08844                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
08845               }
08846           }
08847         
08848         ret = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (tmp, s-&gt;info-&gt;field-&gt;field);
08849         <font class="keywordflow">break</font>;
08850       }
08851     <font class="keywordflow">case</font> SK_PTR:
08852       {
08853         ctype ct;
08854         tmp = <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (s-&gt;info-&gt;ref, typ, ue);
08855 
08856         ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tmp));
08857 
08858         <font class="keywordflow">if</font> (ctype_isKnown (ct))
08859           {
08860             <font class="keywordflow">if</font> (ctype_isAP (ct))
08861               {
08862                 ;
08863               }
08864             <font class="keywordflow">else</font>
08865               {
08866                 voptgenerror 
08867                   (FLG_TYPE,
08868                    message
08869                    (<font class="stringliteral">"Special clause dereferences non-pointer (%t): *%q"</font>,
08870                     ct, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s-&gt;info-&gt;ref)),
08871                    <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
08872               }
08873           }
08874         
08875         ret = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (tmp);
08876         <font class="keywordflow">break</font>;
08877       }
08878     <font class="keywordflow">case</font> SK_ADR:
08879       voptgenerror 
08880         (FLG_TYPE,
08881          message
08882          (<font class="stringliteral">"Special clause uses &amp; operator (not allowed): &amp;%q"</font>, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s-&gt;info-&gt;ref)),
08883          <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
08884       ret = s;
08885       <font class="keywordflow">break</font>;
08886     BADDEFAULT;
08887     }
08888 
08889   <font class="keywordflow">return</font> ret;
08890 }
08891 
<a name="l08892"></a><a class="code" href="sRef_c.html#a336">08892</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (sRef s)<font class="keyword"></font>
08893 <font class="keyword"></font>{
08894   <font class="keywordflow">return</font> (sRef_isValid(s) &amp;&amp; alkind_isOnly (s-&gt;aliaskind));
08895 }
08896 
<a name="l08897"></a><a class="code" href="sRef_c.html#a337">08897</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (sRef s)<font class="keyword"> </font>
08898 <font class="keyword"></font>{
08899   <font class="keywordflow">return</font> (sRef_isValid(s) &amp;&amp; alkind_isDependent (s-&gt;aliaskind));
08900 }
08901 
<a name="l08902"></a><a class="code" href="sRef_c.html#a338">08902</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (sRef s)<font class="keyword"></font>
08903 <font class="keyword"></font>{
08904   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_OWNED));
08905 }
08906 
<a name="l08907"></a><a class="code" href="sRef_c.html#a339">08907</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (sRef s)<font class="keyword"> </font>
08908 <font class="keyword"></font>{
08909   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_KEEP));
08910 }
08911 
<a name="l08912"></a><a class="code" href="sRef_c.html#a340">08912</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a340">sRef_isTemp</a> (sRef s)<font class="keyword"></font>
08913 <font class="keyword"></font>{
08914   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; alkind_isTemp (s-&gt;aliaskind));
08915 }
08916 
<a name="l08917"></a><a class="code" href="sRef_c.html#a341">08917</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (sRef s)<font class="keyword"> </font>
08918 <font class="keyword"></font>{
08919   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_LOCAL));
08920 }
08921 
<a name="l08922"></a><a class="code" href="sRef_c.html#a342">08922</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a342">sRef_isUnique</a> (sRef s)<font class="keyword"></font>
08923 <font class="keyword"></font>{
08924   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_UNIQUE));
08925 }
08926 
<a name="l08927"></a><a class="code" href="sRef_c.html#a343">08927</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a343">sRef_isShared</a> (sRef s)<font class="keyword"> </font>
08928 <font class="keyword"></font>{
08929   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_SHARED));
08930 }
08931 
<a name="l08932"></a><a class="code" href="sRef_c.html#a344">08932</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (sRef s)<font class="keyword"> </font>
08933 <font class="keyword"></font>{
08934   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;expkind == XO_EXPOSED));
08935 }
08936 
<a name="l08937"></a><a class="code" href="sRef_c.html#a345">08937</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (sRef s)<font class="keyword"> </font>
08938 <font class="keyword"></font>{
08939   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;expkind == XO_OBSERVER));
08940 }
08941 
<a name="l08942"></a><a class="code" href="sRef_c.html#a346">08942</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (sRef s)<font class="keyword"> </font>
08943 <font class="keyword"></font>{
08944   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_FRESH));
08945 }
08946 
<a name="l08947"></a><a class="code" href="sRef_c.html#a347">08947</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (sRef s)<font class="keyword"> </font>
08948 <font class="keyword"></font>{
08949   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;nullstate == NS_DEFNULL 
08950                                || s-&gt;nullstate == NS_CONSTNULL));
08951 }
08952 
<a name="l08953"></a><a class="code" href="sRef_c.html#a348">08953</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (sRef s)<font class="keyword"></font>
08954 <font class="keyword"></font>{
08955   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;defstate == SS_ALLOCATED));
08956 }
08957 
<a name="l08958"></a><a class="code" href="sRef_c.html#a349">08958</a> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a349">sRef_isStack</a> (sRef s)<font class="keyword"></font>
08959 <font class="keyword"></font>{
08960   <font class="keywordflow">return</font> (sRef_isValid (s) &amp;&amp; (s-&gt;aliaskind == AK_STACK));
08961 }
08962 
<a name="l08963"></a><a class="code" href="sRef_c.html#a350">08963</a> <font class="keyword">extern</font> <font class="keywordtype">bool</font> <a class="code" href="sRef_c.html#a350">sRef_isNotNull</a> (sRef s)<font class="keyword"></font>
08964 <font class="keyword"></font>{
08965   <font class="keywordflow">return</font> (sRef_isValid(s) &amp;&amp; (s-&gt;nullstate == NS_MNOTNULL 
08966                               || s-&gt;nullstate == NS_NOTNULL));
08967 }
08968 
08969 
08970 
08971 
08972 
08973 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:44 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
