<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>checking.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:50 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>checking.c File Reference</h1><code>#include "lclintMacros.nf"</code><br>
<code>#include "llbasic.h"</code><br>
<code>#include "llgrammar.h"</code><br>
<code>#include "checking.h"</code><br>
<code>#include "lclscan.h"</code><br>

<p>
<a href="checking_c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>termNode&nbsp;</td><td valign=bottom><a class="el" href="checking_c.html#a4">computePossibleSorts</a> ( termNode t)</td></tr>
<tr><td nowrap align=right valign=top>termNode&nbsp;</td><td valign=bottom><a class="el" href="checking_c.html#a5">checkSort</a> ( termNode t)</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="checking_c.html#a6">checkLclPredicate</a> (ltoken t, lclPredicateNode n)</td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a6" doxytag="checking.c::checkLclPredicate"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void checkLclPredicate (
          </b></td>
          <td valign="bottom"><b>
ltoken <em>t</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
lclPredicateNode <em>n</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="checking_c-source.html#l00384">384</a> of file <a class="el" href="checking_c-source.html">checking.c</a>.<div class="fragment"><pre>00385 {
00386   sort theSort;
00387 
00388   <font class="keywordflow">if</font> ((n == NULL) || (n-&gt;predicate == NULL))
00389     {
00390       llcontbuglit (<font class="stringliteral">"checkLclPredicate expects valid lclPredicate.  "</font>
00391                     <font class="stringliteral">"Skipping current check"</font>);
00392       <font class="keywordflow">return</font>;
00393     }
00394 
00395  <font class="comment">/* check only if there are no previous errors */</font>
00396 
00397   <font class="keywordflow">if</font> (!n-&gt;predicate-&gt;error_reported)
00398     {
00399      <font class="comment">/* check that the sort of n is boolean */</font>
00400       theSort = n-&gt;predicate-&gt;sort;
00401       <font class="keywordflow">if</font> (!<a class="code" href="sort_c.html#a111">sort_compatible</a> (theSort, sort_capBool))
00402         {
00403           <font class="keywordflow">if</font> (sort_isNoSort (theSort))
00404             {
00405              ; <font class="comment">/* "Expects a boolean term.  Given term has unknown sort" */</font>
00406             }
00407           <font class="keywordflow">else</font>
00408             {
00409               cstring clauset = ltoken_getRawString (t);
00410 
00411               <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a1">cstring_firstChar</a> (clauset) == <font class="charliteral">'('</font>)
00412                 {
00413                   clauset = cstring_makeLiteral (<font class="stringliteral">"Equality"</font>);
00414                 }
00415               <font class="keywordflow">else</font>
00416                 {
00417                   <font class="comment">/* uppercase first letter */</font>
00418                   clauset = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (clauset);
00419                   <a class="code" href="cstring_c.html#a7">cstring_setChar</a> (clauset, 1, 
00420                                    (<font class="keywordtype">char</font>) toupper (cstring_firstChar (clauset))); 
00421                 }
00422 
00423               <a class="code" href="llerror_c.html#a54">lclerror</a> (t, message (<font class="stringliteral">"%q expects a boolean term, given %q."</font>, 
00424                                     clauset, sort_unparse (theSort)));
00425               
00426             }
00427         }
00428     }
00429 }
</div></pre>    </td>
  </tr>
</table>
<a name="a5" doxytag="checking.c::checkSort"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
termNode checkSort (
          </b></td>
          <td valign="bottom"><b>
termNode <em>t</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="checking_c-source.html#l00223">223</a> of file <a class="el" href="checking_c-source.html">checking.c</a>.<div class="fragment"><pre>00224 {
00225   sortSet sorts;
00226   sort theSort;
00227   <font class="keywordtype">int</font> size;
00228   ltoken errtok;
00229 
00230   (<font class="keywordtype">void</font>) <a class="code" href="checking_c.html#a4">computePossibleSorts</a> (t);
00231   sorts = t-&gt;possibleSorts;
00232 
00233   llassert (sortSet_isDefined (sorts));
00234 
00235   size = sortSet_size (sorts);
00236   <font class="keywordflow">switch</font> (size)
00237     {
00238     <font class="keywordflow">case</font> 0:                     <font class="comment">/* complain later */</font>
00239       <font class="keywordflow">break</font>;
00240     <font class="keywordflow">case</font> 1:                     <font class="comment">/* just right */</font>
00241       theSort = <a class="code" href="sortSet_c.html#a4">sortSet_choose</a> (sorts);
00242       assignSorts (t, theSort);
00243       <font class="keywordflow">break</font>;
00244     <font class="keywordflow">default</font>:
00245      <font class="comment">/* we allow C literals to have multiple sorts */</font>
00246       <font class="keywordflow">if</font> (t-&gt;kind != TRM_LITERAL)
00247         {
00248           errtok = <a class="code" href="abstract_c.html#a74">termNode_errorToken</a> (t);
00249           t-&gt;error_reported = TRUE;
00250 
00251           <a class="code" href="llerror_c.html#a54">lclerror</a> (errtok, 
00252                     message (<font class="stringliteral">"Term %q: can have more than one possible type.  Possible types: %q"</font>,
00253                              termNode_unparse (t), <a class="code" href="sortSet_c.html#a7">sortSet_unparseClean</a> (sorts)));
00254         }
00255     }
00256   <font class="keywordflow">return</font> t;
00257 }
</div></pre>    </td>
  </tr>
</table>
<a name="a4" doxytag="checking.c::computePossibleSorts"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
termNode computePossibleSorts (
          </b></td>
          <td valign="bottom"><b>
termNode <em>t</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="checking_c-source.html#l00049">49</a> of file <a class="el" href="checking_c-source.html">checking.c</a>.
<p>
Referenced by <a class="el" href="checking_c-source.html#l00223">checkSort</a>().<div class="fragment"><pre>00050 {
00051   ltoken errtok;
00052 
00053   <font class="keywordflow">if</font> (t != (termNode) 0)
00054     {
00055       <font class="keywordflow">switch</font> (t-&gt;kind)
00056         {
00057         <font class="keywordflow">case</font> TRM_LITERAL:
00058         <font class="keywordflow">case</font> TRM_CONST:
00059         <font class="keywordflow">case</font> TRM_VAR:
00060         <font class="keywordflow">case</font> TRM_ZEROARY:
00061         <font class="keywordflow">case</font> TRM_SIZEOF:
00062         <font class="keywordflow">case</font> TRM_UNCHANGEDALL:
00063         <font class="keywordflow">case</font> TRM_UNCHANGEDOTHERS:
00064         <font class="keywordflow">case</font> TRM_QUANTIFIER:
00065           <font class="keywordflow">break</font>;
00066         <font class="keywordflow">case</font> TRM_APPLICATION:
00067           {
00068             <font class="keywordtype">bool</font> fail = FALSE;
00069             sortSetList argSorts = <a class="code" href="sortSetList_c.html#a0">sortSetList_new</a> ();
00070             lslOpSet ops;
00071             sortSet standards;
00072 
00073             <font class="keywordflow">if</font> (termNodeList_size (t-&gt;args) != 0)
00074               {
00075                 termNodeList_elements (t-&gt;args, arg)<font class="keyword"></font>
00076 <font class="keyword">                </font>{
00077                   (<font class="keywordtype">void</font>) <a class="code" href="checking_c.html#a4">computePossibleSorts</a> (arg);
00078 
00079                   <font class="keywordflow">if</font> (sortSet_size (arg-&gt;possibleSorts) == 0)
00080                     {
00081                       fail = TRUE;
00082                     }
00083                   <font class="keywordflow">else</font>
00084                     {
00085                       <a class="code" href="sortSetList_c.html#a2">sortSetList_addh</a> (argSorts, arg-&gt;possibleSorts);
00086                     } 
00087                 } end_termNodeList_elements;
00088 
00089                 <font class="keywordflow">if</font> (fail)
00090                   {
00091                     <a class="code" href="lslOpSet_c.html#a7">lslOpSet_free</a> (t-&gt;possibleOps);
00092                     <a class="code" href="sortSetList_c.html#a8">sortSetList_free</a> (argSorts);
00093                     t-&gt;possibleOps = <a class="code" href="lslOpSet_c.html#a1">lslOpSet_new</a> ();
00094                     <font class="keywordflow">return</font> t;
00095                   }
00096               }
00097             
00098             ops = <a class="code" href="symtable_c.html#a68">symtable_opsWithLegalDomain</a> (g_symtab, t-&gt;name, argSorts, t-&gt;given);
00099             <a class="code" href="lslOpSet_c.html#a7">lslOpSet_free</a> (t-&gt;possibleOps);
00100             t-&gt;possibleOps = ops;
00101 
00102             lslOpSet_elements (t-&gt;possibleOps, op)<font class="keyword"></font>
00103 <font class="keyword">              </font>{
00104                 sort sort;
00105                 sort = <a class="code" href="abstract_c.html#a224">sigNode_rangeSort</a> (op-&gt;signature);
00106                 (<font class="keywordtype">void</font>) <a class="code" href="sortSet_c.html#a3">sortSet_insert</a> (t-&gt;possibleSorts, sort);
00107               } end_lslOpSet_elements;
00108 
00109             standards = standardOperators (t-&gt;name, argSorts, t-&gt;given);
00110 
00111             sortSet_elements (standards, el)<font class="keyword"></font>
00112 <font class="keyword">              </font>{
00113                 (<font class="keywordtype">void</font>) <a class="code" href="sortSet_c.html#a3">sortSet_insert</a> (t-&gt;possibleSorts, el);
00114               } end_sortSet_elements;
00115 
00116             <a class="code" href="sortSet_c.html#a9">sortSet_free</a> (standards);
00117 
00118             <font class="keywordflow">if</font> (!(t-&gt;error_reported) &amp;&amp; sortSet_size (t-&gt;possibleSorts) == 0)
00119               {
00120                 <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> arity = termNodeList_size (t-&gt;args);
00121                 errtok = <a class="code" href="abstract_c.html#a75">nameNode_errorToken</a> (t-&gt;name);
00122                 
00123                 <font class="comment">/* errorShowPoint (tsource_thisLine (lclsource), ltoken_getCol (errtok)); */</font>
00124                 
00125                 <font class="keywordflow">if</font> (isStandardOperator (t-&gt;name))
00126                   {
00127                     <a class="code" href="llerror_c.html#a54">lclerror</a> (errtok, 
00128                               message (<font class="stringliteral">"Type error: %q not declared for %q"</font>,
00129                                       nameNode_unparse (t-&gt;name), printBadArgs (argSorts)));
00130                   }
00131                 <font class="keywordflow">else</font> <font class="keywordflow">if</font> (t-&gt;name != NULL 
00132                          &amp;&amp; <a class="code" href="symtable_c.html#a66">symtable_opExistsWithArity</a> (g_symtab, t-&gt;name, arity))
00133                   {
00134                     sigNodeSet possibleOps = <a class="code" href="symtable_c.html#a65">symtable_possibleOps</a> (g_symtab, t-&gt;name);
00135                     cstring opName = <a class="code" href="abstract_c.html#a100">nameNode_unparse</a> (t-&gt;name);
00136                     
00137                     <font class="comment">/*</font>
00138 <font class="comment">                    ** all these will be standardOperators soon...</font>
00139 <font class="comment">                    */</font>
00140 
00141                     <font class="keywordflow">if</font> (cstring_equalLit (opName, <font class="stringliteral">"__ [__]"</font>))
00142                       {
00143                         <a class="code" href="llerror_c.html#a54">lclerror</a> (errtok, 
00144                                   message (<font class="stringliteral">"Type error: %q not declared for %q"</font>,
00145                                           opName, printBadArgs (argSorts)));
00146                       }
00147                     <font class="keywordflow">else</font>
00148                       {
00149                         <a class="code" href="llerror_c.html#a54">lclerror</a> (errtok, 
00150                                   message (<font class="stringliteral">"Type error: %q declared: %q\ngiven: %q"</font>,
00151                                           opName, 
00152                                           sigNodeSet_unparseSomeSigs (possibleOps),
00153                                           printBadArgs (argSorts)));
00154                       }
00155                   }
00156                 <font class="keywordflow">else</font>
00157                   {
00158                     sigNodeSet possibleOps;
00159                     <font class="keywordtype">int</font> npossibleOps;
00160 
00161                     llassert (t-&gt;name != NULL);
00162 
00163                     possibleOps = <a class="code" href="symtable_c.html#a65">symtable_possibleOps</a> (g_symtab, t-&gt;name);
00164                     npossibleOps = sigNodeSet_size (possibleOps);
00165 
00166                     <font class="comment">/*</font>
00167 <font class="comment">                     ** evs --- check is it is wrong arity...</font>
00168 <font class="comment">                     */</font>
00169                     
00170                     <font class="keywordflow">if</font> (npossibleOps == 0)
00171                       {
00172                         lclerror 
00173                           (errtok, 
00174                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undeclared operator: %q"</font>, nameNode_unparse (t-&gt;name)));      
00175                       }
00176                     <font class="keywordflow">else</font>
00177                       {
00178                         lclerror
00179                           (errtok, 
00180                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operator %q declared for %q arguments, given %d"</font>,
00181                                    nameNode_unparse (t-&gt;name),
00182                                    <a class="code" href="sigNodeSet_c.html#a7">sigNodeSet_unparsePossibleAritys</a> (possibleOps),
00183                                    arity));
00184                       }
00185                   }
00186                 t-&gt;error_reported = TRUE;
00187               }
00188             <a class="code" href="sortSetList_c.html#a8">sortSetList_free</a> (argSorts);
00189             <font class="keywordflow">break</font>;
00190           }
00191         }
00192     }
00193       
00194   <font class="keywordflow">return</font> t;
00195 }
</div></pre>    </td>
  </tr>
</table>
<hr><address><small>Generated at Fri Nov 3 18:57:50 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
