<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>specialClauses.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:43 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>specialClauses.c</h1><a href="specialClauses_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** specialClauses.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 
00031 <font class="keyword">static</font> <font class="keywordtype">bool</font> specialClause_isMemoryAllocation (specialClause p_cl) <font class="comment">/*@*/</font> ;
00032 <font class="keyword">static</font> <font class="keywordtype">void</font> specialClause_free (<font class="comment">/*@only@*/</font> specialClause p_s) ;
00033 <font class="keyword">static</font> cstring specialClause_dump (specialClause p_s) <font class="comment">/*@*/</font> ;
00034 <font class="keyword">static</font> specialClause specialClause_undump (<font class="keywordtype">char</font> **p_s) <font class="comment">/*@modifies *p_s@*/</font> ;
00035 <font class="keyword">static</font> specialClause specialClause_copy (specialClause p_s) <font class="comment">/*@*/</font> ;
00036 <font class="keyword">static</font> <font class="keywordtype">bool</font> specialClause_sameKind (specialClause p_s1, specialClause p_s2) <font class="comment">/*@*/</font> ;
00037 
00038 specialClause 
<a name="l00039"></a><a class="code" href="specialClauses_c.html#a6">00039</a>   <a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (stateConstraint st, specialClauseKind k, sRefSet s)<font class="keyword"> </font>
00040 <font class="keyword"></font>{
00041   specialClause ret = (specialClause) dmalloc (<font class="keyword">sizeof</font> (*ret));
00042 
00043   ret-&gt;state = st;
00044   ret-&gt;kind = k;
00045   ret-&gt;refs = s;
00046 
00047   <font class="keywordflow">return</font> ret;
00048 }
00049 
<a name="l00050"></a><a class="code" href="specialClauses_c.html#a7">00050</a> <font class="keywordtype">bool</font> <a class="code" href="specialClauses_c.html#a7">specialClause_isBefore</a> (specialClause cl)<font class="keyword"></font>
00051 <font class="keyword"></font>{
00052   <font class="keywordflow">return</font> (cl-&gt;state == TK_BEFORE || cl-&gt;state == TK_BOTH);
00053 }
00054 
<a name="l00055"></a><a class="code" href="specialClauses_c.html#a8">00055</a> <font class="keywordtype">bool</font> <a class="code" href="specialClauses_c.html#a8">specialClause_isAfter</a> (specialClause cl)<font class="keyword"></font>
00056 <font class="keyword"></font>{
00057   <font class="keywordflow">return</font> (cl-&gt;state == TK_AFTER || cl-&gt;state == TK_BOTH);
00058 }
00059 
00060 <font class="keywordtype">bool</font> specialClause_isMemoryAllocation (specialClause cl)<font class="keyword"></font>
00061 <font class="keyword"></font>{
00062   <font class="keywordflow">switch</font> (cl-&gt;kind)
00063     {
00064     <font class="keywordflow">case</font> SP_ALLOCATES:
00065     <font class="keywordflow">case</font> SP_RELEASES:
00066     <font class="keywordflow">case</font> SP_ISONLY:
00067     <font class="keywordflow">case</font> SP_ISSHARED:
00068     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00069     <font class="keywordflow">case</font> SP_ISOWNED:
00070     <font class="keywordflow">case</font> SP_ISOBSERVER:
00071     <font class="keywordflow">case</font> SP_ISEXPOSED:
00072       <font class="keywordflow">return</font> TRUE;
00073     <font class="keywordflow">case</font> SP_USES:
00074     <font class="keywordflow">case</font> SP_DEFINES:
00075     <font class="keywordflow">case</font> SP_SETS:
00076     <font class="keywordflow">case</font> SP_ISNULL:
00077     <font class="keywordflow">case</font> SP_ISNOTNULL:
00078       <font class="keywordflow">return</font> FALSE;
00079   }
00080 
00081   BADEXIT;
00082 }
00083 
00084 <font class="comment">/*</font>
00085 <font class="comment">** An error is reported if the test is NOT true.</font>
00086 <font class="comment">*/</font>
00087 
<a name="l00088"></a><a class="code" href="specialClauses_c.html#a9">00088</a> sRefTest <a class="code" href="specialClauses_c.html#a9">specialClause_getPreTestFunction</a> (specialClause cl)<font class="keyword"></font>
00089 <font class="keyword"></font>{
00090   <font class="keywordflow">switch</font> (cl-&gt;kind)
00091     {
00092     <font class="keywordflow">case</font> SP_USES:
00093       <font class="keywordflow">return</font> sRef_isStrictReadable;
00094     <font class="keywordflow">case</font> SP_ALLOCATES:
00095       <font class="keywordflow">return</font> sRef_hasNoStorage; 
00096     <font class="keywordflow">case</font> SP_DEFINES:
00097       <font class="keywordflow">return</font> sRef_hasNoStorage;
00098     <font class="keywordflow">case</font> SP_SETS:
00099       <font class="keywordflow">return</font> sRef_isNotUndefined;
00100     <font class="keywordflow">case</font> SP_RELEASES:
00101       <font class="keywordflow">return</font> sRef_isNotUndefined;
00102     <font class="keywordflow">case</font> SP_ISONLY:
00103       <font class="keywordflow">return</font> sRef_isOnly;
00104     <font class="keywordflow">case</font> SP_ISSHARED:
00105       <font class="keywordflow">return</font> sRef_isShared;
00106     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00107       <font class="keywordflow">return</font> sRef_isDependent;
00108     <font class="keywordflow">case</font> SP_ISOWNED:
00109       <font class="keywordflow">return</font> sRef_isOwned;
00110     <font class="keywordflow">case</font> SP_ISOBSERVER:
00111       <font class="keywordflow">return</font> sRef_isObserver;
00112     <font class="keywordflow">case</font> SP_ISEXPOSED:
00113       <font class="keywordflow">return</font> sRef_isExposed;
00114     <font class="keywordflow">case</font> SP_ISNOTNULL:
00115       <font class="keywordflow">return</font> sRef_isNotNull;
00116     <font class="keywordflow">case</font> SP_ISNULL:
00117       <font class="keywordflow">return</font> sRef_isDefinitelyNull;
00118   }
00119 
00120   BADEXIT;
00121 }
00122 
<a name="l00123"></a><a class="code" href="specialClauses_c.html#a10">00123</a> sRefTest <a class="code" href="specialClauses_c.html#a10">specialClause_getPostTestFunction</a> (specialClause cl)<font class="keyword"></font>
00124 <font class="keyword"></font>{
00125   llassert (specialClause_isAfter (cl));
00126 
00127   <font class="keywordflow">switch</font> (cl-&gt;kind)
00128     {
00129     <font class="keywordflow">case</font> SP_USES:
00130       <font class="keywordflow">return</font> NULL;
00131     <font class="keywordflow">case</font> SP_ALLOCATES:
00132       <font class="keywordflow">return</font> sRef_isAllocated;
00133     <font class="keywordflow">case</font> SP_DEFINES:
00134       <font class="keywordflow">return</font> sRef_isReallyDefined;
00135     <font class="keywordflow">case</font> SP_SETS:
00136       <font class="keywordflow">return</font> sRef_isReallyDefined;
00137     <font class="keywordflow">case</font> SP_RELEASES:
00138       <font class="keywordflow">return</font> sRef_isDeadStorage;
00139     <font class="keywordflow">case</font> SP_ISONLY:
00140       <font class="keywordflow">return</font> sRef_isOnly;
00141     <font class="keywordflow">case</font> SP_ISSHARED:
00142       <font class="keywordflow">return</font> sRef_isShared;
00143     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00144       <font class="keywordflow">return</font> sRef_isDependent;
00145     <font class="keywordflow">case</font> SP_ISOWNED:
00146       <font class="keywordflow">return</font> sRef_isOwned;
00147     <font class="keywordflow">case</font> SP_ISOBSERVER:
00148       <font class="keywordflow">return</font> sRef_isObserver;
00149     <font class="keywordflow">case</font> SP_ISEXPOSED:
00150       <font class="keywordflow">return</font> sRef_isExposed;
00151     <font class="keywordflow">case</font> SP_ISNOTNULL:
00152       <font class="keywordflow">return</font> sRef_isNotNull;
00153     <font class="keywordflow">case</font> SP_ISNULL:
00154       <font class="keywordflow">return</font> sRef_isDefinitelyNull;
00155   }
00156 
00157   BADEXIT;
00158 }
00159 
<a name="l00160"></a><a class="code" href="specialClauses_c.html#a11">00160</a> sRefShower <a class="code" href="specialClauses_c.html#a11">specialClause_getPostTestShower</a> (specialClause cl)<font class="keyword"></font>
00161 <font class="keyword"></font>{
00162   <font class="keywordflow">switch</font> (cl-&gt;kind)
00163     {
00164     <font class="keywordflow">case</font> SP_USES:
00165     <font class="keywordflow">case</font> SP_ALLOCATES:
00166       <font class="keywordflow">return</font> NULL;
00167     <font class="keywordflow">case</font> SP_DEFINES:
00168     <font class="keywordflow">case</font> SP_SETS:
00169       <font class="keywordflow">return</font> sRef_showNotReallyDefined;
00170     <font class="keywordflow">case</font> SP_RELEASES:
00171       <font class="keywordflow">return</font> NULL;
00172     <font class="keywordflow">case</font> SP_ISONLY:
00173     <font class="keywordflow">case</font> SP_ISSHARED:
00174     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00175     <font class="keywordflow">case</font> SP_ISOWNED:
00176       <font class="keywordflow">return</font> sRef_showAliasInfo;
00177     <font class="keywordflow">case</font> SP_ISOBSERVER:
00178     <font class="keywordflow">case</font> SP_ISEXPOSED:
00179       <font class="keywordflow">return</font> sRef_showExpInfo;
00180     <font class="keywordflow">case</font> SP_ISNOTNULL:
00181     <font class="keywordflow">case</font> SP_ISNULL:
00182       <font class="keywordflow">return</font> sRef_showNullInfo;
00183   }
00184 
00185   BADEXIT;
00186 }
00187 
<a name="l00188"></a><a class="code" href="specialClauses_c.html#a12">00188</a> sRefMod <a class="code" href="specialClauses_c.html#a12">specialClause_getEntryFunction</a> (specialClause cl)<font class="keyword"></font>
00189 <font class="keyword"></font>{
00190   <font class="keywordflow">if</font> (cl-&gt;state == TK_BEFORE || cl-&gt;state == TK_BOTH)
00191     {
00192       <font class="keywordflow">switch</font> (cl-&gt;kind)
00193         {
00194         <font class="keywordflow">case</font> SP_USES:
00195           <font class="keywordflow">return</font> sRef_setDefinedComplete;
00196         <font class="keywordflow">case</font> SP_ALLOCATES:
00197           <font class="keywordflow">return</font> NULL;
00198         <font class="keywordflow">case</font> SP_DEFINES:
00199           <font class="keywordflow">return</font> NULL;
00200         <font class="keywordflow">case</font> SP_SETS:
00201           <font class="keywordflow">return</font> sRef_setAllocatedComplete;
00202         <font class="keywordflow">case</font> SP_RELEASES:
00203           <font class="keywordflow">return</font> sRef_setDefinedComplete;
00204         <font class="keywordflow">case</font> SP_ISONLY:
00205           <font class="keywordflow">return</font> sRef_setOnly;
00206         <font class="keywordflow">case</font> SP_ISSHARED:
00207           <font class="keywordflow">return</font> sRef_setShared;
00208         <font class="keywordflow">case</font> SP_ISDEPENDENT:
00209           <font class="keywordflow">return</font> sRef_setDependent;
00210         <font class="keywordflow">case</font> SP_ISOWNED:
00211           <font class="keywordflow">return</font> sRef_setOwned;
00212         <font class="keywordflow">case</font> SP_ISOBSERVER:
00213           <font class="keywordflow">return</font> sRef_setObserver;
00214         <font class="keywordflow">case</font> SP_ISEXPOSED:
00215           <font class="keywordflow">return</font> sRef_setExposed;
00216         <font class="keywordflow">case</font> SP_ISNOTNULL:
00217           <font class="keywordflow">return</font> sRef_setNotNull;
00218         <font class="keywordflow">case</font> SP_ISNULL:
00219           <font class="keywordflow">return</font> sRef_setDefNull;
00220         }
00221 
00222       BADBRANCH;
00223     }
00224   <font class="keywordflow">else</font>
00225     {
00226       <font class="keywordflow">return</font> NULL;
00227     }
00228 }
00229 
<a name="l00230"></a><a class="code" href="specialClauses_c.html#a13">00230</a> sRefMod <a class="code" href="specialClauses_c.html#a13">specialClause_getEffectFunction</a> (specialClause cl)<font class="keyword"></font>
00231 <font class="keyword"></font>{
00232   <font class="keywordflow">if</font> (cl-&gt;state == TK_AFTER || cl-&gt;state == TK_BOTH)
00233     {
00234       <font class="keywordflow">switch</font> (cl-&gt;kind)
00235         {
00236         <font class="keywordflow">case</font> SP_USES:
00237           <font class="keywordflow">return</font> NULL;
00238         <font class="keywordflow">case</font> SP_ALLOCATES:
00239           <font class="keywordflow">return</font> sRef_setAllocatedComplete;
00240         <font class="keywordflow">case</font> SP_DEFINES:
00241           <font class="keywordflow">return</font> sRef_setDefinedNCComplete;
00242         <font class="keywordflow">case</font> SP_SETS:
00243           <font class="keywordflow">return</font> sRef_setDefinedNCComplete;
00244         <font class="keywordflow">case</font> SP_RELEASES:
00245           <font class="keywordflow">return</font> sRef_killComplete;
00246         <font class="keywordflow">case</font> SP_ISONLY:
00247           <font class="keywordflow">return</font> sRef_setOnly;
00248         <font class="keywordflow">case</font> SP_ISSHARED:
00249           <font class="keywordflow">return</font> sRef_setShared;
00250         <font class="keywordflow">case</font> SP_ISDEPENDENT:
00251           <font class="keywordflow">return</font> sRef_setDependent;
00252         <font class="keywordflow">case</font> SP_ISOWNED:
00253           <font class="keywordflow">return</font> sRef_setOwned;
00254         <font class="keywordflow">case</font> SP_ISOBSERVER:
00255           <font class="keywordflow">return</font> sRef_setObserver;
00256         <font class="keywordflow">case</font> SP_ISEXPOSED:
00257           <font class="keywordflow">return</font> sRef_setExposed;
00258         <font class="keywordflow">case</font> SP_ISNOTNULL:
00259           <font class="keywordflow">return</font> sRef_setNotNull;
00260         <font class="keywordflow">case</font> SP_ISNULL:
00261           <font class="keywordflow">return</font> sRef_setDefNull;
00262         }
00263 
00264       BADBRANCH;
00265     }
00266   <font class="keywordflow">else</font>
00267     {
00268       <font class="keywordflow">return</font> NULL;
00269     }
00270 }
00271 
<a name="l00272"></a><a class="code" href="specialClauses_c.html#a14">00272</a> sRefMod <a class="code" href="specialClauses_c.html#a14">specialClause_getReturnEffectFunction</a> (specialClause cl)<font class="keyword"></font>
00273 <font class="keyword"></font>{
00274   <font class="keywordflow">if</font> (cl-&gt;state == TK_AFTER || cl-&gt;state == TK_BOTH)
00275     {
00276       <font class="keywordflow">switch</font> (cl-&gt;kind)
00277         {
00278         <font class="keywordflow">case</font> SP_USES:
00279         <font class="keywordflow">case</font> SP_ALLOCATES:
00280         <font class="keywordflow">case</font> SP_DEFINES:
00281         <font class="keywordflow">case</font> SP_SETS:
00282         <font class="keywordflow">case</font> SP_RELEASES:
00283           <font class="keywordflow">return</font> NULL;
00284         <font class="keywordflow">case</font> SP_ISONLY:
00285           <font class="keywordflow">return</font> sRef_killComplete;
00286         <font class="keywordflow">case</font> SP_ISSHARED:
00287         <font class="keywordflow">case</font> SP_ISDEPENDENT:
00288         <font class="keywordflow">case</font> SP_ISOWNED:
00289         <font class="keywordflow">case</font> SP_ISOBSERVER:
00290         <font class="keywordflow">case</font> SP_ISEXPOSED:
00291         <font class="keywordflow">case</font> SP_ISNULL:
00292         <font class="keywordflow">case</font> SP_ISNOTNULL:
00293           <font class="keywordflow">return</font> NULL;
00294         }
00295 
00296       BADBRANCH;
00297     }
00298   <font class="keywordflow">else</font>
00299     {
00300       <font class="keywordflow">return</font> NULL;
00301     }
00302 }
00303 
<a name="l00304"></a><a class="code" href="specialClauses_c.html#a15">00304</a> flagcode <a class="code" href="specialClauses_c.html#a15">specialClause_preErrorCode</a> (specialClause cl)<font class="keyword"></font>
00305 <font class="keyword"></font>{
00306   llassert (cl-&gt;state == TK_BOTH || cl-&gt;state == TK_BEFORE);
00307 
00308   <font class="keywordflow">switch</font> (cl-&gt;kind)
00309     {
00310     <font class="keywordflow">case</font> SP_USES:
00311       <font class="keywordflow">return</font> FLG_USEDEF;
00312     <font class="keywordflow">case</font> SP_ALLOCATES: <font class="comment">/*@fallthrough@*/</font> 
00313     <font class="keywordflow">case</font> SP_DEFINES:
00314     <font class="keywordflow">case</font> SP_SETS:
00315       <font class="keywordflow">return</font> FLG_MUSTFREE;
00316     <font class="keywordflow">case</font> SP_RELEASES:
00317       <font class="keywordflow">return</font> FLG_USEDEF;
00318     <font class="keywordflow">case</font> SP_ISONLY:
00319       <font class="keywordflow">return</font> FLG_ONLYTRANS;
00320     <font class="keywordflow">case</font> SP_ISSHARED:
00321       <font class="keywordflow">return</font> FLG_SHAREDTRANS;
00322     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00323       <font class="keywordflow">return</font> FLG_DEPENDENTTRANS;
00324     <font class="keywordflow">case</font> SP_ISOWNED:
00325       <font class="keywordflow">return</font> FLG_OWNEDTRANS;
00326     <font class="keywordflow">case</font> SP_ISOBSERVER:
00327       <font class="keywordflow">return</font> FLG_OBSERVERTRANS;
00328     <font class="keywordflow">case</font> SP_ISEXPOSED:
00329       <font class="keywordflow">return</font> FLG_EXPOSETRANS;
00330     <font class="keywordflow">case</font> SP_ISNULL:
00331     <font class="keywordflow">case</font> SP_ISNOTNULL:
00332       <font class="keywordflow">return</font> FLG_NULLSTATE;
00333   }
00334 
00335   BADBRANCH;
00336 }
00337 
<a name="l00338"></a><a class="code" href="specialClauses_c.html#a16">00338</a> cstring <a class="code" href="specialClauses_c.html#a16">specialClause_preErrorString</a> (specialClause cl, sRef sr)<font class="keyword"></font>
00339 <font class="keyword"></font>{
00340   llassert (cl-&gt;state == TK_BOTH || cl-&gt;state == TK_BEFORE);
00341 
00342   <font class="keywordflow">switch</font> (cl-&gt;kind)
00343     {
00344     <font class="keywordflow">case</font> SP_USES:
00345       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr)) 
00346         <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Dead"</font>);
00347       <font class="keywordflow">else</font>
00348         <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Undefined"</font>);
00349     <font class="keywordflow">case</font> SP_ALLOCATES: <font class="comment">/*@fallthrough@*/</font> 
00350     <font class="keywordflow">case</font> SP_DEFINES:
00351     <font class="keywordflow">case</font> SP_SETS:
00352       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Allocated"</font>);
00353     <font class="keywordflow">case</font> SP_RELEASES:
00354       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (sr)) 
00355         {
00356           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Dead"</font>);
00357         }
00358       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (sr) 
00359                || <a class="code" href="sRef_c.html#a343">sRef_isShared</a> (sr))
00360         {
00361           <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (sr));
00362         }
00363       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (sr) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (sr))
00364         {
00365           <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a11">exkind_unparse</a> (sRef_getExKind (sr));
00366         }
00367       <font class="keywordflow">else</font>
00368         {
00369           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Undefined"</font>);
00370         }
00371     <font class="keywordflow">case</font> SP_ISONLY:
00372     <font class="keywordflow">case</font> SP_ISSHARED:
00373     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00374     <font class="keywordflow">case</font> SP_ISOWNED:
00375       <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a14">alkind_capName</a> (sRef_getAliasKind (sr));
00376     <font class="keywordflow">case</font> SP_ISOBSERVER:
00377       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-observer"</font>);
00378     <font class="keywordflow">case</font> SP_ISEXPOSED:
00379       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (sr))
00380         {
00381           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Observer"</font>);
00382         }
00383       <font class="keywordflow">else</font>
00384         {
00385           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-exposed"</font>);
00386         }
00387     <font class="keywordflow">case</font> SP_ISNOTNULL:
00388       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (sr))
00389         {
00390           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Null"</font>);
00391         }
00392       <font class="keywordflow">else</font>
00393         {
00394           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Possibly null"</font>);
00395         }
00396     <font class="keywordflow">case</font> SP_ISNULL:
00397       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-null"</font>);
00398   }
00399 
00400   BADEXIT;
00401 }
00402 
<a name="l00403"></a><a class="code" href="specialClauses_c.html#a17">00403</a> flagcode <a class="code" href="specialClauses_c.html#a17">specialClause_postErrorCode</a> (specialClause cl)<font class="keyword"></font>
00404 <font class="keyword"></font>{
00405   llassert (cl-&gt;state == TK_BOTH || cl-&gt;state == TK_AFTER);
00406 
00407   <font class="keywordflow">switch</font> (cl-&gt;kind)
00408     {
00409     <font class="keywordflow">case</font> SP_USES:
00410       BADBRANCHCONT;
00411       <font class="keywordflow">return</font> INVALID_FLAG;
00412     <font class="keywordflow">case</font> SP_ALLOCATES: 
00413     <font class="keywordflow">case</font> SP_DEFINES:  
00414     <font class="keywordflow">case</font> SP_SETS:     
00415       <font class="keywordflow">return</font> FLG_COMPDEF;
00416     <font class="keywordflow">case</font> SP_RELEASES:
00417       <font class="keywordflow">return</font> FLG_MUSTFREE;
00418     <font class="keywordflow">case</font> SP_ISONLY:
00419       <font class="keywordflow">return</font> FLG_ONLYTRANS;
00420     <font class="keywordflow">case</font> SP_ISSHARED:
00421       <font class="keywordflow">return</font> FLG_SHAREDTRANS;
00422     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00423       <font class="keywordflow">return</font> FLG_DEPENDENTTRANS;
00424     <font class="keywordflow">case</font> SP_ISOWNED:
00425       <font class="keywordflow">return</font> FLG_OWNEDTRANS;
00426     <font class="keywordflow">case</font> SP_ISOBSERVER:
00427       <font class="keywordflow">return</font> FLG_OBSERVERTRANS;
00428     <font class="keywordflow">case</font> SP_ISEXPOSED:
00429       <font class="keywordflow">return</font> FLG_EXPOSETRANS;
00430     <font class="keywordflow">case</font> SP_ISNULL:
00431     <font class="keywordflow">case</font> SP_ISNOTNULL:
00432       <font class="keywordflow">return</font> FLG_NULLSTATE;
00433   }
00434 
00435   BADBRANCH;
00436 }
00437 
<a name="l00438"></a><a class="code" href="specialClauses_c.html#a18">00438</a> cstring <a class="code" href="specialClauses_c.html#a18">specialClause_postErrorString</a> (specialClause cl, sRef sr)<font class="keyword"></font>
00439 <font class="keyword"></font>{
00440   llassert (cl-&gt;state == TK_BOTH || cl-&gt;state == TK_AFTER);
00441 
00442   <font class="keywordflow">switch</font> (cl-&gt;kind)
00443     {
00444     <font class="keywordflow">case</font> SP_USES:
00445       BADBRANCHCONT;
00446       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;ERROR&gt;"</font>);
00447     <font class="keywordflow">case</font> SP_ALLOCATES: 
00448       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Unallocated"</font>);
00449     <font class="keywordflow">case</font> SP_DEFINES:
00450     <font class="keywordflow">case</font> SP_SETS:
00451       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Undefined"</font>);
00452     <font class="keywordflow">case</font> SP_RELEASES:
00453       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Unreleased"</font>);
00454     <font class="keywordflow">case</font> SP_ISONLY:
00455     <font class="keywordflow">case</font> SP_ISSHARED:
00456     <font class="keywordflow">case</font> SP_ISOWNED:
00457     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00458       <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a14">alkind_capName</a> (sRef_getAliasKind (sr));
00459     <font class="keywordflow">case</font> SP_ISOBSERVER:
00460       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-observer"</font>);
00461     <font class="keywordflow">case</font> SP_ISEXPOSED:
00462       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (sr))
00463         {
00464           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Observer"</font>);
00465         }
00466       <font class="keywordflow">else</font>
00467         {
00468           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-exposed"</font>);
00469         }
00470     <font class="keywordflow">case</font> SP_ISNULL:
00471       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Non-null"</font>);
00472     <font class="keywordflow">case</font> SP_ISNOTNULL:
00473       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (sr))
00474         {
00475           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Null"</font>);
00476         }
00477       <font class="keywordflow">else</font>
00478         {
00479           <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"Possibly null"</font>);
00480         }
00481   }
00482 
00483   BADEXIT;
00484 }
00485 
00486 cstring specialClause_dump (specialClause s)<font class="keyword"></font>
00487 <font class="keyword"></font>{
00488   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d.%d.%q"</font>,
00489                    (<font class="keywordtype">int</font>) s-&gt;state,
00490                    (<font class="keywordtype">int</font>) s-&gt;kind,
00491                    <a class="code" href="sRefSet_c.html#a48">sRefSet_dump</a> (s-&gt;refs)));
00492 }
00493 
00494 specialClause specialClause_undump (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00495 <font class="keyword"></font>{
00496   specialClause ret = (specialClause) dmalloc (<font class="keyword">sizeof</font> (*ret));
00497 
00498   ret-&gt;state = (stateConstraint) <a class="code" href="general_c.html#a16">getInt</a> (s);
00499   checkChar (s, <font class="charliteral">'.'</font>);
00500   ret-&gt;kind = (specialClauseKind) <a class="code" href="general_c.html#a16">getInt</a> (s);
00501   checkChar (s, <font class="charliteral">'.'</font>);
00502   ret-&gt;refs = <a class="code" href="sRefSet_c.html#a47">sRefSet_undump</a> (s);
00503 
00504   <font class="keywordflow">return</font> ret;
00505 }
00506 
00507 specialClause specialClause_copy (specialClause s)<font class="keyword"> </font>
00508 <font class="keyword"></font>{
00509   specialClause ret = (specialClause) dmalloc (<font class="keyword">sizeof</font> (*ret));
00510   
00511   ret-&gt;state = s-&gt;state;
00512   ret-&gt;kind = s-&gt;kind;
00513   ret-&gt;refs = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (s-&gt;refs);
00514   
00515   <font class="keywordflow">return</font> ret;
00516 }
00517 
00518 <font class="keywordtype">bool</font> specialClause_sameKind (specialClause s1, specialClause s2)<font class="keyword"></font>
00519 <font class="keyword"></font>{
00520   <font class="keywordflow">return</font> (s1-&gt;state == s2-&gt;state &amp;&amp; s1-&gt;kind == s2-&gt;kind);
00521 }
00522 
00523 <font class="keywordtype">void</font> specialClause_free (specialClause s)<font class="keyword"></font>
00524 <font class="keyword"></font>{
00525   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (s-&gt;refs);
00526   <a class="code" href="general_c.html#a0">sfree</a> (s);
00527 }
00528 
00529 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring 
00530   specialClauseKind_unparse (specialClauseKind k)<font class="keyword"> </font>
00531 <font class="keyword"></font>{
00532   <font class="keywordflow">switch</font> (k)
00533     {
00534     <font class="keywordflow">case</font> SP_USES: 
00535       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"uses"</font>);
00536     <font class="keywordflow">case</font> SP_DEFINES:
00537       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"defines"</font>);
00538     <font class="keywordflow">case</font> SP_ALLOCATES:
00539       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"allocates"</font>);
00540     <font class="keywordflow">case</font> SP_RELEASES:
00541       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"releases"</font>);
00542     <font class="keywordflow">case</font> SP_SETS:
00543       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"sets"</font>);
00544     <font class="keywordflow">case</font> SP_ISNULL:
00545       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"isnull"</font>);
00546     <font class="keywordflow">case</font> SP_ISNOTNULL:
00547       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"notnull"</font>);
00548     <font class="keywordflow">case</font> SP_ISONLY:
00549       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"only"</font>);
00550     <font class="keywordflow">case</font> SP_ISSHARED:
00551       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"shared"</font>);
00552     <font class="keywordflow">case</font> SP_ISDEPENDENT:
00553       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"dependent"</font>);
00554     <font class="keywordflow">case</font> SP_ISOWNED:
00555       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"owned"</font>);
00556     <font class="keywordflow">case</font> SP_ISOBSERVER:
00557       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"observer"</font>);
00558     <font class="keywordflow">case</font> SP_ISEXPOSED:
00559       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"exposed"</font>);
00560     }
00561 
00562   BADEXIT;
00563 }
00564 
<a name="l00565"></a><a class="code" href="specialClauses_c.html#a20">00565</a> cstring <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (specialClause s)<font class="keyword"></font>
00566 <font class="keyword"></font>{
00567   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s%s"</font>,
00568                    cstring_makeLiteralTemp (s-&gt;state == TK_BEFORE 
00569                                             ? "pre:"
00570                                             : (s-&gt;state == TK_AFTER
00571                                                ? "post:" : "")),
00572                    specialClauseKind_unparse (s-&gt;kind)));
00573 }
00574 
<a name="l00575"></a><a class="code" href="specialClauses_c.html#a21">00575</a> cstring <a class="code" href="specialClauses_c.html#a21">specialClause_unparse</a> (specialClause s)<font class="keyword"></font>
00576 <font class="keyword"></font>{
00577   <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q"</font>, 
00578                    specialClause_unparseKind (s), <a class="code" href="sRefSet_c.html#a35">sRefSet_unparse</a> (s-&gt;refs)));
00579 }
00580 
<a name="l00581"></a><a class="code" href="specialClauses_c.html#a22">00581</a> specialClause <a class="code" href="specialClauses_c.html#a22">specialClause_createDefines</a> (sRefSet s)<font class="keyword"></font>
00582 <font class="keyword"></font>{
00583   <font class="keywordflow">return</font> (<a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (TK_BOTH, SP_DEFINES, s));
00584 }
00585 
<a name="l00586"></a><a class="code" href="specialClauses_c.html#a23">00586</a> specialClause <a class="code" href="specialClauses_c.html#a23">specialClause_createUses</a> (sRefSet s)<font class="keyword"></font>
00587 <font class="keyword"></font>{
00588   <font class="keywordflow">return</font> (<a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (TK_BOTH, SP_USES, s));
00589 }
00590 
<a name="l00591"></a><a class="code" href="specialClauses_c.html#a24">00591</a> specialClause <a class="code" href="specialClauses_c.html#a24">specialClause_createSets</a> (sRefSet s)<font class="keyword"></font>
00592 <font class="keyword"></font>{
00593   <font class="keywordflow">return</font> (<a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (TK_BOTH, SP_SETS, s));
00594 }
00595 
<a name="l00596"></a><a class="code" href="specialClauses_c.html#a25">00596</a> specialClause <a class="code" href="specialClauses_c.html#a25">specialClause_createReleases</a> (sRefSet s)<font class="keyword"></font>
00597 <font class="keyword"></font>{
00598   <font class="keywordflow">return</font> (<a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (TK_BOTH, SP_RELEASES, s));
00599 }
00600 
<a name="l00601"></a><a class="code" href="specialClauses_c.html#a26">00601</a> specialClause <a class="code" href="specialClauses_c.html#a26">specialClause_createAllocates</a> (sRefSet s)<font class="keyword"></font>
00602 <font class="keyword"></font>{
00603   <font class="keywordflow">return</font> (<a class="code" href="specialClauses_c.html#a6">specialClause_create</a> (TK_BOTH, SP_ALLOCATES, s));
00604 }
00605 
00606 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> specialClauses specialClauses_new (<font class="keywordtype">void</font>)<font class="keyword"></font>
00607 <font class="keyword"></font>{
00608   specialClauses s = (specialClauses) dmalloc (<font class="keyword">sizeof</font> (*s));
00609   
00610   s-&gt;nelements = 0;
00611   s-&gt;nspace = specialClausesBASESIZE;
00612   s-&gt;elements = (specialClause *) 
00613     dmalloc (<font class="keyword">sizeof</font> (*s-&gt;elements) * specialClausesBASESIZE);
00614 
00615   <font class="keywordflow">return</font> (s);
00616 }
00617 
00618 <font class="keyword">static</font> <font class="keywordtype">void</font>
00619 specialClauses_grow (specialClauses s)<font class="keyword"></font>
00620 <font class="keyword"></font>{
00621   <font class="keywordtype">int</font> i;
00622   specialClause *newelements;
00623 
00624   llassert (specialClauses_isDefined (s));
00625 
00626   s-&gt;nspace += specialClausesBASESIZE; 
00627   
00628   newelements = (specialClause *) 
00629     dmalloc (<font class="keyword">sizeof</font> (*newelements) * (s-&gt;nelements + s-&gt;nspace));
00630   
00631   <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00632     {
00633       newelements[i] = s-&gt;elements[i];
00634     }
00635   
00636   <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements);
00637   s-&gt;elements = newelements;
00638 }
00639 
<a name="l00640"></a><a class="code" href="specialClauses_c.html#a29">00640</a> specialClauses <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (specialClauses s, specialClause el)<font class="keyword"></font>
00641 <font class="keyword"></font>{
00642   <font class="keywordflow">if</font> (specialClauses_isUndefined (s))
00643     {
00644       s = specialClauses_new ();
00645     }
00646   <font class="keywordflow">else</font>
00647     {
00648       specialClauses_elements (s, cl)<font class="keyword"></font>
00649 <font class="keyword">        </font>{
00650           <font class="keywordflow">if</font> (specialClause_sameKind (cl, el))
00651             {
00652               voptgenerror
00653                 (FLG_SYNTAX,
00654                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Multiple %q clauses for one function (using union)"</font>,
00655                           specialClause_unparseKind (cl)),
00656                  g_currentloc);
00657 
00658               cl-&gt;refs = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (cl-&gt;refs, el-&gt;refs);
00659               specialClause_free (el);
00660               <font class="keywordflow">return</font> s;
00661             }
00662         } end_specialClauses_elements ;
00663     }
00664 
00665   <font class="keywordflow">if</font> (s-&gt;nspace &lt;= 0)
00666     {
00667       specialClauses_grow (s);
00668     }
00669   
00670   s-&gt;nspace--;
00671   s-&gt;elements[s-&gt;nelements] = el;
00672   s-&gt;nelements++;
00673 
00674   <font class="keywordflow">return</font> s;
00675 }
00676 
<a name="l00677"></a><a class="code" href="specialClauses_c.html#a30">00677</a> cstring <a class="code" href="specialClauses_c.html#a30">specialClauses_unparse</a> (specialClauses s)<font class="keyword"></font>
00678 <font class="keyword"></font>{
00679   cstring st = cstring_undefined;
00680   <font class="keywordtype">int</font> i;
00681   
00682   <font class="keywordflow">if</font> (specialClauses_isDefined (s))
00683     {
00684       <font class="keywordflow">for</font> (i = 0; i &lt; specialClauses_size (s); i++)
00685         {
00686           <font class="keywordflow">if</font> (i == 0)
00687             {
00688               st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q;"</font>, specialClause_unparse (s-&gt;elements[i]));
00689             }
00690           <font class="keywordflow">else</font>
00691             st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q;"</font>, st, specialClause_unparse (s-&gt;elements[i]));
00692         }
00693     }
00694   
00695   <font class="keywordflow">return</font> (st);
00696 }
00697 
<a name="l00698"></a><a class="code" href="specialClauses_c.html#a31">00698</a> specialClauses <a class="code" href="specialClauses_c.html#a31">specialClauses_copy</a> (specialClauses s)<font class="keyword"></font>
00699 <font class="keyword"></font>{
00700   <font class="keywordflow">if</font> (specialClauses_isDefined (s))
00701     {
00702       specialClauses t = (specialClauses) dmalloc (<font class="keyword">sizeof</font> (*t));
00703       <font class="keywordtype">int</font> i;
00704       
00705       t-&gt;nelements = s-&gt;nelements;
00706       t-&gt;nspace = 0;
00707       
00708       <font class="keywordflow">if</font> (s-&gt;nelements &gt; 0)
00709         {
00710           t-&gt;elements = (specialClause *) dmalloc (<font class="keyword">sizeof</font> (*t-&gt;elements) * t-&gt;nelements);
00711           <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++) 
00712             {
00713               t-&gt;elements[i] = specialClause_copy (s-&gt;elements[i]); 
00714             }
00715         }
00716       <font class="keywordflow">else</font>
00717         {
00718           t-&gt;elements = NULL;
00719         }
00720 
00721       <font class="keywordflow">return</font> t;
00722     }
00723   <font class="keywordflow">else</font>
00724     {
00725       <font class="keywordflow">return</font> specialClauses_undefined;
00726     }
00727 }
00728 
00729 <font class="keywordtype">void</font>
<a name="l00730"></a><a class="code" href="specialClauses_c.html#a32">00730</a> <a class="code" href="specialClauses_c.html#a32">specialClauses_free</a> (specialClauses s)<font class="keyword"></font>
00731 <font class="keyword"></font>{
00732   <font class="keywordflow">if</font> (!specialClauses_isUndefined (s)) 
00733     {
00734       <font class="keywordtype">int</font> i;
00735 
00736       <font class="keywordflow">for</font> (i = 0; i &lt; s-&gt;nelements; i++)
00737         {
00738           specialClause_free (s-&gt;elements[i]);  
00739         }
00740 
00741       <a class="code" href="general_c.html#a0">sfree</a> (s-&gt;elements);
00742       <a class="code" href="general_c.html#a0">sfree</a> (s);
00743     }
00744 }
00745 
<a name="l00746"></a><a class="code" href="specialClauses_c.html#a33">00746</a> cstring <a class="code" href="specialClauses_c.html#a33">specialClauses_dump</a> (specialClauses s)<font class="keyword"></font>
00747 <font class="keyword"></font>{
00748   cstring st = cstring_undefined;
00749 
00750   <font class="keywordflow">if</font> (specialClauses_isUndefined (s)) <font class="keywordflow">return</font> st;
00751   
00752   specialClauses_elements (s, current)<font class="keyword"></font>
00753 <font class="keyword">    </font>{
00754       st = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q%q$"</font>, st, specialClause_dump (current));
00755     } end_specialClauses_elements;
00756 
00757   <font class="keywordflow">return</font> st;
00758 }
00759 
<a name="l00760"></a><a class="code" href="specialClauses_c.html#a34">00760</a> specialClauses <a class="code" href="specialClauses_c.html#a34">specialClauses_undump</a> (<font class="keywordtype">char</font> **s)<font class="keyword"></font>
00761 <font class="keyword"></font>{
00762   <font class="keywordtype">char</font> c;
00763   specialClauses pn = specialClauses_new ();
00764   <font class="keywordtype">int</font> paramno = 0;
00765 
00766   c = **s;
00767 
00768   <font class="keywordflow">while</font> (c != <font class="charliteral">'#'</font> &amp;&amp; c != <font class="charliteral">'@'</font>)
00769     {
00770       specialClause sc = specialClause_undump (s);
00771       
00772       pn = <a class="code" href="specialClauses_c.html#a29">specialClauses_add</a> (pn, sc);
00773       checkChar (s, <font class="charliteral">'$'</font>);
00774       c = **s;
00775       paramno++;
00776     }
00777 
00778   <font class="keywordflow">return</font> pn;
00779 }
00780 
00781 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRefSet
00782   specialClauses_getClause (specialClauses s, stateConstraint st, 
00783                             specialClauseKind k)<font class="keyword"></font>
00784 <font class="keyword"></font>{
00785   specialClauses_elements (s, el)<font class="keyword"></font>
00786 <font class="keyword">    </font>{
00787       <font class="keywordflow">if</font> (el-&gt;state == st &amp;&amp; el-&gt;kind == k)
00788         {
00789           <font class="keywordflow">return</font> el-&gt;refs;
00790         }
00791     } end_specialClauses_elements ;
00792 
00793   <font class="keywordflow">return</font> sRefSet_undefined;
00794 }
00795 
<a name="l00796"></a><a class="code" href="specialClauses_c.html#a36">00796</a> <font class="keywordtype">void</font> <a class="code" href="specialClauses_c.html#a36">specialClauses_checkAll</a> (uentry ue)<font class="keyword"></font>
00797 <font class="keyword"></font>{
00798   specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (ue);
00799   sRef res = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (ue);                 
00800   <font class="keywordtype">bool</font> specialResult = FALSE;
00801 
00802   specialClauses_elements (clauses, cl)<font class="keyword"></font>
00803 <font class="keyword">    </font>{
00804       <font class="keywordtype">bool</font> isPre = (cl-&gt;state == TK_BEFORE);
00805       sRefSet refs = cl-&gt;refs;
00806 
00807       sRefSet_allElements (refs, el)<font class="keyword"></font>
00808 <font class="keyword">        </font>{
00809           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
00810 
00811           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (rb))
00812             {
00813               <font class="keywordflow">if</font> (isPre)
00814                 {
00815                   voptgenerror
00816                     (FLG_INCONDEFS,
00817                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function result is used in %q clause of %q "</font>
00818                               <font class="stringliteral">"(%q applies to the state before function is "</font>
00819                               <font class="stringliteral">"called, so should not use result): %q"</font>,
00820                               specialClause_unparseKind (cl),
00821                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
00822                               <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
00823                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
00824                      <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
00825                 }
00826               <font class="keywordflow">else</font>
00827                 {
00828                   <font class="keywordflow">if</font> (!sRef_isStateSpecial (res))
00829                     {
00830                       <font class="keywordflow">if</font> (!specialResult)
00831                         {
00832                           voptgenerror
00833                             (FLG_INCONDEFS,
00834                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function result is used in %q clause of %q "</font>
00835                                       <font class="stringliteral">"but not annotated with special: %q"</font>,
00836                                       specialClause_unparseKind (cl),
00837                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
00838                                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
00839                              <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
00840 
00841                           specialResult = TRUE;
00842                         }
00843                     }
00844 
00845                   (<font class="keywordtype">void</font>) <a class="code" href="sRef_c.html#a335">sRef_fixResultType</a> (el, sRef_getType (res), ue);
00846                 }
00847             }
00848           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (rb))
00849             {
00850               <font class="keywordflow">if</font> (!sRef_isStateSpecial (rb))
00851                 {
00852                   voptgenerror 
00853                     (FLG_INCONDEFS,
00854                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference %q used in %q clause of %q, "</font>
00855                               <font class="stringliteral">"but not annotated with special: %q"</font>,
00856                               sRef_unparse (rb),
00857                               <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
00858                               <a class="code" href="uentry_c.html#a195">uentry_getName</a> (ue),
00859                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el)),
00860                      <a class="code" href="uentry_c.html#a198">uentry_whereLast</a> (ue));
00861                 }
00862             }
00863           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isInvalid (rb))
00864             {
00865               <font class="comment">/*@innercontinue@*/</font> <font class="keywordflow">continue</font>;
00866             }
00867           <font class="keywordflow">else</font> 
00868             {
00869               BADBRANCHCONT;
00870               <font class="comment">/*@innercontinue@*/</font> <font class="keywordflow">continue</font>;
00871             }
00872 
00873           <font class="keywordflow">if</font> (specialClause_isMemoryAllocation (cl))
00874             {
00875               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (sRef_getType (el)))
00876                 {
00877                   llerror 
00878                     (FLG_SYNTAX, 
00879                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Special clause %q includes %q of "</font>
00880                               <font class="stringliteral">"non-dynamically allocatated type %s"</font>,
00881                               specialClause_unparseKind (cl),
00882                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el), 
00883                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (sRef_getType (el))));
00884                 }
00885             }
00886 
00887         } end_sRefSet_allElements ;
00888     } end_specialClauses_elements ;
00889 }
00890   
<a name="l00891"></a><a class="code" href="specialClauses_c.html#a37">00891</a> <font class="keywordtype">void</font> <a class="code" href="specialClauses_c.html#a37">specialClauses_checkEqual</a> (uentry old, uentry unew)<font class="keyword"></font>
00892 <font class="keyword"></font>{
00893   specialClauses oldClauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (old);
00894   specialClauses newClauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (unew);
00895 
00896   <font class="keywordflow">if</font> (specialClauses_isDefined (newClauses))
00897     {
00898       specialClauses_elements (newClauses, cl)<font class="keyword"></font>
00899 <font class="keyword">        </font>{
00900           sRefSet sc = specialClauses_getClause (oldClauses, cl-&gt;state, cl-&gt;kind);
00901 
00902           <font class="keywordflow">if</font> (!<a class="code" href="sRefSet_c.html#a46">sRefSet_equal</a> (sc, cl-&gt;refs))
00903             {
00904               <font class="keywordflow">if</font> (optgenerror
00905                   (FLG_INCONDEFS,
00906                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q %rdeclared with inconsistent %q clause: %q"</font>,
00907                             uentry_getName (old),
00908                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
00909                             <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
00910                             <a class="code" href="sRefSet_c.html#a36">sRefSet_unparsePlain</a> (cl-&gt;refs)),
00911                    g_currentloc))
00912                 {
00913                   <a class="code" href="uentry_c.html#a243">uentry_showWhereLastExtra</a> (old, sRefSet_unparsePlain (sc));
00914                 }
00915             }
00916         } end_specialClauses_elements ;
00917 
00918       specialClauses_elements (oldClauses, cl)<font class="keyword"></font>
00919 <font class="keyword">        </font>{
00920           sRefSet sc = specialClauses_getClause (newClauses, cl-&gt;state, cl-&gt;kind);
00921 
00922           <font class="keywordflow">if</font> (sRefSet_isUndefined (sc) &amp;&amp; !sRefSet_isEmpty (cl-&gt;refs))
00923             {
00924               <font class="keywordflow">if</font> (optgenerror
00925                   (FLG_INCONDEFS,
00926                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %q %rdeclared without %q clause (either "</font>
00927                             <font class="stringliteral">"use no special clauses in redeclaration, or "</font>
00928                             <font class="stringliteral">"they must match exactly: %q"</font>,
00929                             uentry_getName (old),
00930                             <a class="code" href="uentry_c.html#a212">uentry_isDeclared</a> (old),
00931                             <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
00932                             <a class="code" href="sRefSet_c.html#a36">sRefSet_unparsePlain</a> (cl-&gt;refs)),
00933                    g_currentloc))
00934                 {
00935                   <a class="code" href="uentry_c.html#a243">uentry_showWhereLastExtra</a> (old, sRefSet_unparsePlain (sc));
00936                 }
00937             }
00938         } end_specialClauses_elements ;
00939 
00940     }
00941 }
00942 
00943 
00944 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:43 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
