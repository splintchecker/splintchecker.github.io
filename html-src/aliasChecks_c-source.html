<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>aliasChecks.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:38 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>aliasChecks.c</h1><a href="aliasChecks_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** aliasChecks.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include "lclintMacros.nf"</font>
00029 <font class="preprocessor"># include "basic.h"</font>
00030 <font class="preprocessor"># include "aliasChecks.h"</font>
00031 
00032 <font class="keyword">static</font> <font class="keywordtype">void</font> checkStructTransfer (exprNode p_lhs, sRef p_slhs, exprNode p_rhs, sRef p_srhs,
00033                                  fileloc p_loc, transferKind p_tt);
00034 <font class="keyword">static</font> <font class="keywordtype">void</font> checkLeaveTrans (uentry p_actual, transferKind p_transferType);
00035 <font class="keyword">static</font> <font class="keywordtype">void</font> checkTransfer (exprNode p_fexp, sRef p_fref,
00036                            exprNode p_texp, sRef p_tref, 
00037                            fileloc p_loc, transferKind p_transferType);
00038 <font class="keyword">static</font> <font class="keywordtype">void</font> checkGlobTrans (uentry p_glob, transferKind p_type);
00039 
00040 <font class="keyword">static</font> ynm
00041   checkCompletelyDefined (exprNode p_fexp, sRef p_fref, 
00042                           exprNode p_texp, sRef p_tref,
00043                           <font class="keywordtype">bool</font> p_topLevel, <font class="keywordtype">bool</font> p_inUnion, <font class="keywordtype">bool</font> p_directUnion,
00044                           fileloc p_loc, transferKind p_transferType, <font class="keywordtype">int</font> p_depth,
00045                           <font class="keywordtype">bool</font> p_report);
00046 
00047 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef dependentReference (sRef p_sr);
00048 <font class="keyword">static</font> <font class="keywordtype">bool</font> canLoseLocalReference (sRef p_sr, fileloc p_loc) ;
00049 
00050 <font class="comment">/*</font>
00051 <font class="comment">** returns the most specific alkind</font>
00052 <font class="comment">*/</font>
00053 
<a name="l00054"></a><a class="code" href="aliasChecks_c.html#a14">00054</a> alkind <a class="code" href="aliasChecks_c.html#a14">alkind_resolve</a> (alkind a1, alkind a2)<font class="keyword"></font>
00055 <font class="keyword"></font>{
00056   <font class="keywordflow">if</font> (a1 == AK_UNKNOWN || a1 == AK_ERROR) <font class="keywordflow">return</font> a2;
00057   <font class="keywordflow">if</font> (a2 == AK_UNKNOWN || a2 == AK_ERROR || a2 == AK_LOCAL) <font class="keywordflow">return</font> a1;
00058   <font class="keywordflow">if</font> (a1 == AK_LOCAL) <font class="keywordflow">return</font> a2;
00059   <font class="keywordflow">return</font> a1;
00060 }
00061 
00062 <font class="comment">/*</font>
00063 <font class="comment">** tref &lt;- fref</font>
00064 <font class="comment">**</font>
00065 <font class="comment">** transferType:</font>
00066 <font class="comment">**   FCNRETURN   return fref; tref is return type</font>
00067 <font class="comment">**   GLOBASSIGN  tref = fref; </font>
00068 <font class="comment">**   FCNPASS     call (fref) ; tref is the argument type</font>
00069 <font class="comment">**</font>
00070 <font class="comment">*/</font>
00071 
00072 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring
00073 transferErrorMessage (transferKind transferType, alkind tkind) <font class="comment">/*@*/</font> 
00074 {
00075   <font class="keywordflow">switch</font> (transferType)
00076     {
00077     <font class="keywordflow">case</font> TT_FCNRETURN:
00078       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"returned as %s"</font>, alkind_unparse (tkind)));
00079     <font class="keywordflow">case</font> TT_DOASSIGN:
00080       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"assigned to %s"</font>, alkind_unparse (tkind)));
00081     <font class="keywordflow">case</font> TT_FIELDASSIGN:
00082       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"assigned to %s"</font>, alkind_unparse (tkind)));
00083     <font class="keywordflow">case</font> TT_GLOBINIT:
00084       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"used as initial value for %s"</font>, 
00085                        alkind_unparse (tkind)));
00086     <font class="keywordflow">case</font> TT_FCNPASS:
00087       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"passed as %s param"</font>, alkind_unparse (tkind)));
00088     BADDEFAULT;
00089     }
00090   BADEXIT;
00091 }
00092 
00093 <font class="keyword">static</font> cstring
00094 transferErrorExpMessage (transferKind transferType, exkind tkind) <font class="comment">/*@*/</font>
00095 {
00096   <font class="keywordflow">if</font> (exkind_isUnknown (tkind))
00097     {
00098       <font class="keywordflow">switch</font> (transferType)
00099         {
00100         <font class="keywordflow">case</font> TT_FCNRETURN:
00101           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"returned without qualification"</font>));
00102         <font class="keywordflow">case</font> TT_FIELDASSIGN:
00103         <font class="keywordflow">case</font> TT_DOASSIGN:
00104           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"assigned to unqualified reference"</font>));
00105         <font class="keywordflow">case</font> TT_FCNPASS:
00106           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"passed without qualification"</font>));
00107         <font class="keywordflow">case</font> TT_GLOBINIT:
00108           <font class="keywordflow">return</font> (cstring_makeLiteral (<font class="stringliteral">"used as initial value for unqualified storage"</font>));
00109         BADDEFAULT;
00110         }
00111     }
00112   <font class="keywordflow">else</font>
00113     {
00114       <font class="keywordflow">switch</font> (transferType)
00115         {
00116         <font class="keywordflow">case</font> TT_FCNRETURN:
00117           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"returned as %s"</font>, exkind_unparse (tkind)));
00118         <font class="keywordflow">case</font> TT_FIELDASSIGN:
00119         <font class="keywordflow">case</font> TT_DOASSIGN:
00120           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"assigned to %s"</font>, exkind_unparse (tkind)));
00121         <font class="keywordflow">case</font> TT_FCNPASS:
00122           <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"passed as %s param"</font>, exkind_unparse (tkind)));
00123           BADDEFAULT;
00124         }
00125     }
00126 
00127   BADEXIT;
00128 }
00129 
00130 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring
00131 transferNullMessage (transferKind transferType) <font class="comment">/*@*/</font>
00132 {
00133   <font class="keywordflow">switch</font> (transferType)
00134     {
00135     <font class="keywordflow">case</font> TT_FCNRETURN:
00136       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"returned as non-null"</font>));
00137     <font class="keywordflow">case</font> TT_DOASSIGN:
00138     <font class="keywordflow">case</font> TT_FIELDASSIGN:
00139       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"assigned to non-null"</font>));
00140     <font class="keywordflow">case</font> TT_GLOBINIT:
00141       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"initialized to non-null"</font>));
00142     <font class="keywordflow">case</font> TT_FCNPASS:
00143       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"passed as non-null param"</font>));
00144     BADDEFAULT;
00145     }
00146   BADEXIT;
00147 }
00148 
00149 <font class="keyword">static</font> <font class="comment">/*@dependent@*/</font> exprNode atFunction = exprNode_undefined;
00150 <font class="keyword">static</font> <font class="keywordtype">int</font> atArgNo = 0;
00151 <font class="keyword">static</font> <font class="keywordtype">int</font> atNumArgs = 0;
00152 
00153 <font class="keyword">static</font> cstring generateText (exprNode e1, exprNode e2, 
00154                              sRef tref, transferKind tt) 
00155    <font class="comment">/*@*/</font>
00156 {
00157   <font class="keywordflow">if</font> (tt == TT_DOASSIGN || tt == TT_GLOBINIT)
00158     {
00159       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s = %s"</font>, exprNode_unparse (e2),
00160                        <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1)));
00161     }
00162   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (tt == TT_FIELDASSIGN)
00163     {
00164       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s = %s (field %q)"</font>,
00165                        exprNode_unparse (e2),
00166                        <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1),
00167                        <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (tref)));
00168     }
00169   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (tt == TT_FCNPASS)
00170     {
00171       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s (%s%s%s)"</font>,
00172                        exprNode_unparse (atFunction),
00173                        (atArgNo == 1 ? cstring_undefined 
00174                 : cstring_makeLiteralTemp (<font class="stringliteral">"..., "</font>)),
00175                        <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1),
00176                        (atArgNo == atNumArgs ? cstring_undefined
00177                         : cstring_makeLiteralTemp (<font class="stringliteral">", ..."</font>))));
00178     }
00179   <font class="keywordflow">else</font>
00180     {
00181       <font class="keywordflow">return</font> (<a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprNode_unparse (e1)));
00182     }
00183 }
00184 
00185 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring
00186 transferType_unparse (transferKind transferType) <font class="comment">/*@*/</font>
00187 {
00188   <font class="keywordflow">switch</font> (transferType)
00189     {
00190     <font class="keywordflow">case</font> TT_FCNRETURN:
00191       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Returned"</font>));
00192     <font class="keywordflow">case</font> TT_DOASSIGN:
00193     <font class="keywordflow">case</font> TT_FIELDASSIGN:
00194       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Assigned"</font>));
00195     <font class="keywordflow">case</font> TT_FCNPASS:
00196       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Passed"</font>));
00197     <font class="keywordflow">case</font> TT_GLOBINIT:
00198       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"Initialized"</font>));
00199     <font class="keywordflow">case</font> TT_GLOBRETURN:
00200       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"GLOB RETURN!"</font>));
00201     <font class="keywordflow">case</font> TT_GLOBPASS:
00202       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"GLOB PASS!"</font>));
00203     <font class="keywordflow">case</font> TT_PARAMRETURN:
00204       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"PARAM RETURN!"</font>));
00205     <font class="keywordflow">case</font> TT_LEAVETRANS:
00206       <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"LEAVE TRANS!"</font>));
00207     BADDEFAULT;
00208     }
00209   BADEXIT;
00210 }
00211 
00212 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring udError (sRef s)<font class="keyword"></font>
00213 <font class="keyword"></font>{
00214   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (s))
00215     {
00216       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"released"</font>);
00217     }
00218   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s))
00219     {
00220       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"allocated but not defined"</font>);
00221     }
00222   <font class="keywordflow">else</font>
00223     {
00224       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"undefined"</font>);
00225     }
00226 }
00227 
00228 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> 
00229 cstring defExpl (sRef s) <font class="comment">/*@*/</font>
00230 {
00231   sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
00232 
00233   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (rb, s))
00234     {
00235       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s))
00236         {
00237           <font class="keywordflow">return</font> cstring_makeLiteral (<font class="stringliteral">" (allocated only)"</font>);
00238         }
00239       <font class="keywordflow">return</font> cstring_undefined;
00240     }
00241   <font class="keywordflow">else</font>
00242     {
00243       <font class="keywordflow">return</font> (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">" (%q is %s)"</font>, sRef_unparse (s), udError (s)));
00244     }
00245 }
00246 
00247 <font class="comment">/*</font>
00248 <font class="comment">** returns TRUE if fref is completely defined.</font>
00249 <font class="comment">** if !report, returns TRUE unless error is at the deep level.</font>
00250 <font class="comment">*/</font>
00251 
00252 <font class="keyword">static</font> ynm
00253   checkCompletelyDefined (exprNode fexp, sRef fref, 
00254                           exprNode texp, sRef tref, 
00255                           <font class="keywordtype">bool</font> topLevel, <font class="keywordtype">bool</font> inUnion, <font class="keywordtype">bool</font> directUnion,
00256                           fileloc loc, transferKind transferType,
00257                           <font class="keywordtype">int</font> depth, <font class="keywordtype">bool</font> report)<font class="keyword"></font>
00258 <font class="keyword"></font>{
00259   ctype ct;
00260   alkind fkind = sRef_getAliasKind (fref);
00261   alkind tkind = sRef_getAliasKind (tref);
00262   
00263   <font class="keywordflow">if</font> (depth &gt; MAXDEPTH)
00264     {
00265       llquietbug
00266         (message 
00267          (<font class="stringliteral">"Check definition limit exceeded, checking %q. "</font>
00268           <font class="stringliteral">"This either means there is a variable with at least "</font>
00269           <font class="stringliteral">"%d indirections apparent in the program text, or "</font>
00270           <font class="stringliteral">"there is a bug in LCLint."</font>,
00271           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref),
00272           MAXDEPTH));
00273 
00274       <font class="keywordflow">return</font> YES;
00275     }
00276 
00277   <font class="keywordflow">if</font> (!sRef_isKnown (fref))
00278     {
00279       <font class="keywordflow">return</font> YES;
00280     }
00281 
00282   <font class="keywordflow">if</font> (alkind_isStack (fkind))
00283     {
00284       ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tref));
00285 
00286       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (rt) &amp;&amp; !ctype_isSU (rt))
00287         {
00288           <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
00289             {
00290               <font class="keywordflow">if</font> (optgenerror 
00291                   (FLG_RETSTACK,
00292                    message
00293                    (<font class="stringliteral">"Stack-allocated storage %qreachable from parameter %q"</font>,
00294                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
00295                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef_getRootBase (fref))), 
00296                    loc))
00297                 {
00298                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00299                 }
00300             }
00301           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00302             {
00303               <font class="keywordflow">if</font> (optgenerror 
00304                   (FLG_RETSTACK,
00305                    message
00306                    (<font class="stringliteral">"Stack-allocated storage %qreachable from global %q"</font>,
00307                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
00308                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef_getRootBase (fref))),
00309                    loc))
00310                 {
00311                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00312                 }
00313             }
00314           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
00315             {
00316               <font class="keywordflow">if</font> (optgenerror 
00317                   (FLG_RETSTACK,
00318                    message 
00319                    (<font class="stringliteral">"Stack-allocated storage %qreachable from return value: %s"</font>,
00320                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00321                     <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
00322                    loc))
00323                 {
00324                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00325                 }
00326             }
00327           <font class="keywordflow">else</font>
00328             {
00329               <font class="comment">/* no error */</font>
00330             }
00331         }
00332     }
00333 
00334   <font class="keywordflow">if</font> (!topLevel)
00335     {
00336       <font class="keywordflow">if</font> ((<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) &amp;&amp; !<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref))
00337           || (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (fref) &amp;&amp; !(<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref) 
00338                                          || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref))))
00339         {
00340           flagcode code = (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) 
00341                            ? FLG_OBSERVERTRANS : FLG_EXPOSETRANS);
00342 
00343           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a311">sRef_isStateLive</a> (fref))
00344             {
00345               ; <font class="comment">/* no error (will be a definition error) */</font>
00346             }
00347           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_DOASSIGN
00348                    || transferType == TT_FIELDASSIGN
00349                    || transferType == TT_GLOBINIT
00350                    || transferType == TT_FCNPASS)
00351             {
00352               ; <font class="comment">/* no error */</font>
00353             }
00354           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
00355             {
00356               <font class="keywordflow">if</font> (optgenerror 
00357                   (code,
00358                    message
00359                    (<font class="stringliteral">"%s storage %qreachable from %s parameter"</font>,
00360                     <a class="code" href="varKinds_c.html#a12">exkind_capName</a> (sRef_getExKind (fref)),
00361                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00362                     <a class="code" href="varKinds_c.html#a13">exkind_unparseError</a> (sRef_getExKind (tref))),
00363                    loc))
00364                 {
00365                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
00366                   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (fref, XO_UNKNOWN, loc);
00367                 }
00368             }
00369           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
00370             {
00371               ;
00372             }
00373           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBINIT)
00374             {
00375               <font class="keywordflow">if</font> (optgenerror 
00376                   (code,
00377                    message 
00378                    (<font class="stringliteral">"%s storage %qreachable from %s initial value"</font>,
00379                     <a class="code" href="varKinds_c.html#a12">exkind_capName</a> (sRef_getExKind (fref)),
00380                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00381                     <a class="code" href="varKinds_c.html#a13">exkind_unparseError</a> (sRef_getExKind (tref))),
00382                    loc))
00383                 {
00384                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
00385                   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (fref, XO_UNKNOWN, loc);
00386                 }
00387             }
00388           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00389             {
00390               <font class="keywordflow">if</font> (optgenerror 
00391                   (code,
00392                    message
00393                    (<font class="stringliteral">"%s storage %qreachable from %s global"</font>,
00394                     <a class="code" href="varKinds_c.html#a12">exkind_capName</a> (sRef_getExKind (fref)),
00395                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00396                     <a class="code" href="varKinds_c.html#a13">exkind_unparseError</a> (sRef_getExKind (tref))),
00397                    loc))
00398                 {
00399                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
00400                   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (fref, XO_UNKNOWN, loc);
00401                 }
00402             }
00403           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
00404             {
00405               <font class="keywordflow">if</font> (optgenerror 
00406                   (code,
00407                    message 
00408                    (<font class="stringliteral">"%s storage %qreachable from %s return value"</font>,
00409                     <a class="code" href="varKinds_c.html#a12">exkind_capName</a> (sRef_getExKind (fref)),
00410                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00411                     <a class="code" href="varKinds_c.html#a13">exkind_unparseError</a> (sRef_getExKind (tref))),
00412                    loc))
00413                 {
00414                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
00415                   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (fref, XO_UNKNOWN, loc);
00416                 }
00417             }
00418           <font class="keywordflow">else</font>
00419             {
00420               llcontbug (message (<font class="stringliteral">"Transfer type: %s"</font>, 
00421                                   transferType_unparse (transferType)));
00422               
00423               <font class="keywordflow">if</font> (optgenerror 
00424                   (code,
00425                    message
00426                    (<font class="stringliteral">"%s storage %qreachable from %s return value"</font>,
00427                     <a class="code" href="varKinds_c.html#a12">exkind_capName</a> (sRef_getExKind (fref)),
00428                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00429                     <a class="code" href="varKinds_c.html#a13">exkind_unparseError</a> (sRef_getExKind (tref))),
00430                    loc))
00431                 {
00432                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
00433                   <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (fref, XO_UNKNOWN, loc);
00434                 }
00435             }
00436 
00437         }
00438       
00439       <font class="keywordflow">if</font> (!<a class="code" href="varKinds_c.html#a20">alkind_compatible</a> (fkind, tkind))
00440         {
00441           <font class="keywordflow">if</font> (fkind == AK_UNKNOWN &amp;&amp; !<a class="code" href="sRef_c.html#a311">sRef_isStateLive</a> (fref))
00442             {
00443               ; <font class="comment">/* no error (will be a definition error) */</font>
00444             }
00445           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_DOASSIGN)
00446             {
00447               ; <font class="comment">/* no error */</font>
00448             }
00449           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNPASS)
00450             {
00451               <font class="keywordflow">if</font> (alkind_isKnown (sRef_getAliasKind (tref)))
00452                 {
00453                   <font class="keywordflow">if</font> (optgenerror 
00454                       (FLG_COMPMEMPASS,
00455                        message
00456                        (<font class="stringliteral">"Storage %qreachable from passed parameter "</font>
00457                         <font class="stringliteral">"is %s (should be %s): %s"</font>,
00458                         <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00459                         <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00460                         <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref)),
00461                         <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
00462                        loc))
00463                     {
00464                       <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00465                     }
00466                 }
00467             }
00468           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
00469             {
00470               <font class="keywordtype">bool</font> noerror = FALSE;
00471 
00472               <font class="keywordflow">if</font> (alkind_isDependent (sRef_getAliasKind (fref)))
00473                 {
00474                   <font class="keywordflow">if</font> (canLoseLocalReference (fref, loc))
00475                     {
00476                       noerror = TRUE;
00477                     }
00478                 }
00479 
00480               <font class="keywordflow">if</font> (!noerror
00481                   &amp;&amp; optgenerror 
00482                   (FLG_COMPMEMPASS,
00483                    message
00484                    (<font class="stringliteral">"Storage %qreachable from parameter is %s (should be %s)"</font>,
00485                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00486                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00487                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00488                    loc))
00489                 {
00490                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00491                 }
00492               }
00493           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
00494             {
00495               <font class="keywordflow">if</font> (optgenerror 
00496                   (FLG_COMPMEMPASS,
00497                    message
00498                    (<font class="stringliteral">"Storage %qreachable from temporary reference is %s "</font>
00499                     <font class="stringliteral">"at scope exit (should be %s)"</font>,
00500                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00501                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00502                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00503                    loc))
00504                 {
00505                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00506                 }
00507               }
00508           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00509             {
00510               <font class="keywordflow">if</font> (optgenerror 
00511                   (FLG_COMPMEMPASS,
00512                    message
00513                    (<font class="stringliteral">"Storage %qreachable from global is %s (should be %s)"</font>,
00514                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00515                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00516                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00517                    loc))
00518                 {
00519                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00520                 }
00521             }
00522           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
00523             {
00524               <font class="keywordflow">if</font> (optgenerror 
00525                   (FLG_COMPMEMPASS,
00526                    message 
00527                    (<font class="stringliteral">"Storage %qreachable from return value is %s (should be %s)"</font>,
00528                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00529                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00530                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00531                    loc))
00532                 {
00533                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00534                 }
00535             }
00536           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBINIT)
00537             {
00538               <font class="keywordflow">if</font> (optgenerror 
00539                   (FLG_COMPMEMPASS,
00540                    message 
00541                    (<font class="stringliteral">"Storage %qreachable from initial value is %s (should be %s)"</font>,
00542                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00543                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00544                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00545                    loc))
00546                 {
00547                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00548                 }
00549             }
00550           <font class="keywordflow">else</font>
00551             {
00552               llcontbug (message (<font class="stringliteral">"Transfer type: %s"</font>, 
00553                                   transferType_unparse (transferType)));
00554               
00555               <font class="keywordflow">if</font> (optgenerror 
00556                   (FLG_COMPMEMPASS,
00557                    message
00558                    (<font class="stringliteral">"Storage %qreachable from return value is %s (should be %s)"</font>,
00559                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00560                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (fref)),
00561                     <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref))),
00562                    loc))
00563                 {
00564                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
00565                 }
00566             }
00567         }
00568 
00569       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref))
00570         {
00571           <font class="keywordflow">if</font> (directUnion)
00572             {
00573               <font class="keywordflow">return</font> NO;
00574             }
00575 
00576           <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
00577             {
00578               <font class="keywordflow">if</font> (optgenerror 
00579                   (FLG_USERELEASED,
00580                    message 
00581                    (<font class="stringliteral">"Released storage %q reachable from parameter at return point"</font>,
00582                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref)),
00583                    loc))
00584                 {
00585                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00586                   <font class="keywordflow">return</font> YES;
00587                 }
00588               }
00589           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
00590             {
00591               <font class="keywordflow">if</font> (optgenerror 
00592                   (FLG_USERELEASED,
00593                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Released storage %q reachable from temporary "</font>
00594                             <font class="stringliteral">"reference at scope exit"</font>,
00595                             sRef_unparse (fref)),
00596                    loc))
00597                 {
00598                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00599                   <font class="keywordflow">return</font> YES;
00600                 }
00601               }
00602           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00603             {
00604               <font class="keywordflow">if</font> (optgenerror 
00605                   (FLG_GLOBSTATE,
00606                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Released storage %q reachable from global"</font>,
00607                             sRef_unparse (fref)),
00608                    loc))
00609                 {
00610                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00611                   <font class="keywordflow">return</font> YES;
00612                 }
00613             }
00614           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNPASS)
00615             {
00616               <font class="keywordflow">if</font> (optgenerror 
00617                   (FLG_USERELEASED,
00618                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Released storage %q reachable from passed parameter"</font>,
00619                             sRef_unparse (fref)),
00620                    loc))
00621                 {
00622                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00623                   <font class="keywordflow">return</font> YES;
00624                 }
00625             }
00626           <font class="keywordflow">else</font>
00627             {
00628               <font class="keywordflow">if</font> (optgenerror 
00629                   (FLG_USERELEASED,
00630                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Released storage %q reachable from parameter"</font>,
00631                             sRef_unparse (fref)),
00632                    loc))
00633                 {
00634                   <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00635                   <font class="keywordflow">return</font> YES;
00636                 }
00637             }
00638         }
00639     }
00640 
00641   <font class="keywordflow">if</font> (!topLevel 
00642       &amp;&amp; <a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (fref) 
00643       &amp;&amp; !<a class="code" href="sRef_c.html#a315">sRef_perhapsNull</a> (tref) 
00644       &amp;&amp; <a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (sRef_getType (tref))
00645       &amp;&amp; !<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (fref))
00646     {
00647       <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
00648         {
00649           <font class="keywordflow">if</font> (optgenerror 
00650               (FLG_NULLRET, 
00651                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q storage %qderivable from return value: %s"</font>, 
00652                         cstring_capitalize (sRef_nullMessage (fref)),
00653                         <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
00654                         <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
00655                loc))
00656             {
00657               <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
00658               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (fref);
00659             }
00660         }
00661       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN || transferType == TT_PARAMRETURN)
00662         {
00663           <font class="keywordflow">if</font> (optgenerror 
00664               (FLG_NULLSTATE,
00665                message 
00666                (<font class="stringliteral">"Function returns with %s storage derivable from %q %q"</font>, 
00667                 <a class="code" href="sRef_c.html#a334">sRef_nullMessage</a> (fref),
00668                 cstring_makeLiteral ((transferType == TT_GLOBRETURN) 
00669                                      ? <font class="stringliteral">"global"</font> : <font class="stringliteral">"parameter"</font>),
00670                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref)),
00671                loc))
00672             {
00673               <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
00674               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (fref);
00675             }
00676         }
00677       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBPASS)
00678         {
00679           <font class="keywordflow">if</font> (optgenerror
00680               (FLG_NULLPASS,
00681                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function called with %s storage "</font>
00682                         <font class="stringliteral">"derivable from global %q"</font>, 
00683                         sRef_nullMessage (fref),
00684                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref)),
00685                loc))
00686             {
00687               <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
00688               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (fref);
00689             }
00690         }
00691       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNPASS)
00692         {
00693           <font class="keywordflow">if</font> (optgenerror
00694               (FLG_NULLSTATE,
00695                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q storage %qderivable from parameter %q"</font>, 
00696                         cstring_capitalize (sRef_nullMessage (fref)),
00697                         <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
00698                         generateText (fexp, exprNode_undefined, 
00699                                       sRef_undefined, TT_FCNPASS)),
00700                loc))
00701             {
00702               <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
00703               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (fref);
00704             }
00705         }
00706       <font class="keywordflow">else</font>
00707         {
00708           llassert (transferType == TT_DOASSIGN
00709                     || transferType == TT_GLOBINIT
00710                     || transferType == TT_LEAVETRANS);
00711         }
00712     }
00713 
00714   <font class="keywordflow">if</font> (sRef_isRelDef (tref) 
00715       || sRef_isPartial (tref) 
00716       || <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (tref)
00717       || sRef_isStateSpecial (tref))
00718     {
00719       <font class="comment">/* should check fref is allocated? */</font>
00720       <font class="keywordflow">return</font> YES;
00721     }
00722 
00723   ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (fref));
00724 
00725   <font class="keywordflow">if</font> (!(sRef_isAnyDefined (fref) 
00726         || sRef_isPdefined (fref)
00727         || <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (fref)
00728         || sRef_isStateUnknown (fref)))
00729     {
00730       <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00731         {
00732           <font class="keywordflow">if</font> (report
00733               &amp;&amp; optgenerror 
00734               (FLG_COMPDEF,
00735                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns with global %q not "</font>
00736                         <font class="stringliteral">"completely defined%q"</font>,
00737                         sRef_unparse (sRef_getRootBase (fref)),
00738                         defExpl (fref)),
00739                loc))
00740             {
00741               <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00742               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
00743             }
00744         }
00745       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBPASS)
00746         {
00747           <font class="keywordflow">if</font> (report &amp;&amp;
00748               optgenerror 
00749               (FLG_COMPDEF,
00750                message 
00751                (<font class="stringliteral">"Function called with global %q not completely defined%q"</font>,
00752                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef_getRootBase (fref)),
00753                 defExpl (fref)),
00754                loc))
00755             {
00756               <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00757               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
00758             }
00759         }
00760       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
00761         {
00762           <font class="keywordflow">if</font> (report &amp;&amp; !topLevel
00763               &amp;&amp; optgenerror 
00764               (FLG_COMPDEF,
00765                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function returns storage %q reachable from parameter not "</font>
00766                         <font class="stringliteral">"completely defined%q"</font>,
00767                         sRef_unparse (sRef_getRootBase (fref)),
00768                         defExpl (fref)),
00769                loc))
00770             {
00771               <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00772               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
00773             }
00774         }
00775       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
00776         {
00777           <font class="keywordflow">if</font> (report &amp;&amp; !topLevel
00778               &amp;&amp; optgenerror 
00779               (FLG_COMPDEF,
00780                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Scope exits with storage %q reachable from "</font>
00781                         <font class="stringliteral">"temporary reference not completely defined%q"</font>,
00782                         sRef_unparse (sRef_getRootBase (fref)),
00783                         defExpl (fref)),
00784                loc))
00785             {
00786               <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00787               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
00788             }
00789         }
00790       <font class="keywordflow">else</font> 
00791         {
00792           <font class="keywordflow">if</font> (transferType != TT_DOASSIGN
00793               &amp;&amp; (!(sRef_isNew (fref) || sRef_isType (fref))))
00794             {
00795               <font class="keywordflow">if</font> (report)
00796                 {
00797                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref))
00798                     {
00799                       <font class="keywordflow">if</font> (optgenerror 
00800                           (FLG_USERELEASED,
00801                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %qwas released: %q"</font>,
00802                                     transferType_unparse (transferType),
00803                                     <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref), 
00804                                     generateText (fexp, texp, tref, transferType)),
00805                            loc))
00806                         {
00807                           <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00808                         }
00809                     }
00810                   <font class="keywordflow">else</font> 
00811                     {
00812                       <font class="keywordflow">if</font> (optgenerror 
00813                           (FLG_COMPDEF,
00814                            message 
00815                            (<font class="stringliteral">"%s storage %qnot completely defined%q: %q"</font>,
00816                             transferType_unparse (transferType),
00817                             <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (sRef_getRootBase (fref)), 
00818                             defExpl (fref),
00819                             generateText (fexp, texp, tref, transferType)),
00820                            loc))
00821                         {
00822                           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (fref);
00823                           <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
00824                           <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (rb, loc);
00825                         }
00826                     }
00827                 }
00828             }
00829           <font class="keywordflow">else</font>
00830             {
00831 
00832               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (fref) &amp;&amp; sRef_isValid (tref) 
00833                   &amp;&amp; (transferType == TT_DOASSIGN))
00834                 {
00835                   <a class="code" href="sRef_c.html#a205">sRef_setAllocatedComplete</a> (tref, loc);
00836                 }
00837               <font class="keywordflow">return</font> YES;
00838             }
00839         }
00840 
00841       <font class="keywordflow">return</font> NO;
00842     }
00843   
00844   <font class="keywordflow">if</font> (ctype_isUnknown (ct))
00845     {
00846       <font class="keywordflow">return</font> YES;
00847     }
00848   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct))
00849     {
00850       ctype tct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tref));
00851 
00852       <font class="keywordflow">if</font> (sRef_isStateUnknown (fref))
00853         {
00854           <font class="keywordflow">return</font> NO;
00855         }
00856       <font class="keywordflow">else</font>
00857         {
00858           <font class="keywordflow">if</font> (ctype_isAP (tct) || ctype_isUnknown (tct))
00859             {
00860               sRef fptr = <a class="code" href="sRef_c.html#a270">sRef_constructDeref</a> (fref);
00861               sRef tptr = <a class="code" href="sRef_c.html#a270">sRef_constructDeref</a> (tref);
00862 
00863               <font class="keywordflow">return</font> (checkCompletelyDefined (fexp, fptr, texp, tptr,
00864                                               FALSE, inUnion, FALSE, loc, 
00865                                               transferType, depth + 1, report));
00866             }
00867           <font class="keywordflow">else</font>
00868             {
00869               <font class="keywordflow">return</font> YES;
00870             }
00871         }
00872     }
00873   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ct))
00874     {
00875       <font class="keywordflow">return</font> YES;
00876     }
00877   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct))
00878     {
00879       ctype tct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tref));
00880 
00881       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (ct, tct))
00882         {
00883           <font class="keywordtype">bool</font> isOk = TRUE;
00884           <font class="keywordtype">bool</font> hasOneDefined = FALSE;
00885           cstringSList badFields = cstringSList_undefined;
00886           
00887           <font class="keywordflow">if</font> (sRef_isStateUnknown (fref) || <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (tref)) 
00888             {
00889               <font class="keywordflow">return</font> YES;
00890             }
00891           
00892           <font class="keywordflow">if</font> (sRef_isPdefined (fref) || sRef_isAnyDefined (fref))
00893             {
00894               sRefSet_realElements (sRef_derivedFields (fref), sr)
00895                 {
00896                   <font class="keywordtype">bool</font> thisField;
00897                   
00898                   hasOneDefined = TRUE;
00899                   
00900                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
00901                     {
00902                       cstring fieldname = <a class="code" href="sRef_c.html#a138">sRef_getField</a> (sr);
00903                       sRef fldref = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (tref, fieldname);
00904                       <font class="keywordtype">bool</font> shouldCheck = !<a class="code" href="sRef_c.html#a62">sRef_isRecursiveField</a> (fldref);
00905                         
00906                       <font class="keywordflow">if</font> (shouldCheck)
00907                         {
00908                           thisField = 
00909                             ynm_toBoolRelaxed 
00910                               (checkCompletelyDefined (fexp, sr, texp, fldref,
00911                                                        FALSE, inUnion, FALSE, loc, 
00912                                                        transferType, depth + 1, 
00913                                                        FALSE));
00914                         }
00915                       <font class="keywordflow">else</font>
00916                         {
00917                           thisField = TRUE;
00918                         }
00919                       
00920                       <font class="keywordflow">if</font> (!thisField)
00921                         {
00922                           isOk = FALSE;
00923                           badFields = <a class="code" href="cstringSList_c.html#a4">cstringSList_add</a> (badFields,
00924                                                         sRef_getField (sr));
00925                         }
00926                     }
00927                 } end_sRefSet_realElements;
00928             }
00929           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (fref))
00930             {
00931               <font class="comment">/*</font>
00932 <font class="comment">              ** for structures, each field must be completely defined</font>
00933 <font class="comment">              */</font>
00934               
00935               uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ct);
00936               
00937               uentryList_elements (fields, ue)<font class="keyword"></font>
00938 <font class="keyword">                </font>{
00939                   <font class="keywordtype">bool</font> thisField;
00940                   cstring name = <a class="code" href="uentry_c.html#a196">uentry_getRealName</a> (ue);
00941                   sRef ffield = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (fref, name);
00942                   sRef tfield = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (tref, name);
00943                   <font class="keywordtype">bool</font> shouldCheck = !<a class="code" href="sRef_c.html#a62">sRef_isRecursiveField</a> (tfield);
00944                   
00945                   <font class="keywordflow">if</font> (!shouldCheck)
00946                     {
00947                       thisField = TRUE;
00948                     }
00949                   <font class="keywordflow">else</font>
00950                     {
00951                       thisField = ynm_toBoolRelaxed
00952                         (checkCompletelyDefined (fexp, ffield, texp, tfield,
00953                                                  FALSE, inUnion, FALSE,
00954                                                  loc, transferType,
00955                                                  depth + 1, FALSE));
00956                     }
00957                   
00958                   <font class="keywordflow">if</font> (!thisField)
00959                     {
00960                       isOk = FALSE;
00961                       badFields = <a class="code" href="cstringSList_c.html#a4">cstringSList_add</a> (badFields, uentry_rawName (ue));
00962                     }
00963                   <font class="keywordflow">else</font>
00964                     {
00965                       hasOneDefined = TRUE;
00966                     }
00967                 } end_uentryList_elements;
00968             }
00969           <font class="keywordflow">else</font>
00970             {
00971               ;
00972             }
00973           
00974           <font class="keywordflow">if</font> (!isOk &amp;&amp; (!inUnion || hasOneDefined))
00975             {
00976               <font class="keywordflow">if</font> (transferType == TT_GLOBRETURN)
00977                 {
00978                   <font class="keywordflow">if</font> (optgenerror
00979                       (FLG_COMPDEF,
00980                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Global storage %q contains %d undefined field%p "</font>
00981                                 <font class="stringliteral">"when call returns: %q"</font>,
00982                                 sRef_unparse (fref),
00983                                 cstringSList_size (badFields),
00984                                 <a class="code" href="cstringSList_c.html#a8">cstringSList_unparseAbbrev</a> (badFields)),
00985                        loc))
00986                     {
00987                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
00988                     }
00989                 }
00990               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_GLOBPASS)
00991                 {
00992                   <font class="keywordflow">if</font> (optgenerror
00993                       (FLG_COMPDEF,
00994                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Global storage %q contains %d undefined field%p "</font>
00995                                 <font class="stringliteral">"before call: %q"</font>,
00996                                 sRef_unparse (fref),
00997                                 cstringSList_size (badFields),
00998                                 <a class="code" href="cstringSList_c.html#a8">cstringSList_unparseAbbrev</a> (badFields)),
00999                        loc))
01000                     {
01001                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
01002                     }
01003                 }
01004               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
01005                 {
01006                   <font class="keywordflow">if</font> (optgenerror
01007                       (FLG_COMPDEF,
01008                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Storage %qreachable from parameter "</font>
01009                                 <font class="stringliteral">"contains %d undefined field%p: %q"</font>,
01010                                 sRef_unparseOpt (fref),
01011                                 cstringSList_size (badFields),
01012                                 <a class="code" href="cstringSList_c.html#a8">cstringSList_unparseAbbrev</a> (badFields)),
01013                        loc))
01014                     {
01015                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
01016                     }
01017                 }
01018               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
01019                 {
01020                   <font class="comment">/* no error */</font>
01021                 }
01022               <font class="keywordflow">else</font>
01023                 {
01024                   <font class="keywordflow">if</font> (optgenerror
01025                       (FLG_COMPDEF,
01026                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %qcontains %d undefined field%p: %q"</font>,
01027                                 transferType_unparse (transferType),
01028                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
01029                                 cstringSList_size (badFields),
01030                                 <a class="code" href="cstringSList_c.html#a8">cstringSList_unparseAbbrev</a> (badFields)),
01031                        loc))
01032                     {
01033                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, loc);
01034                     }
01035                 }
01036             }
01037           
01038           <a class="code" href="cstringSList_c.html#a9">cstringSList_free</a> (badFields);
01039           
01040           <font class="keywordflow">if</font> (inUnion)
01041             {
01042               <font class="keywordflow">if</font> (directUnion)
01043                 {
01044                   <font class="keywordflow">return</font> (ynm_fromBool (hasOneDefined));
01045                 }
01046               <font class="keywordflow">else</font>
01047                 {
01048                   <font class="keywordflow">return</font> (MAYBE);
01049                 }
01050             }
01051           <font class="keywordflow">else</font>
01052             {
01053               <font class="keywordflow">return</font> (ynm_fromBool (!report || isOk));
01054             }
01055         }
01056       <font class="keywordflow">else</font>
01057         {
01058           <font class="keywordflow">return</font> YES;
01059         }
01060     }
01061   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (ct))
01062     {
01063       <font class="keywordflow">if</font> (sRef_isStateUnknown (fref) || <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (tref)) 
01064         {
01065           <font class="keywordflow">return</font> YES;
01066         }
01067       <font class="keywordflow">else</font> 
01068         {
01069           ctype tct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tref));
01070           
01071           <font class="keywordflow">if</font> (ctype_isKnown (tct) &amp;&amp; <a class="code" href="ctype_c.html#a96">ctype_match</a> (ct, tct))
01072             {
01073               cstringSList goodFields = <a class="code" href="cstringSList_c.html#a0">cstringSList_new</a> ();
01074               <font class="keywordtype">bool</font> isOk = FALSE;
01075               <font class="keywordtype">int</font> nelements = <a class="code" href="sRefSet_c.html#a34">sRefSet_size</a> (sRef_derivedFields (fref));       
01076 
01077               <font class="comment">/*</font>
01078 <font class="comment">              ** for unions, at least one field must be completely defined</font>
01079 <font class="comment">              */</font>
01080               
01081               <font class="keywordflow">if</font> (sRef_isPdefined (fref) || sRef_isAnyDefined (fref))
01082                 {
01083                   isOk = TRUE;
01084                 }
01085               
01086               sRefSet_realElements (sRef_derivedFields (fref), sr)
01087                 {
01088                   <font class="keywordtype">bool</font> thisField;
01089                   
01090                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
01091                     {
01092                       sRef fldref = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (tref, sRef_getField (sr));
01093                       
01094                       thisField = ynm_toBoolStrict 
01095                         (checkCompletelyDefined 
01096                          (fexp, sr, texp, fldref, FALSE, inUnion, 
01097                           (nelements &gt; 1 ? TRUE : FALSE),
01098                           loc, transferType, depth + 1, FALSE));
01099                       
01100                       <font class="keywordflow">if</font> (thisField)
01101                         {
01102                           goodFields = cstringSList_add 
01103                             (goodFields, <a class="code" href="sRef_c.html#a138">sRef_getField</a> (sr));
01104                         }
01105                     }
01106                 } end_sRefSet_realElements;
01107               
01108               <font class="keywordflow">if</font> (cstringSList_empty (goodFields) 
01109                   &amp;&amp; !isOk 
01110                   &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNIONDEF))
01111                 {
01112                   <font class="keywordflow">if</font> (!inUnion)
01113                     {
01114                       <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN)
01115                         {
01116                           voptgenerror 
01117                             (FLG_UNIONDEF,
01118                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Union %q reachable from parameter has "</font>
01119                                       <font class="stringliteral">"no defined field"</font>,
01120                                       sRef_unparse (fref)),
01121                              loc);
01122                         }
01123                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_LEAVETRANS)
01124                         {
01125                           voptgenerror 
01126                             (FLG_UNIONDEF,
01127                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Union %q has no defined field at scope exit"</font>,
01128                                       sRef_unparse (fref)),
01129                              loc);
01130                         }
01131                       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_DOASSIGN
01132                                || transferType == TT_FIELDASSIGN
01133                                || transferType == TT_GLOBINIT)
01134                         {
01135                           ; <font class="comment">/* no error */</font>
01136                         }
01137                       <font class="keywordflow">else</font>
01138                         {
01139                           voptgenerror 
01140                             (FLG_UNIONDEF,
01141                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s union %q has no defined field"</font>,
01142                                       transferType_unparse (transferType),
01143                                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref)),
01144                              loc);
01145                         }
01146                     }
01147                   isOk = FALSE;
01148                 }
01149               
01150               <a class="code" href="cstringSList_c.html#a9">cstringSList_free</a> (goodFields);
01151               <font class="keywordflow">return</font> ynm_fromBool (!report || isOk);
01152             }
01153         }
01154     }
01155   <font class="keywordflow">else</font>
01156     {
01157       ;
01158     }
01159 
01160   <font class="keywordflow">return</font> YES;
01161 }
01162 
01163 <font class="comment">/*</font>
01164 <font class="comment">** fref is being free'd</font>
01165 <font class="comment">*/</font>
01166 
<a name="l01167"></a><a class="code" href="aliasChecks_c.html#a44">01167</a> <font class="keyword">typedef</font> <font class="keyword">enum</font> {
01168   DSC_GLOB, DSC_LOCAL, DSC_PARAM, DSC_STRUCT
01169   } dscCode;
01170 
01171 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring dscCode_unparse (dscCode desc) <font class="comment">/*@*/</font>
01172 {
01173   <font class="keywordflow">switch</font> (desc)
01174     {
01175     <font class="keywordflow">case</font> DSC_GLOB:
01176       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"killed global"</font>);
01177     <font class="keywordflow">case</font> DSC_LOCAL:
01178       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"variable declared in this scope"</font>);
01179     <font class="keywordflow">case</font> DSC_PARAM:
01180       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"released storage"</font>);
01181     <font class="keywordflow">case</font> DSC_STRUCT:
01182       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"released structure parameter"</font>);
01183     }
01184 
01185   BADEXIT;
01186 }
01187 
01188 <font class="keyword">static</font> <font class="keywordtype">bool</font> 
01189   checkCompletelyDestroyed (exprNode p_fexp, sRef p_fref, <font class="keywordtype">bool</font> p_topLevel, 
01190                             fileloc p_loc, <font class="keywordtype">int</font> p_depth, dscCode p_desc);
01191 
<a name="l01192"></a><a class="code" href="aliasChecks_c.html#a24">01192</a> <font class="keywordtype">bool</font> <a class="code" href="aliasChecks_c.html#a24">checkGlobalDestroyed</a> (sRef fref, fileloc loc)<font class="keyword"></font>
01193 <font class="keyword"></font>{
01194   <font class="keywordflow">return</font> (checkCompletelyDestroyed (exprNode_undefined, fref, TRUE,
01195                                     loc, 0, DSC_GLOB));
01196 }
01197 
<a name="l01198"></a><a class="code" href="aliasChecks_c.html#a25">01198</a> <font class="keywordtype">void</font> <a class="code" href="aliasChecks_c.html#a25">checkLocalDestroyed</a> (sRef fref, fileloc loc)<font class="keyword"></font>
01199 <font class="keyword"></font>{
01200   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (fref)
01201       || sRef_isPartial (fref))
01202     {
01203       ;
01204     }
01205   <font class="keywordflow">else</font>
01206     {
01207       (<font class="keywordtype">void</font>) checkCompletelyDestroyed (exprNode_undefined, fref, TRUE,
01208                                        loc, 0, DSC_LOCAL);
01209     }
01210 }
01211 
<a name="l01212"></a><a class="code" href="aliasChecks_c.html#a26">01212</a> <font class="keywordtype">void</font> <a class="code" href="aliasChecks_c.html#a26">checkStructDestroyed</a> (sRef fref, fileloc loc)<font class="keyword"></font>
01213 <font class="keyword"></font>{
01214   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (fref)
01215       || sRef_isPartial (fref))
01216     {
01217       ;
01218     }
01219   <font class="keywordflow">else</font>
01220     {
01221       (<font class="keywordtype">void</font>) checkCompletelyDestroyed (exprNode_undefined, fref, TRUE, loc, 0, DSC_STRUCT);
01222     }
01223 }
01224 
01225 <font class="keyword">static</font> <font class="keywordtype">bool</font>
01226   checkCompletelyDestroyed (exprNode fexp, sRef fref, <font class="keywordtype">bool</font> topLevel,
01227                             fileloc loc, <font class="keywordtype">int</font> depth,
01228                             dscCode desc)<font class="keyword"></font>
01229 <font class="keyword"></font>{
01230   ctype ct;
01231   
01232   <font class="keywordflow">if</font> (depth &gt; MAXDEPTH)
01233     {
01234       llquietbug (message (<font class="stringliteral">"checkCompletelyDestroyed: too deep: %s / %q"</font>, 
01235                            exprNode_unparse (fexp),
01236                            <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (fref)));
01237       <font class="keywordflow">return</font> TRUE;
01238     }
01239 
01240   <font class="keywordflow">if</font> (!sRef_isKnown (fref)) <font class="keywordflow">return</font> TRUE;
01241   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a146">usymtab_isProbableNull</a> (fref)) <font class="keywordflow">return</font> TRUE;
01242   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_COMPDESTROY)) <font class="keywordflow">return</font> TRUE;
01243   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTFREE)) <font class="keywordflow">return</font> TRUE;
01244   
01245   ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (fref));
01246 
01247   <font class="keywordflow">if</font> (!topLevel)
01248     {
01249       <font class="keywordtype">bool</font> error = FALSE;
01250 
01251       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (fref) || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (fref))
01252         {
01253           error = TRUE;
01254           
01255           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref) 
01256               || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref)
01257               || <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (fref)
01258               || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) 
01259               || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (fref))
01260             {
01261               error = FALSE;
01262             }
01263         }
01264       
01265       <font class="keywordflow">if</font> (error)
01266         {
01267           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (fref) || sRef_isRelDef (fref))
01268             {
01269               <font class="keywordflow">if</font> (exprNode_isDefined (fexp))
01270                 {
01271                   voptgenerror2 
01272                     (FLG_COMPDESTROY, FLG_STRICTDESTROY,
01273                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q (type %s) derived from %s "</font>
01274                               <font class="stringliteral">"may not have been released: %s"</font>,
01275                               sRef_unparse (fref), 
01276                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (sRef_getType (fref)),
01277                               dscCode_unparse (desc),
01278                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01279                      loc);
01280                 }
01281               <font class="keywordflow">else</font>
01282                 {
01283                   voptgenerror2 
01284                     (FLG_COMPDESTROY, FLG_STRICTDESTROY,
01285                      message 
01286                      (<font class="stringliteral">"Only storage %q (type %s) derived from %s "</font>
01287                       <font class="stringliteral">"may not have been released"</font>,
01288                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (fref), 
01289                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (sRef_getType (fref)),
01290                       dscCode_unparse (desc)),
01291                      loc);
01292                 }
01293               
01294               <a class="code" href="sRef_c.html#a229">sRef_kill</a> (fref, loc); <font class="comment">/* prevent further errors */</font>
01295             }
01296           <font class="keywordflow">else</font> 
01297             {
01298               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref))
01299                 {
01300                   <font class="keywordflow">return</font> TRUE;
01301                 }
01302               <font class="keywordflow">else</font>
01303                 {
01304                   <font class="keywordflow">if</font> (exprNode_isDefined (fexp))
01305                     {
01306                       voptgenerror 
01307                         (FLG_COMPDESTROY,
01308                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q (type %s) derived from %s "</font>
01309                                   <font class="stringliteral">"is not released (memory leak): %s"</font>,
01310                                   sRef_unparse (fref),
01311                                   <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (sRef_getType (fref)),  
01312                                   dscCode_unparse (desc),
01313                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01314                          loc);
01315                     }
01316                   <font class="keywordflow">else</font>
01317                     {
01318                       voptgenerror 
01319                         (FLG_COMPDESTROY,
01320                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q (type %s) derived from %s "</font>
01321                                   <font class="stringliteral">"is not released (memory leak)"</font>,
01322                                   sRef_unparse (fref),
01323                                   <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (sRef_getType (fref)),
01324                                   dscCode_unparse (desc)),
01325                          loc);
01326                     }
01327                 }
01328             }
01329 
01330           <font class="keywordflow">return</font> FALSE;
01331         }
01332       
01333       <font class="keywordflow">if</font> (sRef_isAnyDefined (fref) || <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref)
01334           || (sRef_isPdefined (fref) 
01335               &amp;&amp; sRefSet_isEmpty (sRef_derivedFields (fref))))
01336         {
01337           <font class="keywordflow">return</font> TRUE;
01338         }
01339     }
01340   
01341   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (ct))
01342     {
01343       sRef fptr = <a class="code" href="sRef_c.html#a271">sRef_constructDeadDeref</a> (fref);
01344       <font class="keywordtype">bool</font> res = checkCompletelyDestroyed (fexp, fptr, FALSE, loc,
01345                                            depth + 1, desc);
01346       
01347       <font class="keywordflow">return</font> res;
01348     }
01349   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ct))
01350     {
01351       <font class="keywordflow">if</font> ((sRef_isStateUnknown (fref) || <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (fref))
01352           &amp;&amp; !<a class="code" href="sRef_c.html#a272">sRef_hasDerived</a> (fref))
01353         {
01354           <font class="comment">/*</font>
01355 <font class="comment">          ** Bogosity necessary to prevent infinite depth.</font>
01356 <font class="comment">          */</font>
01357 
01358           <font class="keywordflow">return</font> FALSE;
01359         }
01360       <font class="keywordflow">else</font>
01361         {
01362           sRef farr = <a class="code" href="sRef_c.html#a271">sRef_constructDeadDeref</a> (fref);
01363           
01364           <font class="keywordflow">return</font> (checkCompletelyDestroyed (fexp, farr, FALSE, loc, 
01365                                             depth + 1, desc));
01366         }
01367     }
01368   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ct))
01369     {
01370       <font class="comment">/*</font>
01371 <font class="comment">      ** for structures, each field must be completely destroyed</font>
01372 <font class="comment">      */</font>
01373 
01374       <font class="keywordtype">bool</font> isOk = TRUE;
01375       uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ct);
01376       
01377       <font class="keywordflow">if</font> (depth &gt;= MAXDEPTH)
01378         {
01379           llquietbug (message (<font class="stringliteral">"checkCompletelyDestroyed (fields): too deep: %s / %q"</font>, 
01380                                exprNode_unparse (fexp),
01381                                <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (fref)));
01382                               
01383           <font class="keywordflow">return</font> TRUE;
01384         }
01385       <font class="keywordflow">else</font>
01386         {
01387           uentryList_elements (fields, ue)<font class="keyword"></font>
01388 <font class="keyword">            </font>{
01389               sRef field = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (fref, uentry_rawName (ue));
01390               
01391               <font class="comment">/*</font>
01392 <font class="comment">              ** note order of &amp;&amp; operands --- want to report multiple errors</font>
01393 <font class="comment">              */</font>
01394               
01395               isOk = (checkCompletelyDestroyed (fexp, field, FALSE, loc,
01396                                                 depth + 1, desc)
01397                       &amp;&amp; isOk);
01398             } end_uentryList_elements;
01399         }
01400 
01401       <font class="keywordflow">return</font> isOk;
01402     }
01403   <font class="keywordflow">else</font>
01404     {
01405       <font class="keywordflow">return</font> TRUE;
01406     }
01407 }
01408 
01409 <font class="keywordtype">void</font>
<a name="l01410"></a><a class="code" href="aliasChecks_c.html#a27">01410</a> <a class="code" href="aliasChecks_c.html#a27">checkReturnTransfer</a> (exprNode fexp, uentry rval)<font class="keyword"></font>
01411 <font class="keyword"></font>{
01412   sRef uref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (rval);
01413   sRef rref = <a class="code" href="sRef_c.html#a284">sRef_makeNew</a> (sRef_getType (uref), uref, cstring_undefined);
01414   
01415   <font class="keywordflow">if</font> (sRef_isStateSpecial (rref))
01416     {
01417       uentry fcn = <a class="code" href="context_c.html#a96">context_getHeader</a> ();
01418       sRef fref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (fexp);
01419       specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (fcn);
01420 
01421       specialClauses_postElements (clauses, cl)<font class="keyword"></font>
01422 <font class="keyword">        </font>{
01423           sRefSet refs = specialClause_getRefs (cl);
01424           sRefTest tst = <a class="code" href="specialClauses_c.html#a10">specialClause_getPostTestFunction</a> (cl);
01425           sRefMod modf = <a class="code" href="specialClauses_c.html#a14">specialClause_getReturnEffectFunction</a> (cl);
01426 
01427           sRefSet_elements (refs, el)<font class="keyword"></font>
01428 <font class="keyword">            </font>{
01429               sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
01430               
01431               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (base))
01432                 {
01433                   sRef sr = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (el, fref);
01434 
01435                   <font class="keywordflow">if</font> (tst != NULL &amp;&amp; !(tst (sr)))
01436                     {
01437                       <font class="keywordflow">if</font> (optgenerror 
01438                           (<a class="code" href="specialClauses_c.html#a17">specialClause_postErrorCode</a> (cl),
01439                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q corresponds to "</font>
01440                                     <font class="stringliteral">"storage listed in %q clause: %s"</font>,
01441                                     specialClause_postErrorString (cl, sr),
01442                                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr),
01443                                     <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
01444                                     <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01445                            <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp)))
01446                         {
01447                           sRefShower ss = <a class="code" href="specialClauses_c.html#a11">specialClause_getPostTestShower</a> (cl);
01448                           
01449                           <font class="keywordflow">if</font> (ss != NULL)
01450                             {
01451                               ss (sr);
01452                             }
01453                         }
01454                     }
01455 
01456                   <font class="keywordflow">if</font> (modf != NULL)
01457                     {
01458                       modf (sr, exprNode_loc (fexp));
01459                     }
01460                 }
01461               <font class="keywordflow">else</font>
01462                 {
01463                   <font class="comment">/* </font>
01464 <font class="comment">                  ** Non-results are checked in exit scope.</font>
01465 <font class="comment">                  */</font>
01466                 }
01467             } end_sRefSet_elements ;
01468         } end_specialClauses_postElements ;
01469 
01470       (<font class="keywordtype">void</font>) checkTransfer (fexp, fref,
01471                             exprNode_undefined, rref, 
01472                             exprNode_loc (fexp), TT_FCNRETURN);
01473     }
01474   <font class="keywordflow">else</font>
01475     {
01476       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (exprNode_getType (fexp)))
01477         {
01478           sRef fref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (fexp);
01479           
01480           checkStructTransfer (exprNode_undefined, rref, 
01481                                fexp, fref,
01482                                exprNode_loc (fexp),
01483                                TT_FCNRETURN);
01484         }
01485       <font class="keywordflow">else</font>
01486         {
01487           (<font class="keywordtype">void</font>) checkTransfer (fexp, exprNode_getSref (fexp),
01488                                 exprNode_undefined, rref, 
01489                                 <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp), TT_FCNRETURN);
01490         }
01491     }
01492 }
01493 
01494 <font class="keyword">static</font> <font class="keywordtype">void</font>
01495   checkPassSpecialClauses (uentry ue, exprNode fexp, sRef fref, <font class="keywordtype">int</font> argno)<font class="keyword"></font>
01496 <font class="keyword"></font>{
01497   specialClauses clauses = <a class="code" href="uentry_c.html#a144">uentry_getSpecialClauses</a> (ue);
01498 
01499   DPRINTF ((<font class="stringliteral">"Check pass special: %s / %s"</font>,
01500             exprNode_unparse (fexp), <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (fref)));
01501   
01502   specialClauses_preElements (clauses, cl)<font class="keyword"></font>
01503 <font class="keyword">    </font>{
01504       sRefSet refs = specialClause_getRefs (cl);
01505       sRefTest tst = <a class="code" href="specialClauses_c.html#a9">specialClause_getPreTestFunction</a> (cl);
01506       sRefMod modf = <a class="code" href="specialClauses_c.html#a13">specialClause_getEffectFunction</a> (cl);
01507 
01508       sRefSet_elements (refs, el)<font class="keyword"></font>
01509 <font class="keyword">        </font>{
01510           sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (el);
01511           
01512           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a164">sRef_isResult</a> (base))
01513             {
01514               ; <font class="comment">/* nothing to check before */</font>
01515             }
01516           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (base))
01517             {
01518               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a96">sRef_getParam</a> (base) == argno - 1)
01519                 {
01520                   sRef sb;
01521 
01522                   DPRINTF ((<font class="stringliteral">"Fix base: %s / %s"</font>,
01523                             sRef_unparseFull (el),
01524                             <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (fref)));
01525 
01526                   sb = <a class="code" href="sRef_c.html#a294">sRef_fixBase</a> (el, fref);
01527 
01528                   <font class="keywordflow">if</font> (tst != NULL &amp;&amp; !(tst(sb)))
01529                     {
01530                       voptgenerror 
01531                         (<a class="code" href="specialClauses_c.html#a15">specialClause_preErrorCode</a> (cl),
01532                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %qcorresponds to "</font>
01533                                   <font class="stringliteral">"storage listed in %q clause of "</font>
01534                                   <font class="stringliteral">"called function: %s"</font>,
01535                                   specialClause_preErrorString (cl, sb),
01536                                   <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (sb),
01537                                   <a class="code" href="specialClauses_c.html#a20">specialClause_unparseKind</a> (cl),
01538                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01539                          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01540                     }
01541 
01542                   <font class="keywordflow">if</font> (modf != NULL)
01543                     {
01544                       DPRINTF ((<font class="stringliteral">"Fixing: %s"</font>, sRef_unparseFull (sb)));
01545                       modf (sb, exprNode_loc (fexp));
01546                       DPRINTF ((<font class="stringliteral">"==&gt; %s"</font>, sRef_unparseFull (sb)));
01547                     }
01548                 }
01549             }
01550           <font class="keywordflow">else</font>
01551             {
01552               BADBRANCH;
01553             }
01554         } end_sRefSet_elements ;          
01555     } end_specialClauses_preElements ;
01556 
01557     DPRINTF ((<font class="stringliteral">"After: %s"</font>, sRef_unparseFull (fref)));
01558 }
01559 
01560 <font class="comment">/*</font>
01561 <font class="comment">** should not modify arg</font>
01562 <font class="comment">*/</font>
01563 
01564 <font class="keywordtype">void</font>
<a name="l01565"></a><a class="code" href="aliasChecks_c.html#a29">01565</a> <a class="code" href="aliasChecks_c.html#a29">checkPassTransfer</a> (exprNode fexp, uentry arg, <font class="keywordtype">bool</font> isSpec,
01566                    <font class="comment">/*@dependent@*/</font> exprNode fcn, <font class="keywordtype">int</font> argno, <font class="keywordtype">int</font> totargs)<font class="keyword"></font>
01567 <font class="keyword"></font>{
01568   sRef tref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (arg);
01569   sRef fref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (fexp);
01570   <font class="keywordtype">bool</font> isOut = FALSE;
01571   <font class="keywordtype">bool</font> isPartial = FALSE;
01572   <font class="keywordtype">bool</font> isImpOut = FALSE;
01573   ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (arg);
01574 
01575   DPRINTF ((<font class="stringliteral">"Check pass: %s -&gt; %s"</font>,
01576             sRef_unparseFull (fref),
01577             <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (tref)));
01578   
01579   atFunction = fcn;
01580   atArgNo = argno;
01581   atNumArgs = totargs;
01582 
01583   <font class="keywordflow">if</font> (ctype_isElips (ct))
01584     {
01585       ct = ctype_unknown;
01586     }
01587   
01588   <font class="keywordflow">if</font> (!ctype_isElips (ct) &amp;&amp; 
01589       (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (ct) &amp;&amp; <a class="code" href="uentry_c.html#a176">uentry_isOut</a> (arg) &amp;&amp; <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (tref)))
01590     {
01591       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ct))
01592         {
01593           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRef_isDead, fref))
01594             {
01595               <font class="keywordflow">if</font> (optgenerror
01596                   (FLG_USERELEASED,
01597                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Dead storage %qpassed as out parameter: %s"</font>,
01598                             sRef_unparseOpt (fref),
01599                             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01600                    <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp)))
01601                 {
01602                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref))
01603                     {
01604                       <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
01605                     }
01606                 }
01607               
01608               <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01609             }
01610           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTUSERELEASED)
01611                    &amp;&amp; <a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRef_isPossiblyDead, fref))
01612             {
01613               <font class="keywordflow">if</font> (optgenerror2 
01614                   (FLG_USERELEASED, FLG_STRICTUSERELEASED,
01615                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Possibly dead storage %qpassed as out parameter: %s"</font>,
01616                             sRef_unparseOpt (fref),
01617                             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01618                    <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp)))
01619                 {
01620                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (fref))
01621                     {
01622                       <a class="code" href="sRef_c.html#a299">sRef_showStateInfo</a> (fref);
01623                     }
01624                 }
01625               
01626               <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01627             }
01628           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRef_isStateUndefined, fref) 
01629                    || <a class="code" href="sRef_c.html#a319">sRef_aliasCheckSimplePred</a> (sRef_isUnuseable, fref))
01630             {
01631               voptgenerror
01632                 (FLG_USEDEF,
01633                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unallocated storage %qpassed as out parameter: %s"</font>,
01634                           sRef_unparseOpt (fref),
01635                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01636                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01637 
01638               <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01639             }
01640           <font class="keywordflow">else</font>
01641             {
01642               ;
01643             }
01644         }
01645       
01646       (<font class="keywordtype">void</font>) checkCompletelyDestroyed (fexp, fref, TRUE, exprNode_loc (fexp),
01647                                        0, DSC_PARAM);
01648 
01649       <font class="comment">/* make it defined now, so checkTransfer is okay */</font>
01650       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (fref, exprNode_loc (fexp)); 
01651     }
01652   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a176">uentry_isOut</a> (arg))
01653     {
01654       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ct)
01655           &amp;&amp; (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref) || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref)))
01656         {
01657           voptgenerror
01658             (FLG_USEDEF,
01659              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unallocated storage %qpassed as out parameter: %s"</font>,
01660                       sRef_unparseOpt (fref),
01661                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01662              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01663           <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01664         }
01665       isOut = TRUE;
01666     }
01667   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a177">uentry_isPartial</a> (arg))
01668     {
01669       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ct) 
01670           &amp;&amp; (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref) || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref)))
01671         {
01672           voptgenerror 
01673             (FLG_USEDEF,
01674              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unallocated storage %qpassed as partial parameter: %s"</font>,
01675                       sRef_unparseOpt (fref),
01676                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01677              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01678           <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01679         }
01680       isPartial = TRUE;
01681     }
01682   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a178">uentry_isStateSpecial</a> (arg))
01683     {
01684       uentry ue = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (fcn);
01685 
01686       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ct) 
01687           &amp;&amp; (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref) || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref)))
01688         {
01689           voptgenerror 
01690             (FLG_USEDEF,
01691              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unallocated storage %qpassed as special parameter: %s"</font>,
01692                       sRef_unparseOpt (fref),
01693                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01694              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01695           <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01696         }
01697 
01698       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a143">uentry_hasSpecialClauses</a> (ue))
01699         {
01700           checkPassSpecialClauses (ue, fexp, fref, argno);
01701         }
01702       
01703       <font class="keywordflow">return</font>; <font class="comment">/* ??? */</font>
01704     }
01705   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isStateDefined (tref))
01706     {
01707       <a class="code" href="exprNode_c.html#a169">exprNode_checkUseParam</a> (fexp);
01708     }
01709   <font class="keywordflow">else</font>
01710     {
01711       <font class="keywordflow">if</font> (isSpec || (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_IMPOUTS)))
01712         {
01713           <a class="code" href="exprNode_c.html#a169">exprNode_checkUseParam</a> (fexp);
01714         }
01715       <font class="keywordflow">else</font>
01716         {
01717           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (fref) 
01718               &amp;&amp; (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ct)))
01719             {
01720               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (fref))
01721                 {
01722                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (fref) || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (fref))
01723                     {
01724                       voptgenerror 
01725                         (FLG_USEDEF,
01726                          message 
01727                          (<font class="stringliteral">"Unallocated address %qpassed as implicit "</font>
01728                           <font class="stringliteral">"out parameter: %s"</font>,
01729                           <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
01730                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01731                          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01732                       <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (fref, exprNode_loc (fexp));
01733                     }
01734                 }
01735               
01736               <font class="comment">/* yes, I really mean this! */</font>
01737               tref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (tref);
01738               <a class="code" href="sRef_c.html#a208">sRef_setAllocated</a> (tref, exprNode_loc (fexp)); 
01739 
01740               isOut = TRUE;
01741               isImpOut = TRUE;
01742             }
01743           <font class="keywordflow">else</font> 
01744             {
01745               <a class="code" href="exprNode_c.html#a169">exprNode_checkUseParam</a> (fexp);
01746             }
01747         }
01748     }
01749 
01750   <font class="keywordflow">if</font> (sRef_isNew (fref))
01751     {
01752       alkind tkind = sRef_getAliasKind (tref);
01753 
01754       <font class="keywordflow">if</font> ((<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (fref) || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (fref))
01755           &amp;&amp; !alkind_isOnly (tkind) 
01756           &amp;&amp; !alkind_isKeep (tkind) 
01757           &amp;&amp; !alkind_isOwned (tkind)
01758           &amp;&amp; !alkind_isError (tkind)
01759           &amp;&amp; !<a class="code" href="uentry_c.html#a279">uentry_isReturned</a> (arg))
01760         
01761         {
01762           voptgenerror 
01763             (FLG_MUSTFREE,
01764              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"New fresh storage %qpassed as %s (not released): %s"</font>,
01765                       sRef_unparseOpt (fref),
01766                       <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref)),
01767                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01768              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01769         }
01770       <font class="keywordflow">else</font> 
01771         {
01772           <font class="keywordflow">if</font> (sRef_isNewRef (fref) &amp;&amp; !sRef_isKillRef (tref))
01773             {
01774               alkind ak = sRef_getAliasKind (tref);
01775               
01776               <font class="keywordflow">if</font> (!alkind_isError (ak))
01777                 {
01778                   voptgenerror 
01779                     (FLG_MUSTFREE,
01780                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"New reference %qpassed as %s (not released): %s"</font>,
01781                               sRef_unparseOpt (fref),
01782                               <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (sRef_getAliasKind (tref)),
01783                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
01784                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp));
01785                 }
01786             }
01787         }
01788     }
01789   
01790   (<font class="keywordtype">void</font>) checkTransfer (fexp, exprNode_getSref (fexp),
01791                         exprNode_undefined, tref,
01792                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fexp), TT_FCNPASS);
01793 
01794   setCodePoint ();
01795   fref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (fexp);
01796   
01797   <font class="keywordflow">if</font> (isOut &amp;&amp; !<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (fref) &amp;&amp; !<a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (fref))
01798     {
01799       sRef base;
01800 
01801       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (sRef_getType (fref)))
01802         {
01803           base = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (fref); 
01804         }
01805       <font class="keywordflow">else</font>
01806         {
01807           base = fref;
01808         }
01809 
01810       <font class="keywordflow">if</font> (isImpOut)
01811         {
01812           <a class="code" href="exprNode_c.html#a168">exprNode_checkMSet</a> (fexp, base);
01813         }
01814       <font class="keywordflow">else</font>
01815         {
01816           <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (fexp, base);
01817         }
01818 
01819       <font class="keywordflow">if</font> (sRef_isValid (base))
01820         {
01821           setCodePoint ();
01822 
01823           <a class="code" href="sRef_c.html#a273">sRef_clearDerived</a> (base);
01824           <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (base, exprNode_loc (fexp));
01825           <a class="code" href="usymtab_c.html#a153">usymtab_clearAlias</a> (base);
01826           <a class="code" href="sRef_c.html#a218">sRef_setNullUnknown</a> (base, exprNode_loc (fexp));
01827         }
01828     }
01829 
01830   <font class="keywordflow">if</font> (isPartial)
01831     {
01832       <font class="keywordflow">if</font> (sRef_isValid (fref))
01833         {
01834           <a class="code" href="sRef_c.html#a209">sRef_setPartial</a> (fref, exprNode_loc (fexp)); 
01835         }
01836     }
01837 
01838   atFunction = exprNode_undefined;
01839   atArgNo = 0;
01840   atNumArgs = 0;
01841   
01842   <font class="comment">/* need to fixup here: derived refs could be bogus */</font>
01843   <font class="comment">/* (better to change sRef to not add derivs for "protected" ref) */</font>
01844 
01845   <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (arg);
01846 
01847   setCodePoint ();
01848 
01849   DPRINTF ((<font class="stringliteral">"Check pass: ==&gt; %s"</font>,
01850             sRef_unparseFull (fref)));
01851 }
01852 
01853 <font class="keywordtype">void</font>
<a name="l01854"></a><a class="code" href="aliasChecks_c.html#a30">01854</a> <a class="code" href="aliasChecks_c.html#a30">checkGlobReturn</a> (uentry glob)<font class="keyword"></font>
01855 <font class="keyword"></font>{
01856   <a class="code" href="sRef_c.html#a60">sRef_protectDerivs</a> ();
01857   checkGlobTrans (glob, TT_GLOBRETURN);
01858   <a class="code" href="sRef_c.html#a61">sRef_clearProtectDerivs</a> ();
01859 }
01860 
<a name="l01861"></a><a class="code" href="aliasChecks_c.html#a31">01861</a> <font class="keywordtype">void</font> <a class="code" href="aliasChecks_c.html#a31">checkParamReturn</a> (uentry actual)<font class="keyword"></font>
01862 <font class="keyword"></font>{
01863   checkLeaveTrans (actual, TT_PARAMRETURN);
01864 }
01865 
<a name="l01866"></a><a class="code" href="aliasChecks_c.html#a32">01866</a> <font class="keywordtype">void</font> <a class="code" href="aliasChecks_c.html#a32">checkLoseRef</a> (uentry actual)<font class="keyword"></font>
01867 <font class="keyword"></font>{
01868   checkLeaveTrans (actual, TT_LEAVETRANS);
01869 }
01870 
01871 <font class="keyword">static</font> <font class="keywordtype">void</font>
01872 checkLeaveTrans (uentry actual, transferKind transferType)<font class="keyword"></font>
01873 <font class="keyword"></font>{
01874   sRef aref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (actual);
01875   sRef origref = <a class="code" href="uentry_c.html#a214">uentry_getOrigSref</a> (actual);
01876 
01877   <font class="keywordflow">if</font> (transferType == TT_PARAMRETURN 
01878       &amp;&amp; (<a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (origref) || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (origref)
01879           || <a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (origref)))
01880     {
01881       <font class="comment">/* caller cannot use, nothing to check */</font>
01882     }
01883   <font class="keywordflow">else</font>
01884     {
01885       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (origref))
01886         {
01887           ;
01888         }
01889       <font class="keywordflow">else</font>
01890         {
01891           (<font class="keywordtype">void</font>) checkCompletelyDefined (exprNode_undefined, aref, 
01892                                          exprNode_undefined, origref,
01893                                          TRUE, FALSE, FALSE,
01894                                          g_currentloc, transferType,
01895                                          0, TRUE);
01896         }
01897     }
01898 }
01899 
01900 <font class="keyword">static</font> <font class="keywordtype">void</font>
01901 checkGlobTrans (uentry glob, transferKind type)<font class="keyword"></font>
01902 <font class="keyword"></font>{
01903   sRef eref = <a class="code" href="uentry_c.html#a214">uentry_getOrigSref</a> (glob);
01904   
01905   (<font class="keywordtype">void</font>) checkCompletelyDefined (exprNode_undefined, uentry_getSref (glob), 
01906                                  exprNode_undefined, eref, 
01907                                  TRUE, FALSE, FALSE,
01908                                  g_currentloc, type, 0, TRUE);
01909 }
01910 
01911 <font class="comment">/*</font>
01912 <font class="comment">** For lhs of assignment, alias kind is set from basic type.</font>
01913 <font class="comment">** Yoikes!</font>
01914 <font class="comment">*/</font>
01915 
01916 <font class="keyword">static</font> <font class="keywordtype">void</font>
01917 fixAssignLhs (sRef s)<font class="keyword"></font>
01918 <font class="keyword"></font>{
01919   <a class="code" href="sRef_c.html#a293">sRef_resetStateComplete</a> (s);
01920 }
01921 
01922 <font class="keyword">static</font> <font class="keywordtype">void</font> checkStructTransfer (exprNode lhs, sRef slhs, exprNode rhs, sRef srhs,
01923                                  fileloc loc,
01924                                  transferKind tt)<font class="keyword"></font>
01925 <font class="keyword"></font>{
01926   ctype st = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (srhs));
01927   
01928   <font class="keywordflow">if</font> (ctype_isSU (st) &amp;&amp; <a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (sRef_getType (slhs))
01929       &amp;&amp; <a class="code" href="ctype_c.html#a96">ctype_match</a> (sRef_getType (slhs), st))
01930     {
01931       <font class="keywordflow">if</font> (tt == TT_DOASSIGN &amp;&amp; sRef_isStateDefined (srhs))
01932         {
01933           <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (slhs, loc);
01934         }
01935           
01936       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a337">sRef_isDependent</a> (slhs)
01937           || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (slhs)
01938           || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (slhs))
01939         {
01940           ;
01941         }
01942       <font class="keywordflow">else</font>
01943         {
01944           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (slhs)
01945               &amp;&amp; <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef_getRootBase (srhs)))
01946             {
01947               <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (slhs, exprNode_loc (lhs));
01948             }
01949           <font class="keywordflow">else</font>
01950             {
01951               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a120">ctype_isUnion</a> (st))
01952                 {
01953                   <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (slhs, sRef_getDefState (srhs), 
01954                                     <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (lhs));
01955 
01956                   sRefSet_realElements (sRef_derivedFields (srhs), sr)
01957                     {
01958                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (sr))
01959                         {
01960                           cstring fieldname = <a class="code" href="sRef_c.html#a138">sRef_getField</a> (sr);
01961                           sRef lfld = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (slhs, fieldname);
01962 
01963                           (<font class="keywordtype">void</font>) checkTransfer (rhs, sr, lhs, lfld, 
01964                                                 exprNode_loc (lhs), tt);
01965                         }
01966                     } end_sRefSet_realElements ;
01967                 }
01968               <font class="keywordflow">else</font>
01969                 {
01970                   uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (st);
01971                   
01972                   uentryList_elements (fields, field)<font class="keyword"></font>
01973 <font class="keyword">                    </font>{
01974                       sRef rfld = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (srhs, uentry_rawName (field));
01975                       sRef lfld = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (slhs, uentry_rawName (field));
01976                       (<font class="keywordtype">void</font>) checkTransfer (rhs, rfld, lhs, lfld, exprNode_loc (lhs), tt);
01977                     } end_uentryList_elements ;
01978                 }
01979 
01980               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (srhs))
01981                 {
01982                   <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (srhs, loc);
01983                 }
01984             }
01985         }
01986     }
01987 }
01988 
01989 <font class="keywordtype">void</font>
<a name="l01990"></a><a class="code" href="aliasChecks_c.html#a34">01990</a> <a class="code" href="aliasChecks_c.html#a34">checkInitTransfer</a> (exprNode lhs, exprNode rhs)<font class="keyword"></font>
01991 <font class="keyword"></font>{
01992   sRef slhs = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (lhs);
01993   
01994   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (slhs) || (!<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (slhs)))
01995     {
01996       (<font class="keywordtype">void</font>) checkTransfer (rhs, exprNode_getSref (rhs), 
01997                             lhs, slhs, <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (rhs), TT_GLOBINIT);
01998     }
01999   <font class="keywordflow">else</font>
02000     {
02001       <a class="code" href="aliasChecks_c.html#a35">checkAssignTransfer</a> (lhs, rhs);
02002     }
02003 }
02004 
02005 <font class="keywordtype">void</font>
<a name="l02006"></a><a class="code" href="aliasChecks_c.html#a35">02006</a> <a class="code" href="aliasChecks_c.html#a35">checkAssignTransfer</a> (exprNode lhs, exprNode rhs)<font class="keyword"></font>
02007 <font class="keyword"></font>{
02008   sRef slhs = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (lhs);
02009   sRef srhs = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (rhs);
02010   sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (slhs);
02011   nstate ns;
02012 
02013   DPRINTF ((<font class="stringliteral">"Check assign: %s = %s"</font>, exprNode_unparse (lhs),
02014             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (rhs)));
02015   DPRINTF ((<font class="stringliteral">"lhs: %s"</font>, sRef_unparseFull (slhs)));
02016   DPRINTF ((<font class="stringliteral">"rhs: %s"</font>, sRef_unparseFull (srhs)));
02017 
02018   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (sRef_getType (srhs)))
02019     {
02020       checkStructTransfer (lhs, slhs, rhs, srhs, exprNode_loc (lhs), TT_FIELDASSIGN);
02021     }
02022   <font class="keywordflow">else</font>
02023     {
02024       (<font class="keywordtype">void</font>) checkTransfer (rhs, srhs, lhs, slhs, 
02025                             exprNode_loc (lhs), TT_DOASSIGN);
02026     }
02027 
02028   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (srhs) &amp;&amp; <a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (srhs))
02029     {
02030       <font class="comment">/* constants can match anything (e.g., NULL) */</font>
02031       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (slhs, AK_ERROR, fileloc_undefined);
02032     }
02033 
02034   <font class="keywordflow">if</font> (sRef_isValid (base) &amp;&amp; sRef_isStateDefined (base))
02035     {
02036       <a class="code" href="sRef_c.html#a204">sRef_setPdefined</a> (base, g_currentloc); 
02037     }
02038 
02039   <font class="keywordflow">if</font> (sRef_isPartial (srhs))
02040     {
02041       <a class="code" href="sRef_c.html#a209">sRef_setPartial</a> (slhs, exprNode_loc (rhs));
02042     }
02043 
02044 
02045   ns = sRef_getNullState (srhs);
02046 
02047   <font class="keywordflow">if</font> (<a class="code" href="varKinds_c.html#a5">nstate_possiblyNull</a> (ns))
02048     {
02049       <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (srhs))
02050         {
02051           ns = NS_NOTNULL;
02052         }
02053     }
02054 
02055   <a class="code" href="sRef_c.html#a215">sRef_setNullStateInnerComplete</a> (slhs, ns, exprNode_loc (rhs));
02056 
02057   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (srhs) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (srhs))
02058     {
02059       <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (slhs, sRef_getExKind (srhs), <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (rhs));
02060     }
02061 
02062   DPRINTF ((<font class="stringliteral">"Done transfer: %s"</font>, sRef_unparseFull (slhs)));
02063 }
02064 
02065 <font class="keyword">static</font> <font class="keywordtype">void</font>
02066 checkTransferNullAux (sRef fref, exprNode fexp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> ffix,
02067                       sRef tref, exprNode texp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> tfix,
02068                       fileloc loc, transferKind transferType)<font class="keyword"></font>
02069 <font class="keyword"></font>{
02070   alkind tkind = sRef_getAliasKind (tref);
02071   ctype ttyp = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (sRef_getType (tref));
02072 
02073   <font class="keywordflow">if</font> (ctype_isUnknown (ttyp))
02074     {
02075       ttyp = exprNode_getType (texp);
02076       
02077       <font class="keywordflow">if</font> (ctype_isUnknown (ttyp))
02078         {
02079           ttyp = exprNode_getType (fexp);
02080 
02081           <font class="keywordflow">if</font> (ctype_isUnknown (ttyp))
02082             {
02083               ttyp = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (fref);
02084             }
02085         }
02086     }
02087 
02088   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ttyp) &amp;&amp; (transferType == TT_FCNRETURN))
02089     {
02090       ttyp = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (ttyp);
02091     }
02092 
02093   <font class="comment">/*</font>
02094 <font class="comment">  ** check for null (don't need to check aliases??)</font>
02095 <font class="comment">  */</font>
02096 
02097   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (fref) 
02098       &amp;&amp; !<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (fref) 
02099       &amp;&amp; <a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (ttyp))
02100     {
02101       <font class="keywordflow">if</font> (!alkind_isLocal (tkind) &amp;&amp; !alkind_isFresh (tkind)
02102           &amp;&amp; !<a class="code" href="sRef_c.html#a315">sRef_perhapsNull</a> (tref)
02103           &amp;&amp; !(transferType == TT_DOASSIGN))
02104         {
02105           <font class="keywordflow">if</font> (transferType == TT_GLOBINIT)
02106             {
02107               <font class="keywordflow">if</font> (optgenerror
02108                   (FLG_NULLASSIGN,
02109                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %q initialized to %s value: %q"</font>,
02110                             sRef_getScopeName (tref),
02111                             <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (tref),
02112                             <a class="code" href="sRef_c.html#a334">sRef_nullMessage</a> (fref),
02113                             generateText (fexp, texp, tref, transferType)),
02114                    loc))
02115                 {
02116                   <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
02117                   <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (tref);
02118                 }
02119             }
02120           <font class="keywordflow">else</font>
02121             {
02122               <font class="keywordflow">if</font> (optgenerror
02123                   ((transferType == TT_FCNPASS) ? FLG_NULLPASS : FLG_NULLRET,
02124                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q storage %q%s: %q"</font>,
02125                             cstring_capitalize (sRef_nullMessage (fref)),
02126                             <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
02127                             transferNullMessage (transferType), 
02128                             generateText (fexp, texp, tref, transferType)),
02129                    loc))
02130                 {
02131                   <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (fref);
02132                   <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (fref);
02133                 }
02134             }
02135         }
02136       <font class="keywordflow">else</font>
02137         {
02138           ;
02139         }
02140     }  
02141 }
02142 
02143 
02144 <font class="keyword">static</font> <font class="keywordtype">void</font>
02145 checkTransferAssignAux (sRef fref, exprNode fexp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> ffix,
02146                         sRef tref, exprNode texp, <font class="keywordtype">bool</font> tfix,
02147                         fileloc loc, transferKind transferType)<font class="keyword"></font>
02148 <font class="keyword"></font>{
02149   alkind tkind = sRef_getAliasKind (tref);
02150 
02151   <font class="comment">/*</font>
02152 <font class="comment">  ** Assignment to same --- no errors, or state changes.</font>
02153 <font class="comment">  ** This can happen when returned params are used.</font>
02154 <font class="comment">  */</font>
02155 
02156   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (fref, tref))
02157     {
02158       <a class="code" href="sRef_c.html#a283">sRef_copyState</a> (tref, fref); 
02159       <font class="keywordflow">return</font>;
02160     }
02161   
02162   <font class="keywordflow">if</font> ((alkind_isOnly (tkind) || alkind_isFresh (tkind) 
02163        || alkind_isNewRef (tkind) || alkind_isOwned (tkind))
02164       &amp;&amp; !(<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (tref) 
02165            || <a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (tref) 
02166            || <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (tref) 
02167            || sRef_isPartial (tref)
02168            || <a class="code" href="sRef_c.html#a316">sRef_definitelyNull</a> (tref) 
02169            || <a class="code" href="sRef_c.html#a262">sRef_isStackAllocated</a> (tref) 
02170            || <a class="code" href="sRef_c.html#a295">sRef_isAllocIndexRef</a> (tref))
02171       &amp;&amp; !(<a class="code" href="sRef_c.html#a112">sRef_same</a> (fref, tref)) <font class="comment">/* okay to assign to self (returned params) */</font>
02172       &amp;&amp; !(<a class="code" href="usymtab_c.html#a146">usymtab_isProbableNull</a> (tref))) 
02173     {
02174       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MUSTFREE))
02175         {
02176           <font class="keywordflow">if</font> (<a class="code" href="aliasChecks_c.html#a43">canLoseReference</a> (tref, loc))
02177             {
02178               ; <font class="comment">/* no error */</font>
02179             }
02180           <font class="keywordflow">else</font>
02181             {
02182               <font class="keywordflow">if</font> (sRef_hasLastReference (tref))
02183                 {
02184                   <font class="keywordflow">if</font> (optgenerror 
02185                       (FLG_MUSTFREE,
02186                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Last reference %q to %s storage %qnot released "</font>
02187                                 <font class="stringliteral">"before assignment: %q"</font>,
02188                                 sRef_unparse (tref),
02189                                 <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (tkind),
02190                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (sRef_getAliasInfoRef (tref)),
02191                                 generateText (fexp, texp, tref, transferType)),
02192                        loc))
02193                     {
02194                       <a class="code" href="sRef_c.html#a296">sRef_showRefLost</a> (tref);
02195                     }
02196                 }
02197               <font class="keywordflow">else</font>
02198                 {
02199                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a202">context_inGlobalScope</a> ())
02200                     {
02201                       <font class="comment">/* no errors for static initializations */</font>
02202                     }
02203                   <font class="keywordflow">else</font> 
02204                     {
02205                       <font class="comment">/*</font>
02206 <font class="comment">                       ** don't report this error for a[i], since it could</font>
02207 <font class="comment">                       ** be a new element.</font>
02208 <font class="comment">                       */</font>
02209                       
02210                       <font class="keywordflow">if</font> (alkind_isNewRef (tkind))
02211                         {
02212                           <font class="keywordflow">if</font> (optgenerror 
02213                               (FLG_MUSTFREE,
02214                                message 
02215                                (<font class="stringliteral">"%q %qnot released before assignment: %q"</font>,
02216                                 cstring_makeLiteral
02217                                 (alkind_isKillRef (sRef_getOrigAliasKind (tref))
02218                                  ? <font class="stringliteral">"Kill reference parameter"</font> : <font class="stringliteral">"New reference"</font>),
02219                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (tref),
02220                                 generateText (fexp, texp, tref, transferType)),
02221                                loc))
02222                             {
02223                               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (tref);
02224                               <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (tref, AK_ERROR, loc);
02225                             }
02226                         }
02227                       <font class="keywordflow">else</font> <font class="keywordflow">if</font>
02228                         (!(<a class="code" href="sRef_c.html#a260">sRef_isUnknownArrayFetch</a> (tref)
02229                            &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRICTDESTROY))
02230                          &amp;&amp; !<a class="code" href="sRef_c.html#a203">sRef_isUnionField</a> (tref)
02231                          &amp;&amp; !sRef_isRelDef (tref)
02232                          &amp;&amp; optgenerror 
02233                          (FLG_MUSTFREE,
02234                           message 
02235                           (<font class="stringliteral">"%s storage %qnot released before assignment: %q"</font>,
02236                            <a class="code" href="varKinds_c.html#a14">alkind_capName</a> (tkind),
02237                            <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (tref),
02238                            generateText (fexp, texp, tref, transferType)),
02239                           loc))
02240                           {
02241                             <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (tref);
02242                           }
02243                       <font class="keywordflow">else</font>
02244                         {
02245                           ;
02246                         }
02247                     }
02248                 }
02249             }
02250         }
02251     }
02252 
02253   fixAssignLhs (tref);
02254 
02255   <font class="keywordflow">if</font> (sRef_isRefCounted (tref)) <font class="comment">/* tkind might not be correct now */</font>
02256     {
02257       <font class="keywordflow">if</font> (sRef_isNewRef (fref))
02258         {
02259           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (tref, AK_NEWREF, loc);
02260         }
02261       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (fref))
02262         {
02263           <font class="comment">/* for now, constants are not ref counted */</font>
02264           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (tref, AK_ERROR, loc);
02265         }
02266       <font class="keywordflow">else</font>
02267         {
02268           ;
02269         }
02270 
02271       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref) 
02272           &amp;&amp; sRef_isRefCounted (fref)
02273           &amp;&amp; sRef_isStateDefined (fref))
02274         {
02275           voptgenerror 
02276             (FLG_NEWREFTRANS,
02277              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"New reference %qto reference counted storage: %q"</font>,
02278                       sRef_unparseOpt (tref),
02279                       generateText (fexp, texp, tref, transferType)),
02280              loc);
02281         }
02282     }
02283 
02284   <font class="comment">/*</font>
02285 <font class="comment">  ** Not for structures and unions, since assignments copy.</font>
02286 <font class="comment">  */</font>
02287 
02288   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a349">sRef_isStack</a> (fref)
02289       &amp;&amp; !ctype_isSU (ctype_realType (sRef_getType (fref))))
02290     {
02291       <a class="code" href="sRef_c.html#a185">sRef_setAliasKindComplete</a> (tref, AK_STACK, loc);
02292     }
02293 
02294   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref) 
02295       &amp;&amp; !<a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (tref) <font class="comment">/*&lt; should only apply to static &gt;*/</font>
02296       &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (sRef_getType (tref)))
02297     {
02298       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (fref) &amp;&amp; sRef_isNew (fref)) 
02299         {
02300           <font class="keywordflow">if</font> (!tfix) 
02301             {
02302               <a class="code" href="sRef_c.html#a228">sRef_setFresh</a> (tref, loc);
02303             }
02304         }
02305     }
02306 }
02307 
02308 <font class="comment">/*</font>
02309 <font class="comment">** requires sRef_isOnly (fref)</font>
02310 <font class="comment">*/</font>
02311 
02312 <font class="keyword">static</font> <font class="keywordtype">void</font>
02313 checkOnlyTransferAux (sRef fref, exprNode fexp, <font class="keywordtype">bool</font> ffix,
02314                       sRef tref, exprNode texp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> tfix,
02315                       fileloc loc, transferKind transferType)<font class="keyword"></font>
02316 <font class="keyword"></font>{     
02317   alkind tkind = sRef_getAliasKind (tref);
02318 
02319   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref))
02320     {
02321       <font class="keywordflow">if</font> (transferType == TT_FCNRETURN &amp;&amp; sRef_isNew (fref)
02322           &amp;&amp; !alkind_isError (tkind))
02323         {
02324           <font class="keywordflow">if</font> (optgenerror 
02325               (FLG_ONLYTRANS,
02326                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q%q (will not be released): %q"</font>,
02327                         sRef_unparseOpt (fref),
02328                         transferErrorMessage (transferType, tkind),
02329                         generateText (fexp, texp, tref, transferType)),
02330                loc))
02331             {
02332               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02333             }
02334         }
02335       
02336       <font class="comment">/* no errors for exposed transfers (is this good enough?) */</font>
02337     }
02338   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isOnly (tkind) || alkind_isKeep (tkind) || alkind_isOwned (tkind))
02339     {
02340       ; <font class="comment">/* okay */</font>
02341     }
02342   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((transferType == TT_FCNPASS)
02343            &amp;&amp; (alkind_isUnknown (tkind) 
02344                || alkind_isTemp (tkind) || alkind_isUnique (tkind)))
02345     {
02346       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (fref) 
02347           &amp;&amp; alkind_isUnknown (tkind) &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_PASSUNKNOWN))
02348         {
02349           <font class="keywordflow">if</font> (!ffix) <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (fref, AK_UNKNOWN, loc); 
02350         }
02351     }
02352   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isLocal (tkind) 
02353            || alkind_isFresh (tkind) || alkind_isUnknown (tkind))
02354     {
02355       <font class="keywordflow">if</font> ((transferType == TT_DOASSIGN)
02356           &amp;&amp; sRef_isNew (fref) 
02357           &amp;&amp; <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (fref))
02358         {
02359           <font class="keywordtype">bool</font> error = FALSE;
02360 
02361           <font class="keywordflow">if</font> (alkind_isUnknown (tkind)
02362               &amp;&amp; <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef_getRootBase (tref)))
02363             {
02364               <font class="keywordflow">if</font> (optgenerror 
02365                   (FLG_ONLYUNQGLOBALTRANS,
02366                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q%q: %q"</font>,
02367                             sRef_unparseOpt (fref),
02368                             transferErrorMessage (transferType, tkind),
02369                             generateText (fexp, texp, tref, transferType)),
02370                    loc))
02371                 {
02372                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02373                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (tref, AK_ERROR, loc);
02374                   error = TRUE;
02375                 }
02376             }
02377 
02378           <font class="keywordflow">if</font> (!error &amp;&amp; !ffix) 
02379             {
02380               <a class="code" href="sRef_c.html#a228">sRef_setFresh</a> (tref, loc);
02381             }
02382         }
02383       <font class="keywordflow">else</font>
02384         {
02385           <font class="keywordflow">if</font> (alkind_isLocal (tkind))
02386             {
02387               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (tref, fref))
02388                 {
02389                   ; <font class="comment">/* don't set this --- corresponds to return transfer */</font>
02390                 }
02391               <font class="keywordflow">else</font>
02392                 {
02393                   <font class="comment">/*</font>
02394 <font class="comment">                  ** Don't set local to dependent.  Error will</font>
02395 <font class="comment">                  ** be detected through aliasing.  Except for</font>
02396 <font class="comment">                  ** arrays.</font>
02397 <font class="comment">                  */</font>
02398                   
02399                   <font class="keywordflow">if</font> (!tfix &amp;&amp; <a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (fref)
02400                       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_DEPARRAYS))
02401                     {
02402                       <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (tref, loc);
02403                     }
02404                 }
02405             }
02406           <font class="keywordflow">else</font>
02407             {
02408               <font class="keywordflow">if</font> (optgenerror 
02409                   (FLG_ONLYTRANS,
02410                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q%q: %q"</font>,
02411                             sRef_unparseOpt (fref),
02412                             transferErrorMessage (transferType, tkind),
02413                             generateText (fexp, texp, tref, transferType)),
02414                    loc))
02415                 {
02416                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02417                 }
02418             }
02419         }
02420     }
02421   <font class="keywordflow">else</font>
02422     {
02423       <font class="keywordflow">if</font> (alkind_isError (tkind) 
02424           || (alkind_isUnknown (tkind) &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MEMIMPLICIT)))
02425         {
02426           <a class="code" href="flags_c.html#a23">flagcode_recordSuppressed</a> (FLG_ONLYTRANS);
02427         }
02428       <font class="keywordflow">else</font>
02429         {
02430           <font class="keywordflow">if</font> ((alkind_isKept (tkind) || alkind_isStack (tkind) 
02431                || alkind_isDependent (tkind))
02432               &amp;&amp; <a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref))
02433             {
02434               ; <font class="comment">/* okay */</font>
02435             }
02436           <font class="keywordflow">else</font>
02437             {
02438               <font class="keywordflow">if</font> (optgenerror 
02439                   (FLG_ONLYTRANS,
02440                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Only storage %q%q: %q"</font>,
02441                             sRef_unparseOpt (fref),
02442                             transferErrorMessage (transferType, tkind),
02443                             generateText (fexp, texp, tref, transferType)),
02444                    loc))
02445                 {
02446                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02447                 }
02448             }
02449         }
02450       
02451       <font class="keywordflow">if</font> (transferType == TT_DOASSIGN)
02452         {
02453           <font class="comment">/*</font>
02454 <font class="comment">          ** alias kind unknown to suppress future messages</font>
02455 <font class="comment">          */</font>
02456           
02457           <font class="keywordflow">if</font> (!ffix &amp;&amp; <a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (sRef_getRootBase (fref)))
02458             {
02459               sRef_clearAliasKind (fref);
02460             }
02461         }
02462     }
02463 }
02464 
02465 <font class="comment">/*</font>
02466 <font class="comment">** ??? same as checkOnly ?</font>
02467 <font class="comment">*/</font>
02468 
02469 <font class="keyword">static</font> <font class="keywordtype">void</font>
02470 checkOwnedTransferAux (sRef fref, exprNode fexp, <font class="keywordtype">bool</font> ffix,
02471                        sRef tref, exprNode texp, <font class="keywordtype">bool</font> tfix,
02472                        fileloc loc, transferKind transferType)<font class="keyword"></font>
02473 <font class="keyword"></font>{     
02474   alkind tkind = sRef_getAliasKind (tref);
02475 
02476   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref))
02477     {
02478       <font class="keywordflow">if</font> (transferType == TT_FCNRETURN &amp;&amp; sRef_isNew (fref))
02479         {
02480           <font class="keywordflow">if</font> (optgenerror 
02481               (FLG_OWNEDTRANS,
02482                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Owned storage %q%q (will not be released): %q"</font>,
02483                         sRef_unparseOpt (fref),
02484                         transferErrorMessage (transferType, tkind),
02485                         generateText (fexp, texp, tref, transferType)),
02486                loc))
02487             {
02488               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02489             }
02490         }
02491     }
02492   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isOnly (tkind) || alkind_isKeep (tkind) 
02493            || alkind_isDependent (tkind)
02494            || alkind_isOwned (tkind))
02495     {
02496       <font class="comment">/* okay */</font>
02497     }
02498   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isLocal (tkind)
02499            || alkind_isFresh (tkind) || alkind_isUnknown (tkind))
02500     {
02501       <font class="keywordflow">if</font> ((transferType == TT_DOASSIGN)
02502           &amp;&amp; sRef_isNew (fref) &amp;&amp; <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (fref))
02503         {
02504           <font class="keywordflow">if</font> (!tfix) 
02505             { 
02506               <a class="code" href="sRef_c.html#a228">sRef_setFresh</a> (tref, loc); 
02507             }
02508         }
02509       <font class="keywordflow">else</font>
02510         {
02511         }
02512     }
02513   <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((transferType == TT_FCNPASS)
02514            &amp;&amp; (alkind_isUnknown (tkind) 
02515                || alkind_isTemp (tkind) || alkind_isUnique (tkind)))
02516     {
02517       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (fref) 
02518           &amp;&amp; alkind_isUnknown (tkind) &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_PASSUNKNOWN))
02519         {
02520           <font class="keywordflow">if</font> (!ffix) { sRef_clearAliasKind (fref); }
02521         }
02522     }
02523   <font class="keywordflow">else</font>
02524     {
02525       <font class="keywordflow">if</font> (alkind_isUnknown (tkind) &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MEMIMPLICIT))
02526         {
02527           <a class="code" href="flags_c.html#a23">flagcode_recordSuppressed</a> (FLG_OWNEDTRANS);
02528         }
02529       <font class="keywordflow">else</font>
02530         {
02531           <font class="keywordflow">if</font> (alkind_isKept (tkind) &amp;&amp; <a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref))
02532             {
02533               ; <font class="comment">/* okay */</font>
02534             }
02535           <font class="keywordflow">else</font>
02536             {
02537               voptgenerror
02538                 (FLG_OWNEDTRANS,
02539                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Owned storage %q%q: %q"</font>,
02540                           sRef_unparseOpt (fref),
02541                           transferErrorMessage (transferType, tkind),
02542                           generateText (fexp, texp, tref, transferType)),
02543                  loc);
02544             }
02545         }
02546       
02547       <font class="keywordflow">if</font> (transferType == TT_DOASSIGN)
02548         {
02549           <font class="comment">/*</font>
02550 <font class="comment">           ** alias kind unknown to suppress future messages</font>
02551 <font class="comment">           */</font>
02552           
02553           <font class="keywordflow">if</font> (!ffix) { sRef_clearAliasKind (fref); }
02554         }
02555     }
02556 }
02557   
02558 <font class="keyword">static</font> <font class="keywordtype">void</font>
02559 checkFreshTransferAux (sRef fref, exprNode fexp, <font class="keywordtype">bool</font> ffix,
02560                        sRef tref, exprNode texp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> tfix,
02561                        fileloc loc, transferKind transferType)<font class="keyword"></font>
02562 <font class="keyword"></font>{     
02563   alkind tkind = sRef_getAliasKind (tref);
02564 
02565   <font class="comment">/*</font>
02566 <font class="comment">  ** error to return fresh as non-only</font>
02567 <font class="comment">  */</font>
02568 
02569   <font class="keywordflow">if</font> (transferType == TT_FCNRETURN
02570       &amp;&amp; !(alkind_isOnly (tkind) || alkind_isNewRef (tkind)))
02571     {
02572       <font class="keywordflow">if</font> (alkind_isUnknown (tkind) &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MEMIMPLICIT))
02573         {
02574           <a class="code" href="flags_c.html#a23">flagcode_recordSuppressed</a> (FLG_NEWREFTRANS);
02575         }
02576       <font class="keywordflow">else</font>
02577         {
02578           <font class="keywordflow">if</font> (alkind_isError (tkind))
02579             {
02580               <font class="keywordflow">if</font> (!ffix) 
02581                 { 
02582                   <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc); 
02583                 }
02584             }
02585           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isRefCounted (tkind))
02586             {
02587               <font class="keywordflow">if</font> (optgenerror 
02588                   (FLG_NEWREFTRANS,
02589                    message
02590                    (<font class="stringliteral">"New reference returned without newref qualifier: %q"</font>,
02591                     generateText (fexp, texp, tref, transferType)),
02592                    loc))
02593                 {
02594                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02595                   <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc);
02596                 }
02597               }
02598           <font class="keywordflow">else</font> 
02599             {
02600               <font class="keywordflow">if</font> (optgenerror 
02601                   (FLG_FRESHTRANS,
02602                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Fresh storage %q (should be only): %q"</font>,
02603                             transferErrorMessage (transferType, tkind),
02604                             generateText (fexp, texp, tref, transferType)),
02605                    loc))
02606                 {
02607                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
02608                   <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc);
02609                 }
02610             }
02611         }
02612     }
02613   
02614   <font class="comment">/*</font>
02615 <font class="comment">  ** Okay to assign fresh to only, shared or unqualified.</font>
02616 <font class="comment">  ** </font>
02617 <font class="comment">  ** should generate other errors? </font>
02618 <font class="comment">  */</font>
02619 
02620   <font class="keywordflow">if</font> (alkind_isOnly (tkind))
02621     {
02622       <font class="keywordflow">if</font> (transferType == TT_DOASSIGN &amp;&amp; !<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (tref))
02623         {
02624           <font class="keywordflow">if</font> (!ffix) 
02625             { 
02626               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref))
02627                 {
02628                   <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (fref, loc); 
02629                 }
02630             }
02631         }
02632       <font class="keywordflow">else</font>
02633         {
02634           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (fref))
02635             {
02636               ;
02637             }
02638           <font class="keywordflow">else</font>
02639             {
02640               <font class="keywordflow">if</font> (!ffix) 
02641                 { 
02642                   <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc); 
02643                 }
02644             }
02645         }
02646     }
02647   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isOwned (tkind))
02648     {
02649       <font class="keywordflow">if</font> (!ffix) 
02650         { 
02651           <a class="code" href="sRef_c.html#a227">sRef_setDependentComplete</a> (fref, loc); 
02652         }
02653     }
02654   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isRefCounted (tkind)
02655            &amp;&amp; (transferType == TT_FCNRETURN) &amp;&amp; <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (fref))
02656     {
02657       <font class="keywordflow">if</font> (!ffix) 
02658         { 
02659           <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc); 
02660         }
02661     }
02662   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isKeep (tkind))
02663     {
02664       <font class="keywordflow">if</font> (!ffix) 
02665         { 
02666           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref))
02667             {
02668               <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (fref, loc); 
02669             }
02670         }
02671     }
02672   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isShared (tkind))
02673     {
02674       <font class="keywordflow">if</font> (!ffix) { <a class="code" href="sRef_c.html#a210">sRef_setShared</a> (fref, loc); }
02675     }
02676   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isLocal (tkind) || alkind_isUnknown (tkind))
02677     {
02678       <font class="keywordflow">if</font> (transferType == TT_DOASSIGN || transferType == TT_FCNRETURN)
02679         {
02680           <font class="comment">/*</font>
02681 <font class="comment">          ** local shares fresh.  Make it owned/dependent. </font>
02682 <font class="comment">          */</font>
02683 
02684           <font class="keywordflow">if</font> (!tfix) 
02685             { 
02686               <a class="code" href="sRef_c.html#a222">sRef_setOwned</a> (tref, loc); 
02687             }
02688 
02689           <font class="keywordflow">if</font> (!ffix &amp;&amp; !tfix) 
02690             { 
02691               <a class="code" href="sRef_c.html#a227">sRef_setDependentComplete</a> (fref, loc); 
02692             }
02693 
02694           <font class="comment">/* NO! sRef_clearAliasKind (fref); */</font>
02695         }
02696       <font class="keywordflow">else</font> 
02697         {
02698           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_PASSUNKNOWN))
02699             {
02700                       sRef_clearAliasKind (fref);
02701             }
02702         }
02703     }
02704   <font class="keywordflow">else</font>
02705     {
02706       ;
02707     }
02708 }
02709 
02710 <font class="keyword">static</font> <font class="keywordtype">void</font>
02711 checkTransferExposure (sRef fref, exprNode fexp, <font class="comment">/*@unused@*/</font> <font class="keywordtype">bool</font> ffix,
02712                        sRef tref, exprNode texp, <font class="keywordtype">bool</font> tfix,
02713                        fileloc loc, 
02714                        transferKind transferType)<font class="keyword"></font>
02715 <font class="keyword"></font>{
02716   alkind fkind = sRef_getAliasKind (fref);
02717   alkind tkind = sRef_getAliasKind (tref);
02718   exkind tekind = <a class="code" href="sRef_c.html#a188">sRef_getExKind</a> (tref);
02719 
02720   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (fref) &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (sRef_getType (fref)))
02721     {
02722       <font class="comment">/*</font>
02723 <font class="comment">      ** observer -&gt; exposed or observer</font>
02724 <font class="comment">      */</font>
02725       
02726       <font class="comment">/*</font>
02727 <font class="comment">      ** observer -&gt; temp is okay [NO!  really? only in function calls]</font>
02728 <font class="comment">      */</font>
02729 
02730       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref)
02731           || alkind_isLocal (tkind))
02732         {
02733           <font class="comment">/* okay */</font>
02734           
02735           <font class="keywordflow">if</font> ((transferType == TT_DOASSIGN) &amp;&amp; alkind_isLocal (tkind))
02736             {
02737               <font class="keywordflow">if</font> (!tfix) { <a class="code" href="sRef_c.html#a185">sRef_setAliasKindComplete</a> (tref, fkind, loc); }
02738             }
02739         }
02740       <font class="keywordflow">else</font>
02741         {
02742           <font class="keywordflow">if</font> (transferType == TT_FCNRETURN 
02743               || transferType == TT_DOASSIGN
02744               || transferType == TT_FIELDASSIGN
02745               || transferType == TT_GLOBINIT)
02746             {
02747               <font class="keywordtype">bool</font> hasError = FALSE;
02748               
02749               <font class="keywordflow">if</font> (exprNode_isStringLiteral (fexp)
02750                   &amp;&amp; transferType == TT_GLOBINIT)
02751                 {
02752                   hasError = optgenerror
02753                     (FLG_READONLYTRANS,
02754                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Read-only string literal storage %q%q: %q"</font>,
02755                               sRef_unparseOpt (fref),
02756                               transferErrorExpMessage (transferType, tekind),
02757                               generateText (fexp, texp, tref, transferType)),
02758                      loc);
02759 
02760                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (fref, AK_ERROR, fileloc_undefined);
02761                 }
02762               <font class="keywordflow">else</font> 
02763                 {
02764                   <font class="keywordflow">if</font> ((transferType == TT_DOASSIGN
02765                        || transferType == TT_FIELDASSIGN)
02766                       &amp;&amp; (<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref)
02767                           || (exprNode_isStringLiteral (fexp)
02768                               &amp;&amp; <a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (exprNode_getType (texp)))))
02769                     {
02770                       ; <font class="comment">/* No error for local assignment or assignment</font>
02771 <font class="comment">                           to static array (copies string). */</font>
02772                     }
02773                   <font class="keywordflow">else</font>
02774                     {
02775                       <font class="keywordflow">if</font> (exprNode_isStringLiteral (fexp))
02776                         {
02777                           hasError = optgenerror 
02778                             (FLG_READONLYTRANS,
02779                              message
02780                              (<font class="stringliteral">"Read-only string literal storage %q%q: %q"</font>,
02781                               <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
02782                               transferErrorExpMessage (transferType, tekind),
02783                               generateText (fexp, texp, tref, transferType)),
02784                              loc);
02785                           
02786                         }
02787 
02788                       <font class="keywordflow">if</font> (!hasError)
02789                         {
02790                           hasError = optgenerror 
02791                             (FLG_OBSERVERTRANS,
02792                              message
02793                              (<font class="stringliteral">"Observer storage %q%q: %q"</font>,
02794                               <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
02795                               transferErrorExpMessage (transferType, tekind),
02796                               generateText (fexp, texp, tref, transferType)),
02797                              loc);
02798                         }
02799                     }
02800                 }
02801               
02802               <font class="keywordflow">if</font> (hasError)
02803                 {
02804                   <font class="keywordflow">if</font> (transferType != TT_GLOBINIT)
02805                     {
02806                       <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
02807                       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (tref, AK_ERROR, loc);
02808                     }
02809                 }
02810               <font class="keywordflow">else</font> 
02811                 {
02812                   <font class="keywordflow">if</font> (transferType == TT_DOASSIGN &amp;&amp; !tfix)
02813                     {
02814                       DPRINTF ((<font class="stringliteral">"Setting unknown!"</font>));
02815                       <font class="comment">/* sRef_setAliasKind (tref, AK_ERROR, loc); */</font>
02816                     }
02817                 }
02818             }
02819           <font class="keywordflow">else</font> <font class="comment">/* TT_FCNPASS */</font>
02820             {
02821               llassert (transferType == TT_FCNPASS);
02822 
02823               <font class="keywordflow">if</font> (alkind_isTemp (tkind) 
02824                   || alkind_isDependent (tkind)
02825                   || alkind_isRefCounted (tkind))
02826                 {
02827                   ; <font class="comment">/* okay */</font>
02828                 }
02829               <font class="keywordflow">else</font> 
02830                 {
02831                   <font class="keywordflow">if</font> (!alkind_isError (tkind))
02832                     {
02833                       <font class="keywordflow">if</font> (optgenerror 
02834                           (FLG_OBSERVERTRANS,
02835                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Observer storage %q%q: %q"</font>,
02836                                     sRef_unparseOpt (fref),
02837                                     transferErrorMessage (transferType, tkind),
02838                                     generateText (fexp, texp, tref, transferType)),
02839                            loc))
02840                         {
02841                           <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
02842                           <a class="code" href="sRef_c.html#a184">sRef_clearAliasState</a> (fref, loc); 
02843                         }
02844                     }
02845                 }
02846             }
02847         }
02848     }
02849   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (fref) &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (sRef_getType (fref)))
02850     {
02851       <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
02852         {
02853           <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref)
02854                 || <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (fref)))
02855             {
02856               <font class="keywordflow">if</font> (optgenerror
02857                   (FLG_EXPOSETRANS,
02858                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Exposed storage %q%q: %q"</font>,
02859                             sRef_unparseOpt (fref),
02860                             transferErrorExpMessage (transferType, tekind),
02861                             generateText (fexp, texp, tref, transferType)),
02862                    loc))
02863                 {
02864                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
02865                 }
02866             }
02867         }
02868       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_FCNPASS)
02869         {
02870           <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) 
02871                 || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref)
02872                 || (alkind_isUnknown (tkind) 
02873                     || alkind_isDependent (tkind)
02874                     || alkind_isTemp (tkind)
02875                     || alkind_isKillRef (tkind)
02876                     || alkind_isRefCounted (tkind))))
02877             {
02878               <font class="keywordflow">if</font> (alkind_isUnique (tkind) || alkind_isError (tkind))
02879                 {
02880                 }
02881               <font class="keywordflow">else</font> 
02882                 {
02883                   <font class="keywordflow">if</font> (optgenerror 
02884                       (FLG_EXPOSETRANS,
02885                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Exposed storage %q%q: %q"</font>,
02886                                 sRef_unparseOpt (fref),
02887                                 transferErrorMessage (transferType, tkind),
02888                                 generateText (fexp, texp, tref, transferType)),
02889                        loc))
02890                     {
02891                       <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
02892                       <a class="code" href="sRef_c.html#a184">sRef_clearAliasState</a> (fref, loc); 
02893                     }
02894                 }
02895 
02896             }
02897           <font class="keywordflow">else</font>
02898             {
02899               ;
02900             }
02901         }
02902       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (transferType == TT_DOASSIGN)
02903         {
02904           <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) 
02905                 || !<a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (tref)
02906                 || (alkind_isUnknown (tkind)
02907                     || alkind_isDependent (tkind)
02908                     || alkind_isRefCounted (tkind) 
02909                     || alkind_isNewRef (tkind)
02910                     || alkind_isFresh (tkind)
02911                     || alkind_isLocal (tkind))))
02912             {
02913               <font class="keywordflow">if</font> (optgenerror 
02914                   (FLG_EXPOSETRANS,
02915                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Exposed storage %q%q: %q"</font>,
02916                             sRef_unparseOpt (fref),
02917                             transferErrorExpMessage (transferType, tekind),
02918                             generateText (fexp, texp, tref, transferType)),
02919                    loc))
02920                 {
02921                   <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (fref);
02922                 }
02923             }
02924           <font class="keywordflow">if</font> (!tfix) { <a class="code" href="sRef_c.html#a192">sRef_setExposed</a> (tref, loc); }
02925         }
02926       <font class="keywordflow">else</font>
02927         {
02928           llassert (transferType == TT_GLOBPASS
02929                     || transferType == TT_GLOBRETURN
02930                     || transferType == TT_PARAMRETURN
02931                     || transferType == TT_LEAVETRANS
02932                     || transferType == TT_GLOBINIT);
02933         }
02934     }
02935   <font class="keywordflow">else</font>
02936     {
02937       ;
02938     }
02939 }
02940 
02941 <font class="comment">/*</font>
02942 <font class="comment">** returns TRUE if there is no error reported</font>
02943 <font class="comment">**</font>
02944 <font class="comment">** if fixt, don't change tref (except if error reported.)</font>
02945 <font class="comment">** if fixf, don't change fref (except if error reported.)</font>
02946 <font class="comment">*/</font>
02947 
02948 <font class="keyword">static</font> <font class="keywordtype">void</font>
02949 checkTransferAux (exprNode fexp, sRef fref, <font class="keywordtype">bool</font> ffix,
02950                   exprNode texp, sRef tref, <font class="keywordtype">bool</font> tfix,
02951                   fileloc loc, transferKind transferType)<font class="keyword"></font>
02952 <font class="keyword"></font>{
02953   alkind fkind;
02954   alkind tkind;
02955   <font class="keywordtype">bool</font> isassign = (transferType == TT_DOASSIGN);
02956   <font class="keywordtype">bool</font> isfieldassign = (transferType == TT_FIELDASSIGN);
02957   <font class="keywordtype">bool</font> iseitherassign = isassign || (transferType == TT_FIELDASSIGN);
02958   <font class="keywordtype">bool</font> isfcnpass = (transferType == TT_FCNPASS);
02959   <font class="keywordtype">bool</font> isfcnreturn = (transferType == TT_FCNRETURN);
02960   
02961   setCodePoint ();
02962 
02963   <font class="keywordflow">if</font> (!ffix &amp;&amp; !tfix)
02964     {
02965       setCodePoint ();
02966       checkTransferNullAux (fref, fexp, ffix, tref, texp, tfix, 
02967                             loc, transferType);
02968     }
02969 
02970   <font class="keywordflow">if</font> (isassign)
02971     {
02972       setCodePoint ();
02973       checkTransferAssignAux (fref, fexp, ffix, tref, texp, tfix,
02974                               loc, transferType);
02975     }
02976 
02977   <font class="comment">/*</font>
02978 <font class="comment">  ** Check for definition </font>
02979 <font class="comment">  */</font>
02980 
02981   <font class="comment">/*</font>
02982 <font class="comment">  ** errors passing out params already detected in checkAnyCall</font>
02983 <font class="comment">  */</font>
02984 
02985   <font class="keywordflow">if</font> (!ffix &amp;&amp; !tfix)
02986     {
02987       <font class="keywordtype">bool</font> defok = TRUE;
02988 
02989       <font class="keywordflow">if</font> (!iseitherassign 
02990           || (!<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref) 
02991               &amp;&amp; (sRef_isAnyDefined (tref) || !sRef_stateKnown (tref))))
02992         {
02993           setCodePoint ();
02994 
02995           <font class="keywordflow">if</font> (!ynm_toBoolRelaxed 
02996               (checkCompletelyDefined (fexp, fref, texp, tref,
02997                                        TRUE, FALSE, FALSE, 
02998                                        loc, transferType, 0, TRUE)))
02999             {
03000               defok = FALSE;
03001             }
03002         }
03003 
03004       setCodePoint ();
03005       
03006       <font class="keywordflow">if</font> (defok &amp;&amp; iseitherassign)
03007         {
03008           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (tref, sRef_getDefState (fref), loc);
03009         }
03010     }
03011 
03012   
03013   <font class="comment">/*</font>
03014 <font class="comment">  ** check exposure</font>
03015 <font class="comment">  */</font>
03016 
03017   setCodePoint ();
03018   checkTransferExposure (fref, fexp, ffix, tref, texp, tfix, 
03019                          loc, transferType);
03020 
03021   fkind = sRef_getAliasKind (fref);
03022   tkind = sRef_getAliasKind (tref);
03023 
03024   <font class="comment">/*</font>
03025 <font class="comment">  ** check aliasing</font>
03026 <font class="comment">  */</font>
03027 
03028   <font class="keywordflow">if</font> (alkind_isOnly (fkind))
03029     {
03030       setCodePoint ();
03031       checkOnlyTransferAux (fref, fexp, ffix,
03032                             tref, texp, tfix, 
03033                             loc, transferType);
03034     }
03035   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isFresh (fkind))
03036     {
03037       setCodePoint ();
03038       checkFreshTransferAux (fref, fexp, ffix,
03039                              tref, texp, tfix,
03040                              loc, transferType);
03041     }
03042   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isOwned (fkind))
03043     {
03044       setCodePoint ();
03045       checkOwnedTransferAux (fref, fexp, ffix,
03046                              tref, texp, tfix,
03047                              loc, transferType);
03048     }
03049   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isDependent (fkind))
03050     {
03051       setCodePoint ();
03052       <font class="keywordflow">if</font> (isfcnreturn &amp;&amp; 
03053           (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref) || <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref)))
03054         {
03055           ; <font class="comment">/* okay */</font>
03056         }
03057       <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((alkind_isOnly (tkind) || alkind_isKeep (tkind)
03058                 || alkind_isOwned (tkind))
03059                || (!isfcnpass &amp;&amp; alkind_isTemp (tkind)))
03060         {
03061           <font class="keywordtype">bool</font> error = TRUE;
03062 
03063           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (fref))
03064             {
03065               sRef depRef = dependentReference (fref);
03066 
03067               <font class="keywordflow">if</font> (sRef_isValid (depRef) &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (depRef))
03068                 {
03069                   error = FALSE;
03070                   <a class="code" href="sRef_c.html#a229">sRef_kill</a> (depRef, loc);
03071                   <a class="code" href="sRef_c.html#a229">sRef_kill</a> (fref, loc);
03072                 }
03073 
03074             }
03075 
03076           <font class="keywordflow">if</font> (isfieldassign)
03077             {
03078               error = FALSE;
03079             }
03080 
03081           <font class="keywordflow">if</font> (canLoseLocalReference (fref, loc))
03082             {
03083               ;
03084             }
03085           <font class="keywordflow">else</font>
03086             {
03087               <font class="keywordflow">if</font> (error &amp;&amp;
03088                   (optgenerror 
03089                    (FLG_DEPENDENTTRANS,
03090                     <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q%q: %q"</font>,
03091                              alkind_capName (fkind),
03092                              <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
03093                              transferErrorMessage (transferType, tkind),
03094                              generateText (fexp, texp, tref, transferType)),
03095                     loc)))
03096                 {
03097                   DPRINTF ((<font class="stringliteral">"Here: %s / %s"</font>, 
03098                             sRef_unparseFull (fref),
03099                             <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (tref)));
03100 
03101                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03102                 }
03103             }
03104         }
03105       <font class="keywordflow">else</font> 
03106         {
03107           <font class="keywordflow">if</font> (isassign &amp;&amp; (alkind_isFresh (tkind) || alkind_isLocal (tkind)))
03108             {
03109               <font class="keywordflow">if</font> (!tfix &amp;&amp; !ffix)
03110                 {
03111                   <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (tref, loc);
03112                 }
03113             }
03114         }
03115     }
03116   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isShared (fkind))
03117     {
03118       setCodePoint ();
03119       <font class="comment">/*</font>
03120 <font class="comment">      ** xxx &lt;- shared</font>
03121 <font class="comment">      */</font>
03122 
03123       <font class="keywordflow">if</font> (alkind_isOnly (tkind) 
03124           || (!isfcnpass 
03125               &amp;&amp; (!(<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (tref) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref)) 
03126                   &amp;&amp; alkind_isTemp (tkind))))
03127         {
03128           <font class="keywordflow">if</font> (optgenerror
03129               (FLG_SHAREDTRANS,
03130                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q%q: %q"</font>,
03131                         alkind_capName (fkind),
03132                         <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
03133                         transferErrorMessage (transferType, tkind),
03134                         generateText (fexp, texp, tref, transferType)),
03135                loc))
03136             {
03137               <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03138             }
03139         }
03140       <font class="keywordflow">else</font> 
03141         {
03142           <font class="keywordflow">if</font> (alkind_isFresh (tkind) || alkind_isLocal (tkind))
03143             {
03144               <a class="code" href="sRef_c.html#a210">sRef_setShared</a> (tref, loc);
03145             }
03146         }
03147     }
03148   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isKeep (fkind))
03149     {
03150       setCodePoint ();
03151 
03152       <font class="keywordflow">if</font> (alkind_isKeep (tkind) 
03153           || alkind_isLocal (tkind)
03154           || (isfcnreturn &amp;&amp; <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (tref))
03155           || (iseitherassign 
03156               &amp;&amp; (alkind_isOnly (tkind) || alkind_isOwned (tkind))))
03157         {
03158           <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (fref, loc);
03159         }
03160       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (isfcnpass 
03161                &amp;&amp; (alkind_isTemp (tkind) || alkind_isOwned (tkind)))
03162         {
03163           ;
03164         }
03165       <font class="keywordflow">else</font> 
03166         {
03167           <font class="keywordflow">if</font> (!alkind_isError (tkind))
03168             {
03169               <font class="keywordflow">if</font> (optgenerror
03170                   (FLG_KEEPTRANS,
03171                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q: %q"</font>,
03172                             alkind_capName (fkind),
03173                             transferErrorMessage (transferType, tkind),
03174                             generateText (fexp, texp, tref, transferType)),
03175                    loc))
03176                 {
03177                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03178                 }
03179             }
03180         }
03181     }
03182   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isTemp (fkind) || alkind_isKept (fkind))
03183     {
03184       <font class="comment">/*</font>
03185 <font class="comment">      ** xxx &lt;- temp</font>
03186 <font class="comment">      */</font>
03187       
03188       <font class="keywordflow">if</font> (alkind_isOnly (tkind)
03189           || alkind_isShared (tkind) 
03190           || (alkind_isTemp (fkind)
03191               &amp;&amp; !isfcnreturn &amp;&amp; alkind_isDependent (tkind))
03192           || alkind_isOwned (tkind)
03193           || alkind_isKeep (tkind))
03194         {
03195           <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (fexp)
03196               &amp;&amp; (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (exprNode_getType (fexp))
03197                   || (<a class="code" href="ctype_c.html#a101">ctype_isArray</a> (exprNode_getType (fexp))
03198                       &amp;&amp; <a class="code" href="sRef_c.html#a246">sRef_isParam</a> (fref)))
03199               &amp;&amp; (!iseitherassign || <a class="code" href="sRef_c.html#a249">sRef_isReference</a> (tref)))
03200             {
03201               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (fref))
03202                 {
03203                   <font class="keywordflow">if</font> (optgenerror2
03204                       (alkind_isTemp (fkind) ? FLG_TEMPTRANS : FLG_KEPTTRANS,
03205                        FLG_STRICTUSERELEASED,
03206                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q%q: %q"</font>,
03207                                 alkind_capName (fkind),
03208                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
03209                                 transferErrorMessage (transferType, tkind),
03210                                 generateText (fexp, texp, tref, transferType)),
03211                        loc))
03212                     {
03213                       <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03214                     }
03215                 }
03216               <font class="keywordflow">else</font>
03217                 {
03218                   <font class="keywordflow">if</font> (optgenerror
03219                       (alkind_isTemp (fkind) ? FLG_TEMPTRANS : FLG_KEPTTRANS,
03220                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q%q: %q"</font>,
03221                                 alkind_capName (fkind),
03222                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
03223                                 transferErrorMessage (transferType, tkind),
03224                                 generateText (fexp, texp, tref, transferType)),
03225                        loc))
03226                     {
03227                       <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03228                     }
03229                 }
03230             }
03231         }
03232     }
03233   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isRefCounted (fkind) || alkind_isKillRef (fkind))
03234     {
03235       <font class="keywordflow">if</font> (alkind_isNewRef (tkind))
03236         {
03237           <font class="comment">/*</font>
03238 <font class="comment">          ** check that the refs field has been modified</font>
03239 <font class="comment">          */</font>
03240 
03241           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (fref))
03242             {
03243               voptgenerror 
03244                 (FLG_REFCOUNTTRANS,
03245                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counted storage returned without modifying "</font>
03246                           <font class="stringliteral">"reference count: %s"</font>,
03247                           exprNode_unparse (fexp)),
03248                  loc);
03249             }
03250         }
03251       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (iseitherassign)
03252         {
03253           <font class="keywordflow">if</font> (alkind_isRefCounted (fkind))
03254             {
03255               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (tref))
03256                 {
03257                   vgenhinterror 
03258                     (FLG_REFCOUNTTRANS,
03259                      message 
03260                      (<font class="stringliteral">"Assignment to non-local from reference counted storage: %s"</font>,
03261                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp)),
03262                      cstring_makeLiteral 
03263                      (<font class="stringliteral">"Reference counted storage should call a function returning "</font>
03264                       <font class="stringliteral">"a newref instead of direct assignments."</font>),
03265                      loc);
03266                 }
03267               <font class="keywordflow">else</font>
03268                 {
03269                   ;
03270                 }
03271             }
03272         }
03273       <font class="keywordflow">else</font> <font class="comment">/* fcnpass */</font>
03274         {
03275           <font class="keywordflow">if</font> (alkind_isRefCounted (tkind) || alkind_isTemp (tkind))
03276             {
03277               <font class="comment">/* okay --- no change in state */</font>
03278             }
03279           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isKillRef (tkind))
03280             {
03281               <font class="keywordflow">if</font> (!ffix &amp;&amp; !tfix &amp;&amp; !(transferType == TT_FCNRETURN))
03282                 { 
03283                   <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc); 
03284                 }
03285             }
03286           <font class="keywordflow">else</font> 
03287             {
03288               <font class="keywordflow">if</font> (!alkind_isError (tkind))
03289                 {
03290                   voptgenerror
03291                     (FLG_REFCOUNTTRANS,
03292                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Reference counted storage %q: %q"</font>,
03293                               transferErrorMessage (transferType, tkind),
03294                               generateText (fexp, texp, tref, transferType)),
03295                      loc);
03296                 }
03297             }
03298         }
03299     }
03300   <font class="keywordflow">else</font>
03301     {
03302       ;
03303     }
03304 
03305   setCodePoint ();
03306   
03307   <font class="keywordflow">if</font> (alkind_isOnly (tkind) || alkind_isKeep (tkind))
03308     {
03309       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (fref))
03310         {
03311           voptgenerror
03312             (FLG_IMMEDIATETRANS,
03313              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Immediate address %q %q: %q"</font>, 
03314                       sRef_unparse (fref),
03315                       transferErrorMessage (transferType, tkind),
03316                       generateText (fexp, texp, tref, transferType)),
03317              loc);
03318           
03319           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (fref, AK_ERROR, loc);
03320         }
03321       <font class="keywordflow">else</font> 
03322         {
03323           <font class="keywordflow">if</font> ((alkind_isUnknown (fkind) || alkind_isStatic (fkind))
03324               &amp;&amp; !<a class="code" href="sRef_c.html#a347">sRef_isDefinitelyNull</a> (fref)
03325               &amp;&amp; (!ffix &amp;&amp; !tfix)
03326               &amp;&amp; (!<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (fexp)))
03327             {
03328               flagcode errkind = alkind_isStatic (fkind) 
03329                 ? FLG_STATICTRANS : FLG_UNKNOWNTRANS;
03330 
03331               <font class="keywordflow">if</font> (transferType == TT_GLOBINIT)
03332                 {
03333                   <font class="keywordflow">if</font> (errkind == FLG_STATICTRANS)
03334                     {
03335                       errkind = FLG_STATICINITTRANS;
03336                     }
03337                   <font class="keywordflow">else</font>
03338                     {
03339                       errkind = FLG_UNKNOWNINITTRANS;
03340                     }
03341                 }
03342 
03343               <font class="keywordflow">if</font> (optgenerror 
03344                   (errkind,
03345                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %s %q: %q"</font>,
03346                             alkind_capName (fkind),
03347                             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fexp),
03348                             transferErrorMessage (transferType, tkind),
03349                             generateText (fexp, texp, tref, transferType)),
03350                    loc))
03351                 {
03352                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03353                 }
03354             }
03355         }
03356       
03357       <font class="comment">/* don't kill shared to suppress future messages */</font>
03358       <font class="keywordflow">if</font> (!alkind_isShared (fkind))
03359         {
03360           <font class="keywordflow">if</font> (isassign)
03361             {
03362               <font class="keywordflow">if</font> (!ffix) 
03363                 {
03364                   <font class="comment">/*&lt; yuk! should do this in aliasaux &gt;*/</font>
03365                    
03366                   <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a330">sRef_isNSLocalVar</a> (tref) &amp;&amp; !<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (fref, tref))
03367                     {
03368                       <font class="keywordflow">if</font> (!tfix)
03369                         {
03370                           <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (fref, loc);
03371                         }
03372                       <font class="keywordflow">else</font>
03373                         {
03374                           <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (fref, loc);
03375                         }
03376                     }
03377                 }
03378             }
03379           <font class="keywordflow">else</font>
03380             {
03381               <font class="keywordflow">if</font> (!ffix) 
03382                 {
03383                   <font class="keywordflow">if</font> (!tfix)
03384                     {
03385                       <font class="keywordflow">if</font> (alkind_isKeep (tkind))
03386                         {
03387                           <a class="code" href="sRef_c.html#a226">sRef_setKeptComplete</a> (fref, loc);
03388                         }
03389                       <font class="keywordflow">else</font>
03390                         {
03391                           <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc); 
03392                         }
03393                     }
03394                   <font class="keywordflow">else</font>
03395                     {
03396                       <font class="keywordflow">if</font> (alkind_isKeep (tkind))
03397                         {
03398                           <a class="code" href="sRef_c.html#a223">sRef_setKept</a> (fref, loc);
03399                         }
03400                       <font class="keywordflow">else</font>
03401                         {
03402                           <a class="code" href="sRef_c.html#a229">sRef_kill</a> (fref, loc);
03403                         }
03404                     }
03405                 }
03406             }
03407         }
03408     }
03409   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isOwned (tkind))
03410     {
03411       <font class="comment">/* don't kill shared to suppress future messages */</font>
03412       <font class="keywordflow">if</font> (!alkind_isShared (fkind)) 
03413         {
03414           <font class="keywordflow">if</font> (!isassign 
03415               || !<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (fref, tref)) <font class="comment">/* result of return parameter */</font>
03416             {
03417               <font class="keywordflow">if</font> (!ffix)
03418                 {
03419                   <font class="keywordflow">if</font> (!tfix)
03420                     {
03421                       <a class="code" href="sRef_c.html#a227">sRef_setDependentComplete</a> (fref, loc);
03422                     }
03423                   <font class="keywordflow">else</font>
03424                     {
03425                       <a class="code" href="sRef_c.html#a221">sRef_setDependent</a> (fref, loc);
03426                     }
03427                 }
03428             }
03429         }
03430     }
03431   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isShared (tkind))
03432     {
03433       <font class="keywordflow">if</font> (alkind_isFresh (fkind) || alkind_isLocal (fkind))
03434         {
03435           <font class="keywordflow">if</font> (!ffix) 
03436             {
03437               <a class="code" href="sRef_c.html#a210">sRef_setShared</a> (fref, loc);
03438             }
03439         }
03440     }
03441   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isUnknown (tkind) &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MEMIMPLICIT))
03442     {
03443       <font class="keywordflow">if</font> (alkind_isDependent (fkind))
03444         {
03445           <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (fexp)
03446               &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (exprNode_getType (fexp))
03447               &amp;&amp; (!iseitherassign || <a class="code" href="sRef_c.html#a249">sRef_isReference</a> (tref)))
03448             {
03449               <font class="keywordflow">if</font> (<a class="code" href="aliasChecks_c.html#a43">canLoseReference</a> (fref, loc))
03450                 {
03451                   ;
03452                 }
03453               <font class="keywordflow">else</font>
03454                 {
03455                   <font class="keywordflow">if</font> (optgenerror
03456                       (FLG_DEPENDENTTRANS,
03457                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s storage %q%q: %q"</font>,
03458                                 alkind_capName (fkind),
03459                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (fref),
03460                                 transferErrorMessage (transferType, tkind),
03461                                 generateText (fexp, texp, tref, transferType)),
03462                        loc))
03463                     {
03464                       DPRINTF ((<font class="stringliteral">"Here: %s / %s"</font>, sRef_unparseFull (fref),
03465                                 <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (tref)));
03466                       <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03467                     }
03468                 }
03469             }
03470         }
03471     }
03472   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isNewRef (tkind))
03473     {
03474       <font class="keywordflow">if</font> (!ffix &amp;&amp; !tfix)
03475         { 
03476           <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc);  
03477         }
03478     }
03479   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alkind_isKillRef (tkind))
03480     {
03481       <font class="keywordflow">if</font> (transferType == TT_FCNRETURN)
03482         {
03483           <font class="keywordflow">if</font> (sRef_isNewRef (fref))
03484             {
03485               <font class="keywordflow">if</font> (optgenerror
03486                   (FLG_REFCOUNTTRANS,
03487                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"New reference returned as temp reference: %q"</font>,
03488                             generateText (fexp, texp, tref, transferType)),
03489                    loc))
03490                 {
03491                   <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03492                 }
03493               }
03494         }
03495       <font class="keywordflow">else</font>
03496         {
03497           <font class="keywordflow">if</font> (sRef_isNewRef (fref))
03498             {
03499               <a class="code" href="sRef_c.html#a232">sRef_killComplete</a> (fref, loc);
03500             }
03501           <font class="keywordflow">else</font> 
03502             {
03503               <font class="keywordflow">if</font> (sRef_isRefCounted (fref) 
03504                   &amp;&amp; <a class="code" href="sRef_c.html#a239">sRef_isCvar</a> (fref)
03505                   &amp;&amp; !<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (fref))
03506                 {
03507                   <font class="keywordflow">if</font> (optgenerror
03508                       (FLG_REFCOUNTTRANS,
03509                        message 
03510                        (<font class="stringliteral">"External reference counted storage released: %q"</font>,
03511                         generateText (fexp, texp, tref, transferType)),
03512                        loc))
03513                     {
03514                       <a class="code" href="sRef_c.html#a302">sRef_showAliasInfo</a> (fref);
03515                     }
03516                 }
03517             }
03518         }
03519           
03520     }
03521   <font class="keywordflow">else</font>
03522     {
03523       ;
03524     }
03525 
03526   setCodePoint ();
03527 }
03528 
03529 <font class="comment">/*</font>
03530 <font class="comment">** assigns fexp := tref or passes fexp as a parameter, or returns fexp.</font>
03531 <font class="comment">**</font>
03532 <font class="comment">** For assignments, sets alias and definition state accordingly.</font>
03533 <font class="comment">*/</font>
03534 
03535 <font class="keyword">static</font> <font class="keywordtype">void</font>
03536 checkTransfer (exprNode fexp, sRef fref, exprNode texp, sRef tref, 
03537                fileloc loc, transferKind transferType)<font class="keyword"></font>
03538 <font class="keyword"></font>{
03539   setCodePoint ();
03540 
03541   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
03542     {
03543             <font class="keywordflow">return</font>;
03544     }
03545 
03546   <font class="comment">/*</font>
03547 <font class="comment">  ** for local references, we need to check</font>
03548 <font class="comment">  ** the transfer for all possible aliases.</font>
03549 <font class="comment">  */</font>
03550 
03551   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (tref) &amp;&amp; transferType != TT_DOASSIGN)
03552     {    
03553       sRefSet alias = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (tref);
03554 
03555       sRefSet_realElements (alias, atref)<font class="keyword"></font>
03556 <font class="keyword">        </font>{
03557           sRef abase = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (atref);
03558 
03559           <font class="keywordflow">if</font> (sRef_isKnown (atref)
03560               &amp;&amp; !<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (abase) 
03561               &amp;&amp; !<a class="code" href="sRef_c.html#a242">sRef_isExternal</a> (abase))
03562             {
03563               atref = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (atref);
03564 
03565               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a287">sRef_hasName</a> (atref))
03566                 {
03567                   <font class="keywordflow">if</font> (!sRef_isNew (atref) 
03568                       &amp;&amp; !<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (tref, atref))
03569                     {
03570                       <a class="code" href="context_c.html#a142">context_setAliasAnnote</a> (atref, tref);
03571                     }
03572                   
03573                                   checkTransferAux (fexp, fref, TRUE, 
03574                                     texp, atref, FALSE,
03575                                     loc, transferType);
03576                   
03577                   <a class="code" href="context_c.html#a144">context_clearAliasAnnote</a> ();
03578                 }
03579             }
03580         } end_sRefSet_realElements;
03581 
03582       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (alias);
03583     }
03584 
03585   
03586   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (fref))
03587     {    
03588       sRefSet alias = <a class="code" href="usymtab_c.html#a154">usymtab_allAliases</a> (fref);
03589 
03590       sRefSet_realElements (alias, afref)<font class="keyword"></font>
03591 <font class="keyword">        </font>{
03592           sRef abase = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (afref);
03593 
03594           <font class="keywordflow">if</font> (sRef_isKnown (afref) 
03595               &amp;&amp; !<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (abase)
03596               &amp;&amp; !<a class="code" href="sRef_c.html#a242">sRef_isExternal</a> (abase))
03597             {
03598               afref = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (afref);
03599 
03600               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a287">sRef_hasName</a> (afref))
03601                 {
03602                   <font class="keywordflow">if</font> (!sRef_isNew (afref) 
03603                       &amp;&amp; !<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (afref, fref))
03604                     {
03605                                       <a class="code" href="context_c.html#a142">context_setAliasAnnote</a> (afref, fref);
03606                     }
03607                   
03608                                   checkTransferAux (fexp, afref, FALSE,
03609                                     texp, tref, TRUE,
03610                                     loc, transferType);
03611                   
03612                   <a class="code" href="context_c.html#a144">context_clearAliasAnnote</a> ();
03613                 }
03614             }
03615         } end_sRefSet_realElements;
03616 
03617       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (alias);
03618     }
03619   
03620   setCodePoint ();
03621 
03622     checkTransferAux (fexp, fref, FALSE, texp, tref, FALSE, 
03623                     loc, transferType);
03624 
03625   setCodePoint ();  
03626 }
03627 
03628 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef 
03629   dependentReference (sRef sr)<font class="keyword"></font>
03630 <font class="keyword"></font>{
03631   sRefSet ab = <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (sr); <font class="comment">/* yes, really mean aliasedBy */</font>
03632   
03633   <font class="comment">/*</font>
03634 <font class="comment">  ** If there is a local variable that aliases sr, then there is no</font>
03635 <font class="comment">  ** error.  Make the local an only.</font>
03636 <font class="comment">  */</font>
03637   
03638   <font class="keywordflow">if</font> (!sRefSet_isEmpty (ab))
03639     {
03640       sRef res = sRef_undefined;
03641 
03642       <font class="comment">/*</font>
03643 <font class="comment">      ** make one an only, others alias it</font>
03644 <font class="comment">      */</font>
03645       
03646             
03647       sRefSet_realElements (ab, current)<font class="keyword"></font>
03648 <font class="keyword">        </font>{
03649           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (current))
03650             {
03651               res = current; 
03652               <font class="keywordflow">break</font>;
03653             }
03654         } end_sRefSet_realElements;
03655 
03656       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (ab);
03657       <font class="keywordflow">return</font> res;
03658     }
03659 
03660   <font class="keywordflow">return</font> sRef_undefined;
03661 }
03662 
<a name="l03663"></a><a class="code" href="aliasChecks_c.html#a43">03663</a> <font class="keywordtype">bool</font> <a class="code" href="aliasChecks_c.html#a43">canLoseReference</a> (sRef sr, fileloc loc)<font class="keyword"></font>
03664 <font class="keyword"></font>{
03665   <font class="keywordtype">bool</font> gotone = FALSE;
03666   sRefSet ab = <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (sr); <font class="comment">/* yes, really mean aliasedBy */</font>
03667   
03668     
03669   <font class="comment">/*</font>
03670 <font class="comment">   ** if there is a local variable that aliases sr, then there is no</font>
03671 <font class="comment">   ** error.  Make the local an only.</font>
03672 <font class="comment">   */</font>
03673   
03674   <font class="keywordflow">if</font> (!sRefSet_isEmpty (ab))
03675     {
03676       <font class="comment">/*</font>
03677 <font class="comment">      ** make one an only, others alias it</font>
03678 <font class="comment">      */</font>
03679       
03680             
03681       sRefSet_realElements (ab, current)<font class="keyword"></font>
03682 <font class="keyword">        </font>{
03683           <a class="code" href="sRef_c.html#a211">sRef_setLastReference</a> (current, sr, loc);
03684           gotone = TRUE;
03685           <font class="keywordflow">break</font>;
03686         } end_sRefSet_realElements;
03687 
03688       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (ab);
03689     }
03690 
03691   <font class="keywordflow">return</font> gotone;
03692 }
03693 
03694 <font class="keywordtype">bool</font> canLoseLocalReference (sRef sr, fileloc loc)<font class="keyword"></font>
03695 <font class="keyword"></font>{
03696   <font class="keywordtype">bool</font> gotone = FALSE;
03697   sRefSet ab = <a class="code" href="usymtab_c.html#a156">usymtab_aliasedBy</a> (sr); <font class="comment">/* yes, really mean aliasedBy */</font>
03698   
03699     
03700   <font class="comment">/*</font>
03701 <font class="comment">   ** if there is a local variable that aliases sr, then there is no</font>
03702 <font class="comment">   ** error.  Make the local an only.</font>
03703 <font class="comment">   */</font>
03704   
03705   <font class="keywordflow">if</font> (!sRefSet_isEmpty (ab))
03706     {
03707       <font class="comment">/*</font>
03708 <font class="comment">      ** make one an only, others alias it</font>
03709 <font class="comment">      */</font>
03710       
03711             
03712       sRefSet_realElements (ab, current)<font class="keyword"></font>
03713 <font class="keyword">        </font>{
03714           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a332">sRef_isRealLocalVar</a> (sRef_getRootBase (current)))
03715             {
03716               <a class="code" href="sRef_c.html#a211">sRef_setLastReference</a> (current, sr, loc);
03717               gotone = TRUE;
03718               <font class="keywordflow">break</font>;
03719             }
03720         } end_sRefSet_realElements;
03721 
03722       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (ab);
03723     }
03724 
03725   <font class="keywordflow">return</font> gotone;
03726 }
03727 
03728 
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:38 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
