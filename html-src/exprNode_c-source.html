<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>exprNode.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3 on Fri Nov 3 18:57:40 2000 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>exprNode.c</h1><a href="exprNode_c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">** LCLint - annotation-assisted static program checker</font>
00003 <font class="comment">** Copyright (C) 1994-2000 University of Virginia,</font>
00004 <font class="comment">**         Massachusetts Institute of Technology</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** This program is free software; you can redistribute it and/or modify it</font>
00007 <font class="comment">** under the terms of the GNU General Public License as published by the</font>
00008 <font class="comment">** Free Software Foundation; either version 2 of the License, or (at your</font>
00009 <font class="comment">** option) any later version.</font>
00010 <font class="comment">** </font>
00011 <font class="comment">** This program is distributed in the hope that it will be useful, but</font>
00012 <font class="comment">** WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">** General Public License for more details.</font>
00015 <font class="comment">** </font>
00016 <font class="comment">** The GNU General Public License is available from http://www.gnu.org/ or</font>
00017 <font class="comment">** the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston,</font>
00018 <font class="comment">** MA 02111-1307, USA.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** For information on lclint: lclint-request@cs.virginia.edu</font>
00021 <font class="comment">** To report a bug: lclint-bug@cs.virginia.edu</font>
00022 <font class="comment">** For more information: http://lclint.cs.virginia.edu</font>
00023 <font class="comment">*/</font>
00024 <font class="comment">/*</font>
00025 <font class="comment">** exprNode.c</font>
00026 <font class="comment">*/</font>
00027 
00028 <font class="preprocessor"># include &lt;ctype.h&gt;</font> <font class="comment">/* for isdigit */</font>
00029 <font class="preprocessor"># include "lclintMacros.nf"</font>
00030 <font class="preprocessor"># include "basic.h"</font>
00031 <font class="preprocessor"># include "cgrammar.h"</font>
00032 <font class="preprocessor"># include "cgrammar_tokens.h"</font>
00033 
00034 <font class="preprocessor"># include "exprChecks.h"</font>
00035 <font class="preprocessor"># include "aliasChecks.h"</font>
00036 <font class="preprocessor"># include "exprNodeSList.h"</font>
00037 <font class="preprocessor"># include "exprData.i"</font>
00038 
00039 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_isEmptyStatement (exprNode p_e);
00040 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> exprNode exprNode_firstStatement (<font class="comment">/*@returned@*/</font> exprNode p_e);
00041 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_isFalseConstant (exprNode p_e) <font class="comment">/*@*/</font> ;
00042 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_isBlock (exprNode p_e);
00043 <font class="keyword">static</font> <font class="keywordtype">void</font> checkGlobUse (uentry p_glob, <font class="keywordtype">bool</font> p_isCall, <font class="comment">/*@notnull@*/</font> exprNode p_e);
00044 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_addUse (exprNode p_e, sRef p_s);
00045 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_matchArgType (ctype p_ct, exprNode p_e);
00046 <font class="keyword">static</font> exprNode exprNode_fakeCopy (exprNode p_e) <font class="comment">/*@*/</font> ;
00047 <font class="keyword">static</font> exprNode exprNode_statementError (<font class="comment">/*@only@*/</font> exprNode p_e);
00048 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_matchTypes (exprNode p_e1, exprNode p_e2);
00049 <font class="keyword">static</font> <font class="keywordtype">void</font> checkUniqueParams (exprNode p_fcn,
00050                                <font class="comment">/*@notnull@*/</font> exprNode p_current, exprNodeList p_args, 
00051                                <font class="keywordtype">int</font> p_paramno, uentry p_ucurrent);
00052 <font class="keyword">static</font> <font class="keywordtype">void</font> updateAliases (<font class="comment">/*@notnull@*/</font> exprNode p_e1, <font class="comment">/*@notnull@*/</font> exprNode p_e2);
00053 <font class="keyword">static</font> <font class="keywordtype">void</font> abstractOpError (ctype p_tr1, ctype p_tr2, lltok p_op, 
00054                              <font class="comment">/*@notnull@*/</font> exprNode p_e1, <font class="comment">/*@notnull@*/</font> exprNode p_e2, 
00055                              fileloc p_loc1, fileloc p_loc2);
00056 <font class="keyword">static</font> ctype checkNumerics (ctype p_tr1, ctype p_tr2, ctype p_te1, ctype p_te2,
00057                             <font class="comment">/*@notnull@*/</font> exprNode p_e1, <font class="comment">/*@notnull@*/</font> exprNode p_e2, lltok p_op);
00058 <font class="keyword">static</font> <font class="keywordtype">void</font> doAssign (<font class="comment">/*@notnull@*/</font> exprNode p_e1, <font class="comment">/*@notnull@*/</font> exprNode p_e2, <font class="keywordtype">bool</font> p_isInit);
00059 <font class="keyword">static</font> <font class="keywordtype">void</font> checkSafeUse (exprNode p_e, sRef p_s);
00060 <font class="keyword">static</font> <font class="keywordtype">void</font> reflectNullTest (<font class="comment">/*@notnull@*/</font> exprNode p_e, <font class="keywordtype">bool</font> p_isnull);
00061 <font class="keyword">static</font> <font class="keywordtype">void</font> checkMacroParen (exprNode p_e);
00062 <font class="keyword">static</font> exprNodeSList exprNode_flatten (<font class="comment">/*@dependent@*/</font> exprNode p_e);
00063 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_checkSetAny (exprNode p_e, <font class="comment">/*@dependent@*/</font> cstring p_name);
00064 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_checkUse (exprNode p_e, sRef p_s, fileloc p_loc);
00065 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_mergeUSs (exprNode p_res, exprNode p_other);
00066 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_mergeCondUSs (exprNode p_res, exprNode p_other1, exprNode p_other2);
00067 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> exprNode exprNode_fromIdentifierAux (<font class="comment">/*@observer@*/</font> uentry p_c);
00068 <font class="keyword">static</font> <font class="keywordtype">void</font> checkAnyCall (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode p_fcn, 
00069                           <font class="comment">/*@dependent@*/</font> cstring p_fname,
00070                           uentryList p_pn, exprNodeList p_args, 
00071                           <font class="keywordtype">bool</font> p_hasMods, sRefSet p_mods, <font class="keywordtype">bool</font> p_isSpec,
00072                           <font class="keywordtype">int</font> p_specialArgs);
00073 <font class="keyword">static</font> <font class="keywordtype">void</font> checkOneArg (uentry p_ucurrent, <font class="comment">/*@notnull@*/</font> exprNode p_current, 
00074                          <font class="comment">/*@dependent@*/</font> exprNode p_fcn, <font class="keywordtype">bool</font> p_isSpec, <font class="keywordtype">int</font> p_argno, <font class="keywordtype">int</font> p_totargs);
00075 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00076   checkUnspecCall (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode p_fcn, uentryList p_params, exprNodeList p_args);
00077 
00078 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNode exprNode_effect (exprNode p_e)
00079   <font class="comment">/*@globals internalState@*/</font> ;
00080 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring exprNode_doUnparse (exprNode p_e);
00081 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring exprNode_rootVarName (exprNode p_e);
00082 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> exprNode 
00083   exprNode_lastStatement (<font class="comment">/*@returned@*/</font> exprNode p_e);
00084 
00085 <font class="keyword">static</font> <font class="comment">/*@null@*/</font> sRef defref = sRef_undefined;
00086 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNode mustExitNode = exprNode_undefined;
00087 
00088 <font class="keyword">static</font> <font class="keywordtype">int</font> checkArgsReal (uentry p_fcn, <font class="comment">/*@dependent@*/</font> exprNode p_f, 
00089                           uentryList p_cl, 
00090                           exprNodeList p_args, <font class="keywordtype">bool</font> p_isIter, exprNode p_ret);
00091 
00092 <font class="keyword">static</font> <font class="keywordtype">bool</font> inEffect = FALSE;
00093 <font class="keyword">static</font> <font class="keywordtype">int</font> nowalloc = 0;
00094 <font class="keyword">static</font> <font class="keywordtype">int</font> totalloc = 0;
00095 <font class="keyword">static</font> <font class="keywordtype">int</font> maxalloc = 0;
00096 
00097 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry regArg;
00098 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry outArg;
00099 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry outStringArg;
00100 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef stdinRef;
00101 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> sRef stdoutRef;
00102 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry csArg;
00103 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> uentry csOnlyArg; 
00104 <font class="keyword">static</font> ctype cstringType;
00105 <font class="keyword">static</font> ctype ctypeType;
00106 <font class="keyword">static</font> ctype filelocType; 
00107 <font class="keyword">static</font> <font class="keywordtype">bool</font> initMod = FALSE;
00108 
00109 <font class="comment">/*</font>
00110 <font class="comment">** must occur after library has been read</font>
00111 <font class="comment">*/</font>
00112 
<a name="l00113"></a><a class="code" href="exprNode_c.html#a49">00113</a> <font class="keywordtype">void</font> <a class="code" href="exprNode_c.html#a49">exprNode_initMod</a> (<font class="keywordtype">void</font>)
00114   <font class="comment">/*@globals undef regArg, undef outArg, undef outStringArg, </font>
00115 <font class="comment">             undef csOnlyArg, undef csArg; </font>
00116 <font class="comment">   @*/</font>
00117 {
00118   uentry ue;
00119   idDecl tmp;
00120   
00121   initMod = TRUE;
00122   cstringType = ctype_unknown;
00123   ctypeType = ctype_unknown;
00124   filelocType = ctype_unknown;
00125 
00126   defref = sRef_undefined;
00127   
00128   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"cstring"</font>)))
00129     {
00130       cstringType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"cstring"</font>));
00131     }
00132  
00133   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"ctype"</font>)))
00134     {
00135       ctypeType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"ctype"</font>));
00136     }
00137 
00138   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"fileloc"</font>)))
00139     {
00140       filelocType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"fileloc"</font>));
00141     }
00142 
00143   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a126">usymtab_existsGlob</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdin"</font>)))
00144     {
00145       ue = <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdin"</font>));
00146     }
00147   <font class="keywordflow">else</font> <font class="comment">/* define stdin */</font>
00148     {
00149       ue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdin"</font>), 
00150                                 ctype_unknown, 
00151                                 <a class="code" href="fileloc_c.html#a28">fileloc_getBuiltin</a> (), 
00152                                 FALSE);
00153       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue); 
00154       ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00155     }
00156 
00157   stdinRef = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (uentry_getSref (ue));
00158   
00159   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a126">usymtab_existsGlob</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdout"</font>)))
00160     {
00161       ue = <a class="code" href="usymtab_c.html#a116">usymtab_lookupGlob</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdout"</font>));
00162     }
00163   <font class="keywordflow">else</font>
00164     {
00165       ue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (cstring_makeLiteralTemp (<font class="stringliteral">"stdout"</font>), 
00166                                 ctype_unknown, 
00167                                 <a class="code" href="fileloc_c.html#a28">fileloc_getBuiltin</a> (), 
00168                                 FALSE);
00169       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue); 
00170       ue = <a class="code" href="usymtab_c.html#a54">usymtab_supGlobalEntryReturn</a> (ue);
00171     }
00172   
00173   stdoutRef = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (uentry_getSref (ue));
00174 
00175   tmp = <a class="code" href="idDecl_c.html#a0">idDecl_create</a> (cstring_undefined, qtype_create (ctype_unknown));
00176 
00177   regArg = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (tmp, PARAMUNKNOWN);
00178 
00179   <a class="code" href="idDecl_c.html#a8">idDecl_setTyp</a> (tmp, 
00180                  qtype_addQual (qtype_create (ctype_makePointer (ctype_unknown)),
00181                                 qual_createOut ()));
00182 
00183   outArg = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (tmp, PARAMUNKNOWN);
00184 
00185   <a class="code" href="idDecl_c.html#a8">idDecl_setTyp</a> (tmp, qtype_addQual (qtype_create (ctype_string), 
00186                                      qual_createOut ()));
00187   
00188   outStringArg = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (tmp, PARAMUNKNOWN);
00189   
00190   <a class="code" href="idDecl_c.html#a8">idDecl_setTyp</a> (tmp, qtype_addQual (qtype_addQual (qtype_create (cstringType), 
00191                                                     qual_createOnly ()),
00192                                      qual_createNull ()));
00193   
00194   csOnlyArg = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (tmp, PARAMUNKNOWN);
00195   
00196   <a class="code" href="idDecl_c.html#a8">idDecl_setTyp</a> (tmp, qtype_addQual (qtype_create (cstringType), qual_createNull ()));
00197   csArg = <a class="code" href="uentry_c.html#a81">uentry_makeParam</a> (tmp, PARAMUNKNOWN);
00198   
00199   <a class="code" href="idDecl_c.html#a1">idDecl_free</a> (tmp);
00200 }
00201 
00202 <font class="keywordtype">void</font>
<a name="l00203"></a><a class="code" href="exprNode_c.html#a50">00203</a> <a class="code" href="exprNode_c.html#a50">exprNode_destroyMod</a> (<font class="keywordtype">void</font>) 
00204    <font class="comment">/*@globals killed regArg, killed outArg, killed outStringArg,</font>
00205 <font class="comment">              killed mustExitNode, initMod @*/</font>
00206 {
00207   <font class="keywordflow">if</font> (initMod)
00208     {
00209       <a class="code" href="uentry_c.html#a238">uentry_free</a> (regArg);
00210       <a class="code" href="uentry_c.html#a238">uentry_free</a> (outArg);
00211       <a class="code" href="uentry_c.html#a238">uentry_free</a> (outStringArg);
00212       
00213       <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (mustExitNode);
00214       initMod = FALSE;
00215     <font class="comment">/*@-branchstate@*/</font> 
00216     } 
00217   <font class="comment">/*@=branchstate@*/</font>
00218 }
00219 
00220 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_resetSref (<font class="comment">/*@notnull@*/</font> exprNode e)<font class="keyword"></font>
00221 <font class="keyword"></font>{
00222   e-&gt;sref = defref;
00223 }
00224 
00225 <font class="keyword">static</font> exprNode exprNode_fakeCopy (exprNode e)<font class="keyword"></font>
00226 <font class="keyword"></font>{
00227   <font class="comment">/*@-temptrans@*/</font> <font class="comment">/*@-retalias@*/</font>
00228   <font class="keywordflow">return</font> e;
00229   <font class="comment">/*@=temptrans@*/</font> <font class="comment">/*@=retalias@*/</font>
00230 }
00231 
00232 <font class="keyword">static</font> <font class="keywordtype">bool</font> isFlagKey (<font class="keywordtype">char</font> key)<font class="keyword"></font>
00233 <font class="keyword"></font>{
00234   <font class="keywordflow">return</font> (key == <font class="charliteral">'-'</font> || key == <font class="charliteral">'+'</font> || key == <font class="charliteral">' '</font> || key == <font class="charliteral">'#'</font>);
00235 }
00236 
00237 <font class="keyword">static</font> <font class="keywordtype">void</font> exprNode_combineControl (<font class="comment">/*@notnull@*/</font> exprNode ret,
00238                                      <font class="comment">/*@notnull@*/</font> exprNode ifclause,
00239                                      <font class="comment">/*@notnull@*/</font> exprNode elseclause)<font class="keyword"></font>
00240 <font class="keyword"></font>{
00241   ret-&gt;canBreak = ifclause-&gt;canBreak || elseclause-&gt;canBreak;
00242 
00243   ret-&gt;mustBreak =
00244     (ifclause-&gt;mustBreak || <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (ifclause))
00245       &amp;&amp; (elseclause-&gt;mustBreak || <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (elseclause));
00246 
00247   ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a25">exitkind_combine</a> (ifclause-&gt;exitCode,
00248                                     elseclause-&gt;exitCode);
00249 
00250 }
00251 
00252 <font class="comment">/*</font>
00253 <font class="comment">** For exprNode's returned by exprNode_effect.</font>
00254 <font class="comment">*/</font>
00255 
00256 <font class="keyword">static</font> <font class="keywordtype">bool</font> shallowKind (exprKind kind)<font class="keyword"></font>
00257 <font class="keyword"></font>{
00258   <font class="keywordflow">return</font> (kind == XPR_STRINGLITERAL
00259           || kind == XPR_NUMLIT
00260           || kind == XPR_EMPTY
00261           || kind == XPR_BODY
00262           || kind == XPR_NODE);
00263 }
00264 
00265 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00266 exprNode_freeIniter (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
00267 <font class="keyword"></font>{
00268   <font class="keywordflow">if</font> (!exprNode_isError (e))
00269     {
00270       <font class="keywordflow">switch</font> (e-&gt;kind)
00271         {
00272         <font class="keywordflow">case</font> XPR_FACCESS:
00273           <a class="code" href="general_c.html#a0">sfree</a> (e-&gt;edata-&gt;field);
00274           <a class="code" href="general_c.html#a0">sfree</a> (e-&gt;edata);
00275           <font class="keywordflow">break</font>;
00276         <font class="keywordflow">case</font> XPR_FETCH:
00277           <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (e-&gt;edata-&gt;op-&gt;b);
00278           <font class="comment">/*@-compdestroy@*/</font> <a class="code" href="general_c.html#a0">sfree</a> (e-&gt;edata-&gt;op); <font class="comment">/*@=compdestroy@*/</font>
00279           <a class="code" href="general_c.html#a0">sfree</a> (e-&gt;edata);
00280           <font class="keywordflow">break</font>;
00281         <font class="keywordflow">default</font>:
00282           llbug (message (<font class="stringliteral">"other: %s"</font>, exprNode_unparse (e)));
00283         }
00284 
00285       <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (e-&gt;val);
00286       <a class="code" href="cstring_c.html#a27">cstring_free</a> (e-&gt;etext);
00287       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;loc);
00288       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;uses);
00289       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;sets);
00290       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;msets);
00291       <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (e-&gt;guards);
00292       <a class="code" href="general_c.html#a0">sfree</a> (e);
00293     }
00294 }
00295 
00296 <font class="keywordtype">void</font> 
<a name="l00297"></a><a class="code" href="exprNode_c.html#a56">00297</a> <a class="code" href="exprNode_c.html#a56">exprNode_freeShallow</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
00298 <font class="keyword"></font>{
00299   <font class="keywordflow">if</font> (!exprNode_isError (e))
00300     {
00301       <font class="keywordflow">if</font> (shallowKind (e-&gt;kind))
00302         {
00303                 }
00304       <font class="keywordflow">else</font>
00305         {
00306           <font class="keywordflow">if</font> (!inEffect)
00307             {
00308               <font class="keywordflow">if</font> (e-&gt;kind == XPR_EMPTY
00309                   || e-&gt;kind == XPR_BODY
00310                   || e-&gt;kind == XPR_STRINGLITERAL
00311                   || e-&gt;kind == XPR_NUMLIT
00312                   || e-&gt;kind == XPR_NODE
00313                   || e-&gt;kind == XPR_OFFSETOF
00314                   || e-&gt;kind == XPR_ALIGNOFT
00315                   || e-&gt;kind == XPR_ALIGNOF
00316                   || e-&gt;kind == XPR_SIZEOFT
00317                   || e-&gt;kind == XPR_SIZEOF)
00318                 {
00319                   <font class="comment">/* don't free anything */</font>
00320                 }
00321               <font class="keywordflow">else</font>
00322                 {
00323                   <font class="comment">/* multiVal_free (e-&gt;val);  */</font>
00324                   <a class="code" href="cstring_c.html#a27">cstring_free</a> (e-&gt;etext);
00325                   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;loc);
00326                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;uses);
00327                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;sets);
00328                   <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;msets);
00329                   <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (e-&gt;guards);
00330                   exprData_freeShallow (e-&gt;edata, e-&gt;kind); 
00331                   nowalloc--;
00332                   <font class="comment">/*@-compdestroy@*/</font> <a class="code" href="general_c.html#a0">sfree</a> (e); <font class="comment">/*@=compdestroy@*/</font>
00333                   <font class="comment">/*@-branchstate@*/</font>
00334                 }
00335             }
00336         } <font class="comment">/*@=branchstate@*/</font>
00337     }
00338   }
00339 
00340 <font class="keywordtype">void</font>
<a name="l00341"></a><a class="code" href="exprNode_c.html#a57">00341</a> <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (exprNode e)<font class="keyword"></font>
00342 <font class="keyword"></font>{
00343   <font class="keywordflow">if</font> (!exprNode_isError (e))
00344     {
00345       <font class="keywordflow">if</font> (!inEffect)
00346         {
00347           <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (e-&gt;val);
00348           <a class="code" href="cstring_c.html#a27">cstring_free</a> (e-&gt;etext);
00349           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;loc);
00350           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;uses);
00351           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;sets);
00352           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (e-&gt;msets);
00353           <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (e-&gt;guards);
00354           exprData_free (e-&gt;edata, e-&gt;kind);
00355           
00356           nowalloc--;
00357           <a class="code" href="general_c.html#a0">sfree</a> (e);
00358           <font class="comment">/*@-branchstate@*/</font> 
00359         } <font class="comment">/*@=branchstate@*/</font>
00360     }
00361 }
00362 
00363 exprNode
<a name="l00364"></a><a class="code" href="exprNode_c.html#a58">00364</a> <a class="code" href="exprNode_c.html#a58">exprNode_makeError</a> ()<font class="keyword"></font>
00365 <font class="keyword"></font>{
00366   <font class="keywordflow">return</font> exprNode_undefined;
00367 }
00368 
00369 <font class="keyword">static</font> <font class="comment">/*@out@*/</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> exprNode
00370 exprNode_new (<font class="keywordtype">void</font>)<font class="keyword"></font>
00371 <font class="keyword"></font>{
00372   exprNode ret = (exprNode) dmalloc (<font class="keyword">sizeof</font> (*ret));
00373   <font class="comment">/* static int lastexpnodes = 0; */</font>
00374 
00375   nowalloc++;
00376   totalloc++;
00377 
00378   <font class="keywordflow">if</font> (nowalloc &gt; maxalloc)
00379     {
00380       maxalloc = nowalloc;
00381     }
00382 
00383   <font class="keywordflow">return</font> ret;
00384 }
00385 
00386 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00387   exprNode_createPlain (ctype c) 
00388   <font class="comment">/*@defines result@*/</font>
00389   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;loc, result-&gt;val, result-&gt;guards,</font>
00390 <font class="comment">                 result-&gt;uses, result-&gt;sets, result-&gt;msets, result-&gt;etext @*/</font>
00391   <font class="comment">/*@*/</font>
00392 {
00393   exprNode e = exprNode_new ();
00394 
00395   e-&gt;typ = c;
00396   e-&gt;kind = XPR_EMPTY;
00397   e-&gt;val = multiVal_undefined;
00398   e-&gt;sref = defref;
00399   e-&gt;etext = cstring_undefined;
00400   e-&gt;loc = fileloc_undefined;
00401   e-&gt;guards = guardSet_undefined;
00402   e-&gt;uses = sRefSet_undefined;
00403   e-&gt;sets = sRefSet_undefined;
00404   e-&gt;msets = sRefSet_undefined;
00405   e-&gt;edata = exprData_undefined;
00406   e-&gt;exitCode = XK_NEVERESCAPE;
00407   e-&gt;canBreak = FALSE;
00408   e-&gt;mustBreak = FALSE;
00409   e-&gt;isJumpPoint = FALSE;
00410   <font class="keywordflow">return</font> (e);
00411 }
00412 
<a name="l00413"></a><a class="code" href="exprNode_c.html#a61">00413</a> <font class="comment">/*@observer@*/</font> exprNode <a class="code" href="exprNode_c.html#a61">exprNode_makeMustExit</a> (<font class="keywordtype">void</font>)<font class="keyword"></font>
00414 <font class="keyword"></font>{
00415   <font class="keywordflow">if</font> (exprNode_isUndefined (mustExitNode))
00416     {
00417       mustExitNode = exprNode_createPlain (ctype_unknown);
00418       mustExitNode-&gt;exitCode = XK_MUSTEXIT;
00419     }
00420 
00421   <font class="keywordflow">return</font> mustExitNode;
00422 }
00423 
00424 
00425 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode exprNode_create (ctype c)
00426   <font class="comment">/*@defines result@*/</font>
00427   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;guards, result-&gt;val,</font>
00428 <font class="comment">                 result-&gt;uses, result-&gt;sets, result-&gt;msets@*/</font>
00429   <font class="comment">/*@*/</font>
00430 {
00431   exprNode e = exprNode_createPlain (c);
00432   e-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc);
00433   <font class="keywordflow">return</font> (e);
00434 }
00435 
00436 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode exprNode_createUnknown (<font class="keywordtype">void</font>)
00437   <font class="comment">/*@defines result@*/</font>
00438   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;guards,</font>
00439 <font class="comment">                 result-&gt;uses, result-&gt;sets, result-&gt;msets@*/</font>
00440   <font class="comment">/*@*/</font>
00441 {
00442   <font class="keywordflow">return</font> (exprNode_create (ctype_unknown));
00443 }
00444 
00445 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00446   exprNode_createLoc (ctype c, <font class="comment">/*@keep@*/</font> fileloc loc)
00447   <font class="comment">/*@defines result@*/</font>
00448   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;guards, result-&gt;val,</font>
00449 <font class="comment">                 result-&gt;uses, result-&gt;sets, result-&gt;msets@*/</font>
00450   <font class="comment">/*@*/</font>
00451 {
00452   exprNode e = exprNode_createPlain (c);
00453   e-&gt;loc = loc;
00454   <font class="keywordflow">return</font> (e);
00455 }
00456 
00457 <font class="keyword">static</font> <font class="keywordtype">void</font> 
00458   exprNode_copySets (<font class="comment">/*@special@*/</font> <font class="comment">/*@notnull@*/</font> exprNode ret, exprNode e)
00459   <font class="comment">/*@defines ret-&gt;guards, ret-&gt;uses, ret-&gt;sets, ret-&gt;msets@*/</font>
00460 {
00461   <font class="keywordflow">if</font> (exprNode_isDefined (e))
00462     {
00463       ret-&gt;guards = <a class="code" href="guardSet_c.html#a12">guardSet_copy</a> (e-&gt;guards);
00464       ret-&gt;uses = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;uses);
00465       ret-&gt;sets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;sets);
00466       ret-&gt;msets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;msets); 
00467     }
00468   <font class="keywordflow">else</font>
00469     {
00470       ret-&gt;guards = guardSet_undefined;
00471       ret-&gt;uses = sRefSet_undefined;
00472       ret-&gt;sets = sRefSet_undefined;
00473       ret-&gt;msets = sRefSet_undefined;
00474     }
00475 }
00476 
00477 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00478   exprNode_createPartialLocCopy (exprNode e, <font class="comment">/*@only@*/</font> fileloc loc)
00479   <font class="comment">/*@defines result@*/</font>
00480   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;etext@*/</font>
00481   <font class="comment">/*@*/</font>
00482 {
00483   exprNode ret = exprNode_new ();
00484 
00485   <font class="keywordflow">if</font> (exprNode_isError (e))
00486     {
00487       ret-&gt;typ = ctype_unknown;
00488       ret-&gt;val = multiVal_undefined;
00489       ret-&gt;loc = loc;
00490       ret-&gt;guards = guardSet_undefined;
00491       ret-&gt;uses = sRefSet_undefined;
00492       ret-&gt;sets = sRefSet_undefined;
00493       ret-&gt;msets = sRefSet_undefined;
00494     }
00495   <font class="keywordflow">else</font>
00496     {
00497       ret-&gt;typ = e-&gt;typ;
00498       ret-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (e-&gt;val);
00499       ret-&gt;loc = loc;
00500       ret-&gt;guards = <a class="code" href="guardSet_c.html#a12">guardSet_copy</a> (e-&gt;guards);
00501       ret-&gt;uses = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;uses);
00502       ret-&gt;sets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;sets);
00503       ret-&gt;msets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;msets); 
00504     }
00505 
00506   ret-&gt;kind = XPR_EMPTY;
00507   ret-&gt;sref = defref;
00508   ret-&gt;etext = cstring_undefined;
00509   ret-&gt;exitCode = XK_NEVERESCAPE;
00510   ret-&gt;canBreak = FALSE;
00511   ret-&gt;mustBreak = FALSE;
00512   ret-&gt;isJumpPoint = FALSE;
00513   ret-&gt;edata = exprData_undefined;
00514 
00515   <font class="keywordflow">return</font> (ret);
00516 }
00517 
00518 
00519 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00520   exprNode_createPartialCopy (exprNode e)
00521   <font class="comment">/*@defines result@*/</font>
00522   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;etext@*/</font>
00523   <font class="comment">/*@*/</font>
00524 {
00525   <font class="keywordflow">return</font> (exprNode_createPartialLocCopy (e, fileloc_copy (exprNode_loc (e))));
00526 }
00527 
00528 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00529   exprNode_createPartialNVCopy (exprNode e)
00530   <font class="comment">/*@defines result@*/</font>
00531   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;etext, result-&gt;val @*/</font>
00532   <font class="comment">/*@*/</font>
00533 {
00534   exprNode ret = exprNode_new ();
00535 
00536   <font class="keywordflow">if</font> (exprNode_isError (e))
00537     {
00538       ret-&gt;typ = ctype_unknown;
00539       ret-&gt;loc = fileloc_undefined;
00540       ret-&gt;guards = guardSet_undefined;
00541       ret-&gt;uses = sRefSet_undefined;
00542       ret-&gt;sets = sRefSet_undefined;
00543       ret-&gt;msets = sRefSet_undefined;
00544     }
00545   <font class="keywordflow">else</font>
00546     {
00547       ret-&gt;typ = e-&gt;typ;
00548       ret-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;loc);
00549       ret-&gt;guards = <a class="code" href="guardSet_c.html#a12">guardSet_copy</a> (e-&gt;guards);
00550       ret-&gt;uses = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;uses);
00551       ret-&gt;sets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;sets);
00552       ret-&gt;msets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (e-&gt;msets); 
00553     }
00554   
00555   ret-&gt;val = multiVal_undefined;
00556   ret-&gt;kind = XPR_EMPTY;
00557   ret-&gt;sref = defref;
00558   ret-&gt;etext = cstring_undefined;
00559   ret-&gt;exitCode = XK_NEVERESCAPE;
00560   ret-&gt;canBreak = FALSE;
00561   ret-&gt;mustBreak = FALSE;
00562   ret-&gt;isJumpPoint = FALSE;
00563   ret-&gt;edata = exprData_undefined;
00564 
00565   <font class="keywordflow">return</font> (ret);
00566 }
00567 
00568 <font class="keyword">static</font> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@special@*/</font> exprNode
00569   exprNode_createSemiCopy (exprNode e)
00570   <font class="comment">/*@defines result@*/</font>
00571   <font class="comment">/*@post:isnull result-&gt;edata, result-&gt;etext, result-&gt;sets,</font>
00572 <font class="comment">                 result-&gt;msets, result-&gt;uses, result-&gt;guards@*/</font>
00573   <font class="comment">/*@*/</font>
00574 {
00575   <font class="keywordflow">if</font> (exprNode_isError (e))
00576     {
00577       <font class="keywordflow">return</font> exprNode_createPlain (ctype_unknown);
00578     }
00579   <font class="keywordflow">else</font>
00580     {
00581       exprNode ret = exprNode_new ();
00582 
00583       ret-&gt;typ = e-&gt;typ;
00584       ret-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (e-&gt;val);
00585       ret-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;loc);
00586       ret-&gt;guards = guardSet_undefined;
00587       ret-&gt;uses = sRefSet_undefined;
00588       ret-&gt;sets = sRefSet_undefined;
00589       ret-&gt;msets = sRefSet_undefined;
00590 
00591       ret-&gt;kind = XPR_EMPTY;
00592       ret-&gt;sref = defref;
00593       ret-&gt;etext = cstring_undefined;
00594       ret-&gt;exitCode = XK_NEVERESCAPE;
00595       ret-&gt;canBreak = FALSE;
00596       ret-&gt;mustBreak = FALSE;
00597       ret-&gt;isJumpPoint = FALSE;
00598       ret-&gt;edata = exprData_undefined;
00599       
00600       <font class="keywordflow">return</font> (ret);
00601     }
00602 }
00603 
00604 <font class="keywordtype">bool</font>
<a name="l00605"></a><a class="code" href="exprNode_c.html#a70">00605</a> <a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (exprNode e)<font class="keyword"></font>
00606 <font class="keyword"></font>{
00607   <font class="keywordflow">if</font> (exprNode_isDefined (e))
00608     {
00609       multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (e);
00610       
00611       <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m))
00612         {
00613           <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m) == 0);
00614         }
00615     }
00616   
00617   <font class="keywordflow">return</font> FALSE;
00618 }
00619 
00620 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00621 exprNode_isUnknownConstant (<font class="comment">/*@notnull@*/</font> exprNode e)<font class="keyword"></font>
00622 <font class="keyword"></font>{
00623   <font class="keywordflow">while</font> (e-&gt;kind == XPR_PARENS)
00624     {
00625       e = exprData_getUopNode (e-&gt;edata);
00626       llassert (exprNode_isDefined (e));
00627     }
00628 
00629   <font class="keywordflow">if</font> (e-&gt;kind == XPR_CONST)
00630     {
00631       multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (e);
00632 
00633       <font class="keywordflow">if</font> (multiVal_isUnknown (m)) 
00634         {
00635           <font class="keywordflow">return</font> TRUE;
00636         }
00637     }
00638   
00639   <font class="keywordflow">return</font> FALSE;
00640 }
00641 
00642 <font class="comment">/*@only@*/</font> exprNode
<a name="l00643"></a><a class="code" href="exprNode_c.html#a72">00643</a>   <a class="code" href="exprNode_c.html#a72">exprNode_numLiteral</a> (ctype c, <font class="comment">/*@temp@*/</font> cstring t, 
00644                        <font class="comment">/*@only@*/</font> fileloc loc, <font class="keywordtype">long</font> val)<font class="keyword"></font>
00645 <font class="keyword"></font>{
00646   exprNode e = exprNode_createLoc (c, loc);
00647 
00648   e-&gt;kind = XPR_NUMLIT;
00649   
00650   llassert (multiVal_isUndefined (e-&gt;val));
00651   e-&gt;val = <a class="code" href="multiVal_c.html#a2">multiVal_makeInt</a> (val);
00652   e-&gt;edata = exprData_makeLiteral (cstring_copy (t));
00653 
00654   <font class="keywordflow">if</font> (val == 0)
00655     {
00656       e-&gt;sref = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> ();
00657       <a class="code" href="sRef_c.html#a217">sRef_setDefNull</a> (e-&gt;sref, e-&gt;loc);
00658     }
00659 
00660   DPRINTF ((<font class="stringliteral">"Num lit: %s / %s"</font>, exprNode_unparse (e), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (exprNode_getType (e))));
00661   <font class="keywordflow">return</font> (e);
00662 }
00663 
00664 <font class="comment">/*@only@*/</font> exprNode
<a name="l00665"></a><a class="code" href="exprNode_c.html#a73">00665</a> <a class="code" href="exprNode_c.html#a73">exprNode_charLiteral</a> (<font class="keywordtype">char</font> c, cstring text, <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
00666 <font class="keyword"></font>{
00667   exprNode e = exprNode_createLoc (ctype_char, loc);
00668 
00669   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_CHARINTLITERAL))
00670     {
00671       e-&gt;typ = <a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (ctype_char, ctype_int);
00672     }
00673 
00674   e-&gt;kind = XPR_NUMLIT;
00675   e-&gt;val = <a class="code" href="multiVal_c.html#a3">multiVal_makeChar</a> (c);
00676 
00677   e-&gt;edata = exprData_makeLiteral (cstring_copy (text));
00678   <font class="keywordflow">return</font> (e);
00679 }
00680 
00681 <font class="comment">/*@only@*/</font> exprNode
<a name="l00682"></a><a class="code" href="exprNode_c.html#a74">00682</a> <a class="code" href="exprNode_c.html#a74">exprNode_floatLiteral</a> (<font class="keywordtype">double</font> d, ctype ct, cstring text, <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
00683 <font class="keyword"></font>{
00684   exprNode e = exprNode_createLoc (ct, loc);
00685 
00686   e-&gt;kind = XPR_NUMLIT;
00687     e-&gt;val = <a class="code" href="multiVal_c.html#a4">multiVal_makeDouble</a> (d);
00688   e-&gt;edata = exprData_makeLiteral (cstring_copy (text));
00689   <font class="keywordflow">return</font> (e);
00690 }
00691 
<a name="l00692"></a><a class="code" href="exprNode_c.html#a75">00692</a> multiVal <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (exprNode e)<font class="keyword"> </font>
00693 <font class="keyword"></font>{
00694   <font class="keywordflow">while</font> (exprNode_isInParens (e)) {
00695     <font class="keywordflow">if</font> (e-&gt;edata != NULL) {
00696       e = exprData_getUopNode (e-&gt;edata);
00697     } <font class="keywordflow">else</font> {
00698       <font class="keywordflow">break</font>;
00699     }
00700   }
00701 
00702   <font class="keywordflow">if</font> (exprNode_isDefined (e)) {
00703     <font class="keywordflow">return</font> e-&gt;val; 
00704   } <font class="keywordflow">else</font> {
00705     <font class="keywordflow">return</font> multiVal_undefined;
00706   }
00707 }
00708 
00709 <font class="comment">/*@only@*/</font> exprNode
<a name="l00710"></a><a class="code" href="exprNode_c.html#a76">00710</a> <a class="code" href="exprNode_c.html#a76">exprNode_stringLiteral</a> (<font class="comment">/*@only@*/</font> cstring t, <font class="comment">/*@only@*/</font> fileloc loc)<font class="keyword"></font>
00711 <font class="keyword"></font>{
00712   exprNode e = exprNode_createLoc (ctype_string, loc);
00713   <font class="keywordtype">int</font> len = <a class="code" href="cstring_c.html#a30">cstring_length</a> (t) - 2;
00714   <font class="keywordtype">char</font> *ts = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (t);
00715   <font class="keywordtype">char</font> *s = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (cstring_create (len + 1));
00716 
00717   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_STRINGLITERALLEN))
00718     {
00719       <font class="keywordflow">if</font> (len &gt; <a class="code" href="context_c.html#a151">context_getValue</a> (FLG_STRINGLITERALLEN))
00720         {
00721           voptgenerror (FLG_STRINGLITERALLEN,
00722                         message
00723                         (<font class="stringliteral">"String literal length (%d) exceeds maximum "</font>
00724                          <font class="stringliteral">"length (%d): %s"</font>,
00725                          len,
00726                          context_getValue (FLG_STRINGLITERALLEN),
00727                          t),
00728                         e-&gt;loc);
00729         }
00730     }
00731 
00732   strncpy (s, ts+1, size_fromInt (len));
00733   *(s + len) = <font class="charliteral">'\0'</font>;
00734 
00735   
00736   e-&gt;kind = XPR_STRINGLITERAL;
00737   e-&gt;val = <a class="code" href="multiVal_c.html#a5">multiVal_makeString</a> (cstring_fromCharsO (s));
00738   e-&gt;edata = exprData_makeLiteral (t);
00739   e-&gt;sref = <a class="code" href="sRef_c.html#a285">sRef_makeType</a> (ctype_string);
00740 
00741   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_READONLYSTRINGS))
00742     {
00743       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_STATIC, fileloc_undefined);
00744       <a class="code" href="sRef_c.html#a194">sRef_setExKind</a> (e-&gt;sref, XO_OBSERVER, loc);
00745     }
00746   <font class="keywordflow">else</font>
00747     {
00748       <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_ERROR, fileloc_undefined);
00749     }
00750 
00751   <font class="keywordflow">return</font> (e); <font class="comment">/* s released */</font>
00752 }
00753 
<a name="l00754"></a><a class="code" href="exprNode_c.html#a77">00754</a> exprNode <a class="code" href="exprNode_c.html#a77">exprNode_fromUIO</a> (cstring c)<font class="keyword"></font>
00755 <font class="keyword"></font>{
00756   fileloc loc = <a class="code" href="context_c.html#a183">context_getSaveLocation</a> ();
00757   exprNode e  = exprNode_createPlain (ctype_unknown);
00758 
00759   e-&gt;kind = XPR_VAR;
00760 
00761   <font class="keywordflow">if</font> (fileloc_isUndefined (loc))
00762     {
00763       loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc);
00764     }
00765 
00766   e-&gt;loc = loc; <font class="comment">/* save loc was mangled */</font>
00767   e-&gt;sref = defref;
00768 
00769   <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a124">usymtab_exists</a> (c))
00770     {
00771       uentry ue = <a class="code" href="usymtab_c.html#a118">usymtab_lookupEither</a> (c);
00772 
00773       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a163">uentry_isDatatype</a> (ue) 
00774           &amp;&amp; <a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (ue))
00775         {
00776           llfatalerror
00777             (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q: Specified datatype %s used in code, but not defined. "</font>
00778                       <font class="stringliteral">"(Cannot continue reasonably from this error.)"</font>,
00779                       fileloc_unparse (e-&gt;loc), c));
00780         }
00781       <font class="keywordflow">else</font>
00782         {
00783           BADBRANCH; 
00784         }
00785     }
00786   
00787   llassertprint (!usymtab_exists (c), (<font class="stringliteral">"Entry exists: %s"</font>, c));
00788 
00789   <font class="comment">/*</font>
00790 <font class="comment">  ** was supercedeGlobalEntry...is this better?</font>
00791 <font class="comment">  */</font>
00792 
00793   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a237">context_inIterEnd</a> ())
00794     {
00795       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ())
00796         {
00797           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNRECOG))
00798             {
00799               voptgenerror 
00800                 (FLG_MACROUNDEF, 
00801                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized identifier in macro definition: %s"</font>, c), e-&gt;loc);
00802             }
00803           <font class="keywordflow">else</font>
00804             {
00805               <a class="code" href="flags_c.html#a23">flagcode_recordSuppressed</a> (FLG_UNRECOG);
00806             }
00807         }
00808       <font class="keywordflow">else</font>
00809         {
00810           voptgenerror 
00811             (FLG_UNRECOG, <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized identifier: %s"</font>, c),
00812              e-&gt;loc);
00813         }
00814     }
00815   
00816   e-&gt;edata = exprData_makeId (uentry_makeUnrecognized (c, fileloc_copy (loc)));
00817 
00818   <font class="comment">/* No alias errors for unrecognized identifiers */</font>
00819   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_ERROR, loc); 
00820 
00821   <font class="keywordflow">return</font> (e);
00822 }
00823 
<a name="l00824"></a><a class="code" href="exprNode_c.html#a78">00824</a> exprNode <a class="code" href="exprNode_c.html#a78">exprNode_createId</a> (<font class="comment">/*@observer@*/</font> uentry c)<font class="keyword"></font>
00825 <font class="keyword"></font>{
00826   <font class="keywordflow">if</font> (uentry_isValid (c))
00827     {
00828       exprNode e = exprNode_new ();
00829       
00830       e-&gt;typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (c);
00831 
00832       <font class="keywordflow">if</font> (uentry_isFunction (c)
00833           &amp;&amp; !<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (uentry_getSref (c)))
00834         {
00835           e-&gt;sref = sRef_undefined;
00836         }
00837       <font class="keywordflow">else</font>
00838         {
00839           e-&gt;sref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (c); 
00840         }
00841 
00842       <font class="keywordflow">if</font> (sRef_isStateUnknown (e-&gt;sref) &amp;&amp; <a class="code" href="uentry_c.html#a71">uentry_isNonLocal</a> (c))
00843         {
00844           <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (e-&gt;sref, fileloc_undefined);
00845         }
00846       
00847       <font class="comment">/*</font>
00848 <font class="comment">      ** yoikes!  leaving this out was a heinous bug...that would have been</font>
00849 <font class="comment">      ** caught if i had lclint working first.  gag!</font>
00850 <font class="comment">      */</font>
00851       
00852       e-&gt;etext = cstring_undefined;
00853       
00854       <font class="keywordflow">if</font> (uentry_isEitherConstant (c))
00855         {
00856           e-&gt;kind = XPR_CONST;
00857           e-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (uentry_getConstantValue (c));
00858         }
00859       <font class="keywordflow">else</font>
00860         {
00861           e-&gt;kind = XPR_VAR;
00862           e-&gt;val = <a class="code" href="multiVal_c.html#a0">multiVal_unknown</a> ();
00863         }
00864       
00865       e-&gt;edata = exprData_makeId (c);
00866       e-&gt;loc = <a class="code" href="context_c.html#a183">context_getSaveLocation</a> ();
00867       
00868       <font class="keywordflow">if</font> (fileloc_isUndefined (e-&gt;loc))
00869         {
00870           <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;loc);
00871           e-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc);
00872         }
00873 
00874       e-&gt;guards = <a class="code" href="guardSet_c.html#a0">guardSet_new</a> ();
00875       e-&gt;sets = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
00876       e-&gt;msets = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
00877       e-&gt;uses = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
00878       
00879       <font class="comment">/*&gt; missing fields, detected by lclint &lt;*/</font>
00880       e-&gt;exitCode = XK_NEVERESCAPE;
00881       e-&gt;isJumpPoint = FALSE;
00882       e-&gt;canBreak = FALSE;
00883       e-&gt;mustBreak = FALSE;
00884       
00885       <font class="keywordflow">return</font> e;
00886     }
00887   <font class="keywordflow">else</font>
00888     {
00889             <font class="keywordflow">return</font> exprNode_createUnknown ();
00890     }
00891 }
00892 
00893 <font class="comment">/*@notnull@*/</font> exprNode
<a name="l00894"></a><a class="code" href="exprNode_c.html#a79">00894</a> <a class="code" href="exprNode_c.html#a79">exprNode_fromIdentifier</a> (<font class="comment">/*@observer@*/</font> uentry c)<font class="keyword"></font>
00895 <font class="keyword"></font>{
00896   exprNode ret;
00897 
00898   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a252">context_justPopped</a> ()) <font class="comment">/* watch out! c could be dead */</font>
00899     { 
00900       uentry ce = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (LastIdentifier ());
00901 
00902       <font class="keywordflow">if</font> (uentry_isValid (ce)) 
00903         {
00904           c = ce;
00905         }
00906       <font class="keywordflow">else</font>
00907         {
00908           llbuglit (<font class="stringliteral">"Looks like Aunt Millie forgot to walk to dog again."</font>);
00909         }
00910     }
00911 
00912   ret = exprNode_fromIdentifierAux (c);
00913   
00914   <font class="keywordflow">return</font> ret;
00915 }
00916 
00917 
00918 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> exprNode
00919 exprNode_fromIdentifierAux (<font class="comment">/*@observer@*/</font> uentry c)<font class="keyword"></font>
00920 <font class="keyword"></font>{
00921   exprNode e = <a class="code" href="exprNode_c.html#a78">exprNode_createId</a> (c);
00922   sRef sr = e-&gt;sref;
00923 
00924   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (c, e-&gt;loc);
00925 
00926   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (c) &amp;&amp; <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sr))
00927     {
00928       checkGlobUse (c, FALSE, e);
00929     }
00930 
00931   <font class="keywordflow">return</font> (e);
00932 }
00933 
00934 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00935 exprNode_isZero (exprNode e)<font class="keyword"></font>
00936 <font class="keyword"></font>{
00937   <font class="keywordflow">if</font> (exprNode_isDefined (e))
00938     {
00939       multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (e);
00940       
00941       <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m))
00942         {
00943           <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m) == 0);
00944         }
00945     }
00946 
00947   <font class="keywordflow">return</font> FALSE;
00948 }
00949 
00950 <font class="keyword">static</font> <font class="keywordtype">bool</font>
00951 exprNode_isNonNegative (exprNode e)<font class="keyword"></font>
00952 <font class="keyword"></font>{
00953   <font class="keywordflow">if</font> (exprNode_isDefined (e))
00954     {
00955       multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (e);
00956       
00957       <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m))
00958         {
00959           <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m) &gt;= 0);
00960         }
00961     }
00962 
00963   <font class="keywordflow">return</font> FALSE;
00964 }
00965 
00966 <font class="comment">/*</font>
00967 <font class="comment">** a[x]  - uses a but NOT a[] </font>
00968 <font class="comment">**         result sref = a[]  (set/use in assignment)</font>
00969 <font class="comment">** </font>
00970 <font class="comment">** The syntax x[a] is also legal in C, and has the same </font>
00971 <font class="comment">** semantics.  If ind is an array, and arr is an int, flip</font>
00972 <font class="comment">** the arguments.</font>
00973 <font class="comment">*/</font>
00974 
00975 <font class="comment">/*@only@*/</font> exprNode
<a name="l00976"></a><a class="code" href="exprNode_c.html#a82">00976</a> <a class="code" href="exprNode_c.html#a82">exprNode_arrayFetch</a> (<font class="comment">/*@only@*/</font> exprNode e1, <font class="comment">/*@only@*/</font> exprNode e2)<font class="keyword"></font>
00977 <font class="keyword"></font>{
00978   <font class="comment">/*</font>
00979 <font class="comment">  ** error in arr, error propagates (no new messages)</font>
00980 <font class="comment">  ** error in ind, assume valid and continue</font>
00981 <font class="comment">  */</font>
00982 
00983   <font class="keywordflow">if</font> (exprNode_isError (e1))
00984     {
00985       <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (e2);
00986       <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a58">exprNode_makeError</a> ());
00987     }
00988   <font class="keywordflow">else</font>
00989     {
00990       exprNode arr;
00991       exprNode ind;
00992       ctype carr = exprNode_getType (e1);
00993       ctype crarr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (carr);
00994  
00995       <font class="comment">/*</font>
00996 <font class="comment">      ** this sets up funny aliasing, that leads to spurious</font>
00997 <font class="comment">      ** lclint errors.  Hence, the i2 comments.</font>
00998 <font class="comment">      */</font>
00999 
01000       <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (crarr) 
01001           &amp;&amp; <a class="code" href="ctype_c.html#a69">ctype_isRealNumeric</a> (crarr) 
01002           &amp;&amp; !exprNode_isError (e2)
01003           &amp;&amp; <a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (exprNode_getType (e2)))  <font class="comment">/* fetch like 3[a] */</font>
01004         {
01005           arr = e2;
01006           ind = e1;
01007 
01008           carr = exprNode_getType (arr);
01009           crarr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (carr);
01010         }
01011       <font class="keywordflow">else</font>
01012         {
01013           arr = e1;
01014           ind = e2;
01015         }
01016 
01017       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (arr-&gt;sref))
01018         {
01019           <font class="keywordflow">if</font> (!<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (arr-&gt;sref))
01020             {
01021               <font class="keywordflow">if</font> (optgenerror (FLG_NULLDEREF,
01022                                message (<font class="stringliteral">"Index of %s pointer %q: %s"</font>, 
01023                                         sRef_nullMessage (arr-&gt;sref),
01024                                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (arr-&gt;sref),
01025                                         <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (arr)),
01026                                arr-&gt;loc))
01027                 {
01028                   <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (arr-&gt;sref);
01029 
01030                   <font class="comment">/* suppress future messages */</font>
01031                   <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (arr-&gt;sref); 
01032                 }
01033             }
01034         }
01035 
01036       <font class="keywordflow">if</font> (exprNode_isError (ind))
01037         {
01038           <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (crarr) 
01039                &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (crarr))
01040               || ctype_isUnknown (carr))
01041             {
01042               exprNode ret = exprNode_createPartialCopy (arr);
01043 
01044               <font class="keywordflow">if</font> (ctype_isKnown (carr))
01045                 {
01046                   ret-&gt;typ = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (crarr);
01047                 }
01048               <font class="keywordflow">else</font>
01049                 {
01050                   ret-&gt;typ = ctype_unknown;
01051                 }
01052               
01053               ret-&gt;sref = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (arr-&gt;sref);
01054               
01055               ret-&gt;kind = XPR_FETCH;
01056 
01057               <font class="comment">/*</font>
01058 <font class="comment">              ** Because of funny aliasing (when arr and ind are</font>
01059 <font class="comment">              ** flipped) spurious errors would be reported here.</font>
01060 <font class="comment">              */</font>
01061          
01062               <font class="comment">/*@i2@*/</font> ret-&gt;edata = exprData_makePair (arr, ind);             
01063               checkSafeUse (ret, arr-&gt;sref);
01064               <font class="keywordflow">return</font> (ret);
01065             }
01066           <font class="keywordflow">else</font>
01067             {
01068               voptgenerror (FLG_TYPE,
01069                             message (<font class="stringliteral">"Array fetch from non-array (%t): %s[%s]"</font>, carr, 
01070                                      exprNode_unparse (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
01071                             arr-&gt;loc);
01072               <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (arr);
01073               <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a58">exprNode_makeError</a> ());
01074             }
01075         }
01076       <font class="keywordflow">else</font>
01077         {
01078           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a81">ctype_isForceRealInt</a> (&amp;(ind-&gt;typ)))
01079             {
01080               ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ind-&gt;typ);
01081 
01082               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a58">ctype_isChar</a> (rt))
01083                 {
01084                   vnoptgenerror
01085                     (FLG_CHARINDEX,
01086                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Array fetch using non-integer, %t: %s[%s]"</font>,
01087                               ind-&gt;typ, 
01088                               exprNode_unparse (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
01089                      arr-&gt;loc);
01090                 }
01091               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (rt))
01092                 {
01093                   vnoptgenerror
01094                     (FLG_ENUMINDEX,
01095                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Array fetch using non-integer, %t: %s[%s]"</font>,
01096                               ind-&gt;typ, 
01097                               exprNode_unparse (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
01098                      arr-&gt;loc);
01099                 }
01100               <font class="keywordflow">else</font>
01101                 {
01102                   voptgenerror 
01103                     (FLG_TYPE,
01104                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Array fetch using non-integer, %t: %s[%s]"</font>,
01105                               ind-&gt;typ, 
01106                               exprNode_unparse (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
01107                      arr-&gt;loc);
01108                 }
01109 
01110               <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (ind-&gt;val);
01111               ind-&gt;val = <a class="code" href="multiVal_c.html#a0">multiVal_unknown</a> ();
01112             }
01113           
01114           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (crarr) &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (crarr))
01115             {
01116               exprNode ret = exprNode_createSemiCopy (arr);
01117               multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (ind);
01118               
01119               ret-&gt;typ = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (crarr);
01120               ret-&gt;kind = XPR_FETCH;
01121               
01122               <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m))
01123                 {
01124                   <font class="keywordtype">int</font> i = (<font class="keywordtype">int</font>) <a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m);
01125                   
01126                   <font class="keywordflow">if</font> (sRef_isValid (arr-&gt;sref)) {
01127                     ret-&gt;sref = <a class="code" href="sRef_c.html#a278">sRef_makeArrayFetchKnown</a> (arr-&gt;sref, i);
01128                   } <font class="keywordflow">else</font> {
01129                     ret-&gt;sref = sRef_undefined;
01130                   }
01131                 }
01132               <font class="keywordflow">else</font>
01133                 {
01134                                   ret-&gt;sref = <a class="code" href="sRef_c.html#a277">sRef_makeArrayFetch</a> (arr-&gt;sref);
01135                 }
01136               
01137               ret-&gt;sets = <a class="code" href="sRefSet_c.html#a14">sRefSet_realNewUnion</a> (arr-&gt;sets, ind-&gt;sets);
01138               ret-&gt;msets = <a class="code" href="sRefSet_c.html#a14">sRefSet_realNewUnion</a> (arr-&gt;msets, ind-&gt;msets);
01139               ret-&gt;uses = <a class="code" href="sRefSet_c.html#a14">sRefSet_realNewUnion</a> (arr-&gt;uses, ind-&gt;uses);
01140               
01141               <font class="comment">/* (see comment on spurious errors above) */</font>
01142               <font class="comment">/*@i2@*/</font> ret-&gt;edata = exprData_makePair (arr, ind);
01143               
01144               exprNode_checkUse (ret, ind-&gt;sref, ind-&gt;loc);
01145               exprNode_checkUse (ret, arr-&gt;sref, arr-&gt;loc);
01146               
01147               <font class="keywordflow">return</font> (ret);
01148             }
01149           <font class="keywordflow">else</font>
01150             {
01151               <font class="keywordflow">if</font> (ctype_isUnknown (carr))
01152                 {
01153                   exprNode ret = exprNode_createPartialCopy (arr);
01154                   
01155                   ret-&gt;kind = XPR_FETCH;
01156                   ret-&gt;typ = ctype_unknown;
01157                   ret-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;sets, ind-&gt;sets);
01158                   ret-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;msets, ind-&gt;msets);
01159                   ret-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;uses, ind-&gt;uses);
01160 
01161                   <font class="comment">/* (see comment on spurious errors above) */</font>            
01162                   <font class="comment">/*@i2@*/</font> ret-&gt;edata = exprData_makePair (arr, ind);
01163                   
01164                   exprNode_checkUse (ret, ind-&gt;sref, ind-&gt;loc);
01165                   exprNode_checkUse (ret, arr-&gt;sref, arr-&gt;loc);
01166                   <font class="keywordflow">return</font> (ret);
01167                 }
01168               <font class="keywordflow">else</font>
01169                 {
01170                   voptgenerror
01171                     (FLG_TYPE,
01172                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Array fetch from non-array (%t): %s[%s]"</font>, carr, 
01173                               exprNode_unparse (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
01174                      arr-&gt;loc);
01175 
01176                   <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (arr);
01177                   <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (ind);
01178 
01179                   <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a58">exprNode_makeError</a> ());
01180                 }
01181             }
01182         }
01183     }
01184   BADEXIT;
01185 }
01186 
01187 
01188 <font class="keyword">static</font> <font class="keywordtype">int</font>
01189 checkArgs (uentry fcn, <font class="comment">/*@dependent@*/</font> exprNode f, ctype t, 
01190            exprNodeList args, exprNode ret)<font class="keyword"></font>
01191 <font class="keyword"></font>{
01192   <font class="keywordflow">return</font> (checkArgsReal (fcn, f, ctype_argsFunction (t), args, FALSE, ret));
01193 }
01194 
01195 <font class="comment">/*</font>
01196 <font class="comment">** checkPrintfArgs --- checks arguments for printf-like functions</font>
01197 <font class="comment">**    Arguments before ... have already been checked.</font>
01198 <font class="comment">**    The argument before the ... is a char *.  </font>
01199 <font class="comment">**    argno is the format string argument.</font>
01200 <font class="comment">*/</font>
01201 
01202 <font class="keyword">static</font> <font class="keywordtype">void</font>
01203 checkPrintfArgs (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode f, uentry fcn, 
01204                  exprNodeList args, exprNode ret, <font class="keywordtype">int</font> argno)<font class="keyword"></font>
01205 <font class="keyword"></font>{
01206   <font class="comment">/*</font>
01207 <font class="comment">  ** the last argument before the elips is the format string </font>
01208 <font class="comment">  */</font>
01209 
01210   <font class="keywordtype">int</font> i = argno;
01211   fileloc formatloc;
01212   <font class="keywordtype">int</font> nargs = exprNodeList_size (args);
01213   uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (fcn);
01214   exprNode a; 
01215 
01216   <font class="comment">/*</font>
01217 <font class="comment">  ** These should be ensured by checkSpecialFunction</font>
01218 <font class="comment">  */</font>
01219 
01220   llassert (uentryList_size (params) == argno + 1);
01221   llassert (uentry_isElipsisMarker (uentryList_getN (params, argno)));
01222 
01223   a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, argno - 1);
01224   formatloc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (exprNode_loc (a));
01225 
01226   <font class="keywordflow">if</font> (exprNode_isDefined (a) &amp;&amp; exprNode_isStringLiteral (a) 
01227       &amp;&amp; exprNode_knownStringValue (a))
01228     {
01229       <font class="keywordtype">char</font> *format = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (multiVal_forceString (exprNode_getValue (a)));
01230       <font class="keywordtype">char</font> *code = format;
01231       <font class="keywordtype">char</font> *ocode = code;
01232 
01233       nargs = exprNodeList_size (args);
01234 
01235       <font class="keywordflow">while</font> ((code = strchr (code, <font class="charliteral">'%'</font>)) != NULL)
01236         {
01237           <font class="keywordtype">char</font> *origcode = code;
01238           <font class="keywordtype">char</font> key = *(++code);                 
01239           ctype modtype = ctype_int;
01240           <font class="keywordtype">bool</font> modified = FALSE;
01241 
01242           fileloc_addColumn (formatloc, code - ocode);
01243 
01244           <font class="comment">/* ignore flags */</font>
01245           <font class="keywordflow">while</font> (isFlagKey (key)) 
01246             {
01247               key = *(++code);
01248               fileloc_incColumn (formatloc);
01249             }
01250 
01251           <font class="keywordflow">if</font> (key == <font class="charliteral">'m'</font>) <font class="comment">/* skipped in syslog */</font>
01252             {
01253               <font class="keywordflow">continue</font>; 
01254             }
01255           
01256           <font class="comment">/* ignore field width */</font>
01257           <font class="keywordflow">while</font> (isdigit ((<font class="keywordtype">int</font>) key) != 0) 
01258             {
01259               key = *(++code);
01260               fileloc_incColumn (formatloc);
01261             }
01262           
01263           <font class="comment">/* ignore precision */</font>
01264           <font class="keywordflow">if</font> (key == <font class="charliteral">'.'</font>)
01265             {
01266               key = *(++code);
01267               fileloc_incColumn (formatloc);
01268 
01269               <font class="comment">/*</font>
01270 <font class="comment">              ** In printf, '*' means: read the next arg as an int for the</font>
01271 <font class="comment">              ** field width.  This seems to be missing from my copy of the </font>
01272 <font class="comment">              ** standard x3.159-1989.  Setion 4.9.6.1 refers to * (described</font>
01273 <font class="comment">              ** later) but never does.</font>
01274 <font class="comment">              */</font>
01275               
01276               <font class="keywordflow">if</font> (key == <font class="charliteral">'*'</font>) 
01277                 {
01278                   ; <font class="comment">/* don't do anything --- handle later */</font>
01279                 }
01280               <font class="keywordflow">else</font>
01281                 {
01282                   <font class="keywordflow">while</font> (isdigit ((<font class="keywordtype">int</font>) key) != 0)
01283                     {
01284                       key = *(++code);
01285                       fileloc_incColumn (formatloc);
01286                     }
01287                 }
01288             }
01289 
01290           <font class="keywordflow">if</font> (key == <font class="charliteral">'h'</font>)
01291             {
01292               modtype = ctype_sint;  <font class="comment">/* short */</font>
01293               key = *(++code);
01294               fileloc_incColumn (formatloc);
01295             }
01296           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (key == <font class="charliteral">'l'</font> || key == <font class="charliteral">'L'</font>) 
01297             {
01298               modtype = ctype_lint; <font class="comment">/* long */</font>
01299               key = *(++code);
01300               fileloc_incColumn (formatloc);
01301 
01302               <font class="keywordflow">if</font> (key == <font class="charliteral">'l'</font> || key == <font class="charliteral">'L'</font>) { 
01303                 modtype = ctype_llint; <font class="comment">/* long long */</font>
01304                 key = *(++code);
01305                 fileloc_incColumn (formatloc);
01306               }
01307             }
01308           <font class="keywordflow">else</font>
01309             {
01310               ; <font class="comment">/* no modifier */</font>
01311             }
01312           
01313           <font class="comment">/* now, key = type of conversion to apply */</font>
01314           ++code;
01315           fileloc_incColumn (formatloc);
01316 
01317           <font class="keywordflow">if</font> (key != <font class="charliteral">'%'</font>) 
01318             {
01319               <font class="keywordflow">if</font> (i &gt;= nargs)
01320                 {
01321                   <font class="keywordflow">if</font> (optgenerror 
01322                       (FLG_TYPE,
01323                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"No argument corresponding to %q format "</font>
01324                                 <font class="stringliteral">"code %d (%%%h): \"%s\""</font>,
01325                                 uentry_getName (fcn),
01326                                 i, key,
01327                                 <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (format)),
01328                        f-&gt;loc))
01329                     {
01330                       <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01331                           &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01332                         {
01333                           <a class="code" href="llerror_c.html#a34">llgenindentmsg</a> (cstring_makeLiteral (<font class="stringliteral">"Corresponding format code"</font>),
01334                                           formatloc);
01335                         }
01336                     }
01337                   i++;
01338                 }
01339               <font class="keywordflow">else</font>
01340                 {
01341                   a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, i);
01342                   i++;
01343                   
01344                   <font class="keywordflow">if</font> (!exprNode_isError (a))
01345                     {
01346                       ctype expecttype;
01347 
01348                       <font class="keywordflow">switch</font> (key)
01349                         {
01350                         <font class="keywordflow">case</font> <font class="charliteral">'*'</font>: <font class="comment">/* int argument for fieldwidth */</font>
01351                           expecttype = ctype_int;
01352                           *(--code) = <font class="charliteral">'%'</font>; <font class="comment">/* convert it for next code */</font>
01353                           <a class="code" href="fileloc_c.html#a4">fileloc_subColumn</a> (formatloc, 1);
01354                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;              
01355                         <font class="keywordflow">case</font> <font class="charliteral">'u'</font>:
01356                         <font class="keywordflow">case</font> <font class="charliteral">'o'</font>:
01357                           expecttype = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (ctype_uint, modtype);
01358                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01359                           
01360                         <font class="keywordflow">case</font> <font class="charliteral">'i'</font>: <font class="comment">/* int argument */</font> 
01361                         <font class="keywordflow">case</font> <font class="charliteral">'d'</font>:
01362                           expecttype = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (ctype_int, modtype);
01363                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01364 
01365                         <font class="keywordflow">case</font> <font class="charliteral">'x'</font>: <font class="comment">/* unsigned int */</font>
01366                         <font class="keywordflow">case</font> <font class="charliteral">'X'</font>:
01367                           expecttype = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (ctype_uint, modtype);
01368                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01369                           
01370                         <font class="keywordflow">case</font> <font class="charliteral">'e'</font>:
01371                         <font class="keywordflow">case</font> <font class="charliteral">'E'</font>:
01372                         <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
01373                         <font class="keywordflow">case</font> <font class="charliteral">'G'</font>:
01374                         <font class="keywordflow">case</font> <font class="charliteral">'f'</font>: <font class="comment">/* double */</font>
01375                           expecttype = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (ctype_double, modtype);
01376                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01377                           
01378                         <font class="keywordflow">case</font> <font class="charliteral">'c'</font>: <font class="comment">/* int converted to char (check its a char?) */</font>
01379                           expecttype = <a class="code" href="ctype_c.html#a85">ctype_makeConj</a> (ctype_char, ctype_uchar);
01380                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01381                               
01382                         <font class="keywordflow">case</font> <font class="charliteral">'s'</font>: <font class="comment">/* string */</font>
01383                           expecttype = ctype_string;
01384                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01385                         <font class="keywordflow">case</font> <font class="charliteral">'['</font>: 
01386                           <font class="comment">/* skip to ']' */</font>
01387                           <font class="keywordflow">while</font> (((key = *(++code)) != <font class="charliteral">']'</font>) 
01388                                  &amp;&amp; (key != <font class="charliteral">'\0'</font>))
01389                             {
01390                               fileloc_incColumn (formatloc);
01391                             }
01392                           
01393                           <font class="keywordflow">if</font> (key == <font class="charliteral">'\0'</font>)
01394                             {
01395                               llfatalerrorLoc
01396                                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Bad character set format: %s"</font>, 
01397                                           cstring_fromChars (origcode)));
01398                             }
01399                           
01400                           expecttype = ctype_string;
01401                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01402                           
01403                         <font class="keywordflow">case</font> <font class="charliteral">'p'</font>: <font class="comment">/* pointer */</font>
01404                           expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_void);
01405                           <font class="comment">/* really! */</font>
01406                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01407                           
01408                         <font class="keywordflow">case</font> <font class="charliteral">'n'</font>: <font class="comment">/* pointer to int, modified by call! */</font>
01409                           expecttype = <a class="code" href="ctype_c.html#a132">ctype_combine</a> (ctype_makePointer (ctype_int), modtype);
01410                           modified = TRUE;
01411                           <a class="code" href="uentry_c.html#a87">uentry_setDefState</a> (regArg, SS_ALLOCATED); <font class="comment">/* corresponds to out */</font>
01412                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01413 
01414                         <font class="keywordflow">case</font> <font class="charliteral">'m'</font>: <font class="comment">/* in a syslog, it doesn't consume an argument */</font>
01415                           <font class="comment">/* should check we're really doing syslog */</font>
01416                           
01417                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01418 
01419                           
01420                         <font class="keywordflow">default</font>:
01421                           expecttype = ctype_unknown;
01422                           
01423                           voptgenerror
01424                             (FLG_FORMATCODE,
01425                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized format code: %s"</font>, 
01426                                       cstring_fromChars (origcode)),
01427                              fileloc_isDefined (formatloc) 
01428                              ? formatloc : g_currentloc);
01429 
01430                           <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01431                         }
01432 
01433                       <font class="keywordflow">if</font> (!(exprNode_matchArgType (expecttype, a)))
01434                         {
01435                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (expecttype) 
01436                               &amp;&amp; <a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (a-&gt;typ)
01437                               &amp;&amp; (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ABSTVOIDP)))
01438                             {
01439                               ;
01440                             }
01441                           <font class="keywordflow">else</font>
01442                             {
01443                               <font class="keywordflow">if</font> (llgenformattypeerror 
01444                                   (expecttype, exprNode_undefined,
01445                                    a-&gt;typ, a,
01446                                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Format argument %d to %q (%%%h) expects "</font>
01447                                             <font class="stringliteral">"%t gets %t: %s"</font>,
01448                                             i - argno,
01449                                             uentry_getName (fcn), 
01450                                             key, expecttype,
01451                                             a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
01452                                    a-&gt;loc))
01453                                 {
01454                                   <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01455                                       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01456                                     {
01457                                       llgenindentmsg
01458                                         (cstring_makeLiteral 
01459                                          (<font class="stringliteral">"Corresponding format code"</font>),
01460                                          formatloc);
01461                                     }
01462                                 }
01463                             }
01464                         }
01465 
01466                       <a class="code" href="uentry_c.html#a216">uentry_setType</a> (regArg, expecttype);
01467                       checkOneArg (regArg, a, f, FALSE, i+1, nargs);
01468                       
01469                       <font class="keywordflow">if</font> (ctype_equal (expecttype, ctype_string))
01470                         {
01471                           exprNode_checkUse (a, sRef_makePointer (a-&gt;sref), a-&gt;loc);
01472                         }
01473                       
01474                       <a class="code" href="uentry_c.html#a216">uentry_setType</a> (regArg, ctype_unknown);
01475                       <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (regArg);
01476                   
01477                       <font class="keywordflow">if</font> (modified)
01478                         {
01479                           <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (a-&gt;sref, args, f, ret);
01480                         }
01481                     }
01482                   <font class="keywordflow">else</font>
01483                     {
01484                       ;
01485                     }
01486                 }
01487             }
01488           ocode = code;
01489         }
01490   
01491       <font class="keywordflow">if</font> (i &lt; nargs)
01492         {
01493           voptgenerror (FLG_TYPE,
01494                         message (<font class="stringliteral">"Format string for %q has %d arg%p, given %d"</font>, 
01495                                  uentry_getName (fcn), i - argno, nargs - argno),
01496                         f-&gt;loc);
01497         }
01498     }
01499   <font class="keywordflow">else</font>
01500     {
01501       <font class="comment">/* no checking possible for compile-time unknown format strings */</font>
01502     }
01503 
01504   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (formatloc);
01505 }
01506 
01507 <font class="keyword">static</font> <font class="keywordtype">void</font>
01508 checkScanfArgs (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode f, uentry fcn, 
01509                  exprNodeList args, exprNode ret, <font class="keywordtype">int</font> argno)<font class="keyword"></font>
01510 <font class="keyword"></font>{
01511   <font class="keywordtype">int</font> i = argno;
01512   fileloc formatloc;
01513   <font class="keywordtype">int</font> nargs = exprNodeList_size (args);
01514   uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (fcn);
01515   exprNode a; 
01516 
01517   <font class="comment">/*</font>
01518 <font class="comment">  ** These should be ensured by checkSpecialFunction</font>
01519 <font class="comment">  */</font>
01520 
01521   llassert (uentryList_size (params) == argno + 1);
01522   llassert (uentry_isElipsisMarker (uentryList_getN (params, argno)));
01523 
01524   a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, argno - 1);
01525   formatloc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (exprNode_loc (a));
01526 
01527   <font class="keywordflow">if</font> (exprNode_isDefined (a) &amp;&amp; exprNode_isStringLiteral (a) 
01528       &amp;&amp; exprNode_knownStringValue (a))
01529     {
01530       <font class="keywordtype">char</font> *format = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (multiVal_forceString (exprNode_getValue (a)));
01531       <font class="keywordtype">char</font> *code = format;
01532       <font class="keywordtype">char</font> *ocode = code;
01533 
01534       nargs = exprNodeList_size (args);
01535 
01536       <font class="keywordflow">while</font> ((code = strchr (code, <font class="charliteral">'%'</font>)) != NULL)
01537         {
01538           <font class="keywordtype">char</font> *origcode = code;
01539           <font class="keywordtype">char</font> key = *(++code);                 
01540           ctype modtype = ctype_int;
01541           <font class="keywordtype">char</font> modifier = <font class="charliteral">'\0'</font>;
01542           <font class="keywordtype">bool</font> modified = TRUE;
01543           <font class="keywordtype">bool</font> ignore = FALSE;
01544 
01545           fileloc_addColumn (formatloc, code - ocode);
01546 
01547           <font class="comment">/*</font>
01548 <font class="comment">          ** this is based on ANSI standard library description of fscanf</font>
01549 <font class="comment">          ** (from ANSI standard X3.159-1989, 4.9.6.1)</font>
01550 <font class="comment">          */</font>
01551               
01552           <font class="comment">/* '*' suppresses assignment (does not need match argument) */</font>
01553           
01554           <font class="keywordflow">if</font> (key == <font class="charliteral">'*'</font>) 
01555             {
01556               key = *(++code);
01557               modified = FALSE; 
01558               ignore = TRUE;
01559               fileloc_incColumn (formatloc);
01560             }
01561           
01562           <font class="comment">/* ignore field width */</font>
01563           <font class="keywordflow">while</font> (isdigit ((<font class="keywordtype">int</font>) key) != 0)
01564             {
01565               key = *(++code);
01566               fileloc_incColumn (formatloc);
01567             }
01568           
01569           <font class="keywordflow">if</font> (key == <font class="charliteral">'h'</font>)
01570             {
01571               modtype = ctype_sint;  <font class="comment">/* short */</font>
01572               key = *(++code);
01573               fileloc_incColumn (formatloc);
01574             }
01575           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (key == <font class="charliteral">'l'</font> || key == <font class="charliteral">'L'</font>) 
01576             {
01577               modtype = ctype_lint; <font class="comment">/* long */</font>
01578               modifier = key;
01579 
01580               key = *(++code);
01581               fileloc_incColumn (formatloc);
01582 
01583               <font class="keywordflow">if</font> (key == <font class="charliteral">'l'</font> || key == <font class="charliteral">'L'</font>) { 
01584                 modtype = ctype_llint; <font class="comment">/* long long */</font>
01585                 key = *(++code);
01586                 fileloc_incColumn (formatloc);
01587               }
01588             }
01589           <font class="keywordflow">else</font>
01590             {
01591               ; <font class="comment">/* no modifier */</font>
01592             }
01593           
01594           <font class="comment">/* now, key = type of conversion to apply */</font>
01595           ++code;
01596           fileloc_incColumn (formatloc);
01597 
01598           <font class="keywordflow">if</font> (key != <font class="charliteral">'%'</font>) 
01599             {
01600               <font class="keywordflow">if</font> (ignore)
01601                 {
01602                   ;
01603                 }
01604               <font class="keywordflow">else</font>
01605                 {
01606                   <font class="keywordflow">if</font> (i &gt;= nargs)
01607                     {
01608                       <font class="keywordflow">if</font> (optgenerror 
01609                           (FLG_TYPE,
01610                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"No argument corresponding to %q format "</font>
01611                                     <font class="stringliteral">"code %d (%%%h): \"%s\""</font>,
01612                                     uentry_getName (fcn),
01613                                     i, key,
01614                                     <a class="code" href="cstring_c.html#a28">cstring_fromChars</a> (format)),
01615                            f-&gt;loc))
01616                         {
01617                           <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01618                               &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01619                             {
01620                               llgenindentmsg
01621                                 (cstring_makeLiteral (<font class="stringliteral">"Corresponding format code"</font>),
01622                                  formatloc);
01623                             }
01624                         }
01625                       i++;
01626                     }
01627                   <font class="keywordflow">else</font>
01628                     {
01629                       a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, i);
01630                       i++;
01631                   
01632                       <font class="keywordflow">if</font> (!exprNode_isError (a))
01633                         {
01634                           ctype expecttype;
01635 
01636                           <font class="keywordflow">switch</font> (key)
01637                             {
01638                             <font class="keywordflow">case</font> <font class="charliteral">'*'</font>: <font class="comment">/* int argument for fieldwidth */</font>
01639                               expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_int);
01640                               *(--code) = <font class="charliteral">'%'</font>; <font class="comment">/* convert it for next code */</font>
01641                               <a class="code" href="fileloc_c.html#a4">fileloc_subColumn</a> (formatloc, 1);
01642                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;          
01643                             <font class="keywordflow">case</font> <font class="charliteral">'u'</font>:
01644                             <font class="keywordflow">case</font> <font class="charliteral">'o'</font>:
01645                               expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_combine (ctype_uint, modtype));
01646                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01647                               
01648                             <font class="keywordflow">case</font> <font class="charliteral">'i'</font>: 
01649                             <font class="keywordflow">case</font> <font class="charliteral">'d'</font>:
01650                             <font class="keywordflow">case</font> <font class="charliteral">'x'</font>:
01651                             <font class="keywordflow">case</font> <font class="charliteral">'X'</font>: <font class="comment">/* unsigned int */</font>
01652                               expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_combine (ctype_int, modtype));
01653                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01654                               
01655                             <font class="keywordflow">case</font> <font class="charliteral">'e'</font>:
01656                             <font class="keywordflow">case</font> <font class="charliteral">'E'</font>:
01657                             <font class="keywordflow">case</font> <font class="charliteral">'g'</font>:
01658                             <font class="keywordflow">case</font> <font class="charliteral">'G'</font>:
01659                             <font class="keywordflow">case</font> <font class="charliteral">'f'</font>: 
01660                               <font class="comment">/* printf is double, scanf is float! */</font>
01661 
01662                               <font class="keywordflow">if</font> (modifier == <font class="charliteral">'l'</font>) 
01663                                 {
01664                                   expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_double);
01665                                 }
01666                               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (modifier == <font class="charliteral">'L'</font>)
01667                                 {
01668                                   expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_ldouble);
01669                                 }
01670                               <font class="keywordflow">else</font> 
01671                                 {
01672                                   llassert (modifier == <font class="charliteral">'\0'</font>);
01673                                   expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_float);
01674                                 }
01675                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01676                               
01677                             <font class="keywordflow">case</font> <font class="charliteral">'c'</font>: <font class="comment">/* int converted to char (check its a char?) */</font>
01678                               expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_makeConj (ctype_char, ctype_uchar));
01679                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01680                               
01681                             <font class="keywordflow">case</font> <font class="charliteral">'s'</font>: <font class="comment">/* string */</font>
01682                               expecttype = ctype_string;
01683                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01684 
01685                             <font class="keywordflow">case</font> <font class="charliteral">'['</font>: 
01686                               <font class="comment">/* skip to ']' */</font>
01687                               <font class="keywordflow">while</font> (((key = *(++code)) != <font class="charliteral">']'</font>) 
01688                                      &amp;&amp; (key != <font class="charliteral">'\0'</font>))
01689                                 {
01690                                   fileloc_incColumn (formatloc);
01691                                 }
01692                               
01693                               <font class="keywordflow">if</font> (key == <font class="charliteral">'\0'</font>)
01694                                 {
01695                                   llfatalerrorLoc
01696                                     (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Bad character set format: %s"</font>, 
01697                                               cstring_fromChars (origcode)));
01698                                 }
01699                               
01700                               expecttype = ctype_string;
01701                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01702                               
01703                             <font class="keywordflow">case</font> <font class="charliteral">'p'</font>: <font class="comment">/* pointer */</font>
01704                               expecttype = ctype_unknown;
01705                               <font class="comment">/* really! */</font>
01706                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01707                               
01708                             <font class="keywordflow">case</font> <font class="charliteral">'n'</font>: <font class="comment">/* pointer to int, modified by call! */</font>
01709                               expecttype = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (ctype_int);
01710                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01711                           
01712                             <font class="keywordflow">default</font>:
01713                               expecttype = ctype_unknown;
01714                               
01715                               voptgenerror
01716                                 (FLG_FORMATCODE,
01717                                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized format code: %s"</font>, 
01718                                           cstring_fromChars (origcode)),
01719                                  fileloc_isDefined (formatloc) 
01720                                  ? formatloc : g_currentloc);
01721                               
01722                               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
01723                             }
01724                           
01725                           <font class="keywordflow">if</font> (!(exprNode_matchArgType (expecttype, a)))
01726                             {
01727                               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (expecttype) 
01728                                   &amp;&amp; <a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (a-&gt;typ)
01729                                   &amp;&amp; (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ABSTVOIDP)))
01730                                 {
01731                                   ;
01732                                 }
01733                               <font class="keywordflow">else</font>
01734                                 {
01735                                   <font class="keywordflow">if</font> (modifier != <font class="charliteral">'\0'</font>)
01736                                     {
01737                                       <font class="keywordflow">if</font> (llgenformattypeerror 
01738                                           (expecttype, exprNode_undefined,
01739                                            a-&gt;typ, a,
01740                                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Format argument %d to %q (%%%h%h) expects "</font>
01741                                                     <font class="stringliteral">"%t gets %t: %s"</font>,
01742                                                     i - argno,
01743                                                     uentry_getName (fcn), 
01744                                                     modifier,
01745                                                     key, expecttype,
01746                                                     a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
01747                                            a-&gt;loc))
01748                                         {
01749                                           <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01750                                               &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01751                                             {
01752                                               llgenindentmsg
01753                                                 (cstring_makeLiteral 
01754                                                  (<font class="stringliteral">"Corresponding format code"</font>),
01755                                                  formatloc);
01756                                             }
01757                                         }
01758 
01759                                     }
01760                                   <font class="keywordflow">else</font>
01761                                     {
01762                                       <font class="keywordflow">if</font> (llgenformattypeerror 
01763                                           (expecttype, exprNode_undefined,
01764                                            a-&gt;typ, a,
01765                                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Format argument %d to %q (%%%h) expects "</font>
01766                                                     <font class="stringliteral">"%t gets %t: %s"</font>,
01767                                                     i - argno,
01768                                                     uentry_getName (fcn), 
01769                                                     key, expecttype,
01770                                                     a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
01771                                            a-&gt;loc))
01772                                         {
01773                                           <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01774                                               &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01775                                             {
01776                                               llgenindentmsg
01777                                                 (cstring_makeLiteral 
01778                                                  (<font class="stringliteral">"Corresponding format code"</font>),
01779                                                  formatloc);
01780                                             }
01781                                         }
01782                                     }
01783                                 }
01784                             }
01785                           
01786                           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (outArg, expecttype);
01787                           checkOneArg (outArg, a, f, FALSE, i+1, nargs);
01788                           <a class="code" href="uentry_c.html#a216">uentry_setType</a> (outArg, ctype_unknown);
01789                           <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (outArg);
01790                           
01791                           <font class="keywordflow">if</font> (modified)
01792                             {
01793                               <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (a-&gt;sref, args, f, ret);
01794                             }
01795                         }
01796                       <font class="keywordflow">else</font>
01797                         {
01798                                                   <font class="comment">/* a-&gt;sref = defref; */</font>
01799                         }
01800                     }
01801                 }
01802             }
01803           ocode = code;
01804         }
01805 
01806       <font class="keywordflow">if</font> (i &lt; nargs)
01807         {
01808           voptgenerror (FLG_TYPE,
01809                         message (<font class="stringliteral">"Format string for %q has %d arg%p, given %d"</font>, 
01810                                  uentry_getName (fcn), i - argno, nargs - argno),
01811                         f-&gt;loc);
01812         }
01813     }
01814   <font class="keywordflow">else</font>
01815     {
01816       <font class="comment">/* no checking possible for compile-time unknown format strings */</font>
01817     }
01818 
01819   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (formatloc);
01820 }
01821                           
01822 <font class="keyword">static</font> <font class="keywordtype">void</font>
01823 checkMessageArgs (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode f,
01824                   uentry fcn,
01825                   exprNodeList args,
01826                   <font class="comment">/*@unused@*/</font> <font class="keywordtype">int</font> argno)<font class="keyword"></font>
01827 <font class="keyword"></font>{
01828   <font class="comment">/*</font>
01829 <font class="comment">  ** the last argument before the elips is the format string </font>
01830 <font class="comment">  */</font>
01831 
01832   <font class="keywordtype">int</font> nargs = exprNodeList_size (args);
01833   <font class="keywordtype">int</font> i = argno;
01834   fileloc formatloc;
01835   exprNode a; 
01836 
01837   a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, argno - 1);
01838   formatloc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (exprNode_loc (a));
01839 
01840   <font class="keywordflow">if</font> (ctype_isUnknown (cstringType)) {
01841     <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"cstring"</font>)))
01842       {
01843         cstringType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"cstring"</font>));
01844       }
01845   }
01846  
01847   <font class="keywordflow">if</font> (ctype_isUnknown (ctypeType)) {
01848     <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"ctype"</font>)))
01849       {
01850         ctypeType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"ctype"</font>));
01851       }
01852   }
01853 
01854   <font class="keywordflow">if</font> (ctype_isUnknown (filelocType)) {
01855     <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"fileloc"</font>)))
01856       {
01857         filelocType = <a class="code" href="usymtab_c.html#a120">usymtab_lookupAbstractType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"fileloc"</font>));
01858       }
01859   }
01860 
01861   <font class="keywordflow">if</font> (exprNode_isDefined (a) &amp;&amp; exprNode_isStringLiteral (a) 
01862       &amp;&amp; exprNode_knownStringValue (a))
01863     {
01864       cstring format = <a class="code" href="multiVal_c.html#a11">multiVal_forceString</a> (exprNode_getValue (a));
01865       <font class="keywordtype">char</font> *code = <a class="code" href="cstring_c.html#a29">cstring_toCharsSafe</a> (format);
01866       <font class="keywordtype">char</font> *ocode = code;
01867 
01868       nargs = exprNodeList_size (args);
01869 
01870       <font class="keywordflow">while</font> ((code = strchr (code, <font class="charliteral">'%'</font>)) != NULL)
01871         {
01872           <font class="keywordtype">char</font> *origcode = code;
01873           <font class="keywordtype">char</font> key = *(++code);                 
01874           <font class="keywordtype">bool</font> isOnly = FALSE;
01875 
01876           fileloc_addColumn (formatloc, code - ocode);
01877 
01878           <font class="keywordflow">while</font> (key &gt;= <font class="charliteral">'0'</font> &amp;&amp; key &lt;= <font class="charliteral">'9'</font>)
01879             {
01880               key = *(++code);
01881               fileloc_incColumn (formatloc);
01882             }
01883           
01884           ++code;
01885           fileloc_incColumn (formatloc);
01886 
01887           <font class="keywordflow">if</font> (key != <font class="charliteral">'%'</font>) 
01888             {
01889               <font class="keywordflow">if</font> (key == <font class="charliteral">'p'</font>)
01890                 {
01891                   <font class="keywordflow">goto</font> nextKey;
01892                 }
01893 
01894               <font class="keywordflow">if</font> (i &gt;= nargs)
01895                 {
01896                   voptgenerror
01897                     (FLG_TYPE,
01898                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Message missing format arg %d (%%%h): \"%s\""</font>,
01899                               i + 1, key, format), 
01900                      f-&gt;loc);
01901                   i++;
01902                 }
01903               <font class="keywordflow">else</font>
01904                 {
01905                   a = <a class="code" href="exprNodeList_c.html#a7">exprNodeList_getN</a> (args, i);
01906                   i++;
01907                   
01908                 nextKey:
01909                   <font class="keywordflow">if</font> (!exprNode_isError (a))
01910                     {
01911                       ctype expecttype;
01912                       
01913                       <font class="comment">/*@-loopswitchbreak@*/</font>
01914 
01915                       <font class="keywordflow">switch</font> (key)
01916                         {
01917                         <font class="keywordflow">case</font> <font class="charliteral">'c'</font>:
01918                         <font class="keywordflow">case</font> <font class="charliteral">'h'</font>: 
01919                           expecttype = ctype_char; <font class="keywordflow">break</font>;
01920                         <font class="keywordflow">case</font> <font class="charliteral">'s'</font>: 
01921                           expecttype = cstringType; <font class="keywordflow">break</font>;
01922                         <font class="keywordflow">case</font> <font class="charliteral">'q'</font>: 
01923                           expecttype = cstringType; isOnly = TRUE; <font class="keywordflow">break</font>;
01924                         <font class="keywordflow">case</font> <font class="charliteral">'x'</font>: 
01925                           expecttype = cstringType; isOnly = TRUE; <font class="keywordflow">break</font>;
01926                         <font class="keywordflow">case</font> <font class="charliteral">'d'</font>: expecttype = ctype_int; <font class="keywordflow">break</font>;
01927                         <font class="keywordflow">case</font> <font class="charliteral">'u'</font>: expecttype = ctype_uint; <font class="keywordflow">break</font>;
01928                         <font class="keywordflow">case</font> <font class="charliteral">'w'</font>: expecttype = ctype_ulint; <font class="keywordflow">break</font>;
01929                         <font class="keywordflow">case</font> <font class="charliteral">'f'</font>: expecttype = ctype_float; <font class="keywordflow">break</font>;
01930                         <font class="keywordflow">case</font> <font class="charliteral">'b'</font>: expecttype = ctype_bool; <font class="keywordflow">break</font>;
01931                         <font class="keywordflow">case</font> <font class="charliteral">'t'</font>: expecttype = ctypeType; <font class="keywordflow">break</font>;
01932                         <font class="keywordflow">case</font> <font class="charliteral">'l'</font>: expecttype = filelocType; <font class="keywordflow">break</font>;
01933                         <font class="keywordflow">case</font> <font class="charliteral">'p'</font>:  <font class="comment">/* a wee bit of a hack methinks */</font>
01934                           expecttype = ctype_int;
01935                           <font class="keywordflow">break</font>;
01936                         <font class="keywordflow">case</font> <font class="charliteral">'r'</font>: expecttype = ctype_bool; <font class="keywordflow">break</font>;
01937                         <font class="keywordflow">default</font>:  
01938                           expecttype = ctype_unknown;
01939                           voptgenerror
01940                             (FLG_FORMATCODE,
01941                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Unrecognized format code: %s"</font>, 
01942                                       cstring_fromChars (origcode)),
01943                              fileloc_isDefined (formatloc) 
01944                              ? formatloc : g_currentloc);
01945                           <font class="keywordflow">break</font>;
01946                         }
01947                       <font class="comment">/*@=loopswitchbreak@*/</font>
01948 
01949                       <font class="keywordflow">if</font> (!(exprNode_matchArgType (expecttype, a)))
01950                         {
01951                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (expecttype) 
01952                               &amp;&amp; <a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (a-&gt;typ)
01953                               &amp;&amp; (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ABSTVOIDP)))
01954                             {
01955                               ;
01956                             }
01957                           <font class="keywordflow">else</font>
01958                             {
01959                               <font class="keywordflow">if</font> (llgenformattypeerror 
01960                                   (expecttype, exprNode_undefined,
01961                                    a-&gt;typ, a,
01962                                    <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Format argument %d to %q (%%%h) expects "</font>
01963                                             <font class="stringliteral">"%t gets %t: %s"</font>,
01964                                             i - argno,
01965                                             uentry_getName (fcn), 
01966                                             key, expecttype,
01967                                             a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
01968                                    a-&gt;loc))
01969                                   {
01970                                   <font class="keywordflow">if</font> (fileloc_isDefined (formatloc)
01971                                       &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_SHOWCOL))
01972                                     {
01973                                       llgenindentmsg
01974                                         (cstring_makeLiteral 
01975                                          (<font class="stringliteral">"Corresponding format code"</font>),
01976                                          formatloc);
01977                                     }
01978                                 }
01979                             }
01980                         }
01981                       
01982                       <font class="keywordflow">if</font> (ctype_equal (expecttype, cstringType))
01983                         {
01984                           <font class="keywordflow">if</font> (isOnly)
01985                             {
01986                               checkOneArg (csOnlyArg, a, f, FALSE, i+1, nargs);
01987                               <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (csOnlyArg);
01988                             }
01989                           <font class="keywordflow">else</font>
01990                             {
01991                               checkOneArg (csArg, a, f, FALSE, i+1, nargs);
01992                               <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (csArg);
01993                             }
01994                         }
01995                       <font class="keywordflow">else</font>
01996                         {
01997                                                   checkOneArg (regArg, a, f, FALSE, i+1, nargs);
01998                           <a class="code" href="uentry_c.html#a57">uentry_fixupSref</a> (regArg);
01999                         }
02000                     }
02001                 }
02002             }
02003         }
02004 
02005       <font class="keywordflow">if</font> (i &lt; nargs)
02006         {
02007           voptgenerror (FLG_TYPE,
02008                         message (<font class="stringliteral">"Format string for %q has %d arg%p, given %d"</font>, 
02009                                  uentry_getName (fcn), i - argno, nargs -argno),
02010                         f-&gt;loc);
02011         }
02012     }
02013   <font class="keywordflow">else</font>
02014     {
02015       <font class="comment">/* no checking possible for compile-time unknown format strings */</font>
02016     }
02017 
02018   <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (formatloc);
02019 }
02020 
02021 <font class="keyword">static</font> <font class="keywordtype">void</font>
02022   checkExpressionDefinedAux (<font class="comment">/*@notnull@*/</font> exprNode e1, 
02023                              <font class="comment">/*@notnull@*/</font> exprNode e2, 
02024                              sRefSet sets1,
02025                              sRefSet sets2, 
02026                              lltok op,
02027                              flagcode flag)<font class="keyword"></font>
02028 <font class="keyword"></font>{
02029   <font class="keywordtype">bool</font> hadUncon = FALSE;
02030 
02031   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef_getRootBase (e1-&gt;sref)) &amp;&amp; 
02032       <a class="code" href="sRefSet_c.html#a29">sRefSet_hasUnconstrained</a> (sets2))
02033     {
02034       voptgenerror
02035         (FLG_EVALORDERUNCON,
02036          message
02037          (<font class="stringliteral">"Expression may have undefined behavior (%q used in right operand "</font>
02038           <font class="stringliteral">"may set global variable %q used in left operand): %s %s %s"</font>, 
02039           <a class="code" href="sRefSet_c.html#a30">sRefSet_unparseUnconstrained</a> (sets2),
02040           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef_getRootBase (e1-&gt;sref)),
02041           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02042          e2-&gt;loc);
02043     }
02044 
02045   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef_getRootBase (e2-&gt;sref)) &amp;&amp; 
02046       <a class="code" href="sRefSet_c.html#a29">sRefSet_hasUnconstrained</a> (sets1))
02047     {
02048       voptgenerror
02049         (FLG_EVALORDERUNCON,
02050          message
02051          (<font class="stringliteral">"Expression has undefined behavior (%q used in left operand "</font>
02052           <font class="stringliteral">"may set global variable %q used in right operand): %s %s %s"</font>, 
02053           <a class="code" href="sRefSet_c.html#a30">sRefSet_unparseUnconstrained</a> (sets1),
02054           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (e2-&gt;sref),
02055           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02056          e2-&gt;loc);
02057     }
02058 
02059   sRefSet_realElements (e1-&gt;uses, sr)<font class="keyword"></font>
02060 <font class="keyword">    </font>{
02061       <font class="keywordflow">if</font> (sRef_isMeaningful (sr) &amp;&amp; <a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sets2, sr))
02062         {
02063           voptgenerror
02064             (FLG_EVALORDER,
02065              message
02066              (<font class="stringliteral">"Expression has undefined behavior (left operand uses %q, "</font>
02067               <font class="stringliteral">"modified by right operand): %s %s %s"</font>, 
02068               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr),
02069               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02070              e2-&gt;loc);
02071         }
02072     } end_sRefSet_realElements;
02073   
02074   sRefSet_realElements (sets1, sr)<font class="keyword"></font>
02075 <font class="keyword">    </font>{
02076       <font class="keywordflow">if</font> (sRef_isMeaningful (sr))
02077         {
02078           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a112">sRef_same</a> (sr, e2-&gt;sref))
02079             {
02080               voptgenerror
02081                 (flag,
02082                  message
02083                  (<font class="stringliteral">"Expression has undefined behavior (value of right operand "</font>
02084                   <font class="stringliteral">"modified by left operand): %s %s %s"</font>, 
02085                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02086                  e2-&gt;loc);
02087             }
02088           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (e2-&gt;uses, sr))
02089             {
02090               voptgenerror
02091                 (flag,
02092                  message 
02093                  (<font class="stringliteral">"Expression has undefined behavior (left operand modifies %q, "</font>
02094                   <font class="stringliteral">"used by right operand): %s %s %s"</font>, 
02095                   <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr),
02096                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02097                  e2-&gt;loc);
02098             }
02099           <font class="keywordflow">else</font> 
02100             {
02101               <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sets2, sr))
02102                 {
02103                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (sr))
02104                     {
02105                       <font class="keywordflow">if</font> (hadUncon)
02106                         {
02107                           ;
02108                         }
02109                       <font class="keywordflow">else</font>
02110                         {
02111                           hadUncon = optgenerror
02112                             (FLG_EVALORDERUNCON,
02113                              message 
02114                              (<font class="stringliteral">"Expression may have undefined behavior.  Left operand "</font>
02115                               <font class="stringliteral">"calls %q; right operand calls %q.  The unconstrained "</font>
02116                               <font class="stringliteral">"functions may modify global state used by "</font>
02117                               <font class="stringliteral">"the other operand): %s %s %s"</font>, 
02118                               <a class="code" href="sRefSet_c.html#a30">sRefSet_unparseUnconstrained</a> (sets1),
02119                               <a class="code" href="sRefSet_c.html#a30">sRefSet_unparseUnconstrained</a> (sets2),
02120                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op),
02121                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02122                              e2-&gt;loc);
02123                         }
02124                     }
02125                   <font class="keywordflow">else</font>
02126                     {
02127                       voptgenerror
02128                         (flag,
02129                          message 
02130                          (<font class="stringliteral">"Expression has undefined behavior (both "</font>
02131                           <font class="stringliteral">"operands modify %q): %s %s %s"</font>, 
02132                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr), 
02133                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), 
02134                           <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02135                          e2-&gt;loc);
02136                     }
02137                 }
02138             }
02139         }
02140     } end_sRefSet_realElements;
02141 }
02142 
02143 <font class="keyword">static</font> <font class="keywordtype">void</font> checkExpressionDefined (exprNode e1, exprNode e2, lltok op)<font class="keyword"></font>
02144 <font class="keyword"></font>{
02145   <font class="keywordtype">bool</font> hasError = FALSE;
02146   
02147   <font class="keywordflow">if</font> (exprNode_isError (e1) || exprNode_isError (e2))
02148     {
02149       <font class="keywordflow">return</font>;
02150     }
02151 
02152   <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (e2-&gt;sets, e1-&gt;sref))
02153     {
02154       <font class="keywordflow">if</font> (e2-&gt;kind == XPR_CALL)
02155         {
02156          ;
02157         }
02158       <font class="keywordflow">else</font>
02159         {
02160           hasError = optgenerror 
02161             (FLG_EVALORDER,
02162              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Expression has undefined behavior "</font>
02163                       <font class="stringliteral">"(value of left operand is modified "</font>
02164                       <font class="stringliteral">"by right operand): %s %s %s"</font>, 
02165                       exprNode_unparse (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op),
02166                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02167              e2-&gt;loc);
02168         }
02169     }
02170 
02171   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_EVALORDERUNCON))
02172     {
02173       <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (e2-&gt;msets, e1-&gt;sref))
02174         {
02175           <font class="keywordflow">if</font> (e2-&gt;kind == XPR_CALL)
02176             {
02177               ;
02178             }
02179           <font class="keywordflow">else</font>
02180             {
02181               hasError = optgenerror 
02182                 (FLG_EVALORDER,
02183                  message 
02184                  (<font class="stringliteral">"Expression has undefined behavior (value of left "</font>
02185                   <font class="stringliteral">"operand may be modified by right operand): %s %s %s"</font>, 
02186                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op),
02187                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
02188                  e2-&gt;loc);
02189             }
02190         }
02191     }
02192   
02193   <font class="keywordflow">if</font> (!hasError)
02194     {
02195       checkExpressionDefinedAux (e1, e2, e1-&gt;sets, e2-&gt;sets, op, FLG_EVALORDER);
02196       
02197       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EVALORDERUNCON))
02198         {
02199           checkExpressionDefinedAux (e1, e2, e1-&gt;msets, 
02200                                      e2-&gt;msets, op, FLG_EVALORDERUNCON);
02201         }
02202     }
02203 }
02204 
02205 <font class="keyword">static</font> <font class="keywordtype">void</font> checkSequencing (exprNode p_f, exprNodeList p_args); 
02206 
02207 <font class="keyword">static</font> <font class="keywordtype">int</font>
02208   checkArgsReal (uentry fcn, <font class="comment">/*@dependent@*/</font> exprNode f, uentryList cl, 
02209                  exprNodeList args, <font class="keywordtype">bool</font> isIter, exprNode ret)<font class="keyword"></font>
02210 <font class="keyword"></font>{
02211   <font class="keywordtype">int</font> special = 0;
02212 
02213   <font class="keywordflow">if</font> (!exprNode_isError (f))
02214     {
02215       <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (cl))
02216         {
02217           <font class="keywordtype">int</font> nargs = exprNodeList_size (args);
02218           <font class="keywordtype">int</font> expectargs = <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (cl);
02219           ctype last;
02220           <font class="keywordtype">int</font> i = 0;
02221           
02222           <font class="keywordflow">if</font> (expectargs == 0)
02223             {
02224               <font class="keywordflow">if</font> (nargs != 0)
02225                 {
02226                   <font class="keywordflow">if</font> (isIter)
02227                     {
02228                       voptgenerror
02229                         (FLG_TYPE,
02230                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Iter %q invoked with %d args, "</font>
02231                                   <font class="stringliteral">"declared void"</font>,
02232                                   uentry_getName (fcn),
02233                                   nargs),
02234                          f-&gt;loc);
02235                     }
02236                   <font class="keywordflow">else</font>
02237                     {
02238                       voptgenerror 
02239                         (FLG_TYPE,
02240                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s called with %d args, "</font>
02241                                   <font class="stringliteral">"declared void"</font>, 
02242                                   exprNode_unparse (f), nargs),
02243                          f-&gt;loc);
02244                     }
02245                 }
02246               <font class="keywordflow">return</font> special;
02247             }
02248           
02249           last = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (uentryList_getN (cl, expectargs - 1));
02250           
02251           <a class="code" href="exprNodeList_c.html#a3">exprNodeList_reset</a> (args);
02252           
02253           uentryList_elements (cl, current)<font class="keyword"></font>
02254 <font class="keyword">            </font>{
02255               ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (current);
02256               exprNode a;
02257               
02258               <font class="keywordflow">if</font> (ctype_isElips (ct))
02259                 {
02260                   <font class="comment">/*</font>
02261 <font class="comment">                   ** do special checking for printf/scanf library functions</font>
02262 <font class="comment">                   **</font>
02263 <font class="comment">                   ** this is kludgey code, just for handling the special case</font>
02264 <font class="comment">                   **</font>
02265 <font class="comment">                   */</font>
02266 
02267                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a73">uentry_isPrintfLike</a> (fcn))
02268                     {
02269                       checkPrintfArgs (f, fcn, args, ret, i);
02270                       special = i;
02271                     }
02272                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a74">uentry_isScanfLike</a> (fcn))
02273                     {
02274                       checkScanfArgs (f, fcn, args, ret, i); 
02275                       special = i;
02276                     }
02277                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a75">uentry_isMessageLike</a> (fcn))
02278                     {
02279                       checkMessageArgs (f, fcn, args, i);
02280                       special = i;
02281                     }
02282                   <font class="keywordflow">else</font>
02283                     {
02284                       llassert (!uentry_isSpecialFunction (fcn));
02285                     }
02286                     
02287                   nargs = expectargs; <font class="comment">/* avoid errors */</font>
02288                   <font class="keywordflow">break</font>;
02289                 }
02290               <font class="keywordflow">else</font>
02291                 {
02292                   <font class="keywordflow">if</font> (i &gt;= nargs) <font class="keywordflow">break</font>;
02293                   
02294                   a = <a class="code" href="exprNodeList_c.html#a6">exprNodeList_current</a> (args);
02295                   <a class="code" href="exprNodeList_c.html#a4">exprNodeList_advance</a> (args);
02296                   
02297                   i++;
02298                   
02299                   <font class="keywordflow">if</font> (exprNode_isError (a))
02300                     {
02301                      ;
02302                     }
02303                   <font class="keywordflow">else</font>
02304                     {
02305                       <font class="comment">/* </font>
02306 <font class="comment">                        probably necessary? I'm not sure about this one</font>
02307 <font class="comment">                        checkMacroParen (a);</font>
02308 <font class="comment">                        */</font>
02309                       
02310                       f-&gt;guards = <a class="code" href="guardSet_c.html#a7">guardSet_union</a> (f-&gt;guards, a-&gt;guards);
02311                       
02312                       DPRINTF ((<font class="stringliteral">"match arg: %s / %s"</font>, ctype_unparse (ct), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (a-&gt;typ)));
02313 
02314                       <font class="keywordflow">if</font> (!(exprNode_matchArgType (ct, a)))
02315                         {
02316                           DPRINTF ((<font class="stringliteral">"Args mismatch!"</font>));
02317 
02318                           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (ct) 
02319                               &amp;&amp; (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (a-&gt;typ) 
02320                                   &amp;&amp; (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (ctype_baseArrayPtr (a-&gt;typ)))))
02321                             {
02322                               vnoptgenerror 
02323                                 (FLG_ABSTVOIDP,
02324                                  message 
02325                                  (<font class="stringliteral">"Pointer to abstract type (%t) used "</font>
02326                                   <font class="stringliteral">"as void pointer "</font>
02327                                   <font class="stringliteral">"(arg %d to %q): %s"</font>,
02328                                   a-&gt;typ, i, 
02329                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (fcn), 
02330                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
02331                                  a-&gt;loc);
02332                             }
02333                           <font class="keywordflow">else</font>
02334                             {
02335                               <font class="keywordflow">if</font> (isIter)
02336                                 {
02337                                   (<font class="keywordtype">void</font>) gentypeerror 
02338                                     (ct, exprNode_undefined,
02339                                      a-&gt;typ, a,
02340                                      message 
02341                                      (<font class="stringliteral">"Iter %q expects arg %d to "</font>
02342                                       <font class="stringliteral">"be %t gets %t: %s"</font>,
02343                                       <a class="code" href="uentry_c.html#a195">uentry_getName</a> (fcn),
02344                                       i, ct, a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
02345                                      a-&gt;loc);
02346                                 }
02347                               <font class="keywordflow">else</font>
02348                                 {
02349                                   <font class="keywordflow">if</font> (gentypeerror  
02350                                       (ct, 
02351                                        exprNode_undefined,
02352                                        a-&gt;typ,
02353                                        a,
02354                                        message 
02355                                        (<font class="stringliteral">"Function %q expects arg %d to be %t gets %t: %s"</font>,
02356                                         <a class="code" href="uentry_c.html#a195">uentry_getName</a> (fcn),
02357                                         i, ct, a-&gt;typ, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (a)),
02358                                        a-&gt;loc))
02359                                     {
02360                                       DPRINTF ((<font class="stringliteral">"Types: %s / %s"</font>,
02361                                                 ctype_unparse (ct),
02362                                                 <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (a-&gt;typ)));
02363                                     }
02364 
02365                                   <font class="comment">/*</font>
02366 <font class="comment">                                  ** Clear null marker for abstract types.</font>
02367 <font class="comment">                                  ** (It is not revealed, so suppress future messages.)</font>
02368 <font class="comment">                                  */</font>
02369 
02370                                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (a-&gt;typ))
02371                                     {
02372                                       <a class="code" href="sRef_c.html#a218">sRef_setNullUnknown</a> (exprNode_getSref (a), a-&gt;loc);
02373                                     }
02374                                 }
02375                             }
02376                         }
02377                     }
02378                 }
02379             } end_uentryList_elements ;
02380           
02381           
02382           <font class="keywordflow">if</font> (expectargs != nargs) <font class="comment">/* note: not != since we may have ... */</font>
02383             {
02384               <font class="keywordflow">if</font> (ctype_isElips (last))
02385                 {
02386                   voptgenerror
02387                     (FLG_TYPE,
02388                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s called with %d args, expects at least %d"</font>,
02389                               exprNode_unparse (f),
02390                               nargs, expectargs - 1),
02391                      f-&gt;loc);
02392                 }
02393               <font class="keywordflow">else</font>
02394                 {
02395                   <font class="keywordflow">if</font> (isIter)
02396                     {
02397                       voptgenerror 
02398                         (FLG_TYPE,
02399                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Iter %q invoked with %d args, expects %d"</font>,
02400                                   uentry_getName (fcn), nargs, expectargs),
02401                          f-&gt;loc);
02402                     }
02403                   <font class="keywordflow">else</font>
02404                     {
02405                       voptgenerror 
02406                         (FLG_TYPE,
02407                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function %s called with %d args, expects %d"</font>,
02408                                   exprNode_unparse (f),
02409                                   nargs, expectargs),
02410                          f-&gt;loc);
02411                     }
02412                 }
02413             }
02414         }
02415     }
02416 
02417   <font class="keywordflow">return</font> special;
02418 }
02419 
02420 <font class="comment">/*</font>
02421 <font class="comment">** Check for undefined code sequences in function arguments:</font>
02422 <font class="comment">**</font>
02423 <font class="comment">**   one parameter sets something used by another parameter</font>
02424 <font class="comment">**   one parameter sets something set  by another parameter</font>
02425 <font class="comment">*/</font>
02426 
02427 <font class="keyword">static</font> <font class="keywordtype">void</font> 
02428 checkSequencingOne (exprNode f, exprNodeList args, 
02429                     <font class="comment">/*@notnull@*/</font> exprNode el, <font class="keywordtype">int</font> argno)<font class="keyword"></font>
02430 <font class="keyword"></font>{
02431   <font class="comment">/*</font>
02432 <font class="comment">  ** Do second loop, iff +undefunspec</font>
02433 <font class="comment">  */</font>
02434 
02435   <font class="keywordtype">int</font> checkloop;
02436   <font class="keywordtype">int</font> numloops = <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EVALORDERUNCON) ? 2 : 1;
02437   
02438   <font class="keywordflow">for</font> (checkloop = 0; checkloop &lt; numloops; checkloop++)
02439     {
02440       sRefSet thissets;
02441 
02442       <font class="keywordflow">if</font> (checkloop == 0)
02443         {
02444           thissets = el-&gt;sets;
02445         }
02446       <font class="keywordflow">else</font>
02447         {
02448           llassert (checkloop == 1);
02449           thissets = el-&gt;msets;
02450         }
02451       
02452       sRefSet_realElements (thissets, thisset)<font class="keyword"></font>
02453 <font class="keyword">        </font>{
02454           <font class="keywordtype">int</font> j;
02455 
02456           <font class="comment">/*@access exprNodeList@*/</font>
02457           <font class="keywordflow">for</font> (j = 0; j &lt; args-&gt;nelements; j++)
02458             {
02459               exprNode jl = args-&gt;elements[j];
02460               <font class="keywordtype">int</font> thisargno = j + 1;
02461 
02462               <font class="keywordflow">if</font> (thisargno != argno &amp;&amp; exprNode_isDefined (jl))
02463                 {
02464                   sRefSet otheruses = jl-&gt;uses;
02465                   
02466                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (sRef_getRootBase (jl-&gt;sref)) &amp;&amp; 
02467                       <a class="code" href="sRefSet_c.html#a29">sRefSet_hasUnconstrained</a> (thissets))
02468                     {
02469                       voptgenerror
02470                         (FLG_EVALORDERUNCON,
02471                          <font class="comment">/*@-sefparams@*/</font>
02472                          message
02473                          (<font class="stringliteral">"%q used in argument %d may set "</font>
02474                           <font class="stringliteral">"global variable %q used by argument %d: %s(%q)"</font>, 
02475                           <a class="code" href="cstring_c.html#a32">cstring_capitalizeFree</a> (sRefSet_unparseUnconstrained (thissets)),
02476                           <font class="comment">/*@=sefparams@*/</font>
02477                           argno,
02478                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sRef_getRootBase (jl-&gt;sref)),
02479                           thisargno,
02480                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f), <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (args)),
02481                          el-&gt;loc);
02482                     }
02483 
02484                   <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (otheruses, thisset))
02485                     {
02486                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (thisset))
02487                         {
02488                           voptgenerror 
02489                             (FLG_EVALORDERUNCON,
02490                              message 
02491                              (<font class="stringliteral">"Unconstrained functions used in arguments %d (%q) "</font>
02492                               <font class="stringliteral">"and %d (%s) may modify "</font>
02493                               <font class="stringliteral">"or use global state in undefined way: %s(%q)"</font>,
02494                               argno,
02495                               <a class="code" href="sRefSet_c.html#a31">sRefSet_unparseUnconstrainedPlain</a> (otheruses),
02496                               thisargno, 
02497                               <a class="code" href="sRef_c.html#a126">sRef_unconstrainedName</a> (thisset),
02498                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f), 
02499                               <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (args)),
02500                              el-&gt;loc);
02501                         }
02502                       <font class="keywordflow">else</font>
02503                         {
02504                           voptgenerror 
02505                             (FLG_EVALORDER,
02506                              message 
02507                              (<font class="stringliteral">"Argument %d modifies %q, used by argument %d "</font>
02508                               <font class="stringliteral">"(order of evaluation of actual parameters is "</font>
02509                               <font class="stringliteral">"undefined): %s(%q)"</font>,
02510                               argno, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (thisset), thisargno, 
02511                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f), <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (args)),
02512                              el-&gt;loc);
02513                         }
02514                     }
02515                   <font class="keywordflow">else</font> 
02516                     {
02517                       sRefSet othersets = jl-&gt;sets;
02518                       
02519                       <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (othersets, thisset))
02520                         {
02521                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (thisset))
02522                             {
02523                               voptgenerror 
02524                                 (FLG_EVALORDERUNCON,
02525                                  message 
02526                                  (<font class="stringliteral">"Unconstrained functions used in "</font>
02527                                   <font class="stringliteral">"arguments %d (%q) and %d (%s) may modify "</font>
02528                                   <font class="stringliteral">"or use global state in undefined way: %s(%q)"</font>,
02529                                   argno, 
02530                                   <a class="code" href="sRefSet_c.html#a31">sRefSet_unparseUnconstrainedPlain</a> (othersets),
02531                                   thisargno, 
02532                                   <a class="code" href="sRef_c.html#a126">sRef_unconstrainedName</a> (thisset),
02533                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f), <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (args)),
02534                                  el-&gt;loc);
02535                             }
02536                           <font class="keywordflow">else</font>
02537                             {
02538                               voptgenerror 
02539                                 (FLG_EVALORDER,
02540                                  message 
02541                                  (<font class="stringliteral">"Argument %d modifies %q, set by argument %d (order of"</font>
02542                                   <font class="stringliteral">" evaluation of actual parameters is undefined): %s(%q)"</font>,
02543                                   argno, <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (thisset), thisargno, 
02544                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f), <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (args)),
02545                                  el-&gt;loc);
02546                             }
02547                         }
02548                     }
02549                 }
02550             }
02551           <font class="comment">/*@noaccess exprNodeList@*/</font>
02552         } end_sRefSet_realElements;
02553     }
02554 }
02555 
02556 <font class="keyword">static</font> <font class="keywordtype">void</font>
02557 checkSequencing (exprNode f, exprNodeList args)<font class="keyword"></font>
02558 <font class="keyword"></font>{
02559   <font class="keywordflow">if</font> (exprNodeList_size (args) &gt; 1)
02560     {
02561       <font class="keywordtype">int</font> i;
02562       exprNode el;
02563       
02564       <font class="comment">/*@access exprNodeList*/</font>
02565       
02566       <font class="keywordflow">for</font> (i = 0; i &lt; args-&gt;nelements; i++)
02567         {
02568           el = args-&gt;elements[i];
02569           
02570           <font class="keywordflow">if</font> (!exprNode_isError (el))
02571             {
02572               checkSequencingOne (f, args, el, i + 1);
02573             }
02574         }
02575       <font class="comment">/*@noaccess exprNodeList*/</font>
02576     }
02577 }
02578 
02579 <font class="comment">/*</font>
02580 <font class="comment">** requires le = exprNode_getUentry (f) </font>
02581 <font class="comment">*/</font>
02582 
02583 <font class="keyword">static</font> <font class="keywordtype">void</font>
02584 checkGlobMods (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode f,
02585                uentry le, exprNodeList args, 
02586                <font class="comment">/*@notnull@*/</font> exprNode ret, <font class="keywordtype">int</font> specialArgs)<font class="keyword"></font>
02587 <font class="keyword"></font>{
02588   <font class="keywordtype">bool</font> isSpec = FALSE;
02589   <font class="keywordtype">bool</font> hasMods = FALSE;
02590   cstring fname;
02591   globSet usesGlobs = globSet_undefined;
02592   sRefSet mods = sRefSet_undefined;
02593   <font class="keywordtype">bool</font> freshMods = FALSE;
02594   uentryList params = uentryList_undefined;
02595 
02596   <font class="comment">/*</font>
02597 <font class="comment">  ** check globals and modifies</font>
02598 <font class="comment">  */</font>
02599 
02600   setCodePoint ();
02601   
02602   <font class="keywordflow">if</font> (!uentry_isValid (le))
02603     {
02604       ctype fr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (f-&gt;typ);
02605 
02606       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (fr))
02607         {
02608           params = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (fr);
02609         }
02610       <font class="keywordflow">else</font>
02611         {
02612           params = uentryList_missingParams;
02613         }
02614 
02615       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODNOMODS) 
02616           &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_GLOBUNSPEC))
02617         {
02618                     checkUnspecCall (f, params, args);
02619         }
02620       
02621       <font class="keywordflow">return</font>;
02622     }
02623 
02624   fname = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (le);
02625 
02626   setCodePoint ();
02627 
02628   <font class="keywordflow">if</font> (uentry_isFunction (le))
02629     {
02630       params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (le);
02631       mods = <a class="code" href="uentry_c.html#a190">uentry_getMods</a> (le);
02632       hasMods = <a class="code" href="uentry_c.html#a145">uentry_hasMods</a> (le);
02633       usesGlobs = <a class="code" href="uentry_c.html#a189">uentry_getGlobs</a> (le);
02634       isSpec = <a class="code" href="uentry_c.html#a160">uentry_isSpecified</a> (le);
02635     }
02636   <font class="keywordflow">else</font> <font class="comment">/* not a function */</font>
02637     {
02638       ctype ct = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (uentry_getType (le));
02639       
02640       llassertprint (uentry_isVar (le) &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ct),
02641                      (<font class="stringliteral">"checkModGlobs: uentry not a function: %s"</font>, 
02642                       <a class="code" href="uentry_c.html#a155">uentry_unparse</a> (le)));
02643       
02644       params = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (ct);
02645     }
02646 
02647   <font class="comment">/*</font>
02648 <font class="comment">  ** check globals</font>
02649 <font class="comment">  */</font>
02650 
02651   setCodePoint ();
02652 
02653     
02654   globSet_allElements (usesGlobs, el)<font class="keyword"></font>
02655 <font class="keyword">    </font>{
02656       <font class="keywordflow">if</font> (sRef_isValid (el))
02657         {
02658           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (el) || <a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (el))
02659             {
02660               <a class="code" href="context_c.html#a109">context_usedGlobal</a> (el);
02661               exprNode_checkUse (f, el, f-&gt;loc);
02662 
02663               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a107">context_checkInternalUse</a> ())
02664                 {
02665                   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a111">context_globAccess</a> (el))
02666                     {
02667                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a165">sRef_isSystemState</a> (el)
02668                           &amp;&amp; !<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODFILESYSTEM))
02669                         {
02670                           ;
02671                         }
02672                       <font class="keywordflow">else</font>
02673                         {
02674                           voptgenerror
02675                             (FLG_INTERNALGLOBS,
02676                              message 
02677                              (<font class="stringliteral">"Called procedure %s may access %q, but "</font>
02678                               <font class="stringliteral">"globals list does not include globals %s"</font>,
02679                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f),
02680                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el),
02681                               cstring_makeLiteralTemp (sRef_isInternalState (el)
02682                                                        ? <font class="stringliteral">"internalState"</font>
02683                                                        : <font class="stringliteral">"fileSystem"</font>)),
02684                              f-&gt;loc);
02685                         }
02686                     }
02687                 }
02688             }
02689           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (el) || <a class="code" href="sRef_c.html#a163">sRef_isSpecState</a> (el))
02690             {
02691               ;
02692             }
02693           <font class="keywordflow">else</font>
02694             {
02695               uentry gle = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (el);
02696               sRef sr = <a class="code" href="sRef_c.html#a94">sRef_updateSref</a> (el);
02697               
02698               <font class="keywordflow">if</font> (sRef_isUndefGlob (el))
02699                 {
02700                   <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sr, f-&gt;loc);
02701                   <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (f, sr);
02702                 }
02703               <font class="keywordflow">else</font>
02704                 {
02705                   <font class="comment">/*</font>
02706 <font class="comment">                  ** check definition</font>
02707 <font class="comment">                  */</font>
02708                   
02709                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (el))
02710                     {
02711                       <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (f, sr);
02712                     }
02713                   <font class="keywordflow">else</font>
02714                     {
02715                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a312">sRef_isStateUndefined</a> (sr))
02716                         {
02717                           voptgenerror 
02718                             (FLG_GLOBSTATE,
02719                              message
02720                              (<font class="stringliteral">"%s %q used by function undefined before call: %s"</font>,
02721                               <a class="code" href="sRef_c.html#a305">sRef_getScopeName</a> (sr),
02722                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (sr),
02723                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f)),
02724                              f-&gt;loc);
02725                           <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sr, f-&gt;loc);
02726                         }
02727                       exprNode_checkUse (f, sr, f-&gt;loc);
02728                     }
02729                   
02730                   checkGlobUse (gle, TRUE, f);
02731                 }
02732           
02733               <font class="keywordflow">if</font> (sRef_isKilledGlob (el))
02734                 {
02735                   <a class="code" href="sRef_c.html#a229">sRef_kill</a> (sr, f-&gt;loc);
02736                   <a class="code" href="context_c.html#a109">context_usedGlobal</a> (sr);
02737                 }
02738             }
02739         }
02740     } end_globSet_allElements;
02741   
02742   <font class="comment">/*</font>
02743 <font class="comment">  ** check modifies</font>
02744 <font class="comment">  */</font>
02745 
02746   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a118">context_hasMods</a> () || <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODNOMODS))
02747     {
02748       sRefSet smods = sRefSet_undefined;
02749 
02750       <font class="comment">/*</font>
02751 <font class="comment">      ** NEED to check for modifies anything</font>
02752 <font class="comment">      */</font>
02753 
02754       <font class="comment">/*</font>
02755 <font class="comment">      ** check each sRef that called function modifies (ml), is</font>
02756 <font class="comment">      ** modifiable by tl</font>
02757 <font class="comment">      */</font>
02758 
02759       setCodePoint ();
02760 
02761       sRefSet_allElements (mods, s) <font class="comment">/* s is something which may be modified */</font>
02762         {
02763           <font class="keywordflow">if</font> (sRef_isKindSpecial (s))
02764             {
02765               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a162">sRef_isSpecInternalState</a> (s))
02766                 {
02767                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODINTERNALSTRICT))
02768                     {
02769                       <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (s, args, f, ret);
02770                     }
02771                   <font class="keywordflow">else</font>
02772                     {
02773                       sRefSet mmods = <a class="code" href="context_c.html#a110">context_modList</a> ();
02774 
02775                       sRefSet_allElements (mmods, el)<font class="keyword"></font>
02776 <font class="keyword">                        </font>{
02777                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (el))
02778                             {
02779                               <a class="code" href="sRef_c.html#a98">sRef_setModified</a> (el);
02780                             }
02781                         } end_sRefSet_allElements ;
02782                     }
02783                 }
02784               <font class="keywordflow">else</font>
02785                 {
02786                   <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (s, args, f, ret);
02787                 }
02788             }
02789           <font class="keywordflow">else</font>
02790             {
02791               sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
02792               
02793               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (rb))
02794                 {
02795                   <a class="code" href="context_c.html#a109">context_usedGlobal</a> (rb);
02796                 }
02797               
02798               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (s)
02799                   &amp;&amp; !fileId_equal (fileloc_fileId (f-&gt;loc), 
02800                                     fileloc_fileId (uentry_whereDefined (le))))
02801                 {
02802                   smods = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (smods, s);
02803                 }
02804               <font class="keywordflow">else</font>
02805                 {
02806                   <a class="code" href="exprChecks_c.html#a21">exprNode_checkCallModifyVal</a> (s, args, f, ret);
02807                 }
02808             }
02809         } end_sRefSet_allElements;
02810 
02811       setCodePoint ();
02812 
02813       <font class="comment">/*</font>
02814 <font class="comment">      ** Static elements in modifies set can have nasty consequences.</font>
02815 <font class="comment">      ** (I think...have not been able to reproduce a possible bug.)</font>
02816 <font class="comment">      */</font>
02817 
02818       <font class="keywordflow">if</font> (!sRefSet_isDefined (smods))
02819         {
02820           mods = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (mods);
02821           freshMods = TRUE;
02822           
02823           sRefSet_allElements (smods, el)<font class="keyword"></font>
02824 <font class="keyword">            </font>{
02825               <font class="keywordtype">bool</font> res = <a class="code" href="sRefSet_c.html#a7">sRefSet_delete</a> (mods, el);
02826               
02827               llassert (res);
02828             } end_sRefSet_allElements;
02829 
02830           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (smods);
02831         <font class="comment">/*@-branchstate@*/</font>
02832         } 
02833       <font class="comment">/*@=branchstate@*/</font>
02834     }
02835   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRefSet_isDefined (mods))
02836     { <font class="comment">/* just check observers */</font>
02837       setCodePoint ();
02838 
02839       sRefSet_allElements (mods, s) <font class="comment">/* s is something which may be modified */</font>
02840         {
02841           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
02842 
02843           setCodePoint ();
02844 
02845           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a246">sRef_isParam</a> (rb))
02846             {
02847               sRef b = <a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s, args);
02848 
02849               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (b))
02850                 {
02851                   exprNode e = <a class="code" href="exprNodeList_c.html#a10">exprNodeList_nth</a> (args, sRef_getParam (rb));
02852                   
02853                   <font class="keywordflow">if</font> (optgenerror 
02854                       (FLG_MODOBSERVER,
02855                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Function call may modify observer%q: %s"</font>, 
02856                                 sRef_unparsePreOpt (b), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
02857                        <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e)))
02858                     {
02859                       <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (b);
02860                     }
02861                 }
02862             }
02863         } end_sRefSet_allElements;
02864     }
02865   <font class="keywordflow">else</font> 
02866     {
02867       <font class="keywordflow">if</font> (!hasMods) <font class="comment">/* no specified modifications */</font>
02868         {
02869           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_MODOBSERVERUNCON))
02870             {
02871               exprNodeList_elements (args, e)<font class="keyword"></font>
02872 <font class="keyword">                </font>{
02873                   <font class="keywordflow">if</font> (exprNode_isDefined (e))
02874                     {
02875                       sRef s = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (e);
02876                       
02877                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (s) 
02878                           &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (sRef_getType (s)))
02879                         {
02880                           <font class="keywordflow">if</font> (optgenerror 
02881                               (FLG_MODOBSERVERUNCON,
02882                                message
02883                                (<font class="stringliteral">"Call to unconstrained function %s may modify observer%q: %s"</font>, 
02884                                 <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f),
02885                                 <a class="code" href="sRef_c.html#a122">sRef_unparsePreOpt</a> (s), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
02886                                <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e)))
02887                             {
02888                               <a class="code" href="sRef_c.html#a300">sRef_showExpInfo</a> (s);
02889                             }
02890                         }
02891                     }
02892                 } end_exprNodeList_elements; 
02893             }
02894         }
02895     }
02896   
02897   checkAnyCall (f, fname, params, args, hasMods, mods, isSpec, specialArgs);
02898 
02899   ret-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;uses, f-&gt;uses);
02900   ret-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;sets, f-&gt;sets);
02901   ret-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;msets, f-&gt;msets);
02902 
02903   <font class="keywordflow">if</font> (freshMods)
02904     {
02905       <font class="comment">/*</font>
02906 <font class="comment">      ** Spurious errors reported, because lclint can't tell</font>
02907 <font class="comment">      ** mods must be fresh if freshMods is true.</font>
02908 <font class="comment">      */</font>
02909 
02910       <font class="comment">/*@i@*/</font> <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (mods);
02911     }
02912 
02913   setCodePoint ();
02914 }
02915 
02916 <font class="keywordtype">void</font> checkGlobUse (uentry glob, <font class="keywordtype">bool</font> isCall, <font class="comment">/*@notnull@*/</font> exprNode e)<font class="keyword"></font>
02917 <font class="keyword"></font>{
02918   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a161">uentry_isVar</a> (glob))
02919     {
02920       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a175">context_inFunctionLike</a> ())
02921         {
02922           sRef sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (glob);
02923 
02924           <a class="code" href="context_c.html#a109">context_usedGlobal</a> (sr);
02925           
02926           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a105">context_checkGlobUse</a> (glob))
02927             {
02928               <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a111">context_globAccess</a> (sr))
02929                 {
02930                   <font class="keywordflow">if</font> (isCall)
02931                     {
02932                       voptgenerror
02933                         (FLG_GLOBALS,
02934                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Called procedure %s may access %s %q"</font>,
02935                                   exprNode_unparse (e), 
02936                                   <a class="code" href="sRef_c.html#a306">sRef_unparseScope</a> (sr),
02937                                   <a class="code" href="uentry_c.html#a195">uentry_getName</a> (glob)),
02938                          e-&gt;loc);
02939                     }
02940                   <font class="keywordflow">else</font>
02941                     {
02942                       voptgenerror 
02943                         (FLG_GLOBALS,
02944                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undocumented use of %s %s"</font>, 
02945                                   sRef_unparseScope (sr),
02946                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
02947                          e-&gt;loc);
02948                     }
02949                 }
02950             }
02951         }
02952     }
02953   <font class="keywordflow">else</font>
02954     {
02955       llbug (message (<font class="stringliteral">"Global not variable: %q"</font>, uentry_unparse (glob)));
02956     }
02957 }  
02958 
02959 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNode
02960 functionCallSafe (<font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> exprNode f,
02961                   ctype t, <font class="comment">/*@keep@*/</font> exprNodeList args)<font class="keyword"></font>
02962 <font class="keyword"></font>{
02963   <font class="comment">/* requires f is a non-error exprNode, with type function */</font>
02964   cstring fname = <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (f);
02965   uentry le = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (f);
02966   exprNode ret = exprNode_createPartialCopy (f);
02967   <font class="keywordtype">int</font> special;
02968 
02969   setCodePoint ();
02970         
02971   ret-&gt;typ = <a class="code" href="ctype_c.html#a39">ctype_returnValue</a> (t);
02972   ret-&gt;kind = XPR_CALL;
02973 
02974   ret-&gt;edata = exprData_makeCall (f, args);
02975 
02976   <font class="comment">/*</font>
02977 <font class="comment">  ** Order of these steps is very important!  </font>
02978 <font class="comment">  **</font>
02979 <font class="comment">  ** Must check for argument dependencies before messing up uses and sets.</font>
02980 <font class="comment">  */</font>
02981 
02982   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_EVALORDER))
02983     {
02984       exprNodeList_elements (args, current)<font class="keyword"></font>
02985 <font class="keyword">        </font>{
02986           <font class="keywordflow">if</font> (exprNode_isDefined (current))
02987             {
02988               exprNode_addUse (current, current-&gt;sref);
02989             }
02990         } end_exprNodeList_elements;
02991 
02992       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EVALORDER) || <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EVALORDERUNCON))
02993         {
02994           checkSequencing (f, args); 
02995         }
02996       
02997       exprNodeList_elements (args, current)<font class="keyword"></font>
02998 <font class="keyword">        </font>{
02999           <font class="keywordflow">if</font> (exprNode_isDefined (current) &amp;&amp; sRef_isMeaningful (current-&gt;sref))
03000             {
03001               exprNode_addUse (ret, sRef_makeDerived (current-&gt;sref));
03002             }
03003         } end_exprNodeList_elements ;
03004     }
03005 
03006   special = checkArgs (le, f, t, args, ret); 
03007   checkGlobMods (f, le, args, ret, special); 
03008 
03009   setCodePoint ();
03010 
03011   <font class="keywordflow">if</font> (uentry_isValid (le)
03012       &amp;&amp; (uentry_isFunction (le) 
03013           || (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (le)
03014               &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (uentry_getType (le)))))
03015     {
03016       exitkind exk = <a class="code" href="uentry_c.html#a179">uentry_getExitCode</a> (le);
03017 
03018       <font class="comment">/* f-&gt;typ is already set to the return type */</font>
03019 
03020       ret-&gt;sref = <a class="code" href="uentry_c.html#a280">uentry_returnedRef</a> (le, args);
03021 
03022       <font class="keywordflow">if</font> (uentry_isFunction (le) &amp;&amp; exprNodeList_size (args) &gt;= 1)
03023         {
03024           qual nullPred = <a class="code" href="uentry_c.html#a180">uentry_nullPred</a> (le);
03025 
03026           <font class="keywordflow">if</font> (qual_isTrueNull (nullPred))
03027             {
03028               exprNode arg = <a class="code" href="exprNodeList_c.html#a5">exprNodeList_head</a> (args);
03029 
03030               <font class="keywordflow">if</font> (exprNode_isDefined (arg))
03031                 {
03032                   ret-&gt;guards = <a class="code" href="guardSet_c.html#a14">guardSet_addFalseGuard</a> (ret-&gt;guards, arg-&gt;sref);
03033                 }
03034             }
03035           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qual_isFalseNull (nullPred))
03036             {
03037               exprNode arg = <a class="code" href="exprNodeList_c.html#a5">exprNodeList_head</a> (args);
03038               
03039               <font class="keywordflow">if</font> (exprNode_isDefined (arg))
03040                 {
03041                   ret-&gt;guards = <a class="code" href="guardSet_c.html#a13">guardSet_addTrueGuard</a> (ret-&gt;guards, arg-&gt;sref);
03042                 }
03043             }
03044           <font class="keywordflow">else</font>
03045             {
03046               llassert (qual_isUnknown (nullPred));
03047             }
03048         }
03049       
03050       <font class="keywordflow">if</font> (exitkind_isConditionalExit (exk))
03051         {
03052           <font class="comment">/*</font>
03053 <font class="comment">          ** True exit is: </font>
03054 <font class="comment">          **    if (arg0) then { exit! } else { ; }</font>
03055 <font class="comment">          ** False exit is:</font>
03056 <font class="comment">          **    if (arg0) then { ; } else { exit! }</font>
03057 <font class="comment">          */</font>
03058 
03059           exprNode firstArg;
03060 
03061           llassert (!exprNodeList_isEmpty (args));
03062           firstArg = <a class="code" href="exprNodeList_c.html#a5">exprNodeList_head</a> (args);
03063 
03064           <font class="keywordflow">if</font> (exprNode_isDefined (firstArg)
03065               &amp;&amp; !<a class="code" href="guardSet_c.html#a19">guardSet_isEmpty</a> (firstArg-&gt;guards))
03066             {
03067               <a class="code" href="usymtab_c.html#a88">usymtab_trueBranch</a> (guardSet_undefined);
03068               <a class="code" href="usymtab_c.html#a99">usymtab_altBranch</a> (guardSet_undefined);
03069               
03070               <font class="keywordflow">if</font> (exitkind_isTrueExit (exk))
03071                 {
03072                   <a class="code" href="usymtab_c.html#a97">usymtab_popBranches</a> (firstArg, 
03073                                        exprNode_makeMustExit (), 
03074                                        exprNode_undefined,
03075                                        TRUE, TRUEEXITCLAUSE);
03076                 }
03077               <font class="keywordflow">else</font>
03078                 {
03079                   <a class="code" href="usymtab_c.html#a97">usymtab_popBranches</a> (firstArg,
03080                                        exprNode_undefined,
03081                                        exprNode_makeMustExit (), 
03082                                        TRUE, FALSEEXITCLAUSE);
03083                 }
03084             }
03085 
03086           ret-&gt;exitCode = XK_MAYEXIT;
03087         }
03088       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (exitkind_mustExit (exk))
03089         {
03090           ret-&gt;exitCode = XK_MUSTEXIT;
03091         }
03092       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="varKinds_c.html#a26">exitkind_couldExit</a> (exk))
03093         {
03094           ret-&gt;exitCode = XK_MAYEXIT;
03095         }
03096       <font class="keywordflow">else</font>
03097         {
03098           ;
03099         }
03100       
03101       <font class="keywordflow">if</font> (cstring_equalLit (fname, <font class="stringliteral">"exit"</font>))
03102         {
03103           <font class="keywordflow">if</font> (exprNodeList_size (args) == 1)
03104             {
03105               exprNode arg = <a class="code" href="exprNodeList_c.html#a5">exprNodeList_head</a> (args);
03106               
03107               <font class="keywordflow">if</font> (exprNode_isDefined (arg) &amp;&amp; exprNode_knownIntValue (arg))
03108                 {
03109                   <font class="keywordtype">long</font> <font class="keywordtype">int</font> val = <a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (exprNode_getValue (arg));
03110                   
03111                   <font class="keywordflow">if</font> (val != 0)
03112                     {
03113                       voptgenerror
03114                         (FLG_EXITARG,
03115                          message 
03116                          (<font class="stringliteral">"Argument to exit has implementation defined behavior: %s"</font>,
03117                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (arg)),
03118                          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (arg));
03119                     }
03120                 }
03121             }
03122         }
03123     }
03124   <font class="keywordflow">else</font>
03125     {
03126       ret-&gt;sref = defref;
03127       exprNode_checkSetAny (ret, uentry_rawName (le));
03128     }
03129 
03130   <font class="keywordflow">return</font> (ret);
03131 }
03132 
03133 <font class="comment">/*</font>
03134 <font class="comment">** this is yucky!  should keep the uentry as part of exprNode!</font>
03135 <font class="comment">*/</font>
03136 
03137 <font class="comment">/*@observer@*/</font> uentry
<a name="l03138"></a><a class="code" href="exprNode_c.html#a93">03138</a> <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (exprNode e)<font class="keyword"></font>
03139 <font class="keyword"></font>{
03140   <font class="keywordflow">if</font> (exprNode_isError (e))
03141     {
03142       <font class="keywordflow">return</font> uentry_undefined;
03143     }
03144   <font class="keywordflow">else</font>
03145     {
03146       cstring s = exprNode_rootVarName (e);
03147       uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (s);
03148 
03149       <font class="keywordflow">return</font> ue;
03150     }
03151 }
03152 
03153 exprNode 
<a name="l03154"></a><a class="code" href="exprNode_c.html#a94">03154</a> <a class="code" href="exprNode_c.html#a94">exprNode_makeInitBlock</a> (lltok brace, <font class="comment">/*@only@*/</font> exprNodeList inits)<font class="keyword"></font>
03155 <font class="keyword"></font>{
03156   exprNode ret = exprNode_createPlain (ctype_unknown);
03157 
03158   ret-&gt;kind = XPR_INITBLOCK;
03159   ret-&gt;edata = exprData_makeCall (exprNode_undefined, inits);
03160   ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, lltok_getLoc (brace));
03161 
03162   <font class="keywordflow">return</font> (ret);
03163 }
03164 
03165 exprNode
<a name="l03166"></a><a class="code" href="exprNode_c.html#a95">03166</a> <a class="code" href="exprNode_c.html#a95">exprNode_functionCall</a> (<font class="comment">/*@only@*/</font> exprNode f, <font class="comment">/*@only@*/</font> exprNodeList args)<font class="keyword"></font>
03167 <font class="keyword"></font>{
03168   ctype t;
03169 
03170   setCodePoint ();
03171 
03172   <font class="keywordflow">if</font> (exprNode_isUndefined (f))
03173     {
03174       <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (f);
03175       <a class="code" href="exprNodeList_c.html#a12">exprNodeList_free</a> (args);
03176       <font class="keywordflow">return</font> exprNode_undefined;
03177     }
03178 
03179   t = exprNode_getType (f);
03180 
03181   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (f-&gt;sref))
03182     {
03183       exprNode_checkUse (f, f-&gt;sref, f-&gt;loc);
03184 
03185       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (f-&gt;sref))
03186         {
03187           <font class="keywordflow">if</font> (!<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (f-&gt;sref))
03188             {
03189               <font class="keywordflow">if</font> (optgenerror (FLG_NULLDEREF,
03190                                message (<font class="stringliteral">"Function call using %s pointer %q"</font>, 
03191                                         sRef_nullMessage (f-&gt;sref),
03192                                         <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (f-&gt;sref)),
03193                                f-&gt;loc))
03194                 {
03195                   <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (f-&gt;sref);
03196                   <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (f-&gt;sref);
03197                 }
03198             }
03199         }
03200     }
03201 
03202   setCodePoint ();
03203 
03204   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a77">ctype_isRealFunction</a> (t))
03205     {
03206       exprNode ret = functionCallSafe (f, t, args);
03207       setCodePoint ();
03208       <font class="keywordflow">return</font> ret;
03209     }
03210   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ctype_isUnknown (t))
03211     {
03212       exprNode ret = exprNode_createPartialCopy (f);
03213       cstring tstring;
03214 
03215       setCodePoint ();
03216       
03217       ret-&gt;typ = t;
03218       exprNodeList_elements (args, current)<font class="keyword"></font>
03219 <font class="keyword">        </font>{
03220           <font class="keywordflow">if</font> (exprNode_isDefined (current))
03221             {
03222               exprNode_checkUse (ret, current-&gt;sref, ret-&gt;loc);
03223 
03224               <font class="comment">/* </font>
03225 <font class="comment">              ** also, anything derivable from current-&gt;sref may be used </font>
03226 <font class="comment">              */</font>
03227 
03228               exprNode_addUse (ret, sRef_makeDerived (current-&gt;sref));
03229               exprNode_mergeUSs (ret, current);
03230             }
03231         } end_exprNodeList_elements;
03232 
03233       ret-&gt;edata = exprData_makeCall (f, args);
03234       ret-&gt;kind = XPR_CALL;
03235 
03236       tstring = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprNode_unparse (f));
03237 
03238       <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (tstring);
03239       exprNode_checkSetAny (ret, tstring);
03240 
03241       <font class="keywordflow">return</font> (ret);
03242     }
03243   <font class="keywordflow">else</font>
03244     {
03245       voptgenerror (FLG_TYPE,
03246                     message (<font class="stringliteral">"Call to non-function (type %t): %s"</font>, t, 
03247                              exprNode_unparse (f)),
03248                     f-&gt;loc);
03249       <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (f);
03250       <a class="code" href="exprNodeList_c.html#a12">exprNodeList_free</a> (args);
03251 
03252       <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a58">exprNode_makeError</a> ());
03253     }
03254 }
03255 
03256 exprNode
<a name="l03257"></a><a class="code" href="exprNode_c.html#a96">03257</a> <a class="code" href="exprNode_c.html#a96">exprNode_fieldAccess</a> (<font class="comment">/*@only@*/</font> exprNode s, <font class="comment">/*@only@*/</font> cstring f)<font class="keyword"></font>
03258 <font class="keyword"></font>{
03259   exprNode ret = exprNode_createPartialCopy (s);
03260 
03261   ret-&gt;kind = XPR_FACCESS;
03262 
03263   <font class="keywordflow">if</font> (exprNode_isError (s))
03264     {
03265       ret-&gt;edata = exprData_makeField (s, f);
03266       <font class="keywordflow">return</font> ret;
03267     }
03268   <font class="keywordflow">else</font>
03269     {
03270       ctype t = exprNode_getType (s);
03271       ctype tr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (t);
03272       
03273       checkMacroParen (s);
03274 
03275       ret-&gt;edata = exprData_makeField (s, f);
03276       
03277       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (tr))
03278         {
03279           uentry tf = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (tr), f);
03280 
03281           <font class="keywordflow">if</font> (uentry_isUndefined (tf))
03282             {
03283               voptgenerror (FLG_TYPE,
03284                             message (<font class="stringliteral">"Access non-existent field %s of %t: %s"</font>, f, t, 
03285                                      exprNode_unparse (ret)),
03286                             s-&gt;loc);
03287               
03288               <font class="keywordflow">return</font> (ret);
03289             }
03290           <font class="keywordflow">else</font>
03291             {
03292               <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (tf, exprNode_loc (ret));
03293 
03294               ret-&gt;typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (tf); 
03295               checkSafeUse (ret, s-&gt;sref);
03296               
03297               ret-&gt;sref = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (s-&gt;sref, uentry_rawName (tf));
03298               <font class="keywordflow">return</font> (ret);
03299             }
03300         }
03301       <font class="keywordflow">else</font> <font class="comment">/* isStructorUnion */</font>
03302         {
03303           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr))
03304             {
03305               voptgenerror
03306                 (FLG_ABSTRACT,
03307                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Access field of abstract type (%t): %s.%s"</font>, 
03308                           t, exprNode_unparse (s), f),
03309                  s-&gt;loc);
03310               ret-&gt;typ = ctype_unknown;
03311             }
03312           <font class="keywordflow">else</font>
03313             {
03314               <font class="keywordflow">if</font> (ctype_isKnown (tr))
03315                 {
03316                   voptgenerror 
03317                     (FLG_TYPE,
03318                      message
03319                      (<font class="stringliteral">"Access field of non-struct or union (%t): %s.%s"</font>,
03320                       t, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (s), f),
03321                      s-&gt;loc);
03322 
03323                   ret-&gt;typ = ctype_unknown;
03324                 }
03325               <font class="keywordflow">else</font>
03326                 {
03327                   cstring sn = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (f);
03328 
03329                   checkSafeUse (ret, s-&gt;sref);
03330                   <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (sn);
03331                   ret-&gt;sref = <a class="code" href="sRef_c.html#a279">sRef_makeField</a> (s-&gt;sref, sn);
03332 
03333                   <font class="keywordflow">return</font> (ret);
03334                 }
03335             }
03336           <font class="keywordflow">return</font> (ret);
03337         }
03338     }
03339   BADEXIT;
03340 }
03341 
03342 exprNode
<a name="l03343"></a><a class="code" href="exprNode_c.html#a97">03343</a> <a class="code" href="exprNode_c.html#a97">exprNode_addParens</a> (<font class="comment">/*@only@*/</font> lltok lpar, <font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
03344 <font class="keyword"></font>{
03345   exprNode ret = exprNode_createPartialCopy (e);
03346 
03347   ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, lltok_getLoc (lpar));
03348   ret-&gt;kind = XPR_PARENS;
03349   ret-&gt;edata = exprData_makeUop (e, lpar);
03350 
03351   <font class="keywordflow">if</font> (!exprNode_isError (e))
03352     {
03353       ret-&gt;exitCode = e-&gt;exitCode;
03354       ret-&gt;canBreak = e-&gt;canBreak;
03355       ret-&gt;mustBreak = e-&gt;mustBreak;
03356       ret-&gt;isJumpPoint = e-&gt;isJumpPoint;
03357       ret-&gt;sref = e-&gt;sref;
03358     }
03359 
03360   <font class="keywordflow">return</font> ret;
03361 }
03362 
03363 exprNode
<a name="l03364"></a><a class="code" href="exprNode_c.html#a98">03364</a> <a class="code" href="exprNode_c.html#a98">exprNode_arrowAccess</a> (<font class="comment">/*@only@*/</font> exprNode s, <font class="comment">/*@only@*/</font> cstring f)<font class="keyword"></font>
03365 <font class="keyword"></font>{
03366   exprNode ret = exprNode_createPartialCopy (s);
03367 
03368   ret-&gt;edata = exprData_makeField (s, f);
03369   ret-&gt;kind = XPR_ARROW;
03370 
03371   <font class="keywordflow">if</font> (exprNode_isError (s))
03372     {
03373       <font class="keywordflow">return</font> (ret);
03374     }
03375   <font class="keywordflow">else</font>
03376     {
03377        ctype t = exprNode_getType (s);
03378        ctype tr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (t);
03379 
03380        checkMacroParen (s);
03381 
03382        (<font class="keywordtype">void</font>) <a class="code" href="ctype_c.html#a123">ctype_fixArrayPtr</a> (tr); <font class="comment">/* REWRITE THIS */</font>
03383 
03384        <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr)) 
03385          {
03386            ctype b = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_baseArrayPtr (tr));
03387            
03388            <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (b))
03389              {
03390                uentry fentry = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (b), f);
03391                
03392                <font class="keywordflow">if</font> (sRef_isKnown (s-&gt;sref) &amp;&amp; <a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (s-&gt;sref))
03393                  {
03394                    <font class="keywordflow">if</font> (!<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (s-&gt;sref) &amp;&amp; !<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
03395                      {
03396                        <font class="keywordflow">if</font> (optgenerror 
03397                            (FLG_NULLDEREF,
03398                             <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Arrow access from %s pointer%q: %s"</font>, 
03399                                      sRef_nullMessage (s-&gt;sref),
03400                                      <a class="code" href="sRef_c.html#a122">sRef_unparsePreOpt</a> (s-&gt;sref),
03401                                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03402                             s-&gt;loc))
03403                          {
03404                            <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (s-&gt;sref);
03405                            <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (s-&gt;sref);
03406                          }
03407                      }
03408                  }
03409                
03410                <font class="keywordflow">if</font> (uentry_isUndefined (fentry))
03411                  {
03412                    voptgenerror 
03413                      (FLG_TYPE,
03414                       <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Access non-existent field %s of %t: %s"</font>, 
03415                                f, t, exprNode_unparse (ret)),
03416                       s-&gt;loc);
03417                    ret-&gt;typ = ctype_unknown;
03418                    
03419                    <font class="keywordflow">return</font> (ret);
03420                  }
03421                <font class="keywordflow">else</font>
03422                  {
03423                    <font class="comment">/*</font>
03424 <font class="comment">                   ** was safeUse: shouldn't be safe!</font>
03425 <font class="comment">                   **</font>
03426 <font class="comment">                   ** to do rec-&gt;field</font>
03427 <font class="comment">                   ** rec must be defined,</font>
03428 <font class="comment">                   ** *rec must be allocated</font>
03429 <font class="comment">                   ** rec-&gt;field need only be defined it if is an rvalue</font>
03430 <font class="comment">                   */</font>
03431                    
03432                    <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (fentry, exprNode_loc (ret));
03433                    ret-&gt;typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (fentry);
03434                    
03435                    exprNode_checkUse (ret, s-&gt;sref, s-&gt;loc);
03436                    
03437                    <font class="comment">/* exprNode_checkUse (ret, sRef_makePointer (s-&gt;sref), s-&gt;loc); */</font>
03438                    ret-&gt;sref = <a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (s-&gt;sref, uentry_rawName (fentry));
03439                    <font class="keywordflow">return</font> (ret);
03440                  }
03441              }
03442            <font class="keywordflow">else</font> <font class="comment">/* Pointer to something that is not a struct or union*/</font>
03443              {
03444                <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr))
03445                  {
03446                    ctype xrt = <a class="code" href="ctype_c.html#a29">ctype_forceRealType</a> (tr);
03447                    
03448                    voptgenerror 
03449                      (FLG_ABSTRACT,
03450                       <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Arrow access field of abstract type (%t): %s-&gt;%s"</font>, 
03451                                t, exprNode_unparse (s), f),
03452                       s-&gt;loc);
03453                    
03454                    <font class="comment">/*</font>
03455 <font class="comment">                   ** Set the state correctly, as if the abstraction is broken.</font>
03456 <font class="comment">                   */</font>
03457                    
03458                    <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (xrt) &amp;&amp;
03459                        (b = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_baseArrayPtr (xrt)),
03460                         <a class="code" href="ctype_c.html#a122">ctype_isStructorUnion</a> (b)))
03461                      {
03462                        uentry fentry = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (ctype_getFields (b), f);
03463                        ret-&gt;typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (fentry);
03464                        ret-&gt;sref = <a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (s-&gt;sref, uentry_rawName (fentry));
03465                      }
03466                    <font class="keywordflow">else</font>
03467                      {
03468                        ret-&gt;typ = ctype_unknown;
03469                        ret-&gt;sref = sRef_undefined;
03470                      }
03471                  }
03472                <font class="keywordflow">else</font> <font class="comment">/* not a struct, union or abstract */</font>
03473                  {
03474                    <font class="keywordflow">if</font> (ctype_isUnknown (tr)) {
03475                      cstring sn = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (f);
03476                      
03477                      DPRINTF ((<font class="stringliteral">"Here: %s"</font>, exprNode_unparse (s)));
03478                      
03479                      exprNode_checkUse (ret, s-&gt;sref, s-&gt;loc);
03480                      exprNode_checkUse (ret, sRef_makePointer (s-&gt;sref), s-&gt;loc);
03481                      
03482                      <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (sn);
03483                      ret-&gt;sref = <a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (s-&gt;sref, sn);
03484                      
03485                      ret-&gt;kind = XPR_ARROW;
03486                      <font class="keywordflow">return</font> (ret);
03487                    } <font class="keywordflow">else</font> {
03488                      voptgenerror 
03489                        (FLG_TYPE,
03490                         <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Arrow access field of non-struct or union "</font>
03491                                  <font class="stringliteral">"pointer (%t): %s-&gt;%s"</font>,
03492                                  t, exprNode_unparse (s), f),
03493                         s-&gt;loc);
03494                      
03495                      ret-&gt;typ = ctype_unknown;
03496                      ret-&gt;sref = sRef_undefined;
03497                    }
03498                  }
03499              }
03500          }
03501        <font class="keywordflow">else</font> <font class="comment">/* its not a pointer */</font>
03502          {
03503            <font class="keywordflow">if</font> (!ctype_isUnknown (tr))
03504              {
03505                voptgenerror 
03506                  (FLG_TYPE,
03507                   <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Arrow access of non-pointer (%t): %s-&gt;%s"</font>,
03508                            t, exprNode_unparse (s), f),
03509                   s-&gt;loc);
03510                
03511                ret-&gt;typ = ctype_unknown;
03512                ret-&gt;sref = sRef_undefined;
03513              }
03514            <font class="keywordflow">else</font>
03515              {
03516                cstring sn = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (f);
03517                
03518                DPRINTF ((<font class="stringliteral">"Here: %s"</font>, exprNode_unparse (s)));
03519                
03520                exprNode_checkUse (ret, s-&gt;sref, s-&gt;loc);
03521                exprNode_checkUse (ret, sRef_makePointer (s-&gt;sref), s-&gt;loc);
03522                
03523                <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (sn);
03524                ret-&gt;sref = <a class="code" href="sRef_c.html#a328">sRef_makeArrow</a> (s-&gt;sref, sn);
03525                
03526                ret-&gt;kind = XPR_ARROW;
03527                <font class="keywordflow">return</font> (ret);
03528              }
03529          }
03530 
03531       <font class="keywordflow">return</font> (ret);
03532     }
03533   BADEXIT;
03534 }
03535 
03536 <font class="comment">/*</font>
03537 <font class="comment">** only postOp's in C: i++ and i--</font>
03538 <font class="comment">*/</font>
03539 
03540 exprNode
<a name="l03541"></a><a class="code" href="exprNode_c.html#a99">03541</a> <a class="code" href="exprNode_c.html#a99">exprNode_postOp</a> (<font class="comment">/*@only@*/</font> exprNode e, <font class="comment">/*@only@*/</font> lltok op)<font class="keyword"></font>
03542 <font class="keyword"></font>{
03543   <font class="comment">/* check modification also */</font>
03544   <font class="comment">/* cstring opname = lltok_unparse (op);*/</font>
03545   ctype t;
03546   exprNode ret = exprNode_createPartialCopy (e);
03547 
03548   ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, lltok_getLoc (op));
03549   ret-&gt;kind = XPR_POSTOP;
03550   ret-&gt;edata = exprData_makeUop (e, op);
03551 
03552   <font class="keywordflow">if</font> (!exprNode_isDefined (e))
03553     {
03554       <font class="keywordflow">return</font> ret;
03555     }
03556 
03557   checkMacroParen (e);
03558 
03559   exprNode_checkUse (ret, e-&gt;sref, e-&gt;loc);
03560   <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (ret, e-&gt;sref);
03561 
03562   t = exprNode_getType (e);
03563 
03564   <font class="keywordflow">if</font> (sRef_isUnsafe (e-&gt;sref))
03565     {
03566       voptgenerror (FLG_MACROPARAMS,
03567                     message (<font class="stringliteral">"Operand of %s is macro parameter (non-functional): %s%s"</font>, 
03568                              lltok_unparse (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op)),
03569                     e-&gt;loc);
03570       <a class="code" href="sRef_c.html#a167">sRef_makeSafe</a> (e-&gt;sref);
03571       <a class="code" href="sRef_c.html#a167">sRef_makeSafe</a> (ret-&gt;sref);
03572     }
03573 
03574   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;t) || <a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (t))
03575     {
03576       ret-&gt;typ = e-&gt;typ;
03577     }
03578   <font class="keywordflow">else</font>
03579     {
03580       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (t))
03581         {
03582           voptgenerror 
03583             (FLG_ABSTRACT,
03584              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is abstract type (%t): %s"</font>,
03585                       lltok_unparse (op), t, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
03586              e-&gt;loc);
03587         }
03588       <font class="keywordflow">else</font>
03589         {
03590           voptgenerror 
03591             (FLG_TYPE,
03592              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-numeric (%t): %s"</font>,
03593                       lltok_unparse (op), t, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
03594              e-&gt;loc);
03595         }
03596       ret-&gt;typ = ctype_unknown;
03597     }
03598 
03599   <font class="comment">/* if (ctype_isZero (t)) e-&gt;typ = ctype_int; */</font>
03600 
03601   <a class="code" href="exprChecks_c.html#a7">exprNode_checkModify</a> (e, ret);
03602 
03603   <font class="keywordflow">return</font> ret;
03604 }
03605 
03606 exprNode
<a name="l03607"></a><a class="code" href="exprNode_c.html#a100">03607</a> <a class="code" href="exprNode_c.html#a100">exprNode_preOp</a> (<font class="comment">/*@only@*/</font> exprNode e, <font class="comment">/*@only@*/</font> lltok op)<font class="keyword"></font>
03608 <font class="keyword"></font>{
03609   <font class="keywordtype">bool</font> checkMod = FALSE;
03610   ctype te, tr;
03611   <font class="keywordtype">int</font> opid = lltok_getTok (op);
03612   exprNode ret = exprNode_createSemiCopy (e);
03613 
03614   exprNode_copySets (ret, e);
03615 
03616   <a class="code" href="multiVal_c.html#a20">multiVal_free</a> (ret-&gt;val);
03617   ret-&gt;val = multiVal_undefined;
03618   ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, lltok_getLoc (op));
03619   ret-&gt;kind = XPR_PREOP;  
03620   ret-&gt;edata = exprData_makeUop (e, op);
03621   
03622   <font class="keywordflow">if</font> (exprNode_isError (e))
03623     {
03624       <font class="keywordflow">return</font> ret;
03625     }
03626   
03627   checkMacroParen (e);
03628   
03629   te = exprNode_getType (e);
03630   tr = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (te);
03631   
03632   <font class="keywordflow">if</font> (opid != TAMPERSAND)
03633     {
03634       exprNode_checkUse (ret, e-&gt;sref, e-&gt;loc);
03635       
03636       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr)
03637           &amp;&amp; (!(<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te) &amp;&amp; (opid == TEXCL))))
03638         {
03639           <font class="keywordflow">if</font> (optgenerror (FLG_ABSTRACT,
03640                            message (<font class="stringliteral">"Operand of %s is abstract type (%t): %s"</font>,
03641                                     lltok_unparse (op), tr,
03642                                     <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03643                            e-&gt;loc))
03644             {
03645               tr = te = ctype_unknown;
03646               ret-&gt;typ = ctype_unknown;
03647               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (e-&gt;sref);
03648             }
03649         }
03650     }
03651   
03652   <font class="keywordflow">switch</font> (opid)
03653     {
03654     <font class="keywordflow">case</font> INC_OP:
03655     <font class="keywordflow">case</font> DEC_OP:                <font class="comment">/* should also check modification! */</font>
03656       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (e-&gt;sref))
03657         {
03658           voptgenerror 
03659             (FLG_MACROPARAMS,
03660              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is macro parameter (non-functional): %s"</font>, 
03661                       lltok_unparse (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03662              e-&gt;loc);
03663         }
03664       <font class="keywordflow">else</font>
03665         {
03666           <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (ret, e-&gt;sref);
03667         }
03668       
03669       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr) || <a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (tr))
03670         {
03671         }
03672       <font class="keywordflow">else</font>
03673         {
03674           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a198">context_msgStrictOps</a> ())
03675             {
03676               voptgenerror 
03677                 (FLG_STRICTOPS,
03678                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-numeric (%t): %s"</font>,
03679                           lltok_unparse (op), te, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03680                  e-&gt;loc);
03681             }
03682           ret-&gt;typ = ctype_int;
03683         }
03684       
03685       checkMod = TRUE;
03686       <font class="keywordflow">break</font>;
03687       
03688     <font class="keywordflow">case</font> TMINUS:
03689     <font class="keywordflow">case</font> TPLUS:
03690       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr))
03691         {
03692           <font class="keywordflow">if</font> (opid == TMINUS)
03693             {
03694               ret-&gt;val = <a class="code" href="multiVal_c.html#a7">multiVal_invert</a> (exprNode_getValue (e));
03695             }
03696           <font class="keywordflow">else</font>
03697             {
03698               ret-&gt;val = <a class="code" href="multiVal_c.html#a6">multiVal_copy</a> (exprNode_getValue (e));
03699             }
03700         }
03701       <font class="keywordflow">else</font>
03702         {
03703           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a198">context_msgStrictOps</a> ())
03704             {
03705               voptgenerror 
03706                 (FLG_STRICTOPS,
03707                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-numeric (%t): %s"</font>,
03708                           lltok_unparse (op), te, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03709                  e-&gt;loc);
03710             }
03711 
03712           ret-&gt;typ = ctype_int;
03713         }
03714       <font class="keywordflow">break</font>;
03715       
03716     <font class="keywordflow">case</font> TEXCL:         <font class="comment">/* maybe this should be restricted */</font>
03717       <a class="code" href="guardSet_c.html#a10">guardSet_flip</a> (ret-&gt;guards);      
03718 
03719       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te))
03720         {
03721          ;
03722         }
03723       <font class="keywordflow">else</font>
03724         {
03725           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr))
03726             {
03727               <font class="keywordflow">if</font> (sRef_isKnown (e-&gt;sref))
03728                 {
03729                   ret-&gt;guards = <a class="code" href="guardSet_c.html#a14">guardSet_addFalseGuard</a> (ret-&gt;guards, e-&gt;sref);
03730                 }
03731 
03732               voptgenerror2n
03733                 (FLG_BOOLOPS, FLG_PTRNEGATE,
03734                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-boolean (%t): %s"</font>,
03735                           lltok_unparse (op), te, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03736                  e-&gt;loc);
03737             }
03738           <font class="keywordflow">else</font>
03739             {
03740               voptgenerror
03741                 (FLG_BOOLOPS,
03742                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-boolean (%t): %s"</font>,
03743                           lltok_unparse (op), te, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03744                  e-&gt;loc);
03745             }
03746           
03747           ret-&gt;typ = ctype_bool;
03748         }
03749       <font class="keywordflow">break</font>;
03750       
03751     <font class="keywordflow">case</font> TTILDE:
03752       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a81">ctype_isForceRealInt</a> (&amp;tr))
03753         {
03754         }
03755       <font class="keywordflow">else</font>
03756         {
03757           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a198">context_msgStrictOps</a> ())
03758             {
03759               voptgenerror 
03760                 (FLG_STRICTOPS,
03761                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operand of %s is non-integer (%t): %s"</font>,
03762                           lltok_unparse (op), te, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)), 
03763                  e-&gt;loc);
03764             }
03765 
03766           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (e-&gt;typ))
03767             {
03768               ret-&gt;typ = e-&gt;typ;
03769             }
03770           <font class="keywordflow">else</font>
03771             {
03772               ret-&gt;typ = ctype_int;
03773             }
03774         }       
03775       <font class="keywordflow">break</font>;
03776       
03777     <font class="keywordflow">case</font> TAMPERSAND:
03778       ret-&gt;typ = <a class="code" href="ctype_c.html#a35">ctype_makePointer</a> (e-&gt;typ);
03779 
03780       <font class="keywordflow">if</font> (sRef_isKnown (e-&gt;sref))
03781         {
03782           ret-&gt;sref = <a class="code" href="sRef_c.html#a137">sRef_makeAddress</a> (e-&gt;sref);
03783         }
03784       
03785       <font class="keywordflow">break</font>;
03786       
03787     <font class="keywordflow">case</font> TMULT:
03788       
03789       <font class="keywordflow">if</font> (ctype_isAP (tr))
03790         {
03791           ret-&gt;typ = <a class="code" href="ctype_c.html#a38">ctype_baseArrayPtr</a> (e-&gt;typ);
03792         }
03793       <font class="keywordflow">else</font>
03794         {
03795           <font class="keywordflow">if</font> (ctype_isKnown (te))
03796             {
03797               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (te))
03798                 {
03799                   ret-&gt;typ = e-&gt;typ;
03800 
03801                   voptgenerror
03802                     (FLG_FCNDEREF,
03803                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Dereference of function type (%t): %s"</font>,
03804                               te, exprNode_unparse (ret)),
03805                      e-&gt;loc);
03806                 }
03807               <font class="keywordflow">else</font>
03808                 {
03809                   voptgenerror (FLG_TYPE,
03810                                 message (<font class="stringliteral">"Dereference of non-pointer (%t): %s"</font>,
03811                                          te, exprNode_unparse (ret)),
03812                                 e-&gt;loc);
03813                   ret-&gt;typ = ctype_unknown;
03814                 }
03815             }
03816           <font class="keywordflow">else</font>
03817             {
03818               ret-&gt;typ = ctype_unknown;
03819             }
03820           
03821         }
03822       
03823       <font class="keywordflow">if</font> (sRef_isKnown (e-&gt;sref))
03824         {
03825           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (e-&gt;sref))
03826             {
03827               <font class="keywordflow">if</font> (!<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (e-&gt;sref) &amp;&amp; !<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
03828                 {
03829                   <font class="keywordflow">if</font> (optgenerror 
03830                       (FLG_NULLDEREF,
03831                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Dereference of %s pointer %q: %s"</font>, 
03832                                 sRef_nullMessage (e-&gt;sref),
03833                                 <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (e-&gt;sref),
03834                                 <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03835                        e-&gt;loc))
03836                     {
03837                       <a class="code" href="sRef_c.html#a301">sRef_showNullInfo</a> (e-&gt;sref);
03838                       <a class="code" href="sRef_c.html#a213">sRef_setNotNull</a> (e-&gt;sref, e-&gt;loc); <font class="comment">/* suppress future messages */</font>
03839                     }
03840                 }
03841             }
03842           
03843           ret-&gt;sref = <a class="code" href="sRef_c.html#a275">sRef_makePointer</a> (e-&gt;sref);
03844         }
03845       <font class="keywordflow">break</font>;
03846       
03847     <font class="keywordflow">default</font>:
03848       llbug (message (<font class="stringliteral">"exprNode_preOp: unhandled op: %s"</font>, lltok_unparse (op)));
03849     }
03850 
03851   <font class="keywordflow">if</font> (checkMod)
03852     {
03853       <a class="code" href="exprChecks_c.html#a7">exprNode_checkModify</a> (e, ret);
03854     }
03855 
03856   <font class="keywordflow">return</font> ret;
03857 }
03858 
03859 <font class="comment">/*</font>
03860 <font class="comment">** any reason to disallow sizeof (abstract type) ?</font>
03861 <font class="comment">*/</font>
03862 
03863 <font class="comment">/*</font>
03864 <font class="comment">** used by both sizeof</font>
03865 <font class="comment">*/</font>
03866 
03867 <font class="keyword">static</font>
03868 ctype sizeof_resultType (<font class="keywordtype">void</font>)<font class="keyword"></font>
03869 <font class="keyword"></font>{
03870   <font class="keyword">static</font> ctype sizet = ctype_unknown;
03871 
03872   <font class="keywordflow">if</font> (ctype_isUnknown (sizet))
03873     {
03874       <font class="keywordflow">if</font> (<a class="code" href="usymtab_c.html#a129">usymtab_existsType</a> (cstring_makeLiteralTemp (<font class="stringliteral">"size_t"</font>)))
03875         {
03876           sizet = <a class="code" href="uentry_c.html#a221">uentry_getAbstractType</a> (usymtab_lookup (cstring_makeLiteralTemp (<font class="stringliteral">"size_t"</font>)));
03877         }
03878       <font class="keywordflow">else</font>
03879         {
03880                   sizet = ctype_ulint;
03881         }
03882     }
03883   <font class="keywordflow">return</font> sizet;
03884 }
03885 
03886 exprNode
<a name="l03887"></a><a class="code" href="exprNode_c.html#a102">03887</a> <a class="code" href="exprNode_c.html#a102">exprNode_sizeofType</a> (<font class="comment">/*@only@*/</font> qtype qt)<font class="keyword"></font>
03888 <font class="keyword"></font>{
03889   exprNode ret = exprNode_create (sizeof_resultType ());
03890   ctype ct = qtype_getType (qt);
03891 
03892   ret-&gt;kind = XPR_SIZEOFT;
03893   ret-&gt;edata = exprData_makeSizeofType (qt);
03894 
03895   voptgenerror (FLG_SIZEOFTYPE,
03896                 message (<font class="stringliteral">"Parameter to sizeof is type %s: %s"</font>,
03897                          ctype_unparse (ct),
03898                          <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03899                 ret-&gt;loc);
03900   
03901   <font class="keywordflow">return</font> (ret);
03902 }
03903 
03904 exprNode
<a name="l03905"></a><a class="code" href="exprNode_c.html#a103">03905</a> <a class="code" href="exprNode_c.html#a103">exprNode_alignofType</a> (<font class="comment">/*@only@*/</font> qtype qt)<font class="keyword"></font>
03906 <font class="keyword"></font>{
03907   exprNode ret = exprNode_create (sizeof_resultType ());
03908   ctype ct = qtype_getType (qt);
03909 
03910   ret-&gt;kind = XPR_ALIGNOFT;
03911   ret-&gt;edata = exprData_makeSizeofType (qt);
03912 
03913   voptgenerror (FLG_SIZEOFTYPE,
03914                 message (<font class="stringliteral">"Parameter to alignof is type %s: %s"</font>,
03915                          ctype_unparse (ct),
03916                          <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03917                 ret-&gt;loc);
03918   
03919   <font class="keywordflow">return</font> (ret);
03920 }
03921 
<a name="l03922"></a><a class="code" href="exprNode_c.html#a104">03922</a> exprNode <a class="code" href="exprNode_c.html#a104">exprNode_offsetof</a> (qtype qt, cstringList s)<font class="keyword"></font>
03923 <font class="keyword"></font>{
03924   exprNode ret = exprNode_create (sizeof_resultType ());
03925   ctype ct = qtype_getType (qt);
03926 
03927   ret-&gt;kind = XPR_OFFSETOF;
03928   ret-&gt;edata = exprData_makeOffsetof (qt, s);
03929 
03930   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (ct))
03931     {
03932       voptgenerror (FLG_TYPE,
03933                     message (<font class="stringliteral">"First parameter to offsetof is not a "</font>
03934                              <font class="stringliteral">"struct or union type (type %s): %s"</font>,
03935                              ctype_unparse (ct),
03936                              <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03937                     ret-&gt;loc);
03938     }
03939   <font class="keywordflow">else</font>
03940     {
03941       ctype lt = ct;
03942 
03943       cstringList_elements (s, el)<font class="keyword"> </font>{
03944         uentryList fields;
03945         uentry fld;
03946 
03947         <font class="keywordflow">if</font> (ctype_isUndefined (lt))
03948           {
03949             <font class="keywordflow">break</font>;
03950           } 
03951         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (lt))
03952           {
03953             voptgenerror (FLG_TYPE,
03954                           message (<font class="stringliteral">"Inner offsetof type is not a "</font>
03955                                    <font class="stringliteral">"struct or union type (type %s before field %s): %s"</font>,
03956                                    ctype_unparse (lt), el,
03957                                    <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03958                           ret-&gt;loc);
03959             <font class="keywordflow">break</font>;
03960           }
03961         <font class="keywordflow">else</font> 
03962           {
03963             fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (ctype_realType (lt));
03964             fld = <a class="code" href="uentryList_c.html#a32">uentryList_lookupField</a> (fields, el);
03965             DPRINTF ((<font class="stringliteral">"Try: %s / %s"</font>, ctype_unparse (lt), el));
03966             
03967             <font class="keywordflow">if</font> (uentry_isUndefined (fld))
03968               {
03969                 <font class="keywordflow">if</font> (ctype_equal (lt, ct)) {
03970                   voptgenerror (FLG_TYPE,
03971                                 message (<font class="stringliteral">"Field %s in offsetof is not the "</font>
03972                                          <font class="stringliteral">"name of a field of %s: %s"</font>,
03973                                          el,
03974                                          ctype_unparse (ct),
03975                                          <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03976                                 ret-&gt;loc);
03977                 } <font class="keywordflow">else</font> {
03978                   voptgenerror (FLG_TYPE,
03979                                 message (<font class="stringliteral">"Deep field %s in offsetof is not the "</font>
03980                                          <font class="stringliteral">"name of a field of %s: %s"</font>,
03981                                          el,
03982                                          ctype_unparse (lt),
03983                                          <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
03984                                 ret-&gt;loc);
03985                 }
03986               }
03987             <font class="keywordflow">else</font> 
03988               {
03989                 lt = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (fld);
03990               }
03991           }
03992       } end_cstringList_elements;
03993 
03994       <font class="comment">/* Should report error if its a bit field - behavior is undefined! */</font>
03995     }
03996   
03997   <font class="keywordflow">return</font> (ret);
03998 }
03999 
04000 <font class="comment">/*@only@*/</font> exprNode
<a name="l04001"></a><a class="code" href="exprNode_c.html#a105">04001</a> <a class="code" href="exprNode_c.html#a105">exprNode_sizeofExpr</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
04002 <font class="keyword"></font>{
04003   exprNode ret;
04004 
04005   <font class="keywordflow">if</font> (exprNode_isUndefined (e))
04006     {
04007       ret = exprNode_createLoc (ctype_unknown, fileloc_copy (g_currentloc));
04008       ret-&gt;edata = exprData_makeSingle (e);
04009       ret-&gt;typ = sizeof_resultType ();
04010       ret-&gt;kind = XPR_SIZEOF;
04011     }
04012   <font class="keywordflow">else</font>
04013     {
04014       uentry u = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (e);
04015 
04016       ret = exprNode_createPartialCopy (e);
04017       ret-&gt;edata = exprData_makeSingle (e);
04018 
04019       ret-&gt;typ = sizeof_resultType ();
04020       ret-&gt;kind = XPR_SIZEOF;
04021 
04022       <font class="keywordflow">if</font> (uentry_isValid (u) 
04023           &amp;&amp; <a class="code" href="uentry_c.html#a173">uentry_isRefParam</a> (u)
04024           &amp;&amp; <a class="code" href="ctype_c.html#a75">ctype_isRealArray</a> (uentry_getType (u)))
04025         {
04026           voptgenerror
04027             (FLG_SIZEOFFORMALARRAY,
04028              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Parameter to sizeof is an array-type function parameter: %s"</font>,
04029                       exprNode_unparse (ret)),
04030              ret-&gt;loc);
04031         }
04032     }
04033 
04034   <font class="comment">/*</font>
04035 <font class="comment">  ** sizeof (x) doesn't "really" use x</font>
04036 <font class="comment">  */</font>
04037 
04038   <font class="keywordflow">return</font> (ret);
04039 }
04040 
04041 <font class="comment">/*@only@*/</font> exprNode
<a name="l04042"></a><a class="code" href="exprNode_c.html#a106">04042</a> <a class="code" href="exprNode_c.html#a106">exprNode_alignofExpr</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
04043 <font class="keyword"></font>{
04044   exprNode ret;
04045 
04046   <font class="keywordflow">if</font> (exprNode_isUndefined (e))
04047     {
04048       ret = exprNode_createLoc (ctype_unknown, fileloc_copy (g_currentloc));
04049     }
04050   <font class="keywordflow">else</font>
04051     {
04052       ret = exprNode_createPartialCopy (e);
04053     }
04054 
04055   ret-&gt;edata = exprData_makeSingle (e);
04056   ret-&gt;typ = sizeof_resultType ();
04057   ret-&gt;kind = XPR_ALIGNOF;
04058   
04059   <font class="comment">/*</font>
04060 <font class="comment">  ** sizeof (x) doesn't "really" use x</font>
04061 <font class="comment">  */</font>
04062 
04063   <font class="keywordflow">return</font> (ret);
04064 }
04065 
04066 <font class="comment">/*@only@*/</font> exprNode
<a name="l04067"></a><a class="code" href="exprNode_c.html#a107">04067</a> <a class="code" href="exprNode_c.html#a107">exprNode_cast</a> (<font class="comment">/*@only@*/</font> lltok tok, <font class="comment">/*@only@*/</font> exprNode e, <font class="comment">/*@only@*/</font> qtype q)<font class="keyword"></font>
04068 <font class="keyword"></font>{
04069   ctype c;
04070   ctype t;
04071   exprNode ret;
04072 
04073   <font class="keywordflow">if</font> (exprNode_isError (e))
04074     {
04075       <a class="code" href="qtype_c.html#a1">qtype_free</a> (q);
04076       <a class="code" href="lltok_c.html#a3">lltok_release</a> (tok);
04077       <font class="keywordflow">return</font> exprNode_undefined;
04078     }
04079 
04080   checkMacroParen (e);
04081 
04082   c = qtype_getType (q);
04083   t = exprNode_getType (e);
04084 
04085   ret = exprNode_createPartialCopy (e);
04086   
04087   ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, lltok_getLoc (tok));
04088   ret-&gt;typ = c;
04089   ret-&gt;kind = XPR_CAST;
04090   ret-&gt;edata = exprData_makeCast (tok, e, q);
04091 
04092   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (ctype_getBaseType (sRef_getType (e-&gt;sref))))
04093     {
04094       <font class="comment">/* </font>
04095 <font class="comment">      ** This is a bit of a hack to avoid a problem</font>
04096 <font class="comment">      ** when the code does,</font>
04097 <font class="comment">      **          (some other struct) x</font>
04098 <font class="comment">      **          ...</font>
04099 <font class="comment">      **          x-&gt;field</font>
04100 <font class="comment">      */</font>
04101 
04102       ret-&gt;sref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (e-&gt;sref);
04103       <a class="code" href="usymtab_c.html#a152">usymtab_addForceMustAlias</a> (ret-&gt;sref, e-&gt;sref);
04104       <a class="code" href="sRef_c.html#a257">sRef_setTypeFull</a> (ret-&gt;sref, c);
04105       DPRINTF ((<font class="stringliteral">"Cast: %s -&gt; %s"</font>, sRef_unparseFull (e-&gt;sref),
04106                 <a class="code" href="sRef_c.html#a169">sRef_unparseFull</a> (ret-&gt;sref)));
04107     }
04108   <font class="keywordflow">else</font>
04109     {
04110       ret-&gt;sref = e-&gt;sref;
04111       <a class="code" href="sRef_c.html#a257">sRef_setTypeFull</a> (ret-&gt;sref, c);
04112       DPRINTF ((<font class="stringliteral">"Cast 2: -&gt; %s"</font>, sRef_unparseFull (ret-&gt;sref)));
04113     }
04114 
04115   <font class="comment">/*</font>
04116 <font class="comment">  ** we allow</font>
04117 <font class="comment">  **       abstract  -&gt; void</font>
04118 <font class="comment">  **              0 &lt;-&gt; abstract * </font>
04119 <font class="comment">  **         void * &lt;-&gt; abstract *  (if FLG_ABSTVOIDP)</font>
04120 <font class="comment">  **     abstract * &lt;-&gt; void *      (if FLG_ABSTVOIDP)</font>
04121 <font class="comment">  */</font>
04122 
04123   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a51">ctype_isVoid</a> (c)) <font class="comment">/* cast to void is always okay --- discard value */</font>
04124     {
04125       ;
04126     }
04127   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (c)) <font class="comment">/* casting to array or pointer */</font>
04128     {
04129       ctype bc = <a class="code" href="ctype_c.html#a112">ctype_getBaseType</a> (c);
04130       ctype bt = <a class="code" href="ctype_c.html#a112">ctype_getBaseType</a> (t);
04131       ctype rt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (t);
04132 
04133       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ctype_baseArrayPtr (ctype_realType (c)))
04134           &amp;&amp; (<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (rt)
04135               &amp;&amp; !<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ctype_realType (ctype_baseArrayPtr (rt)))))
04136         {
04137           voptgenerror
04138             (FLG_CASTFCNPTR,
04139              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast from function pointer type (%t) to "</font>
04140                       <font class="stringliteral">"non-function pointer (%t): %s"</font>,
04141                       c, t, exprNode_unparse (ret)),
04142              e-&gt;loc);     
04143         }
04144 
04145       <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ctype_baseArrayPtr (c))
04146           &amp;&amp; (<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (rt)
04147               &amp;&amp; <a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ctype_realType (ctype_baseArrayPtr (rt)))))
04148         {
04149           voptgenerror
04150             (FLG_CASTFCNPTR,
04151              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast from non-function pointer type (%t) to "</font>
04152                       <font class="stringliteral">"function pointer (%t): %s"</font>,
04153                       c, t, exprNode_unparse (ret)),
04154              e-&gt;loc);     
04155         }
04156 
04157       <font class="keywordflow">if</font> (exprNode_isZero (e) &amp;&amp; <a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ZEROPTR) &amp;&amp;
04158           !(<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (bc)
04159             &amp;&amp; <a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (bc))))
04160         {
04161          ; <font class="comment">/* okay to cast zero */</font>
04162         }
04163       <font class="keywordflow">else</font>
04164         {
04165           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (bc)
04166               &amp;&amp; !<a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (bc)))
04167             {
04168               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (t) || ctype_isUnknown (t))
04169                 {
04170                   vnoptgenerror
04171                     (FLG_ABSTVOIDP,
04172                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast to underlying abstract type %t: %s"</font>,
04173                               c, exprNode_unparse (ret)),
04174                      e-&gt;loc);
04175                 }
04176               <font class="keywordflow">else</font>
04177                 {
04178                   voptgenerror
04179                     (FLG_ABSTRACT,
04180                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast to underlying abstract type %t: %s"</font>,
04181                               c, exprNode_unparse (ret)),
04182                      e-&gt;loc);     
04183                 }
04184             }
04185 
04186           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (bt)
04187               &amp;&amp; !<a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (bt)))
04188             {
04189               <font class="keywordflow">if</font> (ctype_isUnknown (c) || <a class="code" href="ctype_c.html#a99">ctype_isVoidPointer</a> (c))
04190                 {
04191                   vnoptgenerror
04192                     (FLG_ABSTVOIDP,
04193                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast from underlying abstract type %t: %s"</font>,
04194                               t, exprNode_unparse (ret)),
04195                      e-&gt;loc);
04196                 }
04197               <font class="keywordflow">else</font>
04198                 {
04199                   voptgenerror
04200                     (FLG_ABSTRACT,
04201                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast from underlying abstract type %t: %s"</font>,
04202                               t, exprNode_unparse (ret)),
04203                      e-&gt;loc);
04204                 }
04205             }
04206         }
04207     }
04208   <font class="keywordflow">else</font>
04209     {
04210       ctype bt = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_getBaseType (t));
04211       ctype bc = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ctype_getBaseType (c));
04212 
04213       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (bt) &amp;&amp; !<a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (bt)))
04214         {
04215           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (c, t))
04216             {
04217               <font class="keywordflow">if</font> (ctype_equal (c, t))
04218                 {
04219                   voptgenerror
04220                     (FLG_TYPE, 
04221                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Redundant cast involving abstract type %t: %s"</font>,
04222                               bt, exprNode_unparse (ret)),
04223                      e-&gt;loc);
04224                 }
04225             }
04226           <font class="keywordflow">else</font>
04227             {
04228               voptgenerror
04229                 (FLG_ABSTRACT,
04230                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast from abstract type %t: %s"</font>, 
04231                           bt, exprNode_unparse (ret)),
04232                  e-&gt;loc);
04233             }
04234         }
04235       
04236       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (bc) 
04237           &amp;&amp; !<a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (bc)))
04238         {
04239           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (c, t))
04240             {
04241              ;
04242             }
04243           <font class="keywordflow">else</font>
04244             {
04245               voptgenerror 
04246                 (FLG_ABSTRACT,
04247                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast to abstract type %t: %s"</font>, bc, 
04248                           exprNode_unparse (ret)),
04249                  e-&gt;loc);
04250             }
04251         }
04252     }
04253 
04254   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (c))
04255     {
04256       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (e-&gt;sref) || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (e-&gt;sref))
04257         {
04258           <font class="comment">/* okay, cast exposed to abstract */</font>
04259           <a class="code" href="sRef_c.html#a193">sRef_clearExKindComplete</a> (ret-&gt;sref, fileloc_undefined);
04260         }
04261       <font class="keywordflow">else</font> 
04262         {
04263           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a131">ctype_isVisiblySharable</a> (t) 
04264               &amp;&amp; <a class="code" href="sRef_c.html#a92">sRef_isExternallyVisible</a> (e-&gt;sref)
04265               &amp;&amp; !(<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (t) 
04266                    &amp;&amp; <a class="code" href="context_c.html#a112">context_hasAccess</a> (ctype_typeId (t))))
04267             {
04268               voptgenerror 
04269                 (FLG_CASTEXPOSE,
04270                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Cast to abstract type from externally visible "</font>
04271                           <font class="stringliteral">"mutable storage exposes rep of %s: %s"</font>,
04272                           ctype_unparse (c),
04273                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
04274                  e-&gt;loc);
04275             }
04276         }
04277     }
04278 
04279   <font class="keywordflow">return</font> (ret);
04280 }
04281 
04282 <font class="keyword">static</font> <font class="keywordtype">bool</font>
04283 evaluationOrderUndefined (lltok op)<font class="keyword"></font>
04284 <font class="keyword"></font>{
04285   <font class="keywordtype">int</font> opid = lltok_getTok (op);
04286 
04287   <font class="keywordflow">return</font> (opid != AND_OP &amp;&amp; opid != OR_OP);
04288 }
04289 
04290 <font class="keyword">static</font> <font class="keywordtype">bool</font> checkIntegral (<font class="comment">/*@notnull@*/</font> exprNode e1, 
04291                            <font class="comment">/*@notnull@*/</font> exprNode e2, 
04292                            <font class="comment">/*@notnull@*/</font> exprNode ret, 
04293                            lltok op)<font class="keyword"></font>
04294 <font class="keyword"></font>{
04295   <font class="keywordtype">bool</font> error = FALSE;
04296 
04297   ctype te1 = exprNode_getType (e1);
04298   ctype te2 = exprNode_getType (e2);
04299 
04300   ctype tr1 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (te1);
04301   ctype tr2 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (te2);
04302   
04303   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a81">ctype_isForceRealInt</a> (&amp;tr1) &amp;&amp; <a class="code" href="ctype_c.html#a81">ctype_isForceRealInt</a> (&amp;tr2))
04304     {
04305       ;
04306     }
04307   <font class="keywordflow">else</font>
04308     {
04309       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a198">context_msgStrictOps</a> ())
04310         {
04311           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr1) &amp;&amp; !<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr2))
04312             {
04313               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a93">ctype_sameName</a> (te1, te2))
04314                 {
04315                   error = optgenerror 
04316                     (FLG_STRICTOPS,
04317                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are non-integer (%t): %s"</font>,
04318                               lltok_unparse (op), te1,
04319                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04320                      e1-&gt;loc);
04321                 }
04322               <font class="keywordflow">else</font>
04323                 {
04324                   error = optgenerror 
04325                     (FLG_STRICTOPS,
04326                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are non-integers (%t, %t): %s"</font>,
04327                               lltok_unparse (op), te1, te2,
04328                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04329                      e1-&gt;loc);
04330                 }
04331             }
04332           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr1))
04333             {
04334               error = optgenerror 
04335                 (FLG_STRICTOPS,
04336                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Left operand of %s is non-integer (%t): %s"</font>,
04337                           lltok_unparse (op), te1, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04338                  e1-&gt;loc);
04339             }
04340           <font class="keywordflow">else</font>
04341             <font class="comment">/* !ctype_isInt (te2) */</font>
04342             {
04343               error = optgenerror 
04344                 (FLG_STRICTOPS,
04345                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Right operand of %s is non-integer (%t): %s"</font>,
04346                           lltok_unparse (op), te2, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04347                  e2-&gt;loc);
04348             }
04349         }
04350     }
04351 
04352   <font class="keywordflow">return</font> !error;
04353 }
04354 
04355 <font class="comment">/*</font>
04356 <font class="comment">** returns exprNode representing e1 op e2</font>
04357 <font class="comment">**</font>
04358 <font class="comment">** uses msg if there are errors</font>
04359 <font class="comment">** can be used for both assignment ops and regular ops</font>
04360 <font class="comment">**</font>
04361 <font class="comment">** modifies e1</font>
04362 <font class="comment">*/</font>
04363 
04364 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> <font class="comment">/*@notnull@*/</font> exprNode
04365 exprNode_makeOp (<font class="comment">/*@keep@*/</font> exprNode e1, <font class="comment">/*@keep@*/</font> exprNode e2, 
04366                  <font class="comment">/*@keep@*/</font> lltok op)<font class="keyword"></font>
04367 <font class="keyword"></font>{
04368   ctype te1, te2, tr1, tr2, tret;
04369   <font class="keywordtype">int</font> opid = lltok_getTok (op);
04370   <font class="keywordtype">bool</font> hasError = FALSE;
04371   exprNode ret;
04372 
04373   <font class="keywordflow">if</font> (exprNode_isError (e1))
04374     {
04375       ret = exprNode_createPartialNVCopy (e2);
04376     }
04377   <font class="keywordflow">else</font>
04378     {
04379       ret = exprNode_createPartialNVCopy (e1);    
04380     }
04381 
04382   ret-&gt;val = multiVal_undefined;
04383   ret-&gt;kind = XPR_OP;
04384   ret-&gt;edata = exprData_makeOp (e1, e2, op);
04385 
04386   <font class="keywordflow">if</font> (exprNode_isError (e1) || exprNode_isError (e2))
04387     {
04388       <font class="keywordflow">if</font> (opid == TLT || opid == TGT || opid == LE_OP || opid == GE_OP
04389           || opid == EQ_OP || opid == NE_OP 
04390           || opid == AND_OP || opid == OR_OP)
04391         {
04392           ret-&gt;typ = ctype_bool;
04393         }
04394 
04395       <font class="keywordflow">if</font> (exprNode_isDefined (e1))
04396         {
04397           exprNode_checkUse (ret, e1-&gt;sref, e1-&gt;loc);  
04398         }
04399 
04400       <font class="keywordflow">if</font> (exprNode_isDefined (e2))
04401         {
04402           exprNode_mergeUSs (ret, e2);
04403           exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);  
04404         }
04405 
04406       <font class="keywordflow">return</font> ret;
04407     }
04408 
04409   tret = ctype_unknown;
04410   te1 = exprNode_getType (e1);
04411   DPRINTF ((<font class="stringliteral">"te1 = %s / %s"</font>, exprNode_unparse (e1), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (te1)));
04412 
04413   te2 = exprNode_getType (e2);
04414 
04415   tr1 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (te1);
04416   tr2 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (te2);
04417 
04418   <font class="keywordflow">if</font> (opid == OR_OP)
04419     {
04420       ret-&gt;guards = <a class="code" href="guardSet_c.html#a5">guardSet_or</a> (ret-&gt;guards, e2-&gt;guards);
04421     }
04422   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (opid == AND_OP)
04423     {
04424       ret-&gt;guards = <a class="code" href="guardSet_c.html#a6">guardSet_and</a> (ret-&gt;guards, e2-&gt;guards);
04425     }
04426   <font class="keywordflow">else</font>
04427     {
04428       <font class="comment">/* no guards */</font>
04429     }
04430 
04431   <font class="keywordflow">if</font> (opid == EQ_OP || opid == NE_OP)
04432     {
04433       exprNode temp1 = e1, temp2 = e2;
04434 
04435       <font class="comment">/* could do NULL == x */</font>
04436       
04437       <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (e1) || exprNode_isUnknownConstant (e1))
04438         {
04439           temp1 = e2; temp2 = e1;
04440         }
04441 
04442       <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (temp2) || exprNode_isUnknownConstant (temp2))
04443         {
04444           reflectNullTest (temp1, (opid == NE_OP));
04445           <a class="code" href="guardSet_c.html#a16">guardSet_free</a> (ret-&gt;guards);
04446           ret-&gt;guards = <a class="code" href="guardSet_c.html#a12">guardSet_copy</a> (temp1-&gt;guards);
04447         }
04448     }
04449 
04450   <font class="keywordflow">if</font> (opid == TLT || opid == TGT || opid == LE_OP || opid == GE_OP
04451       || opid == EQ_OP || opid == NE_OP || opid == AND_OP || opid == OR_OP)
04452     {
04453       tret = ctype_bool; 
04454     }
04455   
04456   <font class="keywordflow">if</font> (anyAbstract (tr1, tr2) &amp;&amp;
04457       (!((<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te1) || <a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te2)) &amp;&amp; 
04458          (opid == AND_OP || opid == OR_OP 
04459           || opid == EQ_OP || opid == NE_OP))))
04460     {
04461       abstractOpError (tr1, tr2, op, e1, e2, e1-&gt;loc, e2-&gt;loc);
04462     }
04463   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (ctype_isUnknown (te1) || ctype_isUnknown (te2))
04464     {
04465       <font class="comment">/* unknown types, no comparisons possible */</font>
04466     }
04467   <font class="keywordflow">else</font>
04468     {
04469       <font class="keywordflow">switch</font> (opid)
04470         {
04471         <font class="keywordflow">case</font> TMULT:             <font class="comment">/* multiplication and division:           */</font>
04472         <font class="keywordflow">case</font> TDIV:              <font class="comment">/*                                        */</font>
04473         <font class="keywordflow">case</font> MUL_ASSIGN:        <font class="comment">/*    numeric, numeric -&gt; numeric         */</font>
04474         <font class="keywordflow">case</font> DIV_ASSIGN:        <font class="comment">/*                                        */</font>
04475           
04476           tret = checkNumerics (tr1, tr2, te1, te2, e1, e2, op);
04477           <font class="keywordflow">break</font>;
04478           
04479         <font class="keywordflow">case</font> TPLUS:             <font class="comment">/* addition and subtraction:               */</font>
04480         <font class="keywordflow">case</font> TMINUS:            <font class="comment">/*    pointer, int     -&gt; pointer          */</font>
04481         <font class="keywordflow">case</font> SUB_ASSIGN:        <font class="comment">/*    int, pointer     -&gt; pointer          */</font>
04482         <font class="keywordflow">case</font> ADD_ASSIGN:        <font class="comment">/*    numeric, numeric -&gt; numeric          */</font>
04483           
04484           tr1 = <a class="code" href="ctype_c.html#a123">ctype_fixArrayPtr</a> (tr1);
04485 
04486           <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr1) &amp;&amp; !<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (e1))
04487               &amp;&amp; (!<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr2) &amp;&amp; <a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (tr2)))
04488             {
04489               <font class="comment">/* pointer + int */</font>
04490 
04491               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a197">context_msgPointerArith</a> ())
04492                 {
04493                   voptgenerror
04494                     (FLG_POINTERARITH,
04495                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Pointer arithmetic (%t, %t): %s"</font>, 
04496                               te1, te2, exprNode_unparse (ret)),
04497                      e1-&gt;loc);
04498                 }
04499 
04500               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (e1-&gt;sref)
04501                   &amp;&amp; !<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (e1-&gt;sref))
04502                 {
04503                   voptgenerror
04504                     (FLG_NULLPOINTERARITH,
04505                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Pointer arithmetic involving possibly "</font>
04506                               <font class="stringliteral">"null pointer %s: %s"</font>, 
04507                               exprNode_unparse (e1), 
04508                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04509                      e1-&gt;loc);
04510                 }
04511 
04512               ret-&gt;sref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (e1-&gt;sref);
04513 
04514               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (ret-&gt;sref);
04515 
04516               <font class="comment">/*</font>
04517 <font class="comment">              ** Fixed for 2.2c: the alias state of ptr + int is dependent,</font>
04518 <font class="comment">              ** since is points to storage that should not be deallocated</font>
04519 <font class="comment">              ** through this pointer.</font>
04520 <font class="comment">              */</font>
04521 
04522               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (ret-&gt;sref) 
04523                   || <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (ret-&gt;sref)) 
04524                 {
04525                   <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ret-&gt;sref, AK_DEPENDENT, exprNode_loc (ret));
04526                 }
04527               
04528               tret = e1-&gt;typ;
04529             }
04530           <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((!<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a>(tr1) &amp;&amp; <a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (tr1)) 
04531                    &amp;&amp; (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr2) &amp;&amp; !<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (e2)))
04532             {
04533               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a197">context_msgPointerArith</a> ())
04534                 {
04535                   voptgenerror 
04536                     (FLG_POINTERARITH,
04537                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Pointer arithmetic (%t, %t): %s"</font>, 
04538                               te1, te2, exprNode_unparse (ret)),
04539                      e1-&gt;loc);
04540                 }
04541 
04542               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (e1-&gt;sref)
04543                   &amp;&amp; !<a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (e1-&gt;sref))
04544                 {
04545                   voptgenerror
04546                     (FLG_NULLPOINTERARITH,
04547                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Pointer arithmetic involving possibly "</font>
04548                               <font class="stringliteral">"null pointer %s: %s"</font>, 
04549                               exprNode_unparse (e2), 
04550                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04551                      e2-&gt;loc);
04552                 }
04553 
04554               ret-&gt;sref = <a class="code" href="sRef_c.html#a234">sRef_copy</a> (e2-&gt;sref);
04555 
04556               <a class="code" href="sRef_c.html#a219">sRef_setNullError</a> (ret-&gt;sref);
04557 
04558               <font class="comment">/*</font>
04559 <font class="comment">              ** Fixed for 2.2c: the alias state of ptr + int is dependent,</font>
04560 <font class="comment">              ** since is points to storage that should not be deallocated</font>
04561 <font class="comment">              ** through this pointer.</font>
04562 <font class="comment">              */</font>
04563 
04564               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (ret-&gt;sref) 
04565                   || <a class="code" href="sRef_c.html#a346">sRef_isFresh</a> (ret-&gt;sref)) {
04566                 <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (ret-&gt;sref, AK_DEPENDENT, exprNode_loc (ret));
04567               }
04568 
04569               tret = e2-&gt;typ;
04570               ret-&gt;sref = e2-&gt;sref;
04571             }
04572           <font class="keywordflow">else</font>
04573             {
04574               tret = checkNumerics (tr1, tr2, te1, te2, e1, e2, op);
04575             }
04576           
04577           <font class="keywordflow">break</font>;
04578 
04579         <font class="keywordflow">case</font> LEFT_ASSIGN:   <font class="comment">/* Shifts: should be unsigned values */</font>
04580         <font class="keywordflow">case</font> RIGHT_ASSIGN:
04581         <font class="keywordflow">case</font> LEFT_OP:
04582         <font class="keywordflow">case</font> RIGHT_OP:
04583         <font class="keywordflow">case</font> TAMPERSAND:    <font class="comment">/* bitwise &amp; */</font>
04584         <font class="keywordflow">case</font> AND_ASSIGN:       
04585         <font class="keywordflow">case</font> TCIRC:         <font class="comment">/* ^ (XOR) */</font>
04586         <font class="keywordflow">case</font> TBAR:
04587         <font class="keywordflow">case</font> XOR_ASSIGN:
04588         <font class="keywordflow">case</font> OR_ASSIGN:
04589           {
04590             <font class="keywordtype">bool</font> reported = FALSE;
04591             flagcode code = FLG_BITWISEOPS;
04592             
04593             <font class="keywordflow">if</font> (opid == LEFT_OP || opid == LEFT_ASSIGN
04594                 || opid == RIGHT_OP || opid == RIGHT_ASSIGN) {
04595               code = FLG_SHIFTSIGNED;
04596             }
04597 
04598             <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a136">ctype_isUnsigned</a> (tr1)) 
04599               {
04600                 <font class="keywordflow">if</font> (exprNode_isNonNegative (e1)) {
04601                   ;
04602                 } <font class="keywordflow">else</font> {
04603                   reported = optgenerror 
04604                     (code,
04605                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Left operand of %s is not unsigned value (%t): %s"</font>,
04606                               lltok_unparse (op), te1,
04607                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04608                      e1-&gt;loc);
04609                   
04610                   <font class="keywordflow">if</font> (reported) {
04611                     te1 = ctype_uint;
04612                   }
04613                 }
04614               }
04615             <font class="keywordflow">else</font> 
04616               {
04617                 <font class="comment">/* right need not be signed for shifts */</font>
04618                 <font class="keywordflow">if</font> (code != FLG_SHIFTSIGNED 
04619                     &amp;&amp; !<a class="code" href="ctype_c.html#a136">ctype_isUnsigned</a> (tr2)) 
04620                   {
04621                     <font class="keywordflow">if</font> (!exprNode_isNonNegative (e2)) {
04622                       reported = optgenerror 
04623                         (code,
04624                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Right operand of %s is not unsigned value (%t): %s"</font>,
04625                                   lltok_unparse (op), te2,
04626                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04627                          e2-&gt;loc);
04628                     }
04629                   }
04630               }
04631             
04632             <font class="keywordflow">if</font> (!reported) 
04633               {
04634                 <font class="keywordflow">if</font> (!checkIntegral (e1, e2, ret, op)) {
04635                   te1 = ctype_unknown;
04636                 }
04637               }
04638             
04639             DPRINTF ((<font class="stringliteral">"Set: %s"</font>, ctype_unparse (te1)));     
04640 
04641             <font class="comment">/*</font>
04642 <font class="comment">            ** tret is the widest type of te1 and te2 </font>
04643 <font class="comment">            */</font>
04644 
04645             tret = <a class="code" href="ctype_c.html#a142">ctype_widest</a> (te1, te2);
04646             <font class="keywordflow">break</font>;
04647           }
04648         <font class="keywordflow">case</font> MOD_ASSIGN:
04649         <font class="keywordflow">case</font> TPERCENT:          
04650           <font class="keywordflow">if</font> (checkIntegral (e1, e2, ret, op)) {
04651             tret = te1;
04652           } <font class="keywordflow">else</font> {
04653             tret = ctype_unknown;
04654           }
04655           <font class="keywordflow">break</font>;
04656         <font class="keywordflow">case</font> EQ_OP: 
04657         <font class="keywordflow">case</font> NE_OP:
04658         <font class="keywordflow">case</font> TLT:               <font class="comment">/* comparisons                           */</font>
04659         <font class="keywordflow">case</font> TGT:               <font class="comment">/*    numeric, numeric -&gt; bool           */</font>
04660           <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a64">ctype_isReal</a> (tr1) &amp;&amp; !<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr1))
04661               || (<a class="code" href="ctype_c.html#a64">ctype_isReal</a> (tr2) &amp;&amp; !<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr2)))
04662             {
04663               ctype rtype = tr1;
04664               <font class="keywordtype">bool</font> fepsilon = FALSE;
04665 
04666               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a64">ctype_isReal</a> (rtype) || <a class="code" href="ctype_c.html#a55">ctype_isInt</a> (rtype))
04667                 {
04668                   rtype = tr2;
04669                 }
04670               
04671               <font class="keywordflow">if</font> (opid == TLT || opid == TGT)
04672                 {
04673                   uentry ue1 = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (e1);
04674                   uentry ue2 = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (e2);
04675 
04676                   <font class="comment">/*</font>
04677 <font class="comment">                  ** FLT_EPSILON, etc. really is a variable, not</font>
04678 <font class="comment">                  ** a constant.</font>
04679 <font class="comment">                  */</font>
04680 
04681                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue1))
04682                     {
04683                       cstring uname = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue1);
04684 
04685                       <font class="keywordflow">if</font> (cstring_equalLit (uname, <font class="stringliteral">"FLT_EPSILON"</font>)
04686                           || cstring_equalLit (uname, <font class="stringliteral">"DBL_EPSILON"</font>)
04687                           || cstring_equalLit (uname, <font class="stringliteral">"LDBL_EPSILON"</font>))
04688                         {
04689                           fepsilon = TRUE;
04690                         }
04691                     }
04692 
04693                   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (ue2))
04694                     {
04695                       cstring uname = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue2);
04696 
04697                       <font class="keywordflow">if</font> (cstring_equalLit (uname, <font class="stringliteral">"FLT_EPSILON"</font>)
04698                           || cstring_equalLit (uname, <font class="stringliteral">"DBL_EPSILON"</font>)
04699                           || cstring_equalLit (uname, <font class="stringliteral">"LDBL_EPSILON"</font>))
04700                         {
04701                           fepsilon = TRUE;
04702                         }
04703                     }
04704                 }
04705 
04706               <font class="keywordflow">if</font> (fepsilon)
04707                 {
04708                   ; <font class="comment">/* Don't complain. */</font>
04709                 }
04710               <font class="keywordflow">else</font>
04711                 {
04712                   voptgenerror
04713                     (FLG_REALCOMPARE,
04714                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Dangerous comparison involving %s types: %s"</font>,
04715                               ctype_unparse (rtype),
04716                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04717                      ret-&gt;loc);
04718                 }
04719             }
04720           <font class="comment">/*@fallthrough@*/</font>
04721         <font class="keywordflow">case</font> LE_OP:
04722         <font class="keywordflow">case</font> GE_OP:
04723 
04724           <font class="comment">/*</font>
04725 <font class="comment">          ** Types should match.</font>
04726 <font class="comment">          */</font>
04727 
04728           <font class="keywordflow">if</font> (!exprNode_matchTypes (e1, e2))
04729             {
04730               hasError = gentypeerror 
04731                 (te1, e1, te2, e2,
04732                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s have incompatible types (%t, %t): %s"</font>,
04733                           lltok_unparse (op), te1, te2, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04734                  e1-&gt;loc);
04735               
04736             }
04737 
04738           <font class="keywordflow">if</font> (hasError 
04739               || (<a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr1)
04740                   &amp;&amp; <a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr2)) ||
04741               (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr2)))
04742             {
04743               ; <font class="comment">/* okay */</font>
04744             }
04745           <font class="keywordflow">else</font>
04746             {
04747               <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a69">ctype_isRealNumeric</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr2)) ||
04748                   (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a69">ctype_isRealNumeric</a> (tr2)))
04749                 {
04750                   voptgenerror 
04751                     (FLG_PTRNUMCOMPARE,
04752                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Comparison of pointer and numeric (%t, %t): %s"</font>,
04753                               te1, te2, exprNode_unparse (ret)),
04754                      e1-&gt;loc);
04755                 }
04756               <font class="keywordflow">else</font>
04757                 {
04758                   (<font class="keywordtype">void</font>) checkNumerics (tr1, tr2, te1, te2, e1, e2, op);
04759                 }
04760               tret = ctype_bool;
04761             }
04762 
04763           <font class="comment">/* EQ_OP should NOT be used with booleans (unless one is FALSE) */</font>
04764           
04765           <font class="keywordflow">if</font> ((opid == EQ_OP || opid == NE_OP) &amp;&amp; 
04766               <a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (tr2))
04767             {
04768               <font class="comment">/*</font>
04769 <font class="comment">              ** is one a variable?</font>
04770 <font class="comment">              */</font>
04771 
04772               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (exprNode_getUentry (e1))
04773                   || <a class="code" href="uentry_c.html#a159">uentry_isVariable</a> (exprNode_getUentry (e2)))
04774                 {
04775                   <font class="comment">/*</font>
04776 <font class="comment">                  ** comparisons with FALSE are okay</font>
04777 <font class="comment">                  */</font>
04778 
04779                   <font class="keywordflow">if</font> (exprNode_isFalseConstant (e1)
04780                       || exprNode_isFalseConstant (e2))
04781                     {
04782                       ;
04783                     }
04784                   <font class="keywordflow">else</font>
04785                     {
04786                       voptgenerror
04787                         (FLG_BOOLCOMPARE,
04788                          message 
04789                          (<font class="stringliteral">"Use of %q with %s variables (risks inconsistency because "</font>
04790                           <font class="stringliteral">"of multiple true values): %s"</font>,
04791                           cstring_makeLiteral ((opid == EQ_OP) ? <font class="stringliteral">"=="</font> : <font class="stringliteral">"!="</font>),
04792                           <a class="code" href="context_c.html#a245">context_printBoolName</a> (), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04793                          e1-&gt;loc);
04794                     }
04795                 }
04796             }
04797           <font class="keywordflow">break</font>;
04798           
04799         <font class="keywordflow">case</font> AND_OP:            <font class="comment">/* bool, bool -&gt; bool */</font>
04800         <font class="keywordflow">case</font> OR_OP:
04801 
04802           <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a82">ctype_isForceRealBool</a> (&amp;tr1) &amp;&amp; <a class="code" href="ctype_c.html#a82">ctype_isForceRealBool</a> (&amp;tr2))
04803             {
04804               ; 
04805             }
04806           <font class="keywordflow">else</font>
04807             {
04808               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_BOOLOPS))
04809                 {
04810                   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te1) &amp;&amp; !<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te2))
04811                     {
04812                       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a93">ctype_sameName</a> (te1, te2))
04813                         {
04814                           voptgenerror 
04815                             (FLG_BOOLOPS,
04816                              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are non-boolean (%t): %s"</font>,
04817                                       lltok_unparse (op), te1,
04818                                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04819                              e1-&gt;loc);
04820                         }
04821                       <font class="keywordflow">else</font>
04822                         {
04823                           voptgenerror 
04824                             (FLG_BOOLOPS,
04825                              message
04826                              (<font class="stringliteral">"Operands of %s are non-booleans (%t, %t): %s"</font>,
04827                               <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), te1, te2, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04828                              e1-&gt;loc);
04829                         }
04830                     }
04831                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te1))
04832                     {
04833                       voptgenerror 
04834                         (FLG_BOOLOPS,
04835                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Left operand of %s is non-boolean (%t): %s"</font>,
04836                                   lltok_unparse (op), te1, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04837                          e1-&gt;loc);
04838                     }
04839                   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a72">ctype_isRealBool</a> (te2))
04840                     {
04841                       voptgenerror
04842                         (FLG_BOOLOPS,
04843                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Right operand of %s is non-boolean (%t): %s"</font>,
04844                                   lltok_unparse (op), te2, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret)),
04845                          e2-&gt;loc);
04846                     }
04847                   <font class="keywordflow">else</font>
04848                     {
04849                       ;
04850                     }
04851                 }
04852               tret = ctype_bool;
04853             }
04854           <font class="keywordflow">break</font>;
04855         <font class="keywordflow">default</font>: {
04856             TPRINTF ((<font class="stringliteral">"opid = %d"</font>, opid));
04857             llfatalbug 
04858               (cstring_makeLiteral 
04859                (<font class="stringliteral">"There has been a problem in the parser. This is due to a bug "</font>
04860                 <font class="stringliteral">"in either lclint, bison or gcc version 2.95 optimizations, "</font>
04861                 <font class="stringliteral">"but it has not been confirmed.  Please try rebuidling LCLint "</font>
04862                 <font class="stringliteral">"without the -O&lt;n&gt; option."</font>));
04863           }
04864         }
04865     }
04866 
04867   DPRINTF ((<font class="stringliteral">"Return type: %s"</font>, ctype_unparse (tret)));
04868   ret-&gt;typ = tret;
04869 
04870   exprNode_checkUse (ret, e1-&gt;sref, e1-&gt;loc);  
04871   exprNode_mergeUSs (ret, e2);
04872   exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);  
04873 
04874   <font class="keywordflow">return</font> ret;
04875 }
04876 
04877 <font class="comment">/*@only@*/</font> exprNode
<a name="l04878"></a><a class="code" href="exprNode_c.html#a111">04878</a> <a class="code" href="exprNode_c.html#a111">exprNode_op</a> (<font class="comment">/*@only@*/</font> exprNode e1, <font class="comment">/*@keep@*/</font> exprNode e2,
04879              <font class="comment">/*@only@*/</font> lltok op)<font class="keyword"></font>
04880 <font class="keyword"></font>{
04881   exprNode ret;
04882 
04883   checkMacroParen (e1);
04884   checkMacroParen (e2);
04885 
04886   <font class="keywordflow">if</font> (evaluationOrderUndefined (op) &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_EVALORDER))
04887     {
04888       checkExpressionDefined (e1, e2, op);
04889     }
04890 
04891   ret = exprNode_makeOp (e1, e2, op);
04892   <font class="keywordflow">return</font> (ret);
04893 }
04894 
04895 <font class="keyword">static</font>
04896 <font class="keywordtype">void</font> exprNode_checkAssignMod (exprNode e1, exprNode ret)<font class="keyword"></font>
04897 <font class="keyword"></font>{
04898   <font class="comment">/*</font>
04899 <font class="comment">  ** This is somewhat bogus!</font>
04900 <font class="comment">  **</font>
04901 <font class="comment">  ** Assigning to a nested observer in a non-observer datatype</font>
04902 <font class="comment">  ** should not produce an error.</font>
04903 <font class="comment">  */</font>
04904 
04905   sRef ref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (e1);
04906 
04907   DPRINTF ((<font class="stringliteral">"Check assign mod: %s"</font>,
04908             sRef_unparseFull (ref)));
04909 
04910   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (ref) 
04911       || ((<a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (ref) || <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (ref))
04912           &amp;&amp; <a class="code" href="ctype_c.html#a101">ctype_isArray</a> (ctype_realType (sRef_getType (ref)))))
04913     {
04914       sRef base = <a class="code" href="sRef_c.html#a139">sRef_getBase</a> (ref);
04915 
04916       <font class="keywordflow">if</font> (sRef_isValid (base) &amp;&amp; <a class="code" href="sRef_c.html#a345">sRef_isObserver</a> (base))
04917         {
04918           <a class="code" href="exprChecks_c.html#a7">exprNode_checkModify</a> (e1, ret);
04919         }
04920       <font class="keywordflow">else</font>
04921         {
04922           <a class="code" href="exprChecks_c.html#a8">exprNode_checkModifyVal</a> (e1, ret);
04923         }
04924     }
04925   <font class="keywordflow">else</font>
04926     {
04927       <a class="code" href="exprChecks_c.html#a7">exprNode_checkModify</a> (e1, ret);
04928     }
04929 }
04930 
04931 exprNode
<a name="l04932"></a><a class="code" href="exprNode_c.html#a113">04932</a> <a class="code" href="exprNode_c.html#a113">exprNode_assign</a> (<font class="comment">/*@only@*/</font> exprNode e1,
04933                  <font class="comment">/*@only@*/</font> exprNode e2, <font class="comment">/*@only@*/</font> lltok op)<font class="keyword"></font>
04934 <font class="keyword"></font>{
04935   <font class="keywordtype">bool</font> isalloc = FALSE;
04936   <font class="keywordtype">bool</font> isjustalloc = FALSE;
04937   exprNode ret;
04938 
04939   DPRINTF ((<font class="stringliteral">"%s [%s] &lt;- %s [%s]"</font>,
04940             exprNode_unparse (e1),
04941             <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (e1-&gt;typ),
04942             <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2),
04943             <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (e2-&gt;typ)));
04944 
04945   <font class="keywordflow">if</font> (lltok_getTok (op) != TASSIGN) 
04946     {
04947       ret = exprNode_makeOp (e1, e2, op);
04948     } 
04949   <font class="keywordflow">else</font> 
04950     {
04951       ret = exprNode_createPartialCopy (e1);
04952       ret-&gt;kind = XPR_ASSIGN;
04953       ret-&gt;edata = exprData_makeOp (e1, e2, op);
04954 
04955       <font class="keywordflow">if</font> (!exprNode_isError (e2)) 
04956         {
04957           ret-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;sets, e2-&gt;sets);
04958           ret-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;msets, e2-&gt;msets);
04959           ret-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;uses, e2-&gt;uses);
04960         }
04961     }
04962 
04963   checkExpressionDefined (e1, e2, op);
04964 
04965   <font class="keywordflow">if</font> (exprNode_isError (e1))
04966     {
04967       <font class="keywordflow">if</font> (!exprNode_isError (e2)) 
04968         {
04969           ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, e2-&gt;loc);
04970         }
04971       <font class="keywordflow">else</font>
04972         {
04973           ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, g_currentloc);
04974         }
04975     }
04976 
04977   <font class="keywordflow">if</font> (!exprNode_isError (e2))
04978     {
04979       checkMacroParen (e2);
04980     }
04981 
04982   <font class="keywordflow">if</font> (exprNode_isDefined (e1))
04983     {
04984       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (e1-&gt;sref))
04985         {
04986           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> ())
04987             {
04988               uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (e1-&gt;sref);
04989               
04990               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (ue))
04991                 {
04992                   ;
04993                 }
04994               <font class="keywordflow">else</font>
04995                 {
04996                   <font class="keywordflow">if</font> (fileloc_isDefined (e1-&gt;loc))
04997                     {
04998                       voptgenerror
04999                         (FLG_MACROPARAMS,
05000                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment to non-yield iter parameter: %q"</font>, 
05001                                   sRef_unparse (e1-&gt;sref)),
05002                          e1-&gt;loc);
05003                     }
05004                   <font class="keywordflow">else</font>
05005                     {
05006                       voptgenerror 
05007                         (FLG_MACROPARAMS,
05008                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment to non-yield iter parameter: %q"</font>, 
05009                                   sRef_unparse (e1-&gt;sref)),
05010                          g_currentloc);
05011                     }
05012                 }
05013             }
05014           <font class="keywordflow">else</font>
05015             {
05016               <font class="keywordflow">if</font> (fileloc_isDefined (e1-&gt;loc))
05017                 {
05018                   voptgenerror
05019                     (FLG_MACROASSIGN,
05020                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment to macro parameter: %q"</font>, 
05021                               sRef_unparse (e1-&gt;sref)),
05022                      e1-&gt;loc);
05023                 }
05024               <font class="keywordflow">else</font>
05025                 {
05026                   voptgenerror 
05027                     (FLG_MACROASSIGN,
05028                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment to macro parameter: %q"</font>, 
05029                               sRef_unparse (e1-&gt;sref)),
05030                      g_currentloc);
05031                 }
05032             }
05033         }
05034       <font class="keywordflow">else</font>
05035         {
05036           exprNode_checkAssignMod (e1, ret);
05037         }
05038 
05039       <font class="keywordflow">if</font> (exprNode_isDefined (e2))
05040         {
05041           <font class="keywordflow">if</font> (lltok_getTok (op) == TASSIGN) 
05042             {
05043               ctype te1 = exprNode_getType (e1);
05044               ctype te2 = exprNode_getType (e2);
05045               
05046               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a97">ctype_forceMatch</a> (te1, te2))
05047                 {
05048                   <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (te1, e2))
05049                     {
05050                       ;
05051                     }
05052                   <font class="keywordflow">else</font>
05053                     {
05054                       (<font class="keywordtype">void</font>) gentypeerror 
05055                         (te2, e2, te1, e1,
05056                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of %t to %t: %s %s %s"</font>, 
05057                                   te2, te1, exprNode_unparse (e1),
05058                                   <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), 
05059                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
05060                          e1-&gt;loc);
05061                     }
05062                 }
05063             }
05064          
05065           exprNode_mergeUSs (ret, e2);
05066           exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);
05067           
05068           doAssign (e1, e2, FALSE); 
05069           ret-&gt;sref = e1-&gt;sref;
05070         }
05071       <font class="keywordflow">else</font>
05072         {
05073           <font class="keywordflow">if</font> (exprNode_isDefined (e2))
05074             {
05075               exprNode_mergeUSs (ret, e2);
05076                       exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);
05077             }
05078         }
05079 
05080       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (e1-&gt;sref) &amp;&amp; !<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (e1-&gt;sref))
05081         {
05082           exprNode_checkUse (ret, sRef_getBase (e1-&gt;sref), e1-&gt;loc);
05083         }
05084 
05085       isjustalloc = <a class="code" href="sRef_c.html#a313">sRef_isJustAllocated</a> (e1-&gt;sref);
05086       isalloc = <a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (e1-&gt;sref);
05087 
05088       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a243">sRef_isField</a> (e1-&gt;sref))
05089         {
05090           sRef root = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (sRef_getBase (e1-&gt;sref));
05091           
05092           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (root) &amp;&amp; !<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (root))
05093             {
05094               exprNode_checkUse (ret, root, e1-&gt;loc);
05095             }
05096           
05097         }
05098   
05099       <font class="comment">/*</font>
05100 <font class="comment">      ** be careful!  this defines e1-&gt;sref.</font>
05101 <font class="comment">      */</font>
05102    
05103       <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (e1-&gt;sref))
05104         {
05105           <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (ret, e1-&gt;sref);
05106         }
05107       
05108       <font class="keywordflow">if</font> (isjustalloc) 
05109         {
05110           <a class="code" href="sRef_c.html#a205">sRef_setAllocatedComplete</a> (e1-&gt;sref, exprNode_isDefined (e2)
05111                                      ? e2-&gt;loc : e1-&gt;loc);
05112         }
05113       <font class="keywordflow">else</font> 
05114         {
05115           <font class="keywordflow">if</font> (isalloc)
05116             {
05117               <a class="code" href="sRef_c.html#a207">sRef_setAllocatedShallowComplete</a> (e1-&gt;sref, exprNode_loc (e2));
05118             }
05119         }
05120     }
05121   
05122   <font class="keywordflow">return</font> ret;
05123 }
05124 
05125 exprNode
<a name="l05126"></a><a class="code" href="exprNode_c.html#a114">05126</a> <a class="code" href="exprNode_c.html#a114">exprNode_cond</a> (<font class="comment">/*@keep@*/</font> exprNode pred, <font class="comment">/*@keep@*/</font> exprNode ifclause, 
05127                <font class="comment">/*@keep@*/</font> exprNode elseclause)<font class="keyword"></font>
05128 <font class="keyword"></font>{
05129   exprNode ret;
05130 
05131   <font class="keywordflow">if</font> (!exprNode_isError (pred))
05132     {
05133       ret = exprNode_createPartialCopy (pred);
05134       checkMacroParen (pred);
05135       <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"conditional"</font>), pred);
05136       
05137       <font class="keywordflow">if</font> (!exprNode_isError (ifclause))
05138         {
05139           checkMacroParen (ifclause);   <font class="comment">/* update macro counts! */</font>
05140 
05141           <font class="keywordflow">if</font> (!exprNode_isError (elseclause))
05142             {
05143               checkMacroParen (elseclause);
05144               
05145               <font class="keywordflow">if</font> (!exprNode_matchTypes (ifclause, elseclause))
05146                 {
05147                   <font class="keywordflow">if</font> (gentypeerror 
05148                       (exprNode_getType (ifclause),
05149                        ifclause,
05150                        exprNode_getType (elseclause),
05151                        elseclause,
05152                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Conditional clauses are not of same type: "</font>
05153                                 <font class="stringliteral">"%s (%t), %s (%t)"</font>, 
05154                                 exprNode_unparse (ifclause), 
05155                                 exprNode_getType (ifclause),
05156                                 <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (elseclause), 
05157                                 exprNode_getType (elseclause)),
05158                        ifclause-&gt;loc))
05159                     {
05160                       ret-&gt;sref = sRef_undefined;
05161                       ret-&gt;typ = ctype_unknown;
05162                     }
05163                 }
05164               <font class="keywordflow">else</font>
05165                 {
05166                   <font class="comment">/* for now...should merge the states */</font>
05167                   ret-&gt;sref = ifclause-&gt;sref;
05168                   ret-&gt;typ = ifclause-&gt;typ;
05169 
05170                   <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (ifclause))
05171                     {
05172                       ret-&gt;typ = elseclause-&gt;typ;
05173                     }
05174                 }
05175               
05176               exprNode_checkUse (ret, pred-&gt;sref, pred-&gt;loc);
05177               exprNode_checkUse (ifclause, ifclause-&gt;sref, ifclause-&gt;loc);
05178               exprNode_checkUse (elseclause, elseclause-&gt;sref, elseclause-&gt;loc);
05179 
05180               exprNode_mergeCondUSs (ret, ifclause, elseclause);
05181 
05182             }
05183           <font class="keywordflow">else</font>
05184             {
05185               ret-&gt;typ = ifclause-&gt;typ;
05186               
05187               exprNode_checkUse (pred, pred-&gt;sref, pred-&gt;loc);
05188               exprNode_checkUse (ifclause, ifclause-&gt;sref, ifclause-&gt;loc);
05189               
05190               exprNode_mergeCondUSs (ret, ifclause, exprNode_undefined);
05191             }
05192         }
05193       <font class="keywordflow">else</font> 
05194         {
05195           <font class="keywordflow">if</font> (!exprNode_isError (elseclause))
05196             {
05197               ret-&gt;typ = elseclause-&gt;typ;
05198               
05199               exprNode_checkUse (pred, pred-&gt;sref, pred-&gt;loc);
05200               exprNode_checkUse (elseclause, elseclause-&gt;sref, elseclause-&gt;loc);
05201               
05202               exprNode_mergeCondUSs (ret, exprNode_undefined, elseclause);
05203             }
05204         }
05205     }
05206   <font class="keywordflow">else</font> <font class="comment">/* pred is error */</font>
05207     {
05208       <font class="keywordflow">if</font> (!exprNode_isError (ifclause))
05209         {
05210           ret = exprNode_createSemiCopy (ifclause);
05211 
05212           checkMacroParen (ifclause);   <font class="comment">/* update macro counts! */</font>
05213           
05214           <font class="keywordflow">if</font> (!exprNode_isError (elseclause))
05215             {
05216               checkMacroParen (elseclause);
05217               
05218               ret-&gt;typ = ifclause-&gt;typ;
05219                       
05220               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a97">ctype_forceMatch</a> (ifclause-&gt;typ, elseclause-&gt;typ))
05221                 {
05222                   <font class="keywordflow">if</font> (gentypeerror 
05223                       (exprNode_getType (ifclause),
05224                        ifclause,
05225                        exprNode_getType (elseclause),
05226                        elseclause,
05227                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Conditional clauses are not of same type: "</font>
05228                                 <font class="stringliteral">"%s (%t), %s (%t)"</font>, 
05229                                 exprNode_unparse (ifclause), 
05230                                 exprNode_getType (ifclause),
05231                                 <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (elseclause), 
05232                                 exprNode_getType (elseclause)),
05233                        ifclause-&gt;loc))
05234                     {
05235                       ret-&gt;typ = ctype_unknown;
05236                     }
05237                 }
05238                       
05239               exprNode_checkUse (ifclause, ifclause-&gt;sref, ifclause-&gt;loc);
05240               exprNode_checkUse (elseclause, elseclause-&gt;sref, elseclause-&gt;loc);
05241               
05242               exprNode_mergeCondUSs (ret, ifclause, elseclause);
05243             }
05244         }
05245       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!exprNode_isError (elseclause)) <font class="comment">/* pred, if errors */</font>
05246         {
05247           ret = exprNode_createSemiCopy (ifclause);
05248 
05249           ret-&gt;typ = elseclause-&gt;typ;
05250           checkMacroParen (elseclause);
05251           
05252           exprNode_checkUse (elseclause, elseclause-&gt;sref, elseclause-&gt;loc);
05253           exprNode_mergeCondUSs (ret, exprNode_undefined, elseclause);
05254         }
05255       <font class="keywordflow">else</font> <font class="comment">/* all errors! */</font>
05256         {
05257           ret = exprNode_createLoc (ctype_unknown, g_currentloc);
05258         }
05259     }
05260   
05261   ret-&gt;kind = XPR_COND;
05262   ret-&gt;edata = exprData_makeCond (pred, ifclause, elseclause);  
05263 
05264   <font class="keywordflow">if</font> (exprNode_isDefined (ifclause) &amp;&amp; exprNode_isDefined (elseclause))
05265     {
05266       exprNode_combineControl (ret, ifclause, elseclause);
05267     }
05268 
05269   <font class="keywordflow">return</font> (ret);
05270 }
05271 
05272 exprNode
<a name="l05273"></a><a class="code" href="exprNode_c.html#a115">05273</a> <a class="code" href="exprNode_c.html#a115">exprNode_vaArg</a> (<font class="comment">/*@only@*/</font> lltok tok, <font class="comment">/*@only@*/</font> exprNode arg, <font class="comment">/*@only@*/</font> qtype qt)<font class="keyword"></font>
05274 <font class="keyword"></font>{
05275   ctype totype = qtype_getType (qt);
05276   exprNode ret =
05277     exprNode_createPartialLocCopy (arg, fileloc_copy (lltok_getLoc (tok)));
05278   ctype targ;
05279 
05280   <font class="comment">/*</font>
05281 <font class="comment">  ** check use of va_arg : &lt;valist&gt;, type -&gt; type</font>
05282 <font class="comment">  */</font>
05283 
05284   <font class="keywordflow">if</font> (exprNode_isError (arg))
05285     {
05286     }
05287   <font class="keywordflow">else</font>
05288     {
05289       targ = exprNode_getType (arg);
05290 
05291       <font class="comment">/*</font>
05292 <font class="comment">      ** arg should have be a pointer</font>
05293 <font class="comment">      */</font>
05294 
05295       <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a31">ctype_isUA</a> (targ) ||
05296           (!usymId_equal (ctype_typeId (targ), 
05297                          <a class="code" href="usymtab_c.html#a64">usymtab_getTypeId</a> (cstring_makeLiteralTemp (<font class="stringliteral">"va_list"</font>)))))
05298         {
05299           voptgenerror
05300             (FLG_TYPE,
05301              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"First argument to va_arg is not a va_list (type %t): %s"</font>,
05302                       targ, exprNode_unparse (arg)),
05303              arg-&gt;loc);
05304         }
05305 
05306       <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (ret, arg-&gt;sref);
05307     }
05308   
05309   <font class="comment">/*</font>
05310 <font class="comment">  ** return type is totype</font>
05311 <font class="comment">  */</font>
05312 
05313   ret-&gt;typ = totype;
05314   ret-&gt;kind = XPR_VAARG;
05315   ret-&gt;edata = exprData_makeCast (tok, arg, qt);
05316 
05317   <font class="keywordflow">return</font> (ret);
05318 }
05319 
<a name="l05320"></a><a class="code" href="exprNode_c.html#a116">05320</a> exprNode <a class="code" href="exprNode_c.html#a116">exprNode_labelMarker</a> (<font class="comment">/*@only@*/</font> cstring label)<font class="keyword"></font>
05321 <font class="keyword"></font>{
05322   exprNode ret = exprNode_createPlain (ctype_undefined);
05323   ret-&gt;kind = XPR_LABEL;
05324   ret-&gt;edata = exprData_makeLiteral (label);
05325   ret-&gt;isJumpPoint = TRUE;
05326 
05327   <font class="keywordflow">return</font> (ret); <font class="comment">/* for now, ignore label */</font>
05328 }
05329 
<a name="l05330"></a><a class="code" href="exprNode_c.html#a117">05330</a> exprNode <a class="code" href="exprNode_c.html#a117">exprNode_notReached</a> (<font class="comment">/*@returned@*/</font> exprNode stmt)<font class="keyword"></font>
05331 <font class="keyword"></font>{
05332   <font class="keywordflow">if</font> (exprNode_isDefined (stmt))
05333     {
05334       stmt-&gt;isJumpPoint = TRUE;
05335 
05336       <font class="comment">/* This prevent stray no return path errors, etc. */</font>
05337       stmt-&gt;exitCode = XK_MUSTEXIT;
05338     }
05339 
05340   <font class="keywordflow">return</font> (stmt); 
05341 }
05342 
<a name="l05343"></a><a class="code" href="exprNode_c.html#a118">05343</a> <font class="keywordtype">bool</font> <a class="code" href="exprNode_c.html#a118">exprNode_isDefaultMarker</a> (exprNode e)<font class="keyword"> </font>
05344 <font class="keyword"></font>{
05345   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05346     {
05347       <font class="keywordflow">return</font> (e-&gt;kind == XPR_DEFAULT || e-&gt;kind == XPR_FTDEFAULT);
05348     }
05349 
05350   <font class="keywordflow">return</font> FALSE;
05351 }
05352 
<a name="l05353"></a><a class="code" href="exprNode_c.html#a119">05353</a> <font class="keywordtype">bool</font> <a class="code" href="exprNode_c.html#a119">exprNode_isCaseMarker</a> (exprNode e)<font class="keyword"> </font>
05354 <font class="keyword"></font>{
05355   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05356     {
05357       <font class="keywordflow">return</font> (e-&gt;kind == XPR_FTCASE || e-&gt;kind == XPR_CASE);
05358     }
05359 
05360   <font class="keywordflow">return</font> FALSE;
05361 }
05362 
<a name="l05363"></a><a class="code" href="exprNode_c.html#a120">05363</a> <font class="keywordtype">bool</font> <a class="code" href="exprNode_c.html#a120">exprNode_isLabelMarker</a> (exprNode e)<font class="keyword"> </font>
05364 <font class="keyword"></font>{
05365   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05366     {
05367       <font class="keywordflow">return</font> (e-&gt;kind == XPR_LABEL);
05368     }
05369 
05370   <font class="keywordflow">return</font> FALSE;
05371 }
05372 
<a name="l05373"></a><a class="code" href="exprNode_c.html#a121">05373</a> exprNode <a class="code" href="exprNode_c.html#a121">exprNode_caseMarker</a> (<font class="comment">/*@only@*/</font> exprNode test, <font class="keywordtype">bool</font> fallThrough)<font class="keyword"> </font>
05374 <font class="keyword"></font>{
05375   exprNode ret = exprNode_createPartialCopy (test);
05376 
05377   ret-&gt;kind = fallThrough ? XPR_FTCASE : XPR_CASE;
05378 
05379   <font class="keywordflow">if</font> (exprNode_isError (test)) {
05380     <font class="keywordflow">return</font> ret;
05381   }
05382 
05383   exprNode_checkUse (ret, test-&gt;sref, test-&gt;loc);
05384   
05385   <a class="code" href="usymtab_c.html#a36">usymtab_setExitCode</a> (ret-&gt;exitCode);
05386   
05387   <font class="keywordflow">if</font> (ret-&gt;mustBreak)
05388     {
05389       <a class="code" href="usymtab_c.html#a35">usymtab_setMustBreak</a> ();
05390     }
05391 
05392   ret-&gt;edata = exprData_makeSingle (test);
05393   ret-&gt;isJumpPoint = TRUE;
05394   
05395   <font class="keywordflow">return</font> ret;
05396 }
05397 
05398 <font class="preprocessor"># if 0</font>
05399 <font class="preprocessor"></font>exprNode exprNode_caseStatement (<font class="comment">/*@only@*/</font> exprNode test, <font class="comment">/*@only@*/</font> exprNode stmt, <font class="keywordtype">bool</font> fallThrough)<font class="keyword"></font>
05400 <font class="keyword"></font>{
05401   exprNode ret = exprNode_createPartialCopy (test);
05402 
05403   ret-&gt;kind = fallThrough ? XPR_FTCASE : XPR_CASE;
05404   ret-&gt;edata = exprData_makePair (test, stmt);
05405   ret-&gt;isJumpPoint = TRUE;
05406 
05407   <font class="keywordflow">if</font> (exprNode_isError (test))
05408     {
05409       <font class="keywordflow">return</font> ret;
05410     }
05411 
05412   exprNode_checkUse (ret, test-&gt;sref, test-&gt;loc);
05413   
05414   <font class="keywordflow">if</font> (exprNode_isError (stmt))
05415     {
05416       <font class="keywordflow">return</font> ret;
05417     }
05418   
05419   exprNode_mergeUSs (ret, stmt);
05420   
05421   ret-&gt;exitCode = stmt-&gt;exitCode;
05422   ret-&gt;mustBreak = stmt-&gt;mustBreak;
05423   ret-&gt;canBreak = stmt-&gt;canBreak;
05424 
05425   <a class="code" href="usymtab_c.html#a36">usymtab_setExitCode</a> (ret-&gt;exitCode);
05426   
05427   <font class="keywordflow">if</font> (ret-&gt;mustBreak)
05428     {
05429       <a class="code" href="usymtab_c.html#a35">usymtab_setMustBreak</a> ();
05430     }
05431   
05432   <font class="keywordflow">return</font> ret;
05433 }
05434 <font class="preprocessor"># endif</font>
05435 <font class="preprocessor"></font>
05436 <font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> exprNode 
<a name="l05437"></a><a class="code" href="exprNode_c.html#a122">05437</a> <a class="code" href="exprNode_c.html#a122">exprNode_defaultMarker</a> (<font class="comment">/*@only@*/</font> lltok def, <font class="keywordtype">bool</font> fallThrough)<font class="keyword"></font>
05438 <font class="keyword"></font>{
05439   exprNode ret = <a class="code" href="exprNode_c.html#a128">exprNode_createTok</a> (def);
05440   
05441   ret-&gt;isJumpPoint = TRUE;
05442   ret-&gt;kind = fallThrough ? XPR_FTDEFAULT : XPR_DEFAULT;
05443   <font class="keywordflow">return</font> (ret);
05444 }
05445 
05446 <font class="keywordtype">bool</font>
<a name="l05447"></a><a class="code" href="exprNode_c.html#a123">05447</a> <a class="code" href="exprNode_c.html#a123">exprNode_mayEscape</a> (exprNode e)<font class="keyword"></font>
05448 <font class="keyword"></font>{
05449   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05450     {
05451       <font class="keywordflow">return</font> <a class="code" href="varKinds_c.html#a29">exitkind_couldEscape</a> (e-&gt;exitCode);
05452     }
05453   <font class="keywordflow">return</font> FALSE;
05454 }
05455 
05456 <font class="keyword">static</font> <font class="keywordtype">bool</font>
05457 exprNode_mustBreak (exprNode e)<font class="keyword"></font>
05458 <font class="keyword"></font>{
05459   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05460     {
05461       <font class="keywordflow">return</font> e-&gt;mustBreak;
05462     }
05463   <font class="keywordflow">return</font> FALSE;
05464 }
05465 
05466 <font class="keywordtype">bool</font>
<a name="l05467"></a><a class="code" href="exprNode_c.html#a125">05467</a> <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (exprNode e)<font class="keyword"></font>
05468 <font class="keyword"></font>{
05469   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05470     {
05471       <font class="keywordflow">return</font> exitkind_mustEscape (e-&gt;exitCode) || exprNode_mustBreak (e);
05472     }
05473 
05474   <font class="keywordflow">return</font> FALSE;
05475 }
05476 
05477 <font class="keywordtype">bool</font>
<a name="l05478"></a><a class="code" href="exprNode_c.html#a126">05478</a> <a class="code" href="exprNode_c.html#a126">exprNode_errorEscape</a> (exprNode e)<font class="keyword"></font>
05479 <font class="keyword"></font>{
05480   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05481     {
05482       <font class="keywordflow">return</font> exitkind_isError (e-&gt;exitCode);
05483     }
05484 
05485   <font class="keywordflow">return</font> FALSE;
05486 }
05487 
<a name="l05488"></a><a class="code" href="exprNode_c.html#a127">05488</a> exprNode <a class="code" href="exprNode_c.html#a127">exprNode_concat</a> (<font class="comment">/*@only@*/</font> exprNode e1, <font class="comment">/*@only@*/</font> exprNode e2)<font class="keyword"></font>
05489 <font class="keyword"></font>{
05490   exprNode ret = exprNode_createPartialCopy (e1);
05491 
05492   ret-&gt;edata = exprData_makePair (e1, e2);
05493   ret-&gt;kind = XPR_STMTLIST;
05494 
05495   <font class="keywordflow">if</font> (exprNode_isDefined (e1))
05496     {
05497       ret-&gt;isJumpPoint = e1-&gt;isJumpPoint;
05498       ret-&gt;canBreak = e1-&gt;canBreak;
05499     }
05500   <font class="keywordflow">else</font>
05501     {
05502       <font class="keywordflow">if</font> (exprNode_isDefined (e2))
05503         {
05504           ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, e2-&gt;loc);
05505         }
05506     }
05507 
05508   <font class="keywordflow">if</font> (exprNode_isDefined (e2))
05509     {
05510       ret-&gt;exitCode = e2-&gt;exitCode;
05511       ret-&gt;mustBreak = e2-&gt;mustBreak;
05512       <font class="keywordflow">if</font> (e2-&gt;canBreak) ret-&gt;canBreak = TRUE;
05513     }
05514 
05515   <font class="comment">/* </font>
05516 <font class="comment">  ** if e1 must return, then e2 is unreachable!</font>
05517 <font class="comment">  */</font>
05518 
05519   <font class="keywordflow">if</font> (exprNode_isDefined (e1) &amp;&amp; exprNode_isDefined (e2))
05520     {
05521       <font class="keywordflow">if</font> ((<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (e1) || exprNode_mustBreak (e1)) 
05522           &amp;&amp; !(e2-&gt;isJumpPoint))
05523         {
05524           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_UNREACHABLE))
05525             {
05526               exprNode nr = e2;
05527 
05528               <font class="keywordflow">if</font> (e2-&gt;kind == XPR_STMT)
05529                 {
05530                   nr = exprData_getSingle (e2-&gt;edata);
05531                 }
05532 
05533               <font class="keywordflow">if</font> ((nr-&gt;kind == XPR_TOK 
05534                    &amp;&amp; <a class="code" href="lltok_c.html#a0">lltok_isSemi</a> (exprData_getTok (nr-&gt;edata))))
05535                 {
05536                   <font class="comment">/* okay to have unreachable ";" */</font>
05537                   ret-&gt;exitCode = XK_MUSTEXIT;
05538                   ret-&gt;canBreak = TRUE;
05539                 }
05540               <font class="keywordflow">else</font>
05541                 {
05542                   <font class="keywordflow">if</font> (optgenerror (FLG_UNREACHABLE,
05543                                    message (<font class="stringliteral">"Unreachable code: %s"</font>, 
05544                                             exprNode_unparseFirst (nr)),
05545                                    <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (nr)))
05546                     {
05547                       ret-&gt;isJumpPoint = TRUE;                
05548                       ret-&gt;mustBreak = FALSE;
05549                       ret-&gt;exitCode = XK_ERROR;
05550                       DPRINTF ((<font class="stringliteral">"Jump point: %s"</font>, exprNode_unparse (ret)));
05551                     }
05552                   <font class="keywordflow">else</font>
05553                     {
05554                       ret-&gt;exitCode = XK_MUSTEXIT;
05555                       ret-&gt;canBreak = TRUE;
05556                     }
05557 
05558                 }
05559             }
05560         }
05561       <font class="keywordflow">else</font>
05562         {
05563           <font class="keywordflow">if</font> ((e2-&gt;kind == XPR_CASE || e2-&gt;kind == XPR_DEFAULT))
05564             {
05565               <font class="comment">/*</font>
05566 <font class="comment">              ** We want a warning anytime we have:</font>
05567 <font class="comment">              **         case xxx: ...  </font>
05568 <font class="comment">              **                   yyy;  &lt;&lt;&lt;- no break or return</font>
05569 <font class="comment">              **         case zzz: ...</font>
05570 <font class="comment">              */</font>
05571               
05572               exprNode lastStmt = exprNode_lastStatement (e1);
05573               
05574               <font class="keywordflow">if</font> (exprNode_isDefined (lastStmt) 
05575                   &amp;&amp; !<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (lastStmt)
05576                   &amp;&amp; !exprNode_mustBreak (lastStmt)
05577                   &amp;&amp; !<a class="code" href="exprNode_c.html#a119">exprNode_isCaseMarker</a> (lastStmt)
05578                   &amp;&amp; !<a class="code" href="exprNode_c.html#a118">exprNode_isDefaultMarker</a> (lastStmt)
05579                   &amp;&amp; !<a class="code" href="exprNode_c.html#a120">exprNode_isLabelMarker</a> (lastStmt))
05580                 {
05581                   voptgenerror (FLG_CASEBREAK,
05582                                 cstring_makeLiteral 
05583                                 (<font class="stringliteral">"Fall through case (no preceeding break)"</font>),
05584                                 e2-&gt;loc);
05585                 }
05586             }
05587         }
05588     }
05589 
05590   exprNode_mergeUSs (ret, e2);
05591   
05592   <a class="code" href="usymtab_c.html#a36">usymtab_setExitCode</a> (ret-&gt;exitCode);
05593   
05594   <font class="keywordflow">if</font> (ret-&gt;mustBreak)
05595     {
05596       <a class="code" href="usymtab_c.html#a35">usymtab_setMustBreak</a> ();
05597     }
05598 
05599   <font class="keywordflow">return</font> ret;
05600 }
05601 
<a name="l05602"></a><a class="code" href="exprNode_c.html#a128">05602</a> exprNode <a class="code" href="exprNode_c.html#a128">exprNode_createTok</a> (<font class="comment">/*@only@*/</font> lltok t)<font class="keyword"></font>
05603 <font class="keyword"></font>{
05604   exprNode ret = exprNode_create (ctype_unknown);
05605   ret-&gt;kind = XPR_TOK;
05606   ret-&gt;edata = exprData_makeTok (t);
05607   <font class="keywordflow">return</font> ret;
05608 }
05609 
<a name="l05610"></a><a class="code" href="exprNode_c.html#a129">05610</a> exprNode <a class="code" href="exprNode_c.html#a129">exprNode_statement</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
05611 <font class="keyword"></font>{
05612   <font class="keywordflow">if</font> (!exprNode_isError (e))
05613     {
05614       <a class="code" href="exprChecks_c.html#a4">exprNode_checkStatement</a>(e);
05615     }
05616 
05617   <font class="keywordflow">return</font> (exprNode_statementError (e));
05618 }
05619 
05620 <font class="keyword">static</font> exprNode exprNode_statementError (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
05621 <font class="keyword"></font>{
05622   exprNode ret = exprNode_createPartialCopy (e);
05623 
05624   <font class="keywordflow">if</font> (!exprNode_isError (e))
05625     {
05626       <font class="keywordflow">if</font> (e-&gt;kind != XPR_ASSIGN)
05627         {
05628           exprNode_checkUse (ret, e-&gt;sref, e-&gt;loc);
05629         }
05630 
05631       ret-&gt;exitCode = e-&gt;exitCode;
05632       ret-&gt;canBreak = e-&gt;canBreak;
05633       ret-&gt;mustBreak = e-&gt;mustBreak;
05634     }
05635   
05636   ret-&gt;edata = exprData_makeSingle (e);
05637   ret-&gt;kind = XPR_STMT;
05638 
05639   <font class="keywordflow">return</font> ret;
05640 }
05641 
<a name="l05642"></a><a class="code" href="exprNode_c.html#a130">05642</a> exprNode <a class="code" href="exprNode_c.html#a130">exprNode_checkExpr</a> (<font class="comment">/*@returned@*/</font> exprNode e)<font class="keyword"></font>
05643 <font class="keyword"></font>{
05644   <font class="keywordflow">if</font> (!exprNode_isError (e))
05645     {
05646       <font class="keywordflow">if</font> (e-&gt;kind != XPR_ASSIGN)
05647         {
05648           exprNode_checkUse (e, e-&gt;sref, e-&gt;loc);
05649         }
05650     }
05651 
05652   <font class="keywordflow">return</font> e;
05653 }
05654 
<a name="l05655"></a><a class="code" href="exprNode_c.html#a131">05655</a> <font class="keywordtype">void</font> <a class="code" href="exprNode_c.html#a131">exprNode_produceGuards</a> (exprNode pred)<font class="keyword"></font>
05656 <font class="keyword"></font>{
05657   <font class="keywordflow">if</font> (!exprNode_isError (pred))
05658     {
05659       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (pred-&gt;typ))
05660         {
05661           pred-&gt;guards = <a class="code" href="guardSet_c.html#a13">guardSet_addTrueGuard</a> (pred-&gt;guards, pred-&gt;sref);
05662         }
05663       
05664       exprNode_checkUse (pred, pred-&gt;sref, pred-&gt;loc);
05665       exprNode_resetSref (pred);
05666     }
05667 }
05668 
<a name="l05669"></a><a class="code" href="exprNode_c.html#a132">05669</a> exprNode <a class="code" href="exprNode_c.html#a132">exprNode_makeBlock</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
05670 <font class="keyword"></font>{
05671   exprNode ret = exprNode_createPartialCopy (e);
05672 
05673   <font class="keywordflow">if</font> (!exprNode_isError (e))
05674     {
05675       ret-&gt;exitCode = e-&gt;exitCode;
05676       ret-&gt;canBreak = e-&gt;canBreak;
05677       ret-&gt;mustBreak = e-&gt;mustBreak;
05678     }
05679   
05680   ret-&gt;edata = exprData_makeSingle (e);
05681   ret-&gt;kind = XPR_BLOCK;
05682   <font class="keywordflow">return</font> ret;
05683 }
05684 
05685 <font class="keywordtype">bool</font> exprNode_isBlock (exprNode e)<font class="keyword"></font>
05686 <font class="keyword"></font>{
05687   <font class="keywordflow">return</font> (exprNode_isDefined (e) 
05688           &amp;&amp; ((e)-&gt;kind == XPR_BLOCK));
05689 }
05690  
<a name="l05691"></a><a class="code" href="exprNode_c.html#a133">05691</a> <font class="keywordtype">bool</font> <a class="code" href="exprNode_c.html#a133">exprNode_isAssign</a> (exprNode e)<font class="keyword"></font>
05692 <font class="keyword"></font>{
05693   <font class="keywordflow">if</font> (exprNode_isDefined (e))
05694     {
05695       <font class="keywordflow">return</font> (e-&gt;kind == XPR_ASSIGN);
05696     }
05697 
05698   <font class="keywordflow">return</font> FALSE;
05699 }
05700 
05701 <font class="keywordtype">bool</font> exprNode_isEmptyStatement (exprNode e)<font class="keyword"></font>
05702 <font class="keyword"></font>{
05703   <font class="keywordflow">return</font> (exprNode_isDefined (e) 
05704           &amp;&amp; (e-&gt;kind == XPR_TOK)
05705           &amp;&amp; (<a class="code" href="lltok_c.html#a0">lltok_isSemi</a> (exprData_getTok (e-&gt;edata))));
05706 }
05707 
<a name="l05708"></a><a class="code" href="exprNode_c.html#a134">05708</a> exprNode <a class="code" href="exprNode_c.html#a134">exprNode_if</a> (<font class="comment">/*@only@*/</font> exprNode pred, <font class="comment">/*@only@*/</font> exprNode tclause)<font class="keyword"></font>
05709 <font class="keyword"></font>{
05710   exprNode ret;
05711   <font class="keywordtype">bool</font> emptyErr = FALSE;
05712 
05713   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_IFEMPTY))
05714     {
05715       <font class="keywordflow">if</font> (exprNode_isEmptyStatement (tclause))
05716         {
05717           emptyErr = optgenerror (FLG_IFEMPTY,
05718                                   cstring_makeLiteral
05719                                   (<font class="stringliteral">"Body of if statement is empty"</font>),
05720                                   <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (tclause));
05721         }
05722     }
05723 
05724   <font class="keywordflow">if</font> (!emptyErr &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_IFBLOCK))
05725     {
05726       <font class="keywordflow">if</font> (exprNode_isDefined (tclause)
05727           &amp;&amp; !exprNode_isBlock (tclause))
05728         {
05729           voptgenerror (FLG_IFBLOCK,
05730                         message
05731                         (<font class="stringliteral">"Body of if statement is not a block: %s"</font>,
05732                          exprNode_unparse (tclause)),
05733                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (tclause));
05734         }
05735     }
05736 
05737   <font class="keywordflow">if</font> (exprNode_isError (pred))
05738     {
05739       <font class="keywordflow">if</font> (exprNode_isError (tclause))
05740         {
05741           ret = exprNode_createLoc (ctype_unknown, g_currentloc);
05742         }
05743       <font class="keywordflow">else</font>
05744         {
05745           ret = exprNode_createPartialCopy (tclause);
05746         }
05747     }
05748   <font class="keywordflow">else</font>
05749     {
05750       <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (pred))
05751         {
05752           voptgenerror 
05753             (FLG_UNREACHABLE,
05754              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Predicate always exits: %s"</font>, exprNode_unparse (pred)),
05755              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (pred));
05756         }
05757 
05758       <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"if"</font>), pred);
05759       exprNode_checkUse (pred, pred-&gt;sref, pred-&gt;loc);
05760       
05761       <font class="keywordflow">if</font> (!exprNode_isError (tclause))
05762         {
05763           exprNode_mergeCondUSs (pred, tclause, exprNode_undefined);
05764         }
05765       
05766       ret = exprNode_createPartialCopy (pred);
05767     }
05768 
05769   ret-&gt;kind = XPR_IF;
05770   ret-&gt;edata = exprData_makePair (pred, tclause);
05771 
05772   ret-&gt;exitCode = XK_UNKNOWN;
05773 
05774   <font class="keywordflow">if</font> (exprNode_isDefined (tclause))
05775     {
05776       ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a24">exitkind_makeConditional</a> (tclause-&gt;exitCode);
05777       ret-&gt;canBreak = tclause-&gt;canBreak;
05778       ret-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;sets, tclause-&gt;sets);
05779       ret-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;msets, tclause-&gt;msets);
05780       ret-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (ret-&gt;uses, tclause-&gt;uses);
05781     }
05782 
05783   ret-&gt;mustBreak = FALSE;
05784 
05785   <font class="keywordflow">return</font> ret;
05786 }
05787 
<a name="l05788"></a><a class="code" href="exprNode_c.html#a135">05788</a> exprNode <a class="code" href="exprNode_c.html#a135">exprNode_ifelse</a> (<font class="comment">/*@only@*/</font> exprNode pred,
05789                           <font class="comment">/*@only@*/</font> exprNode tclause, 
05790                           <font class="comment">/*@only@*/</font> exprNode eclause)<font class="keyword"></font>
05791 <font class="keyword"></font>{
05792   exprNode ret;
05793   <font class="keywordtype">bool</font> tEmptyErr = FALSE;
05794   <font class="keywordtype">bool</font> eEmptyErr = FALSE;
05795 
05796   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_IFEMPTY))
05797     {
05798       <font class="keywordflow">if</font> (exprNode_isEmptyStatement (tclause))
05799         {
05800           tEmptyErr = optgenerror 
05801             (FLG_IFEMPTY,
05802              cstring_makeLiteral
05803              (<font class="stringliteral">"Body of if clause of if statement is empty"</font>),
05804              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (tclause));
05805         }
05806 
05807       <font class="keywordflow">if</font> (exprNode_isEmptyStatement (eclause))
05808         {
05809           eEmptyErr = optgenerror 
05810             (FLG_IFEMPTY,
05811              cstring_makeLiteral
05812              (<font class="stringliteral">"Body of else clause of if statement is empty"</font>),
05813              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (eclause));
05814         }
05815     }
05816 
05817   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_IFBLOCK))
05818     {
05819       <font class="keywordflow">if</font> (!tEmptyErr
05820           &amp;&amp; exprNode_isDefined (tclause)
05821           &amp;&amp; !exprNode_isBlock (tclause))
05822         {
05823           voptgenerror (FLG_IFBLOCK,
05824                         message
05825                         (<font class="stringliteral">"Body of if clause of if statement is not a block: %s"</font>,
05826                          exprNode_unparse (tclause)),
05827                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (tclause));
05828         }
05829 
05830       <font class="keywordflow">if</font> (!eEmptyErr
05831           &amp;&amp; exprNode_isDefined (eclause)
05832           &amp;&amp; !exprNode_isBlock (eclause)
05833           &amp;&amp; !(eclause-&gt;kind == XPR_IF)
05834           &amp;&amp; !(eclause-&gt;kind == XPR_IFELSE))
05835         {
05836           voptgenerror
05837             (FLG_IFBLOCK,
05838              message
05839              (<font class="stringliteral">"Body of else clause of if statement is not a block: %s"</font>,
05840               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (eclause)),
05841              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (eclause));
05842         }
05843     }
05844 
05845   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_ELSEIFCOMPLETE))
05846     {
05847       <font class="keywordflow">if</font> (exprNode_isDefined (eclause)
05848           &amp;&amp; (eclause-&gt;kind == XPR_IF))
05849         {
05850           voptgenerror (FLG_ELSEIFCOMPLETE,
05851                         message (<font class="stringliteral">"Incomplete else if logic (no final else): %s"</font>,
05852                                  exprNode_unparse (eclause)),
05853                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (eclause));
05854         }
05855     }
05856 
05857   <font class="keywordflow">if</font> (exprNode_isError (pred))
05858     {
05859       <font class="keywordflow">if</font> (exprNode_isError (tclause))
05860         {
05861           <font class="keywordflow">if</font> (exprNode_isError (eclause))
05862             {
05863               ret = exprNode_createLoc (ctype_unknown, g_currentloc);
05864             }
05865           <font class="keywordflow">else</font>
05866             {
05867               ret = exprNode_createPartialCopy (eclause);
05868             }
05869         }
05870       <font class="keywordflow">else</font> 
05871         {
05872           ret = exprNode_createPartialCopy (tclause);
05873         }
05874     }
05875   <font class="keywordflow">else</font> <font class="comment">/* pred is okay */</font>
05876     {
05877       ret = exprNode_createPartialCopy (pred);
05878 
05879       <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (pred))
05880         {
05881           voptgenerror
05882             (FLG_UNREACHABLE,
05883              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Predicate always exits: %s"</font>, exprNode_unparse (pred)),
05884              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (pred));
05885         }
05886       
05887       <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"if"</font>), pred);
05888       exprNode_checkUse (ret, pred-&gt;sref, pred-&gt;loc);
05889       
05890       exprNode_mergeCondUSs (ret, tclause, eclause);
05891     }
05892 
05893   ret-&gt;kind = XPR_IFELSE;
05894   ret-&gt;edata = exprData_makeCond (pred, tclause, eclause);
05895 
05896   <font class="keywordflow">if</font> (exprNode_isDefined (tclause) &amp;&amp; exprNode_isDefined (eclause))
05897     {
05898       exprNode_combineControl (ret, tclause, eclause);
05899       ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, eclause-&gt;loc);
05900     }
05901 
05902   <font class="keywordflow">return</font> ret;
05903 }
05904 
05905 <font class="comment">/*</font>
05906 <font class="comment">** *allpaths &lt;- TRUE iff all executions paths must go through the switch</font>
05907 <font class="comment">*/</font>
05908 
05909 <font class="keyword">static</font> <font class="keywordtype">bool</font>
05910 checkSwitchExpr (exprNode test, <font class="comment">/*@dependent@*/</font> exprNode e, <font class="comment">/*@out@*/</font> <font class="keywordtype">bool</font> *allpaths)<font class="keyword"></font>
05911 <font class="keyword"></font>{
05912   exprNodeSList el = exprNode_flatten (e);
05913   <font class="keywordtype">bool</font> mustReturn = TRUE; <font class="comment">/* find a branch that doesn't */</font>
05914   <font class="keywordtype">bool</font> thisReturn = FALSE;
05915   <font class="keywordtype">bool</font> hasDefault = FALSE;
05916   <font class="keywordtype">bool</font> hasAllMembers = FALSE;
05917   <font class="keywordtype">bool</font> inSwitch = FALSE;
05918   <font class="keywordtype">bool</font> isEnumSwitch = FALSE;
05919   <font class="keywordtype">bool</font> canBreak = FALSE;
05920   <font class="keywordtype">bool</font> fallThrough = FALSE;
05921   ctype ct = ctype_unknown;
05922   enumNameSList usedEnums;
05923   enumNameList enums;
05924 
05925   <font class="keywordflow">if</font> (exprNode_isDefined (test))
05926     {
05927       ctype ttype;
05928 
05929       ct = test-&gt;typ;
05930       ttype = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (ct);
05931 
05932       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (ttype))
05933         {
05934           isEnumSwitch = TRUE;
05935           enums = <a class="code" href="ctype_c.html#a114">ctype_elist</a> (ttype);
05936           usedEnums = enumNameSList_new ();
05937         }
05938     }
05939 
05940   exprNodeSList_elements (el, current)<font class="keyword"></font>
05941 <font class="keyword">    </font>{
05942       <font class="keywordflow">if</font> (exprNode_isDefined (current))
05943         {
05944           <font class="keywordflow">switch</font> (current-&gt;kind)
05945             {
05946             <font class="keywordflow">case</font> XPR_FTDEFAULT:
05947             <font class="keywordflow">case</font> XPR_DEFAULT:
05948               <font class="keywordflow">if</font> (hasDefault)
05949                 {
05950                   voptgenerror 
05951                     (FLG_CONTROL,
05952                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Duplicate default cases in switch"</font>),
05953                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (current));
05954                 }          
05955             <font class="comment">/*@fallthrough@*/</font>
05956             <font class="keywordflow">case</font> XPR_FTCASE:
05957             <font class="keywordflow">case</font> XPR_CASE: 
05958               <font class="keywordflow">if</font> (current-&gt;kind == XPR_DEFAULT || current-&gt;kind == XPR_FTDEFAULT)
05959                 {
05960                   hasDefault = TRUE; 
05961                 }
05962               <font class="keywordflow">else</font>
05963                 {
05964                   <font class="keywordflow">if</font> (isEnumSwitch)
05965                     {
05966                       exprNode st = exprData_getSingle (current-&gt;edata);
05967                       uentry ue = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (st);
05968                       
05969                       <font class="keywordflow">if</font> (uentry_isValid (ue))
05970                         {
05971                           cstring cname = <a class="code" href="uentry_c.html#a194">uentry_rawName</a> (ue);
05972                           
05973                           <font class="keywordflow">if</font> (<a class="code" href="enumNameList_c.html#a7">enumNameList_member</a> (<font class="comment">/*@-usedef@*/</font>enums<font class="comment">/*@=usedef@*/</font>, cname))
05974                             {
05975                               <font class="keywordflow">if</font> (enumNameSList_member
05976                                   (<font class="comment">/*@-usedef@*/</font>usedEnums<font class="comment">/*@=usedef@*/</font>, cname))
05977                                 {
05978                                   voptgenerror
05979                                     (FLG_CONTROL,
05980                                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Duplicate case in switch: %s"</font>, 
05981                                               cname),
05982                                      current-&gt;loc);
05983                                 }
05984                               <font class="keywordflow">else</font>
05985                                 {
05986                                   enumNameSList_addh (usedEnums, cname);
05987                                 }
05988                             }
05989                           <font class="keywordflow">else</font>
05990                             {
05991                               voptgenerror 
05992                                 (FLG_TYPE,
05993                                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Case in switch not %s member: %s"</font>, 
05994                                           ctype_unparse (ct), cname),
05995                                  current-&gt;loc);
05996                             }
05997                         }
05998                     }
05999                 }
06000               
06001               <font class="keywordflow">if</font> (inSwitch &amp;&amp; !fallThrough)
06002                 {
06003                   <font class="keywordflow">if</font> (!thisReturn || canBreak) 
06004                     {
06005                       mustReturn = FALSE;
06006                     }
06007                 }
06008               
06009               fallThrough = TRUE;
06010               inSwitch = TRUE;
06011               thisReturn = FALSE;
06012               canBreak = FALSE;
06013               <font class="comment">/*@switchbreak@*/</font> <font class="keywordflow">break</font>;
06014             <font class="keywordflow">default</font>:
06015               thisReturn = thisReturn || <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (current);
06016               canBreak = canBreak || current-&gt;canBreak;
06017               <font class="keywordflow">if</font> (canBreak) fallThrough = FALSE;
06018             }
06019         }
06020     } end_exprNodeSList_elements;
06021 
06022   <font class="keywordflow">if</font> (inSwitch) <font class="comment">/* check the last one! */</font>
06023     {
06024       <font class="keywordflow">if</font> (!thisReturn || canBreak) 
06025         {
06026           mustReturn = FALSE;
06027         }
06028     }
06029   
06030   <font class="keywordflow">if</font> (isEnumSwitch)
06031     {
06032       <font class="keywordflow">if</font> (!hasDefault 
06033           &amp;&amp; (enumNameSList_size (<font class="comment">/*@-usedef@*/</font>usedEnums<font class="comment">/*@=usedef@*/</font>) != 
06034               enumNameList_size (<font class="comment">/*@-usedef@*/</font>enums<font class="comment">/*@=usedef@*/</font>)))
06035         {
06036           enumNameSList unused = enumNameSList_subtract (enums, usedEnums);
06037           
06038           voptgenerror (FLG_MISSCASE,
06039                         message (<font class="stringliteral">"Missing case%s in switch: %q"</font>,
06040                                  cstring_makeLiteralTemp 
06041                                  ((enumNameSList_size (unused) &gt; 1) ? <font class="stringliteral">"s"</font> : <font class="stringliteral">""</font>),
06042                                  enumNameSList_unparse (unused)),
06043                         g_currentloc);
06044 
06045           <a class="code" href="enumNameSList_c.html#a0">enumNameSList_free</a> (unused);
06046         }
06047       <font class="keywordflow">else</font>
06048         {
06049           hasAllMembers = TRUE;
06050           *allpaths = TRUE;
06051         }
06052 
06053       <a class="code" href="enumNameSList_c.html#a0">enumNameSList_free</a> (usedEnums);
06054     }
06055   <font class="keywordflow">else</font>
06056     {
06057       *allpaths = hasDefault;
06058     }
06059 
06060   <a class="code" href="exprNodeSList_c.html#a6">exprNodeSList_free</a> (el);
06061   <font class="keywordflow">return</font> ((hasDefault || hasAllMembers) &amp;&amp; mustReturn);  
06062 }
06063     
<a name="l06064"></a><a class="code" href="exprNode_c.html#a137">06064</a> exprNode <a class="code" href="exprNode_c.html#a137">exprNode_switch</a> (<font class="comment">/*@only@*/</font> exprNode e, <font class="comment">/*@only@*/</font> exprNode s)<font class="keyword"></font>
06065 <font class="keyword"></font>{
06066   exprNode ret = exprNode_createPartialCopy (e);
06067   <font class="keywordtype">bool</font> allpaths;
06068 
06069   DPRINTF ((<font class="stringliteral">"Switch: %s"</font>, exprNode_unparse (s)));
06070 
06071   ret-&gt;kind = XPR_SWITCH;
06072   ret-&gt;edata = exprData_makePair (e, s);
06073   
06074   <font class="keywordflow">if</font> (!exprNode_isError (s))
06075     {
06076       exprNode fs = exprNode_firstStatement (s);
06077       ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, s-&gt;loc);
06078 
06079       <font class="keywordflow">if</font> (exprNode_isUndefined (fs) 
06080           || <a class="code" href="exprNode_c.html#a119">exprNode_isCaseMarker</a> (fs) || <a class="code" href="exprNode_c.html#a120">exprNode_isLabelMarker</a> (fs)
06081           || <a class="code" href="exprNode_c.html#a118">exprNode_isDefaultMarker</a> (fs)) {
06082         ;
06083       } <font class="keywordflow">else</font> {
06084         voptgenerror (FLG_FIRSTCASE,
06085                       message
06086                       (<font class="stringliteral">"Statement after switch is not a case: %s"</font>, exprNode_unparse (fs)),
06087                       fs-&gt;loc);
06088       }
06089     }
06090 
06091   <font class="keywordflow">if</font> (!exprNode_isError (e)) 
06092     {
06093       <font class="keywordflow">if</font> (checkSwitchExpr (e, s, &amp;allpaths))
06094         {
06095           ret-&gt;exitCode = XK_MUSTRETURN;
06096         }
06097       <font class="keywordflow">else</font>
06098         {
06099           ret-&gt;exitCode = e-&gt;exitCode;
06100         }
06101 
06102       ret-&gt;canBreak = e-&gt;canBreak;
06103       ret-&gt;mustBreak = e-&gt;mustBreak;
06104     }
06105   <font class="comment">/*</font>
06106 <font class="comment">  ** forgot this!</font>
06107 <font class="comment">  **   exprNode.c:3883,32: Variable allpaths used before definition</font>
06108 <font class="comment">  */</font>
06109   <font class="keywordflow">else</font> 
06110     {
06111       allpaths = FALSE;
06112     }
06113   
06114   DPRINTF ((<font class="stringliteral">"Context exit switch!"</font>));
06115   <a class="code" href="context_c.html#a91">context_exitSwitch</a> (ret, allpaths);
06116   DPRINTF ((<font class="stringliteral">"Context exit switch done!"</font>));
06117 
06118   <font class="keywordflow">return</font> ret;
06119 }
06120 
06121 <font class="keyword">static</font> <font class="keywordtype">void</font> checkInfiniteLoop (<font class="comment">/*@notnull@*/</font> exprNode test,
06122                                <font class="comment">/*@notnull@*/</font> exprNode body)<font class="keyword"></font>
06123 <font class="keyword"></font>{
06124   sRefSet tuses = test-&gt;uses;
06125   
06126   <font class="keywordflow">if</font> (!sRefSet_isEmpty (test-&gt;uses))
06127     {
06128       sRefSet sets = <a class="code" href="sRefSet_c.html#a19">sRefSet_newCopy</a> (body-&gt;sets);
06129       <font class="keywordtype">bool</font> hasError = TRUE;
06130       <font class="keywordtype">bool</font> innerState = FALSE;
06131       sRefSet tuncon = sRefSet_undefined;
06132       
06133       sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (sets, test-&gt;sets);
06134       sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (sets, body-&gt;msets);
06135       sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (sets, test-&gt;msets);
06136 
06137       sRefSet_allElements (tuses, el)<font class="keyword"></font>
06138 <font class="keyword">        </font>{
06139           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (el))
06140             {
06141               tuncon = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (tuncon, el);
06142             }
06143           <font class="keywordflow">else</font>
06144             {
06145               <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a27">sRefSet_member</a> (sets, el))
06146                 {
06147                   hasError = FALSE;
06148                   <font class="keywordflow">break</font>;
06149                 }
06150             }
06151 
06152           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (el)
06153               || <a class="code" href="sRef_c.html#a253">sRef_isFileStatic</a> (sRef_getRootBase (el)))
06154             {
06155               innerState = TRUE;
06156             }
06157         } end_sRefSet_allElements ;
06158 
06159       <font class="keywordflow">if</font> (hasError)
06160         {
06161           sRefSet suncon = sRefSet_undefined;
06162           <font class="keywordtype">bool</font> sinner = FALSE;
06163 
06164           sRefSet_allElements (sets, el)<font class="keyword"></font>
06165 <font class="keyword">            </font>{
06166               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (el))
06167                 {
06168                   suncon = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (suncon, el);
06169                 }
06170               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a161">sRef_isInternalState</a> (el))
06171                 {
06172                   sinner = TRUE;
06173                 }
06174               <font class="keywordflow">else</font>
06175                 {
06176                   ;
06177                 }
06178             } end_sRefSet_allElements ;
06179 
06180           <font class="keywordflow">if</font> (sinner &amp;&amp; innerState)
06181             {
06182               ; 
06183             }
06184           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRefSet_isEmpty (tuncon)
06185                    &amp;&amp; sRefSet_isEmpty (suncon))
06186             {
06187               voptgenerror 
06188                 (FLG_INFLOOPS,
06189                  message
06190                  (<font class="stringliteral">"Suspected infinite loop.  No value used in loop test (%q) "</font>
06191                   <font class="stringliteral">"is modified by test or loop body."</font>,
06192                   <a class="code" href="sRefSet_c.html#a36">sRefSet_unparsePlain</a> (tuses)), 
06193                  test-&gt;loc);
06194             }
06195           <font class="keywordflow">else</font>
06196             {
06197               <font class="keywordflow">if</font> (sRefSet_isEmpty (tuncon))
06198                 {
06199                   voptgenerror 
06200                     (FLG_INFLOOPSUNCON,
06201                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspected infinite loop.  No condition values "</font>
06202                               <font class="stringliteral">"modified.  Modification possible through "</font>
06203                               <font class="stringliteral">"unconstrained calls: %q"</font>,
06204                               sRefSet_unparsePlain (suncon)), 
06205                      test-&gt;loc);
06206                 }
06207               <font class="keywordflow">else</font>
06208                 {
06209                   voptgenerror 
06210                     (FLG_INFLOOPSUNCON,
06211                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Suspected infinite loop.  No condition values "</font>
06212                               <font class="stringliteral">"modified.  Possible undetected dependency through "</font>
06213                               <font class="stringliteral">"unconstrained calls in loop test: %q"</font>,
06214                               sRefSet_unparsePlain (tuncon)), 
06215                      test-&gt;loc);
06216                 }
06217             }
06218         }
06219 
06220       <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (sets);
06221     }
06222 }
06223 
<a name="l06224"></a><a class="code" href="exprNode_c.html#a139">06224</a> exprNode <a class="code" href="exprNode_c.html#a139">exprNode_while</a> (<font class="comment">/*@keep@*/</font> exprNode t, <font class="comment">/*@keep@*/</font> exprNode b)<font class="keyword"></font>
06225 <font class="keyword"></font>{
06226   exprNode ret;
06227   <font class="keywordtype">bool</font> emptyErr = FALSE;
06228   
06229   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_WHILEEMPTY))
06230     {
06231       <font class="keywordflow">if</font> (exprNode_isEmptyStatement (b))
06232         {
06233           emptyErr = optgenerror 
06234             (FLG_WHILEEMPTY,
06235              cstring_makeLiteral
06236              (<font class="stringliteral">"Body of while statement is empty"</font>),
06237              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (b));
06238         }
06239     }
06240 
06241   <font class="keywordflow">if</font> (!emptyErr &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_WHILEBLOCK))
06242     {
06243       <font class="keywordflow">if</font> (exprNode_isDefined (b)
06244           &amp;&amp; !exprNode_isBlock (b))
06245         {
06246           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> ()
06247               &amp;&amp; (b-&gt;kind == XPR_STMTLIST
06248                   || b-&gt;kind == XPR_TOK))
06249             {
06250               ; <font class="comment">/* no error */</font>
06251             }
06252           <font class="keywordflow">else</font>
06253             {
06254               voptgenerror (FLG_WHILEBLOCK,
06255                             message
06256                             (<font class="stringliteral">"Body of while statement is not a block: %s"</font>,
06257                              exprNode_unparse (b)),
06258                             <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (b));
06259             }
06260         }
06261     }
06262   
06263   <font class="keywordflow">if</font> (exprNode_isError (t))
06264     {
06265       <font class="keywordflow">if</font> (exprNode_isError (b))
06266         {
06267           ret = exprNode_createLoc (ctype_unknown, g_currentloc);
06268         }
06269       <font class="keywordflow">else</font>
06270         {
06271           ret = exprNode_createPartialCopy (b);
06272         }
06273     }
06274   <font class="keywordflow">else</font>
06275     {
06276       exprNode test;
06277 
06278       ret = exprNode_createPartialCopy (t);
06279       
06280       llassert (t-&gt;kind == XPR_WHILEPRED);
06281 
06282       test = exprData_getSingle (t-&gt;edata);
06283 
06284       <font class="keywordflow">if</font> (!exprNode_isError (b) &amp;&amp; exprNode_isDefined (test))
06285         {
06286           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_INFLOOPS)
06287               || <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_INFLOOPSUNCON))
06288             {
06289               <font class="comment">/*</font>
06290 <font class="comment">              ** check that some variable in the predicate is set by the body</font>
06291 <font class="comment">              ** if the predicate uses any variables</font>
06292 <font class="comment">              */</font>
06293               
06294               checkInfiniteLoop (test, b);
06295             }
06296 
06297           exprNode_mergeUSs (ret, b);
06298 
06299           <font class="keywordflow">if</font> (exprNode_isDefined (b))
06300             {
06301               ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a24">exitkind_makeConditional</a> (b-&gt;exitCode);
06302             }
06303         }
06304     }
06305   
06306   ret-&gt;edata = exprData_makePair (t, b);
06307   ret-&gt;kind = XPR_WHILE;
06308 
06309   <font class="keywordflow">if</font> (exprNode_isDefined (t) &amp;&amp; <a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (t))
06310     {
06311       voptgenerror
06312         (FLG_CONTROL,
06313          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Predicate always exits: %s"</font>, exprNode_unparse (t)),
06314          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (t));
06315     }
06316 
06317   ret-&gt;exitCode = XK_NEVERESCAPE;
06318 
06319   <font class="comment">/*</font>
06320 <font class="comment">  ** If loop is infinite, and there is no break inside, </font>
06321 <font class="comment">  ** exit code is never reach. </font>
06322 <font class="comment">  */</font>
06323 
06324   <font class="keywordflow">if</font> (exprNode_knownIntValue (t))
06325     {
06326       <font class="keywordflow">if</font> (!exprNode_isZero (t)) 
06327         {
06328           <font class="keywordflow">if</font> (exprNode_isDefined (b)) 
06329             {
06330               <font class="keywordflow">if</font> (!b-&gt;canBreak) 
06331                 {
06332                   <font class="comment">/* Really, it means never reached. */</font>
06333                   ret-&gt;exitCode = XK_MUSTEXIT;
06334                 }
06335             }
06336         }
06337     } 
06338   <font class="keywordflow">else</font> 
06339     {
06340       ;
06341     }
06342 
06343   ret-&gt;canBreak = FALSE;
06344   ret-&gt;mustBreak = FALSE;
06345 
06346   <font class="keywordflow">return</font> ret; 
06347 }
06348 
06349 <font class="comment">/*</font>
06350 <font class="comment">** do { b } while (t);</font>
06351 <font class="comment">** </font>
06352 <font class="comment">** note: body passed as first argument </font>
06353 <font class="comment">*/</font>
06354 
<a name="l06355"></a><a class="code" href="exprNode_c.html#a140">06355</a> exprNode <a class="code" href="exprNode_c.html#a140">exprNode_doWhile</a> (<font class="comment">/*@only@*/</font> exprNode b, <font class="comment">/*@only@*/</font> exprNode t)<font class="keyword"></font>
06356 <font class="keyword"></font>{
06357   exprNode ret;
06358   
06359   <font class="keywordflow">if</font> (exprNode_isError (t))
06360     {
06361       <font class="keywordflow">if</font> (exprNode_isError (b))
06362         {
06363           ret = exprNode_createLoc (ctype_unknown, g_currentloc);
06364         }
06365       <font class="keywordflow">else</font>
06366         {
06367           ret = exprNode_createPartialCopy (b);
06368 
06369           ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a24">exitkind_makeConditional</a> (b-&gt;exitCode);
06370           exprNode_checkUse (ret, b-&gt;sref, b-&gt;loc);
06371           ret-&gt;exitCode = b-&gt;exitCode;
06372           ret-&gt;canBreak = b-&gt;canBreak;
06373           ret-&gt;mustBreak = b-&gt;mustBreak;
06374         }
06375     }
06376   <font class="keywordflow">else</font>
06377     {
06378       ret = exprNode_createPartialCopy (t);
06379       <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"while"</font>), t);
06380       
06381       <font class="keywordflow">if</font> (!exprNode_isError (b)) 
06382         {
06383           <font class="comment">/*</font>
06384 <font class="comment">          ** forgot the copy's --- why wasn't this detected??</font>
06385 <font class="comment">          */</font>
06386 
06387           ret-&gt;sets = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;sets, b-&gt;sets);
06388           ret-&gt;msets = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;msets, b-&gt;msets);
06389           ret-&gt;uses = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;uses, b-&gt;uses);  
06390 
06391           <font class="comment">/* left this out --- causes and aliasing bug (infinite loop)</font>
06392 <font class="comment">             should be detected?? */</font>
06393 
06394           exprNode_checkUse (ret, b-&gt;sref, b-&gt;loc);
06395           exprNode_mergeUSs (ret, t);
06396           exprNode_checkUse (ret, t-&gt;sref, t-&gt;loc);
06397 
06398           ret-&gt;exitCode = b-&gt;exitCode;
06399           ret-&gt;canBreak = b-&gt;canBreak;
06400           ret-&gt;mustBreak = b-&gt;mustBreak;
06401         }
06402     }
06403   
06404   <a class="code" href="context_c.html#a125">context_exitDoWhileClause</a> (t);
06405 
06406   ret-&gt;kind = XPR_DOWHILE;
06407   ret-&gt;edata = exprData_makePair (t, b);
06408     <font class="keywordflow">return</font> ret;
06409 }
06410 
<a name="l06411"></a><a class="code" href="exprNode_c.html#a141">06411</a> exprNode <a class="code" href="exprNode_c.html#a141">exprNode_for</a> (<font class="comment">/*@keep@*/</font> exprNode inc, <font class="comment">/*@keep@*/</font> exprNode body)<font class="keyword"></font>
06412 <font class="keyword"></font>{
06413   exprNode ret;
06414   <font class="keywordtype">bool</font> emptyErr = FALSE;
06415 
06416   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_FOREMPTY))
06417     {
06418       <font class="keywordflow">if</font> (exprNode_isEmptyStatement (body))
06419         {
06420           emptyErr = optgenerror 
06421             (FLG_FOREMPTY,
06422              cstring_makeLiteral
06423              (<font class="stringliteral">"Body of for statement is empty"</font>),
06424              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (body));
06425         }
06426     }
06427 
06428   <font class="keywordflow">if</font> (!emptyErr &amp;&amp; <a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_FORBLOCK))
06429     {
06430       <font class="keywordflow">if</font> (exprNode_isDefined (body)
06431           &amp;&amp; !exprNode_isBlock (body))
06432         {
06433           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> ()
06434               &amp;&amp; (body-&gt;kind == XPR_STMTLIST
06435                   || body-&gt;kind == XPR_TOK))
06436             {
06437               ; <font class="comment">/* no error */</font>
06438             }
06439           <font class="keywordflow">else</font>
06440             {
06441               voptgenerror (FLG_FORBLOCK,
06442                             message
06443                             (<font class="stringliteral">"Body of for statement is not a block: %s"</font>,
06444                              exprNode_unparse (body)),
06445                             <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (body));
06446             }
06447         }
06448     }
06449 
06450   <font class="comment">/*</font>
06451 <font class="comment">  ** for ud purposes:  (alreadly) init -&gt; test -&gt; (now) LOOP: body + inc + test</font>
06452 <font class="comment">  */</font>
06453 
06454   <font class="keywordflow">if</font> (exprNode_isError (body))
06455     {
06456       ret = exprNode_createPartialCopy (inc);
06457     }
06458   <font class="keywordflow">else</font>
06459     {
06460       ret = exprNode_createPartialCopy (body);
06461       
06462       ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a24">exitkind_makeConditional</a> (body-&gt;exitCode);
06463 
06464             exprNode_mergeUSs (inc, body);
06465       
06466       <font class="keywordflow">if</font> (exprNode_isDefined (inc))
06467         {
06468           exprNode tmp;
06469 
06470           <a class="code" href="context_c.html#a138">context_setMessageAnnote</a> (cstring_makeLiteral (<font class="stringliteral">"in post loop increment"</font>));
06471      
06472           
06473           tmp = exprNode_effect (exprData_getTripleInc (inc-&gt;edata));
06474           <a class="code" href="exprNode_c.html#a56">exprNode_freeShallow</a> (tmp); 
06475 
06476           <a class="code" href="context_c.html#a140">context_clearMessageAnnote</a> ();
06477           <a class="code" href="context_c.html#a138">context_setMessageAnnote</a> (cstring_makeLiteral (<font class="stringliteral">"in post loop test"</font>));
06478 
06479           tmp = exprNode_effect (exprData_getTripleTest (inc-&gt;edata));
06480           <a class="code" href="exprNode_c.html#a56">exprNode_freeShallow</a> (tmp);
06481 
06482           <a class="code" href="context_c.html#a140">context_clearMessageAnnote</a> ();
06483 
06484           ret-&gt;uses = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;uses, inc-&gt;uses);
06485           ret-&gt;sets = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;sets, inc-&gt;sets);
06486           ret-&gt;msets = <a class="code" href="sRefSet_c.html#a18">sRefSet_copy</a> (ret-&gt;msets, inc-&gt;msets);
06487         }
06488     }
06489 
06490   ret-&gt;kind = XPR_FOR;
06491   ret-&gt;edata = exprData_makePair (inc, body);
06492 
06493   <font class="keywordflow">if</font> (exprNode_isDefined (inc)) {
06494     exprNode test = exprData_getTripleTest (inc-&gt;edata);
06495 
06496     <font class="keywordflow">if</font> (exprNode_isUndefined (test)) {
06497       <font class="keywordflow">if</font> (exprNode_isDefined (body)) {
06498         <font class="keywordflow">if</font> (!body-&gt;canBreak) {
06499           <font class="comment">/* Really, it means never reached. */</font>
06500           ret-&gt;exitCode = XK_MUSTEXIT;
06501         }
06502       }
06503     }
06504   }
06505 
06506   <font class="keywordflow">return</font> (ret);
06507 }
06508 
06509 <font class="comment">/*</font>
06510 <font class="comment">** for (init; test; inc)</font>
06511 <font class="comment">** ==&gt;</font>
06512 <font class="comment">** init;</font>
06513 <font class="comment">** while (test) { body; inc; } </font>
06514 <font class="comment">**</font>
06515 <font class="comment">** Now: check use of init (may set vars for test)</font>
06516 <font class="comment">**      check use of test</font>
06517 <font class="comment">**      no checks on inc</font>
06518 <font class="comment">_*/</font>
06519 
<a name="l06520"></a><a class="code" href="exprNode_c.html#a142">06520</a> <font class="comment">/*@observer@*/</font> guardSet <a class="code" href="exprNode_c.html#a142">exprNode_getForGuards</a> (exprNode pred)<font class="keyword"></font>
06521 <font class="keyword"></font>{
06522   exprNode test;
06523 
06524   <font class="keywordflow">if</font> (exprNode_isError (pred)) <font class="keywordflow">return</font> guardSet_undefined;
06525 
06526   llassert (pred-&gt;kind == XPR_FORPRED);
06527 
06528   test = exprData_getTripleTest (pred-&gt;edata);
06529 
06530   <font class="keywordflow">if</font> (!exprNode_isError (test))
06531     {
06532       <font class="keywordflow">return</font> (test-&gt;guards);
06533     }
06534 
06535   <font class="keywordflow">return</font> guardSet_undefined;
06536 }
06537 
<a name="l06538"></a><a class="code" href="exprNode_c.html#a143">06538</a> exprNode <a class="code" href="exprNode_c.html#a143">exprNode_whilePred</a> (<font class="comment">/*@only@*/</font> exprNode test)<font class="keyword"></font>
06539 <font class="keyword"></font>{
06540   exprNode ret = exprNode_createSemiCopy (test);
06541 
06542   <font class="keywordflow">if</font> (exprNode_isDefined (test))
06543     {
06544       exprNode_copySets (ret, test);
06545       <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"while"</font>), test);
06546       exprNode_checkUse (ret, test-&gt;sref, test-&gt;loc);
06547       
06548       <a class="code" href="exprNode_c.html#a131">exprNode_produceGuards</a> (test);
06549       
06550       ret-&gt;guards = <a class="code" href="guardSet_c.html#a12">guardSet_copy</a> (test-&gt;guards);
06551     }
06552 
06553   ret-&gt;edata = exprData_makeSingle (test);
06554   ret-&gt;kind = XPR_WHILEPRED;
06555   <font class="keywordflow">return</font> ret;
06556 }
06557 
<a name="l06558"></a><a class="code" href="exprNode_c.html#a144">06558</a> exprNode <a class="code" href="exprNode_c.html#a144">exprNode_forPred</a> (<font class="comment">/*@only@*/</font> exprNode init, <font class="comment">/*@only@*/</font> exprNode test, 
06559                            <font class="comment">/*@only@*/</font> exprNode inc)<font class="keyword"></font>
06560 <font class="keyword"></font>{
06561   exprNode ret;
06562   
06563   <font class="comment">/*</font>
06564 <font class="comment">  ** for ud purposes:  init -&gt; test -&gt; LOOP: [ body, inc ]</font>
06565 <font class="comment">  */</font>
06566   
06567   <a class="code" href="exprChecks_c.html#a11">exprNode_checkPred</a> (cstring_makeLiteralTemp (<font class="stringliteral">"for"</font>), test);
06568 
06569   <font class="keywordflow">if</font> (!exprNode_isError (inc)) 
06570     {
06571       ret = exprNode_createPartialCopy (inc);
06572     }
06573   <font class="keywordflow">else</font> 
06574     {
06575       <font class="keywordflow">if</font> (!exprNode_isError (init)) 
06576         {
06577           ret = exprNode_createPartialCopy (init);
06578         }
06579       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!exprNode_isError (test)) 
06580         {
06581           ret = exprNode_createPartialCopy (test);
06582         }
06583       <font class="keywordflow">else</font> 
06584         {
06585           ret = exprNode_createUnknown ();
06586         }
06587     }
06588 
06589   exprNode_mergeUSs (ret, init);
06590 
06591   <font class="keywordflow">if</font> (exprNode_isDefined (init))
06592     {
06593       exprNode_checkUse (ret, init-&gt;sref, init-&gt;loc);
06594     }
06595 
06596   exprNode_mergeUSs (ret, test);
06597 
06598   <font class="keywordflow">if</font> (exprNode_isDefined (test))
06599     {
06600       exprNode_checkUse (ret, test-&gt;sref, test-&gt;loc);
06601     }
06602 
06603   ret-&gt;kind = XPR_FORPRED;
06604   ret-&gt;edata = exprData_makeFor (init, test, inc); 
06605   <font class="keywordflow">return</font> (ret);
06606 }
06607 
<a name="l06608"></a><a class="code" href="exprNode_c.html#a145">06608</a> <font class="comment">/*@notnull@*/</font> <font class="comment">/*@only@*/</font> exprNode <a class="code" href="exprNode_c.html#a145">exprNode_goto</a> (<font class="comment">/*@only@*/</font> cstring label)<font class="keyword"></font>
06609 <font class="keyword"></font>{
06610   exprNode ret = exprNode_createUnknown ();
06611 
06612   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a235">context_inMacro</a> ())
06613     {
06614       voptgenerror (FLG_MACROSTMT,
06615                     message (<font class="stringliteral">"Macro %s uses goto (not functional)"</font>, 
06616                              context_inFunctionName ()),
06617                     g_currentloc);
06618     }
06619   
06620   ret-&gt;kind = XPR_GOTO;
06621   ret-&gt;edata = exprData_makeLiteral (label);
06622   ret-&gt;mustBreak = TRUE;
06623   ret-&gt;exitCode = XK_GOTO;
06624   ret-&gt;canBreak = TRUE;
06625   <font class="keywordflow">return</font> ret;
06626 }
06627 
<a name="l06628"></a><a class="code" href="exprNode_c.html#a146">06628</a> exprNode <a class="code" href="exprNode_c.html#a146">exprNode_continue</a> (<font class="comment">/*@only@*/</font> lltok l, <font class="keywordtype">int</font> qcontinue)<font class="keyword"></font>
06629 <font class="keyword"></font>{
06630   exprNode ret = exprNode_createLoc (ctype_unknown, fileloc_copy (lltok_getLoc (l)));
06631 
06632   ret-&gt;kind = XPR_CONTINUE;
06633   ret-&gt;edata = exprData_makeTok (l);
06634   ret-&gt;canBreak = TRUE;
06635   ret-&gt;mustBreak = TRUE;
06636 
06637   <font class="keywordflow">if</font> (qcontinue == QSAFEBREAK)
06638     {
06639       ; <font class="comment">/* no checking */</font>
06640     }
06641   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qcontinue == QINNERCONTINUE)
06642     {
06643       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a75">context_inDeepLoop</a> ())
06644         {
06645           voptgenerror 
06646             (FLG_LOOPLOOPCONTINUE,
06647              cstring_makeLiteral (<font class="stringliteral">"Continue statement marked with innercontinue "</font>
06648                                   <font class="stringliteral">"is not inside a nested loop"</font>),
06649              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06650         }
06651     }
06652   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (qcontinue == BADTOK)
06653     {
06654       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a75">context_inDeepLoop</a> ())
06655         {
06656           voptgenerror 
06657             (FLG_LOOPLOOPCONTINUE,
06658              cstring_makeLiteral (<font class="stringliteral">"Continue statement in nested loop"</font>),
06659              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06660         }
06661     }
06662   <font class="keywordflow">else</font>
06663     {
06664       llbuglit (<font class="stringliteral">"exprNode_continue: bad qcontinue"</font>);
06665     }
06666 
06667   <font class="keywordflow">return</font> ret;
06668 }
06669 
<a name="l06670"></a><a class="code" href="exprNode_c.html#a147">06670</a> exprNode <a class="code" href="exprNode_c.html#a147">exprNode_break</a> (<font class="comment">/*@only@*/</font> lltok l, <font class="keywordtype">int</font> bqual)<font class="keyword"></font>
06671 <font class="keyword"></font>{
06672   exprNode ret = exprNode_createLoc (ctype_unknown, fileloc_copy (lltok_getLoc (l)));
06673   clause breakClause = <a class="code" href="context_c.html#a78">context_breakClause</a> ();
06674   
06675   ret-&gt;kind = XPR_BREAK;
06676   ret-&gt;edata = exprData_makeTok (l);
06677   ret-&gt;canBreak = TRUE;
06678   ret-&gt;mustBreak = TRUE;
06679   
06680   <font class="keywordflow">if</font> (breakClause == NOCLAUSE)
06681     {
06682       voptgenerror 
06683         (FLG_SYNTAX,
06684          cstring_makeLiteral (<font class="stringliteral">"Break not inside while, for or switch statement"</font>),
06685          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06686     }
06687   <font class="keywordflow">else</font>
06688     {
06689       <font class="keywordflow">if</font> (bqual != BADTOK)
06690         {
06691           <font class="keywordflow">switch</font> (bqual)
06692             {
06693             <font class="keywordflow">case</font> QSAFEBREAK:
06694               <font class="keywordflow">break</font>;
06695             <font class="keywordflow">case</font> QINNERBREAK:
06696               <font class="keywordflow">if</font> (breakClause == SWITCHCLAUSE)
06697                 {
06698                   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a76">context_inDeepSwitch</a> ())
06699                     {
06700                       voptgenerror (FLG_SYNTAX,
06701                                     cstring_makeLiteral 
06702                                     (<font class="stringliteral">"Break preceded by innerbreak is not in a deep switch"</font>),
06703                                     <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06704                     }
06705                 }
06706               <font class="keywordflow">else</font> 
06707                 {
06708                   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a75">context_inDeepLoop</a> ())
06709                     {
06710                       voptgenerror (FLG_SYNTAX,
06711                                     cstring_makeLiteral 
06712                                     (<font class="stringliteral">"Break preceded by innerbreak is not in a deep loop"</font>),
06713                                     <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06714                     }
06715                 }
06716               <font class="keywordflow">break</font>;
06717             <font class="keywordflow">case</font> QLOOPBREAK:
06718               <font class="keywordflow">if</font> (breakClause == SWITCHCLAUSE)
06719                 {
06720                   voptgenerror (FLG_SYNTAX,
06721                                 cstring_makeLiteral 
06722                                 (<font class="stringliteral">"Break preceded by loopbreak is breaking a switch"</font>),
06723                                 <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06724                 }
06725               <font class="keywordflow">break</font>;
06726             <font class="keywordflow">case</font> QSWITCHBREAK:
06727               <font class="keywordflow">if</font> (breakClause != SWITCHCLAUSE)
06728                 {
06729                   voptgenerror 
06730                     (FLG_SYNTAX,
06731                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Break preceded by switchbreak is breaking %s"</font>,
06732                               cstring_makeLiteralTemp 
06733                               ((breakClause == WHILECLAUSE
06734                                 || breakClause == DOWHILECLAUSE) ? <font class="stringliteral">"a while loop"</font>
06735                                : (breakClause == FORCLAUSE) ? <font class="stringliteral">"a for loop"</font>
06736                                : (breakClause == ITERCLAUSE) ? <font class="stringliteral">"an iterator"</font>
06737                                : <font class="stringliteral">"&lt;error loop&gt;"</font>)),
06738                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06739                 }
06740               <font class="keywordflow">break</font>;
06741             BADDEFAULT;
06742             }
06743         }
06744       <font class="keywordflow">else</font>
06745         {
06746           <font class="keywordflow">if</font> (breakClause == SWITCHCLAUSE)
06747             {
06748               clause nextBreakClause = <a class="code" href="context_c.html#a79">context_nextBreakClause</a> ();
06749 
06750               <font class="keywordflow">switch</font> (nextBreakClause)
06751                 {
06752                 <font class="keywordflow">case</font> NOCLAUSE: <font class="keywordflow">break</font>;
06753                 <font class="keywordflow">case</font> WHILECLAUSE:
06754                 <font class="keywordflow">case</font> DOWHILECLAUSE:
06755                 <font class="keywordflow">case</font> FORCLAUSE:
06756                 <font class="keywordflow">case</font> ITERCLAUSE:
06757                   voptgenerror 
06758                     (FLG_LOOPSWITCHBREAK,
06759                      cstring_makeLiteral (<font class="stringliteral">"Break statement in switch inside loop"</font>),
06760                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06761                   <font class="keywordflow">break</font>;
06762                 <font class="keywordflow">case</font> SWITCHCLAUSE:
06763                   voptgenerror 
06764                     (FLG_SWITCHSWITCHBREAK,
06765                      cstring_makeLiteral (<font class="stringliteral">"Break statement in switch inside switch"</font>),
06766                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06767                   <font class="keywordflow">break</font>;
06768                 BADDEFAULT;
06769                 }
06770             }
06771           <font class="keywordflow">else</font>
06772             {
06773               <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a75">context_inDeepLoop</a> ())
06774                 {
06775                   voptgenerror 
06776                     (FLG_LOOPLOOPBREAK,
06777                      cstring_makeLiteral (<font class="stringliteral">"Break statement in nested loop"</font>),
06778                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06779                 }
06780               <font class="keywordflow">else</font> 
06781                 {
06782                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a77">context_inDeepLoopSwitch</a> ())
06783                     {
06784                       voptgenerror 
06785                         (FLG_SWITCHLOOPBREAK,
06786                          cstring_makeLiteral (<font class="stringliteral">"Break statement in loop inside switch"</font>),
06787                          <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (ret));
06788                     }
06789                 }
06790             }
06791         }
06792     }
06793 
06794   <font class="keywordflow">return</font> ret;
06795 }
06796 
<a name="l06797"></a><a class="code" href="exprNode_c.html#a148">06797</a> exprNode <a class="code" href="exprNode_c.html#a148">exprNode_nullReturn</a> (<font class="comment">/*@only@*/</font> lltok t)<font class="keyword"></font>
06798 <font class="keyword"></font>{
06799   fileloc loc = lltok_getLoc (t);
06800   exprNode ret = exprNode_createLoc (ctype_unknown, fileloc_copy (loc));
06801   
06802   <a class="code" href="context_c.html#a128">context_returnFunction</a> ();
06803   <a class="code" href="exprChecks_c.html#a9">exprChecks_checkNullReturn</a> (loc);
06804 
06805   ret-&gt;kind = XPR_NULLRETURN;
06806   ret-&gt;edata = exprData_makeTok (t);
06807   ret-&gt;exitCode = XK_MUSTRETURN;
06808   <font class="keywordflow">return</font> ret;
06809 }
06810 
<a name="l06811"></a><a class="code" href="exprNode_c.html#a149">06811</a> exprNode <a class="code" href="exprNode_c.html#a149">exprNode_return</a> (<font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
06812 <font class="keyword"></font>{
06813   exprNode ret;
06814   
06815   <font class="keywordflow">if</font> (exprNode_isError (e))
06816     {
06817       ret = exprNode_createUnknown ();
06818     }
06819   <font class="keywordflow">else</font>
06820     {
06821       ret = exprNode_createLoc (ctype_unknown, fileloc_copy (e-&gt;loc));
06822 
06823       exprNode_checkUse (ret, e-&gt;sref, e-&gt;loc);
06824       <a class="code" href="exprChecks_c.html#a10">exprNode_checkReturn</a> (e);
06825     }
06826 
06827   <a class="code" href="context_c.html#a128">context_returnFunction</a> ();
06828   ret-&gt;kind = XPR_RETURN;
06829   ret-&gt;edata = exprData_makeSingle (e);
06830   ret-&gt;exitCode = XK_MUSTRETURN;
06831 
06832   <font class="keywordflow">return</font> (ret);
06833 }
06834 
<a name="l06835"></a><a class="code" href="exprNode_c.html#a150">06835</a> exprNode <a class="code" href="exprNode_c.html#a150">exprNode_comma</a> (<font class="comment">/*@only@*/</font> exprNode e1, <font class="comment">/*@only@*/</font> exprNode e2)<font class="keyword"></font>
06836 <font class="keyword"></font>{
06837   exprNode ret;
06838 
06839   <font class="keywordflow">if</font> (exprNode_isError (e1)) 
06840     {
06841       <font class="keywordflow">if</font> (exprNode_isError (e2))
06842         {
06843           ret = exprNode_createLoc (ctype_unknown, g_currentloc);
06844         }
06845       <font class="keywordflow">else</font>
06846         {
06847           ret = exprNode_createPartialCopy (e2);
06848           exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);
06849           ret-&gt;sref = e2-&gt;sref;
06850         }
06851     }
06852   <font class="keywordflow">else</font>
06853     {
06854       ret = exprNode_createPartialCopy (e1);
06855 
06856       exprNode_checkUse (ret, e1-&gt;sref, e1-&gt;loc);
06857 
06858       <font class="keywordflow">if</font> (!exprNode_isError (e2))
06859         {
06860           exprNode_mergeUSs (ret, e2);
06861           exprNode_checkUse (ret, e2-&gt;sref, e2-&gt;loc);
06862           ret-&gt;sref = e2-&gt;sref;
06863         }
06864     }
06865 
06866   ret-&gt;kind = XPR_COMMA;
06867   ret-&gt;edata = exprData_makePair (e1, e2);
06868   
06869   <font class="keywordflow">if</font> (exprNode_isDefined (e1))
06870     {
06871       <font class="keywordflow">if</font> (exprNode_isDefined (e2))
06872         {
06873           ret-&gt;typ = e2-&gt;typ; 
06874 
06875           <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (e1) || e1-&gt;mustBreak)
06876             {
06877               voptgenerror 
06878                 (FLG_UNREACHABLE,
06879                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Second clause of comma expression is unreachable: %s"</font>,
06880                           exprNode_unparse (e2)), 
06881                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e2));
06882             }
06883           
06884           ret-&gt;exitCode = <a class="code" href="varKinds_c.html#a25">exitkind_combine</a> (e1-&gt;exitCode, e2-&gt;exitCode);
06885           ret-&gt;mustBreak = e1-&gt;mustBreak || e2-&gt;mustBreak;
06886           ret-&gt;canBreak = e1-&gt;canBreak || e2-&gt;canBreak;
06887         }
06888       <font class="keywordflow">else</font>
06889         {
06890           <font class="keywordflow">if</font> (<a class="code" href="exprNode_c.html#a125">exprNode_mustEscape</a> (e1) || e1-&gt;mustBreak)
06891             {
06892               voptgenerror 
06893                 (FLG_UNREACHABLE,
06894                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Second clause of comma expression is unreachable: %s"</font>,
06895                           exprNode_unparse (e2)), 
06896                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e2));
06897             }
06898           
06899           ret-&gt;exitCode = e1-&gt;exitCode;
06900           ret-&gt;canBreak = e1-&gt;canBreak;
06901         }
06902     }
06903   <font class="keywordflow">else</font>
06904     {
06905       <font class="keywordflow">if</font> (exprNode_isDefined (e2))
06906         {
06907           ret-&gt;exitCode = e2-&gt;exitCode;
06908           ret-&gt;mustBreak = e2-&gt;mustBreak;
06909           ret-&gt;canBreak = e2-&gt;canBreak;
06910         }
06911     }
06912 
06913   <font class="keywordflow">return</font> (ret);
06914 }
06915 
06916 <font class="keyword">static</font> <font class="keywordtype">bool</font> exprNode_checkOneInit (<font class="comment">/*@notnull@*/</font> exprNode el, exprNode val)<font class="keyword"></font>
06917 <font class="keyword"></font>{
06918   ctype t1 = exprNode_getType (el);
06919   ctype t2 = exprNode_getType (val);
06920   <font class="keywordtype">bool</font> hasError = FALSE;
06921   
06922   <font class="keywordflow">if</font> (ctype_isUnknown (t1))
06923     {
06924       voptgenerror (FLG_IMPTYPE,
06925                     message (<font class="stringliteral">"Variable has unknown (implicitly int) type: %s"</font>,
06926                              exprNode_unparse (el)),
06927                     el-&gt;loc);
06928       
06929       t1 = ctype_int;
06930       el-&gt;typ = ctype_int;
06931     }
06932 
06933   <font class="keywordflow">if</font> (exprNode_isDefined (val) &amp;&amp; val-&gt;kind == XPR_INITBLOCK)
06934     {
06935       exprNodeList vals = exprData_getArgs (val-&gt;edata);
06936 
06937       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a76">ctype_isRealAP</a> (t1))
06938         {
06939           <font class="keywordtype">int</font> i = 0;
06940           <font class="keywordtype">int</font> nerrors = 0;
06941 
06942           exprNodeList_elements (vals, oneval)<font class="keyword"></font>
06943 <font class="keyword">            </font>{
06944               cstring istring = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%d"</font>, i);
06945               exprNode newel =
06946                 exprNode_arrayFetch 
06947                   (exprNode_fakeCopy (el),
06948                    <a class="code" href="exprNode_c.html#a72">exprNode_numLiteral</a> (ctype_int, istring,
06949                                         fileloc_copy (el-&gt;loc), i));
06950               
06951               <font class="keywordflow">if</font> (exprNode_isDefined (newel))
06952                 {
06953                   <font class="keywordflow">if</font> (exprNodeList_size (vals) == 1
06954                       &amp;&amp; <a class="code" href="ctype_c.html#a57">ctype_isString</a> (exprNode_getType (oneval))
06955                       &amp;&amp; <a class="code" href="ctype_c.html#a58">ctype_isChar</a> (exprNode_getType (newel)))
06956                     {
06957                       exprNode_freeIniter (newel);
06958                     }
06959                   <font class="keywordflow">else</font>
06960                     {
06961                       <font class="keywordflow">if</font> (exprNode_checkOneInit (newel, oneval))
06962                         {
06963                           hasError = TRUE;
06964                           nerrors++;
06965                           
06966                           <font class="keywordflow">if</font> (nerrors &gt; 3 &amp;&amp; exprNodeList_size (vals) &gt; 6)
06967                             {
06968                               llgenmsg 
06969                                 (<a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Additional initialization errors "</font>
06970                                           <font class="stringliteral">"for %s not reported"</font>,
06971                                           exprNode_unparse (el)),
06972                                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (el));
06973                               exprNode_freeIniter (newel);
06974                               <font class="keywordflow">break</font>;
06975                             }
06976                           <font class="keywordflow">else</font>
06977                             {
06978                               exprNode_freeIniter (newel);
06979                             }
06980                         }
06981                       <font class="keywordflow">else</font>
06982                         {
06983                           exprNode_freeIniter (newel);
06984                         }
06985                     }
06986                 }
06987 
06988               <a class="code" href="cstring_c.html#a27">cstring_free</a> (istring);
06989               i++;
06990               <font class="comment">/*@-branchstate@*/</font> 
06991             } end_exprNodeList_elements;
06992           <font class="comment">/*@=branchstate@*/</font>
06993         }
06994       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a119">ctype_isStruct</a> (ctype_realType (t1)))
06995         {
06996           uentryList fields = <a class="code" href="ctype_c.html#a89">ctype_getFields</a> (t1);
06997           <font class="keywordtype">int</font> i = 0;
06998 
06999           <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (fields) != exprNodeList_size (vals))
07000             {
07001               <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (fields) &gt; exprNodeList_size (vals))
07002                 {
07003                   hasError = optgenerror 
07004                     (FLG_FULLINITBLOCK,
07005                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Initializer block for "</font>
07006                               <font class="stringliteral">"%s has %d field%p, but %s has %d field%p: %q"</font>,
07007                               exprNode_unparse (el),
07008                               exprNodeList_size (vals),
07009                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (t1),
07010                               <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (fields),
07011                               <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (vals)),
07012                      val-&gt;loc);   
07013                 }
07014               <font class="keywordflow">else</font>
07015                 {
07016                   hasError = optgenerror 
07017                     (FLG_TYPE,
07018                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Initializer block for "</font>
07019                               <font class="stringliteral">"%s has %d field%p, but %s has %d field%p: %q"</font>,
07020                               exprNode_unparse (el),
07021                               exprNodeList_size (vals),
07022                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (t1),
07023                               <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (fields),
07024                               <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (vals)),
07025                      val-&gt;loc);   
07026                 }
07027             }
07028           <font class="keywordflow">else</font>
07029             {
07030               exprNodeList_elements (vals, oneval)<font class="keyword"></font>
07031 <font class="keyword">                </font>{
07032                   uentry thisfield = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (fields, i);
07033                   exprNode newel =
07034                     <a class="code" href="exprNode_c.html#a96">exprNode_fieldAccess</a> (exprNode_fakeCopy (el),
07035                                           <a class="code" href="uentry_c.html#a195">uentry_getName</a> (thisfield));
07036 
07037                   <font class="keywordflow">if</font> (exprNode_isDefined (newel))
07038                     {
07039                       <font class="keywordflow">if</font> (exprNode_checkOneInit (newel, oneval))
07040                         {
07041                           hasError = TRUE;
07042                         }
07043 
07044                       exprNode_freeIniter (newel);
07045                     }
07046 
07047                   i++;
07048                 } end_exprNodeList_elements;
07049             }
07050         }
07051       <font class="keywordflow">else</font>
07052         {
07053           hasError = optgenerror 
07054             (FLG_TYPE,
07055              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Initializer block used for "</font>
07056                       <font class="stringliteral">"%s where %t is expected: %s"</font>,
07057                       exprNode_unparse (el), t1, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (val)),
07058              val-&gt;loc);   
07059         }
07060     }
07061   <font class="keywordflow">else</font>
07062     {
07063       <font class="keywordflow">if</font> (exprNode_isDefined (val))
07064         {
07065           doAssign (el, val, TRUE);
07066           
07067           <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (t1, val))
07068             {
07069               hasError = gentypeerror 
07070                 (t1, val, t2, el,
07071                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Initial value of %s is type %t, "</font>
07072                           <font class="stringliteral">"expects %t: %s"</font>,
07073                           exprNode_unparse (el),
07074                           t2, t1, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (val)),
07075                  val-&gt;loc);
07076             }
07077         }
07078     }
07079 
07080   <font class="keywordflow">return</font> hasError;
07081 }
07082 
<a name="l07083"></a><a class="code" href="exprNode_c.html#a152">07083</a> exprNode <a class="code" href="exprNode_c.html#a152">exprNode_makeInitialization</a> (<font class="comment">/*@only@*/</font> idDecl t,
07084                                       <font class="comment">/*@only@*/</font> exprNode e)<font class="keyword"></font>
07085 <font class="keyword"></font>{
07086   uentry ue = usymtab_lookup (idDecl_observeId (t));
07087   <font class="keywordtype">bool</font> isUsed = uentry_isUsed (ue);
07088   exprNode ret = exprNode_fromIdentifierAux (ue);
07089   ctype ct = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (ret-&gt;typ);
07090   fileloc loc;
07091   
07092   <font class="keywordflow">if</font> (ctype_isUnknown (ct)) 
07093     {
07094       voptgenerror (FLG_IMPTYPE,
07095                     message (<font class="stringliteral">"Variable has unknown (implicitly int) type: %s"</font>,
07096                              idDecl_getName (t)),
07097                     exprNode_isDefined (e) ? <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e) : g_currentloc);
07098       
07099       ct = ctype_int;
07100     }
07101 
07102   <font class="keywordflow">if</font> (exprNode_isError (e)) 
07103     {
07104       e = exprNode_createUnknown ();
07105       loc = g_currentloc;
07106 
07107       <font class="comment">/* error: assume initializer is defined */</font>
07108       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (ret-&gt;sref, loc);
07109     }
07110   <font class="keywordflow">else</font>
07111     {
07112       loc = <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e);
07113       
07114       <font class="comment">/*</font>
07115 <font class="comment">      ** evs - 9 Apr 1995</font>
07116 <font class="comment">      **</font>
07117 <font class="comment">      ** was addSafeUse --- what's the problem?</font>
07118 <font class="comment">      **</font>
07119 <font class="comment">      **   int x = 3, y = x ?</font>
07120 <font class="comment">      */</font>
07121 
07122       exprNode_checkUse (ret, e-&gt;sref, e-&gt;loc);
07123       
07124       <font class="keywordflow">if</font> (ctype_isUnknown (e-&gt;typ) &amp;&amp; uentry_isValid (ue))
07125         {
07126           exprNode lhs = <a class="code" href="exprNode_c.html#a78">exprNode_createId</a> (ue);
07127 
07128           <font class="comment">/*</font>
07129 <font class="comment">          ** static storage should be undefined before initializing</font>
07130 <font class="comment">          */</font>
07131 
07132           <font class="keywordflow">if</font> (uentry_isStatic (ue))
07133             {
07134               <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (lhs-&gt;sref, SS_PARTIAL, fileloc_undefined);
07135             }
07136 
07137           (<font class="keywordtype">void</font>) exprNode_checkOneInit (lhs, e);
07138 
07139           <font class="keywordflow">if</font> (uentry_isStatic (ue))
07140             {
07141               <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (lhs-&gt;sref, SS_DEFINED, fileloc_undefined);
07142             }
07143 
07144           <a class="code" href="exprNode_c.html#a57">exprNode_free</a> (lhs);
07145         }
07146       <font class="keywordflow">else</font>
07147         {
07148           <font class="keywordflow">if</font> (!<a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (ct, e))
07149             {
07150               <font class="keywordflow">if</font> (exprNode_isZero (e) &amp;&amp; <a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (ct)) 
07151                 {
07152                   ;
07153                 }
07154               <font class="keywordflow">else</font>
07155                 {
07156                   (<font class="keywordtype">void</font>) gentypeerror 
07157                     (exprNode_getType (e), e, exprNode_getType (ret), ret,
07158                      message 
07159                      (<font class="stringliteral">"Variable %s initialized to type %t, expects %t: %s"</font>,
07160                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (ret), exprNode_getType (e), 
07161                       exprNode_getType (ret),
07162                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e)),
07163                      e-&gt;loc);
07164                 }
07165             }
07166         }
07167       
07168       <font class="keywordflow">if</font> (uentry_isStatic (ue))
07169         {
07170           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (ret-&gt;sref, SS_PARTIAL, fileloc_undefined);
07171         }
07172 
07173       doAssign (ret, e, TRUE);
07174 
07175       <font class="keywordflow">if</font> (uentry_isStatic (ue))
07176         {
07177           <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (ret-&gt;sref, SS_DEFINED, fileloc_undefined);
07178         }
07179     }
07180 
07181   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> ())
07182     {
07183       <font class="comment">/* should check if it is yield */</font>
07184       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ue, loc);
07185     }
07186   <font class="keywordflow">else</font>
07187     {
07188       <font class="keywordflow">if</font> (!isUsed) <font class="comment">/* could be @unused@-qualified variable */</font>
07189         {
07190           uentry_setNotUsed (ue);  
07191         }
07192     }
07193 
07194   ret-&gt;exitCode = XK_NEVERESCAPE;
07195   ret-&gt;mustBreak = FALSE;
07196 
07197   <font class="comment">/*</font>
07198 <font class="comment">  ** Must be before new kind is assigned!</font>
07199 <font class="comment">  */</font>
07200 
07201   exprData_free (ret-&gt;edata, ret-&gt;kind); 
07202 
07203   ret-&gt;kind = XPR_INIT;
07204   ret-&gt;edata = exprData_makeInit (t, e);
07205   exprNode_mergeUSs (ret, e);
07206   <font class="keywordflow">return</font> ret;
07207 }
07208   
<a name="l07209"></a><a class="code" href="exprNode_c.html#a153">07209</a> exprNode <a class="code" href="exprNode_c.html#a153">exprNode_iter</a> (<font class="comment">/*@observer@*/</font> uentry name,
07210                         <font class="comment">/*@only@*/</font> exprNodeList alist, 
07211                         <font class="comment">/*@only@*/</font> exprNode body,
07212                         <font class="comment">/*@observer@*/</font> uentry end)<font class="keyword"></font>
07213 <font class="keyword"></font>{
07214   exprNode ret;
07215   cstring iname;
07216 
07217   llassert (uentry_isValid (name));
07218 
07219   <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (name, exprNode_loc (body));
07220 
07221   ret = exprNode_createPartialCopy (body);
07222   iname = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (name);
07223 
07224   <font class="keywordflow">if</font> (uentry_isInvalid (end))
07225     {
07226       llerror (FLG_ITER,
07227                message (<font class="stringliteral">"Iter %s not balanced with end_%s"</font>, iname, iname));
07228     }
07229   <font class="keywordflow">else</font>
07230     {
07231       cstring ename = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (end);
07232 
07233       <font class="keywordflow">if</font> (!<a class="code" href="cstring_c.html#a22">cstring_equalPrefix</a> (ename, <font class="stringliteral">"end_"</font>))
07234         {
07235           llerror (FLG_ITER, message (<font class="stringliteral">"Iter %s not balanced with end_%s: %s"</font>, 
07236                                       iname, iname, ename));
07237         }
07238       <font class="keywordflow">else</font>
07239         {
07240           <font class="keywordflow">if</font> (!<a class="code" href="cstring_c.html#a18">cstring_equal</a> (iname, cstring_suffix (ename, 4)))
07241             {
07242               llerror (FLG_ITER, 
07243                        message (<font class="stringliteral">"Iter %s not balanced with end_%s: %s"</font>, 
07244                                 iname, iname, ename));
07245             }
07246         }
07247 
07248       <a class="code" href="cstring_c.html#a27">cstring_free</a> (ename);
07249     }
07250 
07251   <a class="code" href="context_c.html#a122">context_exitIterClause</a> (body);
07252   
07253   ret-&gt;kind = XPR_ITER;
07254   ret-&gt;edata = exprData_makeIter (name, alist, body, end);
07255 
07256   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (name))
07257     {
07258       (<font class="keywordtype">void</font>) checkArgsReal (name, body, 
07259                             uentry_getParams (name), alist, TRUE, ret);
07260     }
07261 
07262   <a class="code" href="cstring_c.html#a27">cstring_free</a> (iname);
07263 
07264   <font class="keywordflow">return</font> ret;
07265 }
07266 
07267 exprNode
<a name="l07268"></a><a class="code" href="exprNode_c.html#a154">07268</a> <a class="code" href="exprNode_c.html#a154">exprNode_iterNewId</a> (<font class="comment">/*@only@*/</font> cstring s)<font class="keyword"></font>
07269 <font class="keyword"></font>{
07270   exprNode e = exprNode_new ();
07271   uentry ue = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (uentry_getParams (getCurrentIter ()), <a class="code" href="clabstract_c.html#a43">iterParamNo</a> ());
07272 
07273   llassert (processingIterVars ());
07274 
07275   e-&gt;loc = <a class="code" href="context_c.html#a183">context_getSaveLocation</a> ();
07276 
07277   <font class="keywordflow">if</font> (fileloc_isUndefined (e-&gt;loc))
07278     {
07279       <a class="code" href="fileloc_c.html#a8">fileloc_free</a> (e-&gt;loc);
07280       e-&gt;loc = <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (g_currentloc);
07281     }
07282 
07283   e-&gt;uses = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
07284   e-&gt;sets = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
07285   e-&gt;msets = <a class="code" href="sRefSet_c.html#a0">sRefSet_new</a> ();
07286   e-&gt;kind = XPR_VAR;
07287   e-&gt;val = <a class="code" href="multiVal_c.html#a0">multiVal_unknown</a> ();
07288   e-&gt;guards = <a class="code" href="guardSet_c.html#a0">guardSet_new</a> ();
07289   e-&gt;sref = defref;
07290   e-&gt;isJumpPoint = FALSE;
07291   e-&gt;exitCode = XK_NEVERESCAPE;
07292 
07293   <font class="comment">/*&gt; missing fields, detected by lclint &lt;*/</font>
07294   e-&gt;canBreak = FALSE;
07295   e-&gt;mustBreak = FALSE;
07296   e-&gt;etext = cstring_undefined;
07297 
07298   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (ue))
07299     {
07300       uentry uue = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (s, uentry_getType (ue), 
07301                                         <a class="code" href="fileloc_c.html#a5">fileloc_copy</a> (e-&gt;loc), 
07302                                         FALSE);
07303       sRef sr;
07304 
07305       uue = <a class="code" href="usymtab_c.html#a53">usymtab_supEntrySrefReturn</a> (uue);
07306 
07307       sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (uue);
07308       <a class="code" href="sRef_c.html#a147">sRef_mergeStateQuiet</a> (sr, uentry_getSref (ue));
07309       sr = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (uue);
07310       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sr, e-&gt;loc);
07311 
07312       e-&gt;typ = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (uue);      
07313       e-&gt;sref = sr;
07314       e-&gt;edata = exprData_makeId (uue);
07315       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (uue, g_currentloc);
07316     }
07317   <font class="keywordflow">else</font>
07318     {
07319       uentry uue;
07320 
07321       <a class="code" href="sRef_c.html#a81">sRef_setGlobalScope</a> ();
07322       uue = <a class="code" href="uentry_c.html#a43">uentry_makeVariableLoc</a> (s, ctype_unknown);
07323 
07324       e-&gt;typ = ctype_unknown;
07325       e-&gt;edata = exprData_makeId (uue);
07326 
07327       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (uue, e-&gt;loc);
07328       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (uue); 
07329 
07330       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_REPEATUNRECOG))
07331         {
07332           <a class="code" href="uentry_c.html#a237">uentry_markOwned</a> (uue);
07333         }
07334       <font class="keywordflow">else</font>
07335         {
07336           <a class="code" href="usymtab_c.html#a61">usymtab_supGlobalEntry</a> (uue);      
07337         }
07338 
07339       <a class="code" href="sRef_c.html#a82">sRef_clearGlobalScope</a> ();
07340 
07341       voptgenerror (FLG_UNRECOG, message (<font class="stringliteral">"Unrecognized identifier: %s"</font>, s),
07342                     e-&gt;loc);
07343     }
07344 
07345 
07346   <a class="code" href="cstring_c.html#a27">cstring_free</a> (s);
07347   <font class="keywordflow">return</font> (e);
07348 }
07349 
07350 exprNode
<a name="l07351"></a><a class="code" href="exprNode_c.html#a155">07351</a> <a class="code" href="exprNode_c.html#a155">exprNode_iterExpr</a> (<font class="comment">/*@returned@*/</font> exprNode e)<font class="keyword"></font>
07352 <font class="keyword"></font>{
07353   <font class="keywordflow">if</font> (!<a class="code" href="clabstract_c.html#a83">processingIterVars</a> ())
07354     {
07355       llcontbuglit (<font class="stringliteral">"checkIterParam: not in iter"</font>);
07356       <font class="keywordflow">return</font> e;
07357     }
07358   
07359   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (uentryList_getN (uentry_getParams (getCurrentIter ()), 
07360                                        <a class="code" href="clabstract_c.html#a43">iterParamNo</a> ())))
07361     {
07362       <font class="keywordflow">if</font> (exprNode_isDefined (e))
07363         {
07364           <font class="keywordflow">if</font> (fileloc_isDefined (e-&gt;loc))
07365             {
07366               voptgenerror
07367                 (FLG_ITER,
07368                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Yield parameter is not simple identifier: %s"</font>, 
07369                           exprNode_unparse (e)),
07370                  e-&gt;loc);
07371             }
07372           <font class="keywordflow">else</font>
07373             {
07374               voptgenerror
07375                 (FLG_ITER,
07376                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Yield parameter is not simple identifier: %s"</font>,
07377                           exprNode_unparse (e)),
07378                  g_currentloc);
07379               
07380             }
07381         }
07382     }
07383   <font class="keywordflow">return</font> e;
07384 }
07385 
07386 exprNode
<a name="l07387"></a><a class="code" href="exprNode_c.html#a156">07387</a> <a class="code" href="exprNode_c.html#a156">exprNode_iterId</a> (<font class="comment">/*@observer@*/</font> uentry c)<font class="keyword"></font>
07388 <font class="keyword"></font>{
07389   uentry ue;
07390 
07391   llassert (processingIterVars ());
07392 
07393   ue = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (uentry_getParams (getCurrentIter ()), 
07394                         <a class="code" href="clabstract_c.html#a43">iterParamNo</a> ());
07395 
07396   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (ue))
07397     {
07398       ctype ct = <a class="code" href="uentry_c.html#a197">uentry_getType</a> (ue);
07399       exprNode e = exprNode_createPlain (ct);
07400       cstring name = <a class="code" href="uentry_c.html#a195">uentry_getName</a> (c);
07401       uentry le = <a class="code" href="uentry_c.html#a99">uentry_makeVariable</a> (name, ct, fileloc_undefined, FALSE);
07402 
07403       <a class="code" href="uentry_c.html#a278">uentry_setUsed</a> (ue, g_currentloc);
07404       <a class="code" href="uentry_c.html#a283">uentry_setHasNameError</a> (ue); 
07405       
07406       <a class="code" href="cstring_c.html#a27">cstring_free</a> (name);
07407       
07408       e-&gt;kind = XPR_VAR;
07409       e-&gt;edata = exprData_makeId (le);
07410       e-&gt;loc = <a class="code" href="context_c.html#a183">context_getSaveLocation</a> ();
07411       e-&gt;sref = <a class="code" href="uentry_c.html#a213">uentry_getSref</a> (le);
07412 
07413       <a class="code" href="usymtab_c.html#a60">usymtab_supEntrySref</a> (le);
07414 
07415       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a219">context_inHeader</a> ())
07416         {
07417           <font class="keywordflow">if</font> (optgenerror
07418               (FLG_ITER,
07419                <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Yield parameter shadows local declaration: %q"</font>,
07420                         uentry_getName (c)),
07421                fileloc_isDefined (e-&gt;loc) ? e-&gt;loc : g_currentloc))
07422             {
07423               <a class="code" href="uentry_c.html#a244">uentry_showWhereDeclared</a> (c);
07424             }
07425         }
07426 
07427       <font class="keywordflow">return</font> e;
07428     }
07429 
07430   <font class="keywordflow">return</font> (exprNode_fromIdentifierAux (c));
07431 }
07432 
<a name="l07433"></a><a class="code" href="exprNode_c.html#a157">07433</a> exprNode <a class="code" href="exprNode_c.html#a157">exprNode_iterStart</a> (<font class="comment">/*@observer@*/</font> uentry name, <font class="comment">/*@only@*/</font> exprNodeList alist)<font class="keyword"></font>
07434 <font class="keyword"></font>{
07435   exprNode ret = exprNode_create (ctype_unknown);
07436 
07437   ret-&gt;kind = XPR_ITERCALL;
07438   ret-&gt;edata = exprData_makeIterCall (name, alist);
07439   
07440   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a184">uentry_isIter</a> (name))
07441     {
07442       uentryList params = <a class="code" href="uentry_c.html#a193">uentry_getParams</a> (name);
07443 
07444       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a236">context_inIterDef</a> () 
07445           &amp;&amp; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (params) == exprNodeList_size (alist))
07446         {
07447           <font class="keywordtype">int</font> i = 0;
07448           
07449           exprNodeList_elements (alist, arg)<font class="keyword"></font>
07450 <font class="keyword">            </font>{
07451               uentry parg = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (params, i);
07452 
07453               <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (parg))
07454                 {
07455                   uentry ue = <a class="code" href="exprNode_c.html#a93">exprNode_getUentry</a> (arg);
07456 
07457                   <font class="keywordflow">if</font> (uentry_isValid (ue))
07458                     {
07459                       ;
07460                     }
07461                 }
07462 
07463               i++;
07464             } end_exprNodeList_elements;
07465         }
07466 
07467       (<font class="keywordtype">void</font>) checkArgsReal (name, ret, params, alist, TRUE, ret);
07468       checkUnspecCall (ret, params, alist);
07469     }
07470 
07471   <font class="keywordflow">return</font> ret;
07472 }
07473 
<a name="l07474"></a><a class="code" href="exprNode_c.html#a158">07474</a> <font class="comment">/*@exposed@*/</font> sRef <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (exprNode e)<font class="keyword"></font>
07475 <font class="keyword"></font>{
07476   <font class="keywordflow">if</font> (exprNode_isDefined (e))
07477     {
07478       <font class="comment">/*@access sRef@*/</font>
07479       <font class="keywordflow">if</font> (e-&gt;sref == defref) <font class="comment">/*@noaccess sRef@*/</font>
07480         {
07481           <font class="comment">/*@-mods@*/</font>
07482           e-&gt;sref = <a class="code" href="sRef_c.html#a153">sRef_makeUnknown</a> (); 
07483           <a class="code" href="sRef_c.html#a186">sRef_setAliasKind</a> (e-&gt;sref, AK_ERROR, fileloc_undefined);
07484           <font class="comment">/*@=mods@*/</font>
07485           <font class="keywordflow">return</font> e-&gt;sref;
07486         }
07487       <font class="keywordflow">else</font>
07488         {
07489           <font class="keywordflow">return</font> e-&gt;sref;
07490         }
07491     }
07492   <font class="keywordflow">else</font>
07493     {
07494       <font class="keywordflow">return</font> sRef_undefined;
07495     }
07496 }
07497 
07498 <font class="comment">/*@observer@*/</font> cstring
<a name="l07499"></a><a class="code" href="exprNode_c.html#a159">07499</a> <a class="code" href="exprNode_c.html#a159">exprNode_unparseFirst</a> (exprNode e)<font class="keyword"></font>
07500 <font class="keyword"></font>{
07501   <font class="keywordflow">if</font> (exprNode_isDefined (e))
07502     {
07503       cstring ret;
07504 
07505       <font class="keywordflow">if</font> (e-&gt;kind == XPR_STMTLIST
07506           || e-&gt;kind == XPR_COMMA || e-&gt;kind == XPR_COND)
07507         {
07508           exprNode first = exprData_getPairA (e-&gt;edata);
07509 
07510           <font class="keywordflow">if</font> (exprNode_isDefined (first))
07511             {
07512               <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a159">exprNode_unparseFirst</a> (exprData_getPairA (e-&gt;edata)));
07513             }
07514           <font class="keywordflow">else</font>
07515             {
07516               <font class="keywordflow">return</font> (cstring_makeLiteralTemp (<font class="stringliteral">"..."</font>));
07517             }
07518         }
07519 
07520       ret = <a class="code" href="cstring_c.html#a34">cstring_elide</a> (exprNode_unparse (e), 20);
07521       <a class="code" href="cstring_c.html#a26">cstring_markOwned</a> (ret);
07522       
07523       <font class="keywordflow">return</font> (ret);
07524     }
07525   <font class="keywordflow">else</font>
07526     {
07527       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;error&gt;"</font>);
07528     }
07529 }
07530 
07531 <font class="comment">/*@observer@*/</font> cstring
<a name="l07532"></a><a class="code" href="exprNode_c.html#a160">07532</a> <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprNode e)<font class="keyword"></font>
07533 <font class="keyword"></font>{
07534   <font class="keywordflow">if</font> (exprNode_isError (e))
07535     {
07536       <font class="keywordflow">return</font> cstring_makeLiteralTemp (<font class="stringliteral">"&lt;error&gt;"</font>);
07537     }
07538 
07539   <font class="keywordflow">if</font> (cstring_isDefined (e-&gt;etext))
07540     {
07541       <font class="keywordflow">return</font> e-&gt;etext;
07542     }
07543   <font class="keywordflow">else</font>
07544     {
07545       cstring ret = exprNode_doUnparse (e);
07546 
07547       <font class="comment">/*@-modifies@*/</font> <font class="comment">/* benevolent */</font>
07548       e-&gt;etext = ret; 
07549       <font class="comment">/*@=modifies@*/</font>
07550       <font class="keywordflow">return</font> ret;
07551     }
07552 }
07553 
07554 <font class="comment">/*@observer@*/</font> fileloc
<a name="l07555"></a><a class="code" href="exprNode_c.html#a161">07555</a> <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (exprNode e)<font class="keyword"></font>
07556 <font class="keyword"></font>{
07557   <font class="keywordflow">if</font> (exprNode_isError (e))
07558     {
07559       <font class="keywordflow">return</font> (g_currentloc);
07560     }
07561   <font class="keywordflow">else</font>
07562     {
07563       <font class="keywordflow">return</font> (e-&gt;loc);
07564     }
07565 }
07566 
07567 <font class="comment">/*</font>
07568 <font class="comment">** executes exprNode e</font>
07569 <font class="comment">**    recursively rexecutes as though in original parse using</font>
07570 <font class="comment">**    information in e-&gt;edata</font>
07571 <font class="comment">*/</font>
07572 
07573 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNodeList exprNodeList_effect (exprNodeList e)<font class="keyword"></font>
07574 <font class="keyword"></font>{
07575   exprNodeList ret = <a class="code" href="exprNodeList_c.html#a0">exprNodeList_new</a> ();
07576 
07577   exprNodeList_elements (e, current)<font class="keyword"></font>
07578 <font class="keyword">    </font>{
07579       <a class="code" href="exprNodeList_c.html#a2">exprNodeList_addh</a> (ret, exprNode_effect (current));
07580     } end_exprNodeList_elements;
07581 
07582   <font class="keywordflow">return</font> ret;
07583 }
07584 
07585 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNode exprNode_effect (exprNode e) 
07586    <font class="comment">/*@globals internalState@*/</font>
07587 {
07588   <font class="keywordtype">bool</font> innerEffect = inEffect;
07589   exprNode ret;
07590   exprData data;
07591 
07592   inEffect = TRUE;
07593 
07594   <a class="code" href="context_c.html#a251">context_clearJustPopped</a> ();
07595 
07596   <font class="keywordflow">if</font> (exprNode_isError (e))
07597     {
07598       ret = exprNode_undefined;
07599     }
07600   <font class="keywordflow">else</font>
07601     {
07602       <font class="comment">/*</font>
07603 <font class="comment">      ** Turn off expose and dependent transfer checking.</font>
07604 <font class="comment">      ** Need to pass exposed internal nodes,</font>
07605 <font class="comment">      ** [ copying would be a waste! ]</font>
07606 <font class="comment">      ** [ Actually, I think I wasted a lot more time than its worth ]</font>
07607 <font class="comment">      ** [ trying to do this. ]</font>
07608 <font class="comment">      */</font>
07609 
07610       <font class="comment">/*@-exposetrans@*/</font>
07611       <font class="comment">/*@-observertrans@*/</font>
07612       <font class="comment">/*@-dependenttrans@*/</font>
07613       
07614       data = e-&gt;edata;
07615       
07616       <font class="keywordflow">switch</font> (e-&gt;kind)
07617         {
07618         <font class="keywordflow">case</font> XPR_PARENS: 
07619           ret = <a class="code" href="exprNode_c.html#a97">exprNode_addParens</a> (exprData_getUopTok (data), 
07620                                     exprNode_effect (exprData_getUopNode (data)));
07621           <font class="keywordflow">break</font>;
07622         <font class="keywordflow">case</font> XPR_ASSIGN:
07623           ret = <a class="code" href="exprNode_c.html#a113">exprNode_assign</a> (exprNode_effect (exprData_getOpA (data)), 
07624                                  exprNode_effect (exprData_getOpB (data)), 
07625                                  exprData_getOpTok (data));
07626           <font class="keywordflow">break</font>;
07627         <font class="keywordflow">case</font> XPR_INITBLOCK:
07628           ret = exprNode_undefined;
07629           <font class="keywordflow">break</font>;
07630         <font class="keywordflow">case</font> XPR_CALL:
07631           ret = <a class="code" href="exprNode_c.html#a95">exprNode_functionCall</a> (exprNode_effect (exprData_getFcn (data)),
07632                                        exprNodeList_effect (exprData_getArgs (data)));
07633           <font class="keywordflow">break</font>;
07634         <font class="keywordflow">case</font> XPR_EMPTY:
07635           ret = e;
07636           <font class="keywordflow">break</font>;
07637 
07638         <font class="keywordflow">case</font> XPR_LABEL:
07639           ret = e;
07640           <font class="keywordflow">break</font>;
07641 
07642         <font class="keywordflow">case</font> XPR_CONST:
07643         <font class="keywordflow">case</font> XPR_VAR:
07644           {
07645             cstring id = exprData_getId (data);
07646             uentry ue = <a class="code" href="usymtab_c.html#a113">usymtab_lookupSafe</a> (id);
07647 
07648             ret = exprNode_fromIdentifierAux (ue);
07649             ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, e-&gt;loc);
07650             <font class="keywordflow">break</font>;
07651           }
07652         <font class="keywordflow">case</font> XPR_BODY:
07653           ret = e;
07654           <font class="keywordflow">break</font>;
07655         <font class="keywordflow">case</font> XPR_FETCH:
07656           ret = <a class="code" href="exprNode_c.html#a82">exprNode_arrayFetch</a> (exprNode_effect (exprData_getPairA (data)), 
07657                                      exprNode_effect (exprData_getPairB (data)));
07658           <font class="keywordflow">break</font>;
07659         <font class="keywordflow">case</font> XPR_OP:
07660           ret = <a class="code" href="exprNode_c.html#a111">exprNode_op</a> (exprNode_effect (exprData_getOpA (data)), 
07661                              exprNode_effect (exprData_getOpB (data)), 
07662                              exprData_getOpTok (data));
07663           <font class="keywordflow">break</font>;
07664           
07665         <font class="keywordflow">case</font> XPR_POSTOP:
07666           ret = <a class="code" href="exprNode_c.html#a99">exprNode_postOp</a> (exprNode_effect (exprData_getUopNode (data)), 
07667                                  exprData_getUopTok (data));
07668           <font class="keywordflow">break</font>;
07669         <font class="keywordflow">case</font> XPR_PREOP:
07670           ret = <a class="code" href="exprNode_c.html#a100">exprNode_preOp</a> (exprNode_effect (exprData_getUopNode (data)), 
07671                                 exprData_getUopTok (data));
07672           <font class="keywordflow">break</font>;
07673 
07674         <font class="keywordflow">case</font> XPR_OFFSETOF:
07675         <font class="keywordflow">case</font> XPR_SIZEOFT:
07676         <font class="keywordflow">case</font> XPR_SIZEOF:
07677         <font class="keywordflow">case</font> XPR_ALIGNOFT:
07678         <font class="keywordflow">case</font> XPR_ALIGNOF:
07679           ret = e;
07680           <font class="keywordflow">break</font>;
07681           
07682         <font class="keywordflow">case</font> XPR_VAARG:
07683           ret = <a class="code" href="exprNode_c.html#a115">exprNode_vaArg</a> (exprData_getCastTok (data),
07684                                 exprNode_effect (exprData_getCastNode (data)),
07685                                 exprData_getCastType (data));
07686           <font class="keywordflow">break</font>;
07687           
07688         <font class="keywordflow">case</font> XPR_CAST:
07689           ret = <a class="code" href="exprNode_c.html#a107">exprNode_cast</a> (exprData_getCastTok (data), 
07690                                exprNode_effect (exprData_getCastNode (data)), 
07691                                exprData_getCastType (data));
07692           <font class="keywordflow">break</font>;
07693         <font class="keywordflow">case</font> XPR_ITERCALL:
07694           ret = <a class="code" href="exprNode_c.html#a157">exprNode_iterStart</a> (exprData_getIterCallIter (data),
07695                                     exprNodeList_effect 
07696                                     (exprData_getIterCallArgs (data)));
07697           <font class="keywordflow">break</font>;
07698           
07699         <font class="keywordflow">case</font> XPR_ITER:
07700           ret = <a class="code" href="exprNode_c.html#a153">exprNode_iter</a> (exprData_getIterSname (data),
07701                                exprNodeList_effect (exprData_getIterAlist (data)),
07702                                exprNode_effect (exprData_getIterBody (data)),
07703                                exprData_getIterEname (data));
07704           <font class="keywordflow">break</font>;
07705           
07706         <font class="keywordflow">case</font> XPR_FOR:
07707           ret = <a class="code" href="exprNode_c.html#a141">exprNode_for</a> (exprNode_effect (exprData_getPairA (data)), 
07708                               exprNode_effect (exprData_getPairB (data)));
07709           <font class="keywordflow">break</font>;
07710           
07711         <font class="keywordflow">case</font> XPR_FORPRED:
07712           ret = <a class="code" href="exprNode_c.html#a144">exprNode_forPred</a> (exprNode_effect (exprData_getTripleInit (data)),
07713                                   exprNode_effect (exprData_getTripleTest (data)),
07714                                   exprNode_effect (exprData_getTripleInc (data)));
07715           <font class="keywordflow">break</font>;
07716           
07717         <font class="keywordflow">case</font> XPR_TOK:
07718           ret = <a class="code" href="exprNode_c.html#a128">exprNode_createTok</a> (exprData_getTok (data));
07719           <font class="keywordflow">break</font>;
07720           
07721         <font class="keywordflow">case</font> XPR_GOTO:
07722           ret = <a class="code" href="exprNode_c.html#a145">exprNode_goto</a> (exprData_getLiteral (data));
07723           ret-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (ret-&gt;loc, e-&gt;loc);
07724           <font class="keywordflow">break</font>;
07725           
07726         <font class="keywordflow">case</font> XPR_CONTINUE:
07727           ret = <a class="code" href="exprNode_c.html#a146">exprNode_continue</a> (exprData_getTok (data), QSAFEBREAK);
07728           <font class="keywordflow">break</font>;
07729           
07730         <font class="keywordflow">case</font> XPR_BREAK:
07731           ret = <a class="code" href="exprNode_c.html#a147">exprNode_break</a> (exprData_getTok (data), QSAFEBREAK);
07732           <font class="keywordflow">break</font>;
07733           
07734         <font class="keywordflow">case</font> XPR_RETURN:
07735           ret = <a class="code" href="exprNode_c.html#a149">exprNode_return</a> (exprNode_effect (exprData_getSingle (data)));
07736           <font class="keywordflow">break</font>;
07737           
07738         <font class="keywordflow">case</font> XPR_NULLRETURN:
07739           ret = <a class="code" href="exprNode_c.html#a148">exprNode_nullReturn</a> (exprData_getTok (data));
07740           <font class="keywordflow">break</font>;
07741           
07742         <font class="keywordflow">case</font> XPR_COMMA:
07743           ret = <a class="code" href="exprNode_c.html#a150">exprNode_comma</a> (exprNode_effect (exprData_getPairA (data)),
07744                                 exprNode_effect (exprData_getPairB (data)));
07745           <font class="keywordflow">break</font>;
07746           
07747         <font class="keywordflow">case</font> XPR_COND:
07748           ret = <a class="code" href="exprNode_c.html#a114">exprNode_cond</a> (exprNode_effect (exprData_getTriplePred (data)),
07749                                exprNode_effect (exprData_getTripleTrue (data)),
07750                                exprNode_effect (exprData_getTripleFalse (data)));
07751           <font class="keywordflow">break</font>;
07752         <font class="keywordflow">case</font> XPR_IF:
07753           ret = <a class="code" href="exprNode_c.html#a134">exprNode_if</a> (exprNode_effect (exprData_getPairA (data)),
07754                              exprNode_effect (exprData_getPairB (data)));
07755           <font class="keywordflow">break</font>;
07756           
07757         <font class="keywordflow">case</font> XPR_IFELSE:
07758           ret = <a class="code" href="exprNode_c.html#a135">exprNode_ifelse</a> (exprNode_effect (exprData_getTriplePred (data)),
07759                                  exprNode_effect (exprData_getTripleTrue (data)),
07760                                  exprNode_effect (exprData_getTripleFalse (data)));
07761           <font class="keywordflow">break</font>;
07762         <font class="keywordflow">case</font> XPR_WHILEPRED:
07763           ret = <a class="code" href="exprNode_c.html#a143">exprNode_whilePred</a> (exprData_getSingle (data));
07764           <font class="keywordflow">break</font>;
07765           
07766         <font class="keywordflow">case</font> XPR_WHILE:
07767           ret = <a class="code" href="exprNode_c.html#a139">exprNode_while</a> (exprNode_effect (exprData_getPairA (data)),
07768                                 exprNode_effect (exprData_getPairB (data)));
07769           <font class="keywordflow">break</font>;
07770           
07771         <font class="keywordflow">case</font> XPR_DOWHILE:
07772           ret = <a class="code" href="exprNode_c.html#a140">exprNode_doWhile</a> (exprNode_effect (exprData_getPairA (data)),
07773                                   exprNode_effect (exprData_getPairB (data)));
07774           <font class="keywordflow">break</font>;
07775 
07776         <font class="keywordflow">case</font> XPR_BLOCK:
07777           ret = <a class="code" href="exprNode_c.html#a132">exprNode_makeBlock</a> (exprNode_effect (exprData_getSingle (data)));
07778           <font class="keywordflow">break</font>;          
07779 
07780         <font class="keywordflow">case</font> XPR_STMT:
07781           ret = <a class="code" href="exprNode_c.html#a129">exprNode_statement</a> (exprNode_effect (exprData_getSingle (data)));
07782           <font class="keywordflow">break</font>;
07783           
07784         <font class="keywordflow">case</font> XPR_STMTLIST:
07785           ret = <a class="code" href="exprNode_c.html#a127">exprNode_concat</a> (exprNode_effect (exprData_getPairA (data)),
07786                                  exprNode_effect (exprData_getPairB (data)));
07787           <font class="keywordflow">break</font>;
07788           
07789         <font class="keywordflow">case</font> XPR_FTCASE:
07790         <font class="keywordflow">case</font> XPR_CASE:
07791           ret = exprNode_caseMarker 
07792             (exprNode_effect (exprData_getSingle (data)),
07793              TRUE);
07794           <font class="keywordflow">break</font>;
07795           
07796         <font class="keywordflow">case</font> XPR_FTDEFAULT:
07797         <font class="keywordflow">case</font> XPR_DEFAULT:
07798           ret = <a class="code" href="exprNode_c.html#a128">exprNode_createTok</a> (exprData_getTok (data));
07799           <font class="keywordflow">break</font>;
07800           
07801         <font class="keywordflow">case</font> XPR_SWITCH:
07802           ret = <a class="code" href="exprNode_c.html#a137">exprNode_switch</a> (exprNode_effect (exprData_getPairA (data)),
07803                                  exprNode_effect (exprData_getPairB (data)));
07804           <font class="keywordflow">break</font>;
07805           
07806         <font class="keywordflow">case</font> XPR_INIT:
07807           ret = exprNode_makeInitialization
07808             (exprData_getInitId (data),
07809              exprNode_effect (exprData_getInitNode (data)));
07810           <font class="keywordflow">break</font>;
07811           
07812         <font class="keywordflow">case</font> XPR_FACCESS:
07813           ret = <a class="code" href="exprNode_c.html#a96">exprNode_fieldAccess</a> (exprNode_effect (exprData_getFieldNode (data)),
07814                                       <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprData_getFieldName (data)));
07815           <font class="keywordflow">break</font>;
07816           
07817         <font class="keywordflow">case</font> XPR_ARROW:
07818           ret = <a class="code" href="exprNode_c.html#a98">exprNode_arrowAccess</a> (exprNode_effect (exprData_getFieldNode (data)),
07819                                       <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprData_getFieldName (data)));
07820           <font class="keywordflow">break</font>;
07821           
07822         <font class="keywordflow">case</font> XPR_STRINGLITERAL:
07823           ret = e;
07824           <font class="keywordflow">break</font>;
07825           
07826         <font class="keywordflow">case</font> XPR_NUMLIT:
07827           ret = e;
07828           <font class="keywordflow">break</font>;
07829 
07830         <font class="keywordflow">case</font> XPR_NODE:
07831           ret = e;
07832           <font class="keywordflow">break</font>;
07833           <font class="comment">/*@-branchstate@*/</font> 
07834         } 
07835       <font class="comment">/*@=branchstate@*/</font>
07836       <font class="comment">/*@=observertrans@*/</font>
07837       <font class="comment">/*@=exposetrans@*/</font>
07838       <font class="comment">/*@=dependenttrans@*/</font>
07839     }
07840 
07841   <font class="keywordflow">if</font> (!innerEffect) 
07842     {
07843       inEffect = FALSE;
07844     }
07845 
07846   <font class="keywordflow">return</font> ret;
07847 }
07848 
07849 <font class="keyword">static</font> <font class="comment">/*@observer@*/</font> cstring exprNode_rootVarName (exprNode e)<font class="keyword"></font>
07850 <font class="keyword"></font>{
07851   cstring ret;
07852   exprData data;
07853 
07854   <font class="keywordflow">if</font> (exprNode_isError (e))
07855     {
07856       <font class="keywordflow">return</font> cstring_undefined;
07857     }
07858 
07859   data = e-&gt;edata;
07860 
07861   <font class="keywordflow">switch</font> (e-&gt;kind)
07862     {
07863     <font class="keywordflow">case</font> XPR_PARENS: 
07864       ret = exprNode_rootVarName (exprData_getUopNode (data));
07865       <font class="keywordflow">break</font>;
07866     <font class="keywordflow">case</font> XPR_ASSIGN:
07867       ret = exprNode_rootVarName (exprData_getOpA (data));
07868       <font class="keywordflow">break</font>;
07869     <font class="keywordflow">case</font> XPR_CONST:
07870     <font class="keywordflow">case</font> XPR_VAR:
07871       ret = exprData_getId (data);
07872       <font class="keywordflow">break</font>;
07873     <font class="keywordflow">case</font> XPR_LABEL:
07874     <font class="keywordflow">case</font> XPR_TOK:
07875     <font class="keywordflow">case</font> XPR_ITERCALL:
07876     <font class="keywordflow">case</font> XPR_EMPTY:
07877     <font class="keywordflow">case</font> XPR_CALL:
07878     <font class="keywordflow">case</font> XPR_INITBLOCK:
07879     <font class="keywordflow">case</font> XPR_BODY:
07880     <font class="keywordflow">case</font> XPR_FETCH:
07881     <font class="keywordflow">case</font> XPR_OP:
07882     <font class="keywordflow">case</font> XPR_POSTOP:
07883     <font class="keywordflow">case</font> XPR_PREOP:
07884     <font class="keywordflow">case</font> XPR_OFFSETOF:
07885     <font class="keywordflow">case</font> XPR_ALIGNOFT:
07886     <font class="keywordflow">case</font> XPR_ALIGNOF:
07887     <font class="keywordflow">case</font> XPR_SIZEOFT:
07888     <font class="keywordflow">case</font> XPR_SIZEOF:
07889     <font class="keywordflow">case</font> XPR_VAARG:
07890     <font class="keywordflow">case</font> XPR_CAST:
07891     <font class="keywordflow">case</font> XPR_ITER:
07892     <font class="keywordflow">case</font> XPR_FOR:
07893     <font class="keywordflow">case</font> XPR_FORPRED:
07894     <font class="keywordflow">case</font> XPR_BREAK:
07895     <font class="keywordflow">case</font> XPR_RETURN:
07896     <font class="keywordflow">case</font> XPR_NULLRETURN:
07897     <font class="keywordflow">case</font> XPR_COMMA:
07898     <font class="keywordflow">case</font> XPR_COND:
07899     <font class="keywordflow">case</font> XPR_IF:
07900     <font class="keywordflow">case</font> XPR_IFELSE:
07901     <font class="keywordflow">case</font> XPR_WHILE:
07902     <font class="keywordflow">case</font> XPR_WHILEPRED:
07903     <font class="keywordflow">case</font> XPR_DOWHILE:
07904     <font class="keywordflow">case</font> XPR_GOTO:
07905     <font class="keywordflow">case</font> XPR_CONTINUE:
07906     <font class="keywordflow">case</font> XPR_FTDEFAULT:
07907     <font class="keywordflow">case</font> XPR_DEFAULT:
07908     <font class="keywordflow">case</font> XPR_SWITCH:
07909     <font class="keywordflow">case</font> XPR_FTCASE:
07910     <font class="keywordflow">case</font> XPR_CASE:
07911     <font class="keywordflow">case</font> XPR_BLOCK:
07912     <font class="keywordflow">case</font> XPR_STMT:
07913     <font class="keywordflow">case</font> XPR_STMTLIST:
07914     <font class="keywordflow">case</font> XPR_INIT:
07915     <font class="keywordflow">case</font> XPR_FACCESS:
07916     <font class="keywordflow">case</font> XPR_ARROW:
07917     <font class="keywordflow">case</font> XPR_NODE:
07918     <font class="keywordflow">case</font> XPR_NUMLIT:
07919     <font class="keywordflow">case</font> XPR_STRINGLITERAL:
07920       ret = cstring_undefined;
07921       <font class="keywordflow">break</font>;
07922     }
07923 
07924   <font class="keywordflow">return</font> ret;
07925 }
07926 
07927 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring exprNode_doUnparse (exprNode e)<font class="keyword"></font>
07928 <font class="keyword"></font>{
07929   cstring ret;
07930   exprData data;
07931 
07932   <font class="keywordflow">if</font> (exprNode_isError (e))
07933     {
07934       <font class="keyword">static</font> <font class="comment">/*@only@*/</font> cstring error = cstring_undefined;
07935 
07936       <font class="keywordflow">if</font> (!cstring_isDefined (error))
07937         {
07938           error = cstring_makeLiteral (<font class="stringliteral">"&lt;error&gt;"</font>);
07939         }
07940       
07941       <font class="keywordflow">return</font> error;
07942     }
07943 
07944   data = e-&gt;edata;
07945 
07946   <font class="keywordflow">switch</font> (e-&gt;kind)
07947     {
07948     <font class="keywordflow">case</font> XPR_PARENS: 
07949       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"(%s)"</font>, exprNode_unparse (exprData_getUopNode (e-&gt;edata)));
07950       <font class="keywordflow">break</font>;
07951     <font class="keywordflow">case</font> XPR_ASSIGN:
07952       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %s %s"</font>,
07953                      exprNode_unparse (exprData_getOpA (data)), 
07954                      <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (exprData_getOpTok (data)),
07955                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getOpB (data)));
07956       <font class="keywordflow">break</font>;
07957     <font class="keywordflow">case</font> XPR_CALL:
07958       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s(%q)"</font>,
07959                      exprNode_unparse (exprData_getFcn (data)), 
07960                      <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (exprData_getArgs (data)));
07961       <font class="keywordflow">break</font>;
07962     <font class="keywordflow">case</font> XPR_INITBLOCK:
07963       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"{ %q }"</font>, exprNodeList_unparse (exprData_getArgs (data)));
07964       <font class="keywordflow">break</font>;
07965     <font class="keywordflow">case</font> XPR_EMPTY:
07966       ret = cstring_undefined;
07967       <font class="keywordflow">break</font>;
07968     <font class="keywordflow">case</font> XPR_LABEL:
07969       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s:"</font>, exprData_getId (data));
07970       <font class="keywordflow">break</font>;
07971     <font class="keywordflow">case</font> XPR_CONST:
07972     <font class="keywordflow">case</font> XPR_VAR:
07973       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprData_getId (data));
07974       <font class="keywordflow">break</font>;
07975     <font class="keywordflow">case</font> XPR_FETCH:
07976       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s[%s]"</font>, exprNode_unparse (exprData_getPairA (data)),
07977                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
07978       <font class="keywordflow">break</font>;
07979     <font class="keywordflow">case</font> XPR_BODY:
07980       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"&lt;body&gt;"</font>);
07981       <font class="keywordflow">break</font>;
07982     <font class="keywordflow">case</font> XPR_OP:
07983       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %s %s"</font>,
07984                      exprNode_unparse (exprData_getOpA (data)), 
07985                      <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (exprData_getOpTok (data)),
07986                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getOpB (data))); 
07987       <font class="keywordflow">break</font>;
07988       
07989     <font class="keywordflow">case</font> XPR_PREOP: 
07990       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s%s"</font>,
07991                      lltok_unparse (exprData_getUopTok (data)),
07992                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getUopNode (data))); 
07993       <font class="keywordflow">break</font>;
07994 
07995     <font class="keywordflow">case</font> XPR_POSTOP:
07996       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s%s"</font>,
07997                      exprNode_unparse (exprData_getUopNode (data)),
07998                      <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (exprData_getUopTok (data))); 
07999       <font class="keywordflow">break</font>;
08000       
08001     <font class="keywordflow">case</font> XPR_OFFSETOF:
08002       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"offsetof(%s,%q)"</font>, 
08003                      ctype_unparse (qtype_getType (exprData_getOffsetType (data))),
08004                      <a class="code" href="cstringList_c.html#a6">cstringList_unparseSep</a> (exprData_getOffsetName (data), cstring_makeLiteralTemp (<font class="stringliteral">"."</font>)));
08005       <font class="keywordflow">break</font>;
08006 
08007     <font class="keywordflow">case</font> XPR_SIZEOFT:
08008       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"sizeof(%s)"</font>, ctype_unparse (qtype_getType (exprData_getType (data))));
08009       <font class="keywordflow">break</font>;
08010       
08011     <font class="keywordflow">case</font> XPR_SIZEOF:
08012       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"sizeof(%s)"</font>, exprNode_unparse (exprData_getSingle (data)));
08013       <font class="keywordflow">break</font>;
08014 
08015     <font class="keywordflow">case</font> XPR_ALIGNOFT:
08016       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"alignof(%s)"</font>, ctype_unparse (qtype_getType (exprData_getType (data))));
08017       <font class="keywordflow">break</font>;
08018       
08019     <font class="keywordflow">case</font> XPR_ALIGNOF:
08020       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"alignof(%s)"</font>, exprNode_unparse (exprData_getSingle (data)));
08021       <font class="keywordflow">break</font>;
08022       
08023     <font class="keywordflow">case</font> XPR_VAARG:
08024       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"va_arg(%s, %q)"</font>, 
08025                      exprNode_unparse (exprData_getCastNode (data)),
08026                      <a class="code" href="qtype_c.html#a10">qtype_unparse</a> (exprData_getCastType (data)));
08027       <font class="keywordflow">break</font>;
08028       
08029     <font class="keywordflow">case</font> XPR_ITERCALL:
08030       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q(%q)"</font>, 
08031                      uentry_getName (exprData_getIterCallIter (data)),
08032                      <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (exprData_getIterCallArgs (data)));
08033       <font class="keywordflow">break</font>;
08034     <font class="keywordflow">case</font> XPR_ITER:
08035       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q(%q) %s %q"</font>,
08036                      uentry_getName (exprData_getIterSname (data)),
08037                      <a class="code" href="exprNodeList_c.html#a11">exprNodeList_unparse</a> (exprData_getIterAlist (data)),
08038                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getIterBody (data)),
08039                      <a class="code" href="uentry_c.html#a195">uentry_getName</a> (exprData_getIterEname (data)));
08040       <font class="keywordflow">break</font>;
08041     <font class="keywordflow">case</font> XPR_CAST:
08042       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"(%q)%s"</font>, 
08043                      qtype_unparse (exprData_getCastType (data)),
08044                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getCastNode (data)));
08045       <font class="keywordflow">break</font>;
08046       
08047     <font class="keywordflow">case</font> XPR_FOR:
08048       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s %s"</font>, 
08049                      exprNode_unparse (exprData_getPairA (data)), 
08050                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08051       <font class="keywordflow">break</font>;
08052 
08053     <font class="keywordflow">case</font> XPR_FORPRED:
08054             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"for (%s; %s; %s)"</font>,
08055                      exprNode_unparse (exprData_getTripleInit (data)),
08056                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleTest (data)),
08057                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleInc (data)));
08058       <font class="keywordflow">break</font>;
08059       
08060     <font class="keywordflow">case</font> XPR_GOTO:
08061       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"goto %s"</font>, exprData_getLiteral (data));
08062       <font class="keywordflow">break</font>;
08063 
08064     <font class="keywordflow">case</font> XPR_CONTINUE:
08065       ret = cstring_makeLiteral (<font class="stringliteral">"continue"</font>);
08066       <font class="keywordflow">break</font>;
08067 
08068     <font class="keywordflow">case</font> XPR_BREAK:
08069       ret = cstring_makeLiteral (<font class="stringliteral">"break"</font>);
08070       <font class="keywordflow">break</font>;
08071 
08072     <font class="keywordflow">case</font> XPR_RETURN:
08073       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"return %s"</font>, exprNode_unparse (exprData_getSingle (data)));
08074       <font class="keywordflow">break</font>;
08075 
08076     <font class="keywordflow">case</font> XPR_NULLRETURN:
08077       ret = cstring_makeLiteral (<font class="stringliteral">"return"</font>);
08078       <font class="keywordflow">break</font>;
08079 
08080     <font class="keywordflow">case</font> XPR_COMMA:
08081       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s, %s"</font>, 
08082                      exprNode_unparse (exprData_getPairA (data)),
08083                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08084       <font class="keywordflow">break</font>;
08085       
08086     <font class="keywordflow">case</font> XPR_COND:
08087       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s ? %s : %s"</font>,
08088                      exprNode_unparse (exprData_getTriplePred (data)),
08089                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleTrue (data)),
08090                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleFalse (data)));
08091       <font class="keywordflow">break</font>;
08092     <font class="keywordflow">case</font> XPR_IF:
08093       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"if (%s) %s"</font>, 
08094                      exprNode_unparse (exprData_getPairA (data)),
08095                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08096       <font class="keywordflow">break</font>;
08097       
08098     <font class="keywordflow">case</font> XPR_IFELSE:
08099       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"if (%s) %s else %s"</font>,
08100                      exprNode_unparse (exprData_getTriplePred (data)),
08101                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleTrue (data)),
08102                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getTripleFalse (data)));
08103       <font class="keywordflow">break</font>;
08104     <font class="keywordflow">case</font> XPR_WHILE:
08105       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"while (%s) %s"</font>,
08106                      exprNode_unparse (exprData_getPairA (data)),
08107                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08108       <font class="keywordflow">break</font>;
08109 
08110     <font class="keywordflow">case</font> XPR_WHILEPRED:
08111       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprNode_unparse (exprData_getSingle (data)));
08112       <font class="keywordflow">break</font>;
08113 
08114     <font class="keywordflow">case</font> XPR_TOK:
08115       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (lltok_unparse (exprData_getTok (data)));
08116       <font class="keywordflow">break</font>;
08117 
08118     <font class="keywordflow">case</font> XPR_DOWHILE:
08119       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"do { %s } while (%s)"</font>,
08120                      exprNode_unparse (exprData_getPairB (data)),
08121                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairA (data)));
08122       <font class="keywordflow">break</font>;
08123       
08124     <font class="keywordflow">case</font> XPR_BLOCK:
08125       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"{ %s }"</font>, exprNode_unparseFirst (exprData_getSingle (data)));
08126       <font class="keywordflow">break</font>;
08127 
08128     <font class="keywordflow">case</font> XPR_STMT:
08129       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprNode_unparse (exprData_getSingle (data)));
08130       <font class="keywordflow">break</font>;
08131 
08132     <font class="keywordflow">case</font> XPR_STMTLIST:
08133       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s; %s"</font>, 
08134                      exprNode_unparse (exprData_getPairA (data)),
08135                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08136       <font class="keywordflow">break</font>;
08137       
08138     <font class="keywordflow">case</font> XPR_FTDEFAULT:
08139     <font class="keywordflow">case</font> XPR_DEFAULT:
08140       ret = cstring_makeLiteral (<font class="stringliteral">"default:"</font>);
08141       <font class="keywordflow">break</font>;
08142 
08143     <font class="keywordflow">case</font> XPR_SWITCH:
08144       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"switch (%s) %s"</font>, 
08145                      exprNode_unparse (exprData_getPairA (data)),
08146                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getPairB (data)));
08147       <font class="keywordflow">break</font>;
08148 
08149     <font class="keywordflow">case</font> XPR_FTCASE:
08150     <font class="keywordflow">case</font> XPR_CASE:
08151       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"case %s:"</font>, 
08152                      exprNode_unparse (exprData_getSingle (data)));
08153       <font class="keywordflow">break</font>;
08154       
08155     <font class="keywordflow">case</font> XPR_INIT:
08156       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s = %s"</font>,
08157                      idDecl_getName (exprData_getInitId (data)),
08158                      <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (exprData_getInitNode (data)));
08159       <font class="keywordflow">break</font>;
08160       
08161     <font class="keywordflow">case</font> XPR_FACCESS:
08162       ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s.%s"</font>,
08163                      exprNode_unparse (exprData_getFieldNode (data)),
08164                      exprData_getFieldName (data));
08165       <font class="keywordflow">break</font>;
08166       
08167     <font class="keywordflow">case</font> XPR_ARROW:
08168             ret = <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%s-&gt;%s"</font>,
08169                      exprNode_unparse (exprData_getFieldNode (data)),
08170                      exprData_getFieldName (data));
08171       <font class="keywordflow">break</font>;
08172 
08173     <font class="keywordflow">case</font> XPR_STRINGLITERAL:
08174       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprData_getLiteral (data));
08175       <font class="keywordflow">break</font>;
08176 
08177     <font class="keywordflow">case</font> XPR_NUMLIT:
08178       ret = <a class="code" href="cstring_c.html#a9">cstring_copy</a> (exprData_getLiteral (data));
08179       <font class="keywordflow">break</font>;
08180 
08181     <font class="keywordflow">case</font> XPR_NODE:
08182       ret = cstring_makeLiteral (<font class="stringliteral">"&lt;node&gt;"</font>);
08183       <font class="keywordflow">break</font>;
08184     }
08185 
08186   <font class="keywordflow">return</font> ret;
08187 }
08188 
08189 <font class="keywordtype">bool</font> 
<a name="l08190"></a><a class="code" href="exprNode_c.html#a163">08190</a> <a class="code" href="exprNode_c.html#a163">exprNode_isCharLit</a> (exprNode e)<font class="keyword"></font>
08191 <font class="keyword"></font>{
08192   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08193     {
08194       <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a13">multiVal_isChar</a> (exprNode_getValue (e)));
08195     }
08196   <font class="keywordflow">else</font>
08197     {
08198       <font class="keywordflow">return</font> FALSE;
08199     }
08200 }
08201 
08202 <font class="keywordtype">bool</font>
<a name="l08203"></a><a class="code" href="exprNode_c.html#a164">08203</a> <a class="code" href="exprNode_c.html#a164">exprNode_isNumLit</a> (exprNode e)<font class="keyword"></font>
08204 <font class="keyword"></font>{
08205   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08206     {
08207       <font class="keywordflow">return</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (exprNode_getValue (e)));
08208     }
08209   <font class="keywordflow">else</font>
08210     {
08211       <font class="keywordflow">return</font> FALSE;
08212     }
08213 }
08214 
08215 <font class="keyword">static</font> <font class="keywordtype">bool</font>
08216 exprNode_isFalseConstant (exprNode e)<font class="keyword"></font>
08217 <font class="keyword"></font>{
08218   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08219     {
08220       cstring s = exprNode_rootVarName (e);
08221 
08222       <font class="keywordflow">if</font> (<a class="code" href="cstring_c.html#a18">cstring_equal</a> (s, context_getFalseName ()))
08223         {
08224           <font class="keywordflow">return</font> TRUE;
08225         }
08226     }
08227 
08228   <font class="keywordflow">return</font> FALSE;
08229 }
08230 
08231 <font class="keywordtype">bool</font>
<a name="l08232"></a><a class="code" href="exprNode_c.html#a165">08232</a> <a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (ctype expected, exprNode e)<font class="keyword"></font>
08233 <font class="keyword"></font>{
08234   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08235     {
08236       multiVal m = <a class="code" href="exprNode_c.html#a75">exprNode_getValue</a> (e);
08237       
08238       <font class="keywordflow">if</font> (multiVal_isDefined (m))
08239         {
08240           <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (m))
08241             {
08242               <font class="keywordtype">long</font> <font class="keywordtype">int</font> val = <a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (m);
08243               
08244               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a63">ctype_isDirectBool</a> (ctype_realishType (expected)))
08245                 {
08246                   <font class="keywordflow">if</font> (val == 0) 
08247                     {
08248                       <font class="keywordflow">return</font> FALSE; <font class="comment">/* really?! return TRUE; allow use of 0 for FALSE */</font>
08249                     }
08250                   <font class="keywordflow">else</font> 
08251                     {
08252                       <font class="keywordflow">return</font> FALSE;
08253                     }
08254                 }
08255               
08256               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (expected))
08257                 {
08258                   <font class="comment">/*</font>
08259 <font class="comment">                  ** unsigned &lt;- [ constant &gt;= 0 is okay ]</font>
08260 <font class="comment">                  */</font>
08261                   
08262                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a136">ctype_isUnsigned</a> (expected))
08263                     {
08264                       <font class="keywordflow">if</font> (val &lt; 0)
08265                         {
08266                           <font class="keywordflow">return</font> FALSE;
08267                         }
08268                     }
08269                   
08270                   <font class="comment">/*</font>
08271 <font class="comment">                  ** No checks on sizes of integers...maybe add</font>
08272 <font class="comment">                  ** these later.</font>
08273 <font class="comment">                  */</font>
08274 
08275                   DPRINTF ((<font class="stringliteral">"Here: %s =&gt; %s"</font>, exprNode_unparse (e), <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (expected)));
08276                   DPRINTF ((<font class="stringliteral">"Type: %s / %s"</font>, ctype_unparse (exprNode_getType (e)),
08277                             bool_unparse (ctype_isInt (exprNode_getType (e)))));
08278 
08279                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NUMLITERAL) 
08280                       &amp;&amp; (<a class="code" href="ctype_c.html#a56">ctype_isRegularInt</a> (exprNode_getType (e)) || val == 0)) {
08281                     <font class="keywordflow">return</font> TRUE;
08282                   } <font class="keywordflow">else</font> {
08283                     <font class="keywordflow">if</font> (val == 0) {
08284                       <font class="keywordflow">return</font> TRUE;
08285                     } <font class="keywordflow">else</font> {
08286                       <font class="keywordflow">return</font> FALSE; <font class="comment">/* evs 2000-05-17: previously, always returned TRUE */</font>
08287                     }
08288                   }
08289                 }
08290               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a58">ctype_isChar</a> (expected))
08291                 {
08292                   <font class="keywordflow">return</font> FALSE;
08293                 }
08294               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a104">ctype_isArrayPtr</a> (expected))
08295                 {
08296                   <font class="keywordflow">return</font> (val == 0);
08297                 }
08298               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a135">ctype_isAnyFloat</a> (expected))
08299                 {
08300                   <font class="keywordflow">return</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_NUMLITERAL));
08301                 }
08302               <font class="keywordflow">else</font>
08303                 {
08304                   <font class="keywordflow">return</font> FALSE;
08305                 }
08306             }
08307           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a14">multiVal_isDouble</a> (m))
08308             {
08309               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a135">ctype_isAnyFloat</a> (expected))
08310                 {
08311                   <font class="keywordflow">return</font> TRUE;
08312                 }
08313             }
08314           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="multiVal_c.html#a13">multiVal_isChar</a> (m))
08315             {
08316               <font class="keywordtype">char</font> val = <a class="code" href="multiVal_c.html#a9">multiVal_forceChar</a> (m);          
08317               
08318               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a58">ctype_isChar</a> (expected))
08319                 {
08320                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a136">ctype_isUnsigned</a> (expected) &amp;&amp; ((<font class="keywordtype">int</font>)val) &lt; 0)
08321                     {
08322                       <font class="keywordflow">return</font> FALSE;
08323                     }
08324                   <font class="keywordflow">else</font>
08325                     {
08326                       <font class="keywordflow">return</font> TRUE;
08327                     }
08328                 }
08329             }
08330           <font class="keywordflow">else</font>
08331             {
08332               <font class="keywordflow">return</font> FALSE;
08333             }
08334         }
08335     }
08336   
08337   <font class="keywordflow">return</font> FALSE;
08338 }
08339 
08340 <font class="keywordtype">bool</font>
<a name="l08341"></a><a class="code" href="exprNode_c.html#a166">08341</a> <a class="code" href="exprNode_c.html#a166">exprNode_matchType</a> (ctype expected, exprNode e)<font class="keyword"></font>
08342 <font class="keyword"></font>{
08343   ctype actual;
08344   
08345   <font class="keywordflow">if</font> (!exprNode_isDefined (e)) <font class="keywordflow">return</font> TRUE;
08346 
08347   actual = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (exprNode_getType (e));
08348 
08349   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (ctype_realishType (expected), actual))
08350     {
08351       <font class="keywordflow">return</font> TRUE;
08352     }
08353 
08354   llassert (!exprNode_isError (e));
08355   <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (expected, e));
08356 }
08357 
08358 <font class="keyword">static</font> <font class="keywordtype">bool</font>
08359 exprNode_matchTypes (exprNode e1, exprNode e2)<font class="keyword"></font>
08360 <font class="keyword"></font>{
08361   ctype t1;
08362   ctype t2;
08363  
08364   <font class="keywordflow">if</font> (!exprNode_isDefined (e1)) <font class="keywordflow">return</font> TRUE;
08365   <font class="keywordflow">if</font> (!exprNode_isDefined (e2)) <font class="keywordflow">return</font> TRUE;
08366 
08367   <font class="comment">/*</font>
08368 <font class="comment">  ** realish type --- keep bools, bools </font>
08369 <font class="comment">  */</font> 
08370 
08371   t1 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (exprNode_getType (e1));
08372   t2 = <a class="code" href="ctype_c.html#a30">ctype_realishType</a> (exprNode_getType (e2));
08373 
08374   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (t1, t2)) 
08375     {
08376       <font class="keywordflow">return</font> TRUE;
08377     }
08378 
08379   <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (t1, e2) || <a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (t2, e1));
08380 }
08381 
08382 <font class="comment">/*</font>
08383 <font class="comment">** pass e as ct</font>
08384 <font class="comment">*/</font>
08385 
08386 <font class="keyword">static</font> <font class="keywordtype">bool</font>
08387   exprNode_matchArgType (ctype ct, exprNode e)<font class="keyword"></font>
08388 <font class="keyword"></font>{
08389   ctype et;
08390 
08391   <font class="keywordflow">if</font> (!exprNode_isDefined (e))
08392     {
08393       <font class="keywordflow">return</font> TRUE;
08394     }
08395 
08396   et = <a class="code" href="ctype_c.html#a27">ctype_realType</a> (exprNode_getType (e));
08397 
08398   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a98">ctype_matchArg</a> (ct, et)) <font class="keywordflow">return</font> TRUE;
08399   
08400   llassert (!exprNode_isError (e));
08401   <font class="keywordflow">return</font> (<a class="code" href="exprNode_c.html#a165">exprNode_matchLiteral</a> (ct, e));
08402 }
08403 
08404 <font class="keyword">static</font> <font class="comment">/*@only@*/</font> exprNodeSList
08405   exprNode_flatten (<font class="comment">/*@dependent@*/</font> exprNode e) <font class="comment">/*@*/</font>
08406 {
08407   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08408     {
08409       <font class="keywordflow">if</font> (e-&gt;kind == XPR_STMTLIST)
08410         {
08411           <font class="keywordflow">return</font> (exprNodeSList_append
08412                   (exprNode_flatten (exprData_getPairA (e-&gt;edata)),
08413                    exprNode_flatten (exprData_getPairB (e-&gt;edata))));
08414         }
08415       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;kind == XPR_BLOCK)
08416         {
08417           <font class="keywordflow">return</font> (exprNode_flatten (exprData_getSingle (e-&gt;edata)));
08418         }
08419       <font class="keywordflow">else</font>
08420         {
08421           <font class="keywordflow">return</font> (<a class="code" href="exprNodeSList_c.html#a4">exprNodeSList_singleton</a> (e));
08422         }
08423     }
08424 
08425   <font class="keywordflow">return</font> <a class="code" href="exprNodeSList_c.html#a0">exprNodeSList_new</a> ();
08426 }
08427 
08428 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> exprNode
08429 exprNode_lastStatement (<font class="comment">/*@returned@*/</font> exprNode e)<font class="keyword"></font>
08430 <font class="keyword"></font>{
08431   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08432     {
08433       <font class="keywordflow">if</font> (e-&gt;kind == XPR_STMTLIST)
08434         {
08435           exprNode b = exprData_getPairB (e-&gt;edata);
08436 
08437           <font class="keywordflow">if</font> (exprNode_isDefined (b))
08438             {
08439               <font class="keywordflow">return</font> exprNode_lastStatement (b);
08440             }
08441           <font class="keywordflow">else</font>
08442             {
08443               <font class="keywordflow">return</font> exprNode_lastStatement (exprData_getPairA (e-&gt;edata));
08444             }
08445         }
08446       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;kind == XPR_BLOCK)
08447         {
08448           <font class="keywordflow">return</font> (exprNode_lastStatement (exprData_getSingle (e-&gt;edata)));
08449         }
08450       <font class="keywordflow">else</font>
08451         {
08452           <font class="keywordflow">return</font> (e);
08453         }
08454     }
08455 
08456   <font class="keywordflow">return</font> exprNode_undefined;
08457 }
08458 
08459 <font class="keyword">static</font> <font class="comment">/*@exposed@*/</font> exprNode
08460 exprNode_firstStatement (<font class="comment">/*@returned@*/</font> exprNode e)<font class="keyword"></font>
08461 <font class="keyword"></font>{
08462   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08463     {
08464       <font class="keywordflow">if</font> (e-&gt;kind == XPR_STMTLIST)
08465         {
08466           exprNode b = exprData_getPairA (e-&gt;edata);
08467 
08468           <font class="keywordflow">if</font> (exprNode_isDefined (b))
08469             {
08470               <font class="keywordflow">return</font> exprNode_firstStatement (b);
08471             }
08472           <font class="keywordflow">else</font>
08473             {
08474               <font class="keywordflow">return</font> exprNode_firstStatement (exprData_getPairB (e-&gt;edata));
08475             }
08476         }
08477       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;kind == XPR_BLOCK)
08478         {
08479           <font class="keywordflow">return</font> (exprNode_firstStatement (exprData_getSingle (e-&gt;edata)));
08480         }
08481       <font class="keywordflow">else</font>
08482         {
08483           <font class="keywordflow">return</font> (e);
08484         }
08485     }
08486 
08487   <font class="keywordflow">return</font> exprNode_undefined;
08488 }
08489   
08490 <font class="keyword">static</font> <font class="keywordtype">void</font>
08491 exprNode_mergeUSs (exprNode res, exprNode other)<font class="keyword"></font>
08492 <font class="keyword"></font>{
08493   <font class="keywordflow">if</font> (exprNode_isDefined (res) &amp;&amp; exprNode_isDefined (other))
08494     {
08495       res-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;msets, other-&gt;msets);
08496       res-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;sets, other-&gt;sets);
08497       res-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;uses, other-&gt;uses);
08498     }
08499 }
08500 
08501 <font class="keyword">static</font> <font class="keywordtype">void</font>
08502 exprNode_mergeCondUSs (exprNode res, exprNode other1, exprNode other2)<font class="keyword"></font>
08503 <font class="keyword"></font>{
08504   <font class="keywordflow">if</font> (exprNode_isDefined (res))
08505     {
08506       <font class="keywordflow">if</font> (exprNode_isDefined (other1))
08507         {
08508           res-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;sets, other1-&gt;sets);
08509           res-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;msets, other1-&gt;msets);
08510           res-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;uses, other1-&gt;uses);
08511         }
08512       <font class="keywordflow">if</font> (exprNode_isDefined (other2))
08513         {
08514           res-&gt;sets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;sets, other2-&gt;sets);
08515           res-&gt;msets = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;msets, other2-&gt;msets);
08516           res-&gt;uses = <a class="code" href="sRefSet_c.html#a12">sRefSet_union</a> (res-&gt;uses, other2-&gt;uses);
08517         }
08518     }
08519 }
08520 
08521 <font class="comment">/*</font>
08522 <font class="comment">** modifies e-&gt;uses</font>
08523 <font class="comment">**</font>
08524 <font class="comment">** Reports errors is s is not defined.</font>
08525 <font class="comment">*/</font>
08526 
08527 <font class="keyword">static</font> <font class="keywordtype">void</font>
08528 exprNode_addUse (exprNode e, sRef s)<font class="keyword"></font>
08529 <font class="keyword"></font>{
08530   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08531     {
08532       e-&gt;uses = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (e-&gt;uses, s);
08533     }
08534 }
08535   
08536 <font class="keywordtype">void</font>
08537 exprNode_checkUse (exprNode e, sRef s, fileloc loc)<font class="keyword"></font>
08538 <font class="keyword"></font>{
08539   <font class="keywordflow">if</font> (sRef_isKnown (s) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (s))
08540     {
08541       <font class="comment">/*</font>
08542 <font class="comment">      ** need to check all outer types are useable</font>
08543 <font class="comment">      */</font>
08544 
08545       DPRINTF ((<font class="stringliteral">"Check use: %s / %s"</font>,
08546                 exprNode_unparse (e), <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s)));
08547 
08548       exprNode_addUse (e, s);
08549      
08550       <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
08551         {
08552           <font class="comment">/*</font>
08553 <font class="comment">          ** only report the deepest error</font>
08554 <font class="comment">          */</font>
08555           
08556           sRef errorRef = sRef_undefined;
08557           sRef lastRef  = sRef_undefined;
08558           <font class="keywordtype">bool</font> deadRef = FALSE;
08559           <font class="keywordtype">bool</font> unuseable = FALSE;
08560           <font class="keywordtype">bool</font> errorMaybe = FALSE;
08561           
08562           <font class="keywordflow">while</font> (sRef_isValid (s) &amp;&amp; sRef_isKnown (s))
08563             {
08564               ynm readable = <a class="code" href="sRef_c.html#a176">sRef_isReadable</a> (s);
08565 
08566               <font class="keywordflow">if</font> (!(ynm_toBoolStrict (readable)))
08567                 {
08568                   <font class="keywordflow">if</font> (ynm_isMaybe (readable))
08569                     {
08570                       lastRef = errorRef;
08571                       errorRef = s;
08572                       deadRef = <a class="code" href="sRef_c.html#a310">sRef_isPossiblyDead</a> (errorRef);
08573                       unuseable = <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (errorRef);
08574                       errorMaybe = TRUE;
08575                     }
08576                   <font class="keywordflow">else</font>
08577                     {
08578                       lastRef = errorRef;
08579                       errorRef = s;
08580                       deadRef = <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (errorRef);
08581                       unuseable = <a class="code" href="sRef_c.html#a314">sRef_isUnuseable</a> (errorRef);
08582                       errorMaybe = FALSE;
08583                     }
08584 
08585                   <font class="keywordflow">if</font> (!sRef_isPartial (s))
08586                     {
08587                       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (s, fileloc_undefined);
08588                     }
08589                 }
08590 
08591               s = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);
08592             } <font class="comment">/* end while */</font>
08593           
08594           <font class="keywordflow">if</font> (sRef_isValid (errorRef)) 
08595             {
08596               <font class="keywordflow">if</font> (sRef_isValid (lastRef) &amp;&amp; <a class="code" href="sRef_c.html#a243">sRef_isField</a> (lastRef) 
08597                   &amp;&amp; <a class="code" href="sRef_c.html#a248">sRef_isPointer</a> (errorRef))
08598                 {
08599                   errorRef = lastRef;
08600                 }
08601               
08602               <font class="keywordflow">if</font> (deadRef)
08603                 {
08604                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a236">sRef_isThroughArrayFetch</a> (errorRef))
08605                     {
08606                       <font class="keywordflow">if</font> (optgenerror 
08607                           (FLG_STRICTUSERELEASED,
08608                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q may be used after being released"</font>, 
08609                                     sRef_unparseKindNamePlain (errorRef),
08610                                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (errorRef)),
08611                            loc))
08612                         {
08613                           <a class="code" href="sRef_c.html#a297">sRef_showRefKilled</a> (errorRef);
08614                           
08615                           <font class="keywordflow">if</font> (sRef_isKept (errorRef))
08616                             {
08617                               <a class="code" href="sRef_c.html#a184">sRef_clearAliasState</a> (errorRef, loc);
08618                             }
08619                         }
08620                     }
08621                   <font class="keywordflow">else</font>
08622                     {
08623                       DPRINTF ((<font class="stringliteral">"HERE: %s"</font>, sRef_unparse (errorRef)));
08624 
08625                       <font class="keywordflow">if</font> (optgenerror
08626                           (FLG_USERELEASED,
08627                            <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q %qused after being released"</font>, 
08628                                     sRef_unparseKindNamePlain (errorRef),
08629                                     <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (errorRef),
08630                                     cstring_makeLiteral (errorMaybe 
08631                                                          ? <font class="stringliteral">"may be "</font> : <font class="stringliteral">""</font>)),
08632                            loc))
08633                         {
08634                           <a class="code" href="sRef_c.html#a297">sRef_showRefKilled</a> (errorRef);
08635                           
08636                           <font class="keywordflow">if</font> (sRef_isKept (errorRef))
08637                             {
08638                               <a class="code" href="sRef_c.html#a184">sRef_clearAliasState</a> (errorRef, loc);
08639                             }
08640                         }
08641                     }
08642                 }
08643               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (unuseable)
08644                 {
08645                   <font class="keywordflow">if</font> (optgenerror
08646                       (FLG_USEDEF,
08647                        <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q%qused in inconsistent state"</font>, 
08648                                 sRef_unparseKindName (errorRef),
08649                                 <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (errorRef),
08650                                 cstring_makeLiteral (errorMaybe ? <font class="stringliteral">"may be "</font> : <font class="stringliteral">""</font>)),
08651                        loc))
08652                     {
08653                       <a class="code" href="sRef_c.html#a298">sRef_showStateInconsistent</a> (errorRef);
08654                     }
08655                 }
08656               <font class="keywordflow">else</font>
08657                 {
08658                   DPRINTF ((<font class="stringliteral">"HERE: %s"</font>, sRef_unparse (errorRef)));
08659 
08660                   voptgenerror 
08661                     (FLG_USEDEF,
08662                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"%q %q%qused before definition"</font>, 
08663                               sRef_unparseKindName (errorRef),
08664                               <a class="code" href="sRef_c.html#a121">sRef_unparseOpt</a> (errorRef),
08665                               cstring_makeLiteral (errorMaybe ? <font class="stringliteral">"may be "</font> : <font class="stringliteral">""</font>)),
08666                      loc);
08667                 }
08668               
08669               <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (errorRef, loc);
08670           
08671               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (errorRef))
08672                 {
08673                   <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (sRef_getRootBase (errorRef), loc);
08674                 }
08675             } <font class="comment">/* end is error */</font>
08676         }
08677     }
08678 
08679   setCodePoint ();
08680 }
08681 
08682 <font class="keyword">static</font> <font class="keywordtype">void</font>
08683 checkSafeUse (exprNode e, sRef s)<font class="keyword"></font>
08684 <font class="keyword"></font>{
08685   <font class="keywordflow">if</font> (exprNode_isDefined (e) &amp;&amp; sRef_isKnown (s))
08686     {
08687       e-&gt;uses = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (e-&gt;uses, s);
08688     }
08689 }
08690 
08691 <font class="keyword">static</font> <font class="keywordtype">void</font>
08692 exprNode_checkSetAny (exprNode e, <font class="comment">/*@dependent@*/</font> cstring name)<font class="keyword"></font>
08693 <font class="keyword"></font>{
08694   <font class="keywordflow">if</font> (exprNode_isDefined (e))
08695     {
08696       e-&gt;sets = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (e-&gt;sets, sRef_makeUnconstrained (name));
08697     }
08698 }
08699 
08700 <font class="keywordtype">void</font>
<a name="l08701"></a><a class="code" href="exprNode_c.html#a167">08701</a> <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (exprNode e, sRef s)<font class="keyword"></font>
08702 <font class="keyword"></font>{
08703   sRef defines = sRef_undefined;
08704 
08705   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (s))
08706     {
08707       uentry ue = <a class="code" href="sRef_c.html#a93">sRef_getBaseUentry</a> (s);
08708 
08709       <font class="keywordflow">if</font> (uentry_isValid (ue))
08710         {
08711           uentry_setLset (ue);
08712         }
08713 
08714       <font class="keywordflow">if</font> (!ynm_toBoolStrict (sRef_isWriteable (s)))
08715         {
08716           voptgenerror (FLG_USEDEF,
08717                         message (<font class="stringliteral">"Attempt to set unuseable storage: %q"</font>, 
08718                                  sRef_unparse (s)),
08719                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
08720         }
08721      
08722       <font class="keywordflow">if</font> (sRef_isMeaningful (s))
08723         {
08724           
08725           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a308">sRef_isDead</a> (s))
08726             {
08727               sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (s);
08728 
08729               <font class="keywordflow">if</font> (sRef_isValid (base) 
08730                   &amp;&amp; <a class="code" href="sRef_c.html#a308">sRef_isDead</a> (base))
08731                 {
08732                   <a class="code" href="sRef_c.html#a209">sRef_setPartial</a> (s, exprNode_loc (e));
08733                 }
08734               
08735               defines = s; <font class="comment">/* okay - modifies for only param */</font>
08736             }
08737           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (sRef_isPartial (s))
08738             {
08739               sRef eref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (e);
08740 
08741               <font class="keywordflow">if</font> (!sRef_isPartial (eref))
08742                 {
08743                   <font class="comment">/*</font>
08744 <font class="comment">                  ** should do something different here???</font>
08745 <font class="comment">                  */</font>
08746                   
08747                   <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (eref, exprNode_loc (e));               
08748                 }
08749               <font class="keywordflow">else</font>
08750                 {
08751                   <a class="code" href="sRef_c.html#a199">sRef_setPartialDefinedComplete</a> (eref, exprNode_loc (e));
08752                 }
08753 
08754               <font class="keywordflow">if</font> (sRef_isMeaningful (eref))
08755                 {
08756                   defines = eref;
08757                 }
08758               <font class="keywordflow">else</font>
08759                 {                
08760                   defines = s;
08761                 }
08762             }
08763           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (s))
08764             {
08765               sRef eref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (e);
08766 
08767               
08768               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a348">sRef_isAllocated</a> (eref))
08769                 {
08770                   <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (eref, exprNode_loc (e));
08771                 }
08772               <font class="keywordflow">else</font>
08773                 {
08774                   sRef base = <a class="code" href="sRef_c.html#a140">sRef_getBaseSafe</a> (eref);
08775                   
08776                   <font class="keywordflow">if</font> (sRef_isValid (base))
08777                     {
08778                       <a class="code" href="sRef_c.html#a204">sRef_setPdefined</a> (base, exprNode_loc (e)); 
08779                     }
08780                 }
08781 
08782               defines = s;
08783             }
08784           <font class="keywordflow">else</font> 
08785             {
08786               <a class="code" href="sRef_c.html#a202">sRef_setDefinedNCComplete</a> (s, exprNode_loc (e));
08787               defines = s;
08788             }
08789 
08790         }
08791       <font class="keywordflow">else</font> <font class="comment">/* not meaningful...but still need to insert it */</font>
08792         {
08793           defines = s;
08794         }
08795     }
08796 
08797   <font class="keywordflow">if</font> (exprNode_isDefined (e) &amp;&amp; sRef_isValid (defines))
08798     {
08799       e-&gt;sets = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (e-&gt;sets, defines); 
08800     }
08801 }
08802 
08803 <font class="keywordtype">void</font>
<a name="l08804"></a><a class="code" href="exprNode_c.html#a168">08804</a> <a class="code" href="exprNode_c.html#a168">exprNode_checkMSet</a> (exprNode e, sRef s)<font class="keyword"></font>
08805 <font class="keyword"></font>{
08806   <font class="keywordflow">if</font> (sRef_isValid (s) &amp;&amp; !<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (s))
08807     {
08808       uentry ue = <a class="code" href="sRef_c.html#a93">sRef_getBaseUentry</a> (s);
08809 
08810       <font class="keywordflow">if</font> (uentry_isValid (ue))
08811         {
08812           uentry_setLset (ue);
08813         }
08814 
08815       <font class="keywordflow">if</font> (!ynm_toBoolStrict (sRef_isWriteable (s)))
08816         {
08817           voptgenerror (FLG_USEDEF,
08818                         message (<font class="stringliteral">"Attempt to set unuseable storage: %q"</font>, sRef_unparse (s)),
08819                         <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (e));
08820         }
08821       
08822       <font class="keywordflow">if</font> (sRef_isMeaningful (s))
08823         {
08824           <a class="code" href="sRef_c.html#a200">sRef_setDefinedComplete</a> (s, exprNode_loc (e));
08825         }
08826       
08827       <font class="keywordflow">if</font> (exprNode_isDefined (e))
08828         {
08829           e-&gt;msets = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (e-&gt;msets, s);
08830         }
08831     }
08832 }
08833 
08834 <font class="keyword">static</font> <font class="keywordtype">void</font>
08835 checkUnspecCall (<font class="comment">/*@notnull@*/</font> <font class="comment">/*@dependent@*/</font> exprNode fcn, uentryList params, exprNodeList args)<font class="keyword"></font>
08836 <font class="keyword"></font>{
08837   checkAnyCall (fcn, cstring_undefined, params, args, 
08838                 FALSE, sRefSet_undefined, FALSE, 0);
08839 }
08840 
08841 <font class="keyword">static</font> <font class="keywordtype">void</font>
08842 checkOneArg (uentry ucurrent, <font class="comment">/*@notnull@*/</font> exprNode current, 
08843              <font class="comment">/*@dependent@*/</font> exprNode fcn, <font class="keywordtype">bool</font> isSpec, <font class="keywordtype">int</font> argno, <font class="keywordtype">int</font> totargs)<font class="keyword"></font>
08844 <font class="keyword"></font>{
08845   setCodePoint ();
08846   
08847   <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a98">uentry_isYield</a> (ucurrent))
08848     {
08849       <a class="code" href="sRef_c.html#a201">sRef_setDefined</a> (exprNode_getSref (current), <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (current));
08850       <a class="code" href="exprNode_c.html#a167">exprNode_checkSet</a> (current, current-&gt;sref);
08851     }
08852   <font class="keywordflow">else</font> 
08853     {
08854       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (ucurrent))
08855         {
08856           sRefSet sets = current-&gt;sets;
08857           sRef ref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (current);
08858 
08859           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (ref))
08860             {
08861               uentry ue = <a class="code" href="sRef_c.html#a95">sRef_getUentry</a> (ref);
08862 
08863               <font class="keywordflow">if</font> (!<a class="code" href="uentry_c.html#a172">uentry_isSefParam</a> (ue))
08864                 {
08865                   voptgenerror 
08866                     (FLG_SEFPARAMS,
08867                      message
08868                      (<font class="stringliteral">"Parameter %d to %s is declared sef, but "</font>
08869                       <font class="stringliteral">"the argument is a macro parameter declared "</font>
08870                       <font class="stringliteral">"without sef: %s"</font>,
08871                       argno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
08872                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current)),
08873                      <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (current));
08874                 }
08875             }
08876 
08877           <font class="keywordflow">if</font> (!sRefSet_isEmpty (sets))
08878             {
08879               sRefSet reported = sRefSet_undefined;
08880               
08881               sRefSet_realElements (current-&gt;sets, el)<font class="keyword"></font>
08882 <font class="keyword">                </font>{
08883                   <font class="keywordflow">if</font> (<a class="code" href="sRefSet_c.html#a26">sRefSet_isSameNameMember</a> (reported, el))
08884                     {
08885                       ; <font class="comment">/* don't report again */</font>
08886                     }
08887                   <font class="keywordflow">else</font>
08888                     {
08889                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a127">sRef_isUnconstrained</a> (el))
08890                         {
08891                           voptgenerror 
08892                             (FLG_SEFUNSPEC,
08893                              message
08894                              (<font class="stringliteral">"Parameter %d to %s is declared sef, but "</font>
08895                               <font class="stringliteral">"the argument calls unconstrained function %s "</font>
08896                               <font class="stringliteral">"(no guarantee it will not modify something): %s"</font>,
08897                               argno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
08898                               <a class="code" href="sRef_c.html#a126">sRef_unconstrainedName</a> (el),
08899                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current)),
08900                              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (current));
08901                         }
08902                       <font class="keywordflow">else</font>
08903                         {
08904                           voptgenerror 
08905                             (FLG_SEFPARAMS,
08906                              message
08907                              (<font class="stringliteral">"Parameter %d to %s is declared sef, but "</font>
08908                               <font class="stringliteral">"the argument may modify %q: %s"</font>,
08909                               argno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
08910                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (el),
08911                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current)),
08912                              <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (current));
08913                         }
08914                     } 
08915                 } end_sRefSet_realElements;
08916             }
08917         }
08918       
08919       <a class="code" href="aliasChecks_c.html#a29">checkPassTransfer</a> (current, ucurrent, isSpec, fcn, argno, totargs);
08920       exprNode_mergeUSs (fcn, current);
08921     }
08922 }
08923 
08924 <font class="keyword">static</font> <font class="keywordtype">void</font>
08925   checkAnyCall (<font class="comment">/*@dependent@*/</font> exprNode fcn, 
08926                 <font class="comment">/*@dependent@*/</font> cstring fname,
08927                 uentryList pn, 
08928                 exprNodeList args, 
08929                 <font class="keywordtype">bool</font> hasMods, sRefSet mods,
08930                 <font class="keywordtype">bool</font> isSpec,
08931                 <font class="keywordtype">int</font> specialArgs)<font class="keyword"></font>
08932 <font class="keyword"></font>{
08933   <font class="keywordtype">int</font> paramno = 0;
08934   <font class="keywordtype">int</font> nargs = exprNodeList_size (args);
08935 
08936   setCodePoint ();
08937 
08938   <font class="comment">/*</font>
08939 <font class="comment">  ** concat all args ud's to f, add each arg sref as a use unless</font>
08940 <font class="comment">  ** it was specified as "out", in which case it is a def.</font>
08941 <font class="comment">  */</font>
08942   
08943   <a class="code" href="uentryList_c.html#a26">uentryList_reset</a> (pn);
08944   
08945   <font class="comment">/*</font>
08946 <font class="comment">  ** aliasing checks:</font>
08947 <font class="comment">  **</font>
08948 <font class="comment">  **    if paramn is only or unique, no other arg may alias argn</font>
08949 <font class="comment">  */</font>
08950   
08951   exprNodeList_elements (args, current)<font class="keyword"> </font>
08952 <font class="keyword">    </font>{
08953       paramno++;
08954       
08955       <font class="keywordflow">if</font> (exprNode_isDefined (current)) 
08956         {
08957           <font class="keywordflow">if</font> ((!uentryList_isUndefined (pn) &amp;&amp; !<a class="code" href="uentryList_c.html#a27">uentryList_isFinished</a> (pn))) 
08958             {
08959               uentry ucurrent = <a class="code" href="uentryList_c.html#a21">uentryList_current</a> (pn);
08960               
08961               <font class="keywordflow">if</font> (specialArgs == 0 
08962                   || (paramno &lt; specialArgs))
08963                 {
08964                                   checkOneArg (ucurrent, current, fcn, isSpec, paramno, nargs);
08965 
08966                   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_ALIASUNIQUE))
08967                     {
08968                       <font class="keywordflow">if</font> (<a class="code" href="uentry_c.html#a67">uentry_isOnly</a> (ucurrent)
08969                           || <a class="code" href="uentry_c.html#a68">uentry_isUnique</a> (ucurrent))
08970                         {
08971                           checkUniqueParams (fcn, current, args,
08972                                              paramno, ucurrent);
08973                         }
08974                     }
08975                 } 
08976             }
08977           <font class="keywordflow">else</font> <font class="comment">/* uentry is undefined */</font>
08978             {
08979               <font class="keywordflow">if</font> (specialArgs == 0)
08980                 {
08981                   <a class="code" href="exprNode_c.html#a169">exprNode_checkUseParam</a> (current);
08982                 }
08983 
08984               exprNode_mergeUSs (fcn, current);
08985             }   
08986         }
08987       <a class="code" href="uentryList_c.html#a28">uentryList_advanceSafe</a> (pn);
08988     } end_exprNodeList_elements;
08989   
08990   <font class="keywordflow">if</font> (hasMods)
08991     {
08992       setCodePoint ();
08993 
08994       sRefSet_allElements (mods, s)<font class="keyword"></font>
08995 <font class="keyword">        </font>{
08996           sRef fb;
08997           sRef rb = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s);
08998           
08999           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (rb))
09000             {
09001               <a class="code" href="context_c.html#a109">context_usedGlobal</a> (rb);
09002             }
09003           
09004           fb = <a class="code" href="sRef_c.html#a114">sRef_fixBaseParam</a> (s, args);
09005           
09006           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a238">sRef_isMacroParamRef</a> (fb))
09007             {
09008               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a160">sRef_isNothing</a> (fb))
09009                 {
09010                   ;
09011                 }
09012               <font class="keywordflow">else</font>
09013                 {
09014                   <font class="keywordflow">if</font> (sRef_isValid (fb))
09015                     {
09016                       uentry ue = <a class="code" href="sRef_c.html#a93">sRef_getBaseUentry</a> (s);
09017                       
09018                       <font class="keywordflow">if</font> (uentry_isValid (ue))
09019                         {
09020                           uentry_setLset (ue);
09021                         }
09022                     }
09023                   
09024                   fcn-&gt;sets = <a class="code" href="sRefSet_c.html#a4">sRefSet_insert</a> (fcn-&gt;sets, fb);
09025                 }
09026             }
09027           <a class="code" href="sRef_c.html#a274">sRef_clearDerivedComplete</a> (s); 
09028         } end_sRefSet_allElements;
09029       
09030       setCodePoint ();
09031     }
09032   <font class="keywordflow">else</font>
09033     {
09034       <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a118">context_hasMods</a> ())
09035         {
09036           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MODUNCON))
09037             {
09038               voptgenerror
09039                 (FLG_MODUNCON,
09040                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undetected modification possible "</font>
09041                           <font class="stringliteral">"from call to unconstrained function %s: %s"</font>, 
09042                           fname,
09043                           exprNode_unparse (fcn)),
09044                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fcn));
09045             }
09046         }
09047       <font class="keywordflow">else</font>
09048         {
09049           <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a188">context_maybeSet</a> (FLG_MODUNCONNOMODS)
09050               &amp;&amp; !(<a class="code" href="context_c.html#a236">context_inIterDef</a> () || <a class="code" href="context_c.html#a237">context_inIterEnd</a> ()))
09051             {
09052               voptgenerror
09053                 (FLG_MODUNCONNOMODS,
09054                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Undetected modification possible "</font>
09055                           <font class="stringliteral">"from call to unconstrained function %s: %s"</font>, 
09056                           fname,
09057                           exprNode_unparse (fcn)),
09058                  <a class="code" href="exprNode_c.html#a161">exprNode_loc</a> (fcn));
09059             }
09060         }
09061 
09062       exprNode_checkSetAny (fcn, fname);
09063     }
09064 }
09065 
<a name="l09066"></a><a class="code" href="exprNode_c.html#a169">09066</a> <font class="keywordtype">void</font> <a class="code" href="exprNode_c.html#a169">exprNode_checkUseParam</a> (exprNode current)<font class="keyword"></font>
09067 <font class="keyword"></font>{
09068   <font class="keywordflow">if</font> (exprNode_isDefined (current))
09069     {
09070       exprNode_checkUse (current, current-&gt;sref, current-&gt;loc);
09071     }
09072 }
09073 
09074 <font class="keyword">static</font> ctype
09075   checkNumerics (ctype tr1, ctype tr2, ctype te1, ctype te2,
09076                  <font class="comment">/*@notnull@*/</font> exprNode e1, <font class="comment">/*@notnull@*/</font> exprNode e2,
09077                  lltok op)<font class="keyword"></font>
09078 <font class="keyword"></font>{
09079   ctype ret = tr1;
09080   
09081   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a96">ctype_match</a> (tr1, tr2))
09082     {
09083       <font class="keywordflow">if</font> ((<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (tr1) || <a class="code" href="ctype_c.html#a64">ctype_isReal</a> (tr1)) &amp;&amp;
09084           (<a class="code" href="ctype_c.html#a70">ctype_isRealInt</a> (tr2) || <a class="code" href="ctype_c.html#a64">ctype_isReal</a> (tr2)))
09085         {
09086           ;
09087         }
09088       <font class="keywordflow">else</font>
09089         {
09090           (<font class="keywordtype">void</font>) gentypeerror 
09091             (tr1, e1, tr2, e2,
09092              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Incompatible types for %s (%s, %s): %s %s %s"</font>,
09093                       lltok_unparse (op),
09094                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (te1),
09095                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (te2),
09096                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), 
09097                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09098              e1-&gt;loc);
09099         }
09100       ret = ctype_unknown;
09101     }
09102   <font class="keywordflow">else</font>
09103     {
09104       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr1) &amp;&amp; <a class="code" href="ctype_c.html#a80">ctype_isForceRealNumeric</a> (&amp;tr2))
09105         {
09106           ret = <a class="code" href="ctype_c.html#a121">ctype_resolveNumerics</a> (tr1, tr2);
09107         }
09108       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a198">context_msgStrictOps</a> ()) 
09109         {
09110                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (tr1))
09111             {
09112               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (tr2) &amp;&amp; !<a class="code" href="exprNode_c.html#a70">exprNode_isNullValue</a> (e2))
09113                 {
09114                   ret = ctype_int;
09115                 }
09116               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr2))
09117                 {
09118                   ret = te1;
09119                 }
09120               <font class="keywordflow">else</font>
09121                 {
09122                   ret = ctype_unknown;
09123                 }
09124             }
09125           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (tr2))
09126             {
09127               <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a100">ctype_isPointer</a> (tr1))
09128                 {
09129                   ret = ctype_int;
09130                 }
09131               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a55">ctype_isInt</a> (tr1))
09132                 {
09133                   ret = te2;
09134                 }
09135               <font class="keywordflow">else</font>
09136                 {
09137                   ret = ctype_unknown; 
09138                 }
09139             }
09140           <font class="keywordflow">else</font>
09141             {
09142               ret = <a class="code" href="ctype_c.html#a121">ctype_resolveNumerics</a> (tr1, tr2);
09143             }
09144         }
09145       <font class="keywordflow">else</font>
09146         {
09147           <font class="keywordtype">int</font> opid = lltok_getTok (op);
09148           <font class="keywordtype">bool</font> comparop = (opid == EQ_OP || opid == NE_OP 
09149                            || opid == TLT || opid == TGT
09150                            || opid == LE_OP || opid == GE_OP);
09151           
09152           <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a68">ctype_isNumeric</a> (tr1) &amp;&amp; !<a class="code" href="ctype_c.html#a68">ctype_isNumeric</a> (tr2))
09153             {
09154               <font class="keywordflow">if</font> (comparop
09155                   &amp;&amp; ((<a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a117">ctype_isEnum</a> (tr2))
09156                       || (<a class="code" href="ctype_c.html#a62">ctype_isBool</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a62">ctype_isBool</a> (tr2))
09157                       || (<a class="code" href="ctype_c.html#a58">ctype_isChar</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a58">ctype_isChar</a> (tr2))))
09158                 {
09159                   ; <font class="comment">/* no error */</font>
09160                 }
09161               <font class="keywordflow">else</font>
09162                 {
09163                   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a93">ctype_sameName</a> (te1, te2))
09164                     {
09165                       voptgenerror
09166                         (FLG_STRICTOPS,
09167                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are non-numeric (%t): %s %s %s"</font>,
09168                                   lltok_unparse (op), te1, 
09169                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), 
09170                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09171                          e1-&gt;loc);
09172                     }
09173                   <font class="keywordflow">else</font>
09174                     {
09175                       voptgenerror
09176                         (FLG_STRICTOPS,
09177                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are non-numerics (%t, %t): %s %s %s"</font>,
09178                                   lltok_unparse (op), te1, te2, 
09179                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op),
09180                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09181                          e1-&gt;loc);
09182                     }
09183                 }
09184             }
09185           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a68">ctype_isNumeric</a> (tr1))
09186             {
09187               voptgenerror
09188                 (FLG_STRICTOPS,
09189                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Right operand of %s is non-numeric (%t): %s %s %s"</font>,
09190                           lltok_unparse (op), te1, 
09191                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), 
09192                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09193                  e1-&gt;loc);
09194             }
09195           <font class="keywordflow">else</font> 
09196             {
09197               <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a68">ctype_isNumeric</a> (tr2))
09198                 {
09199                   voptgenerror
09200                     (FLG_STRICTOPS,
09201                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Left operand of %s is non-numeric (%t): %s %s %s"</font>,
09202                               lltok_unparse (op), te2, 
09203                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), 
09204                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09205                      e2-&gt;loc);
09206                 }
09207             }
09208           
09209           ret = ctype_unknown;
09210         }
09211     }
09212 
09213   <font class="keywordflow">return</font> ret;
09214 }
09215 
09216 <font class="keyword">static</font> <font class="keywordtype">void</font>
09217 abstractOpError (ctype tr1, ctype tr2, lltok op, 
09218                  <font class="comment">/*@notnull@*/</font> exprNode e1, <font class="comment">/*@notnull@*/</font> exprNode e2, 
09219                  fileloc loc1, fileloc loc2)<font class="keyword"></font>
09220 <font class="keyword"></font>{
09221   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr1) &amp;&amp; <a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr2))
09222     {
09223       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a96">ctype_match</a> (tr1, tr2))
09224         {
09225           voptgenerror
09226             (FLG_ABSTRACT,
09227              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are abstract type (%t): %s %s %s"</font>,
09228                       lltok_unparse (op), tr1, 
09229                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09230              loc1);
09231         }
09232       <font class="keywordflow">else</font>
09233         {
09234           voptgenerror 
09235             (FLG_ABSTRACT,
09236              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Operands of %s are abstract types (%t, %t): %s %s %s"</font>,
09237                       lltok_unparse (op), tr1, tr2, 
09238                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09239              loc1);
09240         }
09241     }
09242   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr1))
09243     {
09244       voptgenerror
09245         (FLG_ABSTRACT,
09246          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Left operand of %s is abstract type (%t): %s %s %s"</font>,
09247                   lltok_unparse (op), tr1, 
09248                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09249          loc1);
09250     }
09251   <font class="keywordflow">else</font> 
09252     {
09253       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a34">ctype_isRealAbstract</a> (tr2))
09254         {
09255           voptgenerror
09256             (FLG_ABSTRACT,
09257              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Right operand of %s is abstract type (%t): %s %s %s"</font>,
09258                       lltok_unparse (op), tr2, 
09259                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="lltok_c.html#a1">lltok_unparse</a> (op), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09260              loc2);
09261         }
09262     }
09263 }
09264 
09265 <font class="comment">/*</font>
09266 <font class="comment">** e1 &lt;= e2</font>
09267 <font class="comment">**</font>
09268 <font class="comment">** requies e1 and e2 and not error exprNode's.</font>
09269 <font class="comment">**</font>
09270 <font class="comment">** Checks:</font>
09271 <font class="comment">**</font>
09272 <font class="comment">**    If e1 is a component of an abstract type, and e2 is mutable and client-visible, </font>
09273 <font class="comment">**    the rep of the abstract type is exposed.</font>
09274 <font class="comment">**</font>
09275 <font class="comment">** The order is very important:</font>
09276 <font class="comment">**</font>
09277 <font class="comment">**    check rep expose (move into check transfer)</font>
09278 <font class="comment">**    check transfer</font>
09279 <font class="comment">**    setup aliases</font>
09280 <font class="comment">*/</font>
09281 
09282 <font class="comment">/*</font>
09283 <font class="comment">** This isn't really a sensible procedure, but the indententation</font>
09284 <font class="comment">** was getting too deep.</font>
09285 <font class="comment">*/</font>
09286 
09287 <font class="keyword">static</font> <font class="keywordtype">void</font>
09288 checkOneRepExpose (sRef ysr, sRef base, 
09289                    <font class="comment">/*@notnull@*/</font> exprNode e1, 
09290                    <font class="comment">/*@notnull@*/</font> exprNode e2, ctype ct,
09291                    sRef s2b)<font class="keyword"></font>
09292 <font class="keyword"></font>{
09293   <font class="keywordflow">if</font> (!(<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (ysr) || <a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (ysr) 
09294         || <a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (ysr) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (ysr)))
09295     {
09296       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (base) &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (base))
09297         {
09298           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a250">sRef_isIReference</a> (ysr))
09299             {
09300               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, sRef_getRootBase (e2-&gt;sref)))
09301                 {
09302                   voptgenerror 
09303                     (FLG_ASSIGNEXPOSE,
09304                      message
09305                      (<font class="stringliteral">"Assignment of mutable component of parameter %q "</font>
09306                       <font class="stringliteral">"to component of abstract "</font>
09307                       <font class="stringliteral">"type %s exposes rep: %s = %s"</font>,
09308                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base),
09309                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09310                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09311                      e1-&gt;loc);
09312                 }
09313               <font class="keywordflow">else</font>
09314                 {
09315                   voptgenerror 
09316                     (FLG_ASSIGNEXPOSE,
09317                      message
09318                      (<font class="stringliteral">"Assignment of mutable component of parameter %q "</font>
09319                       <font class="stringliteral">"(through alias %q) to component of abstract "</font>
09320                       <font class="stringliteral">"type %s exposes rep: %s = %s"</font>,
09321                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (base),
09322                       <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (e2-&gt;sref),
09323                       <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09324                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09325                      e1-&gt;loc);
09326                 }
09327             }
09328           <font class="keywordflow">else</font>
09329             {
09330               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, sRef_getRootBase (e2-&gt;sref)))
09331                 {
09332                   voptgenerror 
09333                     (FLG_ASSIGNEXPOSE,
09334                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of mutable parameter %q "</font>
09335                               <font class="stringliteral">"to component of abstract type %s "</font>
09336                               <font class="stringliteral">"exposes rep: %s = %s"</font>,
09337                               sRef_unparse (base),
09338                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09339                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), 
09340                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09341                      e1-&gt;loc);
09342                 }
09343               <font class="keywordflow">else</font>
09344                 {
09345                   voptgenerror 
09346                     (FLG_ASSIGNEXPOSE,
09347                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of mutable parameter %q "</font>
09348                               <font class="stringliteral">"(through alias %q) to "</font>
09349                               <font class="stringliteral">"component of abstract type %s exposes "</font>
09350                               <font class="stringliteral">"rep: %s = %s"</font>,
09351                               sRef_unparse (base),
09352                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (e2-&gt;sref),
09353                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09354                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), 
09355                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09356                      e1-&gt;loc);
09357                 }
09358             }
09359         }
09360       
09361       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s2b))
09362         {
09363           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, sRef_getRootBase (e2-&gt;sref)))
09364             {
09365               voptgenerror 
09366                 (FLG_REPEXPOSE,
09367                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of global %q "</font>
09368                           <font class="stringliteral">"to component of "</font>
09369                           <font class="stringliteral">"abstract type %s exposes rep: %s = %s"</font>,
09370                           sRef_unparse (base),
09371                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09372                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09373                  e1-&gt;loc);
09374             }
09375           <font class="keywordflow">else</font>
09376             {
09377               voptgenerror 
09378                 (FLG_REPEXPOSE,
09379                  <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of global %q (through alias %q) "</font>
09380                           <font class="stringliteral">"to component of "</font>
09381                           <font class="stringliteral">"abstract type %s exposes rep: %s = %s"</font>,
09382                           sRef_unparse (base),
09383                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (e2-&gt;sref),
09384                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09385                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09386                  e1-&gt;loc);
09387             }
09388         }
09389     }
09390 }
09391 
09392 <font class="keyword">static</font> <font class="keywordtype">void</font>
09393 doAssign (<font class="comment">/*@notnull@*/</font> exprNode e1, <font class="comment">/*@notnull@*/</font> exprNode e2, <font class="keywordtype">bool</font> isInit)<font class="keyword"></font>
09394 <font class="keyword"></font>{
09395   <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a77">ctype_isRealFunction</a> (exprNode_getType (e1))
09396       &amp;&amp; !<a class="code" href="ctype_c.html#a73">ctype_isRealPointer</a> (exprNode_getType (e1)))
09397     {
09398       voptgenerror 
09399         (FLG_TYPE,
09400          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Invalid left-hand side of assignment (function type %s): %s"</font>,
09401                   ctype_unparse (exprNode_getType (e1)),
09402                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1)),
09403          e1-&gt;loc);
09404     }
09405 
09406   <font class="keywordflow">if</font> (<a class="code" href="context_c.html#a189">context_getFlag</a> (FLG_ASSIGNEXPOSE) &amp;&amp; <a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (e2-&gt;typ))
09407     {
09408       ctype t2 = exprNode_getType (e2);
09409       sRef sr = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (e1-&gt;sref);
09410       ctype ct = <a class="code" href="sRef_c.html#a120">sRef_getType</a> (sr);
09411 
09412       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (t2) 
09413           &amp;&amp; !(<a class="code" href="uentry_c.html#a168">uentry_isMutableDatatype</a> (usymtab_getTypeEntry (ctype_typeId (t2)))))
09414         {
09415           <font class="comment">/* it is immutable, okay to reference */</font>
09416           <font class="keywordflow">goto</font> donerepexpose;
09417         }
09418 
09419       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a33">ctype_isAbstract</a> (ct) &amp;&amp; <a class="code" href="sRef_c.html#a250">sRef_isIReference</a> (e1-&gt;sref))
09420         {
09421           sRef s2b = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (e2-&gt;sref);
09422           sRef s1 = e1-&gt;sref;
09423           sRef s1b = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (s1);
09424           sRefSet aliases;
09425 
09426           aliases = <a class="code" href="usymtab_c.html#a155">usymtab_canAlias</a> (e2-&gt;sref);
09427           
09428           <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a109">sRef_similar</a> (s2b, s1b) 
09429               &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s1)
09430               &amp;&amp; !(<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (s2b) || <a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (s2b) || <a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s2b)))
09431             {
09432               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a245">sRef_isAnyParam</a> (s2b) &amp;&amp; !<a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (s2b) 
09433                   &amp;&amp; !<a class="code" href="sRef_c.html#a338">sRef_isOwned</a> (s2b) &amp;&amp; !<a class="code" href="sRef_c.html#a339">sRef_isKeep</a> (s2b)
09434                   &amp;&amp; !<a class="code" href="sRef_c.html#a344">sRef_isExposed</a> (s2b))
09435                 {
09436                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a250">sRef_isIReference</a> (e2-&gt;sref))
09437                     {
09438                       voptgenerror 
09439                         (FLG_ASSIGNEXPOSE,
09440                          message 
09441                          (<font class="stringliteral">"Assignment of mutable component of parameter %q "</font>
09442                           <font class="stringliteral">"to component of abstract type %s exposes rep: %s = %s"</font>,
09443                           <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (s2b),
09444                           <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09445                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09446                          e1-&gt;loc);
09447                     }
09448                   <font class="keywordflow">else</font>
09449                     {
09450                       voptgenerror 
09451                         (FLG_ASSIGNEXPOSE,
09452                          <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of mutable parameter %q to "</font>
09453                                   <font class="stringliteral">"component of abstract type %s exposes rep: %s = %s"</font>,
09454                                   sRef_unparse (s2b),
09455                                   <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09456                                   <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09457                          e1-&gt;loc);
09458                     }
09459                 }
09460 
09461               <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (s2b))
09462                 {
09463                   voptgenerror
09464                     (FLG_ASSIGNEXPOSE,
09465                      <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Assignment of global %q to component of "</font>
09466                               <font class="stringliteral">"abstract type %s exposes rep: %s = %s"</font>,
09467                               sRef_unparse (s2b),
09468                               <a class="code" href="ctype_c.html#a107">ctype_unparse</a> (ct),
09469                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e1), <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (e2)),
09470                      e1-&gt;loc);
09471                 }
09472               
09473               sRefSet_realElements (aliases, ysr)<font class="keyword"></font>
09474 <font class="keyword">                </font>{
09475                   sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (ysr);
09476                   
09477                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a109">sRef_similar</a> (ysr, s2b) || <a class="code" href="sRef_c.html#a109">sRef_similar</a> (s1b, base)
09478                       || <a class="code" href="sRef_c.html#a288">sRef_sameName</a> (base, s1b))
09479                     {
09480                      ; <font class="comment">/* error already reported or same sref */</font>
09481                     }
09482                   <font class="keywordflow">else</font>
09483                     {
09484                       checkOneRepExpose (ysr, base, e1, e2, ct, s2b);
09485                     }
09486                 } end_sRefSet_realElements;
09487             }
09488           <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
09489         }
09490     }
09491 
09492  donerepexpose:
09493 
09494   <font class="comment">/*</font>
09495 <font class="comment">  ** function variables don't really work...</font>
09496 <font class="comment">  */</font>
09497 
09498   <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a49">ctype_isFunction</a> (ctype_realType (e2-&gt;typ)))
09499     {
09500       <font class="keywordflow">if</font> (isInit)
09501         {
09502           <a class="code" href="aliasChecks_c.html#a34">checkInitTransfer</a> (e1, e2); 
09503         }
09504       <font class="keywordflow">else</font>
09505         {
09506           <a class="code" href="aliasChecks_c.html#a35">checkAssignTransfer</a> (e1, e2); 
09507         }
09508     }
09509   <font class="keywordflow">else</font>
09510     {
09511       sRef fref = e2-&gt;sref;
09512 
09513       <a class="code" href="sRef_c.html#a182">sRef_setDefState</a> (e1-&gt;sref, sRef_getDefState (fref), e1-&gt;loc);
09514       <a class="code" href="sRef_c.html#a214">sRef_setNullState</a> (e1-&gt;sref, sRef_getNullState (fref), e1-&gt;loc);
09515 
09516             <font class="comment">/* Need to typecheck the annotation on the parameters */</font>
09517       
09518       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a77">ctype_isRealFunction</a> (e1-&gt;typ)) {
09519         uentryList e1p = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (ctype_realType (e1-&gt;typ));
09520         uentryList e2p = <a class="code" href="ctype_c.html#a40">ctype_argsFunction</a> (ctype_realType (e2-&gt;typ));
09521 
09522         <font class="keywordflow">if</font> (!<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (e1p)
09523             &amp;&amp; !<a class="code" href="uentryList_c.html#a30">uentryList_isMissingParams</a> (e2p)
09524             &amp;&amp; <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (e1p) &gt; 0) {
09525           <font class="keywordflow">if</font> (<a class="code" href="uentryList_c.html#a29">uentryList_size</a> (e1p) == <a class="code" href="uentryList_c.html#a29">uentryList_size</a> (e2p)) {
09526             <font class="keywordtype">int</font> n = 0;
09527             
09528             uentryList_elements (e1p, el1)<font class="keyword"> </font>{
09529               uentry el2;
09530 
09531               el2 = <a class="code" href="uentryList_c.html#a15">uentryList_getN</a> (e2p, n);
09532               n++;
09533               <a class="code" href="uentry_c.html#a257">uentry_checkMatchParam</a> (el1, el2, n, e2);
09534             } end_uentryList_elements;
09535           }
09536         }
09537       }
09538     }
09539 
09540   <font class="keywordflow">if</font> (isInit &amp;&amp; <a class="code" href="sRef_c.html#a251">sRef_isGlobal</a> (e1-&gt;sref))
09541     {
09542        ;
09543     }
09544   <font class="keywordflow">else</font>
09545     {
09546       updateAliases (e1, e2); 
09547     }
09548 }
09549 
09550 <font class="keyword">static</font> <font class="keywordtype">void</font> 
09551 checkMacroParen (exprNode e)<font class="keyword"></font>
09552 <font class="keyword"></font>{
09553   <font class="keywordflow">if</font> (exprNode_isError (e) || e-&gt;kind == XPR_CAST)
09554     {
09555      ;
09556     }
09557   <font class="keywordflow">else</font> 
09558     {
09559       <font class="keywordflow">if</font> (sRef_isUnsafe (e-&gt;sref) &amp;&amp; !exprNode_isInParens (e))
09560         {
09561           voptgenerror 
09562             (FLG_MACROPARENS,
09563              <a class="code" href="message_c.html#a18">message</a> (<font class="stringliteral">"Macro parameter used without parentheses: %s"</font>, 
09564                       exprNode_unparse (e)),
09565              e-&gt;loc);
09566         }
09567     }
09568 }
09569 
09570 <font class="keyword">static</font> <font class="keywordtype">void</font>
09571 reflectNullTest (<font class="comment">/*@notnull@*/</font> exprNode e, <font class="keywordtype">bool</font> isnull)<font class="keyword"></font>
09572 <font class="keyword"></font>{
09573   <font class="keywordflow">if</font> (isnull)
09574     {
09575       e-&gt;guards = <a class="code" href="guardSet_c.html#a13">guardSet_addTrueGuard</a> (e-&gt;guards, e-&gt;sref);
09576     }
09577   <font class="keywordflow">else</font>
09578     {
09579       e-&gt;guards = <a class="code" href="guardSet_c.html#a14">guardSet_addFalseGuard</a> (e-&gt;guards, e-&gt;sref);
09580     }
09581 }
09582 
09583 <font class="comment">/*</font>
09584 <font class="comment">** e1 &lt;= e2</font>
09585 <font class="comment">**</font>
09586 <font class="comment">** if e2 is a parameter or global derived location which</font>
09587 <font class="comment">** can be modified (that is, e2 is a mutable abstract type,</font>
09588 <font class="comment">** or a derived pointer), then e1 can alias e2.</font>
09589 <font class="comment">**</font>
09590 <font class="comment">** e1 can alias everything which e2 can alias.</font>
09591 <font class="comment">**</font>
09592 <font class="comment">** Also, if e1 is guarded, remove from guard sets!</font>
09593 <font class="comment">*/</font>
09594 
09595 <font class="keyword">static</font> <font class="keywordtype">void</font> updateAliases (<font class="comment">/*@notnull@*/</font> exprNode e1, <font class="comment">/*@notnull@*/</font> exprNode e2)<font class="keyword"></font>
09596 <font class="keyword"></font>{
09597   <font class="keywordflow">if</font> (!<a class="code" href="context_c.html#a216">context_inProtectVars</a> ())
09598     {
09599       <font class="comment">/*</font>
09600 <font class="comment">      ** depends on types of e1 and e2</font>
09601 <font class="comment">      */</font>
09602       
09603       sRef s1 = e1-&gt;sref;
09604       sRef s2 = e2-&gt;sref;
09605       ctype t1 = exprNode_getType (e1);
09606       
09607       <font class="comment">/* handle pointer sRefs, record fields, arrays, etc... */</font>
09608       
09609       <font class="keywordflow">if</font> (!<a class="code" href="ctype_c.html#a74">ctype_isRealSU</a> (t1))
09610         {
09611           <a class="code" href="sRef_c.html#a196">sRef_copyRealDerivedComplete</a> (s1, s2);
09612         }
09613 
09614       <font class="keywordflow">if</font> (<a class="code" href="ctype_c.html#a129">ctype_isMutable</a> (t1) &amp;&amp; sRef_isKnown (s1))
09615         {
09616           <a class="code" href="usymtab_c.html#a153">usymtab_clearAlias</a> (s1);
09617           <a class="code" href="usymtab_c.html#a151">usymtab_addMustAlias</a> (s1, s2); 
09618         }
09619 
09620       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a304">sRef_possiblyNull</a> (s1) &amp;&amp; <a class="code" href="usymtab_c.html#a145">usymtab_isGuarded</a> (s1))
09621         {
09622           <a class="code" href="usymtab_c.html#a144">usymtab_unguard</a> (s1);
09623         }
09624     }
09625 }
09626 
<a name="l09627"></a><a class="code" href="exprNode_c.html#a171">09627</a> exprNode <a class="code" href="exprNode_c.html#a171">exprNode_updateLocation</a> (<font class="comment">/*@returned@*/</font> exprNode e, <font class="comment">/*@temp@*/</font> fileloc loc)<font class="keyword"></font>
09628 <font class="keyword"></font>{
09629   <font class="keywordflow">if</font> (exprNode_isDefined (e))
09630     {
09631       e-&gt;loc = <a class="code" href="fileloc_c.html#a6">fileloc_update</a> (e-&gt;loc, loc);
09632     }
09633   <font class="keywordflow">else</font>
09634     {
09635       e = exprNode_createLoc (ctype_unknown, fileloc_copy (loc));
09636     }
09637 
09638   <font class="keywordflow">return</font> (e);
09639 }
09640 
09641 <font class="keyword">static</font> <font class="keywordtype">void</font> checkUniqueParams (exprNode fcn,
09642                                <font class="comment">/*@notnull@*/</font> exprNode current, 
09643                                exprNodeList args, 
09644                                <font class="keywordtype">int</font> paramno, uentry ucurrent)<font class="keyword"></font>
09645 <font class="keyword"></font>{
09646   <font class="keywordtype">int</font> iparamno = 0;
09647   sRef thisref = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (current);
09648   
09649   <font class="comment">/*</font>
09650 <font class="comment">  ** Check if any argument could match this argument.</font>
09651 <font class="comment">  */</font>
09652   
09653   exprNodeList_elements (args, icurrent)<font class="keyword"> </font>
09654 <font class="keyword">    </font>{
09655       iparamno++;
09656       
09657       <font class="keywordflow">if</font> (iparamno != paramno)
09658         {
09659           sRef sr = <a class="code" href="exprNode_c.html#a158">exprNode_getSref</a> (icurrent);
09660           
09661           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a108">sRef_similarRelaxed</a> (thisref, sr))
09662             {
09663               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (thisref) &amp;&amp; !<a class="code" href="sRef_c.html#a240">sRef_isConst</a> (sr))
09664                 {
09665                   voptgenerror 
09666                     (FLG_ALIASUNIQUE,
09667                      message
09668                      (<font class="stringliteral">"Parameter %d (%s) to function %s is declared %s but "</font>
09669                       <font class="stringliteral">"is aliased by parameter %d (%s)"</font>,
09670                       paramno, 
09671                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current),
09672                       <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
09673                       <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (uentry_getAliasKind (ucurrent)),
09674                       iparamno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (icurrent)),
09675                      current-&gt;loc);
09676                 }
09677             }
09678           <font class="keywordflow">else</font>
09679             {
09680               sRefSet aliases = <a class="code" href="usymtab_c.html#a155">usymtab_canAlias</a> (sr);
09681 
09682               sRefSet_allElements (aliases, asr)<font class="keyword"></font>
09683 <font class="keyword">                </font>{
09684                   <font class="keywordflow">if</font> (ctype_isUnknown (sRef_getType (thisref)))
09685                     {
09686                       <a class="code" href="sRef_c.html#a256">sRef_setType</a> (thisref, uentry_getType (ucurrent));
09687                     }
09688                   
09689                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a108">sRef_similarRelaxed</a> (thisref, asr)) 
09690                     {
09691                       <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a242">sRef_isExternal</a> (asr))  
09692                         {
09693                           <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a341">sRef_isLocalState</a> (thisref))
09694                             {
09695                               ; <font class="comment">/* okay */</font>
09696                             }
09697                           <font class="keywordflow">else</font>
09698                             {
09699                               sRef base = <a class="code" href="sRef_c.html#a142">sRef_getRootBase</a> (asr);
09700                               
09701                               <font class="keywordflow">if</font> (!<a class="code" href="sRef_c.html#a109">sRef_similar</a> (sRef_getBase (asr), thisref)) 
09702                                 {
09703                                   <font class="keywordflow">if</font> (<a class="code" href="sRef_c.html#a342">sRef_isUnique</a> (base) || <a class="code" href="sRef_c.html#a336">sRef_isOnly</a> (base)
09704                                       || sRef_isKept (base)
09705                                       || (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (asr) &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (base))
09706                                       || (<a class="code" href="sRef_c.html#a235">sRef_isAddress</a> (thisref) 
09707                                           &amp;&amp; <a class="code" href="sRef_c.html#a331">sRef_isLocalVar</a> (sRef_getRootBase (thisref))))
09708                                     {
09709                                       ; <font class="comment">/* okay, no error */</font>
09710                                     }
09711                                   <font class="keywordflow">else</font>
09712                                     {
09713                                       voptgenerror 
09714                                         (FLG_MAYALIASUNIQUE,
09715                                          message
09716                                          (<font class="stringliteral">"Parameter %d (%s) to function %s is declared %s but "</font>
09717                                           <font class="stringliteral">"may be aliased externally by parameter %d (%s)"</font>,
09718                                           paramno, 
09719                                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current),
09720                                           <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
09721                                           <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (uentry_getAliasKind (ucurrent)),
09722                                           iparamno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (icurrent)),
09723                                          current-&gt;loc);
09724                                     }
09725                                 }
09726                             }
09727                         }
09728                       <font class="keywordflow">else</font>
09729                         {
09730                           voptgenerror 
09731                             (FLG_ALIASUNIQUE,
09732                              message
09733                              (<font class="stringliteral">"Parameter %d (%s) to function %s is declared %s but "</font>
09734                               <font class="stringliteral">"is aliased externally by parameter %d (%s) through "</font>
09735                               <font class="stringliteral">"alias %q"</font>,
09736                               paramno, 
09737                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (current),
09738                               <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (fcn),
09739                               <a class="code" href="varKinds_c.html#a10">alkind_unparse</a> (uentry_getAliasKind (ucurrent)),
09740                               iparamno, <a class="code" href="exprNode_c.html#a160">exprNode_unparse</a> (icurrent),
09741                               <a class="code" href="sRef_c.html#a123">sRef_unparse</a> (asr)),
09742                              current-&gt;loc);
09743                         }
09744                     }
09745                 } end_sRefSet_allElements;
09746               <a class="code" href="sRefSet_c.html#a39">sRefSet_free</a> (aliases);
09747             }
09748         }
09749     } end_exprNodeList_elements;
09750 }
09751 
<a name="l09752"></a><a class="code" href="exprNode_c.html#a172">09752</a> <font class="keywordtype">long</font> <a class="code" href="exprNode_c.html#a172">exprNode_getLongValue</a> (exprNode e)<font class="keyword"> </font>{
09753   <font class="keywordtype">long</font> value;
09754 
09755   <font class="keywordflow">if</font> (exprNode_hasValue (e) 
09756       &amp;&amp; <a class="code" href="multiVal_c.html#a12">multiVal_isInt</a> (exprNode_getValue (e)))
09757     {
09758       value = <a class="code" href="multiVal_c.html#a8">multiVal_forceInt</a> (exprNode_getValue (e));
09759     }
09760   <font class="keywordflow">else</font>
09761     {
09762       value = 0;
09763     }
09764   
09765   <font class="keywordflow">return</font> value;
09766 }
</div></pre><hr><address><small>Generated at Fri Nov 3 18:57:41 2000 for LCLint by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
